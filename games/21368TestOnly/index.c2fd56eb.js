!function(){let e,t,r,i,a,n,s,o,l,h,c;var u,d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},f={},p={},m=d.parcelRequire3d79;null==m&&((m=function(e){if(e in f)return f[e].exports;if(e in p){var t=p[e];delete p[e];var r={id:e,exports:{}};return f[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){p[e]=t},d.parcelRequire3d79=m),m.register,String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){if(!(e instanceof RegExp))return this.replace(RegExp(e,"g"),t);if(0>e.flags.indexOf("g"))throw TypeError("String.prototype.replaceAll called with a non-global RegExp argument");return this.replace(e,t)}),String.prototype.toWellFormed||(String.prototype.toWellFormed=function(){if(!this)return this;let e="";for(let t of this){let r=t.codePointAt(0);r>=55296&&r<=56319||r>=56320&&r<=57343?e+="ï¿½":e+=t}return e});let g={LOG:0,INFO:1,DEBUG:2,ERROR:3},S=new class{#e;#t;#r;#i;constructor(e){this.#r=e,this.#e=0,this.#t=0,this.#i=[]}clear(){this.#i=[],this.#e=0,this.#t=0}add(e){this.#i[this.#e]=e,this.#e=this.#a(this.#e),this.#e===this.#t&&(this.#t=this.#a(this.#t))}getAll(){let e=[],t=this.#t;for(;t!==this.#e;)e.push(this.#i[t]),t=this.#a(t);return e}#a(e){return++e>this.#r&&(e=0),e}}(50);function w(e,t){let r;switch(t){case g.DEBUG:r=":-/ ";break;case g.INFO:r="(i) ";break;case g.ERROR:r="/! ";break;case g.LOG:default:r=""}for(let t of e)S.add(`${r}${t}`)}window.addEventListener("error",e=>{alert(`ERROR: ${e.filename}; line ${e.lineno}
${e.message}
:Stack:
${e.error.stack}`)});var E={log:function(...e){console.log(...e)},info:function(...e){console.info(...e),w(e,g.INFO)},debug:function(...e){console.debug(...e)},error:function(...e){console.error(...e),w(e,g.ERROR)},fatal:function(e){let t;console.error(e),t=e.message?`${e.message}
Stack:
${e.stack}`:e,alert(`Fatal error: ${t}
Previous errors:
${S.join("\n")}`),w(t,g.ERROR)},getMessages:function(){return S.getAll()}};let T="'UnifrakturCook', cursive",y={normal:{size:15,fontName:"'UnifrakturCook', cursive"},h1:{size:30,fontName:T},h2:{size:22,fontName:T},h3:{size:18,fontName:T},emojiSprite:{size:18,fontName:"'UnifrakturCook', cursive"}};function x(e){let t=y[e]??y.normal;return`${t.size}px ${t.fontName}`}let A={DEG_22_5:1/8*Math.PI,DEG_45:2/8*Math.PI,DEG_67_5:3/8*Math.PI,DEG_112_5:5/8*Math.PI,DEG_135:6/8*Math.PI,DEG_157_7:7/8*Math.PI};function I(e,t,r){return e<t?t:e>r?r:e}let R={NONE:-1,N:0,NE:1,E:2,SE:3,S:4,SW:5,W:6,NW:7};function O(e,t){let r=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-r)+r)}function C(e){let t=O(0,e.length);return e[t]}function N(e,t){let r=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-r+1)+r)}function P(e,t=0,r){let i=parseInt(e,r);return Number.isNaN(i)?t:i}function v(e,t=0){let r=parseFloat(e);return Number.isNaN(r)?t:r}class D{x;y;constructor(e,t){this.x=e,this.y=t}static copy(e){return new D(e.x,e.y)}coincident(e){return this.x===e.x&&this.y===e.y}getCartesianAngleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}getScreenAngleTo(e){return Math.atan2(this.y-e.y,e.x-this.x)}toString(){return`(${this.x},${this.y})`}isCoincident(e){return Math.round(this.x)===Math.round(e.x)&&Math.round(this.y)===Math.round(e.y)}isOtherClose(e,t){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)<=Math.pow(t,2)}getOrthoSeparation(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}}class L{x;y;rotation;constructor(e,t,r){this.x=e,this.y=t,this.rotation=r}getCartesianDirection(){return Math.atan2(this.y,this.x)}getScreenDirection(){return Math.atan2(-this.y,this.x)}isZero(e){return Math.abs(this.x)<e&&Math.abs(this.y)<e}}class M{x;y;rotation;constructor(e,t,r){this.x=e,this.y=t,this.rotation=r}}class b extends D{rotation;constructor(e,t,r){super(e,t),this.y=t,this.rotation=r}static fromPoint(e){return new b(e.x,e.y,0)}static copy(e){return new b(e.x,e.y,e.rotation)}getRelativeTo(e){return new b(this.x-e.x,this.y-e.y,this.rotation-e.rotation)}withinSquare(e,t){return Math.abs(e.x-this.x)<t&&Math.abs(e.y-this.y)<t}}class _{x;y;width;height;constructor(e,t,r,i){this.x=e,this.y=t,this.width=r,this.height=i}getBottomRight(){return new D(this.x+this.width,this.y+this.height)}getTopLeft(){return new D(this.x,this.y)}overlaps(e){let t=this.getBottomRight(),r=e.getBottomRight();return!(e.x>t.x||e.y>t.y||r.x<this.x||r.y<this.y)}containsPoint(e){return e.x>=this.x&&e.x<=this.x+this.width&&e.y>=this.y&&e.y<=this.y+this.height}containsCoordinate(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}}new D(Number.MIN_VALUE,Number.MIN_VALUE),new D(Number.MAX_VALUE,Number.MAX_VALUE);let z=null,k=null,G=null,B=0,U=0,H=!0,F=null,$=null,Y=0,W=0,K=1,V=1,X=.1,q="COVER",j=new b(0,0,0);function Z(){let e,t,r,i;let a={width:window.innerWidth,height:window.innerHeight},n=G.width/G.height,s=0,o=0,l=a.width/a.height;("COVER"===q?n>l:n<l)?o=(s=a.height)*n:s=(o=a.width)/n,(K=o/G.width)>V?(o=(K=V)*G.width,s=K*G.height):K<X&&(o=(K=X)*G.width,s=K*G.height),Y=(a.width-o)/2,W=(a.height-s)/2,k.style.left=`${Y}px`,k.style.top=`${W}px`,k.style.width=`${o}px`,k.style.height=`${s}px`,Y<0?(r=-Y/K,e=a.width/K):(r=0,e=G.width),W<0?(i=-W/K,t=a.height/K):(i=0,t=G.height),F=new _(r,i,e,t),E.debug(`Scale: ${K}`),E.debug(`Window: width: ${a.width}, height: ${a.height}`),E.debug(`Display: left: ${Y}, top: ${W}, width: ${o}, height: ${s}`),E.debug(`Visible canvas: left: ${r}, top: ${i}, width: ${e}, height: ${t}`)}function J(){let e=y.normal.size*K;document.documentElement.style.fontSize=`${e}px`}function Q(){Z(),J()}function ee(){return k.getContext("2d",{alpha:H})}function et(e){return e.style.opacity=0,window.setTimeout(()=>{e.remove()},500),Promise.resolve()}function er(e){return new b(e.x+j.x,e.y+j.y,e.rotation)}window.addEventListener("resize",()=>{null===z&&(z=window.setTimeout(()=>{Q(),z=null},200))});var ei={canvasPositionToWorld:er,centreCanvasOn:function(e){j.x=e.x-B,j.y=e.y-U},clearCanvas:function(){ee().clearRect(0,0,G.width,G.height)},displayOnGlass:function(e,t){let r,i;t.replace&&(r=document.getElementsByClassName("glass")[0],r?.replaceChildren()),r||(r=document.createElement("div"),document.body.appendChild(r),r.className="glass");let a=document.createElement("div");r.appendChild(a),a.className="glass-content",a.appendChild(e),t.className&&r.classList.add(t.className),r.style.display="block",r.style.opacity=1;let n=a.getBoundingClientRect().height;a.scrollHeight>n&&a.classList.add("overflow");let s=[];if(t.closers&&t.closers.length>0)t.closers.forEach(e=>{let t=new Promise(t=>{e.element.addEventListener("click",async()=>{t(e.closes)})});s.push(t)});else{let e=new Promise(e=>a.addEventListener("click",()=>e()));s.push(e)}return Promise.race(s).then(e=>(i=e,et(r))).then(()=>i)},getCanvas:()=>k,getContext2D:ee,getCanvasDimensions:function(){return{width:G.width,height:G.height}},getWorldInCanvasBounds:function(){return new _(j.x,j.y,G.width,G.height)},getVisibleCanvasRect:function(){return F},glassPositionToWorld:function(e){let t=e.x<0?F.x+F.width:F.x,r=e.y<0?F.y+F.height:F.y;return er(new b(t+e.x,r+e.y,e.rotation))},isOnCanvas:function(e){return e.overlaps(G)},isOnScreen:function(e){return e.overlaps(G)},panCamera:function(e,t){j.x+=e,j.y+=t},resize:Q,setOpacity:function(e){ee().globalAlpha=e},setOptions:function(e){var t;if(k){E.error("Multiple calls to setScreen ignored.");return}if(!($=document?.getElementById("game-content"))){E.debug("No game element so assuming running as Jest test. No ui");return}$.replaceChildren(),t=e.width,y.normal.size=15+t/100*.390625,y.h1.size=2*y.normal.size,y.h2.size=1.5*y.normal.size,y.h3.size=1.2*y.normal.size,y.emojiSprite.size=t/10,(k=document.createElement("canvas")).id="game-canvas",k.setAttribute("width",e.width),k.setAttribute("height",e.height),k.innerText="Loading the app.",G=new _(0,0,e.width,e.height),B=e.width/2,U=e.height/2,$.appendChild(k),V=e.maxScale,X=e.minScale,q=e.sizingMethod,H=e.alpha,function(){let e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}(),Z(),J()},wipeGlass:et,worldPositionToCanvas:function(e){return new b(e.x-j.x,e.y-j.y,e.rotation)},worldToUi:function(e){return e*K},uiCoordsToMappedPositions:function(e,t){return{canvas:new b(Math.round(e/=K),Math.round(t/=K)),world:new b(Math.round(e+j.x),Math.round(t+j.y),-j.rotation)}},uiToWorld:function(e){return e/K}};let ea=new Map,en=new Map,es=new Map,eo=new Map;function el(t){let r=e.worldPointToGrid(t.position);e.deleteOccupancyOfGridPoint(t,r),t.isOrganic()?eo.delete(t):ea.delete(t)}function eh(t){let r=e.worldPointToGrid(t.position);e.deleteOccupancyOfGridPoint(t,r),en.delete(t)}function ec(e){es.delete(e)}function eu(){e=null}var ed={addActor:function(t){t.isOrganic()?eo.set(t,t):ea.set(t,t),e.moveTileOccupancyGridPoint(t,null,e.worldPointToGrid(t.position))},addArtefact:function(t){en.set(t,t),e.moveTileOccupancyGridPoint(t,null,e.worldPointToGrid(t.position))},addPassiveSprite:function(e){es.set(e,e)},clearAll:function(){eo.forEach(e=>el(e)),ea.forEach(e=>el(e)),en.forEach(e=>eh(e)),es.forEach(e=>ec(e)),eu()},getActors:function(){return ea},getOrganicActors:function(){return eo},getArtefacts:function(){return ea},getTileMap:function(){return e},getWorldDims:function(){return e?e.getDimensions():ei.getCanvasDimensions()},removeTileMap:eu,resolveCancel:function(e){return!1},resolveClick:function(t){let r=e?.getTileAtWorldPoint(t.world);return!!r&&(r.actionClick(t.world),!0)},resolveContextMenu:function(t){let r=e.getTileAtWorldPoint(t.world);return!!r&&(r.actionContextClick(t.world),!0)},removeActor:el,removeArtefact:eh,removePassiveSprite:ec,setTileMap:function(t){e=t},update:function(t){e?.update(t),eo.forEach(r=>{let i=e.worldPointToGrid(r.position);r.visible=e.canHeroSeeGridPoint(i),r.update(t);let a=e.worldPointToGrid(r.position);e.moveTileOccupancyGridPoint(r,i,a)}),en.forEach(r=>{let i=e.worldPointToGrid(r.position);r.visible=e.canHeroSeeGridPoint(i),r.update(t);let a=e.worldPointToGrid(r.position);e.moveTileOccupancyGridPoint(r,i,a)}),ea.forEach(r=>{let i=e.worldPointToGrid(r.position);r.visible=e.canHeroSeeGridPoint(i),r.update(t);let a=e.worldPointToGrid(r.position);e.moveTileOccupancyGridPoint(r,i,a)}),es.forEach(e=>e.update(t)),e?.updateHighlights(t)}};function ef(e,t,r,i){if(e.font=x(i?.styleName),e.fillStyle=i?.color??"white",i?.wrapAtX){var a=t.split("\n");for(let t=0;t<a.length;t++)i.y=function(e,t,r,i){let a;let n=t.split(" "),s=r.x??0,o=r.y??0,l=i.xWrapPosition-s,h=i.lineSpacing??1,c="";for(let t=0;t<n.length;t++){let r=c+n[t]+" ",i=function(e,t){let r=e.measureText(void 0);return{width:r.width,height:r.fontBoundingBoxAscent+r.fontBoundingBoxDescent,offsetTop:-r.fontBoundingBoxAscent,offsetCentreY:.5*(r.fontBoundingBoxDescent-r.fontBoundingBoxAscent)}}(e);a||(a=h*i.height),i.width>l&&t>0?(e.fillText(c,s,o),c=n[t]+" ",o+=a):c=r}return e.fillText(c,s,o),o+a}(e,a[t],r,i)}else e.fillText(t,r.x??0,r.y??0)}let ep={spriteBoxes:!1,showFps:!1},em=new Map;function eg(e){E.debug(`Loading image ${e}`);let t=!1;return new Promise(r=>{let i=new Image;i.addEventListener("load",()=>{E.debug(`Image ${e} loaded.`),t||r(i)}),i.src=e,i.complete&&(E.debug(`Image ${e} already loaded; possibly cached.`),t=!0,r(i))})}var eS={getSpriteBitmap:function(e,t){let r=em.get(e);return r||t?.quiet||E.debug(`Failed to find image ${e}.`),!(!r&&t?.fallback)||(r=em.get(t.fallback))||E.debug(`Failed to find fallback image ${t.fallback}.`),r},getUndefinedBitmap:function(){return em.get("undefined.png")},loadImage:eg,loadImages:function(e){let t=[];return e.forEach(e=>t.push(eg(e))),Promise.all(t)},loadSpriteMap:function(e,t){return E.debug("Loading sprite map."),eg(t).then(t=>(function(e,t){let r=[];return e.frames.forEach(e=>{r.push(createImageBitmap(t,e.frame.x,e.frame.y,e.frame.w,e.frame.h).then(t=>{let r={filename:e.filename,image:t,width:e.frame.w,height:e.frame.h,centreX:e.sourceSize.w/2-e.spriteSourceSize.x,centreY:e.sourceSize.h/2-e.spriteSourceSize.y};return em.set(e.filename,r),e.filename}))}),Promise.all(r)})(e,t))}};let ew=0;var eE={updateTimeNow:function(e){ew=e},getFrameCount:function(e,t=0){return Math.floor((ew+t)/e)}};let eT={WRAP:0,REVERSE:1,STOP:2};class ey{#n;#s;#o;#l;#h;constructor(e,t){this.#n=e,this.#s=e-1,this.#o=t,this.#l=1,this.#h=0}get index(){return this.#h}set index(e){this.#h=I(e,0,this.#n-1)}advanceBy(e){if(this.#n<1)return this.#h;switch(this.#o){case eT.WRAP:return this.#c(e);case eT.REVERSE:return this.#u(e);case eT.NONE:default:return this.#d(e)}}#c(e){return e%=this.#n,this.#h+=e%this.#n,this.#h>=this.#n&&(this.#h=this.#h-this.#n),this.#h}#u(e){if(Math.floor(e/this.#n)%2&&(this.#l=-this.#l),e%=this.#n,this.#l>0){this.#h+=e;let t=this.#h-this.#s;t>0&&(this.#h=this.#s-t,this.#l=-1)}else this.#l<0&&(this.#h-=e,this.#h<0&&(this.#h=-this.#h,this.#l=1));return this.#h}#d(e){return this.#l>0?this.#h=Math.min(this.#s,this.#h+e):this.#l<0&&(this.#h=Math.max(0,this.#h-e)),this.#h}}let ex={NONE:0};class eA{playing;#f;#p;#m;#g;#S;constructor(e,t){let r;if(this.#f=[],this.#m=0,this.#g=O(0,1e3),"string"==typeof e){this.#f.push(eS.getSpriteBitmap(e));return}this.#S=Math.max(1,t.framePeriodMs);let i=e.startIndex??0,a=e.padding??0;do{let t;let n=`${e.prefix}${i.toString().padStart(a,"0")}${e.suffix}`;t=!(0===i&&(e.prefix.endsWith("idle")||e.prefix.endsWith("dead"))),(r=eS.getSpriteBitmap(n,{quiet:t}))&&this.#f.push(r),i++}while(r)this.#p=new ey(this.#f.length,t.loopMethod),this.playing=!0}getFirstFrame(){return{bitmap:this.#f[0],rotation:0,flip:ex.NONE}}getCurrentFrame(){let e={bitmap:void 0,rotation:0,flip:ex.NONE};if(this.#f.length>1){if(this.playing){let e=eE.getFrameCount(this.#S,this.#g);e!==this.#m&&(this.#p.advanceBy(e-this.#m),this.#m=e)}e.bitmap=this.#f[this.#p.index]}else e.bitmap=this.#f[0];return e.bitmap?e:void 0}setCurrentIndex(e){this.#f.length>1&&(this.playing=!1,this.#p.index=e)}getCurrentIndex(){return this.#f.length>1?this.#p.index:0}}class eI{#w;#E;constructor(e,t){this.#w={},e&&(this.#w[e]=t,this.#E=t)}get image(){return this.#E}addAnimatedImage(e,t){this.#w[e]=t}setCurrentKey(e){this.#w.hasOwnProperty(e)?this.#E=this.#w[e]:E.error(`Attempt to set current key to nonexistent value of ${e}`)}getCurrentFrame(){return this.#E.getCurrentFrame()}getAnimatedImage(e){return this.#w[e]}}class eR{_context;_boundingBoxCanvas;constructor(e){this._context=e,this._boundingBoxCanvas=new _(0,0,0,0)}getImageFilename(){return null}getContext(){return this._context}getBoundingBoxCanvas(){return this._boundingBoxCanvas}render(e,t){if(e=ei.worldPositionToCanvas(e),!this.isOnCanvas(e))return;let r=this._context.globalAlpha;this._context.globalAlpha=r*t;let i=e.rotation;i&&(this._context.save(),this._context.translate(e.x,e.y),this._context.rotate(-e.rotation),this._context.translate(-e.x,-e.y)),this._doRender(e),i&&this._context.restore(),ep.spriteBoxes&&(this._context.strokeStyle="green",this._context.strokeRect(this._boundingBoxCanvas.x,this._boundingBoxCanvas.y,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height)),this._context.globalAlpha=r}_doRender(e){E.error("_doRender method should be overridden.")}isOnScreen(e){let t=new _(e.x-this._boundingBoxCanvas.width/2,e.y-this._boundingBoxCanvas.height/2,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height);return ei.isOnScreen(t)}isOnCanvas(e){let t=new _(e.x-this._boundingBoxCanvas.width/2,e.y-this._boundingBoxCanvas.height/2,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height);return ei.isOnCanvas(t)}}class eO extends eR{#T;#y;#x;text;color;constructor(e,t,r={styleName:"normal",color:"white"}){super(e),this.text=t,this.color=r.color,this.#T=r.styleName}#A(e){this._context.font=x(this.#T);let t=this._context.measureText(e);this.#x={width:t.width,height:t.fontBoundingBoxAscent+t.fontBoundingBoxDescent,origin:{x:-.5*t.width,y:.5*(t.fontBoundingBoxAscent-t.fontBoundingBoxDescent)}},this.#y=e}_doRender(e){var t;this.text!==this.#y&&this.#A(this.text);let r={x:e.x+this.#x.origin.x,y:e.y+this.#x.origin.y,rotation:e.rotation};ef(this._context,this.#y,r,{color:this.color,styleName:this.#T}),this._boundingBoxCanvas=(t=this.#x,new _(e.x-t.width/2,e.y-t.height/2,t.width,t.height))}}class eC extends eR{#I;#R;#O;#C;#N;#P;#v;constructor(e,t){super(e),this.#I=t.width??10,this.#R=t.height??10,this.#O=this.#I/2,this.#C=this.#R/2,this.#N=t.fillStyle,this.#P=t.strokeStyle,this.#v=t.lineWidth??2}_doRender(e){this._context.lineWidth=this.#v;let t=e.x-this.#O,r=e.y-this.#C;this.#N&&(this._context.fillStyle=this.#N,this._context.fillRect(t,r,this.#I,this.#R)),this.#P&&(this._context.strokeStyle=this.#P,this._context.strokeRect(t,r,this.#I,this.#R)),this._boundingBoxCanvas=new _(t,r,this.#I,this.#R)}}class eN extends eR{#R;#C;#I;#O;#N;#P;#D;#L;#M;#b;constructor(e,t){super(e),this.#R=t.height,this.#C=this.#R/2,this.#I=t.width,this.#O=this.#I/2,this.#N=t.fillStyle,this.#P=t.strokeStyle,this.#D=t.offsetX??0,this.#L=t.offsetY??0,this.setLevel(0)}setLevel(e){this.#M=Math.min(e,1)*this.#R,this.#b=.5*this.#M}_doRender(e){let t=e.y-this.#C+this.#L,r=e.y+this.#C-this.#M+this.#L,i=e.x-this.#O+this.#D;this.#N&&(this._context.fillStyle=this.#N,this._context.fillRect(i,r,this.#I,this.#M)),this.#P&&(this._context.strokeStyle=this.#P,this._context.strokeRect(i,t,this.#I,this.#R)),this._boundingBoxCanvas=new _(i,t,this.#I,this.#R)}}class eP extends eR{#_;constructor(e,t){super(e);let r=Math.max(t.fillStyles.length??0,t.strokeStyles.length??0);if(0===r){E.error("Attempt to create MultiGaugeTileRenderer with no gauges.");return}this.#_=[];let i=t.tileSize/r,a=-t.tileSize/2+i/2;for(let n=0;n<r;n++)this.#_.push(new eN(e,{width:i,height:t.tileSize,fillStyle:t.fillStyles?.[n],strokeStyle:t.strokeStyles?.[n],offsetX:a+i*n,offsetY:0}))}setLevel(e,t){this.#_[e]?.setLevel(t)}render(e){this.#_?.forEach(t=>t.render(e))}}class ev extends eR{#z;#k;constructor(e,t){super(e),t?.getCurrentFrame?(this.#k=t,this.#z=this.#k.getCurrentFrame()):this.#z={bitmap:t,rotation:0,flip:ex.NONE},this.#z?.bitmap?(this._boundingBoxCanvas.width=this.#z.bitmap.width??0,this._boundingBoxCanvas.height=this.#z.bitmap.height??0):E.error("No image frame available for sprite.",t)}getImageFilename(){return this.#z?.bitmap.filename}_doRender(e){if(!this.#z)return;let t=this.#k?this.#k.getCurrentFrame():this.#z;this._boundingBoxCanvas.x=e.x-this._boundingBoxCanvas.width/2,this._boundingBoxCanvas.y=e.y-this._boundingBoxCanvas.height/2,e.rotation=t.rotation,this._context.drawImage(t.bitmap.image,e.x-t.bitmap.centreX,e.y-t.bitmap.centreY)}}class eD{#G=new b(0,0,0);#B=new L(0,0,0);#U=new M(0,0,0);#H;#F;#$;visible;opacity;constructor(e){this.#H=e?.renderer,this.visible=!0,this.opacity=1}get position(){return this.#G}set position(e){this.#G.x=this.valueOrZero(e.x),this.#G.y=this.valueOrZero(e.y),this.#G.rotation=this.valueOrZero(e.rotation)}get velocity(){return this.#B}get acceleration(){return this.#U}set acceleration(e){this.#U=e}set velocity(e){this.#B.x=this.valueOrZero(e.x),this.#B.y=this.valueOrZero(e.y),this.#B.rotation=this.valueOrZero(e.rotation)}replaceTransientModifier(e){this.#$&&this.#$.kill(),this.#$=e}replaceBaseModifier(e){this.#F&&this.#F.kill(),this.#F=e}valueOrZero(e){return"number"==typeof e?e:0}update(e){this.#F&&(this.#F=this.#F.update(this,e)),this.#$&&(this.#$=this.#$.update(this,e)),this.visible&&this.#Y()}#Y(){this.#H&&(this.#H.forEach?this.#H.forEach(e=>e.render(this.#G,this.opacity)):this.#H.render(this.#G,this.opacity))}getBoundingBox(){let e=this.#H.getBoundingBoxCanvas();return new _(this.position.x-e.width/2,this.position.y-e.height/2,e.width,e.height)}getImageFilename(){if(!this.#H.forEach)return this.#H.getImageFilename();for(let e of this.#H){let t=e.getImageFilename();if(t)return t}return null}}class eL{decoratedModifier;#W;#K;#V;constructor(e){this.#K=0,this.#V=0,this.decoratedModifier=e}#X(e){this.#W&&(this.#W(e),this.#W=null)}kill(){this.#X()}cleanUpOnTimeout(e){}applyAsTransientToSprite(e,t=10){return this.#V=t,new Promise(t=>{this.#W=t,e.replaceTransientModifier(this)})}applyAsContinuousToSprite(e){e.replaceBaseModifier(this)}update(e,t){this.#W&&(this.#K+=t),this.decoratedModifier&&(this.decoratedModifier=this.decoratedModifier?.update(e,t));let r=this.doUpdate(e,t);return(this.#K>this.#V&&(this.cleanUpOnTimeout(e),r=null),r)?r:(this.#X(null),null)}doUpdate(e,t){return E.error("doUpdate should be overridden."),this}}class eM extends eL{#q;#j;#Z;#J;constructor(e,t,r){super(r),this.#j=e,this.#J=.3*t;let i=t-this.#J;this.#q=1/Math.max(i,.5),this.#Z=-1}doUpdate(e,t){return this.#Z<0?this.#Z=0:this.#Z+=t,this.#Z>this.#j+this.#J?e.opacity=Math.max(0,1-(this.#Z-this.#j-this.#J)*this.#q):e.opacity=1,e.opacity>0?this:null}}class eb{#Q;#ee;constructor(e,t){this.#Q=e,this.#ee=t}getSpeedBetweenPoints(e,t){return this.#ee?this.#Q:(1+.1*(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)))*this.#Q}}class e_ extends eL{#et;#er;constructor(e){super(e)}doUpdate(e,t){return e.position.x+=e.velocity.x*t,e.position.y+=e.velocity.y*t,e.position.rotation+=e.velocity.rotation*t,e.acceleration&&(e.velocity.x+=e.acceleration.x*t,e.velocity.y+=e.acceleration.y*t,e.velocity.rotation+=e.acceleration.rotation*t),this}}class ez extends eL{#ei;constructor(e=-Math.PI/2,t){super(t),this.#ei=e}static createUprightAligner(e){return new ez(-Math.PI/2,e)}doUpdate(e,t){return e.position.rotation=e.velocity.isZero(.1)?0:e.velocity.getScreenDirection()-this.#ei,this}}class ek extends eL{#ea;#en;#es;constructor(e,t){super(t),this.#ea=e.prey,this.#en=e.maxSeparation,this.#es=new eb(e.speed,e.linear)}doUpdate(e,t){let r=this.#ea.position,i=e.position,a=this.#es.getSpeedBetweenPoints(r,i);if(!i.withinSquare(r,this.#en)){let n=i.getCartesianAngleTo(r);e.velocity.x=a*Math.cos(n),e.velocity.y=a*Math.sin(n);let s=e.velocity.x*t,o=e.velocity.y*t;e.position.x+=this.getMinMove(s,r.x,i.x),e.position.y+=this.getMinMove(o,r.y,i.y)}return this}getMinMove(e,t,r){let i=t-r;return 0>Math.sign(e)?Math.max(e,i):Math.min(e,i)}}class eG extends eL{#eo;#h;#el;#es;constructor(e,t){super(t),this.#eo=e.path,this.#h=0,this.#el=e.path[0],this.#es=new eb(e.speed,e.linear)}cleanUpOnTimeout(e){E.debug("Transient path follower timed out. Moving to end of path.");let t=this.#eo[this.#eo.length-1];e.position.x=t.x,e.position.y=t.y,e.velocity.x=0,e.velocity.y=0}doUpdate(e,t){let r=e.position,i=this.#es.getSpeedBetweenPoints(this.#el,r),a=r.getCartesianAngleTo(this.#el);e.velocity.x=i*Math.cos(a),e.velocity.y=i*Math.sin(a);let n=e.velocity.x*t,s=e.velocity.y*t;if(r.x+=this.getMinMove(n,this.#el.x,r.x),r.y+=this.getMinMove(s,this.#el.y,r.y),r.isCoincident(this.#el)){if(++this.#h>=this.#eo.length)return e.velocity.x=0,e.velocity.y=0,this.decoratedModifier;this.#el=this.#eo[this.#h]}return this}getMinMove(e,t,r){let i=t-r;return 0>Math.sign(e)?Math.max(e,i):Math.min(e,i)}}function eB(e,t){return new eG({path:[t],speed:100},e.sprite.modifier).applyAsTransientToSprite(e.sprite)}function eU(e,t){let r=new eD({renderer:e});r.position=t.position,r.velocity=t.velocity??new L(0,0,0),r.acceleration=t.acceleration??new M(0,0,0),ed.addPassiveSprite(r),new eM(t.delaySecs,t.lifetimeSecs,new e_).applyAsTransientToSprite(r,20).then(()=>ed.removePassiveSprite(r))}function eH(e,t){eU(new ev(ei.getContext2D(),e),t)}function eF(e,t){eU(new eO(ei.getContext2D(),e,{color:t.color}),t)}function e$(e,t,r="white"){eF(e,{color:r,delaySecs:2,lifetimeSecs:3,position:new D(t.x,t.y),velocity:new L(0,-48,0),acceleration:new M(0,-96,0)})}var eY={TILE_SIZE:48};function eW(e){var t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return Math.abs(t).toString(16).toLowerCase().padStart(8,"0")}let eK=new class{#eh;#ec;constructor(){this.#eh=localStorage,this.#ec=new Map}set(e,t){this.#ec.set(e,t);try{this.#eh.setItem(e,this.toChecksummed(JSON.stringify(t)))}catch(e){E.error(`Cannot save setting. ${e.message}`)}}get(e,t,r){if(this.#ec.has(e))return this.#ec.get(e);let i=t;try{let t=this.#eh.getItem(e);null!==t&&(i=JSON.parse(this.fromChecksummed(t),r))}catch(e){E.error(`Cannot parse value from local storage. ${e.message}`)}return this.#ec.set(e,i),i}clearAll(){this.#eh.clear(),this.#ec.clear(),E.info("All local storage cleared.")}setStorage(e){this.#eh=e}toChecksummed(e){let t=eW(e);return`${t}*${e}`}fromChecksummed(e){let t=e.match(/^([a-z0-9]{8})\*(.*)$/);if(t){if(t[1]===eW(t[2]))return t[2];throw Error("Invalid checksum")}throw Error("Invalid format")}};class eV{#eu;_element;#ed;#ef;closes;constructor(e){if(e.closes&&e.action)throw Error("Attempt made to create control that is set to close forms and perform and action. These are mutually exclusive.");if(e.persistent&&!e.id)throw Error("Persistent controls must have an ID set in the options.");this.#eu=e.id,this.#ef=e.persistent,e.persistent?this.#ed=eK.get(this.#eu,e.defValue):this.#ed=e.defValue,this.closes=e.closes,this.listeners=0}get element(){return this._element}get value(){return this.#ed}set value(e){e!==this.#ed&&(this.#ef&&eK.set(this.#eu,e),this.#ed=e)}}class eX extends eV{constructor(e){super(e),this._element=this.buildElement(e),e.action&&this._element.addEventListener("click",()=>e.action())}buildElement(e){let t=document.createElement("button");return t.appendChild(document.createTextNode(e.label)),t.className="text-button",t}}class eq extends eV{constructor(e){super(e),this._element=this.buildElement(e),e.action&&this._element.addEventListener("click",()=>e.action())}buildElement(e){let t=document.createElement("button");return e.leftLabel&&t.appendChild(document.createTextNode(e.leftLabel)),t.appendChild(ej(e.imageName,"button-icon")),e.rightLabel&&t.appendChild(document.createTextNode(e.rightLabel)),t.className="icon-button",t}}function ej(e,t){let r=eS.getSpriteBitmap(e??"undefined.png",{fallback:"undefined.png"}),i=document.createElement("canvas");i.setAttribute("width",eY.TILE_SIZE),i.setAttribute("height",eY.TILE_SIZE);let a=i.getContext("2d");return a.clearRect(0,0,eY.TILE_SIZE,eY.TILE_SIZE),a.drawImage(r.image,.5*(eY.TILE_SIZE-r.width),.5*(eY.TILE_SIZE-r.height)),i.className=t,i}class eZ extends eV{#ep;constructor(e){super(e),this._element=this.buildElement(e.label),this.#ep.checked=this.value,this._element.addEventListener("change",t=>{this.value=this.#ep.checked,e.onChange&&e.onChange(this.value)})}buildElement(e){let t=document.createElement("span");t.className="styled-checkbox",this.#ep=document.createElement("input"),this.#ep.setAttribute("type","checkbox"),t.appendChild(this.#ep),t.appendChild(ej("ui-checkbox00.png","unchecked")),t.appendChild(ej("ui-checkbox01.png","checked"));let r=document.createElement("label");return r.appendChild(document.createTextNode(e)),r.appendChild(t),r}}class eJ extends eV{#em;constructor(e){super(e),this._element=this.buildElement(e.label),this.#em.value=this.value,this._element.addEventListener("change",t=>{this.value=this.#em.value,e.onChange&&e.onChange(this.value)})}buildElement(e){let t=document.createElement("span");t.className="styled-range",this.#em=document.createElement("input"),this.#em.setAttribute("type","range"),t.appendChild(this.#em);let r=document.createElement("label");return r.appendChild(document.createTextNode(e)),r.appendChild(t),r}}let eQ={TEXT_BUTTON:"text button",CHECKBOX:"checkbox",RANGE:"range"};function e4(e,t={}){let r=document.createElement(e);return t.className&&(r.className=t.className),t.html?r.innerHTML=t.html:t.text&&(r.innerText=t.text),t.child&&r.appendChild(t.child),r}function e0(e){let r=t?.get(e);return null==r?e:Array.isArray(r)?r[O(0,r.length)]:r}function e1(e,...t){let r,i="";for(let t of e){let e=t.trim();if(""!==e){r=e;break}}return r?(i=e0(r),t.forEach((e,t)=>{let r=RegExp(`\\$\\{${t}[a-zA-Z_-]*\\}`);i=i.replace(r,e)}),i):t?t.join(" "):""}let e8={setMap:function(e){t=e},getText:e0},e3=new class{onStartAnimation;#eg;#eS;constructor(){this.#eg=!1,this.#eS=void 0,window.addEventListener("blur",()=>{E.debug(`Blur: current animation state ${this.#eg}`),this.#eS=this.#eg,this.setAnimationState(!1)}),window.addEventListener("focus",()=>{E.debug(`Focus: saved animation state ${this.#eS}`),this.setAnimationState(this.#eS??!0),this.#eS=void 0})}setAnimationState(e){e!==this.#eg&&(this.#eg=e,this.#eg&&this.onStartAnimation&&this.onStartAnimation())}isAnimationOn(){return this.#eg}},e2={OK:0,CANCEL:1};function e5(){e3.setAnimationState(!1)}function e6(e,t){return ei.displayOnGlass(e,t).then(e=>(e3.setAnimationState(!0),e))}function e9(e,t){let r=e4("div",{className:"dialog-scroll-content"});if(t&&r.appendChild(e4("p",{className:"dialog-title",text:t})),Array.isArray(e))for(let t of e)r.appendChild(e9(t));else r.appendChild(e4("p",{text:e}));return r.classList.add(["scrollable"]),r}function e7(e,t={}){e5();let r=document.createElement("div"),i=e4("div",{className:"dialog-scroll-content"});r.appendChild(i),t.title&&i.appendChild(e4("p",{className:"dialog-title",text:t.title})),t.preamble&&(t.preamble instanceof Element?i.appendChild(t.preamble):i.appendChild(e4("p",{text:t.preamble}))),e instanceof Element?i.appendChild(e):i.appendChild(e9(e));let a=e4("div",{className:t.row?"action-buttons-row":"action-buttons-col"});r.appendChild(a);let n=[];if(t?.actionButtons?.forEach(e=>{e.element.parentElement||a.appendChild(e.element),null!==e.closes&&void 0!==e.closes&&n.push({element:e.element,closes:e.closes})}),0===n.length){let e=new eX({id:e2.OK,label:t.okButtonLabel??e1`BUTTON OK`});a.appendChild(e.element),n.push(e)}return e6(r,{closers:n,className:t?.className})}var te={popupElement:function(e){let t=document.createElement("div");t.className="popup";let r=document.createElement("div");return t.appendChild(r),r.appendChild(e),t.style.opacity=1,document.body.appendChild(t),t},showChoiceDialog:function(e,t,r){document.createElement("div").appendChild(e9(t,e));let i=[];return r?.forEach((e,t)=>{let r=new eX({label:e,closes:t});i.push(r)}),e7(t,{preamble:e,actionButtons:i,row:!0})},showMessage:function(e){let t=document.createElement("div");t.appendChild(document.createTextNode(e)),t.className="popup",t.style.opacity=1,document.body.appendChild(t),t.addEventListener("click",()=>t.remove())},showOkDialog:function(e,t={}){e5();let r=document.createElement("div");r.appendChild(e9(e,t.title));let i=document.createElement("button");return i.appendChild(document.createTextNode(t.okButtonLabel??e1`BUTTON OK`)),r.appendChild(i),e6(r,{className:t?.className,closers:[{element:i,closes:e2.OK}]})},showElementOkDialog:function(e,t,r=e1`BUTTON OK`,i){e5();let a=document.createElement("div"),n=e4("div",{className:"dialog-scroll-content"});a.appendChild(n),e&&n.appendChild(e4("p",{className:"dialog-title",text:e})),n.appendChild(t);let s=document.createElement("button");return s.appendChild(document.createTextNode(r)),a.appendChild(s),e6(a,{closers:[{element:s,closes:e2.OK}],className:i})},showControlsDialog:e7};let tt=new class{#ew;#eE;#eT;#ey;constructor(){this.#eT=.5,this.#ey=.5,this.#ew=new Map}loadAndPlayMusic(e){if(E.debug(`Loading music ${e}`),this.#eE)throw Error("Only one music track currently supported.");this.#eE=this.#ex(e),this.#eE&&this.#eE.addEventListener("canplay",e=>{this.#eE.volume=this.#eT,this.#eE.loop=!0,this.#eE.play(),window.addEventListener("blur",()=>{this.#eE.pause()}),window.addEventListener("focus",()=>{this.#eE.play()})})}loadEffects(e){return E.debug("Loading sound effects."),e.forEach((e,t)=>{let r=this.#ex(e);r&&this.#ew.set(t,r)}),Promise.resolve()}#ex(e){return e?new Audio(e):null}playEffect(e){let t=this.#ew.get(e);t&&t.readyState>=3&&(t.volume=this.#ey,t.play())}setMusicVolumePercent(e){this.#eT=e/100,this.#eE&&(this.#eE.volume=this.#eT)}setEffectsVolumePercent(e){this.#ey=e/100}},tr=/^ *(\d+(?:\.\d*)?) *([a-zA-Z]+) *$/,ti=new Map([["PP",10],["GP",1],["SP",.1],["CP",.01]]);function ta(e){let t=0,r=0,i=e.match(tr);if(!i)return E.error(`Unrecognised coin "${e}". Value set to zero.`),{valueFace:0,valueGp:0,type:"GP"};{t=i[1];let e=ti.get(i[2])??0;r=parseFloat(i[1])*e}return{valueFace:t,valueGp:r,type:i[2]}}let tn=/(\d+)[dD](\d+)(?: *([+-]) *(\d+))?/;function ts(e=6){return N(1,e)}function to(e){return tn.test(e)}function tl(e){if(!e)return 1;if(Number.isInteger(e))return ts(e);let t=tc(e);if(!t)return E.error(`String ${e} not recognised as a dice roll. Defaulting to 1D1.`),1;let r=0;for(let e=0;e<t.qty;e++)r+=ts(parseInt(t.sides));return r+t.offset}function th(e){let t=tc(e);return t?t.qty*(t.sides+t.offset):1}function tc(e){let t=e?.match(tn);if(!t)return E.error(`Invalid dice format: ${e}`),{qty:0,sides:0,offset:0};let r=parseInt(t[1]),i=parseInt(t[2]),a=t[3],n=t[4]?parseInt(t[4]):0;return"-"===a&&(n=-n),{qty:r,sides:i,offset:n}}function tu(e){return e?e.offset?`${e.qty}D${e.sides}+${e.offset}`:`${e.qty}D${e.sides}`:""}let td=[10,200,450,700,1100,1800,2300,2900,3900,5e3,5900,7200,8400,1e4,11500,13e3,15e3,18e3,2e4,22e3,25e3,33e3,41e3,5e4,62e3,75e3,9e4,105e3,12e4,135e3,155e3],tf=[{exp:0,profBonus:2},{exp:300,profBonus:2},{exp:900,profBonus:2},{exp:2700,profBonus:2},{exp:6500,profBonus:3},{exp:14e3,profBonus:3},{exp:23e3,profBonus:3},{exp:34e3,profBonus:3},{exp:48e3,profBonus:4},{exp:64e3,profBonus:4},{exp:85e3,profBonus:4},{exp:1e5,profBonus:4},{exp:12e4,profBonus:5},{exp:14e4,profBonus:5},{exp:165e3,profBonus:5},{exp:195e3,profBonus:5},{exp:225e3,profBonus:6},{exp:265e3,profBonus:6},{exp:305e3,profBonus:6},{exp:355e3,profBonus:6}],tp=[[13,15],[12,14],[11,13],[8,13],[8,13],[8,13]],tm=[8,15],tg=new Map([["BARBARIAN",["STR","CON","DEX","INT","WIS","CHA"]],["CLERIC",["WIS","CON","STR","CHA","INT","DEX"]],["FIGHTER",["STR","DEX","CON","INT","WIS","CHA"]],["RANGER",["STR","DEX","INT","CHA","CON","WIS"]],["ROGUE",["DEX","INT","CHA","STR","CON","WIS"]],["WIZARD",["INT","WIS","STR","CON","DEX","CHA"]],["DEFAULT",["STR","CON","DEX","INT","WIS","CHA"]]]),tS=new Map([["ROGUE",{pbMultiplier:2}],["DEFAULT",{pbMultiplier:1}]]),tw=new Map([["BARBARIAN",[4,8,12,16,19]],["CLERIC",[4,8,12,16,19]],["FIGHTER",[4,6,8,12,14,16,19]],["RANGER",[4,8,12,16,19]],["ROGUE",[4,8,10,12,16,19]],["WIZARD",[4,8,12,16,19]]]);function tE(e){let t=Math.round(4*(2+20*(e.getCharacterLevel()-1)/19));return e.set("CASTING_POWER",t),t}let tT={VERY_EASY:5,EASY:10,MEDIUM:15,HARD:20,VERY_HARD:25,NEARLY_IMPOSSIBLE:30,IMPOSSIBLE:999};function ty(e,t){let r=e.rollForAttack();if(1===r.roll)return E.info("Attack dice rolled 0: cursed."),0;if(20===r.roll)return E.info("Attack dice rolled 20: critical hit. Damage will be doubled."),2*e.rollForDamage();let i=t.getEffectiveInt("AC");return(E.info(`Melee: attack roll ${r.value} vs target AC ${i}`),r.value>=i)?e.rollForDamage():0}function tx(e,t){let r=tl(e.get("DMG_POISON")??e.get("DMG","1D4")),i=t.getNonMeleeSaveAbilityModifier(e),a=e.getInt("DC");if(!a)return E.error(`Poisoner ${e.get("NAME")} has no DC set.`),r;let n=ts(20);return(E.info(`Poison: save roll ${n} + modifier ${i} vs target DC ${a}`),n+i>=a)?Math.round(e.getFloat("DMG_SAVED",0)*r):r}let tA={NONE:"",NEED_LONG_REST:"need long rest",NEED_MORE_RATIONS:"need more rations"};function tI(e,t){let r=e.traits.getInt("HP",0),i=r;switch(t){case"SHORT":{let t=e.traits.get("HIT_DICE"),a=e.traits.getInt("HP_MAX",r),n=e.traits.getAsModifier("CON"),s=tc(t);s.qty>0&&(s.qty--,i=Math.min(i=r+ts(s.sides)+n,a),e.traits.set("HP",i),e.traits.set("HIT_DICE",tu(s)))}break;case"LONG":{let t=e.traits.getCharacterLevel(),a=tc(e.traits.get("HIT_DICE")),n=Math.max(1,Math.ceil(.5*a.qty));a.qty=Math.min(t,a.qty+n),e.traits.set("HIT_DICE",tu(a)),i=e.traits.getInt("HP_MAX",r),e.traits.set("HP",i),e.toxify.cure(),tE(e.traits)}break;default:E.error(`Attempt to rest for unknown length of ${t}`)}return{oldHp:r,newHp:i}}function tR(e,t){let r=tC(e.getEffectiveInt(t.ability,1)),i=t.proficiency?e.getCharacterPb(t.proficiency):0;return ts(20)+r+i>=t.difficulty}let tO=["STR","DEX","CON","INT","WIS","CHA","AC"];function tC(e){return Math.floor((e-10)/2)}class tN{damageDice;proficiencyBonus;abilityModifier;#eA;unarmed;constructor(e){this.damageDice=e.damageDice??"1D1";let t=e.weaponType??"";"UNARMED"===t?(this.unarmed=!0,this.#eA=!1):t.includes("SIMPLE")&&t.includes("LIGHT")?(this.unarmed=!1,this.#eA=!0):(this.unarmed=!1,this.#eA=!1),this.proficiencyBonus=e?.proficiencyBonus??0,this.abilityModifier=e?.abilityModifier??0}#eI(){return 1+this.abilityModifier}getMaxDamage(){return this.unarmed?this.#eI():th(this.damageDice)+this.abilityModifier}canUseTwoWeapons(){return this.#eA}rollForAttack(){let e=ts(20);return E.info(`Attack roll ${e} + ability(${this.abilityModifier})+ proficiency(${this.proficiencyBonus})`),{roll:e,value:e+this.abilityModifier+this.proficiencyBonus}}rollForDamage(){if(this.unarmed)return this.#eI();let e=Math.max(tl(this.damageDice)+this.abilityModifier);return E.debug(`Damage: ${this.damageDice} + ability(${this.abilityModifier}) = ${e}`),e}clone(){let e=new tN({});return e.abilityModifier=this.abilityModifier,e.damageDice=this.damageDice,e.proficiencyBonus=this.proficiencyBonus,e.#eA=this.#eA,e.unarmed=this.unarmed,e}}class tP{_traits;constructor(e){"string"==typeof e?(this._traits=new Map,this.#eR(e)):this._traits=new Map(e)}#eR(e){return e.split(",").forEach(e=>{let t=e.match(/^\s*(\w+)\s*[=: ]\s*(.+?)\s*$/);if(!t)return;let[r,i]=this.#eO(t[1],t[2]);if(t)this.#eC(r,i.trim());else throw Error(`Invalid property definition'${e}'`)}),this}has(e){return this._traits.has(e)||this._traits.has("_"+e)}set(e,t){this._traits.set(e,t),this._refreshDerivedValues(e)}get(e,t){return this._traits.get(e)??this._traits.get("_"+e)??t}delete(e){return this._traits.delete(e)}_refreshDerivedValues(e){}getInt(e,t){return P(this.get(e,t),t)}addInt(e,t,r=!1){let i=this.getInt(e),a=P(t)+i;r&&a<0&&(a=0),this._traits.set(e,a)}getValueInFeetInTiles(e,t){let r=this.getInt(e);return null==r?t:tP.feetToTiles(r)}static feetToTiles(e){return Math.round(e/7.5)}getFloat(e,t){return v(this.get(e,t),t)}getAsModifier(e,t){let r=this.getInt(e);return null==r?t:tC(r)}#eO(e,t){return"NAME"!==(e=e.toUpperCase())&&"REWARD"!==e&&(t=t.toUpperCase()),[e,t]}#eC(e,t){switch(e){case"PROF":case"_PROF":return this.#eN(e,t);case"VALUE":case"_VALUE":return this.#eP(e,t);case"DMG":case"_DMG":case"DMG_MELEE":case"_DMG_MELEE":case"DMG_POISON":case"_DMG_POISON":case"HP_GAIN":case"_HP_GAIN":return this.#ev(e,t);case"HIT_DICE":case"_HIT_DICE":return this.#eD(e,t);case"DC":case"_DC":case"IDENTIFY_DC":case"_IDENTIFY_DC":return this.#eL(e,t);default:return this.#eM(e,t)}}#eP(e,t){let r=t.match(/^(.*)([a-zA-Z]{2})$/);if(r){let e;let i=r[1].trim();e=to(i)?tl(i):P(r[1],0),t=`${e} ${r[2]}`}else E.error(`Invalid value for VALUE trait: ${t}`),t="0 GP";this.set(e,t)}#eL(e,t){let r;r=isNaN(t)?tT[t]??1:P(t),this.set(e,r)}#eD(e,t){to(t)||(E.error(`Invalid trait value ${t} for ${e}. Dice definition required.`),t="1D6"),this.set(e,t)}#ev(e,t){let r;to(t)?r=t:isNaN(r=parseInt(t))&&(E.error(`Invalid trait value ${t} for ${e}. Integer or dice definition required.`),r=0),this.set(e,r)}#eM(e,t){"YES"===t||"TRUE"===t?t=!0:"NO"===t||"FALSE"===t?t=!1:to(t)&&"DMG"!==e&&(t=tl(t)),this.set(e,t)}#eN(e,t){let r=t.split(/\s*&\s*/),i=[];r.forEach(e=>i.push(e.toUpperCase())),this._traits.set(e,i)}clone(){return new tP(this._traits)}getAllTraits(){return new Map([...this._traits.entries()])}getAllTraitsSorted(){return new Map([...this._traits.entries()].sort())}valuesToString(){let e="";return this._traits.forEach((t,r)=>{""!==e&&(e+=","),e+=`${r}:${t}`}),e}toJSON(){return{reviver:"Traits",data:[...this._traits]}}static revive(e){return new tP(new Map(e))}}class tv extends tP{constructor(e){super(e??new Map)}getDamageDiceWhenCastBy(e){let t=this.get("DMG");return this.#eb(t,e)}getHpGainDiceWhenCastBy(e){let t=this.get("HP_GAIN");return this.#eb(t,e)}#eb(e,t){let r=this.getFloat("DICE_PER_LEVEL",0),i=function(e,t){let r=tc(e);return r?(r.qty=Math.max(r.qty+t,0),tu(r)):e}(e,Math.floor((t.getCharacterLevel()-1)*r));return E.info(`Spell cast: base dice = ${e} raised to ${i} for level.`),i}toJSON(){let e=super.toJSON();return e.reviver="MagicTraits",e}static revive(e){return new tv(new Map(e))}}class tD extends tP{_proficiencyBonus;_level;_attacks;_availableArtefactTraits;_transientFxTraits;_effectiveTraits;_maxTileMovePerTurn;_allowRefreshDerived=!1;constructor(e){super(e??new Map([["NAME","mystery"]])),this._proficiencyBonus=0,this.#e_(),this._transientFxTraits=[],this._allowRefreshDerived=!0,this._refreshDerivedValues()}getMaxTilesPerMove(){return this._maxTileMovePerTurn}clone(){let e=new tD(this._traits);return e._proficiencyBonus=this._proficiencyBonus,e._level=this._level,e._attacks=this._attacks.map(e=>e.clone()),e._availableArtefactTraits=this._availableArtefactTraits,e._effectiveTraits=this._effectiveTraits.clone(),e._transientFxTraits=[],this._transientFxTraits.forEach(t=>e._transientFxTraits.push(t.clone())),e._maxTileMovePerTurn=this._maxTileMovePerTurn,e}exceedAbilitiesAndExp(e,t=0){["STR","DEX","INT","WIS","CON","CHA","EXP"].forEach(r=>{let i=e.getInt(r)+t;i>this.getInt(r)&&this.set(r,i)})}addTransientFxTraits(e){let t=new tP,r=!1;tO.forEach(i=>{let a=tD.toFxKey(i),n=e.getInt(a);n&&(r=!0,t.set(a,n))}),r&&(this._transientFxTraits.push(t),this._refreshDerivedValues())}clearTransientFxTraits(){this._transientFxTraits=[],this._refreshDerivedValues()}#e_(){(function(e){let t=new Map,r=tg.get(e)??tg.get("DEFAULT");for(let e=0;e<r.length;e++){let i=e<tp.length?tp[e]:tm,a=N(i[0],i[1]);t.set(r[e],a)}return t})(this.get("CLASS")).forEach((e,t)=>{this.get(t)||this.set(t,e??8)}),this.has("EXP")||this.set("EXP",0)}_updateHitPoints(){let e=this._traits.has("HP"),t=this._traits.has("HP_MAX"),r=this.get("HIT_DICE");if(!e||!t||r){if(r){let t=tC(this.getInt("CON",0)),i=th(r),a=i+t+(this._level-1)*(Math.ceil((i+1)/2)+t);this.set("HP_MAX",a),e||this.set("HP",th(r)+t)}else e&&this.set("HP_MAX",this.get("HP"))}}static toFxKey(e){return`FX_${e}`}hasEffective(e){return!!this._effectiveTraits&&this._effectiveTraits.has(e)}getEffective(e,t){return this._effectiveTraits.get(e)??this.get(e,t)}getEffectiveInt(e,t){return P(this.getEffective(e),t)}getCharacterLevel(){return this._level}getNonMeleeSaveAbilityModifier(e){let t=e.get("SAVE_BY");return t?tC(this.getInt(t)??0):(E.error(`Non-melee ${e.get("NAME")} has no SAVE_BY set.`),0)}getCharacterPb(e){return this.isProficient(e)?this._proficiencyBonus:0}getAttacks(){return this._attacks}utiliseAdditionalTraits(e){this._availableArtefactTraits=e,this._refreshDerivedValues()}_refreshDerivedValues(e){this._allowRefreshDerived&&(!e||tO.includes(e))&&(this._adjustForExperience(),this._updateHitPoints(),this._initialiseEffectiveTraits(),"ENEMY"===this.get("TYPE_ID")?this._deriveValuesFromTraits():(this._utiliseTransientTraits(),this._utiliseMagicTraits(),this._utiliseWeaponsTraits(),this._utiliseArmourAndShieldTraits(),this._adjustMovementForArmour()))}_deriveValuesFromTraits(){this._maxTileMovePerTurn=this.getValueInFeetInTiles("SPEED",1),this._attacks=[];let e=new tN({damageDice:this._traits.get("DMG"),weaponType:"ALMANAC",proficiencyBonus:this.getInt("PB",0),abilityModifier:0,secondAttack:!1});this._attacks.push(e)}_initialiseEffectiveTraits(){this._effectiveTraits=new tP,tO.forEach(e=>{this._effectiveTraits.set(e,this.getInt(e,0))})}_utiliseTransientTraits(){this._transientFxTraits?.forEach(e=>{E.debug(`Transient traits: ${e.valuesToString()}`),this._addFxTraitsToEffectiveTraits(e)})}_addFxTraitsToEffectiveTraits(e){tO.forEach(t=>{let r=e.getInt(tD.toFxKey(t));r&&this._effectiveTraits.addInt(t,r,!0)})}_utiliseMagicTraits(){if(this?._availableArtefactTraits?.magic)for(let e of this._availableArtefactTraits.magic)E.debug(`Magic traits: ${e.valuesToString()}`),this._addFxTraitsToEffectiveTraits(e)}_utiliseArmourAndShieldTraits(){let e=this.getEffectiveInt("AC",0),t=this?._availableArtefactTraits?.armour,r=this?._availableArtefactTraits?.shields,i=0,a=0;t?.forEach(t=>{let r=this._getAcFromTraits(t);r.additional?i+=r.value:r.value>e&&(e=r.value)}),r?.forEach(e=>{a=Math.max(a,e.getInt("AC",0))});let n=e+i+a;this._effectiveTraits.set("AC",n)}_adjustMovementForArmour(){let e=this.getFloat("SPEED",1);if(this._maxTileMovePerTurn=Math.max(1,tP.feetToTiles(e)),this._availableArtefactTraits?.armour){for(let t of this._availableArtefactTraits.armour)if(t.get("TYPE","").toUpperCase().includes("HEAVY")&&t.getInt("STR",0)>this.getEffectiveInt("STR")){this._maxTileMovePerTurn=Math.max(0,tP.feetToTiles(e-10));return}}}_utiliseWeaponsTraits(){var e;let t,r,i,a,n;this._attacks=[];let s=this?._availableArtefactTraits?.weapons??[],o=tC(this.getEffectiveInt("STR",1)),l=(e=this.get("CLASS"),tS.get(e)??tS.get("DEFAULT")),h=this._proficiencyBonus*l.pbMultiplier;s.length>2&&E.error(`Unexpected number of equipped weapons. Expected 2; received ${s.length}`),0===s.length?(i="",r="UNARMED",a=!0):(i=s[0].get("DMG","1D1")??"1D1",r=s[0].get("TYPE")??"",a=this.isProficient(s[0])),t=new tN({damageDice:i,weaponType:r,proficiencyBonus:a?h:0,abilityModifier:o}),s.length>1&&(n=new tN({damageDice:s[1].get("DMG","1D1")??"1D1",weaponType:s[1].get("TYPE")??"",proficiencyBonus:this.isProficient(s[1])?h:0,abilityModifier:o})),n?.canUseTwoWeapons()&&t.canUseTwoWeapons()?(this._attacks.push(t),n.abilityModifier>0&&(n.abilityModifier=0),this._attacks.push(n)):n&&n.getMaxDamage()>t.getMaxDamage()?this._attacks.push(n):this._attacks.push(t)}_getAcFromTraits(e){let t=tC(this.getEffectiveInt("DEX",1)),r=e.get("TYPE","").toUpperCase(),i=e.get("AC",1),a=P(i);return r.includes("MEDIUM")?a+=Math.min(2,t):r.includes("HEAVY")||(a+=t),{additional:/^[+-]/.test(i),value:a}}_adjustForExperience(){let e=this._level??1,t=function(e){let t=P(e,0),r=0,i=0;do if(t>=tf[i++].exp)r=i;else break;while(i<tf.length)return{level:r,profBonus:tf[r-1].profBonus}}(this._traits.get("EXP"));this._level=t.level,this._proficiencyBonus=t.profBonus,this._adjustTraitsForLevelChange(e,this._level)}_adjustTraitsForLevelChange(e,t){var r;let i=(r=this.get("CLASS"),{levels:tw.get(r)??[],traits:tg.get(r)??tg.get("DEFAULT"),gainPerAdjustment:2,maxAbility:20});if(0===i.levels.length)return;let a=0;for(let r of i.levels){if(r>t)break;r>e&&(a+=i.gainPerAdjustment)}let n=0;for(;a>0&&n<i.traits.length;){let e=i.traits[n],t=this.get(e);t<i.maxAbility?(this.set(e,t+1),a--):n++}}adjustForDefeatOfActor(e){let t;let r=(t=v(e.get("CR")))<.124?10:t<.249?25:t<.499?50:t<.999?100:(t=Math.min(td.length-1,parseInt(t)),td[t]),i=this.getInt("EXP",0),a=i+r;E.info(`Experience increased from ${i} to ${a}.`),this.set("EXP",a);let n=this._level;return this._adjustForExperience(),{exp:{was:i,now:a},level:{was:n,now:this._level}}}isProficient(e){let t=this.get("PROF"),r="string"==typeof e?e:e.get("TYPE");if(!t||!r)return!1;for(let e of t){let t=e.split(" "),i=!0;for(let e of t)if(!r.includes(e)){i=!1;break}if(i)return!0}return!1}toJSON(){let e=super.toJSON();return e.reviver="CharacterTraits",e}static revive(e){return new tD(new Map(e))}}function tL(e="?"){if(e.len<2)return e;let t=e.replace(/_pv$/i,"").replace(/_/g," "),r=t.charAt(0).toUpperCase()+t.substring(1);return e8.getText(r)}function tM(e){let t=`DESCRIPTION ${e.toUpperCase()}`,r=e8.getText(t);return t===r?(E.error(`No description set for ${t}.`),""):r}function tb(e){return fetch(e).then(e=>e.text()).then(e=>e).catch(t=>(E.error(`Error fetching ${e}: ${t}`),null))}let t_={COMMON:"COMMON",UNCOMMON:"UNCOMMON",RARE:"RARE",VERY_RARE:"VERY_RARE"};class tz{static COMMON_CUTOFF=.7207207207207207;static UNCOMMON_CUTOFF=.9459459459459459;static RARE_CUTOFF=.990990990990991;static VERY_RARE_CUTOFF=1;common;uncommon;rare;veryRare;constructor(){this.common=[],this.uncommon=[],this.rare=[],this.veryRare=[]}mergeAlmanac(e){this.common.push(...e.common),this.uncommon.push(...e.uncommon),this.rare.push(...e.rare),this.veryRare.push(...e.veryRare)}find(e){let t=this.common.find(e);return t||(t=this.uncommon.find(e))||(t=this.rare.find(e))?t:this.veryRare.find(e)}filter(e){let t=new tz;return t.common=e?this.common.filter(e):[...this.common],t.uncommon=e?this.uncommon.filter(e):[...this.uncommon],t.rare=e?this.rare.filter(e):[...this.rare],t.veryRare=e?this.veryRare.filter(e):[...this.veryRare],t}getRandomEntry(){let e=Math.random();return e<tz.COMMON_CUTOFF?this.getRandomCommonEntry():e<tz.UNCOMMON_CUTOFF?this.getRandomUncommonEntry():e<tz.RARE_CUTOFF?this.getRandomRareEntry():this.getRandomVeryRareEntry()}getRandomCommonEntry(){return C(this.common)}getRandomUncommonEntry(){return 0===this.uncommon.length?this.getRandomCommonEntry():C(this.uncommon)}getRandomRareEntry(){return 0===this.rare.length?this.getRandomUncommonEntry():C(this.rare)}getRandomVeryRareEntry(){return 0===this.veryRare.length?this.getRandomRareEntry():C(this.veryRare)}}function tk(e,t){var r;let i=e.match(/^ *(\d+) *, *(\w+ ?\w+) *, *(\w+) *, *([\w+?/]*) *(?:\[ *([\w, ]*?)])? *\*(.*)$/);if(!i)return E.error(`Invalid almanac entry ${e}`),null;let a={},n=i[6]??"";a.minLevel=parseInt(i[1]),a.rarity=i[2].toUpperCase(),a.typeId=i[3],a.type=tG.getItemType(t,a.typeId),a.id=i[4];let s=function(e="?"){let t,r,i;let a=e.match(/^(\w+)([+?/])?(\w*)?$/);if(!a)return{};let n=a[1];switch(a[2]){case"?":t=n,r=e,i=n;break;case"+":t=n,r=n,i=void 0;break;case"/":t=a[3],r=a[3],i=void 0;break;default:t=e,r=e,i=void 0}return{name:tL(t),imageName:n.toLowerCase(),description:tM(r),unknownDescription:i?tM(i):void 0}}(a.id);return a.name=s.name,a.imageName=s.imageName,a.description=s.description,a.unknownDescription=s.unknownDescription,a.equipmentIds=(r=i[5])?r.trim().split(/\s*,\s*/):r,a.traitsString=`_TYPE_ID:${a.typeId},${n}`,a.challengeRating=function(e){let t=e?.match(/CR *[:=] *([\d.]+)/);return t?v(t[1],0):0}(a.traitsString),a}let tG=new class{#ez;constructor(){this.#ez=new Map}addAlmanac(e,t){this.#ez.set(e,t)}getAlmanac(e){let t=this.#ez.get(e);return t||E`Attempt to get non-existent almanac ${e}`,t}getRandomEntry(e,t){let r;r=Array.isArray(e)?C(e):e;let i=this.getAlmanac(r).filter(t);if(i)return i.getRandomEntry();E.error(`Failed to find almanac with key ${r}`)}findById(e,t){for(let r of(t||(t=this.#ez.keys()),t)){let t=this.#ez.get(r)?.find(t=>t.id===e);if(t)return t}E.error(`Failed to find almanac entry for '${e}' in ${t.join(", ")}`)}getPooledAlmanac(e,t){let r=new tz;return e.forEach(e=>{let i=this.getAlmanac(e).filter(t);r.mergeAlmanac(i)}),r}getItemType(e,t){switch(e){case"HEROES":case"ENEMIES":case"OBJECTIVES":case"TRADERS":return function(e){let t=ax[e];return null==t&&E.error(`Unrecognised actor type: ${e}`),t}(t);default:return function(e){let t=tH[e];return null==t&&E.error(`Unrecognised artefact type: ${e}`),t}(t)}}};function tB(e,t){let r,i;e.type===tH.SPELL?(r=t??new tv(e.traitsString),i="spell"):e.type===tH.CANTRIP?(r=t??new tv(e.traitsString),i="cantrip"):(r=t??new tP(e.traitsString),i=e.imageName),r.set("NAME",e.name);let a=function(e,t){let r=new tY(e,t.description,`${t.imageName}.png`,t.unknownDescription);return r.traits=t.traits,r}(e,{description:e.description,unknownDescription:e.unknownDescription,imageName:i,traits:r});return a.isTrap()?a.interaction=new aT(a):a.isMagic()?a.interaction=new aS(a):a.isConsumable()&&(a.interaction=new aw(a)),a}let tU={HEAD:{id:"HEAD",space:1,money:!1,spacesExpand:!1},BODY:{id:"BODY",space:1,money:!1,spacesExpand:!1},HANDS:{id:"HANDS",space:2,money:!1,spacesExpand:!1},FEET:{id:"FEET",space:2,money:!1,spacesExpand:!1},BACKPACK:{id:"BACKPACK",space:8,money:!1,spacesExpand:!0},WAGON:{id:"WAGON",space:8,money:!1,spacesExpand:!0},CANTRIPS:{id:"CANTRIPS",space:999,money:!1,spacesExpand:!0},RING_FINGERS:{id:"RING_FINGERS",space:2,money:!1,spacesExpand:!1},SPELLS:{id:"SPELLS",space:9,money:!1,spacesExpand:!0},PREPARED_SPELLS:{id:"PREPARED SPELLS",space:9,money:!1,spacesExpand:!0},PURSE:{id:"PURSE",space:Number.MAX_SAFE_INTEGER,money:!0,spacesExpand:!1}},tH={ARMOUR:{storageSpace:1,storeType:{stash:tU.WAGON,equip:tU.BODY}},CANTRIP:{storageSpace:1,storeType:{stash:null,equip:tU.CANTRIPS}},COINS:{storageSpace:0,storeType:{stash:tU.PURSE}},CONSUMABLE:{storageSpace:1,storeType:{stash:tU.BACKPACK}},GENERIC:{storageSpace:1,storeType:{stash:tU.BACKPACK}},HEAD_GEAR:{storageSpace:1,storeType:{stash:tU.BACKPACK,equip:tU.HEAD}},KEY:{storageSpace:1,storeType:{stash:tU.BACKPACK}},RING:{storageSpace:1,storeType:{stash:tU.BACKPACK,equip:tU.RING_FINGERS}},SHIELD:{storageSpace:1,storeType:{stash:tU.BACKPACK,equip:tU.HANDS}},SPELL:{storageSpace:1,storeType:{stash:tU.SPELLS,equip:tU.PREPARED_SPELLS}},TRAP:{storageSpace:1,storeType:{stash:tU.BACKPACK}},TWO_HANDED_WEAPON:{storageSpace:2,storeType:{stash:tU.BACKPACK,equip:tU.HANDS}},WEAPON:{storageSpace:1,storeType:{stash:tU.BACKPACK,equip:tU.HANDS}}};class tF{#ek;#eG;#eB;#eU;#eH;constructor(e,t,r){this.#ek=e,this.#eB=0,this.#eG=new Map,this.#eU=t,this.#eH=r}get storeTypeId(){return this.#eH.id}get storeType(){return this.#eH}get freeSpace(){return this.#ek-this.#eB}get maxSpace(){return this.#ek}adjustCapacity(e){return this.#ek=Math.max(e,this.#eB),this.#ek}isEmpty(){return 0===this.#eB}getRequiredSpace(e){return this.#eU?1:e.storageSpace}has(e){return this.#eG.has(e)}add(e){let t=this.#ek-this.#eB,r=this.getRequiredSpace(e);return t>=r&&(this.#eG.set(e,e),this.#eB+=r,!0)}take(e){let t=this.#eG.get(e),r=this.getRequiredSpace(e);return t&&(this.#eB-=r,this.#eG.delete(t)),t}getFirst(){return this.isEmpty()?null:this.#eG.values().next().value}takeFirst(){if(this.isEmpty())return null;let e=this.#eG.values().next().value;return this.take(e)}values(){return this.#eG.values()}canAdd(e){let t=this.getRequiredSpace(e);return this.#ek-this.#eB>=t}}class t${#eF;#e$;constructor(){this.#e$=!1}get storeType(){return tU.PURSE}get storeTypeId(){return tU.PURSE.id}isEmpty(){return!this.#eF||0===this.#eF.costInGp}has(e){return this.#eF.costInGp>0}add(e){let t=e.costDetails;if(!this.#eF)return this.#eF=e.clone(),!0;let r=this.#eF.costDetails;return this.#e$||(this.#eF=t$.createGoldCoinArtefact(r.valueGp),this.#e$=!0),this.#eF.costInGp=r.valueGp+t.valueGp,!0}take(e){let t=Math.min(this.#eF.costInGp,e.costInGp);return this.#eF.costInGp=this.#eF.costInGp-t,e.costInGp=t,e}canAdd(e){return!0}values(){return this.#eF&&0!==this.#eF.costInGp?[this.#eF.clone()].values():[].values()}static createGoldCoinArtefact(e){let t=tB(tk(`0,COMMON,COINS,gold_coins * VALUE:${e}GP`));return t.costInGp=e,t}}class tY{id;iconImageName;description;artefactType;traits;interaction;almanacEntry;unknown;constructor(e,t,r,i){this.id=e.id,this.description=t,this.iconImageName=r,this.artefactType=e.type,this.almanacEntry=e,this.unknownDescription=i,this.unknown=!!i}get costDetails(){return ta(this.traits?.get("VALUE"))}get costInGp(){return ta(this.traits?.get("VALUE")).valueGp}get sellBackPriceInGp(){return this.artefactType===tH.COINS?this.costInGp:Math.round(50*this.costInGp)/100}set costInGp(e){if(!this.traits)throw Error("Artefact has no traits so cannot set cost.");this.traits.set("VALUE",`${e.toFixed(2)} GP`)}get storageSpace(){return this.artefactType.storageSpace}get stashStoreType(){return this.artefactType.storeType.stash}get equipStoreType(){return this.artefactType.storeType.equip}get stashInWagon(){return this.stashStoreType===tU.WAGON}getDefaultStoreType(){return this.artefactType.storeType.stash??this.artefactType.storeType.equip}getStoreTypes(){let e=[];return this.artefactType.storeType.stash&&e.push(this.artefactType.storeType.stash),this.artefactType.storeType.equip&&e.push(this.artefactType.storeType.equip),e}clone(){let e=new tY(this.almanacEntry,this.description,this.iconImageName,this.unknownDescription);return e.traits=this.traits.clone(),e.value=this.value,e.unknown=this.unknown,e}isMagic(){return this.artefactType===tH.SPELL||this.artefactType===tH.CANTRIP}isTrap(){return this.artefactType===tH.TRAP}isUsable(){return!!this.interaction?.canReact()}isConsumable(){return this.artefactType===tH.CONSUMABLE}toJSON(){return{reviver:"Artefact",data:{almanacEntry:this.almanacEntry,traits:this.traits,unknown:this.unknown}}}static revive(e,t){let r=t(e.almanacEntry,e.traits);return r.unknown=e.unknown,r}}class tW{#eY;#eW;#eK;constructor(e,t){for(let t in this.#eY=new Map,this.#eW=e,tU){let e=tU[t];this.#eV(e)}this.#eK=t}get hasWagon(){return this.#eW}#eX(){this.#eK&&this.#eK()}#eV(e){if(e.money)return this.#eY.set(e,new t$(e.space,e.spacesExpand));let t=!0;this.#eW&&e===tU.BACKPACK?t=!1:this.#eW||e!==tU.WAGON||(t=!1),t&&this.#eY.set(e,new tF(e.space,e.spacesExpand,e))}getStore(e){return this.#eW&&e===tU.BACKPACK&&(e=tU.WAGON),this.#eY.get(e)}getStoreByTypeId(e){for(let t of this.#eY.values())if(t.storeTypeId===e)return t;return null}findSuitableStore(e){let t=e.stashStoreType,r=this.getStore(t);return(r||(t=e.equipStoreType,r=this.getStore(t)),r?.canAdd(e))?r:null}addArtefact(e){let t=this.getStore(e.getDefaultStoreType()),r=t?.add(e);return this.#eX(),r}getFirstStorageDetails(){for(let e of this.#eY.values()){let t=e.values(),r=t.next()?.value;if(r)return{store:e,artefact:r}}return null}hasArtefactWithSameId(e){let t="string"==typeof e?e:e.id;for(let e of this.getAllStorageDetails())if(e.artefact.id===t)return!0;return!1}hasArtefact(e){for(let t of this.getAllStorageDetails())if(t.artefact===e)return!0;return!1}getAllEquippedArtefacts(){let e=[];for(let t of[this.#eY.get(tU.HEAD),this.#eY.get(tU.BODY),this.#eY.get(tU.HANDS),this.#eY.get(tU.RING_FINGERS),this.#eY.get(tU.FEET),this.#eY.get(tU.CANTRIPS),this.#eY.get(tU.PREPARED_SPELLS)])for(let r of t.values())e.push(r);return e}getAllStorageDetails(){let e=[];return this.#eY.forEach(t=>{for(let r of t.values())e.push({store:t,artefact:r})}),e}getPurseValue(){let e=this.getStore(tU.PURSE).values(),t=e.next()?.value;return t?t.costInGp:0}addToPurse(e){let t=t$.createGoldCoinArtefact(e);this.#eY.get(tU.PURSE).add(t),this.#eX()}takeFromPurse(e){let t=t$.createGoldCoinArtefact(e),r=this.#eY.get(tU.PURSE).take(t);return this.#eX(),r.costInGp}getStoreContents(e){let t=this.getStore(e);return!t||t.isEmpty()?null:t.values()}discard(e){return!!this.discardStashed(e,!0)||this.discardEquipped(e)}discardEquipped(e,t){let r=this.getStore(e.equipStoreType);return r?r.take(e)?(this.#eX(),!0):(t||E.error("Artefact could not be found so not discarded."),!1):(t||E.error("Cannot discard artefact as there isn't an equip store."),!1)}discardStashed(e,t){let r=this.getStore(e.stashStoreType);return r?r.take(e)?(this.#eX(),!0):(t||E.error("Artefact could not be found so not discarded."),!1):(t||E.error("Cannot discard artefact as there isn't a stash store."),!1)}equip(e,t={}){let r=this.getStore(e.stashStoreType),i=this.getStore(e.equipStoreType);if(!r&&!t.direct)return E.error("Cannot equip artefact as there isn`t a stash store to take it from."),!1;if(!i)return E.error("Cannot equip artefact as there isn't an equip store."),!1;let a=e.storageSpace;if(a>i.maxSpace)return E.error("The equip store cannot hold this item."),!1;if(!r?.take(e)&&!t.direct)return E.error("Could not find artefact in the stash."),!1;for(;i.freeSpace<a;){let e=i.takeFirst();r?.add(e)}let n=i.add(e);return this.#eX(),n}stash(e,t={}){let r=this.getStore(e.stashStoreType),i=this.getStore(e.equipStoreType);if(!r)return E.debug("Cannot stash artefact as there isn`t a suitable stash store to put it in."),!1;if(!i&&!t.direct)return E.error("No suitable equip store found. If stashing a new artefact, the direct option should be set."),!1;if(e.storageSpace>r.freeSpace)return E.error("The stash store cannot hold this item."),!1;if(!i?.take(e)&&!t.direct)return E.error("The artefact hasn't been equipped so can't unequip it."),!1;let a=r.add(e);return this.#eX(),a}}function tK(e,t,r){return{centre:e[t]?.[r],tl:e[t-1]?.[r-1],above:e[t-1]?.[r],tr:e[t-1]?.[r+1],right:e[t]?.[r+1],br:e[t+1]?.[r+1],below:e[t+1]?.[r],bl:e[t+1]?.[r-1],left:e[t]?.[r-1]}}function tV(e){let t,r=e.length;for(;r>0;)t=Math.floor(Math.random()*r),r--,[e[r],e[t]]=[e[t],e[r]];return e}let tX={WALL:["#","*","|"],DOOR_IN:["-","~"],DOOR_OUT:["=",">"],GROUND:[".",":",",",";"],VOID:[" "]},tq={TOP_LEFT:"-TL",TOP_LEFT_INTERNAL:"-TLI",TOP:"-T",TOP_RIGHT:"-TR",TOP_RIGHT_INTERNAL:"-TRI",RIGHT:"-R",BOTTOM_RIGHT:"-BR",BOTTOM_RIGHT_INTERNAL:"-BRI",BOTTOM:"-B",BOTTOM_LEFT:"-BL",BOTTOM_LEFT_INTERNAL:"-BLI",LEFT:"-L",TOP_TEE:"-TTEE",RIGHT_TEE:"-RTEE",BOTTOM_TEE:"-BTEE",LEFT_TEE:"-LTEE",INTERNAL_CROSS:"-XI",INTERNAL_VERTICAL:"-VI",INTERNAL_HORIZONTAL:"-HI"},tj={BELOW_WALL:"-SBW",BELOW_END_WALL:"-SBE"};class tZ{matrix;entryPointByDoor;exitPointByDoor;constructor(){this.entryPointByDoor=new D(0,0),this.exitPointByDoor=new D(0,0)}static generateTileMapPlan(e,t){let r=new tZ,i=r.convertToMatrix(e);return i=r.clarifyMatrix(i),r.createPlan(i,t),r}convertToMatrix(e){let t=[],r=0;return e.forEach(e=>{r=Math.max(r,e.length)}),e.forEach(e=>{e.length<r&&(e+=" ".repeat(r-length)),t.push(e.split(""))}),t}clarifyMatrix(e){let t=[];return e.forEach((r,i)=>{let a=[];t.push(a),r.forEach((t,r)=>{var n,s,o,l;let h;let c=tK(e,i,r);(n=t,tX.VOID.includes(n))?t=" ":t4(t)?(s=t,t0(c.above)&&(t0(c.tl)?s+=tj.BELOW_WALL:s+=tj.BELOW_END_WALL),o=t=s,tJ(c.left)||tJ(c.above)||tJ(c.right)||tJ(c.below))?this.entryPointByDoor=new D(r,i):(tQ(c.right)||tQ(c.below)||tQ(c.left)||tQ(c.above))&&(this.exitPointByDoor=new D(r,i)):t0(t)&&(h=l=t,t0(c.above)&&t0(c.right)&&t0(c.below)&&t0(c.left)?h+=tq.INTERNAL_CROSS:t4(c.left)&&t4(c.right)?h+=tq.INTERNAL_VERTICAL:t4(c.above)&&t4(c.below)?h+=tq.INTERNAL_HORIZONTAL:t0(c.left)&&t0(c.right)&&t0(c.below)?h+=tq.TOP_TEE:t0(c.above)&&t0(c.below)&&t0(c.left)?h+=tq.RIGHT_TEE:t0(c.left)&&t0(c.right)&&t0(c.above)?h+=tq.BOTTOM_TEE:t0(c.above)&&t0(c.below)&&t0(c.right)?h+=tq.LEFT_TEE:t0(c.right)&&t0(c.below)?h+=t4(c.br)?tq.TOP_LEFT:tq.TOP_LEFT_INTERNAL:t0(c.left)&&t0(c.below)?h+=t4(c.bl)?tq.TOP_RIGHT:tq.TOP_RIGHT_INTERNAL:t0(c.left)&&t0(c.above)?h+=t4(c.tl)?tq.BOTTOM_RIGHT:tq.BOTTOM_RIGHT_INTERNAL:t0(c.right)&&t0(c.above)?h+=t4(c.tr)?tq.BOTTOM_LEFT:tq.BOTTOM_LEFT_INTERNAL:t0(c.above)&&t0(c.below)?h+=t4(c.right)?tq.LEFT:tq.RIGHT:t0(c.right)&&t0(c.left)&&(h+=t4(c.below)?tq.TOP:tq.BOTTOM),t=t0(c.above)?h+tj.BELOW_WALL:h),a.push(t)})}),t}createPlan(e,t){let r=[];e.forEach(e=>{let i=[];r.push(i),e.forEach(e=>{i.push(function e(t,r){if(" "===t)return null;let i=t.match(/(.)(-[^-]*)?(-[^-]*)?/),a=r.get(t);if(!a&&i[2]&&i[3]&&(a=r.get(`${i[1]}${i[2]}`)),!a&&i[2]&&(a=r.get(i[1])),!a){let a=function(e){for(let t in tX)if(tX[t].includes(e))return tX[t][0];return null}(i[1]);if(a&&a!==i[1]){var n,s;let t;return e((n=i[2],s=i[3],t=a,n&&(t+=n),s&&(t+=s),t),r)}E.error(`Failed to find symbol for ${t}`)}return a}(e,t))})}),this.matrix=r}}function tJ(e){return tX.DOOR_IN.includes(e)}function tQ(e){return tX.DOOR_OUT.includes(e)}function t4(e){return tX.GROUND.includes(e)}function t0(e){var t;return tX.WALL.includes(e)||tJ(t=e)||tQ(t)}class t1{#eq;#ej;#eZ;#eJ;setOnClick(e){this.#eq=e}setOnContextClick(e){this.#ej=e}setOnPointerDown(e){this.#eZ=e}setOnPointerUp(e){this.#eJ=e}actionClick(e){this.#eq?.(this,e)}actionContextClick(e){this.#ej?.(this,e)}actionPointerDown(e){this.#eZ?.(this,e)}actionPointerUp(e){this.#eJ?.(this,e)}}class t8{#eQ;#e4;constructor(e){this.#e4=e,this.#eQ=new Map}setRouteToCoords(e,t,r){this.#eQ.set(this.coordsToKey(t,r),e)}getRouteToCoords(e,t){return this.#eQ.get(this.coordsToKey(e,t))}hasRouteToCoords(e,t){return this.#eQ.has(this.coordsToKey(e,t))}coordsToKey(e,t){return`${e}|${t}`}keyToGridPoint(e){let t=e.split("|");return new D(parseInt(t[0]),parseInt(t[1]))}forEach(e){this.#eQ.forEach((t,r,i)=>e(t,r,i))}containsGridPoint(e){return this.#eQ.has(this.coordsToKey(e.x,e.y))}getWaypointsAsGridPoints(e){let t=this.getRouteToCoords(e.x,e.y);return t&&t.length>1?t.slice(1):null}getWaypointsAsWorldPoints(e){let t=this.getWaypointsAsGridPoints(e);return t?t.map(e=>this.#e4.gridPointToWorldPoint(e)):t}}class t3{actor;#eQ;#e4;#e0;constructor(e,t){this.#e4=e,this.actor=t}getDumbRouteNextTo(e,t,r){let i=this.#e1(e,t);if(i.coincident(e))return[];this.#e4.canGridPointBeOccupiedByActor(i,this.actor)||(i=this.#e8(i,t));let a=[],n=Math.sign(i.x-e.x),s=Math.sign(i.y-e.y),o=D.copy(e),l=.5>Math.random(),h=0;for(;r>0;){let t=D.copy(o),c=!1;if(l&&0!==n&&o.x!=i.x?(t.x+=n,c=!0):l||0===s||o.y==i.y||(t.y+=s,c=!0),c=c&&this.#e4.canGridPointBeOccupiedByActor(t,this.actor))h=0,o=t,r--;else{if(++h>=2)break;o.coincident(e)||a.push(this.#e4.gridPointToWorldPoint(o)),e=o,l=!l}}return o.coincident(e)||a.push(this.#e4.gridPointToWorldPoint(o)),a}getAllRoutesFrom(e,t){return this.#eQ=new t8(this.#e4),this.#e0=e,this.#e3(e.x,e.y,t,null),this.#eQ}#e3(e,t,r,i){if(i){if(e===this.#e0.x&&t===this.#e0.y||!this.#e2(e,t))return;let a=this.#eQ.getRouteToCoords(e,t);if(a&&!(i.length<a.length-1))return;i.push(new D(e,t)),this.#e5(e,t)&&this.#eQ.setRouteToCoords(i,e,t),r--}else i=[new D(e,t)];r>0&&(this.#e3(e,t-1,r,[...i]),this.#e3(e+1,t,r,[...i]),this.#e3(e,t+1,r,[...i]),this.#e3(e-1,t,r,[...i]))}#e2(e,t){return this.#e4.isGridPointPassableByActor(new D(e,t),this.actor)}#e5(e,t){return this.#e4.canGridPointBeOccupiedByActor(new D(e,t),this.actor)}#e1(e,t){let r=t.x-e.x,i=t.y-e.y,a=t.x,n=t.y;return Math.abs(r)>Math.abs(i)?a-=Math.sign(r):n-=Math.sign(i),new D(a,n)}#e8(e,t){return e.x===t.x&&e.y<t.y?new D(e.x+1,e.y+1):e.x>t.x&&e.y===t.y?new D(e.x-1,e.y+1):e.x===t.x&&e.y>t.y?new D(e.x-1,e.y-1):e.x<t.x&&e.y===t.y?new D(e.x+1,e.y-1):e}}class t2{#e6;#e9;#e4;#e7;#te;#tt;#tr;constructor(e,t){this.#e4=e,this.#e6=t}findReachedTiles(){return this.#e9=this.#e4.worldPointToGrid(this.#e6.position),this.#tt=this.#e4.getMapGridPointRect(),this.#te&&this.#te.coincident(this.#e9)&&this.#tt&&this.#tt.equals(this.#tr)||(this.#e7=new Map,this.#e7.set(this.#e9.toString(),this.#e9),this.#ti().forEach(e=>{this.#ta(e)}),this.#te=this.#e9,this.#tr=this.#tt),this.#e7}isGridPointInRays(e){return!!this.#e7&&this.#e7.has(e.toString())}#ti(){let e=[];for(let t=this.#tt.x;t<=this.#tt.x+this.#tt.width;t++)e.push(new D(t,this.#tt.y)),e.push(new D(t,this.#tt.y+this.#tt.height));for(let t=this.#tt.y+1;t<=this.#tt.y+this.#tt.height-1;t++)e.push(new D(this.#tt.x,t)),e.push(new D(this.#tt.x+this.#tt.width,t));return e}#ta(e){let t,r,i;let a=function(e){let t=Math.abs(e);return t<=A.DEG_22_5?R.E:t<=A.DEG_67_5?Math.sign(e)>0?R.NE:R.SE:t<=A.DEG_112_5?Math.sign(e)>0?R.N:R.S:t<=A.DEG_157_7?Math.sign(e)>0?R.NW:R.SW:R.W}(this.#e9.getScreenAngleTo(e));Math.abs(e.x-this.#e9.x)>=Math.abs(e.y-this.#e9.y)?(t=Math.sign(e.x-this.#e9.x),r=(i=Math.abs(e.x-this.#e9.x))<1?0:(e.y-this.#e9.y)/i):(r=Math.sign(e.y-this.#e9.y),t=(i=Math.abs(e.y-this.#e9.y))<1?0:(e.x-this.#e9.x)/i);let n=this.#e9.x,s=this.#e9.y,o=!0;for(;i>=0;){let e=new D(Math.round(n),Math.round(s));if(o||this.#e4.isSeeThrough(e,this.#e6))this.#tn(e,a);else break;o=!1,n+=t,s+=r,i--}}#tn(e,t){switch(this.#e7.set(e.toString(),e),t){case R.N:this.#ts(new D(e.x-1,e.y-1)),this.#ts(new D(e.x,e.y-1)),this.#ts(new D(e.x+1,e.y-1));break;case R.NE:this.#ts(new D(e.x,e.y-1)),this.#ts(new D(e.x+1,e.y-1)),this.#ts(new D(e.x+1,e.y));break;case R.E:this.#ts(new D(e.x+1,e.y-1)),this.#ts(new D(e.x+1,e.y)),this.#ts(new D(e.x+1,e.y+1));break;case R.SE:this.#ts(new D(e.x+1,e.y)),this.#ts(new D(e.x+1,e.y+1)),this.#ts(new D(e.x,e.y+1));break;case R.S:this.#ts(new D(e.x-1,e.y+1)),this.#ts(new D(e.x,e.y+1)),this.#ts(new D(e.x+1,e.y+1));break;case R.SW:this.#ts(new D(e.x-1,e.y)),this.#ts(new D(e.x-1,e.y+1)),this.#ts(new D(e.x,e.y+1));break;case R.W:this.#ts(new D(e.x-1,e.y-1)),this.#ts(new D(e.x-1,e.y)),this.#ts(new D(e.x-1,e.y+1));break;case R.NW:this.#ts(new D(e.x-1,e.y)),this.#ts(new D(e.x-1,e.y-1)),this.#ts(new D(e.x,e.y-1))}}#ts(e){this.#e4.isSeeThrough(e)||this.#e7.set(e.toString(),e)}}let t5={DOOR_HIGHLIGHT_FILL:"rgba(0, 255, 0, 0.2)",HP_GAUGE:"rgba(204, 51, 0, 0.4)",HP_TRANSIENT_TEXT_HERO:"white",HP_TRANSIENT_TEXT_ENEMY:"black",INTERACT_HIGHLIGHT_FILL:void 0,INTERACT_HIGHLIGHT_STROKE:"red",MOVE_HIGHLIGHT_FILL:void 0,MOVE_HIGHLIGHT_STROKE:"white"},t6={MOVEMENT_TILE:0,INTERACT_TILE:1,OCCUPIED_TILE:2,MOVE_OR_INTERACT_TILE:4},t9={OBSTACLE:-1,GROUND:0,ENTRANCE:1,EXIT:2};class t7 extends t1{sprite;obstacle;#to;#tl;#th;#tc;constructor(e,t){super(),this.sprite=e,this.#to=new Map,this.obstacle=t.obstacle,this.#tl=t.gridPoint,this.#th=t.worldPoint,this.#tc=t.role}get role(){return this.#tc}get gridPoint(){return this.#tl}get worldPoint(){return this.#th}addOccupant(e){this.#to.set(e,e)}deleteOccupant(e){this.#to.delete(e)}getOccupants(){return this.#to}actionClick(e){super.actionClick(this.sprite.position)}actionContextClick(e){super.actionClick(this.sprite.position)}isOccupied(){return this.#to.size>0}isPassableByActor(e){if(this.#tc===t9.ENTRANCE||this.#tc===t9.EXIT||this.obstacle)return!1;for(let t of this.#to.values())if(t!==e&&!t.isPassableByActor(e))return!1;return!0}canBeOccupiedByActor(e){if((this.#tc===t9.ENTRANCE||this.#tc===t9.EXIT)&&!e.isHero()||this.obstacle)return!1;for(let t of this.#to.values())if(t!==e&&!t.canShareLocationWithActor(e))return!1;return!0}isSeeThrough(e){return!this.obstacle&&this.#tc!==t9.ENTRANCE&&this.#tc!==t9.EXIT}}class re{#tu;#td;#tf;#tp;#tm;#I;#R;#tg;#tS;#tw;#tE;#tT;#ty;#tx;#tA;#tI;#tR;#tO;#tC;#tN;#tP;constructor(e,t,r,i){this.#tP=i;let a=t.matrix;if(this.#tA=t.entryPointByDoor,this.#tI=t.exitPointByDoor,this.#tu=e,this.#tw=new eD({renderer:new eC(e,{width:r,height:r,fillStyle:t5.MOVE_HIGHLIGHT_FILL,strokeStyle:t5.MOVE_HIGHLIGHT_STROKE})}),this.#tE=new eD({renderer:new eC(e,{width:r,height:r,fillStyle:t5.DOOR_HIGHLIGHT_FILL,strokeStyle:"green"})}),this.#tN=new eD({renderer:new eC(e,{width:r,height:r,fillStyle:t5.INTERACT_HIGHLIGHT_FILL,strokeStyle:t5.INTERACT_HIGHLIGHT_STROKE})}),this.#tm=r,this.#td=[],this.#tp=a.length,this.#tf=a[0].length,this.#I=r*this.tilesX,this.#R=r*this.tilesY,this.#tR=[],a.forEach((t,r)=>{let i=[];this.#td.push(i),t.forEach((t,a)=>{if(t){let n=new eD({renderer:new ev(e,eS.getSpriteBitmap(t.image))}),s=new D(a,r),o=this.gridPointToWorldPoint(s),l=new t7(n,{obstacle:t.role===t9.OBSTACLE,gridPoint:s,worldPoint:o,role:t.role});t.onClick&&l.setOnClick((e,r)=>this.#tv(e,r,t.onClick)),this.processTileRole(l),i.push(l),n.position.x=a*this.#tm+this.#tm/2,n.position.y=r*this.#tm+this.#tm/2}else i.push(null)})}),this.#ty||(E.error("No entrance has been set. Setting to the first ground tile"),this.#ty=this.#tR[0]),!this.#tx)throw Error("No exit tile.")}getDimsInTiles(){return{width:this.#tf,height:this.#tp}}processTileRole(e){switch(e.role){case t9.ENTRANCE:if(this.#ty){let t=e.gridPoint;E.error(`Duplicate entrance found at (${t.x}, ${t.y}). Ignored.`)}else this.#ty=e;break;case t9.EXIT:if(this.#tx){let t=e.gridPoint;E.error(`Duplicate exit found at (${t.x}, ${t.y}). Ignored.`)}else this.#tx=e;break;case t9.GROUND:e.gridPoint.coincident(this.#tA)||this.#tR.push(e)}}update(e){this.#tD();let t=this.getVisibleGridPointRect();for(let r=t.y;r<=t.y+t.height;r++)for(let i=t.x;i<=t.x+t.width;i++)if(this.#tO?.isGridPointInRays(new D(i,r))){let t=this.#td[r][i];t?.sprite.update(e)}}updateHighlights(e){this.#tL(e)}#tD(){if(this.#tP){this.#tO||(this.#tO=new t2(this,this.#tP));let e=this.getTileAtWorldPoint(this.#tP.position);if(e){let t=e.role;t!=t9.ENTRANCE&&t!=t9.EXIT&&this.#tO.findReachedTiles()}}}getMapGridPointRect(){return new _(0,0,this.#tf,this.#tp)}getVisibleGridPointRect(){let e=ei.getWorldInCanvasBounds(),t=this.worldPointToGrid(new D(e.x,e.y)),r=this.worldPointToGrid(new D(e.x+e.width,e.y+e.height)),i=Math.max(0,t.x),a=Math.min(this.#tf-1,r.x),n=Math.max(0,t.y);return new _(i,n,a-i,Math.min(this.#tp-1,r.y)-n)}getGridSize(){return this.#tm}getDimensions(){return{width:this.#I,height:this.#R}}getTileAtWorldPoint(e){let t=this.worldPointToGrid(e);return this.getTileAtGridPoint(t)}getTileAtGridPoint(e){if(!e)return null;let t=e.y,r=e.x;return r>=0&&t>=0&&r<this.#tf&&t<this.#tp?this.#td[t][r]:null}worldPointToGrid(e){return new D(Math.floor(e.x/this.#tm),Math.floor(e.y/this.#tm))}gridAlignedWorldPoint(e){let t=this.worldPointToGrid(e);return this.gridPointToWorldPoint(t)}gridPointToWorldPoint(e){let t=.5*this.#tm;return new D(e.x*this.#tm+t,e.y*this.#tm+t)}getWorldPositionOfTileByEntry(){return this.gridPointToWorldPoint(this.#tA)}getGridPositionOfEntrance(){return this.#ty.gridPoint}setMovementRoutes(e){this.#tg=e,e?(this.#tS=new Map,this.#tg.forEach(e=>e.forEach(e=>{this.#tS.set(e,e)}))):this.#tS=null}setInteractActors(e){this.#tC=[],e?.forEach(e=>{e.interaction.canReact()&&this.#tC.push(this.worldPointToGrid(e.position))})}calcReachableDoors(e){this.#tT=[];let t=this.getSurroundingTiles(this.worldPointToGrid(e));[t.above,t.right,t.below,t.left].forEach(e=>{e.gridPoint.coincident(this.#tx.gridPoint)?this.#tT.push(e.gridPoint):e.gridPoint.coincident(this.#ty.gridPoint)&&this.#tT.push(e.gridPoint)})}#tL(e){this.#tM(e),this.#tb(e),this.#t_(e)}#tM(e){this.#tS?.forEach(t=>{this.#tw.position=this.gridPointToWorldPoint(t),this.#tw.update(e)})}#tb(e){this.#tC?.forEach(t=>{this.#tN.position=this.gridPointToWorldPoint(t),this.#tN.update(e)})}#t_(e){this.#tT?.forEach(t=>{this.#tE.position=this.gridPointToWorldPoint(t),this.#tE.update(e)})}#tv(e,t,r){let i;let a=this.worldPointToGrid(t),n=e.getOccupants();n.size>0&&(i=n.values().next().value);let s=this.#tg?.containsGridPoint(a),o=!1;if(this.#tC){for(let e of this.#tC)if(e.isCoincident(a)){o=!0;break}}let l=!i?.alive&&i?.isProp();if(s&&o||o&&l){r(e,t,{filter:t6.MOVE_OR_INTERACT_TILE,occupant:i});return}if(s){r(e,t,{filter:t6.MOVEMENT_TILE,occupant:i});return}if(o){r(e,t,{filter:t6.INTERACT_TILE,occupant:i});return}if(this.#tT){for(let i of this.#tT)if(i.isCoincident(a)){r(e,t,{filter:t6.INTERACT_TILE});return}}let h=this.worldPointToGrid(this.#tP.position);if(a.coincident(h)){r(e,t,{occupant:this.#tP,filter:t6.OCCUPIED_TILE});return}i&&r(e,t,{occupant:i,filter:t6.OCCUPIED_TILE}),E.debug("Ignore click outside of highlighted area")}getWaypointsToWorldPoint(e){let t=this.worldPointToGrid(e);return this.#tg?.getWaypointsAsWorldPoints(t)}getRandomFreeGroundTile(){for(let e of(tV(this.#tR),this.#tR))if(!e.isOccupied())return e;return null}isGridPointPassableByActor(e,t){let r=this.getTileAtGridPoint(e);return!!r&&r.isPassableByActor(t)}canGridPointBeOccupiedByActor(e,t){let r=this.getTileAtGridPoint(e);return!!r&&r.canBeOccupiedByActor(t)}canHeroSeeGridPoint(e){return this.#tO?.isGridPointInRays(e)??!0}isSeeThrough(e,t){let r=this.getTileAtGridPoint(e);return!r||r.isSeeThrough(t)}getSurroundingTiles(e){return tK(this.#td,e.y,e.x)}getRadiatingUpAndDown(e,t=1){return function(e,t){let r;let i=t.columnIndex,a=t.rowIndex,n=[],s=!0,o=!0,l=!0,h=!0,c=1,u=t.distance??1;for(;u-- >0;)h&&(r=e[a][i-c],t.filter&&!t.filter(r)?h=!1:n.push(r)),o&&(r=e[a][i+c],t.filter&&!t.filter(r)?o=!1:n.push(r)),s&&(r=e[a-c][i],t.filter&&!t.filter(r)?s=!1:n.push(r)),l&&(r=e[a+c][i],t.filter&&!t.filter(r)?l=!1:n.push(r)),c++;return n}(this.#td,{rowIndex:e.y,columnIndex:e.x,distance:t,filter:e=>e.role===t9.GROUND})}deleteOccupancyOfGridPoint(e,t){this.getTileAtGridPoint(t)?.deleteOccupant(e)}moveTileOccupancyGridPoint(e,t,r){r!==t&&(this.getTileAtGridPoint(t)?.deleteOccupant(e),this.getTileAtGridPoint(r)?.addOccupant(e))}getCoincidentActors(e){return this.getTileAtWorldPoint(e.position).getOccupants()}getParticipants(e){let t=[],r=this.getSurroundingTiles(this.worldPointToGrid(e.position));return[r.above,r.right,r.below,r.left].forEach(e=>{let r=e?.getOccupants();r?.forEach(e=>{t.push(e)})}),t}}let rt=[{id:"MUSIC_VOLUME",labelKey:"CONTROL MUSIC VOLUME",defValue:50,controlType:eQ.RANGE,persistent:!0,action:null,onChange:e=>tt.setMusicVolumePercent(e)},{id:"EFFECTS_VOLUME",labelKey:"CONTROL EFFECTS VOLUME",defValue:50,controlType:eQ.RANGE,persistent:!0,action:null,onChange:e=>{tt.setEffectsVolumePercent(e),tt.playEffect("PUNCH")}},{id:"SHOW_QUICK_TIPS_AT_START",labelKey:"CONTROL SHOW QUICK TIPS",defValue:!0,controlType:eQ.CHECKBOX,persistent:!0,action:null,onChange:null},{id:"START_IN_FULLSCREEN",labelKey:"CONTROL START IN FULLSCREEN",defValue:!1,controlType:eQ.CHECKBOX,persistent:!0,action:null,onChange:null},{id:"SHOW_DEBUG_LOG",labelKey:"BUTTON SHOW DEBUG LOG",defValue:!0,controlType:eQ.TEXT_BUTTON,persistent:!1,action:()=>(function(){E.getMessages();let e="";for(let t of E.getMessages())e+=t+"\n";return te.showOkDialog(e,{title:e1`DIALOG TITLE DEBUG LOG`,className:"wall"})})(),onChange:null}];function rr(){let e=[];return rt.forEach(t=>{e.push(function(e){let t;switch(e.controlType){case eQ.CHECKBOX:t=new eZ(e);break;case eQ.RANGE:t=new eJ(e);break;case eQ.TEXT_BUTTON:t=new eX(e);break;default:throw Error(`Attempt to create unrecognised control type ${e.controlType}`)}return t}(t))}),te.showControlsDialog(e1`DIALOG TITLE SETTINGS`,{actionButtons:e,className:"door"})}let ri={DEAD:{keyName:"DEAD",suffix:"dead",options:{framePeriodMs:100,loopMethod:eT.STOP}},IDLE:{keyName:"IDLE",suffix:"idle",options:{framePeriodMs:300,loopMethod:eT.REVERSE}},WALK_NORTH:{keyName:"WALK_N",suffix:"walk-n",options:{framePeriodMs:100,loopMethod:eT.REVERSE}},WALK_EAST:{keyName:"WALK_E",suffix:"walk-e",options:{framePeriodMs:100,loopMethod:eT.REVERSE}},WALK_SOUTH:{keyName:"WALK_S",suffix:"walk-s",options:{framePeriodMs:100,loopMethod:eT.REVERSE}},WALK_WEST:{keyName:"WALK_W",suffix:"walk-w",options:{framePeriodMs:100,loopMethod:eT.REVERSE}}},ra={DEAD:{keyName:"DEAD",suffix:"dead",options:{framePeriodMs:100,loopMethod:eT.STOP}},IDLE:{keyName:"IDLE",suffix:"idle",options:{framePeriodMs:300,loopMethod:eT.REVERSE}}};class rn{#tz;constructor(e){this.#tz=e}#tk(e,t){let r=this.#tz[e]?.suffix;if(!r)throw Error(`Attempt made to use invalid standard animation key of '${e}'`);return`${t}-${r}`}getKeyName(e){return this.#tz[e].keyName}getDefaultImageName(e){return`${this.#tk("IDLE",e)}00.png`}getFallbackKey(){return this.getKeyName("IDLE")}addAllToKeyedAnimation(e,t){for(let r in this.#tz){let i=this.#tz[r];e.addAnimatedImage(this.#tz[r].keyName,new eA({prefix:this.#tk(r,t),suffix:".png",startIndex:0,padding:2},i.options))}e.setCurrentKey(this.#tz.IDLE.keyName)}}let rs={peripatetic:new rn(ri),artefact:new rn(ra)},ro=["a","e","i","o","u","ee","oo"],rl=["b","br","ch","chr","cl","cr","d","dr","fl","fr","g","gl","gr","h","j","k","kr","kl","l","m","n","p","pl","pr","qu","r","s","sch","sh","st","t","th","tr","v","w","y","z"],rh=["b","bbey","bble","bboy","bby","c","ch","ck","cky","ct","d","f","ff","ffle","ffy","ffey","g","ge","gey","gle","k","l","ll","lly","lley","m","n","ngle","nny","p","r","s","sk","ss","ssy","st","sty","t","th","thy","v","w","y","z","zzle","zzy"];function rc(){let e;return(e=.5>Math.random()?C(rl)+C(ro)+C(rh):C(rl)+C(ro)+C(rl)+C(ro)+C(rh)).charAt(0).toUpperCase()+e.substring(1)}class ru extends eP{actor;constructor(e,t){super(e,t)}render(e){if(this.actor&&this.actor.traits){let e=this.actor.traits.getInt("HP",0),t=this.actor.traits.getInt("HP_MAX",1);this.setLevel(0,e/t)}super.render(e)}}class rd extends eI{#e6;#tG;#tB;#tU;#tH;constructor(e,t){super(e,t),this.#tG=R.NONE,this.#tU=t,this.#tH=0}setActor(e){this.#e6=e,this.#tB=this.#e6.alive}setFallbackKey(e){this.#tU=this.getAnimatedImage(e),this.#tU?.getCurrentFrame()||E.error(`Fallback key ${e} has no image.`)}getCurrentFrame(){let e=this.#tF();(e!==this.#tG||this.#tB!=this.#e6?.alive)&&(this.#tG=e,this.#tB=this.#e6?.alive,this.#t$());let t=super.getCurrentFrame()??this.#tU?.getCurrentFrame()??{bitmap:eS.getUndefinedBitmap(),rotation:0,flip:ex.NONE};return t.rotation=this.#tH,t}#tF(){return!this.#e6||this.#e6.velocity.isZero(.1)?R.NONE:function(e){let t=Math.abs(e);return t<=A.DEG_45?R.E:t<=A.DEG_135?Math.sign(e)>0?R.N:R.S:R.W}(this.#e6.velocity.getScreenDirection())}#t$(){return this.#e6.alive?this.#tG===R.NONE?this.setCurrentKey(rs.peripatetic.getKeyName("IDLE")):this.#tY():this.setCurrentKey(rs.peripatetic.getKeyName("DEAD"))}#tY(){let e=this.#e6.disengaging;switch(this.#tG){case R.NONE:this.setCurrentKey(rs.peripatetic.getKeyName("IDLE"));break;case R.E:this.setCurrentKey(rs.peripatetic.getKeyName(e?"WALK_WEST":"WALK_EAST"));break;case R.N:case R.NW:case R.NE:this.setCurrentKey(rs.peripatetic.getKeyName(e?"WALK_SOUTH":"WALK_NORTH"));break;case R.W:this.setCurrentKey(rs.peripatetic.getKeyName(e?"WALK_EAST":"WALK_WEST"));break;default:this.setCurrentKey(rs.peripatetic.getKeyName(e?"WALK_NORTH":"WALK_SOUTH"))}}}function rf(e,t,r,i){let a;let n=function(e){let t=new rd;return rs.peripatetic.addAllToKeyedAnimation(t,e),t.setFallbackKey(rs.peripatetic.getFallbackKey()),t}(e),s=new ev(ei.getContext2D(),n),o=new aR(new eD({renderer:r.get("MOVE")!==aI.ORGANIC?[a=new ru(ei.getContext2D(),{tileSize:eY.TILE_SIZE-2,fillStyles:[t5.HP_GAUGE],strokeStyles:[]}),s]:[s]}),i.type);return n.setActor(o),a&&(a.actor=o),o.position=new b(eY.TILE_SIZE,eY.TILE_SIZE,0),o.almanacEntry=i,o.traits=r,o.velocity={x:0,y:0,rotation:0},o.iconImageName=t?`${t}.png`:rs.peripatetic.getDefaultImageName(e),/\w+_pv/.test(e)&&o.sprite.replaceBaseModifier(ez.createUprightAligner()),o}function rp(e,t){let r;let i=t??new tD(e.traitsString);switch(i.get("NAME")||i.set("NAME",e.name),e.type){case ax.HERO:(r=rf(e.imageName,null,i,e)).type=ax.HERO,t||(i.set("NAME",`${rc()} ${rc()}`),tE(i)),r.toxify=new ag;break;case ax.OBJECTIVE:r=function(e,t,r,i){let a=rf(e,null,r,i);return a.interaction=new ay(a),a}(e.imageName,0,i,e);break;case ax.TRADER:r=function(e,t,r,i){let a=rf(e,null,r,i);return a.interaction=new af(a),a}(e.imageName,0,i,e);break;case ax.HIDDEN_ARTEFACT:r=function(e,t,r){let i=function(e){let t=new rd;return rs.artefact.addAllToKeyedAnimation(t,e),t.setFallbackKey(rs.artefact.getFallbackKey()),t}(e),a=new aR(new eD({renderer:[new ev(ei.getContext2D(),i)]}),"SPELL"===r.type?ax.PROP:ax.HIDDEN_ARTEFACT);return i.setActor(a),a.position=new b(eY.TILE_SIZE,eY.TILE_SIZE,0),a.velocity={x:0,y:0,rotation:0},a.interaction=new ap(a),a.iconImageName=`${e}.png`,a.traits=new tD,a}(e.imageName,0,i,e);break;case ax.PROP:r=function(e,t,r,i){let a=rf(e,null,r,i);return a.interaction=new ap(a),a}(e.imageName,0,i,e);break;default:r=function(e,t,r,i){let a=rf(e,null,r,i);return a.isOrganic()?(a.interaction=new am(a),a.obstacle=!1):a.interaction=new au(a),a}(e.imageName,0,i,e)}return r.description=e.description,!t&&e.equipmentIds&&function(e,t){if(t&&0!==t.length)for(let r of t){let t=tG.findById(r,["MONEY","WEAPONS","ARMOUR","MAGIC","ARTEFACTS"]);if(t){let r=tB(t);r.equipStoreType?e.storeManager.equip(r,{direct:!0}):e.storeManager.stash(r,{direct:!0})}else E.error(`Cannot find ${r} artefact in almanac to equip actor.`)}}(r,e.equipmentIds),r}class rm{#tW;#tK;constructor(e=0,t=0){this.#tK=e,this.#tW=t}getChangeInHpThisTurn(){let e=this.#tK+this.#tW,t=Math.floor(e);return this.#tW=e-t,t}addToxicEffect(e){this.#tK+=e}cure(){this.#tK=0,this.#tW=0}get isActive(){return 0!==this.#tK||0!==this.#tW}toJSON(){return{reviver:"Toxin",data:{pendingHpChange:this.#tW,hpPerTurn:this.#tK}}}static revive(e){return new rm(e.hpPerTurn,e.pendingHpChange)}}function rg(e){return 0===e?"1":`B${e}`}class rS{#tV;#tX;#tq;#tj;constructor(e,t={}){this.#tX=e??[],this.#tV=t?.maxLength??10,this.#tq=t.sortFn,this.#tj=t.equalFn??((e,t)=>e==t)}add(e){let t=this.indexOfEqual(e);if(t>=0){let r=this.#tX[t];if(!(0>this.#tq(e,r)))return t;this.#tX[t]=e}else this.#tX.push(e);return this.#tX.sort(this.#tq),this.#tX.length>this.#tV&&this.#tX.pop(),this.#tX.indexOf(e)}indexOfEqual(e){for(let t=0;t<this.#tX.length;t++)if(this.#tj(e,this.#tX[t]))return t;return -1}getCurrentData(){return[...this.#tX]}getMaxLength(){return this.#tV}}let rw="LEADERBOARD_DATA";function rE(){return new rS(eK.get(rw),{maxLength:10,sortFn:(e,t)=>e.score>t.score?-1:1,equalFn:(e,t)=>e.adventureStartTime===t.adventureStartTime&&e.name===t.name})}function rT(e,t=!1){let r=function(e){let t=rE(),r=t.add(e);return r>=0&&eK.set(rw,t.getCurrentData()),r}(function(e,t){let r={adventureStartTime:0,name:"unknown",class:"unknown",gold:0,exp:0,characterLevel:0,dungeonFloor:0,score:0,completed:!1};return e&&(r.adventureStartTime=e.adventureStartTime,r.name=e.traits.get("NAME"),r.class=e.traits.get("CLASS"),r.gold=e.storeManager.getPurseValue(),r.exp=e.traits.getInt("EXP",0),r.characterLevel=e.traits.getCharacterLevel(),r.dungeonFloor=rg(iJ.getCurrentSceneLevel()),r.score=Math.floor(100*r.gold*r.characterLevel),r.completed=t),r}(e,t)),i={sceneLevel:iJ.getCurrentSceneLevel(),hero:e,completed:t};return eK.set("GAME_STATE",i),r}function ry(e,t){switch(t?.reviver){case"Actor":return aR.revive(t.data,rp);case"Toxin":return rm.revive(t.data);case"Artefact":return tY.revive(t.data,tB);case"Traits":return tP.revive(t.data);case"CharacterTraits":return tD.revive(t.data);case"MagicTraits":return tv.revive(t.data);default:return t}}class rx{#tZ=new Map;constructor(){}clear(){this.#tZ.clear()}#tJ(e){return window.btoa(function(e){try{return encodeURIComponent(e)}catch(t){return console.error(t),encodeURIComponent(e.toWellFormed())}}(e)).replace(/=/g,":")}protect(e){if(!e)return e;let t=`???${this.#tZ.size}${this.#tJ(e)}???`;return this.#tZ.set(t,e),t}retrieve(e){let t=this.#tZ.get(e);return(this.#tZ.delete(e),t)?t:(console.error(`Could not find ${e} in protected data.`),e)}reinstate(e){return e.replace(/[?]{3}\d+[a-zA-Z0-9+/]+:{0,2}[?]{3}/g,e=>this.retrieve(e))}}let rA=new rx;function rI(e,t){return`<span class="printable-link for-print-only">${t?"(":""}${e}${t?")":""}</span>`}let rR=[{re:/(?:(.+)\n=+\n)/g,rep:"\n\n<h1>$1</h1>\n\n"},{re:/(?:(.+)\n-+\n)/g,rep:"\n\n<h2>$1</h2>\n\n"},{re:/^(#+)(?: *)(.+?)(?:#*)[ \t]*$/gm,rep:(e,t,r)=>{let i=Math.min(t.length,6);return`

<h${i}>${r.trim()}</h${i}>
`}},rM(">[ 	]*",{blockPrefix:"<blockquote>",blockSuffix:"</blockquote>"}),rM("(?: {4}|	)",{blockPrefix:"<pre><code>",blockSuffix:"</code></pre>",trimContents:!0,useWarden:!0}),{re:/^(?:[*_-] *){3,}\s*$/gm,rep:"\n\n<hr>\n\n"},rM(" {0,3}[*+-][ 	]+",{blockPrefix:"<ul>",blockSuffix:"</ul>",linePrefix:"<li>",lineSuffix:"</li>"}),rM(" {0,3}\\d+\\.[ 	]+",{blockPrefix:"<ol>",blockSuffix:"</ol>",linePrefix:"<li>",lineSuffix:"</li>"})],rO=[{re:/(?:(?:^|\n{2,})(?!<\w+>))((?:.(?:\n(?!\n))?)+)/g,rep:"\n\n<p>$1</p>\n\n"},{re:/\n{2,}/g,rep:"\n\n"}],rC=[{re:/!(&lt;)?\[(.*?)\]\((https?:\/\/[-\w@:%.+~#=/]+?)(?: +"(.*?)")?\)/gm,rep:(e,t,r,i,a)=>{let n=`<img alt="${r??""}" class="${t?"floatable":""}" src="${i}" title="${a??""}"/>`;return rA.protect(n)}},{re:/\[(.*?)\]\((https?:\/\/[-\w@:%.+~#=/]+?)(?: +"(.*?)")?\)/gm,rep:(e,t,r,i)=>{var a;let n;a=t,n="",/^https:\/\/vimeo.com\//.test(r)?n='<i class="fa-brands fa-vimeo"></i>':/^https:\/\/(www\.)?youtube.com\//.test(r)&&(n='<i class="fa-brands fa-youtube"></i>'),n&&(n=`<span class='link-icon'>${n}</span>`),t=`${a}${n}`;let s=`<a target="_blank" href="${r}" title="${i??""}">${t??""}</a>${rI(r,!0)}`;return rA.protect(s)}},{re:/(?:&lt;|<)(https?:\/\/[-\w@:%.+~#=/]+?)>/gm,rep:(e,t)=>{let r=`<a target="_blank" href="${t}">${t}</a>${rI(t,!0)}`;return rA.protect(r)}},{re:/(?:&lt;|<)([\w.-]+@(?:[\w-]+\.)+[\w-]+)/gm,rep:(e,t)=>{let r=function(e){let t="";for(let r of e)t+=rb(r);return t}(t),i=`<a href="${r}">${r}</a>`;return rA.protect(i)}},{re:/(?:`{2,}(.*?)`{2,}|`(.*?)`)/gm,rep:(e,t,r)=>{let i=`<code>${t??r}</code>`;return rA.protect(i)}},{re:/\*\*([^\s])\*\*/gm,rep:"<strong>$1</strong>"},{re:/__([^\s])__/gm,rep:"<strong>$1</strong>"},{re:/\*([^\s])\*/gm,rep:"<em>$1</em>"},{re:/_([^\s])_/gm,rep:"<em>$1</em>"},{re:/\*\*([^\s])(.*?)([^\s])\*\*/gm,rep:"<strong>$1$2$3</strong>"},{re:/__([^\s])(.*?)([^\s])__/gm,rep:"<strong>$1$2$3</strong>"},{re:/\*([^\s])(.*?)([^\s])\*/gm,rep:"<em>$1$2$3</em>"},{re:/_([^\s])(.*?)([^\s])_/gm,rep:"<em>$1$2$3</em>"}],rN=[{re:/\\([\\`*_{}[\]()#+.!-])/g,rep:(e,t)=>rb(t)}],rP=[{re:"\x00",rep:"ï¿½"}],rv=[{re:/&(?![\w#]+?;)/gm,rep:"&amp;"},{re:/<(?!\/?(?:br|sub|sup)>)/gim,rep:"&lt;"}],rD=[{re:/^\s*$/gm,rep:""},{re:/<(?:p|div)>\s*?<\/(?:p|div)>/gim,rep:""}];function rL(e,t){return e&&t.forEach(t=>{e=e.replaceAll(t.re,t.rep)}),e}function rM(e,t){let r=RegExp(`(?:^|\\n)${e}(?:.|\\n)*?(?:(\\n(?!${e}))|$)`,"g"),i=RegExp(`^${e}([ \\t]*.*)$`,"gm"),a=`${t?.linePrefix??""}$1${t?.lineSuffix??""}`;return{re:r,rep:e=>{let r=e.replaceAll(i,a);return t.trimContents&&(r=r.replace(/^[\n\r]*/,"").trimEnd()),t.useWarden&&(r=rA.protect(r)),`

${t?.blockPrefix??""}${r}${t?.blockSuffix??""}

`}}}function rb(e){return`&#${e.charCodeAt(0).toString()};`}var r_={};r_=JSON.parse('{"frames":[{"filename":"acid00.png","frame":{"x":99,"y":1,"w":49,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"amber.png","frame":{"x":94,"y":240,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"aquamarine.png","frame":{"x":101,"y":1330,"w":42,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":42,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"arcane_orb.png","frame":{"x":192,"y":196,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":2,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"axe.png","frame":{"x":454,"y":1,"w":42,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":42,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"barbarian1-dead00.png","frame":{"x":418,"y":516,"w":47,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":11,"w":47,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-idle00.png","frame":{"x":99,"y":438,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-idle01.png","frame":{"x":52,"y":288,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-e00.png","frame":{"x":101,"y":884,"w":41,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":41,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-e01.png","frame":{"x":51,"y":338,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-e02.png","frame":{"x":101,"y":934,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-e03.png","frame":{"x":145,"y":784,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-n00.png","frame":{"x":149,"y":51,"w":48,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-n01.png","frame":{"x":1,"y":389,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-n02.png","frame":{"x":199,"y":51,"w":48,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-n03.png","frame":{"x":99,"y":288,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-s00.png","frame":{"x":99,"y":487,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-s01.png","frame":{"x":99,"y":388,"w":44,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":44,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-s02.png","frame":{"x":100,"y":686,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-s03.png","frame":{"x":51,"y":388,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-w00.png","frame":{"x":145,"y":834,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-w01.png","frame":{"x":101,"y":784,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":42,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-w02.png","frame":{"x":144,"y":1134,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-w03.png","frame":{"x":186,"y":1328,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"berserker-dead00.png","frame":{"x":97,"y":149,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"berserker-idle00.png","frame":{"x":193,"y":340,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"berserker-idle01.png","frame":{"x":51,"y":438,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"black_flask.png","frame":{"x":145,"y":388,"w":28,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":28,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"blank.png","frame":{"x":175,"y":483,"w":3,"h":3},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":3,"h":3},"sourceSize":{"w":48,"h":49}},{"filename":"block.png","frame":{"x":354,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"blood-splat-twice.png","frame":{"x":1,"y":1,"w":96,"h":94},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":96,"h":94},"sourceSize":{"w":96,"h":96}},{"filename":"blood-splat.png","frame":{"x":1,"y":97,"w":94,"h":92},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":94,"h":92},"sourceSize":{"w":96,"h":96}},{"filename":"blue_flask.png","frame":{"x":145,"y":438,"w":28,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":28,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"bugbear-dead00.png","frame":{"x":368,"y":562,"w":48,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":8,"w":48,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"bugbear-idle00.png","frame":{"x":51,"y":488,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"bugbear-idle01.png","frame":{"x":193,"y":244,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cantrip.png","frame":{"x":144,"y":1184,"w":44,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"chain_mail_armour.png","frame":{"x":285,"y":723,"w":42,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":42,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-dead00.png","frame":{"x":418,"y":551,"w":47,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":12,"w":47,"h":31},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-idle00.png","frame":{"x":193,"y":292,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-idle01.png","frame":{"x":449,"y":52,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-e00.png","frame":{"x":237,"y":676,"w":42,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":42,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-e01.png","frame":{"x":242,"y":244,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":2,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-e02.png","frame":{"x":325,"y":627,"w":41,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":3,"w":41,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-e03.png","frame":{"x":329,"y":724,"w":38,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":4,"w":38,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-n00.png","frame":{"x":242,"y":292,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-n01.png","frame":{"x":51,"y":538,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-n02.png","frame":{"x":340,"y":198,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-n03.png","frame":{"x":100,"y":735,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":45,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-s00.png","frame":{"x":145,"y":1232,"w":45,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":45,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-s01.png","frame":{"x":291,"y":246,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-s02.png","frame":{"x":145,"y":1280,"w":45,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":45,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-s03.png","frame":{"x":1,"y":439,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-w00.png","frame":{"x":184,"y":934,"w":40,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":40,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-w01.png","frame":{"x":100,"y":536,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-w02.png","frame":{"x":184,"y":981,"w":40,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":40,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-w03.png","frame":{"x":329,"y":770,"w":38,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":38,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"club.png","frame":{"x":1,"y":288,"w":49,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"coins.png","frame":{"x":150,"y":1,"w":49,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"copper_coins.png","frame":{"x":199,"y":1378,"w":45,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":45,"h":45},"sourceSize":{"w":49,"h":48}},{"filename":"copper_dragon_wyrmling-dead00.png","frame":{"x":418,"y":584,"w":48,"h":37},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":37},"sourceSize":{"w":48,"h":48}},{"filename":"copper_dragon_wyrmling-idle00.png","frame":{"x":147,"y":149,"w":48,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":48,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"copper_dragon_wyrmling-idle01.png","frame":{"x":197,"y":150,"w":48,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":48,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"dagger.png","frame":{"x":314,"y":908,"w":40,"h":35},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":7,"w":40,"h":35},"sourceSize":{"w":49,"h":48}},{"filename":"diamond.png","frame":{"x":145,"y":638,"w":42,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":42,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"door-B.png","frame":{"x":404,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-L.png","frame":{"x":145,"y":488,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-R.png","frame":{"x":145,"y":538,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-T.png","frame":{"x":1,"y":489,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door2-B.png","frame":{"x":1,"y":539,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door2-T.png","frame":{"x":1,"y":589,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"dretch-dead00.png","frame":{"x":247,"y":151,"w":48,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"dretch-idle00.png","frame":{"x":1,"y":639,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"dretch-idle01.png","frame":{"x":1,"y":689,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"engraved_pillar-idle00.png","frame":{"x":227,"y":1027,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"failed-spell.png","frame":{"x":225,"y":883,"w":42,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":42,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"fetid_water-idle00.png","frame":{"x":1,"y":739,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-dead00.png","frame":{"x":418,"y":697,"w":46,"h":29},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":12,"w":46,"h":29},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-idle00.png","frame":{"x":369,"y":768,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-idle01.png","frame":{"x":409,"y":768,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-e00.png","frame":{"x":344,"y":945,"w":30,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":3,"w":30,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-e01.png","frame":{"x":267,"y":1077,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-e02.png","frame":{"x":467,"y":441,"w":29,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":3,"w":29,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-e03.png","frame":{"x":468,"y":682,"w":28,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":28,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-n00.png","frame":{"x":461,"y":728,"w":35,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":35,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-n01.png","frame":{"x":184,"y":1028,"w":41,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":41,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-n02.png","frame":{"x":345,"y":992,"w":35,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":35,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-n03.png","frame":{"x":266,"y":1123,"w":37,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":4,"w":37,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-s00.png","frame":{"x":264,"y":933,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-s01.png","frame":{"x":305,"y":1123,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-s02.png","frame":{"x":264,"y":980,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-s03.png","frame":{"x":304,"y":1076,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-w00.png","frame":{"x":467,"y":488,"w":29,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":3,"w":29,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-w01.png","frame":{"x":379,"y":1275,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-w02.png","frame":{"x":467,"y":535,"w":29,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":3,"w":29,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-w03.png","frame":{"x":415,"y":941,"w":28,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":28,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fire00.png","frame":{"x":1,"y":789,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fire01.png","frame":{"x":1,"y":338,"w":48,"h":49},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"fire_beetle_pv-dead00.png","frame":{"x":418,"y":476,"w":47,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":5,"w":47,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"fire_beetle_pv-idle00.png","frame":{"x":1,"y":839,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fire_beetle_pv-idle01.png","frame":{"x":1,"y":889,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor-SBE.png","frame":{"x":1,"y":939,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor-SBW.png","frame":{"x":1,"y":989,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor.png","frame":{"x":1,"y":1039,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2-SBE.png","frame":{"x":1,"y":1089,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2-SBW.png","frame":{"x":1,"y":1139,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2.png","frame":{"x":1,"y":1189,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"gargoyle-dead00.png","frame":{"x":418,"y":663,"w":48,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":9,"w":48,"h":32},"sourceSize":{"w":48,"h":48}},{"filename":"gargoyle-idle00.png","frame":{"x":143,"y":244,"w":48,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"gargoyle-idle01.png","frame":{"x":317,"y":438,"w":48,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"ghoul-dead00.png","frame":{"x":270,"y":869,"w":43,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":11,"w":43,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"ghoul-idle00.png","frame":{"x":304,"y":1170,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ghoul-idle01.png","frame":{"x":264,"y":1169,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"giant_wasp_pv-dead00.png","frame":{"x":51,"y":588,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"giant_wasp_pv-idle00.png","frame":{"x":51,"y":638,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"giant_wasp_pv-idle01.png","frame":{"x":1,"y":1239,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"goblin-dead00.png","frame":{"x":269,"y":901,"w":43,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":12,"w":43,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"goblin-idle00.png","frame":{"x":225,"y":839,"w":43,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":6,"w":43,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"goblin-idle01.png","frame":{"x":242,"y":340,"w":46,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":46,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"gold_coins.png","frame":{"x":201,"y":1,"w":49,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"green_flask.png","frame":{"x":468,"y":582,"w":28,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":28,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"half_plate_armour.png","frame":{"x":417,"y":434,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":4,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"handaxe.png","frame":{"x":101,"y":834,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":42,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"helmet.png","frame":{"x":302,"y":1217,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":1,"w":37,"h":45},"sourceSize":{"w":49,"h":48}},{"filename":"hidden_artefact-dead00.png","frame":{"x":411,"y":1321,"w":32,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":5,"w":32,"h":32},"sourceSize":{"w":48,"h":48}},{"filename":"hidden_artefact-idle00.png","frame":{"x":375,"y":1385,"w":28,"h":27},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":5,"w":28,"h":27},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-down00.png","frame":{"x":340,"y":246,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-down01.png","frame":{"x":290,"y":293,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-left00.png","frame":{"x":290,"y":341,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-left01.png","frame":{"x":338,"y":294,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-right00.png","frame":{"x":338,"y":342,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-right01.png","frame":{"x":388,"y":199,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-up00.png","frame":{"x":388,"y":247,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-up01.png","frame":{"x":386,"y":295,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-auto-centre00.png","frame":{"x":386,"y":343,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-auto-centre01.png","frame":{"x":436,"y":200,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-fullscreen00.png","frame":{"x":1,"y":1289,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hud-fullscreen01.png","frame":{"x":436,"y":248,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hunting_trap.png","frame":{"x":187,"y":759,"w":46,"h":27},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":11,"w":46,"h":27},"sourceSize":{"w":48,"h":48}},{"filename":"ice00.png","frame":{"x":324,"y":530,"w":42,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":42,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"iron_rations.png","frame":{"x":235,"y":762,"w":46,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":10,"w":46,"h":31},"sourceSize":{"w":48,"h":48}},{"filename":"kobold-dead00.png","frame":{"x":273,"y":837,"w":42,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":12,"w":42,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"kobold-idle00.png","frame":{"x":365,"y":866,"w":34,"h":41},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":7,"w":34,"h":41},"sourceSize":{"w":48,"h":48}},{"filename":"kobold-idle01.png","frame":{"x":451,"y":1312,"w":35,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":5,"w":35,"h":43},"sourceSize":{"w":48,"h":48}},{"filename":"leather_armour.png","frame":{"x":368,"y":644,"w":48,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"lock_pick.png","frame":{"x":101,"y":1134,"w":41,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":41,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"magic00.png","frame":{"x":222,"y":1120,"w":42,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":42,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"manhole_cover-dead00.png","frame":{"x":341,"y":1353,"w":32,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":6,"w":32,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"manhole_cover-idle00.png","frame":{"x":343,"y":1388,"w":30,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":9,"w":30,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"meat.png","frame":{"x":304,"y":992,"w":39,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":6,"w":39,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"miss.png","frame":{"x":271,"y":437,"w":44,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":44,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"noxious_gas-idle00.png","frame":{"x":1,"y":1339,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"noxious_gas-idle01.png","frame":{"x":249,"y":51,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-dead00.png","frame":{"x":368,"y":684,"w":48,"h":36},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":8,"w":48,"h":36},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle00.png","frame":{"x":100,"y":586,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle01.png","frame":{"x":100,"y":636,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w00.png","frame":{"x":101,"y":984,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":40,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"padded_armour.png","frame":{"x":241,"y":198,"w":48,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":48,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"plate_armour.png","frame":{"x":147,"y":100,"w":48,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"platinum_coins.png","frame":{"x":252,"y":1,"w":49,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"poleaxe.png","frame":{"x":303,"y":1,"w":49,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"portal.png","frame":{"x":1,"y":191,"w":91,"h":95},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":91,"h":95},"sourceSize":{"w":96,"h":96}},{"filename":"potion_of_healing.png","frame":{"x":467,"y":391,"w":29,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":29,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"purple_plant.png","frame":{"x":418,"y":623,"w":48,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"quarterstaff.png","frame":{"x":146,"y":288,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":1,"w":45,"h":47},"sourceSize":{"w":49,"h":48}},{"filename":"quartz.png","frame":{"x":146,"y":686,"w":42,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":42,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-dead00.png","frame":{"x":449,"y":775,"w":46,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":12,"w":46,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-idle00.png","frame":{"x":438,"y":815,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-idle01.png","frame":{"x":343,"y":1133,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-e00.png","frame":{"x":262,"y":1216,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-e01.png","frame":{"x":226,"y":1074,"w":39,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":4,"w":39,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-e02.png","frame":{"x":262,"y":1263,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-e03.png","frame":{"x":343,"y":1180,"w":36,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":4,"w":36,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-n00.png","frame":{"x":439,"y":862,"w":35,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":3,"w":35,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-n01.png","frame":{"x":445,"y":941,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-n02.png","frame":{"x":382,"y":987,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-n03.png","frame":{"x":341,"y":1273,"w":36,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":4,"w":36,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-s00.png","frame":{"x":341,"y":1226,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-s01.png","frame":{"x":381,"y":1180,"w":36,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":36,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-s02.png","frame":{"x":400,"y":815,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-s03.png","frame":{"x":401,"y":862,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-w00.png","frame":{"x":302,"y":1264,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-w01.png","frame":{"x":184,"y":1074,"w":40,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":40,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-w02.png","frame":{"x":343,"y":1039,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-w03.png","frame":{"x":376,"y":941,"w":37,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":37,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rat-dead00.png","frame":{"x":190,"y":722,"w":45,"h":35},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":13,"w":45,"h":35},"sourceSize":{"w":48,"h":48}},{"filename":"rat-idle00.png","frame":{"x":368,"y":478,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"rat-idle01.png","frame":{"x":368,"y":520,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"rat-walk-e00.png","frame":{"x":367,"y":435,"w":48,"h":41},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":41},"sourceSize":{"w":48,"h":48}},{"filename":"rat-walk-n00.png","frame":{"x":302,"y":1034,"w":39,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":6,"w":39,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"rat-walk-s00.png","frame":{"x":369,"y":722,"w":42,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":42,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rat-walk-w00.png","frame":{"x":417,"y":391,"w":48,"h":41},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":41},"sourceSize":{"w":48,"h":48}},{"filename":"rat.png","frame":{"x":368,"y":602,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"rat_pv-dead00.png","frame":{"x":237,"y":723,"w":46,"h":37},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":10,"w":46,"h":37},"sourceSize":{"w":48,"h":48}},{"filename":"rat_pv-idle00.png","frame":{"x":101,"y":1183,"w":41,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":41,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"rat_pv-idle01.png","frame":{"x":101,"y":1232,"w":42,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":42,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"red_flask.png","frame":{"x":468,"y":632,"w":28,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":28,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"ring_mail_armour.png","frame":{"x":183,"y":788,"w":42,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":2,"w":42,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ring_of_charisma.png","frame":{"x":356,"y":909,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":9,"w":40,"h":30},"sourceSize":{"w":49,"h":48}},{"filename":"ring_of_constitution.png","frame":{"x":398,"y":909,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":9,"w":40,"h":30},"sourceSize":{"w":49,"h":48}},{"filename":"ring_of_dexterity.png","frame":{"x":440,"y":909,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":9,"w":40,"h":30},"sourceSize":{"w":49,"h":48}},{"filename":"ring_of_intelligence.png","frame":{"x":456,"y":1188,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":9,"w":40,"h":30},"sourceSize":{"w":49,"h":48}},{"filename":"ring_of_strength.png","frame":{"x":327,"y":1319,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":9,"w":40,"h":30},"sourceSize":{"w":49,"h":48}},{"filename":"ring_of_wisdom.png","frame":{"x":369,"y":1321,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":9,"w":40,"h":30},"sourceSize":{"w":49,"h":48}},{"filename":"RIP.png","frame":{"x":99,"y":51,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-dead00.png","frame":{"x":317,"y":816,"w":46,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":12,"w":46,"h":31},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-idle00.png","frame":{"x":382,"y":1034,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-idle01.png","frame":{"x":382,"y":1081,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-e00.png","frame":{"x":417,"y":987,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-e01.png","frame":{"x":451,"y":1266,"w":34,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":34,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-e02.png","frame":{"x":417,"y":1034,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-e03.png","frame":{"x":221,"y":1320,"w":31,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":4,"w":31,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-n00.png","frame":{"x":420,"y":1081,"w":35,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":3,"w":35,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-n01.png","frame":{"x":419,"y":1174,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-n02.png","frame":{"x":452,"y":987,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-n03.png","frame":{"x":449,"y":1220,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-s00.png","frame":{"x":452,"y":1034,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-s01.png","frame":{"x":254,"y":1314,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-s02.png","frame":{"x":457,"y":1081,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-s03.png","frame":{"x":381,"y":1133,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-w00.png","frame":{"x":414,"y":1226,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-w01.png","frame":{"x":291,"y":1311,"w":34,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":34,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-w02.png","frame":{"x":416,"y":1273,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-w03.png","frame":{"x":246,"y":1366,"w":31,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":31,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rusty_key.png","frame":{"x":379,"y":1226,"w":33,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":1,"w":33,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"scale_mail_armour.png","frame":{"x":227,"y":795,"w":44,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":44,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"shadow-dead00.png","frame":{"x":1,"y":1389,"w":42,"h":34},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":9,"w":42,"h":34},"sourceSize":{"w":48,"h":48}},{"filename":"shadow-idle00.png","frame":{"x":299,"y":51,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"shadow-idle01.png","frame":{"x":349,"y":51,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"shield.png","frame":{"x":190,"y":675,"w":45,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":45,"h":45},"sourceSize":{"w":49,"h":48}},{"filename":"shortsword.png","frame":{"x":434,"y":296,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":46,"h":46},"sourceSize":{"w":49,"h":48}},{"filename":"silver_coins.png","frame":{"x":146,"y":337,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":1,"w":45,"h":47},"sourceSize":{"w":49,"h":48}},{"filename":"skeleton-dead00.png","frame":{"x":283,"y":767,"w":44,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":13,"w":44,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"skeleton-idle00.png","frame":{"x":419,"y":1128,"w":37,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":37,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"skeleton-idle01.png","frame":{"x":237,"y":627,"w":38,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":1,"w":38,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"skull.png","frame":{"x":94,"y":191,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":47,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"slime-idle00.png","frame":{"x":399,"y":51,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"slime-idle01.png","frame":{"x":97,"y":99,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"spell.png","frame":{"x":228,"y":483,"w":42,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":42,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"spider_pv-dead00.png","frame":{"x":413,"y":728,"w":46,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":5,"w":46,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"spider_pv-idle00.png","frame":{"x":309,"y":1395,"w":32,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":10,"w":32,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"spider_pv-idle01.png","frame":{"x":411,"y":1355,"w":32,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":10,"w":32,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"stirge-dead00.png","frame":{"x":315,"y":879,"w":43,"h":27},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":11,"w":43,"h":27},"sourceSize":{"w":48,"h":48}},{"filename":"stirge-idle00.png","frame":{"x":458,"y":1128,"w":38,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":38,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"stirge-idle01.png","frame":{"x":458,"y":1158,"w":38,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":38,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"studded_leather_armour.png","frame":{"x":367,"y":391,"w":48,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":48,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"tiger_eye.png","frame":{"x":291,"y":198,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"tomb_of_elder.png","frame":{"x":197,"y":100,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader1-dead00.png","frame":{"x":247,"y":101,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader1-idle00.png","frame":{"x":101,"y":1378,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"trader1-idle01.png","frame":{"x":51,"y":688,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader2-dead00.png","frame":{"x":297,"y":101,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader2-idle00.png","frame":{"x":434,"y":344,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"trader2-idle01.png","frame":{"x":51,"y":738,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trapdoor-dead00.png","frame":{"x":375,"y":1353,"w":34,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":9,"w":34,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"trapdoor-idle00.png","frame":{"x":309,"y":1357,"w":30,"h":36},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":9,"w":30,"h":36},"sourceSize":{"w":48,"h":48}},{"filename":"ui-checkbox00.png","frame":{"x":175,"y":387,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-checkbox01.png","frame":{"x":223,"y":387,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-guides00.png","frame":{"x":175,"y":435,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-guides01.png","frame":{"x":223,"y":435,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-hall-of-fame00.png","frame":{"x":180,"y":483,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-hall-of-fame01.png","frame":{"x":180,"y":531,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-play00.png","frame":{"x":180,"y":579,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-play01.png","frame":{"x":228,"y":531,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-settings00.png","frame":{"x":228,"y":579,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-settings01.png","frame":{"x":189,"y":627,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-down00.png","frame":{"x":271,"y":389,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-down01.png","frame":{"x":272,"y":483,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-left00.png","frame":{"x":276,"y":531,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-left01.png","frame":{"x":276,"y":579,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-right00.png","frame":{"x":277,"y":627,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-right01.png","frame":{"x":281,"y":675,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-up00.png","frame":{"x":319,"y":390,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-up01.png","frame":{"x":320,"y":482,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"undead00.png","frame":{"x":347,"y":101,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"undefined.png","frame":{"x":279,"y":1360,"w":28,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":11,"y":2,"w":28,"h":44},"sourceSize":{"w":49,"h":48}},{"filename":"vegetation-dead00.png","frame":{"x":246,"y":1412,"w":29,"h":11},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":17,"w":29,"h":11},"sourceSize":{"w":48,"h":48}},{"filename":"vegetation-idle00.png","frame":{"x":445,"y":1357,"w":29,"h":16},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":12,"w":29,"h":16},"sourceSize":{"w":48,"h":48}},{"filename":"violet_fungus-dead00.png","frame":{"x":273,"y":797,"w":42,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":42,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"violet_fungus-idle00.png","frame":{"x":297,"y":151,"w":48,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"violet_fungus-idle01.png","frame":{"x":347,"y":151,"w":48,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"wall-B.png","frame":{"x":397,"y":101,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BL.png","frame":{"x":145,"y":588,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BLI.png","frame":{"x":447,"y":102,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BR.png","frame":{"x":190,"y":1170,"w":34,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":34,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BRI.png","frame":{"x":51,"y":788,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BTEE.png","frame":{"x":51,"y":838,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-HI.png","frame":{"x":51,"y":888,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-L.png","frame":{"x":192,"y":1220,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-LTEE.png","frame":{"x":192,"y":1270,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-R.png","frame":{"x":227,"y":1214,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-RTEE.png","frame":{"x":227,"y":1264,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-T.png","frame":{"x":51,"y":938,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TL.png","frame":{"x":267,"y":1027,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TLI.png","frame":{"x":51,"y":988,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TR.png","frame":{"x":365,"y":816,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TRI.png","frame":{"x":51,"y":1038,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TTEE.png","frame":{"x":51,"y":1088,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-VI.png","frame":{"x":51,"y":1138,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-XI.png","frame":{"x":51,"y":1188,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-B.png","frame":{"x":51,"y":1238,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-HI.png","frame":{"x":51,"y":1288,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-T.png","frame":{"x":51,"y":1338,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"warhammer.png","frame":{"x":143,"y":195,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":47,"h":47},"sourceSize":{"w":49,"h":48}},{"filename":"waterskin.png","frame":{"x":101,"y":1281,"w":42,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":1,"w":42,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-dead00.png","frame":{"x":51,"y":1388,"w":47,"h":35},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":10,"w":47,"h":35},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-idle00.png","frame":{"x":101,"y":1034,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-idle01.png","frame":{"x":144,"y":884,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-e00.png","frame":{"x":143,"y":934,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-e01.png","frame":{"x":99,"y":338,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-e02.png","frame":{"x":143,"y":984,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-e03.png","frame":{"x":184,"y":1120,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-n00.png","frame":{"x":143,"y":1034,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-n01.png","frame":{"x":101,"y":1084,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-n02.png","frame":{"x":143,"y":1084,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-n03.png","frame":{"x":329,"y":674,"w":37,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":37,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-s00.png","frame":{"x":226,"y":927,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-s01.png","frame":{"x":147,"y":734,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-s02.png","frame":{"x":226,"y":977,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-s03.png","frame":{"x":145,"y":1328,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-w00.png","frame":{"x":324,"y":577,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-w01.png","frame":{"x":185,"y":834,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-w02.png","frame":{"x":185,"y":884,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-w03.png","frame":{"x":226,"y":1164,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wraith-dead00.png","frame":{"x":150,"y":1378,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"wraith-idle00.png","frame":{"x":397,"y":151,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"wraith-idle01.png","frame":{"x":447,"y":152,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"zombie-dead00.png","frame":{"x":317,"y":849,"w":46,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":13,"w":46,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"zombie-idle00.png","frame":{"x":343,"y":1086,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"zombie-idle01.png","frame":{"x":304,"y":945,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}}],"meta":{"app":"https://www.codeandweb.com/texturepacker","version":"1.0","image":"dungeon.png","format":"RGBA8888","size":{"w":497,"h":1424},"scale":"1","smartupdate":"$TexturePacker:SmartUpdate:16268dfb08e2470d80c8702d3572d24d:1789d99f49367f853e8e3704f337d1ff:9c0fba27a8a0c106083a8713f6c67b32$"}}');var rz={};rz=m("5waPY").getBundleURL("9veYn")+"about.69f3cddd.md";var rk={};rk=m("5waPY").getBundleURL("9veYn")+"armour.544d9006.txt";var rG={};rG=m("5waPY").getBundleURL("9veYn")+"artefacts.7fd82ff6.txt";var rB={};rB=m("5waPY").getBundleURL("9veYn")+"magic.2224265f.txt";var rU={};rU=m("5waPY").getBundleURL("9veYn")+"monsters.4a1b2116.txt";var rH={};rH=m("5waPY").getBundleURL("9veYn")+"heroes.2d1d5c8e.txt";var rF={};rF=m("5waPY").getBundleURL("9veYn")+"money.dc77b2a9.txt";var r$={};r$=m("5waPY").getBundleURL("9veYn")+"traders.1d8d82a4.txt";var rY={};rY=m("5waPY").getBundleURL("9veYn")+"weapons.fc46d85c.txt";var rW={};rW=m("5waPY").getBundleURL("9veYn")+"keys.f3b71340.txt";var rK={};rK=m("5waPY").getBundleURL("9veYn")+"traps.372f7cd1.txt";var rV={};rV=m("5waPY").getBundleURL("9veYn")+"plants.721683b7.txt";var rX={};rX=m("5waPY").getBundleURL("9veYn")+"objectives.db6c512b.txt";var rq={};rq=m("5waPY").getBundleURL("9veYn")+"dungeon-completed.6e49dc4f.md";var rj={};rj=m("5waPY").getBundleURL("9veYn")+"dungeon_script.34f994bb.txt";var rZ={};rZ=m("5waPY").getBundleURL("9veYn")+"dungeon-welcome.97ed0392.md";var rJ={};rJ=m("5waPY").getBundleURL("9veYn")+"dungeon-welcome-casual.d4a9c126.md";var rQ={};rQ=m("5waPY").getBundleURL("9veYn")+"help.29d4aacb.md";var r4={};r4=m("5waPY").getBundleURL("9veYn")+"do-alto-do-trono-da-desolacao-trimmed.18cbfbbb.mp3";var r0={};r0=m("5waPY").getBundleURL("9veYn")+"privacy.9596e717.md";var r1={};r1=m("5waPY").getBundleURL("9veYn")+"startupTips.b17a0216.md";var r8={};r8=m("5waPY").getBundleURL("9veYn")+"quickStart.0860a3ca.md";var r3={};r3=m("5waPY").getBundleURL("9veYn")+"punch-trimmed.d5ee82fe.mp3";var r2={};r2=m("5waPY").getBundleURL("9veYn")+"punch-trimmed-double.7756f095.mp3";var r5={};r5=m("5waPY").getBundleURL("9veYn")+"long-medium-swish-trimmed.69cad07b.mp3";var r6={};r6=m("5waPY").getBundleURL("9veYn")+"bubbling-trimmed.361718fa.mp3";var r9={};r9=m("5waPY").getBundleURL("9veYn")+"male-hurt-sound-trimmed.76fa38ed.mp3";var r7={};r7=m("5waPY").getBundleURL("9veYn")+"pig-oink-47167.4d796935.mp3";var ie={};ie=m("5waPY").getBundleURL("9veYn")+"squeal-thing-103111.d7f21093.mp3";var it={};it=m("5waPY").getBundleURL("9veYn")+"metal-blade-slice-32-195321.f9effd4c.mp3";var ir={};ir=m("5waPY").getBundleURL("9veYn")+"click-and-crawl.10b21974.png";let ii={ABOUT_MD:new URL(rz),ALMANAC_MAP:new Map([["ARMOUR",new URL(rk)],["ARTEFACTS",new URL(rG)],["MAGIC",new URL(rB)],["ENEMIES",new URL(rU)],["HEROES",new URL(rH)],["MONEY",new URL(rF)],["TRADERS",new URL(r$)],["WEAPONS",new URL(rY)],["KEYS",new URL(rW)],["TRAPS",new URL(rK)],["PLANTS",new URL(rV)],["OBJECTIVES",new URL(rX)]]),DUNGEON_COMPLETE:new URL(rq),DUNGEON_SCRIPT:new URL(rj),DUNGEON_WELCOME:new URL(rZ),DUNGEON_WELCOME_CASUAL:new URL(rJ),HELP_MD:new URL(rQ),MUSIC:new URL(r4),PRIVACY_MD:new URL(r0),STARTUP_TIPS_MD:new URL(r1),QUICK_START_MD:new URL(r8),SOUND_EFFECTS_MAP:new Map([["PUNCH",new URL(r3)],["DOUBLE PUNCH",new URL(r2)],["MISS",new URL(r5)],["POISONED",new URL(r6)],["DIE",new URL(r9)],["DIE_MONSTER",new URL(r7)],["DIE_MONSTER_SMALL",new URL(ie)],["TRIGGER TRAP",new URL(it)]]),SPLASH_IMAGE:new URL(ir)};var ia={};ia=m("5waPY").getBundleURL("9veYn")+"dungeon.3f026531.png";let is={data:(u=r_)&&u.__esModule?u.default:u,textureUrl:new URL(ia)};function io(e,t={}){return tb(e).then(r=>{let i,a;if(r){var n,s;rA.clear(),s=rL(s=r.replaceAll(/\r/g,""),rP),n?.pre&&(s=rL(s,n.pre)),s=rL(s,rv),s=rL(s,rN),s=rL(s,rR),s=rL(s,rO),s=rL(s,rC),s=rL(s,rD),n?.post&&(s=rL(s,n.post)),i=rA.reinstate(s)}else a=e1`MESSAGE CANNOT LOAD URL ${e.toString()}`;let o=e4("div",{className:"parsed-markdown",text:a,html:i=i.replace(/\$\{VERSION\}/g,"1.0.0[se02d3] 2024-05-24").replace(/\$\{COPYRIGHT\}/g,`\xa9 2024 Steve Butler`)});return te.showControlsDialog(o,{actionButtons:t.actionButtons,row:!0,okButtonLabel:t.okButtonLabel})})}let il={MAIN_MENU:0,CLICKED_FREE_GROUND:1,CLICKED_ENTRANCE:2,CLICKED_EXIT:3},ih=!0;class ic{#e6;#tQ;#t4;#e4;#t0;#t1;constructor(e,t,r,i){this.#e6=e,this.#e4=t,this.#t0=r,this.#t1=i}#t8(e){if(this.#e6.moveType===aI.HUNT){if(this.#t1)return e;{let t=this.#e4.worldPointToGrid(r.position);if(e.getOrthoSeparation(t)-1<=1.5*this.#e6.getMaxTilesPerMove())return this.#e4.worldPointToGrid(r.position)}}return this.#t3(e,this.#e6.getMaxTilesPerMove())}moveInstantly(){this.#t4=b.copy(this.#e6.position);let e=this.#e6.getMaxTilesPerMove();if(0===e)return;let t=this.#e4.worldPointToGrid(this.#e6.position),r=this.#t8(t);if(!r.coincident(t)){this.#t0.actor=this.#e6;let i=this.#t0.getDumbRouteNextTo(t,r,e);i.length>0&&(this.#tQ=new eG({path:i,speed:100},this.#e6.sprite.modifier),this.#t2(i[i.length-1]))}}#t3(e,t){let r=N(e.x-t,e.x+t),i=N(e.y-t,e.y+t),a=this.#e4.getDimsInTiles();return new D(I(r,0,a.width-1),I(i,0,a.height-1))}#t2(e){let t=this.#e4.worldPointToGrid(this.#e6.position);this.#e6.position=e;let r=this.#e4.worldPointToGrid(this.#e6.position);this.#e4.moveTileOccupancyGridPoint(this.#e6,t,r)}#t5(){this.#t2(this.#t4)}replay(){return(this.#t5(),this.#tQ)?(this.#t6(),this.#tQ.applyAsTransientToSprite(this.#e6.sprite)):Promise.resolve()}#t6(){if(this.#e6.isOrganic()){let e=rp(this.#e6.almanacEntry);e.position=this.#t4,e.freezeMovement(),ed.addActor(e)}}}class iu{#e4;#t0;#t9;#t1;constructor(e,t,r){this.#t9=[],this.#e4=e,this.#t0=t,this.#t1=r}addAndMoveActor(e){if(0===e.getMaxTilesPerMove())return;let t=new ic(e,this.#e4,this.#t0,this.#t1);t.moveInstantly(),this.#t9.push(t)}replay(){let e=[];return this.#t9.forEach(t=>e.push(t.replay())),Promise.all(e)}}class id{constructor(){}async transitionTo(e){await this.onExit().then(()=>(iL=e,e.onEntry()))}onEntry(){return Promise.resolve()}onEvent(e){return Promise.resolve(null)}onExit(){return Promise.resolve(null)}}class ip extends id{onEntry(){return(function(){let e=new eq({leftLabel:e1`BUTTON PLAY ADVENTURE`,imageName:"ui-play00.png",internalLabel:!0,closes:"PLAY ADVENTURE"}),t=new eq({leftLabel:e1`BUTTON PLAY CASUAL`,imageName:"ui-play00.png",internalLabel:!0,closes:"PLAY CASUAL"}),r=new eq({leftLabel:e1`BUTTON SETTINGS`,imageName:"ui-settings00.png",internalLabel:!0,action:()=>rr()}),i=new eq({leftLabel:e1`BUTTON HALL OF FAME`,imageName:"ui-hall-of-fame00.png",internalLabel:!0,action:()=>(function(){let e=e4("div",{className:"best-adventure"}),t=rE().getCurrentData();if(0===t.length)e.appendChild(e4("p",{text:e1`MESSAGE NO SAVED ADVENTURE`}));else{let r=document.createElement("ul");for(let i of(e.appendChild(r),t))r.appendChild(e4("li",{text:function(e){let t=new Date(e.adventureStartTime).toISOString().split("T")[0],r=e.class?.toLowerCase()??"";return e1`MESSAGE HALL OF FAME ENTRY ${e.name} ${e.characterLevel} ${r} ${t} ${e.gold} ${e.dungeonFloor}`}(i)}))}return te.showElementOkDialog(e1`DIALOG TITLE HALL OF FAME`,e)})()}),a=new eq({leftLabel:e1`BUTTON GUIDES`,imageName:"ui-guides00.png",internalLabel:!0,action:()=>(function(){let e=new eX({label:e1`BUTTON ABOUT`,action:()=>io(ii.ABOUT_MD)}),t=new eX({label:e1`BUTTON HELP`,action:()=>io(ii.HELP_MD)}),r=new eX({label:e1`BUTTON PRIVACY`,action:()=>io(ii.PRIVACY_MD)});return io(ii.QUICK_START_MD,{actionButtons:[t,e,r]})})()});return te.showControlsDialog(e1`MENU TITLE MAIN`,{actionButtons:[a,r,i,e,t],className:"door"})})().then(async e=>{ih="PLAY CASUAL"!==e,await this.transitionTo(new im)})}}class im extends id{onEntry(){return E.debug("Enter AtStart"),this.#t7().then(()=>this.#re()).then(e=>{let t=r.traits.get("NAME");return e?te.showOkDialog(e1`MESSAGE DUNGEON INTRO CONTINUE ${t}`,{okButtonLabel:e1`BUTTON ENTER DUNGEON`,className:"wall"}).then(()=>an(r)).then(()=>{if(!r.alive)throw Error("Actor died during rest.")}):io(ih?ii.DUNGEON_WELCOME:ii.DUNGEON_WELCOME_CASUAL,{okButtonLabel:e1`BUTTON ENTER DUNGEON`})}).then(()=>{r.sprite.position=ed.getTileMap().getWorldPositionOfTileByEntry()}).then(()=>{let e=iJ.getCurrentSceneIntro();return e?te.showOkDialog(e,{className:"mask"}):void 0}).then(()=>iL.transitionTo(new iw)).catch(e=>{E.info(e.message),iL.transitionTo(new ig)})}#re(){let e=ih?function(){let e=eK.get("GAME_STATE",null,ry);if(!e){E.debug("No saved game state to restore.");return}if(!e.hero.alive){E.debug("Last hero state was dead, so not restoring.");return}if(e.completed){E.debug("Last game was completed, so not restoring.");return}return{hero:e.hero,sceneLevel:e.sceneLevel}}():null;return e?iJ.continueFromSavedScene(e.sceneLevel,e.hero).then(()=>!0):iJ.switchToFirstScene().then(()=>!1)}#t7(){if(!eK.get("SHOW_QUICK_TIPS_AT_START",!0))return Promise.resolve();let e=new eX({label:e1`BUTTON OK`,closes:"OK"}),t=new eX({label:e1`BUTTON DO NOT SHOW AGAIN`,closes:"NOT AGAIN"});return io(ii.STARTUP_TIPS_MD,{actionButtons:[e,t]}).then(e=>{"NOT AGAIN"===e&&eK.set("SHOW_QUICK_TIPS_AT_START",!1)})}}class ig extends id{async onEntry(){E.debug("Enter AtGameOver");let e=-1;ih&&(e=rT(r));let t=e<0?e1`MESSAGE DEFEAT UNPLACED`:e1`MESSAGE DEFEAT`;eF(e1`YOU DIED!`,{delaySecs:1,lifetimeSecs:3,position:r.position,velocity:new L(0,-100,0)}),await new Promise(e=>{setTimeout(()=>e(),2e3)}).then(()=>te.showOkDialog(t,{okButtonLabel:e1`BUTTON TRY AGAIN`})).then(()=>iJ.unloadCurrentScene()).then(()=>this.transitionTo(new ip))}}class iS extends id{async onEntry(){E.debug("Enter AtGameCompleted"),await io(ii.DUNGEON_COMPLETE,{okButtonLabel:e1`BUTTON TRY AGAIN`}).then(()=>iJ.unloadCurrentScene()).then(()=>this.transitionTo(new ip))}}class iw extends id{constructor(){super()}async onEntry(){await super.onEntry(),E.debug("Enter HeroTurnIdle"),await ix(),await iA()&&await this.transitionTo(new ig)}async onEvent(e,t,i={}){switch(e){case il.CLICKED_FREE_GROUND:{let e=await iv(i.filter,i.occupant);e===t6.INTERACT_TILE?await iO(t):e===t6.OCCUPIED_TILE?await iP(i.occupant):await iI(t,{usePathFinder:i.filter!==t6.MOVE_OR_INTERACT_TILE}),i.occupant?.isObjective()&&e===t6.INTERACT_TILE?await iC():0===r.traits.get("HP",0)?await this.transitionTo(new ig):await this.transitionTo(new iT)}break;case il.CLICKED_ENTRANCE:await te.showOkDialog(e1`MESSAGE ENTRANCE STUCK`),await this.transitionTo(new iT);break;case il.CLICKED_EXIT:E.debug("Escaping"),await iD()?await iI(t,{usePathFinder:!1}).then(()=>iN(this)):await this.transitionTo(new iT)}return Promise.resolve(null)}}class iE extends id{constructor(){super()}async onEntry(){await super.onEntry(),E.debug("Enter HeroTurnInteracting"),await ix(),await iA()&&await this.transitionTo(new ig)}async onEvent(e,t,i={}){switch(e){case il.CLICKED_FREE_GROUND:{let e=await iv(i.filter,i.occupant);e===t6.INTERACT_TILE?await iO(t):e===t6.OCCUPIED_TILE?await iP(i.occupant):await this.#rt(t,{usePathFinder:i.filter!==t6.MOVE_OR_INTERACT_TILE}),i.occupant?.isObjective()&&e===t6.INTERACT_TILE?await iC():0===r.traits.get("HP",0)?await this.transitionTo(new ig):await this.#rr()}break;case il.CLICKED_ENTRANCE:await te.showOkDialog(e1`MESSAGE ENTRANCE STUCK`),await this.#rr();break;case il.CLICKED_EXIT:await iD()?await this.#rt(t,{usePathFinder:!1}).then(()=>iN(this)):await this.#rr()}return Promise.resolve(null)}async #rr(){0===ed.getTileMap().getParticipants(r).length?await this.transitionTo(new iT):await this.transitionTo(new iy)}#rt(e,t={usePathFinder:!0}){let i=ed.getTileMap(),a=i.getParticipants(r),n=!1;for(let e of a)if(e.alive&&e.interaction.respectDisengage(r)){n=!0;break}let s=i.worldPointToGrid(r.position),o=i.worldPointToGrid(e),l=s.getOrthoSeparation(o);return n&&l<=2&&(r.disengaging=!0),iI(e,t).then(()=>!0)}}class iT extends id{constructor(){super()}async onEntry(){await super.onEntry(),E.debug("Enter ComputerTurnIdle"),await iR();let e=ed.getTileMap(),t=new t3(e),i=new iu(e,t,r.disengaging);for(let e of ed.getActors().values())e!==r&&e.alive&&(!e.isWandering()||ts(6)>3)&&i.addAndMoveActor(e);for(let e of ed.getOrganicActors().values())e.alive&&i.addAndMoveActor(e);for(let t of(await i.replay(),e.getParticipants(r)))if(t.isEnemy())return await this.transitionTo(new iE),Promise.resolve(null);await this.transitionTo(new iw)}}class iy extends id{constructor(){super()}async onEntry(){await super.onEntry(),await iR();let e=ed.getTileMap(),t=new t3(e),i=new iu(e,t,r.disengaging),a=e.getParticipants(r);for(let e of ed.getActors().values())e!==r&&e.alive&&e.interaction&&(a.includes(e)&&e.willInteract()?await e.interaction.enact(r):i.addAndMoveActor(e));for(let e of ed.getOrganicActors().values())e.alive&&i.addAndMoveActor(e);return await i.replay(),0===r.traits.get("HP",0)?await this.transitionTo(new ig):0===a.length?await this.transitionTo(new iw):await this.transitionTo(new iE),Promise.resolve(null)}}function ix(){r.disengaging=!1;let e=ed.getTileMap(),t=new t3(e,r).getAllRoutesFrom(e.worldPointToGrid(r.sprite.position),r.getMaxTilesPerMove());return e.setMovementRoutes(t),e.setInteractActors(e.getParticipants(r)),e.calcReachableDoors(r.position),Promise.resolve(null)}function iA(){return!!r.toxify?.isActive&&(r.toxify.enact(r),0>=r.traits.getInt("HP",0))}function iI(e,t={usePathFinder:!0}){let i;let a=ed.getTileMap();return(i=t.usePathFinder?a.getWaypointsToWorldPoint(e):[r.position,e],a.setMovementRoutes(null),a.setInteractActors(null),i)?new eG({path:i,speed:100},r.sprite.modifier).applyAsTransientToSprite(r.sprite):Promise.resolve()}function iR(){let e=ed.getTileMap(),t=[];return ed.getOrganicActors().forEach(r=>{e.getCoincidentActors(r).forEach(e=>{e.alive&&!e.isOrganic()&&r.interaction&&t.push(r.interaction.enact(e))})}),Promise.all(t)}function iO(e){let t=ed.getTileMap().getTileAtWorldPoint(e).getOccupants(),i=[];for(let e of t.values())e.interaction&&i.push(e.interaction.react(r));return Promise.all(i)}function iC(){return r.traits.clearTransientFxTraits(),ih&&rT(r,!0),iL.transitionTo(new iS)}function iN(e){return(r.traits.clearTransientFxTraits(),ih&&rT(r),iJ.areThereMoreScenes())?iJ.unloadCurrentScene().then(()=>an(r)).then(()=>{if(!r.alive)throw Error("Actor died during rest.")}).then(()=>iJ.switchToNextScene()).then(e=>(r.sprite.position=ed.getTileMap().getWorldPositionOfTileByEntry(),e)).then(e=>e.intro?te.showOkDialog(e.intro,{className:"wall"}):void 0).then(()=>e.transitionTo(new iw)).catch(t=>{E.info(t.message),e.transitionTo(new ig)}):e.transitionTo(new iS)}function iP(e){return e?e.isHiddenArtefact()?te.showOkDialog(e.description):ai(e,{allowConsumption:e.isHero(),allowMagicUse:e.isHero()}).then(e=>{e?.invoke&&(E.info("Invoke action."),e.invoke())}):(E.error("Clicked on tile but no occupant to view."),Promise.resolve())}function iv(e,t){if(e===t6.MOVE_OR_INTERACT_TILE){if(t?.isHiddenArtefact()){let e=t.storeManager.getFirstStorageDetails(),r=e?.artefact;if(t.alive&&r)return t6.INTERACT_TILE;if(!t.alive&&!r)return t6.MOVEMENT_TILE}return te.showChoiceDialog(e1`DIALOG TITLE CHOICES`,e1`MESSAGE SEARCH OR MOVE`,[e1`BUTTON CLIMB OVER`,e1`BUTTON SEARCH`]).then(e=>0===e?t6.MOVEMENT_TILE:t6.INTERACT_TILE)}return e}function iD(){var e,t;return i?r.storeManager.hasArtefact(i)?(r.storeManager.discard(i),te.showOkDialog(e1`MESSAGE KEY UNLOCKS EXIT`).then(()=>!0)):(e=r,t=i,te.showChoiceDialog(e1`DIALOG TITLE LOCKED`,e1`MESSAGE EXIT LOCKED`,[e1`BUTTON TRY TO PICK`,e1`BUTTON LEAVE IT`]).then(r=>0===r&&(e.storeManager.hasArtefactWithSameId("lock_pick")?tR(e.traits,{ability:"DEX",difficulty:t.traits.get("DC",tT.EASY),proficiency:"PICK LOCK"})?te.showOkDialog(e1`MESSAGE YOU PICK THE LOCK`).then(()=>!0):te.showOkDialog(e1`MESSAGE YOU FAIL TO PICK THE LOCK`).then(()=>!1):te.showOkDialog(e1`MESSAGE NEED LOCK PICK`).then(()=>!1)))):Promise.resolve(!0)}let iL=new class extends id{onEntry(){E.debug("WaitingToStart state")}async onEvent(e,t,r){if(e!==il.MAIN_MENU)return Promise.resolve();await this.transitionTo(new ip)}},iM=!1;var ib={EventId:il,getHeroActor:function(){return r},setHero:function(e){r=e},triggerEvent:function(e,t,r){if(iM){E.debug(`Ignoring event ${e} as still processing earlier event.`);return}iM=!0,iL.onEvent(e,t,r).then(()=>{iM=!1})},setExitKeyArtefact:function(e){i=e}};function i_(e){return{role:t9.GROUND,onClick:(e,t,r)=>ib.triggerEvent(ib.EventId.CLICKED_FREE_GROUND,t,r),image:e}}function iz(e){return{role:t9.ENTRANCE,onClick:(e,t,r)=>ib.triggerEvent(ib.EventId.CLICKED_ENTRANCE,t,r),image:e}}function ik(e){return{role:t9.EXIT,onClick:(e,t,r)=>ib.triggerEvent(ib.EventId.CLICKED_EXIT,t,r),image:e}}let iG=new Map([["x",{role:t9.OBSTACLE,image:"block.png"}],["#-TL",{role:t9.OBSTACLE,image:"wall-TL.png"}],["#-TLI",{role:t9.OBSTACLE,image:"wall-TLI.png"}],["#-T",{role:t9.OBSTACLE,image:"wall-T.png"}],["*-T",{role:t9.OBSTACLE,image:"wall2-T.png"}],["#-TR",{role:t9.OBSTACLE,image:"wall-TR.png"}],["#-TRI",{role:t9.OBSTACLE,image:"wall-TRI.png"}],["#-R",{role:t9.OBSTACLE,image:"wall-R.png"}],["#-BR",{role:t9.OBSTACLE,image:"wall-BR.png"}],["#-BRI",{role:t9.OBSTACLE,image:"wall-BRI.png"}],["#-B",{role:t9.OBSTACLE,image:"wall-B.png"}],["*-B",{role:t9.OBSTACLE,image:"wall2-B.png"}],["#-BL",{role:t9.OBSTACLE,image:"wall-BL.png"}],["#-BLI",{role:t9.OBSTACLE,image:"wall-BLI.png"}],["#-L",{role:t9.OBSTACLE,image:"wall-L.png"}],["#-XI",{role:t9.OBSTACLE,image:"wall-XI.png"}],["#-VI",{role:t9.OBSTACLE,image:"wall-VI.png"}],["#-HI",{role:t9.OBSTACLE,image:"wall-HI.png"}],["#-TTEE",{role:t9.OBSTACLE,image:"wall-TTEE.png"}],["#-RTEE",{role:t9.OBSTACLE,image:"wall-RTEE.png"}],["#-BTEE",{role:t9.OBSTACLE,image:"wall-BTEE.png"}],["#-LTEE",{role:t9.OBSTACLE,image:"wall-LTEE.png"}],["#",{role:t9.OBSTACLE,image:"block.png"}],["=-T",ik("door-T.png")],[">-T",ik("door2-T.png")],["=-R",ik("door-R.png")],["=-B",ik("door-B.png")],[">-B",ik("door2-B.png")],["=-L",ik("door-L.png")],["--T",iz("door-T.png")],["~-T",iz("door2-T.png")],["--R",iz("door-R.png")],["--B",iz("door-B.png")],["~-B",iz("door2-B.png")],["--L",iz("door-L.png")],["=",{role:t9.OBSTACLE,image:"block.png"}],["-",{role:t9.OBSTACLE,image:"block.png"}],[".",i_("floor.png")],[".-SBW",i_("floor-SBW.png")],[".-SBE",i_("floor-SBE.png")],[",-SBE",i_("floor2-SBE.png")],[",-SBW",i_("floor2-SBW.png")],[",",i_("floor2.png")]]);class iB{#ri;#q;#ra;#rn;#rs;heroActor;intro;constructor(e=2,t=2){e>0?(this.#ri=0,this.#q=1/e):this.#q=1,this.#ra=e,this.#rn=t}getOpacity(){return this.#ri}load(){return this.doLoad()}initialise(){return this.doInitialise()}update(e){ei.clearCanvas(),ei.setOpacity(this.#ri),ed.update(e),this.doUpdate(e),ei.setOpacity(1),0!==this.#q&&(this.#ri+=e*this.#q,this.#ri>1?(this.#q=0,this.#ri=1):this.#ri<0&&(this.#q=0,this.#ri=0)),this.#rs&&0===this.#ri&&(this.#rs(),this.#rs=null)}unload(){return this.#ro().then(()=>this.doUnload())}#ro(){return this.#rn>0?(this.#q=-1/this.#rn,new Promise(e=>{this.#rs=e})):Promise.resolve()}doLoad(){return Promise.resolve()}doInitialise(){return Promise.resolve()}doUpdate(e){return Promise.resolve()}doUnload(){return Promise.resolve()}}let iU=eY.TILE_SIZE;function iH(e,t){let r,i;if(e.type===tH.CONSUMABLE&&/SUBTYPE *: *VEGETATION/i.test(e.traitsString))r="vegetation",i=ax.HIDDEN_ARTEFACT;else switch(e.type){case tH.SPELL:case tH.CANTRIP:r="engraved_pillar",i=ax.PROP;break;default:{let e=ts(6);r=e<3?"hidden_artefact":e<5?"trapdoor":"manhole_cover"}i=ax.HIDDEN_ARTEFACT}let a=rp({id:r,name:tL(r),description:tM(r),imageName:r,type:i,traitsString:""}),n=t??tB(e);return a.storeManager.addArtefact(n),a}function iF(e,t,r){if(t){let i=tB(t);r.equip&&i.equipStoreType?e.storeManager?.equip(i,{direct:!0}):e.storeManager?.stash(i,{direct:!0})}}class i$ extends iB{#rl;constructor(e){super(),this.#rl=e,this.intro=e.intro}doLoad(){return Promise.resolve()}doInitialise(){var e;let t=tZ.generateTileMapPlan(this.#rl.mapDesign,iG);this.heroActor=function(e){if(e.hero instanceof aR)a=e.hero;else if(e.hero)a=rp(e.hero);else if(!a)throw Error("No hero has been defined.");return a}(this.#rl);let r=new re(ei.getContext2D(),t,iU,this.heroActor);ed.setTileMap(r);let i=(e=this.#rl).objective?rp(e.objective):null;if(i){let e=r.getRandomFreeGroundTile();e?(i.position=e.worldPoint,ed.addArtefact(i)):(E.debug("No free tiles for objective."),i=null)}let n=tG.getRandomEntry("KEYS"),s=i||ts(6)>3?tB(n):null,o=!i&&s?1:0,l=tG.getPooledAlmanac(["ARTEFACTS","ARMOUR","WEAPONS"],e=>e.minLevel<=iJ.getCurrentSceneLevel()),h=l.find(e=>"waterskin"===e.id),c=l.find(e=>"iron_rations"===e.id);for(let e of function(e){let t=[];return e.enemies.forEach(e=>{let r=rp(e);t.push(r)}),t}(this.#rl)){let t=r.getRandomFreeGroundTile();if(!t){E.debug("No free tiles for enemy.");break}if(e.position=t.worldPoint,ed.addActor(e),e.isTrader()){e.traits.exceedAbilitiesAndExp?.(this.heroActor.traits,1);let t=7;ts(6)>3&&(iF(e,h,{equip:!1}),t--),ts(6)>3&&(iF(e,c,{equip:!1}),t--),function(e,t,r){for(;r.qty-- >0;)iF(e,t.getRandomEntry(),r)}(e,l,{qty:t,equip:!1})}else o&&!e.isOrganic()&&e.traits.get("HAS_KEYS")&&(e.storeManager.stash(s,{direct:!0}),o=0,E.debug("Added key to actor."))}if(o){let e=iH(n,s),t=r.getRandomFreeGroundTile();t&&(e.position=t.worldPoint,ed.addArtefact(e),o=0,E.debug("Added key as hidden object."))}for(let e of function(e){let t=[];return e.artefacts.forEach(e=>{let r=iH(e);t.push(r)}),t}(this.#rl)){let t=r.getRandomFreeGroundTile();if(!t){E.debug("No free tile to add artefact.");break}e.position=t.worldPoint,ed.addArtefact(e)}return iJ.setCameraToTrack(this.heroActor.sprite,200,0),ed.addActor(this.heroActor),ib.setHero(this.heroActor),o>0?ib.setExitKeyArtefact(null):ib.setExitKeyArtefact(s),Promise.resolve()}doUpdate(e){}doUnload(){return Promise.resolve(null)}}let iY={OFF:0,HERO:1,VELOCITY:2};class iW{#rh;#rc;#ru;#rd;constructor(e,t,r=0){let i=ei.getCanvasDimensions(),a=r*Math.min(i.width,i.height);this.#rh=new eD,this.#rc=new ek({prey:e,speed:t,maxSeparation:a}),this.#ru=new e_,this.#rc.applyAsContinuousToSprite(this.#rh)}update(e){this.#rd!==iY.OFF&&(this.#rh.update(e),ei.centreCanvasOn(this.#rh.position))}setVelocity(e,t){this.setTrackingMethod(iY.VELOCITY),this.#rh.velocity.x=e,this.#rh.velocity.y=t}panBy(e,t){this.#rh.position.x+=e,this.#rh.position.y+=t,ei.centreCanvasOn(this.#rh.position)}setTrackingMethod(e){if(e!==this.#rd)switch(this.#rd=e,e){case iY.HERO:this.#rc.applyAsContinuousToSprite(this.#rh);break;case iY.VELOCITY:this.#ru.applyAsContinuousToSprite(this.#rh);break;case iY.OFF:break;default:E.error(`Attempt to set invalid tracking method of ${e} ignored.`)}}}let iK={TR:0,BR:1,BL:2,TL:3};class iV{#rf;#rp;#rm;constructor(e,t,r,i){this.#rf=e,this.#rg(t,r,!1),this.#rS(t,i)}#rS(e,t){let r=new eA({prefix:"ui-settings",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eT.STOP}),i=av.addButton(r,()=>rr()),a=this.#rw(e,t,1);i.position.x=a.x,i.position.y=a.y}#rE(e,t,r){let i=new eA({prefix:"hud-fullscreen",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eT.STOP}),a=av.addButton(i,()=>{document.body.requestFullscreen?.({navigationUI:"hide"})},()=>{document.exitFullscreen?.()}),n=this.#rw(e,t,1);a.position.x=n.x+r.x,a.position.y=n.y+r.y,window.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(E.debug("Switched to fullscreen mode."),i.setCurrentIndex(1)):(E.debug("Exited fullscreen mode."),i.setCurrentIndex(0))})}#rw(e,t,r){let i=new D(0,0);switch(t){case iK.TL:i.x=r*e,i.y=r*e;break;case iK.TR:i.x=-r*e,i.y=r*e;break;case iK.BR:i.x=-r*e,i.y=-r*e;break;case iK.BL:i.x=r*e,i.y=-r*e}return i}#rg(e,t,r){let i=this.#rw(e,t,r?2:1);this.#rT(i.x,i.y),r&&this.#ry(i.x,i.y,e)}#rT(e,t){this.#rm=new eA({prefix:"hud-auto-centre",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eT.STOP}),this.#rp=av.addButton(this.#rm,()=>{this.setTrackingState(!0)},()=>{this.setTrackingState(!1)}),this.#rp.position.x=e,this.#rp.position.y=t,this.#rp.actionClick(null)}setTrackingState(e){e?(this.#rm.setCurrentIndex(1),this.#rf.setTrackingMethod(iY.HERO)):(this.#rm.setCurrentIndex(0),this.#rf.setTrackingMethod(iY.OFF))}#ry(e,t,r){let i=3*r;this.#rx("hud-arrow-up",e,t-r,()=>{this.setTrackingState(!1),this.#rf.setVelocity(0,-i)},()=>this.#rf.setTrackingMethod(iY.OFF)),this.#rx("hud-arrow-right",e+r,t,()=>{this.setTrackingState(!1),this.#rf.setVelocity(i,0)},()=>this.#rf.setTrackingMethod(iY.OFF)),this.#rx("hud-arrow-down",e,t+r,()=>{this.setTrackingState(!1),this.#rf.setVelocity(0,i)},()=>this.#rf.setTrackingMethod(iY.OFF)),this.#rx("hud-arrow-left",e-r,t,()=>{this.setTrackingState(!1),this.#rf.setVelocity(-i,0)},()=>this.#rf.setTrackingMethod(iY.OFF))}#rx(e,t,r,i,a){let n=new eA({prefix:e,startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eT.STOP}),s=av.addMomentaryButton(n,i,a);s.position.x=t,s.position.y=r,n.setCurrentIndex(0)}}class iX{intro;hero;enemies;artefacts;mapDesign;objective;constructor(){this.hero=null,this.enemies=[],this.artefacts=[],this.mapDesign=[]}}function iq(e){return e?ij(o).then(()=>e.load().then(()=>e.initialise()).then(()=>{l=new iV(n,48,iK.BR,iK.BL),av.setVisible(!0),o=e})).then(()=>e):(E.error("Attempt made to switch to the next scene when there are no more."),Promise.reject())}function ij(e){return e?e.unload().then(()=>(ed.clearAll(),o=null,l=null,av.clear(),av.setVisible(!1),Promise.resolve())):Promise.resolve(null)}function iZ(){return new i$(s.getNext())}var iJ={areThereMoreScenes:function(){return s.hasNext()},continueFromSavedScene:function(e,t){return s.restore(e,t),iq(iZ())},getCurrentSceneLevel:function(){return s.getIndex()},getCurrentSceneIntro:function(){return s.intro},panCameraBy:function(e,t){n&&(n.panBy(e,t),n.setTrackingMethod(iY.OFF),l.setTrackingState(!1))},setCameraToTrack:function(e,t,r){n=new iW(e,t,r)},setSceneList:function(e){(s=e).reset()},switchToFirstScene:function(){return s.reset(),iq(iZ())},switchToNextScene:function(){return iq(iZ())},unloadCurrentScene:function(){return ij(o)},update:function(e){o?.update(e),n?.update(e)}};let iQ={VIEW:0,SELL:1,PILLAGE:2,FIND:3},i4={CONTINUE:"continue",CONSUME:"consume",LEAVE:"leave",LEARN_SPELL:"learn",DISCARD:"discard",EQUIP:"equip",PREPARE_SPELL:"prepare",STASH:"stash",TAKE:"take",SELL:"sell",PILLAGE:"pillage",USE:"use"},i0={STANDARD:"standard",STASH_ONLY:"stash",SPELLS:"spells",MAGIC:"magic",READY_MAGIC:"ready magic",CANTRIPS:"cantrips"};class i1{#rA;#rI;#rR;linkedInventory;#rO;constructor(e,t={}){this.#rA=e,this.#rI=t,this.#rR=e4("div",{className:"stores"}),this.refresh()}get element(){return this.#rR}get actionButtons(){return this.#rO}refresh(e){let t=!0;if(this.#rO=[],!e&&this.linkedInventory&&this.linkedInventory.refresh(!0),this.#rR.replaceChildren(),(!this.#rA.currentOwner.isHero()||this.#rA.currentOwner.alive)&&this.#rC().forEach(e=>{let r=this.#rA.currentOwner.storeManager.getStoreContents(e.storeType);if(r){t=!1;let i=this.#rN(e.label,e.storeType,r);this.#rR.appendChild(i)}}),t){let e;e=this.#rA.currentOwner.isHero()&&!this.#rA.currentOwner.alive?e1`MESSAGE DEAD HERO HAS NO INVENTORY`:e1`MESSAGE NOTHING HERE`,this.#rR.appendChild(e4("p",{text:e}))}this.#rI.onRefresh&&this.#rI.onRefresh()}#rC(){let e;switch(this.#rI.limitation){case i0.SPELLS:e=[{label:e1`Prepared spells`,storeType:tU.PREPARED_SPELLS},{label:e1`Known spells`,storeType:tU.SPELLS}];break;case i0.MAGIC:e=[{label:e1`Cantrips`,storeType:tU.CANTRIPS},{label:e1`Prepared spells`,storeType:tU.PREPARED_SPELLS},{label:e1`Known spells`,storeType:tU.SPELLS}];break;case i0.READY_MAGIC:e=[{label:e1`Ready magic`,storeType:tU.PREPARED_SPELLS},{label:e1`Cantrips`,storeType:tU.CANTRIPS}];break;case i0.CANTRIPS:tU.CANTRIPS;break;case i0.STASH_ONLY:e=[this.#rP()];break;case i0.STANDARD:default:e=[{label:e1`Purse`,storeType:tU.PURSE},{label:e1`Head`,storeType:tU.HEAD},{label:e1`Ring fingers`,storeType:tU.RING_FINGERS},{label:e1`Body`,storeType:tU.BODY},{label:e1`Hands`,storeType:tU.HANDS},{label:e1`Feet`,storeType:tU.FEET},this.#rP()]}return e}#rP(){return this.#rA.currentOwner.isTrader()?{label:e1`Wagon`,storeType:tU.WAGON}:{label:e1`Backpack`,storeType:tU.BACKPACK}}#rN(e,t,r){let i=e4("div",{className:"store"});i.appendChild(e4("span",{className:"store-label",text:e}));let a=e4("div",{className:"store-contents"});return i.appendChild(a),[...r].sort((e,t)=>e.id<t.id).forEach(e=>{let r={...this.#rA};r.refresh=this.refresh.bind(this),r.storeType=t,r.artefact=e;let i=this.#rv(r);null!==i.closes&&void 0!==i.closes&&this.#rO.push(i),a.appendChild(i.element)}),i}#rv(e){let t,r;let i=function(e){let t=e.artefact.traits,r=t.get("NAME");if(e.showDamage){let i,a,n;if(t.has("HP_GAIN")?(a="HP: +",i=t.getHpGainDiceWhenCastBy?t.getHpGainDiceWhenCastBy(e.currentOwner.traits):t.get("HP_GAIN")):(a="DMG: ",i=t.getDamageDiceWhenCastBy?t.getDamageDiceWhenCastBy(e.currentOwner.traits):t.get("DMG")),i&&(r=`${r} ${a}${i}`),"BLESS"===t.get("MODE"))n=e1`ACTS ON CASTER`;else{let e=t.get("RANGE");e&&(n=e1`Range: ${e}`)}r=`${r} ${n}`}if(e.showPrice||e.artefact.artefactType===tH.COINS){let t=e.currentOwner.isTrader()?e.artefact.costInGp:e.artefact.sellBackPriceInGp;r=`${r} ${t.toFixed(2)} GP`}return r}(e);return e.delayedReaction?r={invoke:()=>e.artefact.interaction.react(e.currentOwner)}:t=async()=>{await aa(e).then(()=>e.refresh?.())},new eq({rightLabel:i,imageName:e.artefact.iconImageName,action:t,closes:r})}}function i8(e,t,r){r>t.length&&E.error("Attempt being made to discard more items than provided in array.");for(let i=0;i<r&&i<t.length;i++)e.take(t[i])||E.error(`Trying to take artefact ${t[i]}, but none found.`)}function i3(e,t={}){let r=e4("div",{className:"inventory"}),i=e4("div",{className:"actor-container"});r.appendChild(i),i.appendChild(ae(e,{hideDescription:!0,hideTraits:!0}));let a=new i1({currentOwner:e,prospectiveOwner:e,allowMagicUse:t.allowMagicUse,allowConsumption:t.allowConsumption},{limitation:t.limitation,onRefresh:()=>i.replaceChildren(ae(e,{hideDescription:!0,hideTraits:!0}))});return r.appendChild(a.element),te.showControlsDialog(r)}function i2(e,t){if(t.artefact.artefactType===tH.COINS)return;let r=[];switch(t.artefact.artefactType){case tH.SPELL:r=function(e){let t=[],r=e.artefact;return e.allowMagicUse?E.error("Unexpected creation of Spell buttons with magic allowed. Use of Spells is handled by custom actions."):e.storeType===r.stashStoreType&&e.allowSpellPrep&&t.push(new eX({label:e1`BUTTON PREPARE SPELL`,closes:i4.PREPARE_SPELL})),e.allowSpellPrep&&t.push(new eX({label:e1`BUTTON FORGET`,closes:i4.DISCARD})),t}(t);break;case tH.CANTRIP:r=function(e){let t=[];return e.allowMagicUse&&E.error("Unexpected creation of Cantrip buttons with magic allowed. Use of Cantrips is handled by custom actions."),t.push(new eX({label:e1`Forget`,closes:i4.DISCARD})),t}(t);break;case tH.CONSUMABLE:r=function(e){let t=[];return i5(e)&&t.push(new eX({label:i6(e.artefact),closes:i4.CONSUME})),t.push(new eX({label:e1`BUTTON DISCARD`,closes:i4.DISCARD})),t}(t);break;case tH.KEY:r=[];break;default:r=function(e){let t=[];return i5(e)?t.push(new eX({label:i6(e.artefact),closes:i4.USE})):e.storeType===e.artefact.stashStoreType&&e.artefact.equipStoreType?t.push(new eX({label:e1`BUTTON EQUIP`,closes:i4.EQUIP})):e.storeType===e.artefact.equipStoreType&&(!e.artefact.stashInWagon||e.currentOwner.storeManager.hasWagon)&&t.push(new eX({label:e1`BUTTON STASH`,closes:i4.STASH})),t.push(new eX({label:e.artefact.isMagic()?e1`Forget`:e1`BUTTON DISCARD`,closes:i4.DISCARD})),t}(t)}return r.push(new eX({label:e1`BUTTON CONTINUE`,closes:i4.CONTINUE})),r}function i5(e){let t=e.artefact;return!!t.isUsable()&&(t.isMagic()?e.allowMagicUse:t.isConsumable()?e.allowConsumption:void 0)}function i6(e){switch(e.artefactType){case tH.CONSUMABLE:return e1`BUTTON CONSUME`;case tH.SPELL:case tH.CANTRIP:return e1`BUTTON CAST SPELL`;default:return e1`BUTTON USE`}}function i9(e){return e4("p",{className:"guidance",text:e.prospectiveOwner.isTrader()?e1`MESSAGE TRADER CANNOT STASH`:e.artefact.stashInWagon?e1`MESSAGE MAKE SPACE IN EQUIP`:e1`MESSAGE MAKE SPACE IN BACKPACK`})}function i7(e){let t=e4("div",{className:"actor-id-card"});t.appendChild(ej(e.iconImageName)),t.appendChild(e4("span",{text:e.traits?.get("NAME")??e1`Unknown`}));let r=e.traits.getInt("HP");if(!e.artefactType&&r&&!e.traits.get("_HP")){let i;let a=e.traits.getInt("HP_MAX");i=0===r?e1`(DEAD)`:a?e1`(HP OUT OF VALUE) ${r} ${a}`:e1`(HP VALUE) ${r}`,t.appendChild(e4("span",{text:i}))}return e.traits.getCharacterLevel&&t.appendChild(e4("span",{text:e1`CHARACTER LEVEL: ${e.traits.getCharacterLevel()}`})),t}function ae(e,t={}){let r;let i=e4("div",{className:"actor-detail"}),a=i7(e);return i.appendChild(a),!t.hideDescription&&(e.artefactType||e.alive?t.description?r=t.description instanceof Element?t.description:e4("p",{text:t.description}):e.description&&(r=e4("p",{text:e.unknown&&e.unknownDescription?e.unknownDescription:e.description})):r=at(e)),r&&i.appendChild(r),t.hideTraits||i.appendChild(function(e,t,r){if(!e.artefactType&&!e.alive)return at(e);let i=document.createElement("ul");if(r){let t=e.storeManager?.getPurseValue();t&&i.appendChild(e4("li",{text:`${t.toFixed(2)}\u{00A0}GP`}))}let a=[];for(let r of(e.traits?.getAllTraits().forEach((r,i)=>{if(!t.includes(i)&&!i.startsWith("_")){var n;let t;if(e.traits.hasEffective?.(i)){let t=e.traits.getEffectiveInt(i),a=P(r);if(t!==a){let e=t-a;r=`${t} [${a}${e<0?"-":"+"}${e}]`}}a.push([((t=e8.getText(i))===i&&(t=i?.replace("_"," ")),t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()),(n=r,/\d*\.?\d* *[CSGP]P/.test(n)||/\d+D\d+(?: *[+-]? *\d+)?/.test(n)?n:Array.isArray(n)?n.map(e=>e.toLowerCase()):"string"==typeof n?n.toLowerCase():n)])}}),a.sort((e,t)=>e[0]<t[0]?-1:1),a)){let e=r[0],t=r[1];if(t&&"0"!==t){let r=Array.isArray(t)?t.join(", "):t,a=document.createElement("li"),n=e4("span",{text:`${e}: `}),s=e4("span",{text:r});i.appendChild(a),a.appendChild(n),a.appendChild(s)}}return i}(e,["NAME"],!0)),i}function at(e){let t;if(e.isHero()){let r=e.traits.get("NAME");t=e1`MESSAGE HERO EPITAPH FOR ${r}`}else t=e1`MESSAGE GENERIC EPITAPH`;return e4("p",{text:t})}function ar(e,t,r){let i=e4("div",{className:"trade"}),a=e4("div",{className:"side-by-side"});i.appendChild(a);let n=e4("div",{}),s=e4("div",{});a.appendChild(n),a.appendChild(s),n.appendChild(i7(e)),s.appendChild(i7(t));let o=r?iQ.PILLAGE:iQ.SELL,l=new i1({currentOwner:e,prospectiveOwner:t,actionType:o,showPrice:!0}),h=new i1({currentOwner:t,prospectiveOwner:e,actionType:o,showPrice:!0},{limitation:r?i0.STANDARD:i0.STASH_ONLY});l.linkedInventory=h,h.linkedInventory=l,n.appendChild(l.element),s.appendChild(h.element);let c=new eX({label:e1`BUTTON CONTINUE`});c.closes=e2.CANCEL;let u=[];return u.push(c),te.showControlsDialog(i,{preamble:r?e1`DIALOG TITLE PILLAGE`:e1`DIALOG TITLE TRADE`,actionButtons:u})}function ai(e,t={}){let r,i,a;let n=document.createElement("div");n.appendChild(e4("span",{text:e1`Dungeon floor: ${rg(iJ.getCurrentSceneLevel())}`}));let s=e4("div",{className:"actor-container"});n.appendChild(s);let o=ae(e,{hideTraits:!0,description:t.description});return s.appendChild(o),!e.isProp()&&(i=new eX({label:e1`BUTTON INVENTORY`,action:()=>i3(e,{allowConsumption:t.allowConsumption,allowMagicUse:t.allowMagicUse}).then(()=>{s.replaceChildren(ae(e,{hideTraits:!0,description:t.description})),r&&!e.alive&&(n.removeChild(r),r=void 0)})}),n.appendChild(i.element),i=new eX({label:e1`BUTTON TRAITS`,action:()=>(function(e){let t=document.createElement("div");return t.appendChild(ae(e,{hideDescription:!0})),te.showControlsDialog(t)})(e)}),n.appendChild(i.element),i=new eX({label:e1`BUTTON MAGIC`,action:()=>i3(e,{allowMagicUse:!1,limitation:i0.MAGIC})}),n.appendChild(i.element),t.allowRest&&(r=(i=new eX({label:e1`BUTTON REST`,action:()=>(function(e){let t=e.storeManager.getStore(tU.BACKPACK),r=[],i=[];t.values().forEach(e=>{if(e.artefactType===tH.CONSUMABLE){let t=e.traits.get("TYPE");"MEAL"===t?r.push(e):"DRINK"===t&&i.push(e)}});let a=document.createElement("div");a.appendChild(i7(e)),a.appendChild(e4("p",{text:e1`MESSAGE EXPLAIN REST`}));let n=[],s=-1,o=-1,l=function(e,t,r){let i={possible:!0,failure:tA.NONE},a={possible:!0,failure:tA.NONE},n=r.get("HIT_DICE","0D6");return!n||1>th(n)?(i.possible=!1,i.failure=tA.NEED_LONG_REST):(e<1||t<1)&&(i.possible=!1,i.failure=tA.NEED_MORE_RATIONS),(e<3||t<3)&&(a.possible=!1,a.failure=tA.NEED_MORE_RATIONS),{shortRest:i,longRest:a}}(r.length,i.length,e.traits),h="";return l.shortRest.possible||(h=l.shortRest.failure===tA.NEED_LONG_REST?e1`MESSAGE CANNOT REST SHORT NEED LONG REST`:e1`MESSAGE CANNOT REST SHORT NEED RATIONS`,a.appendChild(e4("p",{text:h}))),l.longRest.possible||(h=e1`MESSAGE CANNOT REST LONG NEED RATIONS`,a.appendChild(e4("p",{text:h}))),l.shortRest.possible&&(s=n.length,n.push(e1`BUTTON REST SHORT`)),l.longRest.possible&&(o=n.length,n.push(e1`BUTTON REST LONG`)),n.push(e1`BUTTON CONTINUE`),te.showChoiceDialog(e1`DIALOG TITLE CHOICES`,a,n).then(a=>{if(a===s){i8(t,r,1),i8(t,i,1);let a=tI(e,"SHORT");return te.showOkDialog(e1`MESSAGE REST SHORT HP GAIN ${a.newHp-a.oldHp}`)}if(a===o){i8(t,r,3),i8(t,i,3);let a=tI(e,"LONG");return(function(e){let t=e4("div",{className:"inventory"});t.appendChild(ae(e,{hideDescription:!0,hideTraits:!0}));let r=new i1({currentOwner:e,prospectiveOwner:e,allowSpellPrep:!0},{limitation:i0.SPELLS});return t.appendChild(r.element),te.showControlsDialog(t,{title:e1`DIALOG TITLE PREPARE SPELLS`,preamble:e1`MESSAGE EXPLAIN SPELL PREP`})})(e).then(()=>te.showOkDialog(`MESSAGE REST LONG HP GAIN ${a.newHp-a.oldHp}`))}})})(e).then(()=>o.replaceWith(ae(e,{hideTraits:!0})))})).element,n.appendChild(i.element)),t.allowMagicUse&&(a=a??[],(i=new eX({label:e1`BUTTON CAST SPELL`})).closes="CAST SPELL",a.push(i))),a&&((i=new eX({label:e1`BUTTON CONTINUE`})).closes=e2.CANCEL,a.push(i)),te.showControlsDialog(n,{okButtonLabel:t.okButtonLabel,actionButtons:a}).then(t=>"CAST SPELL"===t?function(e){let t=e4("div",{className:"inventory"}),r=new i1({currentOwner:e,prospectiveOwner:e,allowMagicUse:!0,showDamage:!0,delayedReaction:!0},{limitation:i0.READY_MAGIC});t.appendChild(r.element);let i=new eX({label:e1`BUTTON CONTINUE`,closes:e2.CANCEL});return te.showControlsDialog(t,{title:e1`DIALOG TITLE PICK SPELL TO CAST`,actionButtons:[...r.actionButtons,i]})}(e):Promise.resolve())}function aa(e){var t;e.prospectiveOwner||(e.prospectiveOwner=e.currentOwner);let r=e.currentOwner?.storeManager,i=e.prospectiveOwner.storeManager,a=e.artefact,n=e.hideTraits;return(e.artefact?.unknown?tR((e.prospectiveOwner??e.currentOwner).traits,{ability:"WIS",difficulty:(t=e.artefact.traits).get("IDENTIFY_DC",tT.EASY),proficiency:t.get("SUBTYPE")})?(e.artefact.unknown=!1,te.showOkDialog(e1`MESSAGE IDENTIFIED ITEM`).then(()=>!0)):te.showOkDialog(e1`MESSAGE FAILED TO IDENTIFY`).then(()=>!1):Promise.resolve(!0)).then(t=>(t||(e.hideTraits=!0),function(e){let t=e.artefact,r=e4("div",{className:"use-weapon-dialog"});r.appendChild(ae(t,e));let i=function(e,t){if(t.currentOwner===t.prospectiveOwner||!t.prospectiveOwner)return i2(e,t);switch(t.actionType){case iQ.FIND:return function(e,t){let r;let i=[],a=t.prospectiveOwner.storeManager.findSuitableStore(t.artefact);if(a){let e,t;a.storeType===tU.CANTRIPS||a.storeType===tU.SPELLS||a.storeType===tU.READY_SPELLS?(e=e1`BUTTON LEARN SPELL`,t=i4.LEARN_SPELL):(e=e1`BUTTON TAKE ARTEFACT`,t=i4.TAKE),r=new eX({label:e,closes:t}),i.push(r)}else e.appendChild(i9(t));return r=new eX({label:e1`BUTTON LEAVE ARTEFACT`,closes:i4.LEAVE}),i.push(r),i}(e,t);case iQ.SELL:return function(e,t){let r;if(t.artefact.artefactType===tH.COINS)return;let i=[],a=t.artefact.costInGp;if((r=t.prospectiveOwner.isTrader()?Number.MAX_SAFE_INTEGER:t.prospectiveOwner.storeManager.getPurseValue())<t.artefact.costInGp){e.appendChild(e4("p",{className:"guidance",text:e1`MESSAGE INSUFFICIENT FUNDS ${a.toFixed(2)} ${r.toFixed(2)}`})),t.currentOwner.isTrader()||i2(e,t);return}if(!t.prospectiveOwner.storeManager.findSuitableStore(t.artefact)){e.appendChild(i9(t)),t.currentOwner.isTrader()||i2(e,t);return}let n=new eX({label:t.currentOwner.isTrader()?e1`BUTTON BUY FOR GP ${t.artefact.costInGp.toFixed(2)}`:e1`BUTTON SELL FOR GP ${t.artefact.sellBackPriceInGp.toFixed(2)}`,closes:i4.SELL});return i.push(n),i.push(n=new eX({label:e1`BUTTON CONTINUE`,closes:i4.CONTINUE})),i}(e,t);case iQ.PILLAGE:return function(e,t){if(t.currentOwner.alive)return i2(e,t);let r=[];if(!t.prospectiveOwner.storeManager.findSuitableStore(t.artefact)){e.appendChild(i9(t)),t.currentOwner.alive&&i2(e,t);return}let i=new eX({label:e1`BUTTON PILLAGE`,closes:i4.PILLAGE});return r.push(i),r.push(i=new eX({label:e1`BUTTON LEAVE ARTEFACT`,closes:i4.CONTINUE})),r}(e,t);case iQ.VIEW:default:return[]}}(r,e);return te.showControlsDialog(r,{preamble:e.preamble,actionButtons:i,row:!0})}(e))).then(t=>{switch(e.hideTraits=n,t){case i4.CONSUME:return r.discard(a),a.interaction.react(e.currentOwner);case i4.DISCARD:r.discard(a);break;case i4.PREPARE_SPELL:case i4.EQUIP:i.equip(a);break;case i4.LEARN_SPELL:if(a.isMagic()&&i.hasArtefactWithSameId(a))return te.showOkDialog(e1`MESSAGE SPELL ALREADY KNOWN`);if(r.discard(a),i.findSuitableStore(a).add(a),a.artefactType===tH.SPELL)return te.showOkDialog(e1`MESSAGE EXPLAIN SPELL NEEDS REST`);break;case i4.PILLAGE:r.discard(a),i.findSuitableStore(a).add(a);break;case i4.SELL:{let t=e.currentOwner.isTrader()?a.costInGp:a.sellBackPriceInGp;r.addToPurse(t),e.prospectiveOwner.isTrader()||i.takeFromPurse(t),r.discard(a),a.stashInWagon&&!i.hasWagon?i.equip(a,{direct:!0}):i.stash(a,{direct:!0})}break;case i4.STASH:i.stash(a)||te.showOkDialog(e.prospectiveOwner.isTrader()?e1`MESSAGE TRADER CANNOT STASH`:e1`MESSAGE CANNOT STASH`);break;case i4.TAKE:r?.discard(a),a.stashInWagon&&!i.hasWagon?i.equip(a,{direct:!0}):i.stash(a,{direct:!0});break;case i4.USE:return a.interaction.react(e.currentOwner)}return Promise.resolve()})}function an(e){let t=e4("div"),r=rg(iJ.getCurrentSceneLevel()+1);return t.appendChild(e4("p",{text:e1`MESSAGE REST DIALOG ${r}`})),ai(e,{allowConsumption:!0,allowRest:!0,description:t,okButtonLabel:e1`BUTTON CONTINUE`})}let as={SETBACK:{dc:11,bonus:4,damage:["1D10","2D10","4D10","10D10"]},DANGEROUS:{dc:14,bonus:7,damage:["2D10","4D10","10D10","18D10"]},DEADLY:{dc:18,bonus:11,damage:["4D10","10D10","18D10","24D10"]}};function ao(e,t){let r=document.createElement("div"),i=document.createElement("p");i.innerText=e,r.appendChild(i);let a=document.createElement("p");return a.innerText=t,r.appendChild(a),r}function al(e,t,r){if(tt.playEffect("POISONED"),r>0)return E.debug("Poison applied"),eH(eS.getSpriteBitmap("skull.png"),{delaySecs:0,lifetimeSecs:1,position:t.position,velocity:new L(0,0,0)}),ah(e,t,r);eH(eS.getSpriteBitmap("miss.png"),{delaySecs:0,lifetimeSecs:1,position:t.position,velocity:new L(0,0,0)}),E.debug("Poison resisted.")}function ah(e,t,r){if(!r||!t.alive||t.isProp()||t.isHiddenArtefact())return 0;let i=t.traits.get("HP",0);if(i=Math.max(0,i-r),t.traits.set("HP",i),0===i){if(tt.playEffect(t.traits.get("SOUND","DIE")),E.info("Killed actor."),t.interaction=new ad(t),t.alive=!1,e?.isHero?.()){let r;let i=e.traits.adjustForDefeatOfActor(t.traits);i.level.now>i.level.was?r=e1`LEVEL UP ${i.level.now}`:i.exp.now>i.exp.was&&(r=`+${i.exp.now-i.exp.was} EXP`),r&&e$(r,e.position,t5.HP_TRANSIENT_TEXT_HERO)}}else{let e=t.isHero()?t5.HP_TRANSIENT_TEXT_HERO:t5.HP_TRANSIENT_TEXT_ENEMY;e$(`-${r} HP`,t.position,e)}return i}class ac{owner;constructor(e){this.owner=e}enact(e){return Promise.resolve()}react(e){return Promise.resolve()}canReact(){return!1}canEnact(){return!1}respectDisengage(e){return!1}}class au extends ac{constructor(e){super(e)}canEnact(){return!0}canReact(){return!0}enact(e){return this.#rD(this.owner,e)}react(e){return this.#rD(e,this.owner)}respectDisengage(e){return!0}#rL(e,t){let r=D.copy(e.position);return new eG({path:[new D(e.position.x+.2*(t.position.x-e.position.x),e.position.y+.2*(t.position.y-e.position.y)),r],speed:100}).applyAsTransientToSprite(e.sprite)}#rM(e,t){if(e.isHero())return this.#rb(e,t);switch(e.attackMode){case aA.COMBO:return this.#r_(e,t);case aA.POISON:return new am(e).enact(t);case aA.MAGIC:case aA.RANGED:return new aS(e).react(e);case aA.COMBAT:default:return this.#rz(e,t)}}#r_(e,t){let r=t.traits.getInt("HP");return this.#rb(e,t).then(i=>i<=0?i:e.traits.has("DMG_POISON")?i<r?new am(e).enact(t):Promise.resolve(i):this.#rb(e,t))}#rz(e,t){if(!e.isHero()){let t=e.storeManager,r=t.getStore(tU.PREPARED_SPELLS).getFirst();if(r||(r=t.getStore(tU.CANTRIPS).getFirst()),r)return r.interaction.react(e)}return this.#rb(e,t)}#rb(e,t){let r=0,i=0;return e.traits.getAttacks().forEach(e=>{let a=ty(e,t.traits);a>0&&(i++,r+=a)}),new Promise(a=>{if(r<=0){tt.playEffect("MISS"),eH(eS.getSpriteBitmap("miss.png"),{delaySecs:0,lifetimeSecs:1,position:t.position,velocity:new L(0,0,0)}),a(t.traits.getInt("HP",0));return}let n=i>1?"DOUBLE PUNCH":"PUNCH",s=i>1?"blood-splat-twice.png":"blood-splat.png";tt.playEffect(n),eH(eS.getSpriteBitmap(s),{delaySecs:0,lifetimeSecs:1,position:t.position,velocity:new L(0,0,0)}),a(ah(e,t,r))})}#rD(e,t){return E.info(`${e.traits?.get("NAME")} attacks ${t.traits.get("NAME")}`),this.#rL(e,t).then(()=>this.#rM(e,t))}}class ad extends ac{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){return ar(e,this.owner,!0)}}class af extends ac{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}react(e){return this.owner.traits.get("NO_TRADE")?te.showOkDialog([e1`MESSAGE TRADER WILL NOT TRADE`,e1`MESSAGE TRADERS PROTECTED`]):te.showChoiceDialog(e1`DIALOG TITLE CHOICES`,e1`MESSAGE TRADE STEAL OR BARGE`,[e1`BUTTON TRADE`,e1`BUTTON STEAL`,e1`BUTTON BARGE`]).then(t=>0===t?ar(e,this.owner,!1):1===t?this.#rk(e):this.#rG(e))}#rk(e){if(!tR(e.traits,{ability:"DEX",difficulty:this.owner.traits.getInt("DC",tT.HARD),proficiency:"STEALING"}))return this.owner.traits.set("_NO_TRADE",!0),te.showOkDialog(e1`MESSAGE TRADER ATTACKS BACK`).then(()=>new au(this.owner).enact(e));{let t=N(1,this.owner.traits.getInt("MAX_THEFT",1));return e.storeManager.addToPurse(t),te.showOkDialog(e1`MESSAGE STOLE GOLD ${t}`)}}#rG(e){let t=D.copy(this.owner.position),r=D.copy(e.position);return Promise.all([eB(e,t),eB(this.owner,r)])}}class ap extends ac{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){this.owner.alive=!1;let t=this.owner.storeManager.getFirstStorageDetails();if(!t)return te.showOkDialog(e1`MESSAGE NOTHING MORE TO DISCOVER`);{let r=t.artefact;if(r.isTrap()){let t=await r.interaction.react(e);if(t.outcome===aE.LEAVE)return this.owner.alive=!0,Promise.resolve();if(this.owner.storeManager.discardStashed(r,!0),!t.artefact)return Promise.resolve();r=t.artefact,this.owner.storeManager.stash(r,{direct:!0})}else if(r.isMagic()&&!function(e,t){let r=e.getCharacterLevel(),i=t.getInt("LEVEL",0);if(i>1+8*(r-1)/16)return E.info(`${e.get("NAME")} cannot learn level ${i} ${t.get("NAME")} as too high.`),!1;let a=t.get("CASTERS");if(!a)return E.info(`No casters set for ${t.get("NAME")} so can be learned.`),!0;let n=e.get("CLASS");return!!a.includes(n)||(E.info(`${e.get("NAME")} cannot learn ${t.get("NAME")} as not in casters.`),!1)}(e.traits,r.traits))return te.showOkDialog(e1`MESSAGE CANNOT UNDERSTAND MAGIC`);return aa({preamble:this.#rB(r),currentOwner:this.owner,prospectiveOwner:e,storeType:t.store.storeType,artefact:r,actionType:iQ.FIND,hideTraits:r.isMagic()})}}#rB(e){return this.owner.type===ax.HIDDEN_ARTEFACT?e1`MESSAGE FOUND HIDDEN ARTEFACT`:e.isMagic()?e1`MESSAGE FOUND ENGRAVING`:e1`MESSAGE FOUND GENERIC`}}class am extends ac{constructor(e){super(e)}canEnact(){return!0}canReact(){return!1}enact(e){let t=tx(this.owner.traits,e.traits);return al(this.owner,e,t),t&&e.toxify?.addToxicEffect(this.owner.traits),e.traits.addTransientFxTraits(this.owner.traits),Promise.resolve()}}class ag extends ac{#rU;constructor(e){super(null),this.#rU=e??new rm}canEnact(){return!0}canReact(){return!1}enact(e){if(this.#rU.isActive)return al(null,e,-this.#rU.getChangeInHpThisTurn()),Promise.resolve()}addToxicEffect(e){let t=-e.getFloat("DMG_PER_TURN",0);t&&(E.debug(`Add toxic effect of ${t} HP/turn`),this.#rU.addToxicEffect(t))}cure(){this.#rU.cure()}get isActive(){return this.#rU.isActive}getToxin(){return this.#rU}}class aS extends ac{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){if("BLESS"===this.owner.traits.get("MODE"))return this.#rH(e);let t=ed.getTileMap(),r=t.worldPointToGrid(e.position),i=this.owner.traits.getValueInFeetInTiles("RANGE",1),a=this.owner.traits.getInt("MAX_TARGETS",999),n=0,s=0;for(let c of t.getRadiatingUpAndDown(r,i)){if(n>=a)break;for(let t of[...c.getOccupants().values()].sort((e,t)=>t.traits.getInt("HP")-e.traits.getInt("HP")))if(this.#rF(e,t)){var o,l,h;s++;let r=(o=e.traits,l=t.traits,"MELEE"===(h=this.owner.traits).get("MODE")?function(e,t,r){let i=e.get("SPELL_CAST","INT"),a=e.getEffectiveInt(i,1);return ty(new tN({damageDice:r.getDamageDiceWhenCastBy?r.getDamageDiceWhenCastBy(e):r.get("DMG","1D4"),weaponType:"UNARMED",proficiencyBonus:e.getCharacterPb(r),abilityModifier:tC(a)}),t)}(o,l,h):function(e,t,r){let i;let a=t.getNonMeleeSaveAbilityModifier(r),n=0;if(e.get("ATTACK")===aA.RANGED)i="Ranged attack";else{i="Magic";let t=e.get("SPELL_CAST","INT"),a=e.getInt(t,1);n=e.getCharacterPb(r)+tC(a)}let s=r.getInt("DC");null==s&&(E.error(`${i} ${e.get("NAME")} has no DC set.`),s=0);let o=s+n,l=ts(20)+a,h=tl(r.getDamageDiceWhenCastBy?r.getDamageDiceWhenCastBy(e):r.get("DMG","1D4"));return(E.info(`${i}: saving throw ${l} vs target DC ${o}`),l>=o)?Math.round(r.getFloat("DMG_SAVED",0)*h):h}(o,l,h));r>0?(this.#r$(c.worldPoint),n++,ah(e,t,r),t.traits.addTransientFxTraits(this.owner.traits)):this.#rY(c.worldPoint)}}return 0===s&&this.#rY(e.position),this.owner.artefactType===tH.SPELL&&function(e,t){let r=Math.round(1+5*(t.getInt("LEVEL",1)-1)/8),i=function(e){let t=e.getInt("CASTING_POWER");return e.has("CASTING_POWER")?t:tE(e)}(e);e.set("CASTING_POWER",Math.max(0,i-r))}(this.enactor.traits,this.owner.traits),Promise.resolve()}#rH(e){if(!e.isHero())return;if(!function(e,t,r){let i=r.getInt("MAX_TARGET_HP",1),a=t.getInt("HP");return a>i?(E.info(`Targets's HP (${a}) is above max target hp of ${i}. Spell failed.`),!1):a<=i}(e.traits,e.traits,this.owner.traits)){this.#rY(e.position);return}let t=function(e,t,r){if(!r.has("HP_GAIN"))return 0;let i=tl(r.getHpGainDiceWhenCastBy?r.getHpGainDiceWhenCastBy(e):r.get("HP_GAIN",0)),a=t.getInt("HP");return Math.min(i,t.getInt("HP_MAX")-a)}(e.traits,e.traits,this.owner.traits);return this.#r$(e.position),t>0&&(e.traits.addInt("HP",t),e$(`+${t}HP`,e.position,t5.HP_TRANSIENT_TEXT_HERO)),Promise.resolve()}#rF(e,t){return e.isHero()?t.isEnemy()&&t.alive:t.isHero()&&t.alive}#r$(e){!function(e,t){let r=new eA({prefix:e,suffix:".png",startIndex:0,padding:2},{framePeriodMs:300,loopMethod:eT.REVERSE});eU(new ev(ei.getContext2D(),r),t)}(this.owner.traits.get("EFFECT").toLowerCase(),{position:e,delaySecs:0,lifetimeSecs:2})}#rY(e){eH(eS.getSpriteBitmap("failed-spell.png"),{position:e,delaySecs:0,lifetimeSecs:2})}}class aw extends ac{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){let t=this.owner.traits.get("TYPE");if("POISON"===t){let t=tx(this.owner.traits,e.traits);return 0===t?te.showOkDialog(e1`MESSAGE RESISTED POISON`):0>=al(this.owner,e,t)?te.showOkDialog(e1`MESSAGE KILLED BY POISON`):te.showOkDialog(e1`MESSAGE IT'S POISON ${t}`)}{let r=function(e,t){let r=e.getInt("HP",0),i=t.getInt("HP",0),a=t.getInt("HP_MAX",i)-i;return{shortFall:a,oldHp:i,newHp:i+(a<0?0:Math.min(a,r))}}(this.owner.traits,e.traits),i=r.newHp-r.oldHp;if(r.shortFall<=0)return te.showOkDialog(e1`MESSAGE CONSUME BUT ALREADY FULL HP`);if(0===i)return te.showOkDialog(e1`MESSAGE CONSUME BUT NO HP GAIN`);let a="MEDICINE"===t?e1`MESSAGE IT'S A HEALTHY DRINK ${i}`:e1`MESSAGE IT'S HEALTHY ${i}`;return te.showOkDialog(a).then(()=>e.traits.set("HP",r.newHp))}}}let aE={ATTEMPT_DISABLE:"attempt disable",LEAVE:"leave",DISABLED:"disabled",TRIGGERED:"triggered"};class aT extends ac{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){let t,r=null,i=function(e,t){let r;let i=as[t.get("SEVERITY","SETBACK")]??as.SETBACK;return r=e<5?i.damage[0]:e<11?i.damage[1]:e<17?i.damage[2]:i.damage[3],{difficulty:i.dc,attack:new tN({damageDice:r,weaponType:"TRAP",proficiencyBonus:0,abilityModifier:i.bonus}),detectBy:t.get("DETECT_BY","WIS"),disableBy:t.get("DISABLE_BY","INT"),reward:t.get("REWARD")}}(e.traits.getCharacterLevel(),this.owner.traits),a=await this.#rW(e.traits,i);switch(a){case aE.TRIGGERED:return E.info("Trigger the trap."),(0===(t=ty(i.attack,e.traits))?function(e,t,r){return te.showElementOkDialog(e1`DIALOG TITLE TRAP TRIGGERED SURVIVED`,ao(r,e1`MESSAGE TRAP TRIGGERED SURVIVED`))}:function(e,t,r){return te.showElementOkDialog(e1`DIALOG TITLE TRAP TRIGGERED INJURED`,ao(r,e1`MESSAGE TRAP TRIGGERED INJURED`))})(e,i,this.owner.description).then(()=>this.#rK(e,t)).then(()=>({outcome:a,artefact:r}));case aE.DISABLED:return E.info("Disabled the trap."),r=function(e,t=["MONEY"]){let r=tG.findById(e,t);return r?tB(r):(E.error(`Could not find artefact ${e} in ${t} almanacs.`),null)}(i.reward),(this.owner.description,te.showOkDialog(e1`DIALOG TITLE TRAP DISABLED`,ao(e1`MESSAGE TRAP DISABLED`))).then(()=>({outcome:a,artefact:r}));case aE.LEAVE:return E.info("Left the trap."),Promise.resolve({outcome:a,artefact:r})}}#rK(e,t){return new Promise(r=>{tt.playEffect("TRIGGER TRAP"),t<=0?eH(eS.getSpriteBitmap("miss.png"),{delaySecs:1,lifetimeSecs:3,position:e.position,velocity:new L(0,0,0)}):(eH(eS.getSpriteBitmap("blood-splat.png"),{delaySecs:1,lifetimeSecs:3,position:e.position,velocity:new L(0,0,0)}),ah(this.owner,e,t)),r()})}#rW(e,t){return tR(e,{ability:t.detectBy,difficulty:t.difficulty,proficiency:"TRAPS"})?(this.owner.description,te.showChoiceDialog(e1`DIALOG TITLE TRAP DETECTED`,e1`MESSAGE TRAP ATTEMPT DISABLE`,[e1`BUTTON TRAP DISABLE`,e1`BUTTON TRAP LEAVE`]).then(e=>0===e?aE.ATTEMPT_DISABLE:aE.LEAVE)).then(r=>r===aE.LEAVE?r:tR(e,{ability:t.disableBy,difficulty:t.difficulty,proficiency:"TRAPS"})?aE.DISABLED:aE.TRIGGERED):Promise.resolve(aE.TRIGGERED)}}class ay extends ac{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){return this.#rV(e,this.owner)}#rV(e,t){let r=new eG({path:[t.position],speed:5});eH(eS.getSpriteBitmap("portal.png"),{delaySecs:0,lifetimeSecs:6,position:t.position,velocity:new L(0,0,3)}),new eM(0,3,new e_).applyAsTransientToSprite(e.sprite,20);let i=new eM(0,3,new e_);return r.applyAsTransientToSprite(e.sprite).then(()=>i.applyAsTransientToSprite(e.sprite))}}let ax={HERO:0,ENEMY:1,ARTEFACT:2,HIDDEN_ARTEFACT:3,TRADER:4,PROP:5,OBJECTIVE:6},aA={COMBAT:"COMBAT",COMBO:"COMBO",POISON:"POISON",MAGIC:"MAGIC",RANGED:"RANGED"},aI={WANDER:"WANDER",HUNT:"HUNT",ORGANIC:"ORGANIC"};class aR extends t1{almanacEntry;#rX;sprite;traits;interaction;toxify;alive;disengaging;description;iconImageName;storeManager;type;adventureStartTime;constructor(e,t=ax.ENEMY){super(),this.interaction=new ac,this.sprite=e,this.sprite.obstacle=!0,this.#rX=!1,this.alive=!0,this.disengaging=!1,this.type=t,this.storeManager=new tW(t===ax.TRADER||t===ax.HIDDEN_ARTEFACT,()=>this.#rq()),t===ax.HERO&&(this.adventureStartTime=new Date().getTime())}#rq(){let e=this.storeManager.getAllEquippedArtefacts(),t=e.filter(e=>e.artefactType===tH.WEAPON||e.artefactType===tH.TWO_HANDED_WEAPON),r=e.filter(e=>e.artefactType===tH.ARMOUR),i=e.filter(e=>e.artefactType===tH.SHIELD),a=e.filter(e=>e.isMagic()||e.artefactType===tH.RING);this.traits.utiliseAdditionalTraits({weapons:t.map(e=>e.traits),armour:r.map(e=>e.traits),shields:i.map(e=>e.traits),magic:a.map(e=>e.traits)})}freezeMovement(){this.#rX=!0}getMaxTilesPerMove(){return this.#rX?0:this.traits.getMaxTilesPerMove()}isHero(){return this.type===ax.HERO}isEnemy(){return this.type===ax.ENEMY}isTrader(){return this.type===ax.TRADER}isHiddenArtefact(){return this.type===ax.HIDDEN_ARTEFACT}set visible(e){this.sprite.visible=e}get visible(){return this.sprite.visible}get obstacle(){return this.sprite.obstacle}set obstacle(e){this.sprite.obstacle=e}get position(){return this.sprite.position}set position(e){this.sprite.position=e}get velocity(){return this.sprite.velocity}set velocity(e){this.sprite.velocity=e}getImageFilename(){return this.sprite.getImageFilename()}isWandering(){return this.traits?.get("MOVE")===aI.WANDER}isOrganic(){return this.traits?.get("MOVE")===aI.ORGANIC}isProp(){return this?.type===ax.PROP}isObjective(){return this?.type===ax.OBJECTIVE}get moveType(){return this?.traits.get("MOVE")}get attackMode(){return this?.traits.get("ATTACK",aA.COMBAT)}willInteract(){return!!this.interaction&&(!this.isWandering()||ts(6)>3)}isPassableByActor(e){return!!(e.isHero()&&this.isHiddenArtefact())||!this.alive&&!this.isProp()||!this.obstacle}canShareLocationWithActor(e){return this.isOrganic()?!e.isOrganic()&&!e.isTrader():this.isHiddenArtefact()?e.isHero():!!(!this.alive&&e.isHero())||!this.obstacle}update(e){this.sprite.update(e)}actionClick(e){super.actionClick(this.sprite.position)}actionContextClick(e){super.actionContextClick(this.sprite.position)}actionPointerUp(e){super.actionPointerUp(this.sprite.position)}actionPointerDown(e){super.actionPointerDown(this.sprite.position)}toJSON(){let e=this.storeManager.getAllStorageDetails(),t=[];for(let r of e)t.push({storeTypeId:r.store.storeTypeId,artefact:r.artefact});return{reviver:"Actor",data:{adventureStartTime:this.adventureStartTime,alive:this.alive,almanacEntry:this.almanacEntry,traits:this.traits,inventory:t,toxin:this?.toxify.getToxin()}}}static revive(e,t){let r=t(e.almanacEntry,e.traits);for(let t of(r.adventureStartTime=e.adventureStartTime,r.alive=e.alive,r.toxify=new ag(e.toxin),e.inventory)){let e=r.storeManager.getStoreByTypeId(t.storeTypeId);if(!e){E.error(`Unable to find store matching ${t.storeTypeId}. Game restore abandoned.`);return}e.add(t.artefact)}return r}}let aO=new Map,aC=!1;function aN(e,t){let r=ei.glassPositionToWorld(t.position),i=t.sprite.getBoundingBox();return new _(r.x-i.width/2,r.y-i.height/2,i.width,i.height).containsCoordinate(e.world.x,e.world.y)}function aP(e){if(!aC||!aC)return!1;for(let[t,r]of aO)if(aN(e,r))return r.actionPointerUp(r,e.canvas),!0;return!1}var av={addButton:function(e,t,r){let i=new aR(new eD({renderer:new ev(ei.getContext2D(),e)}));return aO.set(i,i),i.setOnClick(()=>{r?0===e.getCurrentIndex()?(e.setCurrentIndex(1),t()):(e.setCurrentIndex(0),r()):t()}),e.setCurrentIndex(0),i},addMomentaryButton:function(e,t,r){let i=new aR(new eD({renderer:new ev(ei.getContext2D(),e)}));return aO.set(i,i),i.setOnPointerDown(()=>{e.setCurrentIndex(1),t?.()}),i.setOnPointerUp(()=>{e.setCurrentIndex(0),r?.()}),i},clear:function(){aO.clear()},removeButton:function(e){aO.delete(e)},update:function(e){aC&&aO.forEach(t=>{let r=b.copy(t.position);t.position=ei.glassPositionToWorld(t.position),t.update(e),t.position=r})},resolvePointerCancel:function(e){return aP(e)},resolveClick:function(e){if(!aC)return!1;for(let[t,r]of aO)if(aN(e,r))return r.actionClick(r,e.canvas),!0;return!1},resolveContextMenu:function(e){return!1},resolvePointerDown:function(e){if(!aC||!aC)return!1;for(let[t,r]of aO)if(aN(e,r))return r.actionPointerDown(r,e.canvas),!0;return!1},resolvePointerUp:aP,setVisible:function(e){aC=e}};let aD={GRINNING:"\uD83D\uDE00",SANTA:"\uD83C\uDF85",SHAKING:"\uD83E\uDEE8"};class aL{#rj;#rZ;#rJ;#rQ;#r4;constructor(e){this.#rj=N(e.minCols,e.maxCols),this.#rZ=N(e.minRows,e.maxRows),this.#rJ=e.maxRoomCols,this.#rQ=e.maxRoomRows}#r0(e=1){let t="";for(;e-- >0;)t+=C(tX.WALL);return t}#r1(e=1){let t="";for(;e-- >0;)t+=C(tX.GROUND);return t}#r8(e=1){let t="";for(;e-- >0;)t+=C(tX.VOID);return t}#r3(e=1){let t="";for(;e-- >0;)t+=C(tX.DOOR_IN);return t}#r2(e=1){let t="";for(;e-- >0;)t+=C(tX.DOOR_OUT);return t}#r5(e){return tX.WALL.includes(e)}#r6(e){return tX.GROUND.includes(e)}#r9(e){return tX.VOID.includes(e)}#r7(e){return tX.DOOR_IN.includes(e)}#ie(e){return tX.DOOR_OUT.includes(e)}generate(){this.#r4=[];let e=0,t=this.#rj;for(;this.#r4.length<this.#rZ-4;){let r=e+t-4-2,i=r>0?O(0,r):0,a=Math.max(e-i+4,4),n=Math.min(this.#rJ,this.#rj-i),s=n>a?O(a,n):a,o=this.#rj-i-s,l=O(4,Math.min(this.#rQ,this.#rZ-this.#r4.length));this.#it(i,s,o,l),e=i,t=s}return this.#ir(),this.#ii(),this.getMatrixAsStrings()}getMatrixAsStrings(){return this.#r4.map(e=>e.join(""))}#it(e,t,r,i){let a="";a+=this.#r8(e)+this.#r0(t)+this.#r8(r),this.#r4.push(a.split(""));for(let n=0;n<i-2;n++)a=""+this.#r8(e)+this.#r0(1)+this.#r1(t-2)+this.#r0(1)+this.#r8(r),this.#r4.push(a.split(""));a=""+this.#r8(e)+this.#r0(t)+this.#r8(r),this.#r4.push(a.split(""))}#ir(){for(let e=1;e<this.#r4.length-1;e++)for(let t=1;t<this.#r4[0].length-2;t++)this.#r5(this.#r4[e][t])&&this.#r5(this.#r4[e+1][t])&&this.#r6(this.#r4[e-1][t])&&this.#r6(this.#r4[e+2][t])&&(this.#r4[e][t]=this.#r1(1),this.#r4[e+1][t]=this.#r1(1))}#ia(e){return this.#r5(e.above)&&this.#r5(e.centre)&&this.#r5(e.below)}#is(e){return this.#r5(e.left)&&this.#r5(e.centre)&&this.#r5(e.right)}#ii(){let e=[];this.#r4.forEach((t,r)=>t.forEach((t,i)=>{let a=tK(this.#r4,r,i);(this.#is(a)||this.#ia(a))&&e.push({row:r,col:i})}));let t=tV(e),r=t[0];this.#r4[r.row][r.col]=this.#r3(),r=t[1],this.#r4[r.row][r.col]=this.#r2()}}let aM={MEDIUM:.25};class ab{#h;#rl;constructor(){this.reset()}getIndex(){return this.#h}getNext(){return this.#h++,0===this.#h&&(h=null),this.#io(),this.#rl}hasNext(){return!0}reset(){this.#h=-1}restore(e,t){h=t,this.#h=e}#io(){this.#rl=new iX,this.#il(),this.#ih(),this.#ic(),this.#iu(),this.#id(),this.#ip(),this.#im()}#ih(){this.#rl.intro=e1`MESSAGE ENTER FLOOR ${rg(this.#h)}`}#il(){if(!h){let e=tG.getRandomEntry("HEROES");e||E.fatal(Error("Could not find hero in almanacs.")),h=rp(e)}this.#rl.hero=h}#ic(e=aM.MEDIUM){let t=function(e,t){let r=e*(h?.traits.getCharacterLevel()??1)+.001;return tG.getAlmanac("ENEMIES").filter(e=>e.challengeRating<=r&&e.minLevel<=t)}(e,this.#h),r=0,i=0;for(;r<e&&i<8;){let e=t.getRandomEntry();r+=e.challengeRating,i++,this.#rl.enemies.push(e)}}#iu(){for(let e=0;e<1;e++){let e=tG.getRandomEntry("TRADERS",e=>e.minLevel<=this.#h);this.#rl.enemies.push(e)}}#id(){let e=tG.getPooledAlmanac(["ARTEFACTS","MAGIC","MONEY","WEAPONS","TRAPS","PLANTS"],e=>e.minLevel<=this.#h),t=N(4,12);for(;t-- >0;){let t=e.getRandomEntry();t&&this.#rl.artefacts.push(t)}}#im(){let e=tG.getRandomEntry("OBJECTIVES",e=>e.minLevel<=this.#h);e&&(this.#rl.objective=e)}#ip(){let e=new aL({minCols:12,maxCols:40,maxRoomCols:10,minRows:12,maxRows:40,maxRoomRows:6});this.#rl.mapDesign=e.generate()}}let a_="custom-pointer-down-event",az="custom-pointer-up-event",ak="custom-pointer-cancel-event",aG="custom-click-event",aB="custom-context-click-event",aU="custom-pointer-drag-event",aH={MOUSE:0,TOUCH:1};function aF(e,t,r){let i=new CustomEvent(t,{detail:r});e.dispatchEvent(i)}function a$(e){let t=e.target.getBoundingClientRect();return{x:e.touches[0].pageX-t.left,y:e.touches[0].pageY-t.top}}function aY(e,t,r,i){i.actionStarted=!0,i.dragging=!1,i.distance=0,i.lastX=t,i.lastY=r,i.startX=t,i.startY=r,aF(i.element,a_,{x:t,y:r})}function aW(e,t,r,i){let a=i.dragging?"custom-pointer-drag-end-event":az;i.actionStarted=!1,i.dragging=!1,i.distance=0,i.lastX=t,i.lastY=r,i.startX=t,i.startY=r,aF(i.element,a,{x:t,y:r})}function aK(e,t,r,i){let a=t-i.lastX,n=r-i.lastY;if(i.lastX=t,i.lastY=r,i.dragging){let e=new CustomEvent(aU,{detail:{x:t,y:r,dx:a,dy:n}});i.element.dispatchEvent(e)}else(Math.abs(t-i.startX)>10||Math.abs(r-i.startY)>10)&&(i.dragging=!0,i.suppressClickEvent=!0)}let aV=new Map([["BUTTON ABOUT","About"],["BUTTON BUY FOR GP","Buy for ${0}Â GP"],["BUTTON CANCEL","Cancel"],["BUTTON CAST SPELL","Cast spell"],["BUTTON CONSUME","Consume"],["BUTTON CONTINUE","Continue"],["BUTTON CLIMB OVER","Climb over"],["BUTTON BARGE","Barge past"],["BUTTON HALL OF FAME","Hall of fame"],["BUTTON DISCARD","Discard"],["BUTTON DO NOT SHOW AGAIN","Do not show again"],["BUTTON ENTER DUNGEON","Enter if you dare"],["BUTTON EQUIP","Equip"],["BUTTON FORGET","Forget"],["BUTTON GUIDES","About and Help"],["BUTTON HELP","Help"],["BUTTON INVENTORY","Inventory"],["BUTTON LEARN SPELL","Learn spell"],["BUTTON LEAVE ARTEFACT","Leave"],["BUTTON LEAVE IT","Leave it"],["BUTTON MAGIC","Magic"],["BUTTON MOVE","Move"],["BUTTON OK","OK"],["BUTTON PILLAGE","Pillage"],["BUTTON PLAY ADVENTURE","Start adventure"],["BUTTON PLAY CASUAL","Casual exploration"],["BUTTON PRIVACY","Privacy"],["BUTTON PREPARE SPELL","Prepare"],["BUTTON REST","Rest"],["BUTTON REST LONG","Long rest"],["BUTTON READY MAGIC","Ready Magic"],["BUTTON REST SHORT","Short rest"],["BUTTON SEARCH","Search"],["BUTTON SELL FOR GP","Sell for ${0}Â GP"],["BUTTON SETTINGS","Settings"],["BUTTON SHOW DEBUG LOG","The chronicles of Debug Loggerman"],["BUTTON START","Let's get started."],["BUTTON STASH","Stash"],["BUTTON STEAL","Steal"],["BUTTON TRAP DISABLE","Try to disable"],["BUTTON TRAP LEAVE","Leave it alone"],["BUTTON TAKE ARTEFACT","Take"],["BUTTON TRADE","Trade"],["BUTTON TRAITS","Traits"],["BUTTON TRY AGAIN","Try again"],["BUTTON TRY TO PICK","Pick lock"],["BUTTON USE","Use"],["CONTROL EFFECTS VOLUME","Effect volume"],["CONTROL MUSIC VOLUME","Music volume"],["CONTROL SHOW QUICK TIPS","Show quick tips"],["CONTROL START IN FULLSCREEN","Start in fullscreen"],["DESCRIPTION ACID_SPLASH","Casting this spell hurls acid over your enemies."],["DESCRIPTION AMBER","Precious fossilized tree resin, which is much sought after in these realms."],["DESCRIPTION ARCANE_ORB","Orb used by some users of magic to focus their spells."],["DESCRIPTION AQUAMARINE","A precious crystal of rare beauty."],["DESCRIPTION BARBARIAN1","You are a barbarian ready to battle to the end of this dungeon in search of wealth and glory."],["DESCRIPTION BERSERKER","A hatred crazed berserker."],["DESCRIPTION BLACK_FLASK","A black flask containing a clear, pungent liquid."],["DESCRIPTION BLACK_FLASK?SERPENT_VENOM","A black flask containing a clear, pungent liquid."],["DESCRIPTION BLUE_FLASK","A blue flask containing a clear, aromatic oil."],["DESCRIPTION BUGBEAR","A ferocious humanoid and evil creature bent on mayhem and carnage."],["DESCRIPTION BURNING_HANDS","Casting this spell with your thumbs touching and fingers spread creates a thin sheet of flames enveloping your enemies."],["DESCRIPTION CHAIN_MAIL_ARMOUR","Armour comprising interlocking steel rings over a soft cushioning fabric. The suit includes gauntlets."],["DESCRIPTION CHILL_TOUCH","Casting this spell assails your victims with the chill of the grave."],["DESCRIPTION CLERIC1","You are a powerful cleric who can act as a conduit between divine powers and the mortal world."],["DESCRIPTION CLUB","A simple wooden club that's seen a lot of action."],["DESCRIPTION COINS","Various coins stamped with the image of latter day kings and queens."],["DESCRIPTION COPPER_COINS","Old copper coins of low value."],["DESCRIPTION COPPER_DRAGON_WYRMLING","A very young copper dragon. Young, but capable of inflicting serious damage with its bite and claws."],["DESCRIPTION DAGGER","A short and very sharp piercing weapon."],["DESCRIPTION DIAMOND","A valuable and rare crystal."],["DESCRIPTION DRETCH","The lowest and least respected of all demons."],["DESCRIPTION ENGRAVED_PILLAR","A large stone pillar covered with mystical engravings."],["DESCRIPTION FIGHTER1","You are a fighter whose family have fallen out of favour. This is your chance to restore your family's good name."],["DESCRIPTION FIRE_BEETLE_PV","A giant fire beetle. Glowing gland radiate a fiery light across the dungeon."],["DESCRIPTION FIRE_BOLT","Casting this spell hurls fire at your victims."],["DESCRIPTION GARGOYLE","A chaotic evil gargoyle."],["DESCRIPTION GIANT_WASP_PV","A gigantic wasp making a deafening buzzing sound that echoes round the dungeon."],["DESCRIPTION GOBLIN","Small humanoid creature.Treat with caution. They're small but vicious."],["DESCRIPTION GOLD_COINS","Gold coins stamped with the image of latter day kings and queens."],["DESCRIPTION GHOUL","An undead creature, living amongst the dead and dying."],["DESCRIPTION HALF_PLATE_ARMOUR","Shaped metal plates covering most of the body. Simple greaves protect the legs."],["DESCRIPTION HANDAXE","A small, light axe. The blade is sharp and has been looked after with care."],["DESCRIPTION HIDDEN_ARTEFACT","The ground appears to have been disturbed."],["DESCRIPTION HUNTING_TRAP","A old battered hunting trap designed for catching monsters and humans."],["DESCRIPTION INFLICT_WOUNDS","Target any creature you can touch to inflict necrotic damage."],["DESCRIPTION IRON_RATIONS","Simple emergency rations. Crucial for resting between floors."],["DESCRIPTION KOBOLD","A small reptilian humanoid."],["DESCRIPTION LEATHER_ARMOUR","Simple armour comprising stiffened leather boiled in oil along with some more flexible sections."],["DESCRIPTION MEAT","A joint of some type of meat."],["DESCRIPTION MEAT?HAM","A joint of meat which can be used as a meal while you rest between floors."],["DESCRIPTION MEAT?POISON_LIZARD","A hunk of meat from a dungeon lizard. This is toxic to humans."],["DESCRIPTION MEAT?ROTTING","A joint of meat, but it looks and smells like it is well past it's best."],["DESCRIPTION FETID_WATER","A fetid, murky film of liquid covering the dungeon flagstones."],["DESCRIPTION LOCK_PICK","Set of lock picks."],["DESCRIPTION MANHOLE_COVER","A small manhole cover set into the dungeon floor."],["DESCRIPTION NOXIOUS_GAS","A cloud of foul smelling gas. Poisonous and strength sapping"],["DESCRIPTION ORC","A monstrous creature with an intense hatred of humans."],["DESCRIPTION PADDED_ARMOUR","Simple quilted layers of cloth and batting."],["DESCRIPTION POTION_OF_HEALING","An aromatic potion, treasured for it's health restoration properties."],["DESCRIPTION PURPLE_PLANT","A small herb with a purple flower."],["DESCRIPTION QUARTERSTAFF","A large quarterstaff capable of causing significant damage in the right hands."],["DESCRIPTION PURPLE_PLANT?HEDGEWORT","Purple hedgewort. Renowned for it's health giving properties."],["DESCRIPTION PLATE_ARMOUR","Full plate armour with interlocking steel plates covering the entire body. A visored helmet, gauntlets, boots, and padding are included."],["DESCRIPTION PLATINUM_COINS","Highly valued large platinum coins."],["DESCRIPTION QUARTZ","A precious crystal."],["DESCRIPTION RAT_PV","A giant rat, diseased and vicious."],["DESCRIPTION RANGER1","You are a ranger who is more at one with the forest. The dungeon is not your natural realm, but you are ready to take it on."],["DESCRIPTION RING_MAIL_ARMOUR","Leather armour reinforced with heavy steel rings sown into the material."],["DESCRIPTION RING_OF_CHARISMA","A magical ring that increases the charisma of the wearer."],["DESCRIPTION RING_OF_CONSTITUTION","A magical ring that increases the constitution of the wearer."],["DESCRIPTION RING_OF_DEXTERITY","A magical ring that increases the dexterity of the wearer."],["DESCRIPTION RING_OF_INTELLIGENCE","A magical ring that increases the intelligence of the wearer."],["DESCRIPTION RING_OF_STRENGTH","A magical ring that increases the strength of the wearer."],["DESCRIPTION RING_OF_WISDOM","A magical ring that increases the wisdom of the wearer."],["DESCRIPTION ROGUE1","You are a rogue whose slippery character may help you creep your way through the depths of this dark and unforgiving dungeon."],["DESCRIPTION RUSTY_KEY","A large iron key, covered in rust. It's been lost a long time."],["DESCRIPTION SCALE_MAIL_ARMOUR","Leather coat and legging covered with overlapping steel scales."],["DESCRIPTION SHADOW","An undead shadow creature, hiding in the darkness."],["DESCRIPTION SHIELD","A wooden shield, carried in one hand and offering some protection."],["DESCRIPTION SHORTSWORD","A light and highly versatile sword."],["DESCRIPTION SILVER_COINS","Silver coins, worn and tarnished but still of value."],["DESCRIPTION SKELETON","A skeleton of someone who died here many years ago. It's intent on revenge."],["DESCRIPTION SLIME","A green sticky substance that seems to be growing."],["DESCRIPTION HELP_THE_DYING","An ancient cantrip that when performed restores a small amount of health to the very injured."],["DESCRIPTION SPIDER_PV","A giant spider with fangs dripping green venom."],["DESCRIPTION SPIKES","It's a trap. Sharp iron spikes shoot up from the ground."],["DESCRIPTION STIRGE","A blood-sucking cross between a giant mosquito and a blood curdling bat."],["DESCRIPTION STUDDED_LEATHER_ARMOUR","Tough and flexible leather armour with the addition of steel spikes and rivets."],["DESCRIPTION TIGER_EYE","A precious gemstone"],["DESCRIPTION TOMB_OF_ELDER","A large ancient shrine. It appears to be stone but with a magical gold lustre."],["DESCRIPTION TRADER1","A wandering trader selling all manner of things gathered during many months in the dungeon."],["DESCRIPTION TRADER2","A wandering trader with a wagon stacked high with a variety of artefacts found in the dungeon."],["DESCRIPTION TRAPDOOR","A small door in the floor. You can't tell what it hides."],["DESCRIPTION VEGETATION","A patch of vegetation managing to grow between the cracks in the flagstones."],["DESCRIPTION VIOLET_FUNGUS","A moving fungus inflicting severe damage."],["DESCRIPTION WATERSKIN","A leather drinking flask with fresh water. Crucial for resting between floors."],["DESCRIPTION WARHAMMER","A bludgeoning, versatile iron hammer favoured by many clerics."],["DESCRIPTION WIZARD1","You a wizard determined to find your way to the final level of this dungeon using your control of magical chaos."],["DESCRIPTION WRAITH","An undead, neutral evil creature with a touch of death."],["DESCRIPTION ZOMBIE","An undead creature roaming the dungeon floors."],["DIALOG TITLE DEBUG LOG","Chronicles of Debug Loggerman"],["DIALOG TITLE HALL OF FAME","Hall of Fame"],["DIALOG TITLE CHOICES","Decisions, decisions"],["DIALOG TITLE LOCKED","Locked"],["DIALOG TITLE PICK SPELL TO CAST","Pick spell to cast"],["DIALOG TITLE PILLAGE","Pillage corpse"],["DIALOG TITLE PREPARE SPELLS","Prepare spells"],["DIALOG TITLE SETTINGS","Adjust settings"],["DIALOG TITLE TRADE","Buy and sell with trader"],["DIALOG TITLE TRAP DETECTED","Trap detected!"],["DIALOG TITLE TRAP DISABLED","Trap disabled!"],["DIALOG TITLE TRAP TRIGGERED SURVIVED","Trap triggered!"],["DIALOG TITLE TRAP TRIGGERED INJURED","Trap triggered!"],["MENU TITLE MAIN","Click and Crawl"],["MENU TITLE GUIDES","Guides and information"],["MESSAGE CANNOT LOAD URL","Cannot load data from ${0}"],["MESSAGE CANNOT REST SHORT NEED LONG REST","You've had too many short rests. You need a long one first."],["MESSAGE CANNOT REST SHORT NEED RATIONS","You don't have enough rations for a short rest."],["MESSAGE CANNOT REST LONG NEED RATIONS","You don't have enough rations for a long rest."],["MESSAGE CANNOT STASH","You need to make space in your backpack to stash this."],["MESSAGE CANNOT STORE","You're carrying too much stuff to pick up what you've found."],["MESSAGE CANNOT UNDERSTAND MAGIC","There is strange magic written here, but it's beyond your comprehension."],["MESSAGE CONSUME BUT ALREADY FULL HP","It tastes good, but you're already in prime health. Perhaps you should've waited."],["MESSAGE CONSUME BUT NO HP GAIN","It tastes nice, but your health doesn`t improve."],["MESSAGE DEAD HERO HAS NO INVENTORY","Dead heroes have no use for material belongings. Your inventory is lost in the dungeon, perhaps to be rediscovered by the next intrepid explorer."],["MESSAGE DEFEAT","Despite your valiant efforts, you die. Your legend will live on for now in the dungeon's hall of fame, and tonight the inns will be filled with songs of your heroism."],["MESSAGE DEFEAT UNPLACED","Despite your valiant efforts, you die. You efforts will be forgotten and no bards will sing of your exploits."],["MESSAGE DUNGEON INTRO CONTINUE","Welcome back, ${0}. The adventure continues. You recognise the familiar smell of death."],["MESSAGE DUNGEON INTRO CASUAL","You enter the dungeon for a quick exploration and to check on what dangers might exist before starting a full adventure. You progress will not be saved and any achievements will be lost."],["MESSAGE ENTER FLOOR","You enter dungeon floor ${0}. The door slams shut behind you. There's no way back. Like it or not, your only path is to continue deeper into the depths of this stone hell."],["MESSAGE ENTRANCE STUCK",["The entrance is locked or jammed. You can't tell which, but either way, you can't escape in that direction.","You can't open the entrance. It seems locked or jammed. There's no way back."]],["MESSAGE EXPLAIN SPELL PREP","After a long rest, you can prepare spells ready for use."],["MESSAGE EXIT LOCKED","The exit is locked. There must be a key somewhere."],["MESSAGE EXPLAIN REST","Trying to use the safety of the corridor to rest and eat?"],["MESSAGE EXPLAIN SPELL NEEDS REST","To use a spell you need to prepare it. Preparation can only be done between dungeon floors after a long rest."],["MESSAGE FAILED TO IDENTIFY","You try to identify this item, but you're not sure exactly what it is. You might remember later."],["MESSAGE FOUND HIDDEN ARTEFACT",["Good fortune smiles upon you. You find something.","You find something that has been hidden or lost.","Buried beneath the surface, you find something."]],["MESSAGE FOUND ENGRAVING","You find strange words engraved on the cold stone surface."],["MESSAGE FOUND GENERIC","It 's your lucky day. You find something that appears to have been hidden for many years."],["MESSAGE GENERIC EPITAPH","Here lies the corpse of one more defeated enemy."],["MESSAGE HALL OF FAME ENTRY","${3-startDate}: ${0-name}; level ${1-level} ${2-class}; ${4-gold} GP; floor ${5-floor}"],["MESSAGE HERO EPITAPH FOR","Here lies the body of ${0}. Rest in peace."],["MESSAGE IDENTIFIED ITEM","It was unclear at first what this actually is, but using your skills, you manage to identify the item."],["MESSAGE INSUFFICIENT FUNDS","You don't have enough funds to purchase this item. The item costs ${0}Â GP but you only have ${1}Â GP."],["MESSAGE IT'S A HEALTHY DRINK","That tastes good. +${0}HP"],["MESSAGE IT'S HEALTHY","A bit chewy, but tastes good. +${0}HP"],["MESSAGE KILLED BY POISON","Yuk! Poison! You start to burn up, cough and vomit, before falling to the floor and dying."],["MESSAGE IT'S POISON","Yuk! It's poison. -${0}HP"],["MESSAGE KEY UNLOCKS EXIT","You use the key you found earlier to unlock the door."],["MESSAGE MAKE SPACE IN BACKPACK","You need to make space in your backpack by discarding or using something."],["MESSAGE MAKE SPACE IN EQUIP","This is too big to store. Sell or discard what you're wearing so you can wear this."],["MESSAGE NEED LOCK PICK","You can't pick a lock without a set of lock picks."],["MESSAGE NO SAVED ADVENTURE","No adventure has been saved yet."],["MESSAGE NOTHING HERE","There's nothing here."],["MESSAGE NOTHING MORE TO DISCOVER","There's nothing more for you to learn or discover here."],["MESSAGE RESISTED POISON","Yuk! It's poisonous, but you resist its toxic effects."],["MESSAGE REST DIALOG","You're at the top of a dark staircase leading even deeper down to floor ${0-floor}. You're safe for now. If you have enough food or drink, you can rest to recuperate, but if you don't need to recover, save your rations."],["MESSAGE REST LONG HP GAIN","Your long rest recovered ${0} HP. You are also now cured of the toxic effects of any poisons you may have encountered."],["MESSAGE REST SHORT HP GAIN","Your short rest recovered ${0} HP."],["MESSAGE SEARCH CORPSE OR MOVE",["You have a choice. Do you want to search the body or climb on top?","You find a corpse, but what should you do? Search for weapons and treasure or climb on top of the body?"]],["MESSAGE SEARCH HOLE OR MOVE",["You have a choice. Do you want to search this hole or move into it?","You've been here before. Do you want to search again or climb into the hole you dug?"]],["MESSAGE SEARCH OR MOVE","You have a choice. Do you want to search this tile or move onto it?"],["MESSAGE SPELL ALREADY KNOWN","You find a spell, but you already know this incantation."],["MESSAGE STOLE GOLD","Success. You pick the trader's pocket undetected and steal ${0} gold coins."],["MESSAGE TRADE STEAL OR BARGE","Do you want to trade or barge past this guy?"],["MESSAGE TRADER ATTACKS BACK","The angry trader detects your clumsy attempt at robbery and strikes back at you."],["MESSAGE TRADER CANNOT STASH","The trader has no space for this."],["MESSAGE TRADER WILL NOT TRADE","The trader has had enough of your trickery and will not trade with you."],["MESSAGE TRADERS PROTECTED","Traders are protected from attack under the ancient law for the protection of travelling merchants."],["MESSAGE TRAP ATTEMPT DISABLE","You find a trap. You can't tell what it is though. Do you want to try to disable it?"],["MESSAGE TRAP TRIGGERED SURVIVED","The trap triggers, but luckily you avoid any injury."],["MESSAGE TRAP TRIGGERED INJURED","You're caught by surprise and sustain a number of injuries from the trap."],["MESSAGE TRAP DISABLED","Taking great care you manage to disable the trap."],["MESSAGE YOU FAIL TO PICK THE LOCK","This lock is tricky. Your attempt to pick it fails."],["MESSAGE YOU PICK THE LOCK","Using your skills, you manage to pick the lock."],["MESSAGE WELCOME","Welcome to the Click and Crawl old-school dungeon crawler. How far will you get?"],["STR","Strength"],["DEX","Dexterity"],["CON","Constitution"],["INT","Intelligence"],["WIS","Wisdom"],["CHA","Charisma"],["FX_STR","Strength change"],["FX_DEX","Dexterity change"],["FX_CON","Constitution change"],["FX_INT","Intelligence change"],["FX_WIS","Wisdom change"],["FX_CHA","Charisma change"],["AC","Armour class"],["DMG","Damage"],["DMG_PER_TURN","Damage per turn"],["DC","Difficulty"],["HP","Hit points"],["AC (including armour)","AC (+armour): ${0}"],["ACTS ON CASTER","Acts on caster"],["Backpack","Backpack"],["Body","Body"],["Cantrips","Cantrips"],["Consumables","Consumables"],["Character level:","Character level: ${0}"],["CHARACTER LEVEL:","level: ${0}"],["(DEAD)","(DEAD!)"],["Dungeon floor:","Dungeon floor: ${0}"],["Experience:","Experience: ${0}"],["Feet","Feet"],["Score:","Score: ${0}"],["Gold:","Gold: ${0}Â GP"],["GOLD PIECES"," gold pieces"],["Hands","Hands"],["Head","Head"],["(HP OUT OF VALUE)","(HP:Â ${0}/${1})"],["(HP VALUE)","(HP:Â ${0})"],["Known spells","Known spells"],["level","level"],["LEVEL UP","Level up to ${0}"],["Name:","Name: ${0}"],["Prepared spells","Prepared spells"],["Range:","Range: ${0-range}"],["Ready magic","Ready magic"],["Ring fingers","Ring fingers"],["Unknown","Unknown"],["Wagon","Wagon"],["YOU DIED!","YOU DIED!"]]);function aX(e){if(eE.updateTimeNow(e),c){var t;let r=(e-c)/1e3;iJ.update(r),av.update(r),ep.showFps&&(t=1/r,ef(ei.getContext2D(),`FPS: ${Math.round(t)}`,{x:0,y:ei.getCanvasDimensions().height},{color:"green"}))}c=e,e3.isAnimationOn()&&window.requestAnimationFrame(aX)}var aq={TILE_SIZE:48,initialise:async function(e){ei.setOptions(e);let t=te.popupElement(function(){let e=document.createElement("div"),t=document.createElement("img");t.src=ii.SPLASH_IMAGE,e.appendChild(t);let r=document.createElement("div");r.className="progress-indicator",e.appendChild(r);let i=document.createElement("p");return i.innerText="Loading",e.appendChild(i),e}());e8.setMap(aV),function(e){let t=0;for(let r in aD){let i=e.measureText(aD[r]),a=i.fontBoundingBoxAscent+i.fontBoundingBoxDescent,n=.5*a-i.fontBoundingBoxDescent;e.fillText(aD[r],-.5*i.width,n),e.getImageData(0,0,1,1).data[3]<=0&&(E.debug(`Emoji ${r} not supported.`),aD[r]=`[${t++}]`),e.clearRect(0,0,i.width,a)}}(ei.getContext2D()),function(){let e;let t=ei.getCanvas();e={element:t,actionStarted:!1,dragging:!1,x:0,y:0,lastTouchStartPoint:null,suppressClickEvent:!1},t.addEventListener("mousedown",t=>aY(aH.MOUSE,t.offsetX,t.offsetY,e),{passive:!0}),t.addEventListener("mouseup",t=>aW(aH.MOUSE,t.offsetX,t.offsetY,e),{passive:!0}),t.addEventListener("mousemove",t=>{1&t.buttons&&aK(aH.MOUSE,t.offsetX,t.offsetY,e)},{passive:!0}),t.addEventListener("touchstart",t=>{if(1===t.changedTouches.length){let r=a$(t);e.lastTouchStartPoint=new D(r.x,r.y),aY(aH.TOUCH,r.x,r.y,e)}},{passive:!0}),t.addEventListener("touchend",t=>{1===t.changedTouches.length&&aW(aH.TOUCH,e.lastTouchStartPoint?.x,e.lastTouchStartPoint?.y,e),e.lastTouchStartPoint=null,e.suppressClickEvent=!1},{passive:!0}),t.addEventListener("touchmove",t=>{if(1===t.changedTouches.length){let r=a$(t);aK(aH.TOUCH,r.x,r.y,e),e.suppressClickEvent=!0}},{passive:!0}),t.addEventListener("touchcancel",t=>{var r,i;aH.TOUCH,r=e.lastTouchStartPoint?.x,i=e.lastTouchStartPoint?.y,e.actionStarted=!1,e.dragging=!1,e.distance=0,e.lastX=r,e.lastY=i,e.startX=r,e.startY=i,aF(e.element,ak,{x:r,y:i}),e.lastTouchStartPoint=null},{passive:!0}),t.addEventListener("click",r=>{E.debug("click"),e.suppressClickEvent||aF(t,aG,{x:r.offsetX,y:r.offsetY}),e.suppressClickEvent=!1}),t.addEventListener("contextmenu",e=>{e.preventDefault(),aF(t,aB,{x:e.offsetX,y:e.offsetY})}),t.addEventListener(aG,e=>{let t=e.detail.x,r=e.detail.y,i=ei.uiCoordsToMappedPositions(t,r);av.resolveClick(i)||ed.resolveClick(i)}),t.addEventListener(a_,e=>{let t=e.detail.x,r=e.detail.y,i=ei.uiCoordsToMappedPositions(t,r);av.resolvePointerDown(i)}),t.addEventListener(az,e=>{let t=e.detail.x,r=e.detail.y,i=ei.uiCoordsToMappedPositions(t,r);av.resolvePointerUp(i)}),t.addEventListener(ak,e=>{let t=e.detail.x,r=e.detail.y,i=ei.uiCoordsToMappedPositions(t,r);av.resolvePointerCancel(i)}),t.addEventListener(aU,e=>{iJ.panCameraBy(-e.detail.dx,-e.detail.dy)}),t.addEventListener(aB,e=>{let t=e.detail.x,r=e.detail.y,i=ei.uiCoordsToMappedPositions(t,r);av.resolveContextMenu(i)||ed.resolveContextMenu(i),e.preventDefault()})}(),rt.forEach(e=>{if(e.label=e8.getText(e.labelKey),e.persistent&&e.onChange){let t=eK.get(e.id,e.defValue);e.onChange(t)}}),te.showOkDialog(e1`MESSAGE WELCOME`,{okButtonLabel:e1`BUTTON START`,className:"door"}).then(()=>(function(){let e=document.body;e.requestFullscreen&&eK.get("START_IN_FULLSCREEN")&&e.requestFullscreen({navigationUI:"hide"})})()).then(()=>tt.loadAndPlayMusic(ii.MUSIC)).then(()=>tt.loadEffects(ii.SOUND_EFFECTS_MAP)).then(()=>eS.loadSpriteMap(is.data,is.textureUrl)).then(()=>tb(ii.DUNGEON_SCRIPT)).then(e=>iJ.setSceneList((E.debug("Creating automatic scene list."),new ab))).then(()=>(function(e,t){E.debug("Loading almanacs.");let r=[];return e.forEach((e,i)=>{let a=tb(e).then(e=>{let r=t.get(i),a=function(e,t){let r=new tz;return e.split(/[\r\n]+/).forEach(e=>{if(""!==(e=e.trim())&&!e.startsWith("#")){let i=tk(e,t);if(i)switch(i.rarity){case t_.VERY_RARE:r.veryRare.push(i);break;case t_.RARE:r.rare.push(i);break;case t_.UNCOMMON:r.uncommon.push(i);break;case t_.COMMON:default:r.common.push(i)}}}),r}(e,i);r&&(a=function(e,t){for(let r of[(e=e.filter(e=>e.id===t)).common,e.uncommon,e.rare,e.veryRare])r.forEach(t=>e.common.push(t));return e.common.forEach(e=>{e.minLevel=0,e.challengeRating=0,e.traitsString=e.traitsString.replace(/CR *: *\d*\.?\d+/,"CR:0")}),e}(a,r)),tG.addAlmanac(i,a)});r.push(a)}),Promise.all(r)})(ii.ALMANAC_MAP,new URLSearchParams(window.location.search))).then(()=>(E.debug("All assets loaded. Trigger main menu."),t.remove(),ib.triggerEvent(ib.EventId.MAIN_MENU))).then(()=>{e3.onStartAnimation=()=>void window.requestAnimationFrame(aX),e3.setAnimationState(!0)}).catch(e=>{E.error(e),alert(`Fatal error in main game. ${e.message}`)})}};class aj{#ig;arrowFunction;constructor(){this.#ig=["one","two","three"],this.arrowFunction=e=>`[${e}]`}get privateMember(){return this.#ig}set privateMember(e){this.#ig=e}#iS(){return[this.#ig,"two","three"].map(e=>this.arrowFunction(e)).join(", ")}static testSupportedFeatures(e){let t=new aj;t.privateMember=e;let r=t.#iS();E.debug(r)}}window.addEventListener("load",()=>{aj.testSupportedFeatures("one");try{aq.initialise({width:800,height:600,maxScale:2.4,minScale:1,sizingMethod:"COVER",alpha:!1})}catch(e){E.fatal(e)}})}();
//# sourceMappingURL=index.c2fd56eb.js.map
