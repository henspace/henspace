let e,t,i,r,n,s,o,a,h,l,c,d,u;function m(e){return e&&e.__esModule?e.default:e}/**
 * @license {@link https://opensource.org/license/mit/|MIT}
 *
 * Copyright 2024 Steve Butler
 */let p=[];window.addEventListener("error",e=>{alert(`ERROR: ${e.filename}; line ${e.lineno}
${e.message}
:Stack:
${e.error.stack}`)});var f={log:function(...e){console.log(...e)},info:function(...e){console.debug(...e)},debug:function(...e){console.debug(...e)},error:function(...e){console.error(...e),p=p.concat(e)},fatal:function(e){let t;console.error(e),t=e.message?`${e.message}
Stack:
${e.stack}`:e,alert(`Fatal error: ${t}
Previous errors:
${p.join("\n")}`),p.push(t)}};const g="'UnifrakturCook', cursive",w={normal:{size:15,fontName:"'UnifrakturCook', cursive"},h1:{size:30,fontName:g},h2:{size:22,fontName:g},h3:{size:18,fontName:g},emojiSprite:{size:18,fontName:"'UnifrakturCook', cursive"}};function y(e){let t=w[e]??w.normal;return`${t.size}px ${t.fontName}`}const x={DEG_22_5:1/8*Math.PI,DEG_45:2/8*Math.PI,DEG_67_5:3/8*Math.PI,DEG_112_5:5/8*Math.PI,DEG_135:6/8*Math.PI,DEG_157_7:7/8*Math.PI};function S(e,t,i){return e<t?t:e>i?i:e}const T={NONE:-1,N:0,NE:1,E:2,SE:3,S:4,SW:5,W:6,NW:7};function E(e,t){let i=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-i+1)+i)}function v(e,t){let i=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-i+1)+i)}class C{x;y;constructor(e,t){this.x=e,this.y=t}static copy(e){return new C(e.x,e.y)}coincident(e){return this.x===e.x&&this.y===e.y}getCartesianAngleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}getScreenAngleTo(e){return Math.atan2(this.y-e.y,e.x-this.x)}toString(){return`(${this.x},${this.y})`}isCoincident(e){return Math.round(this.x)===Math.round(e.x)&&Math.round(this.y)===Math.round(e.y)}isOtherClose(e,t){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)<=Math.pow(t,2)}}class P{x;y;rotation;constructor(e,t,i){this.x=e,this.y=t,this.rotation=i}getCartesianDirection(){return Math.atan2(this.y,this.x)}getScreenDirection(){return Math.atan2(-this.y,this.x)}isZero(e){return Math.abs(this.x)<e&&Math.abs(this.y)<e}}class b extends C{rotation;constructor(e,t,i){super(e,t),this.y=t,this.rotation=i}static fromPoint(e){return new b(e.x,e.y,0)}static copy(e){return new b(e.x,e.y,e.rotation)}getRelativeTo(e){return new b(this.x-e.x,this.y-e.y,this.rotation-e.rotation)}withinSquare(e,t){return Math.abs(e.x-this.x)<t&&Math.abs(e.y-this.y)<t}}class z{x;y;width;height;constructor(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}getBottomRight(){return new C(this.x+this.width,this.y+this.height)}getTopLeft(){return new C(this.x,this.y)}overlaps(e){let t=this.getBottomRight(),i=e.getBottomRight();return!(e.x>t.x||e.y>t.y||i.x<this.x||i.y<this.y)}containsPoint(e){return e.x>=this.x&&e.x<=this.x+this.width&&e.y>=this.y&&e.y<=this.y+this.height}containsCoordinate(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}}new C(Number.MIN_VALUE,Number.MIN_VALUE),new C(Number.MAX_VALUE,Number.MAX_VALUE);let M=null,O=null,k=null,I=0,R=0,B=!0,A=null,L=null,_=0,N=0,D=1,G=1,W=.1,F="COVER",H=new b(0,0,0);function $(){let e,t,i,r;let n={width:window.innerWidth,height:window.innerHeight},s=k.width/k.height,o=0,a=0,h=n.width/n.height;("COVER"===F?s>h:s<h)?a=(o=n.height)*s:o=(a=n.width)/s,(D=a/k.width)>G?(a=(D=G)*k.width,o=D*k.height):D<W&&(a=(D=W)*k.width,o=D*k.height),_=(n.width-a)/2,N=(n.height-o)/2,O.style.left=`${_}px`,O.style.top=`${N}px`,O.style.width=`${a}px`,O.style.height=`${o}px`,_<0?(i=-_/D,e=n.width/D):(i=0,e=k.width),N<0?(r=-N/D,t=n.height/D):(r=0,t=k.height),A=new z(i,r,e,t),f.debug(`Scale: ${D}`),f.debug(`Window: width: ${n.width}, height: ${n.height}`),f.debug(`Display: left: ${_}, top: ${N}, width: ${a}, height: ${o}`),f.debug(`Visible canvas: left: ${i}, top: ${r}, width: ${e}, height: ${t}`)}function U(){let e=w.normal.size*D;document.documentElement.style.fontSize=`${e}px`}function V(){$(),U()}function X(){return O.getContext("2d",{alpha:B})}function K(e){return e.style.opacity=0,new Promise(t=>{window.setTimeout(()=>{e.remove(),t()},500)})}function Y(e){return new b(e.x+H.x,e.y+H.y,e.rotation)}window.addEventListener("resize",()=>{null===M&&(M=window.setTimeout(()=>{V(),M=null},200))});var Z={canvasPositionToWorld:Y,centreCanvasOn:function(e){H.x=e.x-I,H.y=e.y-R},clearCanvas:function(){X().clearRect(0,0,k.width,k.height)},displayOnGlass:function(e,t,i){let r;let n=document.createElement("div");document.body.appendChild(n),n.className="glass";let s=document.createElement("div");n.appendChild(s),s.className="glass-content",s.appendChild(e),i&&n.classList.add(i),n.style.display="block",n.style.opacity=1;let o=[];if(t&&t.length>0)t.forEach(e=>{let t=new Promise(t=>{e.element.addEventListener("click",async()=>{t(e.response)})});o.push(t)});else{let e=new Promise(e=>s.addEventListener("click",()=>e()));o.push(e)}return Promise.race(o).then(e=>(r=e,K(n))).then(()=>r)},getCanvas:()=>O,getContext2D:X,getCanvasDimensions:function(){return{width:k.width,height:k.height}},getWorldInCanvasBounds:function(){return new z(H.x,H.y,k.width,k.height)},getVisibleCanvasRect:function(){return A},glassPositionToWorld:function(e){let t=e.x<0?A.x+A.width:A.x,i=e.y<0?A.y+A.height:A.y;return Y(new b(t+e.x,i+e.y,e.rotation))},isOnCanvas:function(e){return e.overlaps(k)},isOnScreen:function(e){return e.overlaps(k)},panCamera:function(e,t){H.x+=e,H.y+=t},resize:V,setOpacity:function(e){X().globalAlpha=e},setOptions:function(e){var t;if(O){f.error("Multiple calls to setScreen ignored.");return}L=document.getElementById("game-content"),t=e.width,w.normal.size=15+t/100*.390625,w.h1.size=2*w.normal.size,w.h2.size=1.5*w.normal.size,w.h3.size=1.2*w.normal.size,w.emojiSprite.size=t/10,(O=document.createElement("canvas")).id="game-canvas",O.setAttribute("width",e.width),O.setAttribute("height",e.height),O.innerText="Loading the app.",k=new z(0,0,e.width,e.height),I=e.width/2,R=e.height/2,L.appendChild(O),G=e.maxScale,W=e.minScale,F=e.sizingMethod,B=e.alpha,$(),U()},wipeGlass:K,worldPositionToCanvas:function(e){return new b(e.x-H.x,e.y-H.y,e.rotation)},worldToUi:function(e){return e*D},uiCoordsToMappedPositions:function(e,t){return{canvas:new b(Math.round(e/=D),Math.round(t/=D)),world:new b(Math.round(e+H.x),Math.round(t+H.y),-H.rotation)}},uiToWorld:function(e){return e/D}};const q=new Map,j=new Map;function J(t){let i=e.worldPointToGrid(t.position);e.deleteOccupancyOfGridPoint(t,i),q.delete(t)}function Q(e){f.debug("Remove passive sprite."),j.delete(e)}function ee(){e=null}var et={addActor:function(t){q.set(t,t),e.moveTileOccupancyGridPoint(t,null,e.worldPointToGrid(t.position))},addPassiveSprite:function(e){j.set(e,e)},clearAll:function(){q.forEach(e=>J(e)),j.forEach(e=>Q(e)),ee()},getActors:function(){return q},getTileMap:function(){return e},getWorldDims:function(){return e?e.getDimensions():Z.getCanvasDimensions()},removeTileMap:ee,resolveCancel:function(e){return!1},resolveClick:function(t){let i=e?.getTileAtWorldPoint(t.world);return!!i&&(i.actionClick(t.world),!0)},resolveContextMenu:function(t){let i=e.getTileAtWorldPoint(t.world);return!!i&&(i.actionContextClick(t.world),!0)},removeActor:J,removePassiveSprite:Q,setTileMap:function(t){e=t},update:function(t){e?.update(t),q.forEach(i=>{let r=e.worldPointToGrid(i.position);i.visible=e.canHeroSeeGridPoint(r),i.update(t);let n=e.worldPointToGrid(i.position);e.moveTileOccupancyGridPoint(i,r,n)}),j.forEach(e=>e.update(t))}};function ei(e,t,i,r){if(e.font=y(r?.styleName),e.fillStyle=r?.color??"white",r?.wrapAtX){var n=t.split("\n");for(let t=0;t<n.length;t++)r.y=function(e,t,i,r){let n;let s=t.split(" "),o=i.x??0,a=i.y??0,h=r.xWrapPosition-o,l=r.lineSpacing??1,c="";for(let t=0;t<s.length;t++){let i=c+s[t]+" ",r=function(e,t){let i=e.measureText(void 0);return{width:i.width,height:i.fontBoundingBoxAscent+i.fontBoundingBoxDescent,offsetTop:-i.fontBoundingBoxAscent,offsetCentreY:.5*(i.fontBoundingBoxDescent-i.fontBoundingBoxAscent)}}(e);n||(n=l*r.height),r.width>h&&t>0?(e.fillText(c,o,a),c=s[t]+" ",a+=n):c=i}return e.fillText(c,o,a),a+n}(e,n[t],i,r)}else e.fillText(t,i.x??0,i.y??0)}const er={spriteBoxes:!1,showFps:!0};let en=[];function es(e){return new Promise(t=>{let i=new Image;i.addEventListener("load",()=>{f.debug("Image loaded."),t(i)}),i.src=e})}var eo={getSpriteBitmap:function(e,t){let i=en[e].get(t);return i||f.debug(`Failed to find image ${t} at index ${e}`),i},loadImage:es,loadImages:function(e){let t=[];return e.forEach(e=>t.push(es(e))),Promise.all(t)},loadSpriteMap:function(e,t){return es(t).then(t=>(function(e,t){let i=[],r=new Map;return en.push(r),e.frames.forEach(e=>{i.push(createImageBitmap(t,e.frame.x,e.frame.y,e.frame.w,e.frame.h).then(t=>{let i={image:t,width:e.frame.w,height:e.frame.h,centreX:e.sourceSize.w/2-e.spriteSourceSize.x,centreY:e.sourceSize.h/2-e.spriteSourceSize.y};return r.set(e.filename,i),e.filename}))}),Promise.all(i)})(e,t))}};let ea=0;var eh={updateTimeNow:function(e){ea=e},getFrameCount:function(e){return Math.floor(ea/e)}};const el={WRAP:0,REVERSE:1,STOP:2};class ec{#e;#t;#i;#r;#n;constructor(e,t){this.#e=e,this.#t=e-1,this.#i=t,this.#r=1,this.#n=0}get index(){return this.#n}set index(e){this.#n=S(e,0,this.#e-1)}advanceBy(e){if(this.#e<1)return this.#n;switch(this.#i){case el.WRAP:return this.#s(e);case el.REVERSE:return this.#o(e);case el.NONE:default:return this.#a(e)}}#s(e){return e%=this.#e,this.#n+=e%this.#e,this.#n>=this.#e&&(this.#n=this.#n-this.#e),this.#n}#o(e){if(Math.floor(e/this.#e)%2&&(this.#r=-this.#r),e%=this.#e,this.#r>0){this.#n+=e;let t=this.#n-this.#t;t>0&&(this.#n=this.#t-t,this.#r=-1)}else this.#r<0&&(this.#n-=e,this.#n<0&&(this.#n=-this.#n,this.#r=1));return this.#n}#a(e){return this.#r>0?this.#n=Math.min(this.#t,this.#n+e):this.#r<0&&(this.#n=Math.max(0,this.#n-e)),this.#n}}class ed{playing;#h;#l;#c;#d;constructor(e,t,i){let r;if(this.#h=[],this.#c=0,"string"==typeof t){this.#h.push(eo.getSpriteBitmap(e,t));return}this.#d=Math.max(1,i.framePeriodMs);let n=t.startIndex??0,s=t.padding??0;do{let i=`${t.prefix}${n.toString().padStart(s,"0")}${t.suffix}`;(r=eo.getSpriteBitmap(e,i))&&this.#h.push(r),n++}while(r)this.#l=new ec(this.#h.length,i.loopMethod),this.playing=!0}getCurrentFrame(){if(!(this.#h.length>1))return this.#h[0];if(this.playing){let e=eh.getFrameCount(this.#d);e!==this.#c&&(this.#l.advanceBy(e-this.#c),this.#c=e)}return this.#h[this.#l.index]}setCurrentIndex(e){this.#h.length>1&&(this.playing=!1,this.#l.index=e)}getCurrentIndex(){return this.#h.length>1?this.#l.index:0}}class eu{#u;#m;constructor(e,t){this.#u={},this.#u[e]=t,this.#m=t}get image(){return this.#m}addAnimatedImage(e,t){this.#u[e]=t}setCurrentKey(e){this.#u.hasOwnProperty(e)?this.#m=this.#u[e]:f.error(`Attempt to set current key to nonexistent value of ${e}`)}getCurrentFrame(){return this.#m.getCurrentFrame()}}class em{_context;_boundingBoxCanvas;constructor(e){this._context=e,this._boundingBoxCanvas=new z(0,0,0,0)}getContext(){return this._context}getBoundingBoxCanvas(){return this._boundingBoxCanvas}render(e,t){if(e=Z.worldPositionToCanvas(e),!this.isOnCanvas(e))return;let i=this._context.globalAlpha;this._context.globalAlpha=i*t;let r=e.rotation;r&&(this._context.save(),this._context.translate(e.x,e.y),this._context.rotate(-e.rotation),this._context.translate(-e.x,-e.y)),this._doRender(e),r&&this._context.restore(),er.spriteBoxes&&(this._context.strokeStyle="green",this._context.strokeRect(this._boundingBoxCanvas.x,this._boundingBoxCanvas.y,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height)),this._context.globalAlpha=i}_doRender(e){f.error("_doRender method should be overridden.")}isOnScreen(e){let t=new z(e.x-this._boundingBoxCanvas.width/2,e.y-this._boundingBoxCanvas.height/2,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height);return Z.isOnScreen(t)}isOnCanvas(e){let t=new z(e.x-this._boundingBoxCanvas.width/2,e.y-this._boundingBoxCanvas.height/2,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height);return Z.isOnCanvas(t)}}class ep extends em{#p;#f;#g;text;constructor(e,t,i="normal"){super(e),this.text=t,this.#p=i}#w(e){this._context.font=y(this.#p);let t=this._context.measureText(e);this.#g={width:t.width,height:t.fontBoundingBoxAscent+t.fontBoundingBoxDescent,origin:{x:-.5*t.width,y:.5*(t.fontBoundingBoxAscent-t.fontBoundingBoxDescent)}},this.#f=e}_doRender(e){var t;this.text!==this.#f&&this.#w(this.text);let i={x:e.x+this.#g.origin.x,y:e.y+this.#g.origin.y,rotation:e.rotation};ei(this._context,this.#f,i,{styleName:this.#p}),this._boundingBoxCanvas=(t=this.#g,new z(e.x-t.width/2,e.y-t.height/2,t.width,t.height))}}class ef extends em{#y;#x;#S;#T;#E;#v;constructor(e,t){super(e),this.#y=t.width??10,this.#x=t.height??10,this.#S=this.#y/2,this.#T=this.#x/2,this.#E=t.fillStyle,this.#v=t.strokeStyle}_doRender(e){let t=e.x-this.#S,i=e.y-this.#T;this.#E&&(this._context.fillStyle=this.#E,this._context.fillRect(t,i,this.#y,this.#x)),this.#v&&(this._context.strokeStyle=this.#v,this._context.strokeRect(t,i,this.#y,this.#x)),this._boundingBoxCanvas=new z(t,i,this.#y,this.#x)}}class eg extends em{#x;#T;#y;#S;#E;#v;#C;#P;#b;#z;constructor(e,t){super(e),this.#x=t.height,this.#T=this.#x/2,this.#y=t.width,this.#S=this.#y/2,this.#E=t.fillStyle,this.#v=t.strokeStyle,this.#C=t.offsetX??0,this.#P=t.offsetY??0,this.setLevel(0)}setLevel(e){this.#b=Math.min(e,1)*this.#x,this.#z=.5*this.#b}_doRender(e){let t=e.y-this.#T+this.#P,i=e.y+this.#T-this.#b+this.#P,r=e.x-this.#S+this.#C;this.#E&&(this._context.fillStyle=this.#E,this._context.fillRect(r,i,this.#y,this.#b)),this.#v&&(this._context.strokeStyle=this.#v,this._context.strokeRect(r,t,this.#y,this.#x)),this._boundingBoxCanvas=new z(r,t,this.#y,this.#x)}}class ew extends em{#M;constructor(e,t){super(e);let i=Math.max(t.fillStyles.length??0,t.strokeStyles.length??0);if(0===i){f.error("Attempt to create MultiGaugeTileRenderer with no gauges.");return}this.#M=[];let r=t.tileSize/i,n=-t.tileSize/2+r/2;for(let s=0;s<i;s++)this.#M.push(new eg(e,{width:r,height:t.tileSize,fillStyle:t.fillStyles?.[s],strokeStyle:t.strokeStyles?.[s],offsetX:n+r*s,offsetY:0}))}setLevel(e,t){this.#M[e]?.setLevel(t)}render(e){this.#M?.forEach(t=>t.render(e))}}class ey extends em{#O;#k;constructor(e,t){super(e),t?.getCurrentFrame?(this.#k=t,this.#O=this.#k.getCurrentFrame()):this.#O=t,this.#O?(this._boundingBoxCanvas.width=this.#O?.width??0,this._boundingBoxCanvas.height=this.#O?.height??0):f.error("No image frame available for sprite.",t)}_doRender(e){if(!this.#O)return;let t=this.#k?this.#k.getCurrentFrame():this.#O;this._boundingBoxCanvas.x=e.x-this._boundingBoxCanvas.width/2,this._boundingBoxCanvas.y=e.y-this._boundingBoxCanvas.height/2,this._context.drawImage(t.image,e.x-t.centreX,e.y-t.centreY)}}class ex{#I=new b(0,0,0);#R=new P(0,0,0);#B;#A;modifier;visible;opacity;constructor(e){this.#B=e?.renderer,this.#A=Array.isArray(this.#B),this.visible=!0,this.opacity=1}get position(){return this.#I}set position(e){this.#I.x=this.valueOrZero(e.x),this.#I.y=this.valueOrZero(e.y),this.#I.rotation=this.valueOrZero(e.rotation)}get velocity(){return this.#R}set velocity(e){this.#R.x=this.valueOrZero(e.x),this.#R.y=this.valueOrZero(e.y),this.#R.rotation=this.valueOrZero(e.rotation)}valueOrZero(e){return"number"==typeof e?e:0}update(e){this.modifier&&(this.modifier=this.modifier.update(this,e)),this.visible&&this.#L()}#L(){this.#B&&(this.#B.forEach?this.#B.forEach(e=>e.render(this.#I,this.opacity)):this.#B.render(this.#I,this.opacity))}getBoundingBox(){let e=this.#B.getBoundingBoxCanvas();return new z(this.position.x-e.width/2,this.position.y-e.height/2,e.width,e.height)}}class eS{decoratedModifier;#_;#N;#D;constructor(e){this.#N=0,this.#D=0,this.decoratedModifier=e}applyAsTransientToSprite(e,t=10){return this.#D=t,new Promise(t=>{this.#_=t,e.modifier=this})}applyAsContinuousToSprite(e){e.modifier=this}update(e,t){this.#_&&(this.#N+=t),this.decoratedModifier&&(this.decoratedModifier=this.decoratedModifier?.update(e,t));let i=this.doUpdate(e,t);return!i||this.#N>this.#D?(this.#_?.(null),null):i}doUpdate(e,t){return f.error("doUpdate should be overridden."),this}}class eT extends eS{#G;constructor(e,t){super(t),this.#G=1/Math.max(e,.5)}doUpdate(e,t){return e.opacity=Math.max(0,e.opacity-t*this.#G),e.opacity>0?this:null}}class eE{#W;#F;constructor(e,t){this.#W=e,this.#F=t}getSpeedBetweenPoints(e,t){return this.#F?this.#W:(1+.1*(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)))*this.#W}}class ev extends eS{#H;#$;constructor(e){super(e)}doUpdate(e,t){let i=e.position,r=e.velocity;return i.x+=r.x*t,i.y+=r.y*t,e.position=i,e.velocity=r,this}}class eC extends eS{#U;#V;#X;constructor(e,t){super(t),this.#U=e.prey,this.#V=e.maxSeparation,this.#X=new eE(e.speed,e.linear)}doUpdate(e,t){let i=this.#U.position,r=e.position,n=this.#X.getSpeedBetweenPoints(i,r);if(!r.withinSquare(i,this.#V)){let s=r.getCartesianAngleTo(i);e.velocity.x=n*Math.cos(s),e.velocity.y=n*Math.sin(s);let o=e.velocity.x*t,a=e.velocity.y*t;e.position.x+=this.getMinMove(o,i.x,r.x),e.position.y+=this.getMinMove(a,i.y,r.y)}return this}getMinMove(e,t,i){let r=t-i;return 0>Math.sign(e)?Math.max(e,r):Math.min(e,r)}}class eP extends eS{#K;#n;#Y;#X;constructor(e,t){super(t),this.#K=e.path,this.#n=0,this.#Y=e.path[0],this.#X=new eE(e.speed,e.linear)}doUpdate(e,t){let i=e.position,r=this.#X.getSpeedBetweenPoints(this.#Y,i),n=i.getCartesianAngleTo(this.#Y);e.velocity.x=r*Math.cos(n),e.velocity.y=r*Math.sin(n);let s=e.velocity.x*t,o=e.velocity.y*t;if(i.x+=this.getMinMove(s,this.#Y.x,i.x),i.y+=this.getMinMove(o,this.#Y.y,i.y),i.isCoincident(this.#Y)){if(++this.#n>=this.#K.length)return e.velocity.x=0,e.velocity.y=0,this.decoratedModifier;this.#Y=this.#K[this.#n]}return this}getMinMove(e,t,i){let r=t-i;return 0>Math.sign(e)?Math.max(e,r):Math.min(e,r)}}function eb(e,t){let i=new ex({renderer:e});i.position=t.position,i.velocity=t.velocity,et.addPassiveSprite(i),new eT(t.lifetimeSecs,new ev).applyAsTransientToSprite(i,20).then(()=>et.removePassiveSprite(i))}function ez(e,t){eb(new ep(Z.getContext2D(),e),t)}function eM(e=6){return v(1,e)}var eO={TILE_SIZE:48};const ek=new class{#Z;constructor(){this.#Z=new Map}set(e,t){this.#Z.set(e,t);try{localStorage.setItem(e,JSON.stringify(t))}catch(e){f.error(`Cannot save setting. ${e.message}`)}}get(e,t){if(this.#Z.has(e))return this.#Z.get(e);let i=t;try{let t=localStorage.getItem(e);null!==t&&(i=JSON.parse(t))}catch(e){f.error(`Cannot parse value from local storage. ${e.message}`)}return this.#Z.set(e,i),i}};!function(){let e="ontouchstart"in document.documentElement;f.debug(`Device is ${e?"":"not "}touch enabled.`)}();class eI{_element;#q;#j;#J;closes;#Q;constructor(e){if(e.closes&&e.action)throw Error(`Attempt made to create control ${e.id} that is set to close forms and perform and action. These are mutually exclusive.`);this.#q=e.id,this.#J=e.persistent,e.persistent?this.#j=ek.get(this.#q,e.defValue):this.#j=e.defValue,this.closes=e.closes,this.#Q=e.action,this.listeners=0}get element(){return this._element}get value(){return this.#j}set value(e){e!==this.#j&&(this.#J&&ek.set(this.#q,e),this.#j=e)}enableActionOnEvent(e){this._element&&this.#Q&&this._element.addEventListener(e,async e=>{f.debug(`Click: current target ${e.currentTarget}, target ${e.target}`),await this.#Q(e)})}}class eR extends eI{constructor(e){super(e),this._element=this.buildElement(e),this.enableActionOnEvent("click")}buildElement(e){let t=document.createElement("button");return t.appendChild(document.createTextNode(e.label)),t.className="text-button",t}}class eB extends eI{constructor(e){super(e),this._element=this.buildElement(e),this.enableActionOnEvent("click")}buildElement(e){let t=document.createElement("button");return t.appendChild(document.createTextNode(e.label)),t.appendChild(eA(e.index,e.imageName,"button-icon")),t.className="icon-button",t}}function eA(e=0,t,i){let r=eo.getSpriteBitmap(e,t),n=document.createElement("canvas");n.setAttribute("width",eO.TILE_SIZE),n.setAttribute("height",eO.TILE_SIZE);let s=n.getContext("2d");return s.clearRect(0,0,eO.TILE_SIZE,eO.TILE_SIZE),s.drawImage(r.image,.5*(eO.TILE_SIZE-r.width),.5*(eO.TILE_SIZE-r.height)),n.className=i,n}class eL extends eI{#ee;constructor(e,t,i){super({id:e,label:t,persistent:i,closes:!1}),this._element=this.buildElement(t),this.#ee.checked=this.value,this._element.addEventListener("change",e=>{this.value=this.#ee.checked})}buildElement(e){let t=document.createElement("span");t.className="styled-checkbox",this.#ee=document.createElement("input"),this.#ee.setAttribute("type","checkbox"),t.appendChild(this.#ee),t.appendChild(eA(0,"ui-checkbox00.png","unchecked")),t.appendChild(eA(0,"ui-checkbox01.png","checked"));let i=document.createElement("label");return i.appendChild(document.createTextNode(e)),i.appendChild(t),i}}const e_={TEXT_BUTTON:"text button",NATIVE_CHECKBOX:"native checkbox"};function eN(e){let t=document.createElement("div");return t.innerText=e,t.classList.add(["scrollable"]),t}var eD={showMessage:function(e){let t=document.createElement("div");t.appendChild(document.createTextNode(e)),t.className="popup",t.style.opacity=1,document.body.appendChild(t),t.addEventListener("click",()=>t.remove())},showOkDialog:function(e,t="OK",i){let r=document.createElement("div");r.appendChild(eN(e));let n=document.createElement("button");return n.appendChild(document.createTextNode(t)),r.appendChild(n),Z.displayOnGlass(r,[{element:n,id:0,closer:!0}],i)},showControlsDialog:function(e,t,i){let r=document.createElement("div");r.appendChild(eN(e));let n=[];if(t?.forEach(e=>{r.appendChild(e.element),e.closes&&n.push({element:e.element,response:e.id})}),0===n.length){let e=new eR({label:"OK"});r.appendChild(e.element),n.push(e)}return Z.displayOnGlass(r,n,i)}};class eG{actor;constructor(e){this.actor=e}enact(e){return Promise.resolve()}react(e){return Promise.resolve()}allowEscape(e){return!0}}class eW extends eG{constructor(e){super(e)}enact(e){return this.#et(this.actor,e)}react(e){return this.#et(e,this.actor)}allowEscape(e){return this.actor,eM(20)>10||(ez("Failed to run.",{lifetimeSecs:2,position:e.position,velocity:new P(0,-100,0)}),!1)}#ei(e,t){let i=C.copy(e.position);return new eP({path:[new C(e.position.x+.2*(t.position.x-e.position.x),e.position.y+.2*(t.position.y-e.position.y)),i],speed:100}).applyAsTransientToSprite(e.sprite)}#er(e,t){return new Promise(e=>{var i,r;if(eM(20)>10)i=eo.getSpriteBitmap(0,ek.get("BLOOD_ON")?"blood-splat.png":"pow.png"),r={lifetimeSecs:1,position:t.position,velocity:new P(0,0,0)},eb(new ey(Z.getContext2D(),i),r);else{ez("Missed",{lifetimeSecs:2,position:t.position,velocity:new P(0,-100,0)}),e();return}let n=t.traits.get("HP"),s=eM(6);n=Math.max(0,n-s),t.traits.set("HP",n),0===n?(f.info("Killed actor."),t.interaction=new eF,t.alive=!1):ez(`-${s} HP`,{lifetimeSecs:2,position:t.position,velocity:new P(0,-200,0)}),e(n)})}#et(e,t){return this.#ei(e,t).then(()=>this.#er(e,t))}}class eF extends eG{constructor(e){super(e)}react(e){return eD.showOkDialog("A bit macabre, but you're trying to search a corpse. I haven't written the code yet.")}}class eH extends eG{constructor(e){super(e)}react(e){return eD.showOkDialog("Time to trade. I haven't written the code yet.")}}class e${#en;#es;#eo;#ea;setOnClick(e){this.#en=e}setOnContextClick(e){this.#es=e}setOnPointerDown(e){this.#eo=e}setOnPointerUp(e){this.#ea=e}actionClick(e){this.#en?.(this,e)}actionContextClick(e){this.#es?.(this,e)}actionPointerDown(e){this.#eo?.(this,e)}actionPointerUp(e){this.#ea?.(this,e)}}class eU extends e${maxTilesPerMove;sprite;traits;interaction;alive;constructor(e){super(),this.interaction=new eG,this.sprite=e,this.sprite.obstacle=!0,this.maxTilesPerMove=4,this.alive=!0}set visible(e){this.sprite.visible=e}get visible(){return this.sprite.visible}get obstacle(){return this.sprite.obstacle}set obstacle(e){this.sprite.obstacle=e}get position(){return this.sprite.position}set position(e){this.sprite.position=e}get velocity(){return this.sprite.velocity}set velocity(e){this.sprite.velocity=e}isWandering(){return this?.traits.get("MOVE")==="wander"}isPassableByActor(e){return!this.alive||!this.obstacle}canShareLocationWithActor(e){return!this.obstacle}update(e){this.sprite.update(e)}actionClick(e){super.actionClick(this.sprite.position)}actionContextClick(e){super.actionContextClick(this.sprite.position)}actionPointerUp(e){super.actionPointerUp(this.sprite.position)}actionPointerDown(e){super.actionPointerDown(this.sprite.position)}}const eV={OFF:0,HERO:1,VELOCITY:2};class eX{#eh;#el;#ec;#ed;constructor(e,t,i=0){let r=Z.getCanvasDimensions(),n=i*Math.min(r.width,r.height);this.#eh=new ex,this.#el=new eC({prey:e,speed:t,maxSeparation:n}),this.#ec=new ev,this.#el.applyAsContinuousToSprite(this.#eh)}update(e){this.#ed!==eV.OFF&&(this.#eh.update(e),Z.centreCanvasOn(this.#eh.position))}setVelocity(e,t){this.setTrackingMethod(eV.VELOCITY),this.#eh.velocity.x=e,this.#eh.velocity.y=t}panBy(e,t){this.#eh.position.x+=e,this.#eh.position.y+=t,Z.centreCanvasOn(this.#eh.position)}setTrackingMethod(e){if(e!==this.#ed)switch(this.#ed=e,e){case eV.HERO:this.#el.applyAsContinuousToSprite(this.#eh);break;case eV.VELOCITY:this.#ec.applyAsContinuousToSprite(this.#eh);break;case eV.OFF:break;default:f.error(`Attempt to set invalid tracking method of ${e} ignored.`)}}}const eK={TR:0,BR:1,BL:2,TL:3};class eY{#eu;#em;#ep;constructor(e,t,i){this.#eu=e,this.#ef(t,i)}#ef(e,t){let i,r;switch(t){case eK.TL:i=2*e,r=2*e;break;case eK.TR:i=-2*e,r=2*e;break;case eK.BR:i=-2*e,r=-2*e;break;case eK.BL:i=2*e,r=-2*e}this.#eg(i,r),this.#ew(i,r,e)}#eg(e,t){this.#ep=new ed(0,{prefix:"hud-auto-centre",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:el.STOP}),this.#em=eQ.addButton(this.#ep,()=>{this.setTrackingState(!0)},()=>{this.setTrackingState(!1)}),this.#em.position.x=e,this.#em.position.y=t,this.#em.actionClick(null)}setTrackingState(e){e?(this.#ep.setCurrentIndex(1),this.#eu.setTrackingMethod(eV.HERO)):(this.#ep.setCurrentIndex(0),this.#eu.setTrackingMethod(eV.OFF))}#ew(e,t,i){let r=3*i;this.#ey("hud-arrow-up",e,t-i,()=>{this.setTrackingState(!1),this.#eu.setVelocity(0,-r)},()=>this.#eu.setTrackingMethod(eV.OFF)),this.#ey("hud-arrow-right",e+i,t,()=>{this.setTrackingState(!1),this.#eu.setVelocity(r,0)},()=>this.#eu.setTrackingMethod(eV.OFF)),this.#ey("hud-arrow-down",e,t+i,()=>{this.setTrackingState(!1),this.#eu.setVelocity(0,r)},()=>this.#eu.setTrackingMethod(eV.OFF)),this.#ey("hud-arrow-left",e-i,t,()=>{this.setTrackingState(!1),this.#eu.setVelocity(-r,0)},()=>this.#eu.setTrackingMethod(eV.OFF))}#ey(e,t,i,r,n){let s=new ed(0,{prefix:e,startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:el.STOP}),o=eQ.addMomentaryButton(s,r,n);o.position.x=t,o.position.y=i,s.setCurrentIndex(0)}}const eZ=new Map;let eq=!1;function ej(e,t){let i=Z.glassPositionToWorld(t.position),r=t.sprite.getBoundingBox();return new z(i.x-r.width/2,i.y-r.height/2,r.width,r.height).containsCoordinate(e.world.x,e.world.y)}function eJ(e){if(!eq||!eq)return!1;for(let[t,i]of eZ)if(ej(e,i))return i.actionPointerUp(i,e.canvas),!0;return!1}var eQ={addButton:function(e,t,i){let r=new eU(new ex({renderer:new ey(Z.getContext2D(),e)}));return eZ.set(r,r),r.setOnClick(()=>{i?0===e.getCurrentIndex()?(e.setCurrentIndex(1),t()):(e.setCurrentIndex(0),i()):t()}),e.setCurrentIndex(0),r},addMomentaryButton:function(e,t,i){let r=new eU(new ex({renderer:new ey(Z.getContext2D(),e)}));return eZ.set(r,r),r.setOnPointerDown(()=>{e.setCurrentIndex(1),t?.()}),r.setOnPointerUp(()=>{e.setCurrentIndex(0),i?.()}),r},clear:function(){eZ.clear()},removeButton:function(e){eZ.delete(e)},update:function(e){eq&&eZ.forEach(t=>{let i=b.copy(t.position);t.position=Z.glassPositionToWorld(t.position),t.update(e),t.position=i})},resolvePointerCancel:function(e){return eJ(e)},resolveClick:function(e){if(!eq)return!1;for(let[t,i]of eZ)if(ej(e,i))return i.actionClick(i,e.canvas),!0;return!1},resolveContextMenu:function(e){return!1},resolvePointerDown:function(e){if(!eq||!eq)return!1;for(let[t,i]of eZ)if(ej(e,i))return i.actionPointerDown(i,e.canvas),!0;return!1},resolvePointerUp:eJ,setVisible:function(e){eq=e}};const e4={GRINNING:"\uD83D\uDE00",SANTA:"\uD83C\uDF85",SHAKING:"\uD83E\uDEE8"};var e0={};e0=new URL("dungeon_script.e102251e.txt",import.meta.url).toString();const e1={DUNGEON_SCRIPT:new URL(e0)},e8={DEAD:{keyName:"DEAD",suffix:"dead",options:{framePeriodMs:100,loopMethod:el.STOP}},IDLE:{keyName:"IDLE",suffix:"idle",options:{framePeriodMs:300,loopMethod:el.REVERSE}},WALK_NORTH:{keyName:"WALK_N",suffix:"walk-n",options:{framePeriodMs:100,loopMethod:el.REVERSE}},WALK_EAST:{keyName:"WALK_E",suffix:"walk-e",options:{framePeriodMs:100,loopMethod:el.REVERSE}},WALK_SOUTH:{keyName:"WALK_S",suffix:"walk-s",options:{framePeriodMs:100,loopMethod:el.REVERSE}},WALK_WEST:{keyName:"WALK_W",suffix:"walk-w",options:{framePeriodMs:100,loopMethod:el.REVERSE}}};var e2={definitions:e8,formFrameNameRoot:function(e,t){let i=e8[e]?.suffix;if(!i)throw Error(`Attempt made to use invalid standard animation key of '${e}'`);return`${t}-${i}`}};class e3 extends ew{actor;constructor(e,t){super(e,t)}render(e){if(this.actor&&this.actor.traits){let e=this.actor.traits.get("HP"),t=this.actor.traits.get("HP_MAX");this.setLevel(0,e/t),this.setLevel(1,1)}super.render(e)}}class e6 extends eu{#ex;#eS;#eT;constructor(e,t){super(e,t),this.#eS=T.NONE}setActor(e){this.#ex=e,this.#eT=this.#ex.alive}getCurrentFrame(){let e=this.#eE();return(e!==this.#eS||this.#eT!=this.#ex?.alive)&&(this.#eS=e,this.#eT=this.#ex?.alive,this.#ev()),super.getCurrentFrame()}#eE(){return!this.#ex||this.#ex.velocity.isZero(.1)?T.NONE:function(e){let t=Math.abs(e);return t<=x.DEG_45?T.E:t<=x.DEG_135?Math.sign(e)>0?T.N:T.S:T.W}(this.#ex.velocity.getScreenDirection())}#ev(){if(!this.#ex.alive)return this.setCurrentKey(e2.definitions.DEAD.keyName);switch(this.#eS){case T.NONE:this.setCurrentKey(e2.definitions.IDLE.keyName);break;case T.E:this.setCurrentKey(e2.definitions.WALK_EAST.keyName);break;case T.N:case T.NW:case T.NE:this.setCurrentKey(e2.definitions.WALK_NORTH.keyName);break;case T.W:this.setCurrentKey(e2.definitions.WALK_WEST.keyName);break;default:this.setCurrentKey(e2.definitions.WALK_SOUTH.keyName)}}}function e7(e){let t=function(e){let t=new e6("still",new ed(0,`${e}.png`));for(let i in e2.definitions){let r=e2.definitions[i];t.addAnimatedImage(e2.definitions[i].keyName,new ed(0,{prefix:e2.formFrameNameRoot(i,e),suffix:".png",startIndex:0,padding:2},r.options))}return t.setCurrentKey(e2.definitions.IDLE.keyName),t}(e),i=new ey(Z.getContext2D(),t),r=new e3(Z.getContext2D(),{tileSize:et.getTileMap().getGridSize()-2,fillStyles:["rgba(255, 0, 0, 0.2)","rgba(0, 0, 255, 0.2)"],strokeStyles:[]}),n=new eU(new ex({renderer:[r,i]}));return t.setActor(n),r.actor=n,n.position=new b(eO.TILE_SIZE,eO.TILE_SIZE,0),n.velocity={x:0,y:0,rotation:.1},n}const e5=new Map([["HERO",{create:()=>e7("hero")}],["MONSTER",{create:()=>(function(e){let t=e7("orc");return t.interaction=new eW(t),t})(0)}],["TRADER",{create:()=>(function(e){let t=e7(e);return t.interaction=new eH(t),t})("trader")}]]);function e9(e,t,i){return{centre:e[t]?.[i],tl:e[t-1]?.[i-1],above:e[t-1]?.[i],tr:e[t-1]?.[i+1],right:e[t]?.[i+1],br:e[t+1]?.[i+1],below:e[t+1]?.[i],bl:e[t+1]?.[i-1],left:e[t]?.[i-1]}}function te(e){let t,i=e.length;for(;i>0;)t=Math.floor(Math.random()*i),i--,[e[i],e[t]]=[e[t],e[i]];return e}const tt={WALL:["#","*","|"],DOOR_IN:["-"],DOOR_OUT:["="],GROUND:[".",":",",",";"],VOID:[" "]},ti={TOP_LEFT:"-TL",TOP_LEFT_INTERNAL:"-TLI",TOP:"-T",TOP_RIGHT:"-TR",TOP_RIGHT_INTERNAL:"-TRI",RIGHT:"-R",BOTTOM_RIGHT:"-BR",BOTTOM_RIGHT_INTERNAL:"-BRI",BOTTOM:"-B",BOTTOM_LEFT:"-BL",BOTTOM_LEFT_INTERNAL:"-BLI",LEFT:"-L",TOP_TEE:"-TTEE",RIGHT_TEE:"-RTEE",BOTTOM_TEE:"-BTEE",LEFT_TEE:"-LTEE",INTERNAL_CROSS:"-XI",INTERNAL_VERTICAL:"-VI",INTERNAL_HORIZONTAL:"-HI"},tr={BELOW_WALL:"-SBW",BELOW_END_WALL:"-SBE"};class tn{matrix;entryPointByDoor;exitPointByDoor;constructor(){this.entryPointByDoor=new C(0,0),this.exitPointByDoor=new C(0,0)}static generateTileMapPlan(e,t){let i=new tn,r=i.convertToMatrix(e);return r=i.clarifyMatrix(r),i.createPlan(r,t),i}convertToMatrix(e){let t=[],i=0;return e.forEach(e=>{i=Math.max(i,e.length)}),e.forEach(e=>{e.length<i&&(e+=" ".repeat(i-length)),t.push(e.split(""))}),t}clarifyMatrix(e){let t=[];return e.forEach((i,r)=>{let n=[];t.push(n),i.forEach((t,i)=>{var s,o,a,h;let l;let c=e9(e,r,i);(s=t,tt.VOID.includes(s))?t=" ":ta(t)?(o=t,th(c.above)&&(th(c.tl)?o+=tr.BELOW_WALL:o+=tr.BELOW_END_WALL),a=t=o,ts(c.left)||ts(c.above)||ts(c.right)||ts(c.below))?this.entryPointByDoor=new C(i,r):(to(c.right)||to(c.below)||to(c.left)||to(c.above))&&(this.exitPointByDoor=new C(i,r)):th(t)&&(l=h=t,th(c.above)&&th(c.right)&&th(c.below)&&th(c.left)?l+=ti.INTERNAL_CROSS:ta(c.left)&&ta(c.right)?l+=ti.INTERNAL_VERTICAL:ta(c.above)&&ta(c.below)?l+=ti.INTERNAL_HORIZONTAL:th(c.left)&&th(c.right)&&th(c.below)?l+=ti.TOP_TEE:th(c.above)&&th(c.below)&&th(c.left)?l+=ti.RIGHT_TEE:th(c.left)&&th(c.right)&&th(c.above)?l+=ti.BOTTOM_TEE:th(c.above)&&th(c.below)&&th(c.right)?l+=ti.LEFT_TEE:th(c.right)&&th(c.below)?l+=ta(c.br)?ti.TOP_LEFT:ti.TOP_LEFT_INTERNAL:th(c.left)&&th(c.below)?l+=ta(c.bl)?ti.TOP_RIGHT:ti.TOP_RIGHT_INTERNAL:th(c.left)&&th(c.above)?l+=ta(c.tl)?ti.BOTTOM_RIGHT:ti.BOTTOM_RIGHT_INTERNAL:th(c.right)&&th(c.above)?l+=ta(c.tr)?ti.BOTTOM_LEFT:ti.BOTTOM_LEFT_INTERNAL:th(c.above)&&th(c.below)?l+=ta(c.right)?ti.LEFT:ti.RIGHT:th(c.right)&&th(c.left)&&(l+=ta(c.below)?ti.TOP:ti.BOTTOM),t=th(c.above)?l+tr.BELOW_WALL:l),n.push(t)})}),t}createPlan(e,t){let i=[];e.forEach(e=>{let r=[];i.push(r),e.forEach(e=>{r.push(function e(t,i){if(" "===t)return null;let r=t.match(/(.)(-[^-]*)?(-[^-]*)?/),n=i.get(t);if(!n&&r[2]&&r[3]&&(n=i.get(`${r[1]}${r[2]}`)),!n&&r[2]&&(n=i.get(r[1])),!n){let n=function(e){for(let t in tt)if(tt[t].includes(e))return tt[t][0];return null}(r[1]);if(n&&n!==r[1]){var s,o;let t;return e((s=r[2],o=r[3],t=n,s&&(t+=s),o&&(t+=o),t),i)}f.error(`Failed to find symbol for ${t}`)}return n}(e,t))})}),this.matrix=i}}function ts(e){return tt.DOOR_IN.includes(e)}function to(e){return tt.DOOR_OUT.includes(e)}function ta(e){return tt.GROUND.includes(e)}function th(e){var t;return tt.WALL.includes(e)||ts(t=e)||to(t)}class tl{#eC;#eP;constructor(e){this.#eP=e,this.#eC=new Map}setRouteToCoords(e,t,i){this.#eC.set(this.coordsToKey(t,i),e)}getRouteToCoords(e,t){return this.#eC.get(this.coordsToKey(e,t))}hasRouteToCoords(e,t){return this.#eC.has(this.coordsToKey(e,t))}coordsToKey(e,t){return`${e}|${t}`}keyToGridPoint(e){let t=e.split("|");return new C(parseInt(t[0]),parseInt(t[1]))}forEach(e){this.#eC.forEach((t,i,r)=>e(t,i,r))}containsGridPoint(e){return this.#eC.has(this.coordsToKey(e.x,e.y))}getWaypointsAsGridPoints(e){let t=this.getRouteToCoords(e.x,e.y);return t.length>1?t.slice(1):null}getWaypointsAsWorldPoints(e){let t=this.getWaypointsAsGridPoints(e);return t?t.map(e=>this.#eP.gridPointToWorldPoint(e)):t}}class tc{actor;#eC;#eP;#eb;constructor(e,t){this.#eP=e,this.actor=t}getDumbRouteNextTo(e,t,i){let r=this.#ez(e,t);if(r.coincident(e))return[];this.#eP.canGridPointBeOccupiedByActor(r,this.actor)||(r=this.#eM(r,t));let n=[],s=Math.sign(r.x-e.x),o=Math.sign(r.y-e.y),a=C.copy(e),h=.5>Math.random(),l=0;for(;i>0;){let t=C.copy(a),c=!1;if(h&&0!==s&&a.x!=r.x?(t.x+=s,c=!0):h||0===o||a.y==r.y||(t.y+=o,c=!0),c=c&&this.#eP.canGridPointBeOccupiedByActor(t,this.actor))l=0,a=t,i--;else{if(++l>=2)break;a.coincident(e)||n.push(this.#eP.gridPointToWorldPoint(a)),e=a,h=!h}}return a.coincident(e)||n.push(this.#eP.gridPointToWorldPoint(a)),n}getAllRoutesFrom(e,t){return this.#eC=new tl(this.#eP),this.#eb=e,this.#eO(e.x,e.y,t,null),this.#eC}#eO(e,t,i,r){if(r){if(e===this.#eb.x&&t===this.#eb.y||!this.#ek(e,t))return;let n=this.#eC.getRouteToCoords(e,t);if(n&&!(r.length<n.length-1))return;r.push(new C(e,t)),this.#eI(e,t)&&this.#eC.setRouteToCoords(r,e,t),i--}else r=[new C(e,t)];i>0&&(this.#eO(e,t-1,i,[...r]),this.#eO(e+1,t,i,[...r]),this.#eO(e,t+1,i,[...r]),this.#eO(e-1,t,i,[...r]))}#ek(e,t){return this.#eP.isGridPointPassableByActor(new C(e,t),this.actor)}#eI(e,t){return this.#eP.canGridPointBeOccupiedByActor(new C(e,t),this.actor)}#ez(e,t){let i=t.x-e.x,r=t.y-e.y,n=t.x,s=t.y;return Math.abs(i)>Math.abs(r)?n-=Math.sign(i):s-=Math.sign(r),new C(n,s)}#eM(e,t){return e.x===t.x&&e.y<t.y?new C(e.x+1,e.y+1):e.x>t.x&&e.y===t.y?new C(e.x-1,e.y+1):e.x===t.x&&e.y>t.y?new C(e.x-1,e.y-1):e.x<t.x&&e.y===t.y?new C(e.x+1,e.y-1):e}}class td{#ex;#eR;#eP;#eB;#eA;#eL;#e_;constructor(e,t){this.#eP=e,this.#ex=t}findReachedTiles(){return this.#eR=this.#eP.worldPointToGrid(this.#ex.position),this.#eL=this.#eP.getMapGridPointRect(),this.#eA&&this.#eA.coincident(this.#eR)&&this.#eL&&this.#eL.equals(this.#e_)||(this.#eB=new Map,this.#eB.set(this.#eR.toString(),this.#eR),this.#eN().forEach(e=>{this.#eD(e)}),this.#eA=this.#eR,this.#e_=this.#eL),this.#eB}isGridPointInRays(e){return!!this.#eB&&this.#eB.has(e.toString())}#eN(){let e=[];for(let t=this.#eL.x;t<=this.#eL.x+this.#eL.width;t++)e.push(new C(t,this.#eL.y)),e.push(new C(t,this.#eL.y+this.#eL.height));for(let t=this.#eL.y+1;t<=this.#eL.y+this.#eL.height-1;t++)e.push(new C(this.#eL.x,t)),e.push(new C(this.#eL.x+this.#eL.width,t));return e}#eD(e){let t,i,r;let n=function(e){let t=Math.abs(e);return t<=x.DEG_22_5?T.E:t<=x.DEG_67_5?Math.sign(e)>0?T.NE:T.SE:t<=x.DEG_112_5?Math.sign(e)>0?T.N:T.S:t<=x.DEG_157_7?Math.sign(e)>0?T.NW:T.SW:T.W}(this.#eR.getScreenAngleTo(e));Math.abs(e.x-this.#eR.x)>=Math.abs(e.y-this.#eR.y)?(t=Math.sign(e.x-this.#eR.x),i=(r=Math.abs(e.x-this.#eR.x))<1?0:(e.y-this.#eR.y)/r):(i=Math.sign(e.y-this.#eR.y),t=(r=Math.abs(e.y-this.#eR.y))<1?0:(e.x-this.#eR.x)/r);let s=this.#eR.x,o=this.#eR.y,a=!0;for(;r>=0;){let e=new C(Math.round(s),Math.round(o));if(a||this.#eP.isSeeThrough(e,this.#ex))this.#eG(e,n);else break;a=!1,s+=t,o+=i,r--}}#eG(e,t){switch(this.#eB.set(e.toString(),e),t){case T.N:this.#eW(new C(e.x-1,e.y-1)),this.#eW(new C(e.x,e.y-1)),this.#eW(new C(e.x+1,e.y-1));break;case T.NE:this.#eW(new C(e.x,e.y-1)),this.#eW(new C(e.x+1,e.y-1)),this.#eW(new C(e.x+1,e.y));break;case T.E:this.#eW(new C(e.x+1,e.y-1)),this.#eW(new C(e.x+1,e.y)),this.#eW(new C(e.x+1,e.y+1));break;case T.SE:this.#eW(new C(e.x+1,e.y)),this.#eW(new C(e.x+1,e.y+1)),this.#eW(new C(e.x,e.y+1));break;case T.S:this.#eW(new C(e.x-1,e.y+1)),this.#eW(new C(e.x,e.y+1)),this.#eW(new C(e.x+1,e.y+1));break;case T.SW:this.#eW(new C(e.x-1,e.y)),this.#eW(new C(e.x-1,e.y+1)),this.#eW(new C(e.x,e.y+1));break;case T.W:this.#eW(new C(e.x-1,e.y-1)),this.#eW(new C(e.x-1,e.y)),this.#eW(new C(e.x-1,e.y+1));break;case T.NW:this.#eW(new C(e.x-1,e.y)),this.#eW(new C(e.x-1,e.y-1)),this.#eW(new C(e.x,e.y-1))}}#eW(e){this.#eP.isSeeThrough(e)||this.#eB.set(e.toString(),e)}}function tu(e){return e?tm(o).then(()=>e.load().then(()=>e.initialise()).then(()=>{a=new eY(r,48,eK.BR),addEventListener("fullscreenchange",()=>{document.fullscreenElement?(f.debug("Entering fullscreen mode"),i.setCurrentIndex(1)):(f.debug("Exiting fullscreen mode."),i.setCurrentIndex(0))}),i=new ed(0,{prefix:"hud-fullscreen",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:el.STOP}),(t=eQ.addButton(i,()=>{var e;(e=document.body).requestFullscreen?e.requestFullscreen({navigationUI:"hide"}):Promise.reject(Error("Fullscreen requests not supported by browser"))},()=>{document.exitFullscreen()})).position.x=eO.TILE_SIZE,t.position.y=-eO.TILE_SIZE,eQ.setVisible(!0),o=e})):(f.error("Attempt made to switch to the next scene when there are no more."),Promise.reject())}function tm(e){return e?e.unload().then(()=>(et.clearAll(),o=null,a=null,eQ.clear(),eQ.setVisible(!1),Promise.resolve())):Promise.resolve(null)}function tp(){return++s<n.length?new tX(n[s]):null}var tf={areThereMoreScenes:function(){return s<n.length-1},setCameraToTrack:function(e,t,i){r=new eX(e,t,i)},panCameraBy:function(e,t){r.panBy(e,t),r.setTrackingMethod(eV.OFF),a.setTrackingState(!1)},setSceneDefinitions:function(e){n=e,s=-1},switchToFirstScene:function(){return tu((s=-1,tp()))},switchToNextScene:function(){return tu(tp())},unloadCurrentScene:function(){return tm(o)},update:function(e){o?.update(e),r?.update(e)}};const tg=[{id:"BLOOD_ON",label:"Blood on",defValue:!0,controlType:e_.NATIVE_CHECKBOX,persistent:!0,action:null},{id:"UNUSED",label:"Not used yet",defValue:!1,controlType:e_.NATIVE_CHECKBOX,persistent:!0,action:null}],tw={MAIN_MENU:0,CLICKED_FREE_GROUND:1,CLICKED_ENTRANCE:2,CLICKED_EXIT:3};class ty{#ex;#eF;#eH;#eP;#e$;constructor(e,t,i){this.#ex=e,this.#eP=t,this.#e$=i}moveInstantly(){this.#eH=b.copy(this.#ex.position);let e=this.#eP.worldPointToGrid(this.#ex.position),t=this.#ex.isWandering()?this.#eU(e,this.#ex.maxTilesPerMove):this.#eP.worldPointToGrid(h.position);if(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=2*this.#ex.maxTilesPerMove&&this.#eP.canHeroSeeGridPoint(e)){this.#e$.actor=this.#ex;let i=this.#e$.getDumbRouteNextTo(e,t,this.#ex.maxTilesPerMove);i.length>0&&(this.#eF=new eP({path:i,speed:100},this.#ex.sprite.modifier),this.#eV(i[i.length-1]))}}#eU(e,t){let i=v(e.x-t,e.x+t),r=v(e.y-t,e.y+t),n=this.#eP.getDimsInTiles();return new C(S(i,0,n.width-1),S(r,0,n.height-1))}#eV(e){let t=this.#eP.worldPointToGrid(this.#ex.position);this.#ex.position=e;let i=this.#eP.worldPointToGrid(this.#ex.position);this.#eP.moveTileOccupancyGridPoint(this.#ex,t,i)}#eX(){this.#eV(this.#eH)}replay(){return(this.#eX(),this.#eF)?this.#eF.applyAsTransientToSprite(this.#ex.sprite):Promise.resolve()}}class tx{#eP;#e$;#eK;constructor(e,t){this.#eK=[],this.#eP=e,this.#e$=t}addAndMoveActor(e){let t=new ty(e,this.#eP,this.#e$);t.moveInstantly(),this.#eK.push(t)}replay(){let e=[];return this.#eK.forEach(t=>e.push(t.replay())),Promise.all(e)}}class tS{constructor(){}async transitionTo(e){await this.onExit().then(()=>(tR=e,e.onEntry()))}onEntry(){return Promise.resolve()}onEvent(e){return Promise.resolve(null)}onExit(){return Promise.resolve(null)}}class tT extends tS{onEntry(){return(function(){let e=new eB({id:"PLAY",label:"Play",imageName:"ui-play00.png",internalLabel:!0,closes:!0}),t=new eB({id:"SETTINGS",label:"Settings",imageName:"ui-settings00.png",internalLabel:!0,action:()=>(function(){let e=[];return tg.forEach(t=>{e.push(function(e){let t;switch(e.controlType){case e_.TEXT_BUTTON:t=new eR(e);break;case e_.NATIVE_CHECKBOX:t=new eL(e.id,e.label,e.persistent)}return t}(t))}),eD.showControlsDialog("Settings",e,"door")})(),closes:!1});return eD.showControlsDialog("Welcome to the Scripted Dungeon",[t,e],"door")})().then(()=>this.transitionTo(new tE))}}class tE extends tS{onEntry(){return f.log("Enter AtStart"),eD.showOkDialog("You are in a dark and dingy dungeon.","Conquer it!","wall").then(()=>tf.switchToFirstScene()).then(()=>(h.sprite.position=et.getTileMap().getWorldPositionOfTileByEntry(),tR.transitionTo(new tP)))}}class tv extends tS{async onEntry(){f.log("Enter AtGameOver"),ez("YOU DIED!",{lifetimeSecs:2,position:h.position,velocity:new P(0,-100,0)}),await new Promise(e=>{setTimeout(()=>e(),2e3)}).then(()=>eD.showOkDialog("Game over. You died.","Try again")).then(()=>tf.unloadCurrentScene()).then(()=>this.transitionTo(new tT))}}class tC extends tS{async onEntry(){f.log("Enter AtGameCompleted"),await eD.showOkDialog("You've done it. Well done.","Try again").then(()=>tf.unloadCurrentScene()).then(()=>this.transitionTo(new tT))}}class tP extends tS{constructor(){super()}async onEntry(){await super.onEntry(),f.log("Enter HeroTurnIdle"),await tO()}async onEvent(e,t,i){switch(e){case tw.CLICKED_FREE_GROUND:i?.filter===tL.COMBAT_TILE?f.error("Unexpected click on combat tile ignored."):await tk(t),this.transitionTo(new tz);break;case tw.CLICKED_ENTRANCE:alert("Wow! Leaving so early. That bit of code is not ready yet.");break;case tw.CLICKED_EXIT:f.log("Escaping"),await tk(t),tf.areThereMoreScenes()?await tI(this):this.transitionTo(new tC)}return Promise.resolve(null)}}class tb extends tS{constructor(){super()}async onEntry(){await super.onEntry(),f.log("Enter HeroTurnFighting"),await tO()}async onEvent(e,t,i){switch(e){case tw.CLICKED_FREE_GROUND:i?.filter===tL.COMBAT_TILE?await this.#eY(t):await this.#eZ(t),0===et.getTileMap().getParticipants(h).length?this.transitionTo(new tz):this.transitionTo(new tM);break;case tw.CLICKED_ENTRANCE:alert("Wow! Leaving so early. That bit of code is not ready yet.");break;case tw.CLICKED_EXIT:f.log("Escaping"),await tk(t),tf.areThereMoreScenes()?await tI(this):this.transitionTo(new tC)}return Promise.resolve(null)}#eY(e){let t=et.getTileMap().getTileAtWorldPoint(e).getOccupants(),i=[];for(let e of t.values())e.interaction&&i.push(e.interaction.react(h));return Promise.all(i)}#eZ(e){for(let e of et.getTileMap().getParticipants(h))if(e.alive&&!e.interaction.allowEscape(h))return Promise.resolve(!1);return tk(e)}}class tz extends tS{constructor(){super()}async onEntry(){await super.onEntry(),f.log("Enter ComputerTurnIdle");let e=et.getTileMap(),t=new tc(e),i=new tx(e,t),r=e.worldPointToGrid(h.position);for(let t of et.getActors().values())t!==h&&t.alive&&(t.isWandering()&&e.worldPointToGrid(t.position).isOtherClose(r,1.5)||i.addAndMoveActor(t));return await i.replay(),0===e.getParticipants(h).length?this.transitionTo(new tP):this.transitionTo(new tb),Promise.resolve(null)}}class tM extends tS{constructor(){super()}async onEntry(){await super.onEntry(),f.log("Enter ComputerTurnFighting");let e=et.getTileMap(),t=new tc(e),i=new tx(e,t),r=e.getParticipants(h);for(let e of et.getActors().values())e!==h&&e.alive&&(r.includes(e)?await e.interaction.enact(h):i.addAndMoveActor(e));return await i.replay(),0===h.traits.get("HP")?this.transitionTo(new tv):0===r.length?this.transitionTo(new tP):this.transitionTo(new tb),Promise.resolve(null)}}function tO(){let e=et.getTileMap(),t=new tc(e,h).getAllRoutesFrom(e.worldPointToGrid(h.sprite.position),h.maxTilesPerMove);return e.setMovementRoutes(t),e.setCombatActors(e.getParticipants(h)),Promise.resolve(null)}function tk(e){let t=et.getTileMap(),i=t.getWaypointsToWorldPoint(e);return(t.setMovementRoutes(null),t.setCombatActors(null),i)?new eP({path:i,speed:100},h.sprite.modifier).applyAsTransientToSprite(h.sprite):Promise.resolve()}function tI(e){return tf.switchToNextScene().then(()=>(h.sprite.position=et.getTileMap().getWorldPositionOfTileByEntry(),e.transitionTo(new tP)))}let tR=new class extends tS{onEntry(){f.log("WaitingToStart state")}async onEvent(e,t,i){e===tw.MAIN_MENU&&this.transitionTo(new tT)}},tB=!1;var tA={EventId:tw,getHeroActor:function(){return h},setHero:function(e){h=e},triggerEvent:function(e,t,i){if(tB){f.debug(`Ignoring event ${e} as still processing earlier event.`);return}tB=!0,tR.onEvent(e,t,i).then(()=>{tB=!1})}};const tL={MOVEMENT_TILE:0,COMBAT_TILE:1},t_={OBSTACLE:-1,GROUND:0,ENTRANCE:1,EXIT:2};class tN extends e${sprite;obstacle;#eq;#ej;#eJ;#eQ;constructor(e,t){super(),this.sprite=e,this.#eq=new Map,this.obstacle=t.obstacle,this.#ej=t.gridPoint,this.#eJ=t.worldPoint,this.#eQ=t.role}get role(){return this.#eQ}get gridPoint(){return this.#ej}get worldPoint(){return this.#eJ}addOccupant(e){this.#eq.set(e,e)}deleteOccupant(e){this.#eq.delete(e)}getOccupants(){return this.#eq}actionClick(e){super.actionClick(this.sprite.position)}actionContextClick(e){super.actionClick(this.sprite.position)}isOccupied(){return this.#eq.size>0}isPassableByActor(e){if(this.obstacle)return!1;for(let t of this.#eq.values())if(t!==e&&!t.isPassableByActor(e))return!1;return!0}canBeOccupiedByActor(e){if(this.obstacle)return!1;for(let t of this.#eq.values())if(t!==e&&!t.canShareLocationWithActor(e))return!1;return!0}isSeeThrough(e){return!this.obstacle&&this.#eQ!==t_.ENTRANCE&&this.#eQ!==t_.EXIT}}class tD{#e4;#e0;#e1;#e8;#e2;#y;#x;#e3;#e6;#e7;#e5;#e9;#te;#tt;#ti;#tr;#tn;#ts;constructor(e,t,i){let r=t.matrix;this.#te=t.entryPointByDoor,this.#tt=t.exitPointByDoor,this.#e4=e,this.#e7=new ex({renderer:new ef(e,{width:i,height:i,fillStyle:null,strokeStyle:"white"})}),this.#ts=new ex({renderer:new ef(e,{width:i,height:i,fillStyle:null,strokeStyle:"red"})}),this.#e2=i,this.#e0=[],this.#e8=r.length,this.#e1=r[0].length,this.#y=i*this.tilesX,this.#x=i*this.tilesY,this.#ti=[],r.forEach((t,i)=>{let r=[];this.#e0.push(r),t.forEach((t,n)=>{if(t){let s=new ex({renderer:new ey(e,eo.getSpriteBitmap(0,t.image))}),o=new C(n,i),a=this.gridPointToWorldPoint(o),h=new tN(s,{obstacle:t.role===t_.OBSTACLE,gridPoint:o,worldPoint:a,role:t.role});t.onClick&&(h.setOnClick((e,i)=>this.#to(e,i,t.onClick)),h.setOnContextClick(t.onContextClick)),this.processTileRole(h),r.push(h),s.position.x=n*this.#e2+this.#e2/2,s.position.y=i*this.#e2+this.#e2/2}else r.push(null)})}),this.#e5||(f.error("No entrance has been set. Setting to the first ground tile"),this.#e5=this.#ti[0])}getDimsInTiles(){return{width:this.#e1,height:this.#e8}}processTileRole(e){switch(e.role){case t_.ENTRANCE:if(this.#e5){let t=e.gridPoint;f.error(`Duplicate entrance found at (${t.x}, ${t.y}). Ignored.`)}else this.#e5=e;break;case t_.EXIT:if(this.#e9){let t=e.gridPoint;f.error(`Duplicate exit found at (${t.x}, ${t.y}). Ignored.`)}else this.#e9=e;break;case t_.GROUND:e.gridPoint.coincident(this.#te)||this.#ti.push(e)}}update(e){this.#ta();let t=this.getVisibleGridPointRect();for(let i=t.y;i<=t.y+t.height;i++)for(let r=t.x;r<=t.x+t.width;r++)if(this.#tr?.isGridPointInRays(new C(r,i))){let t=this.#e0[i][r];t?.sprite.update(e)}this.#th(e)}#ta(){let e=tA.getHeroActor();if(e){this.#tr||(this.#tr=new td(this,e));let t=this.getTileAtWorldPoint(e.position);if(t){let e=t.role;e!=t_.ENTRANCE&&e!=t_.EXIT&&this.#tr.findReachedTiles()}else f.error(`Hero at ${e.position.toString()} but no tile found.`)}}getMapGridPointRect(){return new z(0,0,this.#e1,this.#e8)}getVisibleGridPointRect(){let e=Z.getWorldInCanvasBounds(),t=this.worldPointToGrid(new C(e.x,e.y)),i=this.worldPointToGrid(new C(e.x+e.width,e.y+e.height)),r=Math.max(0,t.x),n=Math.min(this.#e1-1,i.x),s=Math.max(0,t.y);return new z(r,s,n-r,Math.min(this.#e8-1,i.y)-s)}getGridSize(){return this.#e2}getDimensions(){return{width:this.#y,height:this.#x}}getTileAtWorldPoint(e){let t=this.worldPointToGrid(e);return this.getTileAtGridPoint(t)}getTileAtGridPoint(e){if(!e)return null;let t=e.y,i=e.x;return i>=0&&t>=0&&i<this.#e1&&t<this.#e8?this.#e0[t][i]:null}worldPointToGrid(e){return new C(Math.floor(e.x/this.#e2),Math.floor(e.y/this.#e2))}gridAlignedWorldPoint(e){let t=this.worldPointToGrid(e);return this.gridPointToWorldPoint(t)}gridPointToWorldPoint(e){let t=.5*this.#e2;return new C(e.x*this.#e2+t,e.y*this.#e2+t)}getWorldPositionOfTileByEntry(){return this.gridPointToWorldPoint(this.#te)}getGridPositionOfEntrance(){return this.#e5.gridPoint}setMovementRoutes(e){this.#e3=e,e?(this.#e6=new Map,this.#e3.forEach(e=>e.forEach(e=>{this.#e6.set(e,e)}))):this.#e6=null}setCombatActors(e){this.#tn=[],e?.forEach(e=>{this.#tn.push(this.worldPointToGrid(e.position))})}#th(e){this.#tl(e),this.#tc(e)}#tl(e){this.#e6?.forEach(t=>{this.#e7.position=this.gridPointToWorldPoint(t),this.#e7.update(e)})}#tc(e){this.#tn?.forEach(t=>{this.#ts.position=this.gridPointToWorldPoint(t),this.#ts.update(e)})}#to(e,t,i){if(this.#e3?.containsGridPoint(this.worldPointToGrid(t))){i(e,t,{filter:tL.MOVEMENT_TILE});return}let r=this.worldPointToGrid(t);this.#tn?.forEach(n=>{if(n.isCoincident(r)){i(e,t,{filter:tL.COMBAT_TILE});return}}),f.debug("Ignore click outside of highlighted area")}getWaypointsToWorldPoint(e){let t=this.worldPointToGrid(e);return this.#e3?.getWaypointsAsWorldPoints(t)}getRandomFreeGroundTile(){for(let e of(te(this.#ti),this.#ti))if(!e.isOccupied())return e;return null}isGridPointPassableByActor(e,t){let i=this.getTileAtGridPoint(e);return!!i&&i.isPassableByActor(t)}canGridPointBeOccupiedByActor(e,t){let i=this.getTileAtGridPoint(e);return!!i&&i.canBeOccupiedByActor(t)}canHeroSeeGridPoint(e){return this.#tr?.isGridPointInRays(e)??!0}isSeeThrough(e,t){let i=this.getTileAtGridPoint(e);return!i||i.isSeeThrough(t)}getSurroundingTiles(e){return e9(this.#e0,e.y,e.x)}deleteOccupancyOfGridPoint(e,t){this.getTileAtGridPoint(t)?.deleteOccupant(e)}moveTileOccupancyGridPoint(e,t,i){i!==t&&(this.getTileAtGridPoint(t)?.deleteOccupant(e),this.getTileAtGridPoint(i)?.addOccupant(e))}getParticipants(e){let t=[],i=this.getSurroundingTiles(this.worldPointToGrid(e.position));return[i.above,i.right,i.below,i.left].forEach(e=>{let i=e?.getOccupants();i?.forEach(e=>{t.push(e)})}),t}}function tG(e){return{role:t_.GROUND,onClick:(e,t,i)=>tA.triggerEvent(tA.EventId.CLICKED_FREE_GROUND,t,i),image:e}}function tW(e){return{role:t_.ENTRANCE,onClick:(e,t,i)=>tA.triggerEvent(tA.EventId.CLICKED_ENTRANCE,t,i),image:e}}function tF(e){return{role:t_.EXIT,onClick:(e,t,i)=>tA.triggerEvent(tA.EventId.CLICKED_EXIT,t,i),image:e}}const tH=new Map([["x",{role:t_.OBSTACLE,image:"block.png"}],["#-TL",{role:t_.OBSTACLE,image:"wall-TL.png"}],["#-TLI",{role:t_.OBSTACLE,image:"wall-TLI.png"}],["#-T",{role:t_.OBSTACLE,image:"wall-T.png"}],["#-TR",{role:t_.OBSTACLE,image:"wall-TR.png"}],["#-TRI",{role:t_.OBSTACLE,image:"wall-TRI.png"}],["#-R",{role:t_.OBSTACLE,image:"wall-R.png"}],["#-BR",{role:t_.OBSTACLE,image:"wall-BR.png"}],["#-BRI",{role:t_.OBSTACLE,image:"wall-BRI.png"}],["#-B",{role:t_.OBSTACLE,image:"wall-B.png"}],["#-BL",{role:t_.OBSTACLE,image:"wall-BL.png"}],["#-BLI",{role:t_.OBSTACLE,image:"wall-BLI.png"}],["#-L",{role:t_.OBSTACLE,image:"wall-L.png"}],["#-XI",{role:t_.OBSTACLE,image:"wall-XI.png"}],["#-VI",{role:t_.OBSTACLE,image:"wall-VI.png"}],["#-HI",{role:t_.OBSTACLE,image:"wall-HI.png"}],["#-TTEE",{role:t_.OBSTACLE,image:"wall-TTEE.png"}],["#-RTEE",{role:t_.OBSTACLE,image:"wall-RTEE.png"}],["#-BTEE",{role:t_.OBSTACLE,image:"wall-BTEE.png"}],["#-LTEE",{role:t_.OBSTACLE,image:"wall-LTEE.png"}],["#",{role:t_.OBSTACLE,image:"block.png"}],["=-T",tF("door-T.png")],["=-R",tF("door-R.png")],["=-B",tF("door-B.png")],["=-L",tF("door-L.png")],["--T",tW("door-T.png")],["--R",tW("door-R.png")],["--B",tW("door-B.png")],["--L",tW("door-L.png")],["=",{role:t_.OBSTACLE,image:"block.png"}],["-",{role:t_.OBSTACLE,image:"block.png"}],[".",tG("floor.png")],[".-SBW",tG("floor-SBW.png")],[".-SBE",tG("floor-SBE.png")],[",-SBE",tG("floor2-SBE.png")],[",-SBW",tG("floor2-SBW.png")],[",",tG("floor2.png")]]);class t${#td;#G;#tu;#tm;#tp;heroActor;constructor(e=2,t=2){e>0?(this.#td=0,this.#G=1/e):this.#G=1,this.#tu=e,this.#tm=t}getOpacity(){return this.#td}load(){return this.doLoad()}initialise(){return this.doInitialise()}update(e){Z.clearCanvas(),Z.setOpacity(this.#td),et.update(e),this.doUpdate(e),eQ.update(e),Z.setOpacity(1),0!==this.#G&&(this.#td+=e*this.#G,this.#td>1?(this.#G=0,this.#td=1):this.#td<0&&(this.#G=0,this.#td=0)),this.#tp&&0===this.#td&&(this.#tp(),this.#tp=null)}unload(){return this.#tf().then(()=>this.doUnload())}#tf(){return this.#tm>0?(this.#G=-1/this.#tm,new Promise(e=>{this.#tp=e})):Promise.resolve()}doLoad(){return Promise.resolve()}doInitialise(){return Promise.resolve()}doUpdate(e){return Promise.resolve()}doUnload(){return Promise.resolve()}}const tU=eO.TILE_SIZE;class tV{intro;hero;enemies;mapDesign;constructor(){this.enemies=[],this.mapDesign=[]}}class tX extends t${#tg;constructor(e){super(),this.#tg=e}doLoad(){return Promise.resolve()}doInitialise(){let e=tn.generateTileMapPlan(this.#tg.mapDesign,tH),t=new tD(Z.getContext2D(),e,tU);return et.setTileMap(t),this.heroActor=function(e){if(e.hero){let t=e5.get(e.hero.id).create();return t.traits=e.hero.traits.clone(),l=t,t}if(!l)throw Error("No hero has been defined.");return l}(this.#tg),(function(e){let t=[];return e.enemies.forEach(e=>{let i=e5.get(e.id).create();i.traits=e.traits,t.push(i)}),t})(this.#tg).forEach(e=>{e.position=t.getRandomFreeGroundTile().worldPoint,et.addActor(e)}),tf.setCameraToTrack(this.heroActor.sprite,200,0),et.addActor(this.heroActor),tA.setHero(this.heroActor),Promise.resolve()}doUpdate(e){}doUnload(){return Promise.resolve(null)}}class tK{#tw;#ty;constructor(e){e?(this.#tw=new Map(e),this.#ty=!1):(this.#tw=new Map,this.#ty=!0)}set(e,t){if(this.#ty||this.#tw.has(e))this.#tw.set(e,t);else throw Error(`Attempt to set invalid key '${e}'`)}get(e){return this.#tw.get(e)}setFromString(e){return e.split(",").forEach(e=>{let t=e.match(/^\s*(\w+)\s*[=: ]\s*(.+?)\s*$/);if(t)this.#tx(t[1],t[2]);else throw Error(`Invalid property definition'${e}'`)}),this}#tx(e,t){let i=t.match(/(\d+) *[/] *(\d+) */);i?(this.#tw.set(e,i[1]),this.#tw.set(`${e}_MAX`,i[2])):this.#tw.set(e,t)}clone(){let e=new tK(this.#tw);return e.#ty=this.#ty,e}}class tY extends tK{constructor(e){super(e??new Map([["NAME","mystery"],["MOVEMENT","wander"],["HP",10],["HP_MAX",10],["STR",10],["STR_MAX",10]]))}}class tZ{#tS;#tT;#tE;#tv;#tC;#tP;#tb;#tz;#tM;#tO;constructor(e){this.#tS=v(e.minCols,e.maxCols),this.#tT=v(e.minRows,e.maxRows),this.#tE=e.maxRoomCols,this.#tv=e.maxRoomRows,this.#tC=tt.WALL[0],this.#tP=tt.GROUND[0],this.#tM=tt.VOID[0],this.#tb=tt.DOOR_IN[0],this.#tz=tt.DOOR_OUT[0]}generate(){this.#tO=[];let e=0,t=this.#tS;for(;this.#tO.length<this.#tT-4;){let i=e+t-4-2,r=i>0?E(0,i):0,n=Math.max(e-r+4,4),s=Math.min(this.#tE,this.#tS-r),o=s>n?E(n,s):n,a=this.#tS-r-o,h=E(4,Math.min(this.#tv,this.#tT-this.#tO.length));this.#tk(r,o,a,h),e=r,t=o}return this.#tI(),this.#tR(),this.getMatrixAsStrings()}getMatrixAsStrings(){return this.#tO.map(e=>e.join(""))}#tk(e,t,i,r){f.log(`Create room ${e} ${t} ${i} ${r}`);let n="";n+=this.#tM.repeat(e)+this.#tC.repeat(t)+this.#tM.repeat(i),this.#tO.push(n.split(""));for(let s=0;s<r-2;s++)n=""+this.#tM.repeat(e)+this.#tC+this.#tP.repeat(t-2)+this.#tC+this.#tM.repeat(i),this.#tO.push(n.split(""));n=""+this.#tM.repeat(e)+this.#tC.repeat(t)+this.#tM.repeat(i),this.#tO.push(n.split(""))}#tI(){for(let e=1;e<this.#tO.length-1;e++)for(let t=1;t<this.#tO[0].length-2;t++)this.#tO[e][t]===this.#tC&&this.#tO[e+1][t]===this.#tC&&this.#tO[e-1][t]===this.#tP&&this.#tO[e+2][t]===this.#tP&&(this.#tO[e][t]=this.#tP,this.#tO[e+1][t]=this.#tP)}#tB(e){return e.above===this.#tC&&e.centre===this.#tC&&e.below===this.#tC}#tA(e){return e.left===this.#tC&&e.centre===this.#tC&&e.right===this.#tC}#tR(){let e=[];this.#tO.forEach((t,i)=>t.forEach((t,r)=>{let n=e9(this.#tO,i,r);(this.#tA(n)||this.#tB(n))&&e.push({row:i,col:r})}));let t=te(e),i=t[0];this.#tO[i.row][i.col]=this.#tb,i=t[1],this.#tO[i.row][i.col]=this.#tz}}const tq={HERO:"HERO",LEVEL:"LEVEL",CAST:"CAST",MAP:"MAP"};class tj{sceneDefn;lines;lineIndex;constructor(e,t,i){this.lines=e,this.lineIndex=t,this.sceneDefn=i}parse(){for(;this.lineIndex<this.lines.length;){let e=this.lines[this.lineIndex],t=tj.getSectionIdFromLine(e);if(t)return{nextSectionId:t,nextLineIndex:this.lineIndex};this.parseLine(e),this.lineIndex++}return null}static findFirstSection(e){for(let t=0;t<e.length;t++){let i=tj.getSectionIdFromLine(e[t].trim());if(i)return{nextSectionId:i,nextLineIndex:t}}return null}parseLine(e){throw"Method parseLine should be overridden."}static getSectionIdFromLine(e){let t=e.match(/^\s*\[ *([\w ]+) *\]/);return t?t[1].toUpperCase():null}fatalError(e){throw Error(`Error parsing script on line ${this.lineIndex+1}: ${e}`)}ignoreError(e){f.debug(`Ignoring error parsing script on line ${this.lineIndex}: ${e}`)}}class tJ extends tj{constructor(e,t,i){super(e,t,i),this.sceneDefn.intro=""}parseLine(e){this.sceneDefn.intro+=""===e?"\n":e}}class tQ extends tj{constructor(e,t,i){super(e,t,i)}parseLine(e){let t=e.match(/^\s*(\w+?) *: *([\w,:= /]*)/);t?this.#tL(t):this.#t_(e)}#tL(e){let t=e[1],i=e[2];try{let e=new tY().setFromString(i);this.sceneDefn.hero={id:"HERO",name:t||"mystery",traits:e}}catch(e){this.fatalError(e.message)}}#t_(e){this.fatalError("Long form actors not supported.")}}class t4 extends tj{constructor(e,t,i){super(e,t,i)}parseLine(e){let t=e.match(/^\s*(\w+?) *x(\d{1,2}) *([^:]*): *([\w,:= /]*)/);t?this.#tN(t):this.#tD(e)}#tN(e){let t=e[1].toUpperCase(),i=parseInt(e[2]),r=e[3],n=e[4];for(let e=0;e<i;e++)if(e5.has(t))try{let e=new tY().setFromString(n);this.sceneDefn.enemies.push({id:t,name:r||"mystery",traits:e})}catch(e){this.fatalError(e.message)}else this.fatalError(`Cast member ${t} does not exist.`)}#tD(e){this.fatalError("Long form actors not supported.")}}class t0 extends tj{#tG;#tW;constructor(e,t,i){super(e,t,i),this.#tG=!1,this.#tW=/^\s*random\s*$/i}parseLine(e){if(!this.#tG&&""!==e){if(this.#tW.test(e)){let e=new tZ({minCols:12,maxCols:40,maxRoomCols:10,minRows:12,maxRows:40,maxRoomRows:6});this.sceneDefn.mapDesign=e.generate(),this.#tG=!0,f.debug("Random map"),this.sceneDefn.mapDesign.forEach(e=>f.debug(e))}else this.sceneDefn.mapDesign.push(e)}}}function t1(e,t,i){switch(e){case tq.HERO:return new tQ(c,t+1,i);case tq.LEVEL:return new tJ(c,t+1,i);case tq.CAST:return new t4(c,t+1,i);case tq.MAP:return new t0(c,t+1,i)}return null}const t8="custom-pointer-down-event",t2="custom-pointer-up-event",t3="custom-pointer-cancel-event",t6="custom-click-event",t7="custom-pointer-drag-event",t5={MOUSE:0,TOUCH:1};function t9(e,t,i){let r=new CustomEvent(t,{detail:i});e.dispatchEvent(r)}function ie(e){let t=e.target.getBoundingClientRect();return{x:e.touches[0].pageX-t.left,y:e.touches[0].pageY-t.top}}function it(e,t,i,r){r.actionStarted=!0,r.dragging=!1,r.distance=0,r.lastX=t,r.lastY=i,r.startX=t,r.startY=i,t9(r.element,t8,{x:t,y:i})}function ii(e,t,i,r){let n=r.dragging?"custom-pointer-drag-end-event":t2;r.actionStarted=!1,r.dragging=!1,r.distance=0,r.lastX=t,r.lastY=i,r.startX=t,r.startY=i,t9(r.element,n,{x:t,y:i})}function ir(e,t,i,r){let n=t-r.lastX,s=i-r.lastY;if(r.lastX=t,r.lastY=i,r.dragging){let e=new CustomEvent(t7,{detail:{x:t,y:i,dx:n,dy:s}});r.element.dispatchEvent(e)}else(Math.abs(t-r.startX)>10||Math.abs(i-r.startY)>10)&&(r.dragging=!0,r.suppressClickEvent=!0)}var is={};is=JSON.parse('{"frames":[{"filename":"blank.png","frame":{"x":333,"y":246,"w":3,"h":3},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":3,"h":3},"sourceSize":{"w":48,"h":48}},{"filename":"block.png","frame":{"x":97,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"blood-splat.png","frame":{"x":1,"y":1,"w":94,"h":92},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":94,"h":92},"sourceSize":{"w":96,"h":96}},{"filename":"door-B.png","frame":{"x":1,"y":190,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-L.png","frame":{"x":702,"y":197,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-R.png","frame":{"x":721,"y":101,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-T.png","frame":{"x":147,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor-SBE.png","frame":{"x":197,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor-SBW.png","frame":{"x":247,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor.png","frame":{"x":297,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2-SBE.png","frame":{"x":347,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2-SBW.png","frame":{"x":397,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2.png","frame":{"x":447,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-dead00.png","frame":{"x":771,"y":150,"w":48,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"hero-idle00.png","frame":{"x":784,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-idle01.png","frame":{"x":497,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-idle02.png","frame":{"x":832,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-idle03.png","frame":{"x":197,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-e00.png","frame":{"x":862,"y":150,"w":34,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":1,"w":34,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-e01.png","frame":{"x":889,"y":199,"w":35,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":1,"w":35,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-e02.png","frame":{"x":1060,"y":101,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-e03.png","frame":{"x":1176,"y":151,"w":30,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":30,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-n00.png","frame":{"x":880,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-n01.png","frame":{"x":246,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-n02.png","frame":{"x":880,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-n03.png","frame":{"x":1167,"y":51,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-s00.png","frame":{"x":928,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-s01.png","frame":{"x":547,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-s02.png","frame":{"x":928,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-s03.png","frame":{"x":1120,"y":51,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-w00.png","frame":{"x":1101,"y":101,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-w01.png","frame":{"x":51,"y":190,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-w02.png","frame":{"x":821,"y":150,"w":39,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":39,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-w03.png","frame":{"x":1137,"y":151,"w":37,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":37,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero.png","frame":{"x":976,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-down00.png","frame":{"x":145,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-down01.png","frame":{"x":193,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-left00.png","frame":{"x":241,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-left01.png","frame":{"x":289,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-right00.png","frame":{"x":337,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-right01.png","frame":{"x":385,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-up00.png","frame":{"x":433,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-up01.png","frame":{"x":481,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-auto-centre00.png","frame":{"x":529,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-auto-centre01.png","frame":{"x":577,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-fullscreen00.png","frame":{"x":625,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-fullscreen01.png","frame":{"x":673,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"orc-dead00.png","frame":{"x":721,"y":151,"w":48,"h":34},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":11,"w":48,"h":34},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle00.png","frame":{"x":295,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle01.png","frame":{"x":344,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle02.png","frame":{"x":393,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle03.png","frame":{"x":442,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-e00.png","frame":{"x":1015,"y":150,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-e01.png","frame":{"x":776,"y":201,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-e02.png","frame":{"x":898,"y":149,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-e03.png","frame":{"x":1142,"y":101,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-n00.png","frame":{"x":96,"y":188,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-n01.png","frame":{"x":491,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-n02.png","frame":{"x":687,"y":51,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-n03.png","frame":{"x":976,"y":100,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-s00.png","frame":{"x":735,"y":51,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":47,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-s01.png","frame":{"x":540,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-s02.png","frame":{"x":735,"y":51,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":47,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-s03.png","frame":{"x":239,"y":197,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w00.png","frame":{"x":933,"y":100,"w":41,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":41,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w01.png","frame":{"x":756,"y":100,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":42,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w02.png","frame":{"x":589,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w03.png","frame":{"x":800,"y":100,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":42,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc.png","frame":{"x":638,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"pow.png","frame":{"x":1,"y":95,"w":92,"h":93},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":92,"h":93},"sourceSize":{"w":96,"h":96}},{"filename":"RIP.png","frame":{"x":97,"y":51,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"trader-dead00.png","frame":{"x":95,"y":149,"w":48,"h":37},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":37},"sourceSize":{"w":48,"h":48}},{"filename":"trader-idle-s03.png","frame":{"x":1024,"y":51,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-idle00.png","frame":{"x":427,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-idle01.png","frame":{"x":657,"y":197,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-idle02.png","frame":{"x":473,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-e00.png","frame":{"x":850,"y":199,"w":37,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":37,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-e01.png","frame":{"x":1018,"y":101,"w":40,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":40,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-e02.png","frame":{"x":814,"y":201,"w":34,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":34,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-e03.png","frame":{"x":737,"y":201,"w":37,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-n00.png","frame":{"x":519,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-n01.png","frame":{"x":844,"y":100,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":42,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-n02.png","frame":{"x":565,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-n03.png","frame":{"x":933,"y":150,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-s00.png","frame":{"x":333,"y":197,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":45,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-s01.png","frame":{"x":286,"y":197,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-s02.png","frame":{"x":380,"y":197,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":45,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-s03.png","frame":{"x":1072,"y":51,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-w00.png","frame":{"x":974,"y":150,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-w01.png","frame":{"x":888,"y":100,"w":43,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":1,"w":43,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-w02.png","frame":{"x":1055,"y":151,"w":39,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":1,"w":39,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-w03.png","frame":{"x":1096,"y":151,"w":39,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":1,"w":39,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader.png","frame":{"x":611,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"ui-checkbox00.png","frame":{"x":145,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-checkbox01.png","frame":{"x":193,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-play00.png","frame":{"x":241,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-play01.png","frame":{"x":289,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-settings00.png","frame":{"x":337,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-settings01.png","frame":{"x":385,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-down00.png","frame":{"x":433,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-down01.png","frame":{"x":481,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-left00.png","frame":{"x":529,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-left01.png","frame":{"x":577,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-right00.png","frame":{"x":625,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-right01.png","frame":{"x":673,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-up00.png","frame":{"x":143,"y":197,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-up01.png","frame":{"x":191,"y":197,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"wall-B.png","frame":{"x":597,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BL.png","frame":{"x":962,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BLI.png","frame":{"x":647,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BR.png","frame":{"x":926,"y":201,"w":34,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":34,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BRI.png","frame":{"x":697,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BTEE.png","frame":{"x":747,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-HI.png","frame":{"x":797,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-L.png","frame":{"x":997,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-LTEE.png","frame":{"x":1032,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-R.png","frame":{"x":1067,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-RTEE.png","frame":{"x":1102,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-T.png","frame":{"x":847,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TL.png","frame":{"x":1137,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TLI.png","frame":{"x":897,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TR.png","frame":{"x":1172,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TRI.png","frame":{"x":947,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TTEE.png","frame":{"x":997,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-VI.png","frame":{"x":1047,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-XI.png","frame":{"x":1097,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-B.png","frame":{"x":1147,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-HI.png","frame":{"x":95,"y":99,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-T.png","frame":{"x":147,"y":51,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}}],"meta":{"app":"https://www.codeandweb.com/texturepacker","version":"1.0","image":"dungeon.png","format":"RGBA8888","size":{"w":1208,"h":250},"scale":"1","smartupdate":"$TexturePacker:SmartUpdate:4534e0ee2047f5c5e3b4b1eab74e2e70:5c8c3f7b31e25a52db917ab223c06f93:9c0fba27a8a0c106083a8713f6c67b32$"}}');var io={};function ia(e){if(eh.updateTimeNow(e),u){var t;let i=(e-u)/1e3;tf.update(i),er.showFps&&(t=1/i,ei(Z.getContext2D(),`FPS: ${Math.round(t)}`,{x:0,y:Z.getCanvasDimensions().height},{color:"green"}))}u=e,window.requestAnimationFrame(ia)}io=new URL("dungeon.c7fee6f0.png",import.meta.url).toString();var ih={TILE_SIZE:48,initialise:async function(e){Z.setOptions(e),function(e){let t=0;for(let i in e4){let r=e.measureText(e4[i]),n=r.fontBoundingBoxAscent+r.fontBoundingBoxDescent,s=.5*n-r.fontBoundingBoxDescent;e.fillText(e4[i],-.5*r.width,s),e.getImageData(0,0,1,1).data[3]<=0&&(f.debug(`Emoji ${i} not supported.`),e4[i]=`[${t++}]`),e.clearRect(0,0,r.width,n)}}(Z.getContext2D()),function(){let e;let t=Z.getCanvas();e={element:t,actionStarted:!1,dragging:!1,x:0,y:0,lastTouchStartPoint:null,suppressClickEvent:!1},t.addEventListener("mousedown",t=>(f.debug("mousedown"),it(t5.MOUSE,t.offsetX,t.offsetY,e)),{passive:!0}),t.addEventListener("mouseup",t=>(f.debug("mouseup"),ii(t5.MOUSE,t.offsetX,t.offsetY,e)),{passive:!0}),t.addEventListener("mousemove",t=>{f.debug("mousemove"),1&t.buttons&&ir(t5.MOUSE,t.offsetX,t.offsetY,e)},{passive:!0}),t.addEventListener("touchstart",t=>{if(f.debug("touchstart"),1===t.changedTouches.length){let i=ie(t);e.lastTouchStartPoint=new C(i.x,i.y),it(t5.TOUCH,i.x,i.y,e)}},{passive:!0}),t.addEventListener("touchend",t=>{f.debug("touchend"),1===t.changedTouches.length&&ii(t5.TOUCH,e.lastTouchStartPoint?.x,e.lastTouchStartPoint?.y,e),e.lastTouchStartPoint=null,e.suppressClickEvent=!1},{passive:!0}),t.addEventListener("touchmove",t=>{if(f.debug("touchmove"),1===t.changedTouches.length){let i=ie(t);ir(t5.TOUCH,i.x,i.y,e),e.suppressClickEvent=!0}},{passive:!0}),t.addEventListener("touchcancel",t=>{var i,r;f.debug("touchcancel"),t5.TOUCH,i=e.lastTouchStartPoint?.x,r=e.lastTouchStartPoint?.y,e.actionStarted=!1,e.dragging=!1,e.distance=0,e.lastX=i,e.lastY=r,e.startX=i,e.startY=r,t9(e.element,t3,{x:i,y:r}),e.lastTouchStartPoint=null},{passive:!0}),t.addEventListener("click",i=>{f.debug("click"),e.suppressClickEvent||t9(t,t6,{x:i.offsetX,y:i.offsetY}),e.suppressClickEvent=!1}),t.addEventListener(t6,e=>{let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);eQ.resolveClick(r)||et.resolveClick(r)}),t.addEventListener(t8,e=>{let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);eQ.resolvePointerDown(r)}),t.addEventListener(t2,e=>{let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);eQ.resolvePointerUp(r)}),t.addEventListener(t3,e=>{let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);eQ.resolvePointerCancel(r)}),t.addEventListener(t7,e=>{tf.panCameraBy(-e.detail.dx,-e.detail.dy)}),t.addEventListener("contextmenu",e=>{f.debug("Context menu");let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);eQ.resolveContextMenu(r)||et.resolveContextMenu(r),e.preventDefault()})}(),eD.showOkDialog("Welcome to the Scripted Dungeon","Let's start","door").then(()=>eo.loadSpriteMap(m(is),m(io))).then(()=>{var e;return e=e1.DUNGEON_SCRIPT,fetch(e).then(e=>e.text()).then(e=>e).catch(t=>(f.error(`Error fetching ${e}: ${t}`),null))}).then(e=>tf.setSceneDefinitions(function(e){c=e.split(/\r?\n/),d=[];let t=new tV,i=tj.findFirstSection(c);if(!i)throw Error("Invalid script. No section identifiers found.");let r=t1(i.nextSectionId,i.nextLineIndex,t);for(;r;){let e=r.parse();e?.nextSectionId&&e.nextSectionId!==tq.LEVEL||(d.push(t),t=new tV),r=e?t1(e.nextSectionId,e.nextLineIndex,t):null}return d}(e))).then(()=>{}).then(()=>tA.triggerEvent(tA.EventId.MAIN_MENU)).then(()=>void window.requestAnimationFrame(ia)).catch(e=>{f.error(e),alert(`Fatal error in main game. ${e.message}`)})}};window.addEventListener("load",()=>{try{ih.initialise({width:800,height:600,maxScale:2.4,minScale:1,sizingMethod:"COVER",alpha:!1})}catch(e){f.fatal(e)}});
//# sourceMappingURL=index.4c55e548.js.map
