let e,t,i,r,n,o,s,a,h,l,c,d,u;function m(e){return e&&e.__esModule?e.default:e}/**
 * @license {@link https://opensource.org/license/mit/|MIT}
 *
 * Copyright 2024 Steve Butler
 */let p=[];window.addEventListener("error",e=>{alert(`ERROR: ${e.filename}; line ${e.lineno}
${e.message}
:Stack:
${e.error.stack}`)});var f={log:function(...e){console.log(...e)},info:function(...e){console.debug(...e)},debug:function(...e){console.debug(...e)},error:function(...e){console.error(...e),p=p.concat(e)},fatal:function(e){let t;console.error(e),t=e.message?`${e.message}
Stack:
${e.stack}`:e,alert(`Fatal error: ${t}
Previous errors:
${p.join("\n")}`),p.push(t)}};const g="'UnifrakturCook', cursive",w={normal:{size:15,fontName:"'UnifrakturCook', cursive"},h1:{size:30,fontName:g},h2:{size:22,fontName:g},h3:{size:18,fontName:g},emojiSprite:{size:18,fontName:"'UnifrakturCook', cursive"}};function y(e){let t=w[e]??w.normal;return`${t.size}px ${t.fontName}`}const x={DEG_22_5:1/8*Math.PI,DEG_45:2/8*Math.PI,DEG_67_5:3/8*Math.PI,DEG_112_5:5/8*Math.PI,DEG_135:6/8*Math.PI,DEG_157_7:7/8*Math.PI};function S(e,t,i){return e<t?t:e>i?i:e}const T={NONE:-1,N:0,NE:1,E:2,SE:3,S:4,SW:5,W:6,NW:7};function E(e,t){let i=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-i+1)+i)}function v(e,t){let i=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-i+1)+i)}class C{x;y;constructor(e,t){this.x=e,this.y=t}static copy(e){return new C(e.x,e.y)}coincident(e){return this.x===e.x&&this.y===e.y}getCartesianAngleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}getScreenAngleTo(e){return Math.atan2(this.y-e.y,e.x-this.x)}toString(){return`(${this.x},${this.y})`}isCoincident(e){return Math.round(this.x)===Math.round(e.x)&&Math.round(this.y)===Math.round(e.y)}isOtherClose(e,t){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)<=Math.pow(t,2)}}class P{x;y;rotation;constructor(e,t,i){this.x=e,this.y=t,this.rotation=i}getCartesianDirection(){return Math.atan2(this.y,this.x)}getScreenDirection(){return Math.atan2(-this.y,this.x)}isZero(e){return Math.abs(this.x)<e&&Math.abs(this.y)<e}}class z extends C{rotation;constructor(e,t,i){super(e,t),this.y=t,this.rotation=i}static fromPoint(e){return new z(e.x,e.y,0)}static copy(e){return new z(e.x,e.y,e.rotation)}getRelativeTo(e){return new z(this.x-e.x,this.y-e.y,this.rotation-e.rotation)}withinSquare(e,t){return Math.abs(e.x-this.x)<t&&Math.abs(e.y-this.y)<t}}class b{x;y;width;height;constructor(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}getBottomRight(){return new C(this.x+this.width,this.y+this.height)}getTopLeft(){return new C(this.x,this.y)}overlaps(e){let t=this.getBottomRight(),i=e.getBottomRight();return!(e.x>t.x||e.y>t.y||i.x<this.x||i.y<this.y)}containsPoint(e){return e.x>=this.x&&e.x<=this.x+this.width&&e.y>=this.y&&e.y<=this.y+this.height}containsCoordinate(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}}new C(Number.MIN_VALUE,Number.MIN_VALUE),new C(Number.MAX_VALUE,Number.MAX_VALUE);let M=null,O=null,I=null,R=0,k=0,B=!0,L=null,A=null,N=0,_=0,D=1,G=1,W=.1,F="COVER",H=new z(0,0,0);function U(){let e,t,i,r;let n={width:window.innerWidth,height:window.innerHeight},o=I.width/I.height,s=0,a=0,h=n.width/n.height;("COVER"===F?o>h:o<h)?a=(s=n.height)*o:s=(a=n.width)/o,(D=a/I.width)>G?(a=(D=G)*I.width,s=D*I.height):D<W&&(a=(D=W)*I.width,s=D*I.height),N=(n.width-a)/2,_=(n.height-s)/2,O.style.left=`${N}px`,O.style.top=`${_}px`,O.style.width=`${a}px`,O.style.height=`${s}px`,N<0?(i=-N/D,e=n.width/D):(i=0,e=I.width),_<0?(r=-_/D,t=n.height/D):(r=0,t=I.height),L=new b(i,r,e,t),f.debug(`Scale: ${D}`),f.debug(`Window: width: ${n.width}, height: ${n.height}`),f.debug(`Display: left: ${N}, top: ${_}, width: ${a}, height: ${s}`),f.debug(`Visible canvas: left: ${i}, top: ${r}, width: ${e}, height: ${t}`)}function $(){let e=w.normal.size*D;document.documentElement.style.fontSize=`${e}px`}function V(){U(),$()}function X(){return O.getContext("2d",{alpha:B})}function K(e){return e.style.opacity=0,new Promise(t=>{window.setTimeout(()=>{e.remove(),t()},500)})}function Y(e){return new z(e.x+H.x,e.y+H.y,e.rotation)}window.addEventListener("resize",()=>{null===M&&(M=window.setTimeout(()=>{V(),M=null},200))});var Z={canvasPositionToWorld:Y,centreCanvasOn:function(e){H.x=e.x-R,H.y=e.y-k},clearCanvas:function(){X().clearRect(0,0,I.width,I.height)},displayOnGlass:function(e,t,i){let r;let n=document.createElement("div");document.body.appendChild(n),n.className="glass";let o=document.createElement("div");n.appendChild(o),o.className="glass-content",o.appendChild(e),i&&n.classList.add(i),n.style.display="block",n.style.opacity=1;let s=[];if(t&&t.length>0)t.forEach(e=>{let t=new Promise(t=>{e.element.addEventListener("click",async()=>{t(e.response)})});s.push(t)});else{let e=new Promise(e=>o.addEventListener("click",()=>e()));s.push(e)}return Promise.race(s).then(e=>(r=e,K(n))).then(()=>r)},getCanvas:()=>O,getContext2D:X,getCanvasDimensions:function(){return{width:I.width,height:I.height}},getWorldInCanvasBounds:function(){return new b(H.x,H.y,I.width,I.height)},getVisibleCanvasRect:function(){return L},glassPositionToWorld:function(e){let t=e.x<0?L.x+L.width:L.x,i=e.y<0?L.y+L.height:L.y;return Y(new z(t+e.x,i+e.y,e.rotation))},isOnCanvas:function(e){return e.overlaps(I)},isOnScreen:function(e){return e.overlaps(I)},panCamera:function(e,t){H.x+=e,H.y+=t},resize:V,setOpacity:function(e){X().globalAlpha=e},setOptions:function(e){var t;if(O){f.error("Multiple calls to setScreen ignored.");return}A=document.getElementById("game-content"),t=e.width,w.normal.size=15+t/100*.390625,w.h1.size=2*w.normal.size,w.h2.size=1.5*w.normal.size,w.h3.size=1.2*w.normal.size,w.emojiSprite.size=t/10,(O=document.createElement("canvas")).id="game-canvas",O.setAttribute("width",e.width),O.setAttribute("height",e.height),O.innerText="Loading the app.",I=new b(0,0,e.width,e.height),R=e.width/2,k=e.height/2,A.appendChild(O),G=e.maxScale,W=e.minScale,F=e.sizingMethod,B=e.alpha,U(),$()},wipeGlass:K,worldPositionToCanvas:function(e){return new z(e.x-H.x,e.y-H.y,e.rotation)},worldToUi:function(e){return e*D},uiCoordsToMappedPositions:function(e,t){return{canvas:new z(Math.round(e/=D),Math.round(t/=D)),world:new z(Math.round(e+H.x),Math.round(t+H.y),-H.rotation)}},uiToWorld:function(e){return e/D}};const q=new Map,j=new Map;function J(t){let i=e.worldPointToGrid(t.position);e.deleteOccupancyOfGridPoint(t,i),q.delete(t)}function Q(e){f.debug("Remove passive sprite."),j.delete(e)}function ee(){e=null}var et={addActor:function(t){q.set(t,t),e.moveTileOccupancyGridPoint(t,null,e.worldPointToGrid(t.position))},addPassiveSprite:function(e){j.set(e,e)},clearAll:function(){q.forEach(e=>J(e)),j.forEach(e=>Q(e)),ee()},getActors:function(){return q},getTileMap:function(){return e},getWorldDims:function(){return e?e.getDimensions():Z.getCanvasDimensions()},removeTileMap:ee,resolveCancel:function(e){return!1},resolveClick:function(t){let i=e?.getTileAtWorldPoint(t.world);return!!i&&(i.actionClick(t.world),!0)},resolveContextMenu:function(t){let i=e.getTileAtWorldPoint(t.world);return!!i&&(i.actionContextClick(t.world),!0)},removeActor:J,removePassiveSprite:Q,setTileMap:function(t){e=t},update:function(t){e?.update(t),q.forEach(i=>{let r=e.worldPointToGrid(i.position);i.visible=e.canHeroSeeGridPoint(r),i.update(t);let n=e.worldPointToGrid(i.position);e.moveTileOccupancyGridPoint(i,r,n)}),j.forEach(e=>e.update(t))}};function ei(e,t,i,r){if(e.font=y(r?.styleName),e.fillStyle=r?.color??"white",r?.wrapAtX){var n=t.split("\n");for(let t=0;t<n.length;t++)r.y=function(e,t,i,r){let n;let o=t.split(" "),s=i.x??0,a=i.y??0,h=r.xWrapPosition-s,l=r.lineSpacing??1,c="";for(let t=0;t<o.length;t++){let i=c+o[t]+" ",r=function(e,t){let i=e.measureText(void 0);return{width:i.width,height:i.fontBoundingBoxAscent+i.fontBoundingBoxDescent,offsetTop:-i.fontBoundingBoxAscent,offsetCentreY:.5*(i.fontBoundingBoxDescent-i.fontBoundingBoxAscent)}}(e);n||(n=l*r.height),r.width>h&&t>0?(e.fillText(c,s,a),c=o[t]+" ",a+=n):c=i}return e.fillText(c,s,a),a+n}(e,n[t],i,r)}else e.fillText(t,i.x??0,i.y??0)}const er={spriteBoxes:!1,showFps:!0};let en=[];function eo(e){return new Promise(t=>{let i=new Image;i.addEventListener("load",()=>{f.debug("Image loaded."),t(i)}),i.src=e})}var es={getSpriteBitmap:function(e,t){let i=en[e].get(t);return i||f.debug(`Failed to find image ${t} at index ${e}`),i},loadImage:eo,loadImages:function(e){let t=[];return e.forEach(e=>t.push(eo(e))),Promise.all(t)},loadSpriteMap:function(e,t){return eo(t).then(t=>(function(e,t){let i=[],r=new Map;return en.push(r),e.frames.forEach(e=>{i.push(createImageBitmap(t,e.frame.x,e.frame.y,e.frame.w,e.frame.h).then(t=>{let i={image:t,width:e.frame.w,height:e.frame.h,centreX:e.sourceSize.w/2-e.spriteSourceSize.x,centreY:e.sourceSize.h/2-e.spriteSourceSize.y};return r.set(e.filename,i),e.filename}))}),Promise.all(i)})(e,t))}};let ea=0;var eh={updateTimeNow:function(e){ea=e},getFrameCount:function(e){return Math.floor(ea/e)}};const el={WRAP:0,REVERSE:1,STOP:2};class ec{#e;#t;#i;#r;#n;constructor(e,t){this.#e=e,this.#t=e-1,this.#i=t,this.#r=1,this.#n=0}get index(){return this.#n}set index(e){this.#n=S(e,0,this.#e-1)}advanceBy(e){if(this.#e<1)return this.#n;switch(this.#i){case el.WRAP:return this.#o(e);case el.REVERSE:return this.#s(e);case el.NONE:default:return this.#a(e)}}#o(e){return e%=this.#e,this.#n+=e%this.#e,this.#n>=this.#e&&(this.#n=this.#n-this.#e),this.#n}#s(e){if(Math.floor(e/this.#e)%2&&(this.#r=-this.#r),e%=this.#e,this.#r>0){this.#n+=e;let t=this.#n-this.#t;t>0&&(this.#n=this.#t-t,this.#r=-1)}else this.#r<0&&(this.#n-=e,this.#n<0&&(this.#n=-this.#n,this.#r=1));return this.#n}#a(e){return this.#r>0?this.#n=Math.min(this.#t,this.#n+e):this.#r<0&&(this.#n=Math.max(0,this.#n-e)),this.#n}}class ed{playing;#h;#l;#c;#d;constructor(e,t,i){let r;if(this.#h=[],this.#c=0,"string"==typeof t){this.#h.push(es.getSpriteBitmap(e,t));return}this.#d=Math.max(1,i.framePeriodMs);let n=t.startIndex??0,o=t.padding??0;do{let i=`${t.prefix}${n.toString().padStart(o,"0")}${t.suffix}`;(r=es.getSpriteBitmap(e,i))&&this.#h.push(r),n++}while(r)this.#l=new ec(this.#h.length,i.loopMethod),this.playing=!0}getCurrentFrame(){if(!(this.#h.length>1))return this.#h[0];if(this.playing){let e=eh.getFrameCount(this.#d);e!==this.#c&&(this.#l.advanceBy(e-this.#c),this.#c=e)}return this.#h[this.#l.index]}setCurrentIndex(e){this.#h.length>1&&(this.playing=!1,this.#l.index=e)}getCurrentIndex(){return this.#h.length>1?this.#l.index:0}}class eu{#u;#m;constructor(e,t){this.#u={},this.#u[e]=t,this.#m=t}get image(){return this.#m}addAnimatedImage(e,t){this.#u[e]=t}setCurrentKey(e){this.#u.hasOwnProperty(e)?this.#m=this.#u[e]:f.error(`Attempt to set current key to nonexistent value of ${e}`)}getCurrentFrame(){return this.#m.getCurrentFrame()}}class em{_context;_boundingBoxCanvas;constructor(e){this._context=e,this._boundingBoxCanvas=new b(0,0,0,0)}getContext(){return this._context}getBoundingBoxCanvas(){return this._boundingBoxCanvas}render(e,t){if(e=Z.worldPositionToCanvas(e),!this.isOnCanvas(e))return;let i=this._context.globalAlpha;this._context.globalAlpha=i*t;let r=e.rotation;r&&(this._context.save(),this._context.translate(e.x,e.y),this._context.rotate(-e.rotation),this._context.translate(-e.x,-e.y)),this._doRender(e),r&&this._context.restore(),er.spriteBoxes&&(this._context.strokeStyle="green",this._context.strokeRect(this._boundingBoxCanvas.x,this._boundingBoxCanvas.y,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height)),this._context.globalAlpha=i}_doRender(e){f.error("_doRender method should be overridden.")}isOnScreen(e){let t=new b(e.x-this._boundingBoxCanvas.width/2,e.y-this._boundingBoxCanvas.height/2,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height);return Z.isOnScreen(t)}isOnCanvas(e){let t=new b(e.x-this._boundingBoxCanvas.width/2,e.y-this._boundingBoxCanvas.height/2,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height);return Z.isOnCanvas(t)}}class ep extends em{#p;#f;#g;text;constructor(e,t,i="normal"){super(e),this.text=t,this.#p=i}#w(e){this._context.font=y(this.#p);let t=this._context.measureText(e);this.#g={width:t.width,height:t.fontBoundingBoxAscent+t.fontBoundingBoxDescent,origin:{x:-.5*t.width,y:.5*(t.fontBoundingBoxAscent-t.fontBoundingBoxDescent)}},this.#f=e}_doRender(e){var t;this.text!==this.#f&&this.#w(this.text);let i={x:e.x+this.#g.origin.x,y:e.y+this.#g.origin.y,rotation:e.rotation};ei(this._context,this.#f,i,{styleName:this.#p}),this._boundingBoxCanvas=(t=this.#g,new b(e.x-t.width/2,e.y-t.height/2,t.width,t.height))}}class ef extends em{#y;#x;#S;#T;#E;#v;constructor(e,t){super(e),this.#y=t.width??10,this.#x=t.height??10,this.#S=this.#y/2,this.#T=this.#x/2,this.#E=t.fillStyle,this.#v=t.strokeStyle}_doRender(e){let t=e.x-this.#S,i=e.y-this.#T;this.#E&&(this._context.fillStyle=this.#E,this._context.fillRect(t,i,this.#y,this.#x)),this.#v&&(this._context.strokeStyle=this.#v,this._context.strokeRect(t,i,this.#y,this.#x)),this._boundingBoxCanvas=new b(t,i,this.#y,this.#x)}}class eg extends em{#x;#T;#y;#S;#E;#v;#C;#P;#z;#b;constructor(e,t){super(e),this.#x=t.height,this.#T=this.#x/2,this.#y=t.width,this.#S=this.#y/2,this.#E=t.fillStyle,this.#v=t.strokeStyle,this.#C=t.offsetX??0,this.#P=t.offsetY??0,this.setLevel(0)}setLevel(e){this.#z=Math.min(e,1)*this.#x,this.#b=.5*this.#z}_doRender(e){let t=e.y-this.#T+this.#P,i=e.y+this.#T-this.#z+this.#P,r=e.x-this.#S+this.#C;this.#E&&(this._context.fillStyle=this.#E,this._context.fillRect(r,i,this.#y,this.#z)),this.#v&&(this._context.strokeStyle=this.#v,this._context.strokeRect(r,t,this.#y,this.#x)),this._boundingBoxCanvas=new b(r,t,this.#y,this.#x)}}class ew extends em{#M;constructor(e,t){super(e);let i=Math.max(t.fillStyles.length??0,t.strokeStyles.length??0);if(0===i){f.error("Attempt to create MultiGaugeTileRenderer with no gauges.");return}this.#M=[];let r=t.tileSize/i,n=-t.tileSize/2+r/2;for(let o=0;o<i;o++)this.#M.push(new eg(e,{width:r,height:t.tileSize,fillStyle:t.fillStyles?.[o],strokeStyle:t.strokeStyles?.[o],offsetX:n+r*o,offsetY:0}))}setLevel(e,t){this.#M[e]?.setLevel(t)}render(e){this.#M?.forEach(t=>t.render(e))}}class ey extends em{#O;#I;constructor(e,t){super(e),t?.getCurrentFrame?(this.#I=t,this.#O=this.#I.getCurrentFrame()):this.#O=t,this.#O?(this._boundingBoxCanvas.width=this.#O?.width??0,this._boundingBoxCanvas.height=this.#O?.height??0):f.error("No image frame available for sprite.",t)}_doRender(e){if(!this.#O)return;let t=this.#I?this.#I.getCurrentFrame():this.#O;this._boundingBoxCanvas.x=e.x-this._boundingBoxCanvas.width/2,this._boundingBoxCanvas.y=e.y-this._boundingBoxCanvas.height/2,this._context.drawImage(t.image,e.x-t.centreX,e.y-t.centreY)}}class ex{#R=new z(0,0,0);#k=new P(0,0,0);#B;#L;modifier;visible;opacity;constructor(e){this.#B=e?.renderer,this.#L=Array.isArray(this.#B),this.visible=!0,this.opacity=1}get position(){return this.#R}set position(e){this.#R.x=this.valueOrZero(e.x),this.#R.y=this.valueOrZero(e.y),this.#R.rotation=this.valueOrZero(e.rotation)}get velocity(){return this.#k}set velocity(e){this.#k.x=this.valueOrZero(e.x),this.#k.y=this.valueOrZero(e.y),this.#k.rotation=this.valueOrZero(e.rotation)}valueOrZero(e){return"number"==typeof e?e:0}update(e){this.modifier&&(this.modifier=this.modifier.update(this,e)),this.visible&&this.#A()}#A(){this.#B&&(this.#B.forEach?this.#B.forEach(e=>e.render(this.#R,this.opacity)):this.#B.render(this.#R,this.opacity))}getBoundingBox(){let e=this.#B.getBoundingBoxCanvas();return new b(this.position.x-e.width/2,this.position.y-e.height/2,e.width,e.height)}}class eS{decoratedModifier;#N;#_;#D;constructor(e){this.#_=0,this.#D=0,this.decoratedModifier=e}applyAsTransientToSprite(e,t=10){return this.#D=t,new Promise(t=>{this.#N=t,e.modifier=this})}applyAsContinuousToSprite(e){e.modifier=this}update(e,t){this.#N&&(this.#_+=t),this.decoratedModifier&&(this.decoratedModifier=this.decoratedModifier?.update(e,t));let i=this.doUpdate(e,t);return!i||this.#_>this.#D?(this.#N?.(null),null):i}doUpdate(e,t){return f.error("doUpdate should be overridden."),this}}class eT extends eS{#G;constructor(e,t){super(t),this.#G=1/Math.max(e,.5)}doUpdate(e,t){return e.opacity=Math.max(0,e.opacity-t*this.#G),e.opacity>0?this:null}}class eE{#W;#F;constructor(e,t){this.#W=e,this.#F=t}getSpeedBetweenPoints(e,t){return this.#F?this.#W:(1+.1*(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)))*this.#W}}class ev extends eS{#H;#U;constructor(e){super(e)}doUpdate(e,t){let i=e.position,r=e.velocity;return i.x+=r.x*t,i.y+=r.y*t,e.position=i,e.velocity=r,this}}class eC extends eS{#$;#V;#X;constructor(e,t){super(t),this.#$=e.prey,this.#V=e.maxSeparation,this.#X=new eE(e.speed,e.linear)}doUpdate(e,t){let i=this.#$.position,r=e.position,n=this.#X.getSpeedBetweenPoints(i,r);if(!r.withinSquare(i,this.#V)){let o=r.getCartesianAngleTo(i);e.velocity.x=n*Math.cos(o),e.velocity.y=n*Math.sin(o);let s=e.velocity.x*t,a=e.velocity.y*t;e.position.x+=this.getMinMove(s,i.x,r.x),e.position.y+=this.getMinMove(a,i.y,r.y)}return this}getMinMove(e,t,i){let r=t-i;return 0>Math.sign(e)?Math.max(e,r):Math.min(e,r)}}class eP extends eS{#K;#n;#Y;#X;constructor(e,t){super(t),this.#K=e.path,this.#n=0,this.#Y=e.path[0],this.#X=new eE(e.speed,e.linear)}doUpdate(e,t){let i=e.position,r=this.#X.getSpeedBetweenPoints(this.#Y,i),n=i.getCartesianAngleTo(this.#Y);e.velocity.x=r*Math.cos(n),e.velocity.y=r*Math.sin(n);let o=e.velocity.x*t,s=e.velocity.y*t;if(i.x+=this.getMinMove(o,this.#Y.x,i.x),i.y+=this.getMinMove(s,this.#Y.y,i.y),i.isCoincident(this.#Y)){if(++this.#n>=this.#K.length)return e.velocity.x=0,e.velocity.y=0,this.decoratedModifier;this.#Y=this.#K[this.#n]}return this}getMinMove(e,t,i){let r=t-i;return 0>Math.sign(e)?Math.max(e,r):Math.min(e,r)}}function ez(e,t){let i=new ex({renderer:e});i.position=t.position,i.velocity=t.velocity,et.addPassiveSprite(i),new eT(t.lifetimeSecs,new ev).applyAsTransientToSprite(i,20).then(()=>et.removePassiveSprite(i))}function eb(e,t){ez(new ep(Z.getContext2D(),e),t)}function eM(e=6){return v(1,e)}var eO={TILE_SIZE:48};const eI=new class{#Z;constructor(){this.#Z=new Map}set(e,t){this.#Z.set(e,t);try{localStorage.setItem(e,JSON.stringify(t))}catch(e){f.error(`Cannot save setting. ${e.message}`)}}get(e,t){if(this.#Z.has(e))return this.#Z.get(e);let i=t;try{let t=localStorage.getItem(e);null!==t&&(i=JSON.parse(t))}catch(e){f.error(`Cannot parse value from local storage. ${e.message}`)}return this.#Z.set(e,i),i}};class eR{element;id;constructor(e){this.element=document.createElement("button"),this.element.appendChild(document.createTextNode(e.label))}}class ek{#q;#j;#J;#Q;#ee;action;id;constructor(e){if(!e.imageNameDown&&!e.action)throw Error("Attempt to create a button with no down image and no action. One or other must be supplied.");this.id=e.id;let t=document.createElement("button");if(e.imageNameUp){this.#q=es.getSpriteBitmap(0,e.imageNameUp),this.#j=e.imageNameDown?es.getSpriteBitmap(0,e.imageNameDown):this.#q;let i=document.createElement("canvas");i.setAttribute("width",eO.TILE_SIZE),i.setAttribute("height",eO.TILE_SIZE),this.#Q=i.getContext("2d"),t.appendChild(i)}e.internalLabel||!this.#Q?(this.#J=t,t.classList.add("icon-button-internal"),this.#J.appendChild(document.createElement("span")).appendChild(document.createTextNode(e.label))):(t.classList.add("icon-button-external"),this.#J=document.createElement("label"),this.#J.appendChild(document.createTextNode(e.label)),this.#J.appendChild(t)),this.#J.addEventListener("mousedown",()=>this.#et()),this.#J.addEventListener("touchstart",()=>this.#et(),{passive:!0}),this.#J.addEventListener("mouseup",async()=>this.#ei()),this.#J.addEventListener("touchend",async()=>this.#ei()),this.#J.addEventListener("touchcancel",()=>this.#er()),this.selected=!1,this.action=e.action}get element(){return this.#J}get selected(){return this.#ee}set selected(e){this.#ee=e,this.#en()}#et(){this.#eo(this.#j)}#ei(){this.#ee=!this.#ee,this.#en()}#er(){this.#en()}#en(){this.#eo(this.#ee?this.#j:this.#q)}#eo(e){this.#Q.clearRect(0,0,eO.TILE_SIZE,eO.TILE_SIZE),this.#Q.drawImage(e.image,.5*(eO.TILE_SIZE-e.width),.5*(eO.TILE_SIZE-e.height))}}class eB extends ek{constructor(e){super({label:e,imageNameUp:"ui-checkbox00.png",imageNameDown:"ui-checkbox01.png",internalLabel:!1,action:null})}}const eL={TEXT_BUTTON:"text button",CHECKBOX:"checkbox"};function eA(e){let t=document.createElement("div");return t.innerText=e,t.classList.add(["scrollable"]),t}var eN={showMessage:function(e){let t=document.createElement("div");t.appendChild(document.createTextNode(e)),t.className="popup",t.style.opacity=1,document.body.appendChild(t),t.addEventListener("click",()=>t.remove())},showOkDialog:function(e,t="OK",i){let r=document.createElement("div");r.appendChild(eA(e));let n=document.createElement("button");return n.appendChild(document.createTextNode(t)),r.appendChild(n),Z.displayOnGlass(r,[{element:n,response:0,closer:!0}],i)},showControlsDialog:function(e,t,i){let r=document.createElement("div");r.appendChild(eA(e));let n=[];if(t?.forEach(e=>{r.appendChild(e.element),e.action?e.element.addEventListener("click",()=>e.action()):n.push({element:e.element,response:e.id})}),0===n.length){let e=new eR({label:"OK"});r.appendChild(e.element),n.push(e)}return Z.displayOnGlass(r,n,i)}};class e_{actor;constructor(e){this.actor=e}enact(e){return Promise.resolve()}react(e){return Promise.resolve()}allowEscape(e){return!0}}class eD extends e_{constructor(e){super(e)}enact(e){return this.#es(this.actor,e)}react(e){return this.#es(e,this.actor)}allowEscape(e){return this.actor,eM(20)>10||(eb("Failed to run.",{lifetimeSecs:2,position:e.position,velocity:new P(0,-100,0)}),!1)}#ea(e,t){let i=C.copy(e.position);return new eP({path:[new C(e.position.x+.2*(t.position.x-e.position.x),e.position.y+.2*(t.position.y-e.position.y)),i],speed:100}).applyAsTransientToSprite(e.sprite)}#eh(e,t){return new Promise(e=>{var i,r;if(eM(20)>10)i=es.getSpriteBitmap(0,eI.get("BLOOD_ON")?"blood-splat.png":"pow.png"),r={lifetimeSecs:1,position:t.position,velocity:new P(0,0,0)},ez(new ey(Z.getContext2D(),i),r);else{eb("Missed",{lifetimeSecs:2,position:t.position,velocity:new P(0,-100,0)}),e();return}let n=t.traits.get("HP"),o=eM(6);n=Math.max(0,n-o),t.traits.set("HP",n),0===n?(f.info("Killed actor."),t.interaction=new eG,t.alive=!1):eb(`-${o} HP`,{lifetimeSecs:2,position:t.position,velocity:new P(0,-200,0)}),e(n)})}#es(e,t){return this.#ea(e,t).then(()=>this.#eh(e,t))}}class eG extends e_{constructor(e){super(e)}react(e){return eN.showOkDialog("A bit macabre, but you're trying to search a corpse. I haven't written the code yet.")}}class eW extends e_{constructor(e){super(e)}react(e){return eN.showOkDialog("Time to trade. I haven't written the code yet.")}}class eF{#el;#ec;#ed;#eu;setOnClick(e){this.#el=e}setOnContextClick(e){this.#ec=e}setOnPointerDown(e){this.#ed=e}setOnPointerUp(e){this.#eu=e}actionClick(e){this.#el?.(this,e)}actionContextClick(e){this.#ec?.(this,e)}actionPointerDown(e){this.#ed?.(this,e)}actionPointerUp(e){this.#eu?.(this,e)}}class eH extends eF{maxTilesPerMove;sprite;traits;interaction;alive;constructor(e){super(),this.interaction=new e_,this.sprite=e,this.sprite.obstacle=!0,this.maxTilesPerMove=4,this.alive=!0}set visible(e){this.sprite.visible=e}get visible(){return this.sprite.visible}get obstacle(){return this.sprite.obstacle}set obstacle(e){this.sprite.obstacle=e}get position(){return this.sprite.position}set position(e){this.sprite.position=e}get velocity(){return this.sprite.velocity}set velocity(e){this.sprite.velocity=e}isWandering(){return this?.traits.get("MOVE")==="wander"}isPassableByActor(e){return!this.alive||!this.obstacle}canShareLocationWithActor(e){return!this.obstacle}update(e){this.sprite.update(e)}actionClick(e){super.actionClick(this.sprite.position)}actionContextClick(e){super.actionContextClick(this.sprite.position)}actionPointerUp(e){super.actionPointerUp(this.sprite.position)}actionPointerDown(e){super.actionPointerDown(this.sprite.position)}}const eU={OFF:0,HERO:1,VELOCITY:2};class e${#em;#ep;#ef;#eg;constructor(e,t,i=0){let r=Z.getCanvasDimensions(),n=i*Math.min(r.width,r.height);this.#em=new ex,this.#ep=new eC({prey:e,speed:t,maxSeparation:n}),this.#ef=new ev,this.#ep.applyAsContinuousToSprite(this.#em)}update(e){this.#eg!==eU.OFF&&(this.#em.update(e),Z.centreCanvasOn(this.#em.position))}setVelocity(e,t){this.setTrackingMethod(eU.VELOCITY),this.#em.velocity.x=e,this.#em.velocity.y=t}panBy(e,t){this.#em.position.x+=e,this.#em.position.y+=t,Z.centreCanvasOn(this.#em.position)}setTrackingMethod(e){if(e!==this.#eg)switch(this.#eg=e,e){case eU.HERO:this.#ep.applyAsContinuousToSprite(this.#em);break;case eU.VELOCITY:this.#ef.applyAsContinuousToSprite(this.#em);break;case eU.OFF:break;default:f.error(`Attempt to set invalid tracking method of ${e} ignored.`)}}}const eV={TR:0,BR:1,BL:2,TL:3};class eX{#ew;#ey;#ex;constructor(e,t,i){this.#ew=e,this.#eS(t,i)}#eS(e,t){let i,r;switch(t){case eV.TL:i=2*e,r=2*e;break;case eV.TR:i=-2*e,r=2*e;break;case eV.BR:i=-2*e,r=-2*e;break;case eV.BL:i=2*e,r=-2*e}this.#eT(i,r),this.#eE(i,r,e)}#eT(e,t){this.#ex=new ed(0,{prefix:"hud-auto-centre",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:el.STOP}),this.#ey=ej.addButton(this.#ex,()=>{this.setTrackingState(!0)},()=>{this.setTrackingState(!1)}),this.#ey.position.x=e,this.#ey.position.y=t,this.#ey.actionClick(null)}setTrackingState(e){e?(this.#ex.setCurrentIndex(1),this.#ew.setTrackingMethod(eU.HERO)):(this.#ex.setCurrentIndex(0),this.#ew.setTrackingMethod(eU.OFF))}#eE(e,t,i){let r=3*i;this.#ev("hud-arrow-up",e,t-i,()=>{this.setTrackingState(!1),this.#ew.setVelocity(0,-r)},()=>this.#ew.setTrackingMethod(eU.OFF)),this.#ev("hud-arrow-right",e+i,t,()=>{this.setTrackingState(!1),this.#ew.setVelocity(r,0)},()=>this.#ew.setTrackingMethod(eU.OFF)),this.#ev("hud-arrow-down",e,t+i,()=>{this.setTrackingState(!1),this.#ew.setVelocity(0,r)},()=>this.#ew.setTrackingMethod(eU.OFF)),this.#ev("hud-arrow-left",e-i,t,()=>{this.setTrackingState(!1),this.#ew.setVelocity(-r,0)},()=>this.#ew.setTrackingMethod(eU.OFF))}#ev(e,t,i,r,n){let o=new ed(0,{prefix:e,startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:el.STOP}),s=ej.addMomentaryButton(o,r,n);s.position.x=t,s.position.y=i,o.setCurrentIndex(0)}}const eK=new Map;let eY=!1;function eZ(e,t){let i=Z.glassPositionToWorld(t.position),r=t.sprite.getBoundingBox();return new b(i.x-r.width/2,i.y-r.height/2,r.width,r.height).containsCoordinate(e.world.x,e.world.y)}function eq(e){if(!eY||!eY)return!1;for(let[t,i]of eK)if(eZ(e,i))return i.actionPointerUp(i,e.canvas),!0;return!1}var ej={addButton:function(e,t,i){let r=new eH(new ex({renderer:new ey(Z.getContext2D(),e)}));return eK.set(r,r),r.setOnClick(()=>{i?0===e.getCurrentIndex()?(e.setCurrentIndex(1),t()):(e.setCurrentIndex(0),i()):t()}),e.setCurrentIndex(0),r},addMomentaryButton:function(e,t,i){let r=new eH(new ex({renderer:new ey(Z.getContext2D(),e)}));return eK.set(r,r),r.setOnPointerDown(()=>{e.setCurrentIndex(1),t?.()}),r.setOnPointerUp(()=>{e.setCurrentIndex(0),i?.()}),r},clear:function(){eK.clear()},removeButton:function(e){eK.delete(e)},update:function(e){eY&&eK.forEach(t=>{let i=z.copy(t.position);t.position=Z.glassPositionToWorld(t.position),t.update(e),t.position=i})},resolvePointerCancel:function(e){return eq(e)},resolveClick:function(e){if(!eY)return!1;for(let[t,i]of eK)if(eZ(e,i))return i.actionClick(i,e.canvas),!0;return!1},resolveContextMenu:function(e){return!1},resolvePointerDown:function(e){if(!eY||!eY)return!1;for(let[t,i]of eK)if(eZ(e,i))return i.actionPointerDown(i,e.canvas),!0;return!1},resolvePointerUp:eq,setVisible:function(e){eY=e}};const eJ={GRINNING:"\uD83D\uDE00",SANTA:"\uD83C\uDF85",SHAKING:"\uD83E\uDEE8"};var eQ={};eQ=new URL("dungeon_script.e102251e.txt",import.meta.url).toString();const e4={DUNGEON_SCRIPT:new URL(eQ)},e0={DEAD:{keyName:"DEAD",suffix:"dead",options:{framePeriodMs:100,loopMethod:el.STOP}},IDLE:{keyName:"IDLE",suffix:"idle",options:{framePeriodMs:300,loopMethod:el.REVERSE}},WALK_NORTH:{keyName:"WALK_N",suffix:"walk-n",options:{framePeriodMs:100,loopMethod:el.REVERSE}},WALK_EAST:{keyName:"WALK_E",suffix:"walk-e",options:{framePeriodMs:100,loopMethod:el.REVERSE}},WALK_SOUTH:{keyName:"WALK_S",suffix:"walk-s",options:{framePeriodMs:100,loopMethod:el.REVERSE}},WALK_WEST:{keyName:"WALK_W",suffix:"walk-w",options:{framePeriodMs:100,loopMethod:el.REVERSE}}};var e1={definitions:e0,formFrameNameRoot:function(e,t){let i=e0[e]?.suffix;if(!i)throw Error(`Attempt made to use invalid standard animation key of '${e}'`);return`${t}-${i}`}};class e8 extends ew{actor;constructor(e,t){super(e,t)}render(e){if(this.actor&&this.actor.traits){let e=this.actor.traits.get("HP"),t=this.actor.traits.get("HP_MAX");this.setLevel(0,e/t),this.setLevel(1,1)}super.render(e)}}class e2 extends eu{#eC;#eP;#ez;constructor(e,t){super(e,t),this.#eP=T.NONE}setActor(e){this.#eC=e,this.#ez=this.#eC.alive}getCurrentFrame(){let e=this.#eb();return(e!==this.#eP||this.#ez!=this.#eC?.alive)&&(this.#eP=e,this.#ez=this.#eC?.alive,this.#eM()),super.getCurrentFrame()}#eb(){return!this.#eC||this.#eC.velocity.isZero(.1)?T.NONE:function(e){let t=Math.abs(e);return t<=x.DEG_45?T.E:t<=x.DEG_135?Math.sign(e)>0?T.N:T.S:T.W}(this.#eC.velocity.getScreenDirection())}#eM(){if(!this.#eC.alive)return this.setCurrentKey(e1.definitions.DEAD.keyName);switch(this.#eP){case T.NONE:this.setCurrentKey(e1.definitions.IDLE.keyName);break;case T.E:this.setCurrentKey(e1.definitions.WALK_EAST.keyName);break;case T.N:case T.NW:case T.NE:this.setCurrentKey(e1.definitions.WALK_NORTH.keyName);break;case T.W:this.setCurrentKey(e1.definitions.WALK_WEST.keyName);break;default:this.setCurrentKey(e1.definitions.WALK_SOUTH.keyName)}}}function e3(e){let t=function(e){let t=new e2("still",new ed(0,`${e}.png`));for(let i in e1.definitions){let r=e1.definitions[i];t.addAnimatedImage(e1.definitions[i].keyName,new ed(0,{prefix:e1.formFrameNameRoot(i,e),suffix:".png",startIndex:0,padding:2},r.options))}return t.setCurrentKey(e1.definitions.IDLE.keyName),t}(e),i=new ey(Z.getContext2D(),t),r=new e8(Z.getContext2D(),{tileSize:et.getTileMap().getGridSize()-2,fillStyles:["rgba(255, 0, 0, 0.2)","rgba(0, 0, 255, 0.2)"],strokeStyles:[]}),n=new eH(new ex({renderer:[r,i]}));return t.setActor(n),r.actor=n,n.position=new z(eO.TILE_SIZE,eO.TILE_SIZE,0),n.velocity={x:0,y:0,rotation:.1},n}const e6=new Map([["HERO",{create:()=>e3("hero")}],["MONSTER",{create:()=>(function(e){let t=e3("orc");return t.interaction=new eD(t),t})(0)}],["TRADER",{create:()=>(function(e){let t=e3(e);return t.interaction=new eW(t),t})("trader")}]]);function e7(e,t,i){return{centre:e[t]?.[i],tl:e[t-1]?.[i-1],above:e[t-1]?.[i],tr:e[t-1]?.[i+1],right:e[t]?.[i+1],br:e[t+1]?.[i+1],below:e[t+1]?.[i],bl:e[t+1]?.[i-1],left:e[t]?.[i-1]}}function e5(e){let t,i=e.length;for(;i>0;)t=Math.floor(Math.random()*i),i--,[e[i],e[t]]=[e[t],e[i]];return e}const e9={WALL:["#","*","|"],DOOR_IN:["-"],DOOR_OUT:["="],GROUND:[".",":",",",";"],VOID:[" "]},te={TOP_LEFT:"-TL",TOP_LEFT_INTERNAL:"-TLI",TOP:"-T",TOP_RIGHT:"-TR",TOP_RIGHT_INTERNAL:"-TRI",RIGHT:"-R",BOTTOM_RIGHT:"-BR",BOTTOM_RIGHT_INTERNAL:"-BRI",BOTTOM:"-B",BOTTOM_LEFT:"-BL",BOTTOM_LEFT_INTERNAL:"-BLI",LEFT:"-L",TOP_TEE:"-TTEE",RIGHT_TEE:"-RTEE",BOTTOM_TEE:"-BTEE",LEFT_TEE:"-LTEE",INTERNAL_CROSS:"-XI",INTERNAL_VERTICAL:"-VI",INTERNAL_HORIZONTAL:"-HI"},tt={BELOW_WALL:"-SBW",BELOW_END_WALL:"-SBE"};class ti{matrix;entryPointByDoor;exitPointByDoor;constructor(){this.entryPointByDoor=new C(0,0),this.exitPointByDoor=new C(0,0)}static generateTileMapPlan(e,t){let i=new ti,r=i.convertToMatrix(e);return r=i.clarifyMatrix(r),i.createPlan(r,t),i}convertToMatrix(e){let t=[],i=0;return e.forEach(e=>{i=Math.max(i,e.length)}),e.forEach(e=>{e.length<i&&(e+=" ".repeat(i-length)),t.push(e.split(""))}),t}clarifyMatrix(e){let t=[];return e.forEach((i,r)=>{let n=[];t.push(n),i.forEach((t,i)=>{var o,s,a,h;let l;let c=e7(e,r,i);(o=t,e9.VOID.includes(o))?t=" ":to(t)?(s=t,ts(c.above)&&(ts(c.tl)?s+=tt.BELOW_WALL:s+=tt.BELOW_END_WALL),a=t=s,tr(c.left)||tr(c.above)||tr(c.right)||tr(c.below))?this.entryPointByDoor=new C(i,r):(tn(c.right)||tn(c.below)||tn(c.left)||tn(c.above))&&(this.exitPointByDoor=new C(i,r)):ts(t)&&(l=h=t,ts(c.above)&&ts(c.right)&&ts(c.below)&&ts(c.left)?l+=te.INTERNAL_CROSS:to(c.left)&&to(c.right)?l+=te.INTERNAL_VERTICAL:to(c.above)&&to(c.below)?l+=te.INTERNAL_HORIZONTAL:ts(c.left)&&ts(c.right)&&ts(c.below)?l+=te.TOP_TEE:ts(c.above)&&ts(c.below)&&ts(c.left)?l+=te.RIGHT_TEE:ts(c.left)&&ts(c.right)&&ts(c.above)?l+=te.BOTTOM_TEE:ts(c.above)&&ts(c.below)&&ts(c.right)?l+=te.LEFT_TEE:ts(c.right)&&ts(c.below)?l+=to(c.br)?te.TOP_LEFT:te.TOP_LEFT_INTERNAL:ts(c.left)&&ts(c.below)?l+=to(c.bl)?te.TOP_RIGHT:te.TOP_RIGHT_INTERNAL:ts(c.left)&&ts(c.above)?l+=to(c.tl)?te.BOTTOM_RIGHT:te.BOTTOM_RIGHT_INTERNAL:ts(c.right)&&ts(c.above)?l+=to(c.tr)?te.BOTTOM_LEFT:te.BOTTOM_LEFT_INTERNAL:ts(c.above)&&ts(c.below)?l+=to(c.right)?te.LEFT:te.RIGHT:ts(c.right)&&ts(c.left)&&(l+=to(c.below)?te.TOP:te.BOTTOM),t=ts(c.above)?l+tt.BELOW_WALL:l),n.push(t)})}),t}createPlan(e,t){let i=[];e.forEach(e=>{let r=[];i.push(r),e.forEach(e=>{r.push(function e(t,i){if(" "===t)return null;let r=t.match(/(.)(-[^-]*)?(-[^-]*)?/),n=i.get(t);if(!n&&r[2]&&r[3]&&(n=i.get(`${r[1]}${r[2]}`)),!n&&r[2]&&(n=i.get(r[1])),!n){let n=function(e){for(let t in e9)if(e9[t].includes(e))return e9[t][0];return null}(r[1]);if(n&&n!==r[1]){var o,s;let t;return e((o=r[2],s=r[3],t=n,o&&(t+=o),s&&(t+=s),t),i)}f.error(`Failed to find symbol for ${t}`)}return n}(e,t))})}),this.matrix=i}}function tr(e){return e9.DOOR_IN.includes(e)}function tn(e){return e9.DOOR_OUT.includes(e)}function to(e){return e9.GROUND.includes(e)}function ts(e){var t;return e9.WALL.includes(e)||tr(t=e)||tn(t)}class ta{#eO;#eI;constructor(e){this.#eI=e,this.#eO=new Map}setRouteToCoords(e,t,i){this.#eO.set(this.coordsToKey(t,i),e)}getRouteToCoords(e,t){return this.#eO.get(this.coordsToKey(e,t))}hasRouteToCoords(e,t){return this.#eO.has(this.coordsToKey(e,t))}coordsToKey(e,t){return`${e}|${t}`}keyToGridPoint(e){let t=e.split("|");return new C(parseInt(t[0]),parseInt(t[1]))}forEach(e){this.#eO.forEach((t,i,r)=>e(t,i,r))}containsGridPoint(e){return this.#eO.has(this.coordsToKey(e.x,e.y))}getWaypointsAsGridPoints(e){let t=this.getRouteToCoords(e.x,e.y);return t.length>1?t.slice(1):null}getWaypointsAsWorldPoints(e){let t=this.getWaypointsAsGridPoints(e);return t?t.map(e=>this.#eI.gridPointToWorldPoint(e)):t}}class th{actor;#eO;#eI;#eR;constructor(e,t){this.#eI=e,this.actor=t}getDumbRouteNextTo(e,t,i){let r=this.#ek(e,t);if(r.coincident(e))return[];this.#eI.canGridPointBeOccupiedByActor(r,this.actor)||(r=this.#eB(r,t));let n=[],o=Math.sign(r.x-e.x),s=Math.sign(r.y-e.y),a=C.copy(e),h=.5>Math.random(),l=0;for(;i>0;){let t=C.copy(a),c=!1;if(h&&0!==o&&a.x!=r.x?(t.x+=o,c=!0):h||0===s||a.y==r.y||(t.y+=s,c=!0),c=c&&this.#eI.canGridPointBeOccupiedByActor(t,this.actor))l=0,a=t,i--;else{if(++l>=2)break;a.coincident(e)||n.push(this.#eI.gridPointToWorldPoint(a)),e=a,h=!h}}return a.coincident(e)||n.push(this.#eI.gridPointToWorldPoint(a)),n}getAllRoutesFrom(e,t){return this.#eO=new ta(this.#eI),this.#eR=e,this.#eL(e.x,e.y,t,null),this.#eO}#eL(e,t,i,r){if(r){if(e===this.#eR.x&&t===this.#eR.y||!this.#eA(e,t))return;let n=this.#eO.getRouteToCoords(e,t);if(n&&!(r.length<n.length-1))return;r.push(new C(e,t)),this.#eN(e,t)&&this.#eO.setRouteToCoords(r,e,t),i--}else r=[new C(e,t)];i>0&&(this.#eL(e,t-1,i,[...r]),this.#eL(e+1,t,i,[...r]),this.#eL(e,t+1,i,[...r]),this.#eL(e-1,t,i,[...r]))}#eA(e,t){return this.#eI.isGridPointPassableByActor(new C(e,t),this.actor)}#eN(e,t){return this.#eI.canGridPointBeOccupiedByActor(new C(e,t),this.actor)}#ek(e,t){let i=t.x-e.x,r=t.y-e.y,n=t.x,o=t.y;return Math.abs(i)>Math.abs(r)?n-=Math.sign(i):o-=Math.sign(r),new C(n,o)}#eB(e,t){return e.x===t.x&&e.y<t.y?new C(e.x+1,e.y+1):e.x>t.x&&e.y===t.y?new C(e.x-1,e.y+1):e.x===t.x&&e.y>t.y?new C(e.x-1,e.y-1):e.x<t.x&&e.y===t.y?new C(e.x+1,e.y-1):e}}class tl{#eC;#e_;#eI;#eD;#eG;#eW;#eF;constructor(e,t){this.#eI=e,this.#eC=t}findReachedTiles(){return this.#e_=this.#eI.worldPointToGrid(this.#eC.position),this.#eW=this.#eI.getMapGridPointRect(),this.#eG&&this.#eG.coincident(this.#e_)&&this.#eW&&this.#eW.equals(this.#eF)||(this.#eD=new Map,this.#eD.set(this.#e_.toString(),this.#e_),this.#eH().forEach(e=>{this.#eU(e)}),this.#eG=this.#e_,this.#eF=this.#eW),this.#eD}isGridPointInRays(e){return!!this.#eD&&this.#eD.has(e.toString())}#eH(){let e=[];for(let t=this.#eW.x;t<=this.#eW.x+this.#eW.width;t++)e.push(new C(t,this.#eW.y)),e.push(new C(t,this.#eW.y+this.#eW.height));for(let t=this.#eW.y+1;t<=this.#eW.y+this.#eW.height-1;t++)e.push(new C(this.#eW.x,t)),e.push(new C(this.#eW.x+this.#eW.width,t));return e}#eU(e){let t,i,r;let n=function(e){let t=Math.abs(e);return t<=x.DEG_22_5?T.E:t<=x.DEG_67_5?Math.sign(e)>0?T.NE:T.SE:t<=x.DEG_112_5?Math.sign(e)>0?T.N:T.S:t<=x.DEG_157_7?Math.sign(e)>0?T.NW:T.SW:T.W}(this.#e_.getScreenAngleTo(e));Math.abs(e.x-this.#e_.x)>=Math.abs(e.y-this.#e_.y)?(t=Math.sign(e.x-this.#e_.x),i=(r=Math.abs(e.x-this.#e_.x))<1?0:(e.y-this.#e_.y)/r):(i=Math.sign(e.y-this.#e_.y),t=(r=Math.abs(e.y-this.#e_.y))<1?0:(e.x-this.#e_.x)/r);let o=this.#e_.x,s=this.#e_.y,a=!0;for(;r>=0;){let e=new C(Math.round(o),Math.round(s));if(a||this.#eI.isSeeThrough(e,this.#eC))this.#e$(e,n);else break;a=!1,o+=t,s+=i,r--}}#e$(e,t){switch(this.#eD.set(e.toString(),e),t){case T.N:this.#eV(new C(e.x-1,e.y-1)),this.#eV(new C(e.x,e.y-1)),this.#eV(new C(e.x+1,e.y-1));break;case T.NE:this.#eV(new C(e.x,e.y-1)),this.#eV(new C(e.x+1,e.y-1)),this.#eV(new C(e.x+1,e.y));break;case T.E:this.#eV(new C(e.x+1,e.y-1)),this.#eV(new C(e.x+1,e.y)),this.#eV(new C(e.x+1,e.y+1));break;case T.SE:this.#eV(new C(e.x+1,e.y)),this.#eV(new C(e.x+1,e.y+1)),this.#eV(new C(e.x,e.y+1));break;case T.S:this.#eV(new C(e.x-1,e.y+1)),this.#eV(new C(e.x,e.y+1)),this.#eV(new C(e.x+1,e.y+1));break;case T.SW:this.#eV(new C(e.x-1,e.y)),this.#eV(new C(e.x-1,e.y+1)),this.#eV(new C(e.x,e.y+1));break;case T.W:this.#eV(new C(e.x-1,e.y-1)),this.#eV(new C(e.x-1,e.y)),this.#eV(new C(e.x-1,e.y+1));break;case T.NW:this.#eV(new C(e.x-1,e.y)),this.#eV(new C(e.x-1,e.y-1)),this.#eV(new C(e.x,e.y-1))}}#eV(e){this.#eI.isSeeThrough(e)||this.#eD.set(e.toString(),e)}}function tc(e){return e?td(s).then(()=>e.load().then(()=>e.initialise()).then(()=>{a=new eX(r,48,eV.BR),addEventListener("fullscreenchange",()=>{document.fullscreenElement?(f.debug("Entering fullscreen mode"),i.setCurrentIndex(1)):(f.debug("Exiting fullscreen mode."),i.setCurrentIndex(0))}),i=new ed(0,{prefix:"hud-fullscreen",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:el.STOP}),(t=ej.addButton(i,()=>{var e;(e=document.body).requestFullscreen?e.requestFullscreen({navigationUI:"hide"}):Promise.reject(Error("Fullscreen requests not supported by browser"))},()=>{document.exitFullscreen()})).position.x=eO.TILE_SIZE,t.position.y=-eO.TILE_SIZE,ej.setVisible(!0),s=e})):(f.error("Attempt made to switch to the next scene when there are no more."),Promise.reject())}function td(e){return e?e.unload().then(()=>(et.clearAll(),s=null,a=null,ej.clear(),ej.setVisible(!1),Promise.resolve())):Promise.resolve(null)}function tu(){return++o<n.length?new t$(n[o]):null}var tm={areThereMoreScenes:function(){return o<n.length-1},setCameraToTrack:function(e,t,i){r=new e$(e,t,i)},panCameraBy:function(e,t){r.panBy(e,t),r.setTrackingMethod(eU.OFF),a.setTrackingState(!1)},setSceneDefinitions:function(e){n=e,o=-1},switchToFirstScene:function(){return tc((o=-1,tu()))},switchToNextScene:function(){return tc(tu())},unloadCurrentScene:function(){return td(s)},update:function(e){s?.update(e),r?.update(e)}};const tp=[{key:"BLOOD_ON",label:"Blood on",defValue:!0,controlType:eL.CHECKBOX,persistent:!0,action:null},{key:"UNUSED",label:"Not used yet",defValue:!1,controlType:eL.CHECKBOX,persistent:!0,action:null}],tf={MAIN_MENU:0,CLICKED_FREE_GROUND:1,CLICKED_ENTRANCE:2,CLICKED_EXIT:3};class tg{#eC;#eX;#eK;#eI;#eY;constructor(e,t,i){this.#eC=e,this.#eI=t,this.#eY=i}moveInstantly(){this.#eK=z.copy(this.#eC.position);let e=this.#eI.worldPointToGrid(this.#eC.position),t=this.#eC.isWandering()?this.#eZ(e,this.#eC.maxTilesPerMove):this.#eI.worldPointToGrid(h.position);if(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=2*this.#eC.maxTilesPerMove&&this.#eI.canHeroSeeGridPoint(e)){this.#eY.actor=this.#eC;let i=this.#eY.getDumbRouteNextTo(e,t,this.#eC.maxTilesPerMove);i.length>0&&(this.#eX=new eP({path:i,speed:100},this.#eC.sprite.modifier),this.#eq(i[i.length-1]))}}#eZ(e,t){let i=v(e.x-t,e.x+t),r=v(e.y-t,e.y+t),n=this.#eI.getDimsInTiles();return new C(S(i,0,n.width-1),S(r,0,n.height-1))}#eq(e){let t=this.#eI.worldPointToGrid(this.#eC.position);this.#eC.position=e;let i=this.#eI.worldPointToGrid(this.#eC.position);this.#eI.moveTileOccupancyGridPoint(this.#eC,t,i)}#ej(){this.#eq(this.#eK)}replay(){return(this.#ej(),this.#eX)?this.#eX.applyAsTransientToSprite(this.#eC.sprite):Promise.resolve()}}class tw{#eI;#eY;#eJ;constructor(e,t){this.#eJ=[],this.#eI=e,this.#eY=t}addAndMoveActor(e){let t=new tg(e,this.#eI,this.#eY);t.moveInstantly(),this.#eJ.push(t)}replay(){let e=[];return this.#eJ.forEach(t=>e.push(t.replay())),Promise.all(e)}}class ty{constructor(){}async transitionTo(e){await this.onExit().then(()=>(tI=e,e.onEntry()))}onEntry(){return Promise.resolve()}onEvent(e){return Promise.resolve(null)}onExit(){return Promise.resolve(null)}}class tx extends ty{onEntry(){return new ek({id:"PLAY",label:"Play",imageNameUp:"hero-idle00.png",imageNameDown:"hero-idle01.png",internalLabel:!0}),(function(){let e=new ek({id:"PLAY",label:"Play",imageNameUp:"ui-play00.png",imageNameDown:"ui-play01.png",internalLabel:!0}),t=new ek({id:"SETTINGS",label:"Settings",imageNameUp:"ui-settings00.png",imageNameDown:"ui-settings01.png",internalLabel:!0,action:()=>(function(){let e=[];return tp.forEach(t=>{e.push(function(e){let t;switch(e.controlType){case eL.TEXT_BUTTON:t=new eR(e);break;case eL.CHECKBOX:t=new eB(e.label),e.persistent?(t.selected=eI.get(e.key,e.defValue),t.action=()=>(eI.set(e.key,t.selected),e.action?e.action:Promise.resolve())):(t.selected=e.defValue,t.action=e.action)}return t}(t))}),eN.showControlsDialog("Settings",e,"door")})()});return eN.showControlsDialog("Welcome to the Scripted Dungeon",[t,e],"door")})().then(()=>this.transitionTo(new tS))}}class tS extends ty{onEntry(){return f.log("Enter AtStart"),eN.showOkDialog("You are in a dark and dingy dungeon.","Conquer it!","wall").then(()=>tm.switchToFirstScene()).then(()=>(h.sprite.position=et.getTileMap().getWorldPositionOfTileByEntry(),tI.transitionTo(new tv)))}}class tT extends ty{async onEntry(){f.log("Enter AtGameOver"),eb("YOU DIED!",{lifetimeSecs:2,position:h.position,velocity:new P(0,-100,0)}),await new Promise(e=>{setTimeout(()=>e(),2e3)}).then(()=>eN.showOkDialog("Game over. You died.","Try again")).then(()=>tm.unloadCurrentScene()).then(()=>this.transitionTo(new tx))}}class tE extends ty{async onEntry(){f.log("Enter AtGameCompleted"),await eN.showOkDialog("You've done it. Well done.","Try again").then(()=>tm.unloadCurrentScene()).then(()=>this.transitionTo(new tx))}}class tv extends ty{constructor(){super()}async onEntry(){await super.onEntry(),f.log("Enter HeroTurnIdle"),await tb()}async onEvent(e,t,i){switch(e){case tf.CLICKED_FREE_GROUND:i?.filter===tB.COMBAT_TILE?f.error("Unexpected click on combat tile ignored."):await tM(t),this.transitionTo(new tP);break;case tf.CLICKED_ENTRANCE:alert("Wow! Leaving so early. That bit of code is not ready yet.");break;case tf.CLICKED_EXIT:f.log("Escaping"),await tM(t),tm.areThereMoreScenes()?await tO(this):this.transitionTo(new tE)}return Promise.resolve(null)}}class tC extends ty{constructor(){super()}async onEntry(){await super.onEntry(),f.log("Enter HeroTurnFighting"),await tb()}async onEvent(e,t,i){switch(e){case tf.CLICKED_FREE_GROUND:i?.filter===tB.COMBAT_TILE?await this.#eQ(t):await this.#e4(t),0===et.getTileMap().getParticipants(h).length?this.transitionTo(new tP):this.transitionTo(new tz);break;case tf.CLICKED_ENTRANCE:alert("Wow! Leaving so early. That bit of code is not ready yet.");break;case tf.CLICKED_EXIT:f.log("Escaping"),await tM(t),tm.areThereMoreScenes()?await tO(this):this.transitionTo(new tE)}return Promise.resolve(null)}#eQ(e){let t=et.getTileMap().getTileAtWorldPoint(e).getOccupants(),i=[];for(let e of t.values())e.interaction&&i.push(e.interaction.react(h));return Promise.all(i)}#e4(e){for(let e of et.getTileMap().getParticipants(h))if(e.alive&&!e.interaction.allowEscape(h))return Promise.resolve(!1);return tM(e)}}class tP extends ty{constructor(){super()}async onEntry(){await super.onEntry(),f.log("Enter ComputerTurnIdle");let e=et.getTileMap(),t=new th(e),i=new tw(e,t),r=e.worldPointToGrid(h.position);for(let t of et.getActors().values())t!==h&&t.alive&&(t.isWandering()&&e.worldPointToGrid(t.position).isOtherClose(r,1.5)||i.addAndMoveActor(t));return await i.replay(),0===e.getParticipants(h).length?this.transitionTo(new tv):this.transitionTo(new tC),Promise.resolve(null)}}class tz extends ty{constructor(){super()}async onEntry(){await super.onEntry(),f.log("Enter ComputerTurnFighting");let e=et.getTileMap(),t=new th(e),i=new tw(e,t),r=e.getParticipants(h);for(let e of et.getActors().values())e!==h&&e.alive&&(r.includes(e)?await e.interaction.enact(h):i.addAndMoveActor(e));return await i.replay(),0===h.traits.get("HP")?this.transitionTo(new tT):0===r.length?this.transitionTo(new tv):this.transitionTo(new tC),Promise.resolve(null)}}function tb(){let e=et.getTileMap(),t=new th(e,h).getAllRoutesFrom(e.worldPointToGrid(h.sprite.position),h.maxTilesPerMove);return e.setMovementRoutes(t),e.setCombatActors(e.getParticipants(h)),Promise.resolve(null)}function tM(e){let t=et.getTileMap(),i=t.getWaypointsToWorldPoint(e);return(t.setMovementRoutes(null),t.setCombatActors(null),i)?new eP({path:i,speed:100},h.sprite.modifier).applyAsTransientToSprite(h.sprite):Promise.resolve()}function tO(e){return tm.switchToNextScene().then(()=>(h.sprite.position=et.getTileMap().getWorldPositionOfTileByEntry(),e.transitionTo(new tv)))}let tI=new class extends ty{onEntry(){f.log("WaitingToStart state")}async onEvent(e,t,i){e===tf.MAIN_MENU&&this.transitionTo(new tx)}},tR=!1;var tk={EventId:tf,getHeroActor:function(){return h},setHero:function(e){h=e},triggerEvent:function(e,t,i){if(tR){f.debug(`Ignoring event ${e} as still processing earlier event.`);return}tR=!0,tI.onEvent(e,t,i).then(()=>{tR=!1})}};const tB={MOVEMENT_TILE:0,COMBAT_TILE:1},tL={OBSTACLE:-1,GROUND:0,ENTRANCE:1,EXIT:2};class tA extends eF{sprite;obstacle;#e0;#e1;#e8;#e2;constructor(e,t){super(),this.sprite=e,this.#e0=new Map,this.obstacle=t.obstacle,this.#e1=t.gridPoint,this.#e8=t.worldPoint,this.#e2=t.role}get role(){return this.#e2}get gridPoint(){return this.#e1}get worldPoint(){return this.#e8}addOccupant(e){this.#e0.set(e,e)}deleteOccupant(e){this.#e0.delete(e)}getOccupants(){return this.#e0}actionClick(e){super.actionClick(this.sprite.position)}actionContextClick(e){super.actionClick(this.sprite.position)}isOccupied(){return this.#e0.size>0}isPassableByActor(e){if(this.obstacle)return!1;for(let t of this.#e0.values())if(t!==e&&!t.isPassableByActor(e))return!1;return!0}canBeOccupiedByActor(e){if(this.obstacle)return!1;for(let t of this.#e0.values())if(t!==e&&!t.canShareLocationWithActor(e))return!1;return!0}isSeeThrough(e){return!this.obstacle&&this.#e2!==tL.ENTRANCE&&this.#e2!==tL.EXIT}}class tN{#Q;#e3;#e6;#e7;#e5;#y;#x;#e9;#te;#tt;#ti;#tr;#tn;#to;#ts;#ta;#th;#tl;constructor(e,t,i){let r=t.matrix;this.#tn=t.entryPointByDoor,this.#to=t.exitPointByDoor,this.#Q=e,this.#tt=new ex({renderer:new ef(e,{width:i,height:i,fillStyle:null,strokeStyle:"white"})}),this.#tl=new ex({renderer:new ef(e,{width:i,height:i,fillStyle:null,strokeStyle:"red"})}),this.#e5=i,this.#e3=[],this.#e7=r.length,this.#e6=r[0].length,this.#y=i*this.tilesX,this.#x=i*this.tilesY,this.#ts=[],r.forEach((t,i)=>{let r=[];this.#e3.push(r),t.forEach((t,n)=>{if(t){let o=new ex({renderer:new ey(e,es.getSpriteBitmap(0,t.image))}),s=new C(n,i),a=this.gridPointToWorldPoint(s),h=new tA(o,{obstacle:t.role===tL.OBSTACLE,gridPoint:s,worldPoint:a,role:t.role});t.onClick&&(h.setOnClick((e,i)=>this.#tc(e,i,t.onClick)),h.setOnContextClick(t.onContextClick)),this.processTileRole(h),r.push(h),o.position.x=n*this.#e5+this.#e5/2,o.position.y=i*this.#e5+this.#e5/2}else r.push(null)})}),this.#ti||(f.error("No entrance has been set. Setting to the first ground tile"),this.#ti=this.#ts[0])}getDimsInTiles(){return{width:this.#e6,height:this.#e7}}processTileRole(e){switch(e.role){case tL.ENTRANCE:if(this.#ti){let t=e.gridPoint;f.error(`Duplicate entrance found at (${t.x}, ${t.y}). Ignored.`)}else this.#ti=e;break;case tL.EXIT:if(this.#tr){let t=e.gridPoint;f.error(`Duplicate exit found at (${t.x}, ${t.y}). Ignored.`)}else this.#tr=e;break;case tL.GROUND:e.gridPoint.coincident(this.#tn)||this.#ts.push(e)}}update(e){this.#td();let t=this.getVisibleGridPointRect();for(let i=t.y;i<=t.y+t.height;i++)for(let r=t.x;r<=t.x+t.width;r++)if(this.#ta?.isGridPointInRays(new C(r,i))){let t=this.#e3[i][r];t?.sprite.update(e)}this.#tu(e)}#td(){let e=tk.getHeroActor();if(e){this.#ta||(this.#ta=new tl(this,e));let t=this.getTileAtWorldPoint(e.position);if(t){let e=t.role;e!=tL.ENTRANCE&&e!=tL.EXIT&&this.#ta.findReachedTiles()}else f.error(`Hero at ${e.position.toString()} but no tile found.`)}}getMapGridPointRect(){return new b(0,0,this.#e6,this.#e7)}getVisibleGridPointRect(){let e=Z.getWorldInCanvasBounds(),t=this.worldPointToGrid(new C(e.x,e.y)),i=this.worldPointToGrid(new C(e.x+e.width,e.y+e.height)),r=Math.max(0,t.x),n=Math.min(this.#e6-1,i.x),o=Math.max(0,t.y);return new b(r,o,n-r,Math.min(this.#e7-1,i.y)-o)}getGridSize(){return this.#e5}getDimensions(){return{width:this.#y,height:this.#x}}getTileAtWorldPoint(e){let t=this.worldPointToGrid(e);return this.getTileAtGridPoint(t)}getTileAtGridPoint(e){if(!e)return null;let t=e.y,i=e.x;return i>=0&&t>=0&&i<this.#e6&&t<this.#e7?this.#e3[t][i]:null}worldPointToGrid(e){return new C(Math.floor(e.x/this.#e5),Math.floor(e.y/this.#e5))}gridAlignedWorldPoint(e){let t=this.worldPointToGrid(e);return this.gridPointToWorldPoint(t)}gridPointToWorldPoint(e){let t=.5*this.#e5;return new C(e.x*this.#e5+t,e.y*this.#e5+t)}getWorldPositionOfTileByEntry(){return this.gridPointToWorldPoint(this.#tn)}getGridPositionOfEntrance(){return this.#ti.gridPoint}setMovementRoutes(e){this.#e9=e,e?(this.#te=new Map,this.#e9.forEach(e=>e.forEach(e=>{this.#te.set(e,e)}))):this.#te=null}setCombatActors(e){this.#th=[],e?.forEach(e=>{this.#th.push(this.worldPointToGrid(e.position))})}#tu(e){this.#tm(e),this.#tp(e)}#tm(e){this.#te?.forEach(t=>{this.#tt.position=this.gridPointToWorldPoint(t),this.#tt.update(e)})}#tp(e){this.#th?.forEach(t=>{this.#tl.position=this.gridPointToWorldPoint(t),this.#tl.update(e)})}#tc(e,t,i){if(this.#e9?.containsGridPoint(this.worldPointToGrid(t))){i(e,t,{filter:tB.MOVEMENT_TILE});return}let r=this.worldPointToGrid(t);this.#th?.forEach(n=>{if(n.isCoincident(r)){i(e,t,{filter:tB.COMBAT_TILE});return}}),f.debug("Ignore click outside of highlighted area")}getWaypointsToWorldPoint(e){let t=this.worldPointToGrid(e);return this.#e9?.getWaypointsAsWorldPoints(t)}getRandomFreeGroundTile(){for(let e of(e5(this.#ts),this.#ts))if(!e.isOccupied())return e;return null}isGridPointPassableByActor(e,t){let i=this.getTileAtGridPoint(e);return!!i&&i.isPassableByActor(t)}canGridPointBeOccupiedByActor(e,t){let i=this.getTileAtGridPoint(e);return!!i&&i.canBeOccupiedByActor(t)}canHeroSeeGridPoint(e){return this.#ta?.isGridPointInRays(e)??!0}isSeeThrough(e,t){let i=this.getTileAtGridPoint(e);return!i||i.isSeeThrough(t)}getSurroundingTiles(e){return e7(this.#e3,e.y,e.x)}deleteOccupancyOfGridPoint(e,t){this.getTileAtGridPoint(t)?.deleteOccupant(e)}moveTileOccupancyGridPoint(e,t,i){i!==t&&(this.getTileAtGridPoint(t)?.deleteOccupant(e),this.getTileAtGridPoint(i)?.addOccupant(e))}getParticipants(e){let t=[],i=this.getSurroundingTiles(this.worldPointToGrid(e.position));return[i.above,i.right,i.below,i.left].forEach(e=>{let i=e?.getOccupants();i?.forEach(e=>{t.push(e)})}),t}}function t_(e){return{role:tL.GROUND,onClick:(e,t,i)=>tk.triggerEvent(tk.EventId.CLICKED_FREE_GROUND,t,i),image:e}}function tD(e){return{role:tL.ENTRANCE,onClick:(e,t,i)=>tk.triggerEvent(tk.EventId.CLICKED_ENTRANCE,t,i),image:e}}function tG(e){return{role:tL.EXIT,onClick:(e,t,i)=>tk.triggerEvent(tk.EventId.CLICKED_EXIT,t,i),image:e}}const tW=new Map([["x",{role:tL.OBSTACLE,image:"block.png"}],["#-TL",{role:tL.OBSTACLE,image:"wall-TL.png"}],["#-TLI",{role:tL.OBSTACLE,image:"wall-TLI.png"}],["#-T",{role:tL.OBSTACLE,image:"wall-T.png"}],["#-TR",{role:tL.OBSTACLE,image:"wall-TR.png"}],["#-TRI",{role:tL.OBSTACLE,image:"wall-TRI.png"}],["#-R",{role:tL.OBSTACLE,image:"wall-R.png"}],["#-BR",{role:tL.OBSTACLE,image:"wall-BR.png"}],["#-BRI",{role:tL.OBSTACLE,image:"wall-BRI.png"}],["#-B",{role:tL.OBSTACLE,image:"wall-B.png"}],["#-BL",{role:tL.OBSTACLE,image:"wall-BL.png"}],["#-BLI",{role:tL.OBSTACLE,image:"wall-BLI.png"}],["#-L",{role:tL.OBSTACLE,image:"wall-L.png"}],["#-XI",{role:tL.OBSTACLE,image:"wall-XI.png"}],["#-VI",{role:tL.OBSTACLE,image:"wall-VI.png"}],["#-HI",{role:tL.OBSTACLE,image:"wall-HI.png"}],["#-TTEE",{role:tL.OBSTACLE,image:"wall-TTEE.png"}],["#-RTEE",{role:tL.OBSTACLE,image:"wall-RTEE.png"}],["#-BTEE",{role:tL.OBSTACLE,image:"wall-BTEE.png"}],["#-LTEE",{role:tL.OBSTACLE,image:"wall-LTEE.png"}],["#",{role:tL.OBSTACLE,image:"block.png"}],["=-T",tG("door-T.png")],["=-R",tG("door-R.png")],["=-B",tG("door-B.png")],["=-L",tG("door-L.png")],["--T",tD("door-T.png")],["--R",tD("door-R.png")],["--B",tD("door-B.png")],["--L",tD("door-L.png")],["=",{role:tL.OBSTACLE,image:"block.png"}],["-",{role:tL.OBSTACLE,image:"block.png"}],[".",t_("floor.png")],[".-SBW",t_("floor-SBW.png")],[".-SBE",t_("floor-SBE.png")],[",-SBE",t_("floor2-SBE.png")],[",-SBW",t_("floor2-SBW.png")],[",",t_("floor2.png")]]);class tF{#tf;#G;#tg;#tw;#ty;heroActor;constructor(e=2,t=2){e>0?(this.#tf=0,this.#G=1/e):this.#G=1,this.#tg=e,this.#tw=t}getOpacity(){return this.#tf}load(){return this.doLoad()}initialise(){return this.doInitialise()}update(e){Z.clearCanvas(),Z.setOpacity(this.#tf),et.update(e),this.doUpdate(e),ej.update(e),Z.setOpacity(1),0!==this.#G&&(this.#tf+=e*this.#G,this.#tf>1?(this.#G=0,this.#tf=1):this.#tf<0&&(this.#G=0,this.#tf=0)),this.#ty&&0===this.#tf&&(this.#ty(),this.#ty=null)}unload(){return this.#tx().then(()=>this.doUnload())}#tx(){return this.#tw>0?(this.#G=-1/this.#tw,new Promise(e=>{this.#ty=e})):Promise.resolve()}doLoad(){return Promise.resolve()}doInitialise(){return Promise.resolve()}doUpdate(e){return Promise.resolve()}doUnload(){return Promise.resolve()}}const tH=eO.TILE_SIZE;class tU{intro;hero;enemies;mapDesign;constructor(){this.enemies=[],this.mapDesign=[]}}class t$ extends tF{#tS;constructor(e){super(),this.#tS=e}doLoad(){return Promise.resolve()}doInitialise(){let e=ti.generateTileMapPlan(this.#tS.mapDesign,tW),t=new tN(Z.getContext2D(),e,tH);return et.setTileMap(t),this.heroActor=function(e){if(e.hero){let t=e6.get(e.hero.id).create();return t.traits=e.hero.traits.clone(),l=t,t}if(!l)throw Error("No hero has been defined.");return l}(this.#tS),(function(e){let t=[];return e.enemies.forEach(e=>{let i=e6.get(e.id).create();i.traits=e.traits,t.push(i)}),t})(this.#tS).forEach(e=>{e.position=t.getRandomFreeGroundTile().worldPoint,et.addActor(e)}),tm.setCameraToTrack(this.heroActor.sprite,200,0),et.addActor(this.heroActor),tk.setHero(this.heroActor),Promise.resolve()}doUpdate(e){}doUnload(){return Promise.resolve(null)}}class tV{#tT;#tE;constructor(e){e?(this.#tT=new Map(e),this.#tE=!1):(this.#tT=new Map,this.#tE=!0)}set(e,t){if(this.#tE||this.#tT.has(e))this.#tT.set(e,t);else throw Error(`Attempt to set invalid key '${e}'`)}get(e){return this.#tT.get(e)}setFromString(e){return e.split(",").forEach(e=>{let t=e.match(/^\s*(\w+)\s*[=: ]\s*(.+?)\s*$/);if(t)this.#tv(t[1],t[2]);else throw Error(`Invalid property definition'${e}'`)}),this}#tv(e,t){let i=t.match(/(\d+) *[/] *(\d+) */);i?(this.#tT.set(e,i[1]),this.#tT.set(`${e}_MAX`,i[2])):this.#tT.set(e,t)}clone(){let e=new tV(this.#tT);return e.#tE=this.#tE,e}}class tX extends tV{constructor(e){super(e??new Map([["NAME","mystery"],["MOVEMENT","wander"],["HP",10],["HP_MAX",10],["STR",10],["STR_MAX",10]]))}}class tK{#tC;#tP;#tz;#tb;#tM;#tO;#tI;#tR;#tk;#tB;constructor(e){this.#tC=v(e.minCols,e.maxCols),this.#tP=v(e.minRows,e.maxRows),this.#tz=e.maxRoomCols,this.#tb=e.maxRoomRows,this.#tM=e9.WALL[0],this.#tO=e9.GROUND[0],this.#tk=e9.VOID[0],this.#tI=e9.DOOR_IN[0],this.#tR=e9.DOOR_OUT[0]}generate(){this.#tB=[];let e=0,t=this.#tC;for(;this.#tB.length<this.#tP-4;){let i=e+t-4-2,r=i>0?E(0,i):0,n=Math.max(e-r+4,4),o=Math.min(this.#tz,this.#tC-r),s=o>n?E(n,o):n,a=this.#tC-r-s,h=E(4,Math.min(this.#tb,this.#tP-this.#tB.length));this.#tL(r,s,a,h),e=r,t=s}return this.#tA(),this.#tN(),this.getMatrixAsStrings()}getMatrixAsStrings(){return this.#tB.map(e=>e.join(""))}#tL(e,t,i,r){f.log(`Create room ${e} ${t} ${i} ${r}`);let n="";n+=this.#tk.repeat(e)+this.#tM.repeat(t)+this.#tk.repeat(i),this.#tB.push(n.split(""));for(let o=0;o<r-2;o++)n=""+this.#tk.repeat(e)+this.#tM+this.#tO.repeat(t-2)+this.#tM+this.#tk.repeat(i),this.#tB.push(n.split(""));n=""+this.#tk.repeat(e)+this.#tM.repeat(t)+this.#tk.repeat(i),this.#tB.push(n.split(""))}#tA(){for(let e=1;e<this.#tB.length-1;e++)for(let t=1;t<this.#tB[0].length-2;t++)this.#tB[e][t]===this.#tM&&this.#tB[e+1][t]===this.#tM&&this.#tB[e-1][t]===this.#tO&&this.#tB[e+2][t]===this.#tO&&(this.#tB[e][t]=this.#tO,this.#tB[e+1][t]=this.#tO)}#t_(e){return e.above===this.#tM&&e.centre===this.#tM&&e.below===this.#tM}#tD(e){return e.left===this.#tM&&e.centre===this.#tM&&e.right===this.#tM}#tN(){let e=[];this.#tB.forEach((t,i)=>t.forEach((t,r)=>{let n=e7(this.#tB,i,r);(this.#tD(n)||this.#t_(n))&&e.push({row:i,col:r})}));let t=e5(e),i=t[0];this.#tB[i.row][i.col]=this.#tI,i=t[1],this.#tB[i.row][i.col]=this.#tR}}const tY={HERO:"HERO",LEVEL:"LEVEL",CAST:"CAST",MAP:"MAP"};class tZ{sceneDefn;lines;lineIndex;constructor(e,t,i){this.lines=e,this.lineIndex=t,this.sceneDefn=i}parse(){for(;this.lineIndex<this.lines.length;){let e=this.lines[this.lineIndex],t=tZ.getSectionIdFromLine(e);if(t)return{nextSectionId:t,nextLineIndex:this.lineIndex};this.parseLine(e),this.lineIndex++}return null}static findFirstSection(e){for(let t=0;t<e.length;t++){let i=tZ.getSectionIdFromLine(e[t].trim());if(i)return{nextSectionId:i,nextLineIndex:t}}return null}parseLine(e){throw"Method parseLine should be overridden."}static getSectionIdFromLine(e){let t=e.match(/^\s*\[ *([\w ]+) *\]/);return t?t[1].toUpperCase():null}fatalError(e){throw Error(`Error parsing script on line ${this.lineIndex+1}: ${e}`)}ignoreError(e){f.debug(`Ignoring error parsing script on line ${this.lineIndex}: ${e}`)}}class tq extends tZ{constructor(e,t,i){super(e,t,i),this.sceneDefn.intro=""}parseLine(e){this.sceneDefn.intro+=""===e?"\n":e}}class tj extends tZ{constructor(e,t,i){super(e,t,i)}parseLine(e){let t=e.match(/^\s*(\w+?) *: *([\w,:= /]*)/);t?this.#tG(t):this.#tW(e)}#tG(e){let t=e[1],i=e[2];try{let e=new tX().setFromString(i);this.sceneDefn.hero={id:"HERO",name:t||"mystery",traits:e}}catch(e){this.fatalError(e.message)}}#tW(e){this.fatalError("Long form actors not supported.")}}class tJ extends tZ{constructor(e,t,i){super(e,t,i)}parseLine(e){let t=e.match(/^\s*(\w+?) *x(\d{1,2}) *([^:]*): *([\w,:= /]*)/);t?this.#tF(t):this.#tH(e)}#tF(e){let t=e[1].toUpperCase(),i=parseInt(e[2]),r=e[3],n=e[4];for(let e=0;e<i;e++)if(e6.has(t))try{let e=new tX().setFromString(n);this.sceneDefn.enemies.push({id:t,name:r||"mystery",traits:e})}catch(e){this.fatalError(e.message)}else this.fatalError(`Cast member ${t} does not exist.`)}#tH(e){this.fatalError("Long form actors not supported.")}}class tQ extends tZ{#tU;#t$;constructor(e,t,i){super(e,t,i),this.#tU=!1,this.#t$=/^\s*random\s*$/i}parseLine(e){if(!this.#tU&&""!==e){if(this.#t$.test(e)){let e=new tK({minCols:12,maxCols:40,maxRoomCols:10,minRows:12,maxRows:40,maxRoomRows:6});this.sceneDefn.mapDesign=e.generate(),this.#tU=!0,f.debug("Random map"),this.sceneDefn.mapDesign.forEach(e=>f.debug(e))}else this.sceneDefn.mapDesign.push(e)}}}function t4(e,t,i){switch(e){case tY.HERO:return new tj(c,t+1,i);case tY.LEVEL:return new tq(c,t+1,i);case tY.CAST:return new tJ(c,t+1,i);case tY.MAP:return new tQ(c,t+1,i)}return null}const t0="custom-pointer-down-event",t1="custom-pointer-up-event",t8="custom-pointer-cancel-event",t2="custom-click-event",t3="custom-pointer-drag-event",t6={MOUSE:0,TOUCH:1};function t7(e,t,i){let r=new CustomEvent(t,{detail:i});e.dispatchEvent(r)}function t5(e){let t=e.target.getBoundingClientRect();return{x:e.touches[0].pageX-t.left,y:e.touches[0].pageY-t.top}}function t9(e,t,i,r){r.actionStarted=!0,r.dragging=!1,r.distance=0,r.lastX=t,r.lastY=i,r.startX=t,r.startY=i,t7(r.element,t0,{x:t,y:i})}function ie(e,t,i,r){let n=r.dragging?"custom-pointer-drag-end-event":t1;r.actionStarted=!1,r.dragging=!1,r.distance=0,r.lastX=t,r.lastY=i,r.startX=t,r.startY=i,t7(r.element,n,{x:t,y:i})}function it(e,t,i,r){let n=t-r.lastX,o=i-r.lastY;if(r.lastX=t,r.lastY=i,r.dragging){let e=new CustomEvent(t3,{detail:{x:t,y:i,dx:n,dy:o}});r.element.dispatchEvent(e)}else(Math.abs(t-r.startX)>10||Math.abs(i-r.startY)>10)&&(r.dragging=!0,r.suppressClickEvent=!0)}var ii={};ii=JSON.parse('{"frames":[{"filename":"blank.png","frame":{"x":333,"y":246,"w":3,"h":3},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":3,"h":3},"sourceSize":{"w":48,"h":48}},{"filename":"block.png","frame":{"x":97,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"blood-splat.png","frame":{"x":1,"y":1,"w":94,"h":92},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":94,"h":92},"sourceSize":{"w":96,"h":96}},{"filename":"door-B.png","frame":{"x":1,"y":190,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-L.png","frame":{"x":702,"y":197,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-R.png","frame":{"x":721,"y":101,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-T.png","frame":{"x":147,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor-SBE.png","frame":{"x":197,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor-SBW.png","frame":{"x":247,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor.png","frame":{"x":297,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2-SBE.png","frame":{"x":347,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2-SBW.png","frame":{"x":397,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2.png","frame":{"x":447,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-dead00.png","frame":{"x":771,"y":150,"w":48,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"hero-idle00.png","frame":{"x":784,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-idle01.png","frame":{"x":497,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-idle02.png","frame":{"x":832,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-idle03.png","frame":{"x":197,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-e00.png","frame":{"x":862,"y":150,"w":34,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":1,"w":34,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-e01.png","frame":{"x":889,"y":199,"w":35,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":1,"w":35,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-e02.png","frame":{"x":1060,"y":101,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-e03.png","frame":{"x":1176,"y":151,"w":30,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":30,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-n00.png","frame":{"x":880,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-n01.png","frame":{"x":246,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-n02.png","frame":{"x":880,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-n03.png","frame":{"x":1167,"y":51,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-s00.png","frame":{"x":928,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-s01.png","frame":{"x":547,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-s02.png","frame":{"x":928,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-s03.png","frame":{"x":1120,"y":51,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-w00.png","frame":{"x":1101,"y":101,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-w01.png","frame":{"x":51,"y":190,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-w02.png","frame":{"x":821,"y":150,"w":39,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":39,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hero-walk-w03.png","frame":{"x":1137,"y":151,"w":37,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":37,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hero.png","frame":{"x":976,"y":51,"w":46,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-down00.png","frame":{"x":145,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-down01.png","frame":{"x":193,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-left00.png","frame":{"x":241,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-left01.png","frame":{"x":289,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-right00.png","frame":{"x":337,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-right01.png","frame":{"x":385,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-up00.png","frame":{"x":433,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-up01.png","frame":{"x":481,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-auto-centre00.png","frame":{"x":529,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-auto-centre01.png","frame":{"x":577,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-fullscreen00.png","frame":{"x":625,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-fullscreen01.png","frame":{"x":673,"y":101,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"orc-dead00.png","frame":{"x":721,"y":151,"w":48,"h":34},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":11,"w":48,"h":34},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle00.png","frame":{"x":295,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle01.png","frame":{"x":344,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle02.png","frame":{"x":393,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle03.png","frame":{"x":442,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-e00.png","frame":{"x":1015,"y":150,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-e01.png","frame":{"x":776,"y":201,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-e02.png","frame":{"x":898,"y":149,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-e03.png","frame":{"x":1142,"y":101,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-n00.png","frame":{"x":96,"y":188,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-n01.png","frame":{"x":491,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-n02.png","frame":{"x":687,"y":51,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-n03.png","frame":{"x":976,"y":100,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-s00.png","frame":{"x":735,"y":51,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":47,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-s01.png","frame":{"x":540,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-s02.png","frame":{"x":735,"y":51,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":47,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-s03.png","frame":{"x":239,"y":197,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w00.png","frame":{"x":933,"y":100,"w":41,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":41,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w01.png","frame":{"x":756,"y":100,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":42,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w02.png","frame":{"x":589,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w03.png","frame":{"x":800,"y":100,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":42,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc.png","frame":{"x":638,"y":51,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"pow.png","frame":{"x":1,"y":95,"w":92,"h":93},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":92,"h":93},"sourceSize":{"w":96,"h":96}},{"filename":"RIP.png","frame":{"x":97,"y":51,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"trader-dead00.png","frame":{"x":95,"y":149,"w":48,"h":37},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":37},"sourceSize":{"w":48,"h":48}},{"filename":"trader-idle-s03.png","frame":{"x":1024,"y":51,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-idle00.png","frame":{"x":427,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-idle01.png","frame":{"x":657,"y":197,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-idle02.png","frame":{"x":473,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-e00.png","frame":{"x":850,"y":199,"w":37,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":37,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-e01.png","frame":{"x":1018,"y":101,"w":40,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":40,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-e02.png","frame":{"x":814,"y":201,"w":34,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":34,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-e03.png","frame":{"x":737,"y":201,"w":37,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-n00.png","frame":{"x":519,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-n01.png","frame":{"x":844,"y":100,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":42,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-n02.png","frame":{"x":565,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-n03.png","frame":{"x":933,"y":150,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-s00.png","frame":{"x":333,"y":197,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":45,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-s01.png","frame":{"x":286,"y":197,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-s02.png","frame":{"x":380,"y":197,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":45,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-s03.png","frame":{"x":1072,"y":51,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-w00.png","frame":{"x":974,"y":150,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-w01.png","frame":{"x":888,"y":100,"w":43,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":1,"w":43,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-w02.png","frame":{"x":1055,"y":151,"w":39,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":1,"w":39,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader-walk-w03.png","frame":{"x":1096,"y":151,"w":39,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":1,"w":39,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"trader.png","frame":{"x":611,"y":197,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"ui-checkbox00.png","frame":{"x":145,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-checkbox01.png","frame":{"x":193,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-play00.png","frame":{"x":241,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-play01.png","frame":{"x":289,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-settings00.png","frame":{"x":337,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-settings01.png","frame":{"x":385,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-down00.png","frame":{"x":433,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-down01.png","frame":{"x":481,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-left00.png","frame":{"x":529,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-left01.png","frame":{"x":577,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-right00.png","frame":{"x":625,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-right01.png","frame":{"x":673,"y":149,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-up00.png","frame":{"x":143,"y":197,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-up01.png","frame":{"x":191,"y":197,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"wall-B.png","frame":{"x":597,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BL.png","frame":{"x":962,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BLI.png","frame":{"x":647,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BR.png","frame":{"x":926,"y":201,"w":34,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":34,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BRI.png","frame":{"x":697,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BTEE.png","frame":{"x":747,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-HI.png","frame":{"x":797,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-L.png","frame":{"x":997,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-LTEE.png","frame":{"x":1032,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-R.png","frame":{"x":1067,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-RTEE.png","frame":{"x":1102,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-T.png","frame":{"x":847,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TL.png","frame":{"x":1137,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TLI.png","frame":{"x":897,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TR.png","frame":{"x":1172,"y":201,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TRI.png","frame":{"x":947,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TTEE.png","frame":{"x":997,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-VI.png","frame":{"x":1047,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-XI.png","frame":{"x":1097,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-B.png","frame":{"x":1147,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-HI.png","frame":{"x":95,"y":99,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-T.png","frame":{"x":147,"y":51,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}}],"meta":{"app":"https://www.codeandweb.com/texturepacker","version":"1.0","image":"dungeon.png","format":"RGBA8888","size":{"w":1208,"h":250},"scale":"1","smartupdate":"$TexturePacker:SmartUpdate:4534e0ee2047f5c5e3b4b1eab74e2e70:5c8c3f7b31e25a52db917ab223c06f93:9c0fba27a8a0c106083a8713f6c67b32$"}}');var ir={};function io(e){if(eh.updateTimeNow(e),u){var t;let i=(e-u)/1e3;tm.update(i),er.showFps&&(t=1/i,ei(Z.getContext2D(),`FPS: ${Math.round(t)}`,{x:0,y:Z.getCanvasDimensions().height},{color:"green"}))}u=e,window.requestAnimationFrame(io)}ir=new URL("dungeon.c7fee6f0.png",import.meta.url).toString();var is={TILE_SIZE:48,initialise:async function(e){Z.setOptions(e),function(e){let t=0;for(let i in eJ){let r=e.measureText(eJ[i]),n=r.fontBoundingBoxAscent+r.fontBoundingBoxDescent,o=.5*n-r.fontBoundingBoxDescent;e.fillText(eJ[i],-.5*r.width,o),e.getImageData(0,0,1,1).data[3]<=0&&(f.debug(`Emoji ${i} not supported.`),eJ[i]=`[${t++}]`),e.clearRect(0,0,r.width,n)}}(Z.getContext2D()),function(){let e;let t=Z.getCanvas();e={element:t,actionStarted:!1,dragging:!1,x:0,y:0,lastTouchStartPoint:null,suppressClickEvent:!1},t.addEventListener("mousedown",t=>(f.debug("mousedown"),t9(t6.MOUSE,t.offsetX,t.offsetY,e)),{passive:!0}),t.addEventListener("mouseup",t=>(f.debug("mouseup"),ie(t6.MOUSE,t.offsetX,t.offsetY,e)),{passive:!0}),t.addEventListener("mousemove",t=>{f.debug("mousemove"),1&t.buttons&&it(t6.MOUSE,t.offsetX,t.offsetY,e)},{passive:!0}),t.addEventListener("touchstart",t=>{if(f.debug("touchstart"),1===t.changedTouches.length){let i=t5(t);e.lastTouchStartPoint=new C(i.x,i.y),t9(t6.TOUCH,i.x,i.y,e)}},{passive:!0}),t.addEventListener("touchend",t=>{f.debug("touchend"),1===t.changedTouches.length&&ie(t6.TOUCH,e.lastTouchStartPoint?.x,e.lastTouchStartPoint?.y,e),e.lastTouchStartPoint=null,e.suppressClickEvent=!1},{passive:!0}),t.addEventListener("touchmove",t=>{if(f.debug("touchmove"),1===t.changedTouches.length){let i=t5(t);it(t6.TOUCH,i.x,i.y,e),e.suppressClickEvent=!0}},{passive:!0}),t.addEventListener("touchcancel",t=>{var i,r;f.debug("touchcancel"),t6.TOUCH,i=e.lastTouchStartPoint?.x,r=e.lastTouchStartPoint?.y,e.actionStarted=!1,e.dragging=!1,e.distance=0,e.lastX=i,e.lastY=r,e.startX=i,e.startY=r,t7(e.element,t8,{x:i,y:r}),e.lastTouchStartPoint=null},{passive:!0}),t.addEventListener("click",i=>{f.debug("click"),e.suppressClickEvent||t7(t,t2,{x:i.offsetX,y:i.offsetY}),e.suppressClickEvent=!1}),t.addEventListener(t2,e=>{let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);ej.resolveClick(r)||et.resolveClick(r)}),t.addEventListener(t0,e=>{let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);ej.resolvePointerDown(r)}),t.addEventListener(t1,e=>{let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);ej.resolvePointerUp(r)}),t.addEventListener(t8,e=>{let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);ej.resolvePointerCancel(r)}),t.addEventListener(t3,e=>{tm.panCameraBy(-e.detail.dx,-e.detail.dy)}),t.addEventListener("contextmenu",e=>{f.debug("Context menu");let t=e.detail.x,i=e.detail.y,r=Z.uiCoordsToMappedPositions(t,i);ej.resolveContextMenu(r)||et.resolveContextMenu(r),e.preventDefault()})}(),eN.showOkDialog("Welcome to the Scripted Dungeon","Let's start","door").then(()=>es.loadSpriteMap(m(ii),m(ir))).then(()=>{var e;return e=e4.DUNGEON_SCRIPT,fetch(e).then(e=>e.text()).then(e=>e).catch(t=>(f.error(`Error fetching ${e}: ${t}`),null))}).then(e=>tm.setSceneDefinitions(function(e){c=e.split(/\r?\n/),d=[];let t=new tU,i=tZ.findFirstSection(c);if(!i)throw Error("Invalid script. No section identifiers found.");let r=t4(i.nextSectionId,i.nextLineIndex,t);for(;r;){let e=r.parse();e?.nextSectionId&&e.nextSectionId!==tY.LEVEL||(d.push(t),t=new tU),r=e?t4(e.nextSectionId,e.nextLineIndex,t):null}return d}(e))).then(()=>{}).then(()=>tk.triggerEvent(tk.EventId.MAIN_MENU)).then(()=>void window.requestAnimationFrame(io)).catch(e=>{f.error(e),alert(`Fatal error in main game. ${e.message}`)})}};window.addEventListener("load",()=>{try{is.initialise({width:800,height:600,maxScale:2.4,minScale:1,sizingMethod:"COVER",alpha:!1})}catch(e){f.fatal(e)}});
//# sourceMappingURL=index.91e28fc6.js.map
