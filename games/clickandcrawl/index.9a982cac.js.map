{"mappings":"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C,sBAAuB,iBAAiB,CACzC,CAAC,oBAAqB,iBAAiB,CACvC,CAAC,uBAAwB,QAAQ,CACjC,CAAC,eAAgB,QAAQ,CACzB,CAAC,gBAAiB,SAAS,CAC3B,CAAC,mBAAoB,YAAY,CACjC,CAAC,qBAAsB,YAAY,CAEnC,CAAC,aAAc,MAAM,CAErB,CAAC,uBAAwB,oBAAoB,CAC7C,CAAC,yBAA0B,iBAAiB,CAC5C,CAAC,uBAAwB,eAAe,CACxC,CAAC,0BAA2B,kBAAkB,CAC9C,CAAC,yBAA0B,iBAAiB,CAC5C,CACE,0BACA,wEACD,CACD,CACE,yBACA,oFACD,CACD,CACE,oBACA,8EACD,CACD,CACE,yBACA,yDACD,CACD,CACE,2BACA,6GACD,CACD,CAAC,yBAA0B,qCAAqC,CAChE,CACE,yBACA,gGACD,CACD,CAAC,wBAAyB,sBAAsB,CAChD,CACE,+BACA,sGACD,CACD,CAAC,wBAAyB,2BAA2B,CACrD,CACE,0BACA,oDACD,CACD,CACE,2CACA,+GACD,CACD,CACE,wCACA,oDACD,CACD,CACE,4BACA,wDACD,CACD,CACE,qBACA,uIACD,CACD,CACE,sBACA,qEACD,CACD,CACE,4BACA,0HACD,CACD,CACE,gCACA,yGACD,CACD,CACE,0BACA,4GACD,CACD,CACE,8BACA,sEACD,CACD,CACE,sBACA,iGACD,CACD,CAAC,mBAAoB,oDAAoD,CACzE,CACE,oBACA,uEACD,CACD,CACE,2BACA,8DACD,CACD,CAAC,2BAA4B,iCAAiC,CAC9D,CACE,qCACA,uGACD,CACD,CACE,oCACA,mHACD,CACD,CACE,6BACA,4DACD,CACD,CAAC,qBAAsB,0CAA0C,CACjE,CACE,4BACA,uFACD,CACD,CAAC,sBAAuB,+BAA+B,CACvD,CAAC,qBAAsB,gDAAgD,CACvE,CACE,yBACA,wFACD,CACD,CACE,kCACA,2FACD,CACD,CACE,iCACA,2JACD,CACD,CACE,mCACA,sIACD,CACD,CACE,gCACA,2FACD,CACD,CACE,mCACA,2GACD,CACD,CACE,8BACA,yDACD,CACD,CACE,0BACA,iEACD,CAED,CACE,uBACA,oHACD,CACD,CACE,yBACA,iGACD,CACD,CACE,8BACA,0GACD,CACD,CACE,6BACA,+EACD,CACD,CAAC,wBAAyB,+BAA+B,CACzD,CAAC,yBAA0B,uCAAuC,CAClE,CAAC,oBAAqB,sCAAsC,CAC5D,CACE,2BACA,6DACD,CACD,CACE,0BACA,oFACD,CACD,CAAC,qBAAsB,4CAA4C,CACnE,CACE,uCACA,+IACD,CACD,CACE,+BACA,8EACD,CACD,CAAC,uBAAwB,2BAA2B,CACpD,CACE,4BACA,kFACD,CACD,CACE,qBACA,yEACD,CAED,CACE,yBACA,oEACD,CACD,CACE,oBACA,yDACD,CACD,CACE,0BACA,wFACD,CACD,CACE,uBACA,sFACD,CACD,CACE,yBACA,iEACD,CAED,CACE,gCACA,kFACD,CACD,CACE,sBACA,8EACD,CACD,CAAC,qBAAsB,wBAAwB,CAC/C,CACE,mCACA,qHACD,CAED,CAAC,8BAA+B,6CAA6C,CAC7E,CACE,2BACA,yEACD,CACD,CACE,wBACA,uEACD,CACD,CACE,+BACA,2EACD,CACD,CACE,6BACA,6FACD,CACD,CACE,2BACA,gEACD,CACD,CAAC,qBAAsB,8BAA8B,CACrD,CACE,6BACA,mGACD,CAED,CAAC,qBAAsB,sDAAsD,CAC7E,CACE,yCACA,iHACD,CACD,CACE,wCACA,oGACD,CACD,CACE,6BACA,gGACD,CACD,CAAC,wBAAyB,qBAAqB,CAC/C,CAAC,mBAAoB,4CAA4C,CACjE,CACE,4BACA,oDACD,CACD,CAAC,mBAAoB,gCAAgC,CACrD,CACE,uBACA,6EACD,CACD,CACE,iCACA,iEACD,CACD,CACE,2BACA,2EACD,CAED,CAAC,mBAAoB,sCAAsC,CAC3D,CAAC,kBAAmB,yDAAyD,CAC7E,CAAC,wBAAyB,gDAAgD,CAC1E,CAAC,4BAA6B,8CAA8C,CAC5E,CACE,2BACA,2IACD,CACD,CAAC,6BAA8B,sCAAsC,CAErE,CACE,2BACA,4EACD,CACD,CACE,4BACA,uDACD,CACD,CACE,8BACA,sEACD,CACD,CACE,gCACA,wEACD,CACD,CAAC,2BAA4B,qCAAqC,CAClE,CACE,uCACA,kEACD,CACD,CACE,8CACA,4FACD,CACD,CACE,2BACA,iFACD,CACD,CAAC,qBAAsB,sBAAsB,CAC7C,CAAC,qBAAsB,qCAAqC,CAC5D,CACE,sBACA,+HACD,CACD,CACE,mCACA,sGACD,CACD,CACE,+BACA,2EACD,CACD,CACE,+BACA,4DACD,CAED,CACE,mCACA,gEACD,CACD,CACE,gCACA,6DACD,CACD,CACE,mCACA,gEACD,CACD,CACE,+BACA,4DACD,CACD,CACE,6BACA,0DACD,CACD,CACE,qBACA,gIACD,CACD,CACE,wBACA,iEACD,CACD,CACE,gCACA,kEACD,CACD,CAAC,qBAAsB,qDAAqD,CAC5E,CACE,sBACA,yGACD,CACD,CACE,qBACA,qEACD,CACD,CACE,6BACA,yHACD,CACD,CAAC,yBAA0B,sCAAsC,CACjE,CACE,2BACA,uDACD,CACD,CACE,uBACA,8EACD,CACD,CAAC,oBAAqB,qDAAqD,CAC3E,CACE,uBACA,qFACD,CACD,CAAC,wBAAyB,kDAAkD,CAC5E,CACE,qBACA,2DACD,CACD,CACE,qBACA,2EACD,CACD,CACE,sCACA,kEACD,CACD,CACE,qCACA,kFACD,CACD,CAAC,wBAAyB,sBAAsB,CAChD,CACE,4BACA,iFACD,CACD,CACE,sBACA,8FACD,CACD,CACE,sBACA,iGACD,CACD,CACE,uBACA,2DACD,CACD,CACE,6BACA,8IACD,CACD,CACE,yBACA,+EACD,CACD,CAAC,4BAA6B,4CAA4C,CAC1E,CACE,wBACA,iFACD,CACD,CACE,wBACA,iEACD,CACD,CACE,uBACA,yGACD,CACD,CACE,yBACA,wIACD,CACD,CACE,oBACA,2GACD,CACD,CACE,sBACA,uHACD,CACD,CACE,qBACA,0DACD,CACD,CAAC,qBAAsB,iDAAiD,CACxE,CAAC,yBAA0B,gCAAgC,CAC3D,CAAC,6BAA8B,iBAAiB,CAChD,CAAC,4BAA6B,eAAe,CAC7C,CAAC,uBAAwB,uBAAuB,CAChD,CAAC,sBAAuB,SAAS,CACjC,CAAC,2BAA4B,sBAAsB,CACnD,CAAC,kCAAmC,qBAAqB,CACzD,CAAC,uBAAwB,iBAAiB,CAC1C,CAAC,8BAA+B,iBAAiB,CACjD,CAAC,2BAA4B,cAAc,CAC3C,CAAC,wBAAyB,kBAAkB,CAC5C,CAAC,qBAAsB,2BAA2B,CAClD,CAAC,6BAA8B,iBAAiB,CAChD,CAAC,6BAA8B,iBAAiB,CAChD,CAAC,uCAAwC,kBAAkB,CAC3D,CAAC,sCAAuC,kBAAkB,CAC1D,CAAC,kBAAmB,kBAAkB,CACtC,CAAC,oBAAqB,yBAAyB,CAC/C,CACE,uBACA,sHACD,CACD,CAAC,0BAA2B,6BAA6B,CACzD,CACE,2CACA,uEACD,CACD,CACE,yCACA,mHACD,CACD,CACE,wCACA,uHACD,CACD,CACE,uBACA,yDACD,CACD,CACE,uBACA,+DACD,CACD,CACE,kCACA,2EACD,CACD,CACE,gCACA,qHACD,CACD,CACE,kCACA,iEACD,CACD,CACE,sCACA,oFACD,CACD,CACE,iCACA,mDACD,CACD,CACE,0BACA,yGACD,CACD,CACE,qCACA,oJACD,CACD,CACE,iBACA,6KACD,CACD,CACE,0BACA,wGACD,CACD,CACE,gCACA,2EACD,CACD,CACE,gCACA,4CACD,CACD,CACE,iCACA,0FACD,CACD,CACE,+BACA,6LACD,CACD,CACE,sBACA,8KACD,CACD,CACE,yBACA,CACE,8GACA,+EACD,CACF,CACD,CACE,6BACA,2DACD,CAED,CAAC,sBAAuB,qDAAqD,CAC7E,CACE,uBACA,4DACD,CACD,CACE,mCACA,gHACD,CACD,CACE,6BACA,mGACD,CACD,CACE,gCACA,CACE,oDACA,mDACA,kDACD,CACF,CACD,CACE,0BACA,6DACD,CACD,CACE,wBACA,4FACD,CACD,CAAC,4BAA6B,+CAA+C,CAC7E,CACE,0BACA,mDACD,CACD,CACE,6BACA,8FACD,CACD,CAAC,2BAA4B,6CAA6C,CAC1E,CAAC,0BAA2B,+CAA+C,CAE3E,CACE,6BACA,uGACD,CACD,CAAC,+BAAgC,4BAA4B,CAC7D,CAAC,uBAAwB,wCAAwC,CACjE,CACE,2BACA,6FACD,CACD,CAAC,sBAAuB,4BAA4B,CACpD,CACE,2BACA,wDACD,CACD,CACE,iCACA,4EACD,CACD,CACE,8BACA,sFACD,CACD,CAAC,yBAA0B,+BAA+B,CAC1D,CACE,+CACA,kGACD,CACD,CACE,mDACA,sGACD,CACD,CACE,gCACA,oKACD,CACD,CACE,wCACA,gPACD,CACD,CACE,0CACA,8FACD,CACD,CACE,yBACA,qDACD,CACD,CACE,gCACA,yHACD,CACD,CAAC,6BAA8B,mCAAmC,CAClE,CAAC,uBAAwB,wBAAwB,CAEjD,CACE,mCACA,0DACD,CACD,CACE,2BACA,yDACD,CACD,CACE,0BACA,yDACD,CACD,CACE,sBACA,+NACD,CACD,CACE,4BACA,yHACD,CAED,CACE,6BACA,uFACD,CACD,CAAC,8BAA+B,+BAA+B,CAC/D,CAAC,gCAAiC,+BAA+B,CACjE,CACE,wBACA,2FACD,CACD,CACE,2BACA,+FACD,CACD,CACE,gCACA,CACE,qEACA,0GACD,CACF,CACD,CACE,8BACA,CACE,sEACA,uFACD,CACF,CACD,CACE,yBACA,sEACD,CAED,CACE,8BACA,2DACD,CACD,CACE,qBACA,8EACD,CACD,CACE,+BACA,+CACD,CACD,CACE,8BACA,mFACD,CACD,CAAC,8BAA+B,oCAAoC,CACpE,CACE,gCACA,0EACD,CACD,CACE,4BACA,sGACD,CACD,CACE,+BACA,uFACD,CACD,CACE,kCACA,uDACD,CACD,CACE,iCACA,4EACD,CACD,CACE,wBACA,oDACD,CACD,CACE,6BACA,qEACD,CACD,CACE,oCACA,sDACD,CACD,CACE,4BACA,kDACD,CACD,CACE,kBACA,mFACD,CAGD,CAAC,MAAO,WAAW,CACnB,CAAC,MAAO,YAAY,CACpB,CAAC,MAAO,eAAe,CACvB,CAAC,MAAO,eAAe,CACvB,CAAC,MAAO,SAAS,CACjB,CAAC,MAAO,WAAW,CAEnB,CAAC,SAAU,kBAAkB,CAC7B,C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","sources":["<anon>","src/scripts/index.js","src/scripts/utils/polyfills/string.js","src/scripts/utils/logging.js","src/scripts/utils/ringBuffer.js","src/scripts/gameManagement/game.js","src/scripts/utils/game/screen.js","src/scripts/utils/text/fonts.js","src/scripts/utils/geometry.js","src/scripts/utils/maths.js","src/scripts/utils/game/world.js","src/scripts/hud/hud.js","src/scripts/players/actors.js","src/scripts/dnd/interact.js","src/scripts/utils/effects/transient.js","src/scripts/utils/sprites/sprite.js","src/scripts/utils/sprites/spriteRenderers.js","src/scripts/utils/text/text.js","src/scripts/utils/debug.js","src/scripts/utils/sprites/animation.js","src/scripts/utils/sprites/imageManager.js","src/scripts/utils/time/clock.js","src/scripts/utils/arrays/indexer.js","src/scripts/utils/sprites/faders.js","src/scripts/utils/sprites/modifiers.js","src/scripts/utils/sprites/movers.js","src/scripts/utils/dom/ui.js","src/scripts/utils/dom/components.js","src/scripts/utils/game/gameConstants.js","src/scripts/utils/persistentData.js","src/scripts/utils/hashes.js","src/scripts/utils/messageManager.js","src/scripts/gameManagement/animationState.js","src/scripts/utils/soundManager.js","src/scripts/dialogs/actorDialogs.js","src/scripts/players/artefacts.js","src/scripts/utils/game/coins.js","src/scripts/dnd/almanacs/artefactBuilder.js","src/scripts/dnd/traits.js","src/scripts/utils/dice.js","src/scripts/dnd/tables.js","src/scripts/dnd/abilityGenerator.js","src/scripts/dnd/dndAction.js","src/scripts/dnd/magic.js","src/scripts/dnd/almanacs/almanacs.js","src/scripts/dnd/almanacs/almanacUtils.js","src/scripts/utils/assetLoaders.js","src/scripts/gameManagement/sceneManager.js","src/scripts/scriptReaders/sceneDefinitionParser.js","src/scripts/utils/tileMaps/tilePlan.js","src/scripts/utils/arrays/arrayManip.js","src/scripts/utils/tileMaps/tileMap.js","src/scripts/utils/ui/interactions.js","src/scripts/utils/tileMaps/pathFinder.js","src/scripts/constants/canvasStyles.js","src/scripts/gameManagement/turnManager.js","src/scripts/utils/timers.js","src/scripts/dialogs/mainMenu.js","src/scripts/dialogs/settingsDialog.js","src/scripts/dialogs/logDialog.js","src/scripts/utils/fullscreen.js","src/scripts/dialogs/hallOfFameDialogs.js","src/scripts/gameManagement/gameSaver.js","src/scripts/dnd/almanacs/actorBuilder.js","src/scripts/scriptReaders/actorAnimationKeys.js","src/scripts/utils/nameGenerator.js","src/scripts/dnd/toxins.js","src/scripts/dnd/floorNumbering.js","src/scripts/utils/leaderBoard.js","src/scripts/dialogs/guideDialogs.js","src/scripts/utils/text/markdown/markdown.js","src/scripts/utils/text/markdown/parsingWarden.js","src/scripts/utils/text/markdown/base64.js","src/scripts/utils/text/safeEncoder.js","src/assets/assets.js","src/assets/images/dungeon.json","node_modules/@parcel/runtime-js/lib/runtime-b0ac14ee59324195.js","node_modules/@parcel/runtime-js/lib/runtime-021f81f597a62fe5.js","node_modules/@parcel/runtime-js/lib/runtime-18b1c77a894be29f.js","node_modules/@parcel/runtime-js/lib/runtime-fe7c57dda0df2bf1.js","node_modules/@parcel/runtime-js/lib/runtime-45408fa77730c75c.js","node_modules/@parcel/runtime-js/lib/runtime-bef0e08d424e33e8.js","node_modules/@parcel/runtime-js/lib/runtime-ee3156cf98395b15.js","node_modules/@parcel/runtime-js/lib/runtime-5ee19549518b9733.js","node_modules/@parcel/runtime-js/lib/runtime-d79b0f601d2b1e38.js","node_modules/@parcel/runtime-js/lib/runtime-54b58301337373b5.js","node_modules/@parcel/runtime-js/lib/runtime-525b845017bab9a0.js","node_modules/@parcel/runtime-js/lib/runtime-8d973e777b95e5ba.js","node_modules/@parcel/runtime-js/lib/runtime-7c1a616f2c3fbb02.js","node_modules/@parcel/runtime-js/lib/runtime-7640526a09d7080c.js","node_modules/@parcel/runtime-js/lib/runtime-1d18000d63757c7f.js","node_modules/@parcel/runtime-js/lib/runtime-bd4992c9cf4e9e6b.js","node_modules/@parcel/runtime-js/lib/runtime-0cc3cdfce7827fd7.js","node_modules/@parcel/runtime-js/lib/runtime-e0f9a4d72fe131c2.js","node_modules/@parcel/runtime-js/lib/runtime-2774f92f0103eb7e.js","node_modules/@parcel/runtime-js/lib/runtime-c695de27c434cae9.js","node_modules/@parcel/runtime-js/lib/runtime-8c5cf9357317b584.js","node_modules/@parcel/runtime-js/lib/runtime-4181106ff050a22f.js","node_modules/@parcel/runtime-js/lib/runtime-26f9a245fcde6fb5.js","node_modules/@parcel/runtime-js/lib/runtime-015f285d12a82cbb.js","node_modules/@parcel/runtime-js/lib/runtime-77f9eb4a5cf467c8.js","node_modules/@parcel/runtime-js/lib/runtime-332a29828ce38a34.js","node_modules/@parcel/runtime-js/lib/runtime-a96784b7e466d43b.js","node_modules/@parcel/runtime-js/lib/runtime-3b5350ffd36ea3e3.js","node_modules/@parcel/runtime-js/lib/runtime-126fa913e3a4363d.js","node_modules/@parcel/runtime-js/lib/runtime-ab22e2ed65dfd94d.js","node_modules/@parcel/runtime-js/lib/runtime-85c99b0553f8616f.js","node_modules/@parcel/runtime-js/lib/runtime-a40b3dd6bc71378a.js","node_modules/@parcel/runtime-js/lib/runtime-8ae352b1af50a2e4.js","node_modules/@parcel/runtime-js/lib/runtime-9d729935f45d4ab1.js","node_modules/@parcel/runtime-js/lib/runtime-f47a33802649d59a.js","node_modules/@parcel/runtime-js/lib/runtime-64fdc92972025d8c.js","node_modules/@parcel/runtime-js/lib/runtime-41a47141f3a88744.js","src/scripts/constants/autoVersion.js","src/scripts/dialogs/openExitDialogs.js","src/scripts/dialogs/runeQuestionDialog.js","src/scripts/dnd/sequenceGenerator.js","src/scripts/scriptReaders/autoSceneList.js","src/scripts/utils/tileMaps/roomGenerator.js","src/scripts/dnd/almanacs/debugBuilder.js","src/scripts/gameManagement/identifyLimiter.js","src/scripts/scriptReaders/symbolMapping.js","src/scripts/utils/game/scene.js","src/scripts/hud/hudNavSet.js","src/scripts/utils/game/camera.js","src/scripts/dnd/trapCharacteristics.js","src/scripts/dialogs/trapDialogs.js","src/scripts/dialogs/moneyPortalDialog.js","src/scripts/utils/text/emojis.js","src/scripts/utils/dom/pointerActions.js","src/scripts/constants/messageMap.js"],"sourcesContent":["(function () {\n\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\n\n      var $parcel$global =\n        typeof globalThis !== 'undefined'\n          ? globalThis\n          : typeof self !== 'undefined'\n          ? self\n          : typeof window !== 'undefined'\n          ? window\n          : typeof global !== 'undefined'\n          ? global\n          : {};\n  \nvar $parcel$modules = {};\nvar $parcel$inits = {};\n\nvar parcelRequire = $parcel$global[\"parcelRequire3d79\"];\n\nif (parcelRequire == null) {\n  parcelRequire = function(id) {\n    if (id in $parcel$modules) {\n      return $parcel$modules[id].exports;\n    }\n    if (id in $parcel$inits) {\n      var init = $parcel$inits[id];\n      delete $parcel$inits[id];\n      var module = {id: id, exports: {}};\n      $parcel$modules[id] = module;\n      init.call(module.exports, module, module.exports);\n      return module.exports;\n    }\n    var err = new Error(\"Cannot find module '\" + id + \"'\");\n    err.code = 'MODULE_NOT_FOUND';\n    throw err;\n  };\n\n  parcelRequire.register = function register(id, init) {\n    $parcel$inits[id] = init;\n  };\n\n  $parcel$global[\"parcelRequire3d79\"] = parcelRequire;\n}\n\nvar parcelRegister = parcelRequire.register;\n/**\n * @file Main entry point\n *\n * @module index\n */ /**\n * @license See {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n */ /**\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Polyfills\n *\n * @module utils/polyfills/string\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Polyfills and shims for String\n *\n * @module utils/polyfills/string\n *\n * @license GPL-3.0-or-later\n * Create quizzes and lessons from plain text files.\n * Copyright 2023 Steve Butler (henspace.com)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n */ /**\n * Implement replaceAll function if not already implemented.\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replaceAll}\n *\n * @param {string} str - the source string\n * @param {string | RegExp} pattern - the pattern to look for in the source string\n * @param {string} replacement - the replacement\n */ if (!String.prototype.replaceAll) String.prototype.replaceAll = function stringReplaceAll(pattern, replacement) {\n    if (pattern instanceof RegExp) {\n        if (pattern.flags.indexOf(\"g\") < 0) throw new TypeError(\"String.prototype.replaceAll called with a non-global RegExp argument\");\n        return this.replace(pattern, replacement);\n    } else return this.replace(new RegExp(pattern, \"g\"), replacement);\n};\nfunction $54fe67d8c7c00573$var$isLeadingSurrogate(codePoint) {\n    return codePoint >= 0xd800 && codePoint <= 0xdbff;\n}\nfunction $54fe67d8c7c00573$var$isTrailingSurrogate(codePoint) {\n    return codePoint >= 0xdc00 && codePoint <= 0xdfff;\n}\nconst $54fe67d8c7c00573$var$UNICODE_REPLACEMENT = \"\\uFFFD\";\nfunction $54fe67d8c7c00573$export$534a77834069544f(str) {\n    if (!str) return str;\n    let result = \"\";\n    for (const chr of str){\n        const codePoint = chr.codePointAt(0);\n        if ($54fe67d8c7c00573$var$isLeadingSurrogate(codePoint) || $54fe67d8c7c00573$var$isTrailingSurrogate(codePoint)) result += $54fe67d8c7c00573$var$UNICODE_REPLACEMENT; // next character is not a trailing surrogate\n        else result += chr;\n    }\n    return result;\n}\n/**\n * Shim toWellFormed\n */ if (!String.prototype.toWellFormed) String.prototype.toWellFormed = function toWellFormed() {\n    const str = this;\n    if (!str) return str;\n    let result = \"\";\n    for (const chr of str){\n        const codePoint = chr.codePointAt(0);\n        if ($54fe67d8c7c00573$var$isLeadingSurrogate(codePoint) || $54fe67d8c7c00573$var$isTrailingSurrogate(codePoint)) result += $54fe67d8c7c00573$var$UNICODE_REPLACEMENT; // next character is not a trailing surrogate\n        else result += chr;\n    }\n    return result;\n};\n\n\n/**\n * @file Handle logging. This allows easier access to logs on mobile devices.\n *\n * @module utils/logging\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Simple ring buffer\n *\n * @module utils/ringBuffer\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ class $fda7ae6f45ae8cfc$export$575ef0eeec6e42f5 {\n    /** @type {number} */ #indexIn;\n    /** @type {number} */ #indexOut;\n    /** @type {number} */ #size;\n    /** @type {Array.<*>} */ #data;\n    /**\n   * Create ring buffer\n   * @param {number} size\n   */ constructor(size){\n        this.#size = size;\n        this.#indexIn = 0;\n        this.#indexOut = 0;\n        this.#data = [];\n    }\n    /**\n   * Clear all\n   */ clear() {\n        this.#data = [];\n        this.#indexIn = 0;\n        this.#indexOut = 0;\n    }\n    /**\n   * Add item to the buffer.\n   * @param {*} item\n   */ add(item) {\n        this.#data[this.#indexIn] = item;\n        this.#indexIn = this.#incIndex(this.#indexIn);\n        if (this.#indexIn === this.#indexOut) this.#indexOut = this.#incIndex(this.#indexOut);\n    }\n    /** Get all the items from the buffer.\n   * @returns {Array.<*>}\n   */ getAll() {\n        const result = [];\n        let out = this.#indexOut;\n        while(out !== this.#indexIn){\n            result.push(this.#data[out]);\n            out = this.#incIndex(out);\n        }\n        return result;\n    }\n    #incIndex(index) {\n        index++;\n        if (index > this.#size) index = 0;\n        return index;\n    }\n}\n\n\n/**\n * @typedef {number} LogTypeValue\n */ /**\n * @enum {LogTypeValue}\n */ const $733fb161db426370$var$LogType = {\n    LOG: 0,\n    INFO: 1,\n    DEBUG: 2,\n    ERROR: 3\n};\n/**\n * Only info and errors are recorded.\n * @type {RingBuffer<LogEntry>}\n */ let $733fb161db426370$var$messages = new (0, $fda7ae6f45ae8cfc$export$575ef0eeec6e42f5)(50);\n/** Add listener for syntax errors. */ window.addEventListener(\"error\", (event)=>{\n    alert(`ERROR: ${event.filename}; line ${event.lineno}\\n${event.message}\\n:Stack:\\n${event.error.stack}`);\n});\n/**\n * Add data to messages.\n * @param {*} data\n */ function $733fb161db426370$var$addDataToMessages(data, logType) {\n    let prefix;\n    switch(logType){\n        case $733fb161db426370$var$LogType.DEBUG:\n            prefix = \":-/ \";\n            break;\n        case $733fb161db426370$var$LogType.INFO:\n            prefix = \"(i) \";\n            break;\n        case $733fb161db426370$var$LogType.ERROR:\n            prefix = \"/! \";\n            break;\n        case $733fb161db426370$var$LogType.LOG:\n        default:\n            prefix = \"\";\n            break;\n    }\n    for (const item of data)$733fb161db426370$var$messages.add(`${prefix}${item}`);\n}\n/**\n * Log information.\n * @param  {...any} data\n */ function $733fb161db426370$var$logGeneral(...data) {\n    console.log(...data);\n//addDataToMessages(LogType.LOG);\n}\n/**\n * Log information.\n * @param  {...any} data\n */ function $733fb161db426370$var$logInfo(...data) {\n    console.info(...data);\n    $733fb161db426370$var$addDataToMessages(data, $733fb161db426370$var$LogType.INFO);\n}\n/**\n * Log information.\n * @param  {...any} data\n */ function $733fb161db426370$var$logDebug(...data) {\n    console.debug(...data);\n//addDataToMessages(data, LogType.DEBUG);\n}\n/**\n * Log error information.\n * @param  {...any} data\n */ function $733fb161db426370$var$logError(...data) {\n    console.error(...data);\n    $733fb161db426370$var$addDataToMessages(data, $733fb161db426370$var$LogType.ERROR);\n}\n/**\n * Log error information.\n * @param  {Error}} data\n */ function $733fb161db426370$var$logFatal(error) {\n    console.error(error);\n    let message;\n    if (error.message) message = `${error.message}\\nStack:\\n${error.stack}`;\n    else message = error;\n    alert(`Fatal error: ${message}\\nPrevious errors:\\n${$733fb161db426370$var$messages.join(\"\\n\")}`);\n    $733fb161db426370$var$addDataToMessages(message, $733fb161db426370$var$LogType.ERROR);\n}\n/**\n * Get the messages.\n * @returns {string[]}\n */ function $733fb161db426370$var$getAll() {\n    return $733fb161db426370$var$messages.getAll();\n}\n/**\n * Object to access logging routines.\n */ const $733fb161db426370$var$LOG = {\n    log: $733fb161db426370$var$logGeneral,\n    info: $733fb161db426370$var$logInfo,\n    debug: $733fb161db426370$var$logDebug,\n    error: $733fb161db426370$var$logError,\n    fatal: $733fb161db426370$var$logFatal,\n    getMessages: $733fb161db426370$var$getAll\n};\nvar $733fb161db426370$export$2e2bcd8739ae039 = $733fb161db426370$var$LOG;\n\n\n/**\n * @file The main game. This is a singleton as there can only be a single game.\n *\n * @module gameManagement/game\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Utilities for handling the screen size. The screen is implemented as\n * a singleton.\n * The game is configured as a world and a screen. The screen is the area that is\n * rendered with a canvas. The world is the total space in which objects can\n * exist. The world is potentially unbounded.\n *\n * The canvas is set to the same size as the screen and then the canvas is\n * resized to fit the display using CSS.\n *\n * The canvas is centred on the camera, so although the canvas rect and screen\n * rect are the same size, the screen always has its top left at 0, 0 in the world\n * whereas the canvas rect may effectively move around the world.\n *\n * @module utils/screen\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Font data\n *\n * @module utils/text/fonts\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ const $0aabe9055399f474$var$baseSize = 15; // minimum pixel size\n/*\n * These should be replicated in the CSS.\n */ const $0aabe9055399f474$var$H1_FONT_SCALE = 2.0;\nconst $0aabe9055399f474$var$H2_FONT_SCALE = 1.5;\nconst $0aabe9055399f474$var$H3_FONT_SCALE = 1.2;\nconst $0aabe9055399f474$var$NORMAL_FONT = \"'UnifrakturCook', cursive\"; // cspell:disable-line\nconst $0aabe9055399f474$var$HEADING_FONT = \"'UnifrakturCook', cursive\"; // cspell:disable-line\nconst $0aabe9055399f474$var$EMOJI_SPRITE_FONT = \"'UnifrakturCook', cursive\"; // cspell:disable-line\n/**\n * @typedef {Object} TextInfo\n * @property {number} size\n * @property {string} fontName\n */ /**\n * Named styles.\n * @type {Object.<String, TextInfo>}\n */ const $0aabe9055399f474$var$textInfo = {\n    normal: {\n        size: 15,\n        fontName: $0aabe9055399f474$var$NORMAL_FONT\n    },\n    h1: {\n        size: 30,\n        fontName: $0aabe9055399f474$var$HEADING_FONT\n    },\n    h2: {\n        size: 22,\n        fontName: $0aabe9055399f474$var$HEADING_FONT\n    },\n    h3: {\n        size: 18,\n        fontName: $0aabe9055399f474$var$HEADING_FONT\n    },\n    emojiSprite: {\n        size: 18,\n        fontName: $0aabe9055399f474$var$EMOJI_SPRITE_FONT\n    }\n};\nfunction $0aabe9055399f474$export$a0412074baa65d25(designWidth) {\n    $0aabe9055399f474$var$textInfo.normal.size = $0aabe9055399f474$var$baseSize + 0.390625 * (designWidth / 100);\n    $0aabe9055399f474$var$textInfo.h1.size = $0aabe9055399f474$var$textInfo.normal.size * $0aabe9055399f474$var$H1_FONT_SCALE;\n    $0aabe9055399f474$var$textInfo.h2.size = $0aabe9055399f474$var$textInfo.normal.size * $0aabe9055399f474$var$H2_FONT_SCALE;\n    $0aabe9055399f474$var$textInfo.h3.size = $0aabe9055399f474$var$textInfo.normal.size * $0aabe9055399f474$var$H3_FONT_SCALE;\n    $0aabe9055399f474$var$textInfo.emojiSprite.size = designWidth / 10;\n}\nfunction $0aabe9055399f474$export$955358618f994a11(styleName) {\n    const info = $0aabe9055399f474$var$textInfo[styleName] ?? $0aabe9055399f474$var$textInfo[\"normal\"];\n    return `${info.size}px ${info.fontName}`;\n}\nfunction $0aabe9055399f474$export$ef86e9b1c847b692() {\n    return $0aabe9055399f474$var$textInfo.normal.size;\n}\n\n\n/**\n * @file Functions for dealing with geometry\n *\n * @module utils/geometry\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Maths utilities\n *\n * @module utils/maths\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * Common angles\n */ const $95fc563048a48bb6$export$ba4266c4aaf6740c = {\n    DEG_22_5: 1 / 8 * Math.PI,\n    DEG_45: 2 / 8 * Math.PI,\n    DEG_67_5: 3 / 8 * Math.PI,\n    DEG_90: 0.5 * Math.PI,\n    DEG_112_5: 5 / 8 * Math.PI,\n    DEG_135: 6 / 8 * Math.PI,\n    DEG_157_7: 7 / 8 * Math.PI,\n    DEG_180: Math.PI\n};\nfunction $95fc563048a48bb6$export$e0b576e7a74416cd(value, min, max) {\n    if (value < min) return min;\n    else if (value > max) return max;\n    return value;\n}\nconst $95fc563048a48bb6$export$624e7ee3f0468367 = {\n    NONE: -1,\n    N: 0,\n    NE: 1,\n    E: 2,\n    SE: 3,\n    S: 4,\n    SW: 5,\n    W: 6,\n    NW: 7\n};\nfunction $95fc563048a48bb6$export$cf2deb104c051cb7(angle) {\n    const absAngle = Math.abs(angle);\n    if (absAngle <= $95fc563048a48bb6$export$ba4266c4aaf6740c.DEG_45) return $95fc563048a48bb6$export$624e7ee3f0468367.E;\n    if (absAngle <= $95fc563048a48bb6$export$ba4266c4aaf6740c.DEG_135) return Math.sign(angle) > 0 ? $95fc563048a48bb6$export$624e7ee3f0468367.N : $95fc563048a48bb6$export$624e7ee3f0468367.S;\n    return $95fc563048a48bb6$export$624e7ee3f0468367.W;\n}\nfunction $95fc563048a48bb6$export$d9ac11c8e8c20b77(angle) {\n    const absAngle = Math.abs(angle);\n    if (absAngle <= $95fc563048a48bb6$export$ba4266c4aaf6740c.DEG_22_5) return $95fc563048a48bb6$export$624e7ee3f0468367.E;\n    if (absAngle <= $95fc563048a48bb6$export$ba4266c4aaf6740c.DEG_67_5) return Math.sign(angle) > 0 ? $95fc563048a48bb6$export$624e7ee3f0468367.NE : $95fc563048a48bb6$export$624e7ee3f0468367.SE;\n    if (absAngle <= $95fc563048a48bb6$export$ba4266c4aaf6740c.DEG_112_5) return Math.sign(angle) > 0 ? $95fc563048a48bb6$export$624e7ee3f0468367.N : $95fc563048a48bb6$export$624e7ee3f0468367.S;\n    if (absAngle <= $95fc563048a48bb6$export$ba4266c4aaf6740c.DEG_157_7) return Math.sign(angle) > 0 ? $95fc563048a48bb6$export$624e7ee3f0468367.NW : $95fc563048a48bb6$export$624e7ee3f0468367.SW;\n    return $95fc563048a48bb6$export$624e7ee3f0468367.W;\n}\nfunction $95fc563048a48bb6$export$b141de964f0a90c1(min, max) {\n    const minCeiled = Math.ceil(min);\n    const maxFloored = Math.floor(max);\n    return Math.floor(Math.random() * (maxFloored - minCeiled) + minCeiled);\n}\nfunction $95fc563048a48bb6$export$a885de3766ef0b4c(array) {\n    const index = $95fc563048a48bb6$export$b141de964f0a90c1(0, array.length);\n    return array[index];\n}\nfunction $95fc563048a48bb6$export$75c671db1a13cf5f(min, max) {\n    const minCeiled = Math.ceil(min);\n    const maxFloored = Math.floor(max);\n    return Math.floor(Math.random() * (maxFloored - minCeiled + 1) + minCeiled);\n}\nfunction $95fc563048a48bb6$export$8ebf337bfea5f957(valueA, valueB, tolerance) {\n    return valueA - valueB < tolerance;\n}\nfunction $95fc563048a48bb6$export$77419d14798a5605(value, tolerance) {\n    return Math.abs(value) < tolerance;\n}\nfunction $95fc563048a48bb6$export$d6c5c82e8e696750(value, defValue = 0, radix) {\n    const result = parseInt(value, radix);\n    return Number.isNaN(result) ? defValue : result;\n}\nfunction $95fc563048a48bb6$export$437ba3be5ce2ff51(value, defValue = 0) {\n    const result = parseFloat(value);\n    return Number.isNaN(result) ? defValue : result;\n}\n\n\nclass $9181799b149b64a5$export$baf26146a414f24a {\n    /** @type {number}*/ x;\n    /** @type {number}*/ y;\n    /**\n   * Create point\n   * @param {number} x\n   * @param {number} y\n   */ constructor(x, y){\n        this.x = x;\n        this.y = y;\n    }\n    /**\n   * Create a copy of a point.\n   * @param {Point} point\n   * @returns {Point}\n   */ static copy(point) {\n        return new $9181799b149b64a5$export$baf26146a414f24a(point.x, point.y);\n    }\n    /**\n   * Check if points are coincident.\n   * @returns {boolean}\n   */ coincident(point) {\n        return this.x === point.x && this.y === point.y;\n    }\n    /**\n   * Get angle to target using normal cartesian coordinates; i.e up is +ve y.\n   * @param {Point} targetPos\n   * @returns {number} angle in radians.\n   */ getCartesianAngleTo(targetPos) {\n        return Math.atan2(targetPos.y - this.y, targetPos.x - this.x);\n    }\n    /**\n   * Get angle to target using normal screen coordinates; i.e down is +ve y.\n   * @param {Point} targetPos\n   * @returns {number} angle in radians.\n   */ getScreenAngleTo(targetPos) {\n        return Math.atan2(this.y - targetPos.y, targetPos.x - this.x);\n    }\n    /**\n   * String representation which can be used as key in maps.\n   * @returns {string}\n   */ toString() {\n        return `(${this.x},${this.y})`;\n    }\n    /**\n   * Test if the position is at the same point, rounded to integer as this.\n   * Rotation is ignored.\n   * @param {Position} position\n   * @returns {boolean}\n   */ isCoincident(position) {\n        return Math.round(this.x) === Math.round(position.x) && Math.round(this.y) === Math.round(position.y);\n    }\n    /**\n   * Test if points are adjacent, i.e within one\n   * @param {Point} other\n   * @param {number} distance\n   * @returns {boolean}\n   */ isOtherClose(other, distance) {\n        const dx = this.x - other.x;\n        const dy = this.y - other.y;\n        return Math.pow(dx, 2) + Math.pow(dy, 2) <= Math.pow(distance, 2);\n    }\n    /**\n   * Get the absolute orthogonal separation between this and the other point.\n   * The separation is calculated by move in the x direction followed by the\n   * y direction. I.e. no diagonal movement.\n   * @param {Point} other\n   * @returns {number}\n   */ getOrthoSeparation(other) {\n        return Math.abs(this.x - other.x) + Math.abs(this.y - other.y);\n    }\n}\nclass $9181799b149b64a5$export$4a23b3811cef465 {\n    /** x velocity @type {number} */ x;\n    /** y velocity @type {number} */ y;\n    /** rotational velocity @type {number} */ rotation;\n    /**\n   *\n   * @param {number} velX\n   * @param {number} velY\n   * @param {number} velRot\n   */ constructor(velX, velY, velRot){\n        this.x = velX;\n        this.y = velY;\n        this.rotation = velRot;\n    }\n    /**\n   * Get the angle in radians counterclockwise from x axis. This uses cartesian\n   * coordinates where the y axis is positive upwards.\n   * @returns {number}\n   */ getCartesianDirection() {\n        return Math.atan2(this.y, this.x);\n    }\n    /**\n   * Get the angle in radians counterclockwise from x axis. This uses screen\n   * coordinates where the y axis is positive downwards..\n   * @returns {number}\n   */ getScreenDirection() {\n        return Math.atan2(-this.y, this.x);\n    }\n    /**\n   * Test if velocity effectively zero.\n   * @param {number} tolerance\n   * @returns {boolean}\n   */ isZero(tolerance) {\n        return $95fc563048a48bb6$export$77419d14798a5605(this.x, tolerance) && $95fc563048a48bb6$export$77419d14798a5605(this.y, tolerance);\n    }\n}\nclass $9181799b149b64a5$export$5086e02bc6b47824 {\n    /** x velocity @type {number} */ x;\n    /** y velocity @type {number} */ y;\n    /** rotational velocity @type {number} */ rotation;\n    /**\n   *\n   * @param {number} velX\n   * @param {number} velY\n   * @param {number} velRot\n   */ constructor(velX, velY, velRot){\n        this.x = velX;\n        this.y = velY;\n        this.rotation = velRot;\n    }\n}\nclass $9181799b149b64a5$export$13807d9ee5a34a42 extends $9181799b149b64a5$export$baf26146a414f24a {\n    /** type {number} */ rotation;\n    /**\n   *\n   * @param {number} x\n   * @param {number} y\n   * @param {number} rotation\n   */ constructor(x, y, rotation){\n        super(x, y);\n        this.y = y;\n        this.rotation = rotation;\n    }\n    /**\n   * Create a Position from a Point.\n   * @param {Point} point\n   * @returns {Position}\n   */ static fromPoint(point) {\n        return new $9181799b149b64a5$export$13807d9ee5a34a42(point.x, point.y, 0);\n    }\n    /**\n   * Create copy\n   * @param {Position} position\n   */ static copy(position) {\n        return new $9181799b149b64a5$export$13807d9ee5a34a42(position.x, position.y, position.rotation);\n    }\n    /** Get a new position representing this position relative to a new origin.\n   * @param {Position} origin\n   * @returns {Position}\n   */ getRelativeTo(origin) {\n        return new $9181799b149b64a5$export$13807d9ee5a34a42(this.x - origin.x, this.y - origin.y, this.rotation - origin.rotation);\n    }\n    /**\n   * Test that both x and y coordinates are within the length.\n   * @param {Position} targetPos\n   * @param {number} length\n   * @returns {boolean}\n   */ withinSquare(targetPos, length) {\n        return Math.abs(targetPos.x - this.x) < length && Math.abs(targetPos.y - this.y) < length;\n    }\n}\nclass $9181799b149b64a5$export$4617fb02663045ef {\n    /** @type {number} */ x;\n    /** @type {number} */ y;\n    /** @type {number} */ width;\n    /** @type {number} */ height;\n    /**\n   *\n   * @param {number} x\n   * @param {number} y\n   * @param {number} width\n   * @param {number} height\n   */ constructor(x, y, width, height){\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n    /** Get the bottom right\n   * @returns {Point}\n   */ getBottomRight() {\n        return new $9181799b149b64a5$export$baf26146a414f24a(this.x + this.width, this.y + this.height);\n    }\n    /** Get the top left\n   * @returns {Point}\n   */ getTopLeft() {\n        return new $9181799b149b64a5$export$baf26146a414f24a(this.x, this.y);\n    }\n    /**\n   * Test if this overlaps another rectangle\n   * @param {Rectangle} otherRect\n   * @returns {boolean} true if overlapping.\n   */ overlaps(otherRect) {\n        const myBR = this.getBottomRight();\n        const otherRectBR = otherRect.getBottomRight();\n        const noOverlap = otherRect.x > myBR.x || otherRect.y > myBR.y || otherRectBR.x < this.x || otherRectBR.y < this.y;\n        return !noOverlap;\n    }\n    /**\n   * Test if this rectangle contains a point\n   * @param {Point | Position} point\n   * @returns {boolean} - true if point contained\n   */ containsPoint(point) {\n        return point.x >= this.x && point.x <= this.x + this.width && point.y >= this.y && point.y <= this.y + this.height;\n    }\n    /**\n   * Test if this rectangle contains a coordinate\n   * @param {number} x\n   * @param {number} y\n   * @returns {boolean} - true if point contained\n   */ containsCoordinate(x, y) {\n        return x >= this.x && x <= this.x + this.width && y >= this.y && y <= this.y + this.height;\n    }\n    /**\n   * Test if this rectangle equals another.\n   * @param {Rectangle} otherRect\n   * @returns {boolean}\n   */ equals(other) {\n        return this.x === other.x && this.y === other.y && this.width === other.width && this.height === other.height;\n    }\n}\nconst $9181799b149b64a5$export$ffabdd03f47fc732 = new $9181799b149b64a5$export$baf26146a414f24a(Number.MIN_VALUE, Number.MIN_VALUE);\nconst $9181799b149b64a5$export$9bb5b4b8c6114d78 = new $9181799b149b64a5$export$baf26146a414f24a(Number.MAX_VALUE, Number.MAX_VALUE);\n\n\n\n/**\n * @typedef {Object} ScreenDetails\n * @property {HTMLCanvasElement} canvas\n * @property {number} width\n * @property {number} height\n * @property {number} x\n * @property {number} y\n */ let $7aed85f370071bde$var$throttleTimer = null;\nlet $7aed85f370071bde$var$canvas = null;\nlet $7aed85f370071bde$var$canvasRect = null;\nlet $7aed85f370071bde$var$canvasHalfWidth = 0;\nlet $7aed85f370071bde$var$canvasHalfHeight = 0;\nlet $7aed85f370071bde$var$canvasAlpha = true;\nlet $7aed85f370071bde$var$visibleCanvasRect = null;\nlet $7aed85f370071bde$var$gameElement = null;\nlet $7aed85f370071bde$var$left = 0;\nlet $7aed85f370071bde$var$top = 0;\n//let screenRect;\nlet $7aed85f370071bde$var$scale = 1;\nlet $7aed85f370071bde$var$maxScale = 1;\nlet $7aed85f370071bde$var$minScale = 0.1;\nlet $7aed85f370071bde$var$sizingMethod = \"COVER\";\nlet $7aed85f370071bde$var$cameraPosition = new (0, $9181799b149b64a5$export$13807d9ee5a34a42)(0, 0, 0);\n/**\n * Add event listener to handle resizing of the window.\n */ window.addEventListener(\"resize\", ()=>{\n    if ($7aed85f370071bde$var$throttleTimer !== null) return; // it will get handled.\n    $7aed85f370071bde$var$throttleTimer = window.setTimeout(()=>{\n        $7aed85f370071bde$var$resize();\n        $7aed85f370071bde$var$throttleTimer = null;\n    }, 200);\n});\n/**\n * Get dimensions of the working area for the game.\n * @returns {module:utils/geometry~Dims2D}\n */ function $7aed85f370071bde$var$getDisplayDims() {\n    return {\n        width: window.innerWidth,\n        height: window.innerHeight\n    };\n}\n/**\n * @param {Object} options - config options.\n * @param {number} options.width - the design width for the screen.\n * @param {number} options.height - the design height for the page.\n * @param {number} options.maxScale - maximum scaling allowed\n * @param {string} options.sizingMethod  - 'FIT' or 'COVER'. Defaults to 'FIT'\n * @param {boolean} options.alpha - Should canvas have an alpha channel\n */ function $7aed85f370071bde$var$setOptions(options) {\n    if ($7aed85f370071bde$var$canvas) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Multiple calls to setScreen ignored.\");\n        return;\n    }\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Max canvas scaling set to ${options.maxScale}.`);\n    $7aed85f370071bde$var$gameElement = document?.getElementById(\"game-content\");\n    if (!$7aed85f370071bde$var$gameElement) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"No game element so assuming running as Jest test. No ui\");\n        return;\n    }\n    $7aed85f370071bde$var$gameElement.replaceChildren();\n    $0aabe9055399f474$export$a0412074baa65d25(options.width);\n    $7aed85f370071bde$var$canvas = document.createElement(\"canvas\");\n    $7aed85f370071bde$var$canvas.id = \"game-canvas\";\n    $7aed85f370071bde$var$canvas.setAttribute(\"width\", options.width);\n    $7aed85f370071bde$var$canvas.setAttribute(\"height\", options.height);\n    $7aed85f370071bde$var$canvas.innerText = \"Loading the app.\";\n    $7aed85f370071bde$var$canvasRect = new (0, $9181799b149b64a5$export$4617fb02663045ef)(0, 0, options.width, options.height);\n    $7aed85f370071bde$var$canvasHalfWidth = options.width / 2;\n    $7aed85f370071bde$var$canvasHalfHeight = options.height / 2;\n    $7aed85f370071bde$var$gameElement.appendChild($7aed85f370071bde$var$canvas);\n    $7aed85f370071bde$var$maxScale = options.maxScale;\n    $7aed85f370071bde$var$minScale = options.minScale;\n    $7aed85f370071bde$var$sizingMethod = options.sizingMethod;\n    $7aed85f370071bde$var$canvasAlpha = options.alpha;\n    $7aed85f370071bde$var$setVhCssVariable();\n    $7aed85f370071bde$var$sizeScreen();\n    $7aed85f370071bde$var$syncDomFonts();\n}\n/**\n * Size the screen\n * @param {number} aspectRatio - aspect ratio (width / height) of the screen\n * @param {number} windowAspectRatio - aspect ratio (width / height) of the screen\n * @param {string} method - FIT or COVER. Defaults to FIT\n */ function $7aed85f370071bde$var$shouldFitHeight(aspectRatio, windowAspectRatio, sizingMethod) {\n    if (sizingMethod === \"COVER\") return aspectRatio > windowAspectRatio;\n    else return aspectRatio < windowAspectRatio;\n}\n/**\n * Resize the screen according to the current inner window dimensions.\n */ function $7aed85f370071bde$var$sizeScreen() {\n    const dims = $7aed85f370071bde$var$getDisplayDims();\n    let aspectRatio = $7aed85f370071bde$var$canvasRect.width / $7aed85f370071bde$var$canvasRect.height;\n    let displayedHeight = 0;\n    let displayedWidth = 0;\n    const windowAspectRatio = dims.width / dims.height;\n    const fitHeight = $7aed85f370071bde$var$shouldFitHeight(aspectRatio, windowAspectRatio, $7aed85f370071bde$var$sizingMethod);\n    if (fitHeight) {\n        displayedHeight = dims.height;\n        displayedWidth = displayedHeight * aspectRatio;\n    } else {\n        displayedWidth = dims.width;\n        displayedHeight = displayedWidth / aspectRatio;\n    }\n    $7aed85f370071bde$var$scale = displayedWidth / $7aed85f370071bde$var$canvasRect.width;\n    if ($7aed85f370071bde$var$scale > $7aed85f370071bde$var$maxScale) {\n        $7aed85f370071bde$var$scale = $7aed85f370071bde$var$maxScale;\n        displayedWidth = $7aed85f370071bde$var$scale * $7aed85f370071bde$var$canvasRect.width;\n        displayedHeight = $7aed85f370071bde$var$scale * $7aed85f370071bde$var$canvasRect.height;\n    } else if ($7aed85f370071bde$var$scale < $7aed85f370071bde$var$minScale) {\n        $7aed85f370071bde$var$scale = $7aed85f370071bde$var$minScale;\n        displayedWidth = $7aed85f370071bde$var$scale * $7aed85f370071bde$var$canvasRect.width;\n        displayedHeight = $7aed85f370071bde$var$scale * $7aed85f370071bde$var$canvasRect.height;\n    }\n    $7aed85f370071bde$var$left = (dims.width - displayedWidth) / 2;\n    $7aed85f370071bde$var$top = (dims.height - displayedHeight) / 2;\n    $7aed85f370071bde$var$canvas.style.left = `${$7aed85f370071bde$var$left}px`;\n    $7aed85f370071bde$var$canvas.style.top = `${$7aed85f370071bde$var$top}px`;\n    $7aed85f370071bde$var$canvas.style.width = `${displayedWidth}px`;\n    $7aed85f370071bde$var$canvas.style.height = `${displayedHeight}px`;\n    let visibleCanvasWidth;\n    let visibleCanvasHeight;\n    let visibleCanvasOffsetX;\n    let visibleCanvasOffsetY;\n    if ($7aed85f370071bde$var$left < 0) {\n        visibleCanvasOffsetX = -$7aed85f370071bde$var$left / $7aed85f370071bde$var$scale;\n        visibleCanvasWidth = dims.width / $7aed85f370071bde$var$scale;\n    } else {\n        visibleCanvasOffsetX = 0;\n        visibleCanvasWidth = $7aed85f370071bde$var$canvasRect.width;\n    }\n    if ($7aed85f370071bde$var$top < 0) {\n        visibleCanvasOffsetY = -$7aed85f370071bde$var$top / $7aed85f370071bde$var$scale;\n        visibleCanvasHeight = dims.height / $7aed85f370071bde$var$scale;\n    } else {\n        visibleCanvasOffsetY = 0;\n        visibleCanvasHeight = $7aed85f370071bde$var$canvasRect.height;\n    }\n    $7aed85f370071bde$var$visibleCanvasRect = new (0, $9181799b149b64a5$export$4617fb02663045ef)(visibleCanvasOffsetX, visibleCanvasOffsetY, visibleCanvasWidth, visibleCanvasHeight);\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Scale: ${$7aed85f370071bde$var$scale}`);\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Window: width: ${dims.width}, height: ${dims.height}`);\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Display: left: ${$7aed85f370071bde$var$left}, top: ${$7aed85f370071bde$var$top}, width: ${displayedWidth}, height: ${displayedHeight}`);\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Visible canvas: left: ${visibleCanvasOffsetX}, top: ${visibleCanvasOffsetY}, width: ${visibleCanvasWidth}, height: ${visibleCanvasHeight}`);\n}\n/**\n * Adjust the font sizes to ensure glass in sync with canvas.\n */ function $7aed85f370071bde$var$syncDomFonts() {\n    const rootFontSize = $0aabe9055399f474$export$ef86e9b1c847b692() * $7aed85f370071bde$var$scale;\n    document.documentElement.style.fontSize = `${rootFontSize}px`;\n}\n/**\n * Set the vh variable in the CSS. This allows for browsers that include the address bar\n * in the vh calculation.\n */ function $7aed85f370071bde$var$setVhCssVariable() {\n    const vh = window.innerHeight * 0.01;\n    document.documentElement.style.setProperty(\"--vh\", `${vh}px`);\n}\n/**\n * Resize the screen.\n */ function $7aed85f370071bde$var$resize() {\n    $7aed85f370071bde$var$sizeScreen();\n    $7aed85f370071bde$var$syncDomFonts();\n}\n/**\n * @typedef {Object} screenDetails\n * @property {HTMLCanvasElement} canvas\n * @property {number} width - design width\n * @property {number} height - design height\n */ /**\n * Clear the canvas.\n */ function $7aed85f370071bde$var$clearCanvas() {\n    $7aed85f370071bde$var$getContext2D().clearRect(0, 0, $7aed85f370071bde$var$canvasRect.width, $7aed85f370071bde$var$canvasRect.height);\n}\n/**\n * Get the bounds of the world that are plotted in the canvas.\n * @returns {Rectangle}\n */ function $7aed85f370071bde$var$getWorldInCanvasBounds() {\n    return new (0, $9181799b149b64a5$export$4617fb02663045ef)($7aed85f370071bde$var$cameraPosition.x, $7aed85f370071bde$var$cameraPosition.y, $7aed85f370071bde$var$canvasRect.width, $7aed85f370071bde$var$canvasRect.height);\n}\n/**\n * Get canvas dimensions.\n * @returns {Dims2D}\n */ function $7aed85f370071bde$var$getCanvasDimensions() {\n    return {\n        width: $7aed85f370071bde$var$canvasRect.width,\n        height: $7aed85f370071bde$var$canvasRect.height\n    };\n}\n/**\n * Get the canvas context.\n * @returns {CanvasRenderingContext2D}\n */ function $7aed85f370071bde$var$getContext2D() {\n    return $7aed85f370071bde$var$canvas.getContext(\"2d\", {\n        alpha: $7aed85f370071bde$var$canvasAlpha\n    });\n}\n/**\n * @typedef {Object} Closers\n * @property {Element} element - when clicked, this should close a display.\n * @property {number} response - the response returned if this element closed a display.\n */ /**\n * Set the content of the glass layer. OnClick events are added automatically to the\n * closers.\n * @param {HTMLElement} element\n * @param {Object} options\n * @param {Closers[]} options.closers - array of Closers. If not provided then the entire display\n * is used.\n * @param {string} options.className\n * @param {boolean} options.replace - replace current glass\n * @returns {Promise} fulfils to closers.closes value\n */ function $7aed85f370071bde$var$displayOnGlass(element, options) {\n    let glass;\n    if (options.replace) {\n        glass = document.getElementsByClassName(\"glass\")[0];\n        glass?.replaceChildren();\n    }\n    if (!glass) {\n        glass = document.createElement(\"div\");\n        document.body.appendChild(glass);\n        glass.className = \"glass\";\n    }\n    const glassContent = document.createElement(\"div\");\n    glass.appendChild(glassContent);\n    glassContent.className = \"glass-content\";\n    glassContent.appendChild(element);\n    if (options.className) glass.classList.add(options.className);\n    glass.style.display = \"block\";\n    glass.style.opacity = 1;\n    // calculate if content overflows. This is used because of lack of CSS support\n    // for safe in Safari.\n    const contentHeight = glassContent.getBoundingClientRect().height;\n    if (glassContent.scrollHeight > contentHeight) glassContent.classList.add(\"overflow\");\n    const promises = [];\n    if (options.closers && options.closers.length > 0) options.closers.forEach((closer)=>{\n        const promise = new Promise((resolve)=>{\n            closer.element.addEventListener(\"click\", async ()=>{\n                resolve(closer.closes);\n            });\n        });\n        promises.push(promise);\n    });\n    else {\n        const promise = new Promise((resolve)=>glassContent.addEventListener(\"click\", ()=>resolve()));\n        promises.push(promise);\n    }\n    let closingResponse;\n    return Promise.race(promises).then((response)=>{\n        closingResponse = response;\n        return $7aed85f370071bde$var$wipeGlass(glass);\n    }).then(()=>closingResponse);\n}\n/**\n * Clear and close the glass layer. The layer is hidden and it's content removed.\n * @param {Element} glass\n * @returns {Promise} fulfils to undefined. This is to allow opacity transition.\n */ function $7aed85f370071bde$var$wipeGlass(glass) {\n    glass.style.opacity = 0;\n    window.setTimeout(()=>{\n        glass.remove();\n    }, 500);\n    return Promise.resolve();\n}\n/**\n * Pan the camera.\n * @param {number} dx - movement in world units\n * @param {number} dy - movement in world units\n */ function $7aed85f370071bde$var$panCamera(dx, dy) {\n    $7aed85f370071bde$var$cameraPosition.x += dx;\n    $7aed85f370071bde$var$cameraPosition.y += dy;\n}\n/**\n * Centre the canvas on a point\n * @param {Point} point\n */ function $7aed85f370071bde$var$centreCanvasOn(point) {\n    $7aed85f370071bde$var$cameraPosition.x = point.x - $7aed85f370071bde$var$canvasHalfWidth;\n    $7aed85f370071bde$var$cameraPosition.y = point.y - $7aed85f370071bde$var$canvasHalfHeight;\n}\n/**\n * Convert a distance from ui units to world units.\n * @param {number} dist\n * @returns {number}\n */ function $7aed85f370071bde$var$uiToWorld(dist) {\n    return dist / $7aed85f370071bde$var$scale;\n}\n/**\n * Convert a distance from world units to ui units.\n * @param {number} dist\n * @returns {number}\n */ function $7aed85f370071bde$var$worldToUi(dist) {\n    return dist * $7aed85f370071bde$var$scale;\n}\n/**\n * @typedef {Object} MappedPositions\n * @property {Position} canvas - position on the canvas\n * @property {Position} world - position in the world\n */ /**\n * Convert ui Coordinates to world Position\n * @param {number} x  -position in the ui\n * @param {number} y  -position in the ui\n * @returns {MappedPositions} position on the canvas\n */ function $7aed85f370071bde$var$uiCoordsToMappedPositions(x, y) {\n    x = $7aed85f370071bde$var$uiToWorld(x);\n    y = $7aed85f370071bde$var$uiToWorld(y);\n    const canvasPosition = new (0, $9181799b149b64a5$export$13807d9ee5a34a42)(Math.round(x), Math.round(y));\n    const worldPosition = new (0, $9181799b149b64a5$export$13807d9ee5a34a42)(Math.round(x + $7aed85f370071bde$var$cameraPosition.x), Math.round(y + $7aed85f370071bde$var$cameraPosition.y), -$7aed85f370071bde$var$cameraPosition.rotation);\n    return {\n        canvas: canvasPosition,\n        world: worldPosition\n    };\n}\n/**\n * Convert world Position to canvas Position\n * @param {Position} position  -position in the world\n * @returns {Position} position on the canvas\n */ function $7aed85f370071bde$var$worldPositionToCanvas(position) {\n    return new (0, $9181799b149b64a5$export$13807d9ee5a34a42)(position.x - $7aed85f370071bde$var$cameraPosition.x, position.y - $7aed85f370071bde$var$cameraPosition.y, position.rotation);\n}\n/**\n * Convert canvas Position to world Position\n * @param {Position} position  -position on the canvas\n * @returns {Position} position in the world\n */ function $7aed85f370071bde$var$canvasPositionToWorld(position) {\n    return new (0, $9181799b149b64a5$export$13807d9ee5a34a42)(position.x + $7aed85f370071bde$var$cameraPosition.x, position.y + $7aed85f370071bde$var$cameraPosition.y, position.rotation);\n}\n/**\n * Convert glass position to world position. Negative positions are calculated as\n * offsets from the right and bottom of the glass dimensions. Otherwise they are\n * calculated as offsets from the left and top.\n * @returns {Position}\n */ function $7aed85f370071bde$var$glassPositionToWorld(position) {\n    const xOrigin = position.x < 0 ? $7aed85f370071bde$var$visibleCanvasRect.x + $7aed85f370071bde$var$visibleCanvasRect.width : $7aed85f370071bde$var$visibleCanvasRect.x;\n    const yOrigin = position.y < 0 ? $7aed85f370071bde$var$visibleCanvasRect.y + $7aed85f370071bde$var$visibleCanvasRect.height : $7aed85f370071bde$var$visibleCanvasRect.y;\n    let x = xOrigin + position.x;\n    let y = yOrigin + position.y;\n    return $7aed85f370071bde$var$canvasPositionToWorld(new (0, $9181799b149b64a5$export$13807d9ee5a34a42)(x, y, position.rotation));\n}\n/**\n * Test if rectangle on screen.\n * @param {Rectangle} rect\n * @return {boolean} true if on screen\n */ function $7aed85f370071bde$var$isOnScreen(rect) {\n    return rect.overlaps($7aed85f370071bde$var$canvasRect);\n}\n/**\n * Test if rectangle is visible on the canvas.\n * @param {Rectangle} rect - this should have been converted to canvas coordinates\n * @return {boolean} true if on screen\n */ function $7aed85f370071bde$var$isOnCanvas(rect) {\n    return rect.overlaps($7aed85f370071bde$var$canvasRect);\n}\n/**\n * Get the dimensions of the visible canvas.\n * @returns {Rectangle}\n */ function $7aed85f370071bde$var$getVisibleCanvasRect() {\n    return $7aed85f370071bde$var$visibleCanvasRect;\n}\n/**\n * Set the global opacity.\n * @param {number} opacity\n */ function $7aed85f370071bde$var$setOpacity(opacity) {\n    $7aed85f370071bde$var$getContext2D().globalAlpha = opacity;\n}\n/**\n * Screen object\n */ const $7aed85f370071bde$var$SCREEN = {\n    canvasPositionToWorld: $7aed85f370071bde$var$canvasPositionToWorld,\n    centreCanvasOn: $7aed85f370071bde$var$centreCanvasOn,\n    clearCanvas: $7aed85f370071bde$var$clearCanvas,\n    displayOnGlass: $7aed85f370071bde$var$displayOnGlass,\n    getCanvas: ()=>$7aed85f370071bde$var$canvas,\n    getContext2D: $7aed85f370071bde$var$getContext2D,\n    getCanvasDimensions: $7aed85f370071bde$var$getCanvasDimensions,\n    getWorldInCanvasBounds: $7aed85f370071bde$var$getWorldInCanvasBounds,\n    getVisibleCanvasRect: $7aed85f370071bde$var$getVisibleCanvasRect,\n    glassPositionToWorld: $7aed85f370071bde$var$glassPositionToWorld,\n    isOnCanvas: $7aed85f370071bde$var$isOnCanvas,\n    isOnScreen: $7aed85f370071bde$var$isOnScreen,\n    panCamera: $7aed85f370071bde$var$panCamera,\n    resize: $7aed85f370071bde$var$resize,\n    setOpacity: $7aed85f370071bde$var$setOpacity,\n    setOptions: $7aed85f370071bde$var$setOptions,\n    wipeGlass: $7aed85f370071bde$var$wipeGlass,\n    worldPositionToCanvas: $7aed85f370071bde$var$worldPositionToCanvas,\n    worldToUi: $7aed85f370071bde$var$worldToUi,\n    uiCoordsToMappedPositions: $7aed85f370071bde$var$uiCoordsToMappedPositions,\n    uiToWorld: $7aed85f370071bde$var$uiToWorld\n};\nvar $7aed85f370071bde$export$2e2bcd8739ae039 = $7aed85f370071bde$var$SCREEN;\n\n\n/**\n * @file World limitations\n *\n * @module game/world\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @type {TileMap}\n */ let $3f6edc4fdcc84f8a$var$worldTileMap;\n/**\n * @type {Map<string, Sprite>}\n */ const $3f6edc4fdcc84f8a$var$actors = new Map();\n/**\n * @type {Map<string, Sprite>}\n */ const $3f6edc4fdcc84f8a$var$artefacts = new Map();\n/**\n * Sprites that do not interact\n * @type {Map<string, Sprite>}\n */ const $3f6edc4fdcc84f8a$var$passiveSprites = new Map();\n/**\n * Sprites that grow or spawn. These are drawn first.\n * @type {Map<string, Sprite>}\n */ const $3f6edc4fdcc84f8a$var$organicActors = new Map();\n/**\n * Get the world dimensions. The dimensions are based on the worldTileMap size.\n * It defaults to the screen dimensions if no map has been set.\n * @returns {{number, number}} width and height\n */ function $3f6edc4fdcc84f8a$var$getWorldDims() {\n    return $3f6edc4fdcc84f8a$var$worldTileMap ? $3f6edc4fdcc84f8a$var$worldTileMap.getDimensions() : (0, $7aed85f370071bde$export$2e2bcd8739ae039).getCanvasDimensions();\n}\n/**\n * Add a actor to the world.\n * @param {module:players/actors.Actor}\n */ function $3f6edc4fdcc84f8a$var$addActor(target) {\n    if (target.isOrganic()) $3f6edc4fdcc84f8a$var$organicActors.set(target, target);\n    else $3f6edc4fdcc84f8a$var$actors.set(target, target);\n    $3f6edc4fdcc84f8a$var$worldTileMap.moveTileOccupancyGridPoint(target, null, $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(target.position));\n}\n/**\n * Remove actor from the world.\n * @param {module:players/actors.Actor}\n */ function $3f6edc4fdcc84f8a$var$removeActor(target) {\n    const gridPoint = $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(target.position);\n    $3f6edc4fdcc84f8a$var$worldTileMap.deleteOccupancyOfGridPoint(target, gridPoint);\n    if (target.isOrganic()) $3f6edc4fdcc84f8a$var$organicActors.delete(target);\n    else $3f6edc4fdcc84f8a$var$actors.delete(target);\n}\n/**\n * Add a artefact to the world.\n * @param {module:players/actors.Actor}\n */ function $3f6edc4fdcc84f8a$var$addArtefact(target) {\n    $3f6edc4fdcc84f8a$var$artefacts.set(target, target);\n    $3f6edc4fdcc84f8a$var$worldTileMap.moveTileOccupancyGridPoint(target, null, $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(target.position));\n}\n/**\n * Remove artefact from the world.\n * @param {module:players/actors.Actor}\n */ function $3f6edc4fdcc84f8a$var$removeArtefact(target) {\n    const gridPoint = $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(target.position);\n    $3f6edc4fdcc84f8a$var$worldTileMap.deleteOccupancyOfGridPoint(target, gridPoint);\n    $3f6edc4fdcc84f8a$var$artefacts.delete(target);\n}\n/**\n * Add effect sprite\n * @param {module:utils/sprites/sprites.Sprite} sprite\n */ function $3f6edc4fdcc84f8a$var$addPassiveSprite(sprite) {\n    $3f6edc4fdcc84f8a$var$passiveSprites.set(sprite, sprite);\n}\n/**\n * Add effect sprite\n * @param {module:utils/sprites/sprites.Sprite} sprite\n */ function $3f6edc4fdcc84f8a$var$removePassiveSprite(sprite) {\n    $3f6edc4fdcc84f8a$var$passiveSprites.delete(sprite);\n}\n/**\n * Set the tile map for the world.\n * @param {TileMap}\n */ function $3f6edc4fdcc84f8a$var$setTileMap(tileMap) {\n    $3f6edc4fdcc84f8a$var$worldTileMap = tileMap;\n}\n/**\n * Get the tile map for the world.\n * @returns {TileMap}\n */ function $3f6edc4fdcc84f8a$var$getTileMap() {\n    return $3f6edc4fdcc84f8a$var$worldTileMap;\n}\n/**\n * Remove the tile map from the world.\n * @param {TileMap}\n */ function $3f6edc4fdcc84f8a$var$removeTileMap() {\n    $3f6edc4fdcc84f8a$var$worldTileMap = null;\n}\n/**\n * Clear the map and all actors.\n */ function $3f6edc4fdcc84f8a$var$clearAll() {\n    $3f6edc4fdcc84f8a$var$organicActors.forEach((actor)=>$3f6edc4fdcc84f8a$var$removeActor(actor));\n    $3f6edc4fdcc84f8a$var$actors.forEach((actor)=>$3f6edc4fdcc84f8a$var$removeActor(actor));\n    $3f6edc4fdcc84f8a$var$artefacts.forEach((actor)=>$3f6edc4fdcc84f8a$var$removeArtefact(actor));\n    $3f6edc4fdcc84f8a$var$passiveSprites.forEach((sprite)=>$3f6edc4fdcc84f8a$var$removePassiveSprite(sprite));\n    $3f6edc4fdcc84f8a$var$removeTileMap();\n}\n/**\n * Update the world. This calls the update methods of the tile map and all sprites/\n * @param {number} deltaSeconds\n */ function $3f6edc4fdcc84f8a$var$update(deltaSeconds) {\n    $3f6edc4fdcc84f8a$var$worldTileMap?.update(deltaSeconds);\n    $3f6edc4fdcc84f8a$var$organicActors.forEach((actor)=>{\n        const oldGridPoint = $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(actor.position);\n        actor.visible = $3f6edc4fdcc84f8a$var$worldTileMap.canHeroSeeGridPoint(oldGridPoint);\n        actor.update(deltaSeconds);\n        const newGridPoint = $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(actor.position);\n        $3f6edc4fdcc84f8a$var$worldTileMap.moveTileOccupancyGridPoint(actor, oldGridPoint, newGridPoint);\n    });\n    $3f6edc4fdcc84f8a$var$artefacts.forEach((artefact)=>{\n        const oldGridPoint = $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(artefact.position);\n        artefact.visible = $3f6edc4fdcc84f8a$var$worldTileMap.canHeroSeeGridPoint(oldGridPoint);\n        artefact.update(deltaSeconds);\n        const newGridPoint = $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(artefact.position);\n        $3f6edc4fdcc84f8a$var$worldTileMap.moveTileOccupancyGridPoint(artefact, oldGridPoint, newGridPoint);\n    });\n    $3f6edc4fdcc84f8a$var$actors.forEach((actor)=>{\n        const oldGridPoint = $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(actor.position);\n        actor.visible = $3f6edc4fdcc84f8a$var$worldTileMap.canHeroSeeGridPoint(oldGridPoint);\n        actor.update(deltaSeconds);\n        const newGridPoint = $3f6edc4fdcc84f8a$var$worldTileMap.worldPointToGrid(actor.position);\n        $3f6edc4fdcc84f8a$var$worldTileMap.moveTileOccupancyGridPoint(actor, oldGridPoint, newGridPoint);\n    });\n    $3f6edc4fdcc84f8a$var$passiveSprites.forEach((sprite)=>sprite.update(deltaSeconds));\n    $3f6edc4fdcc84f8a$var$worldTileMap?.updateHighlights(deltaSeconds);\n}\n/**\n * Resolve a ui click\n * @param {module:ui/interactions~MappedPositions} positions - click coordinates in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */ function $3f6edc4fdcc84f8a$var$resolveClick(positions) {\n    const tile = $3f6edc4fdcc84f8a$var$worldTileMap?.getTileAtWorldPoint(positions.world);\n    if (tile) {\n        tile.actionClick(positions.world);\n        return true;\n    }\n    return false;\n}\n/**\n * Resolve a context menu event\n * @param {module:ui/interactions~MappedPositions} positions - click coordinates in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */ function $3f6edc4fdcc84f8a$var$resolveContextMenu(positions) {\n    const tile = $3f6edc4fdcc84f8a$var$worldTileMap.getTileAtWorldPoint(positions.world);\n    if (tile) {\n        tile.actionContextClick(positions.world);\n        return true;\n    }\n    return false;\n}\n/**\n * Resolve a cancel event\n * @param {module:ui/interactions~MappedPositions} positions - click coordinates in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */ function $3f6edc4fdcc84f8a$var$resolveCancel(positionsUnused) {\n    return false;\n}\n/**\n * Get the actors\n * @returns {Map<Actor, Actor>}\n */ function $3f6edc4fdcc84f8a$var$getActors() {\n    return $3f6edc4fdcc84f8a$var$actors;\n}\n/**\n * Get the organic actors\n * @returns {Map<Actor, Actor>}\n */ function $3f6edc4fdcc84f8a$var$getOrganicActors() {\n    return $3f6edc4fdcc84f8a$var$organicActors;\n}\n/**\n * Get the artefacts\n * @returns {Map<Actor, Actor>}\n */ function $3f6edc4fdcc84f8a$var$getArtefacts() {\n    return $3f6edc4fdcc84f8a$var$actors;\n}\n/**\n * World object singleton.\n */ const $3f6edc4fdcc84f8a$var$WORLD = {\n    addActor: $3f6edc4fdcc84f8a$var$addActor,\n    addArtefact: $3f6edc4fdcc84f8a$var$addArtefact,\n    addPassiveSprite: $3f6edc4fdcc84f8a$var$addPassiveSprite,\n    clearAll: $3f6edc4fdcc84f8a$var$clearAll,\n    getActors: $3f6edc4fdcc84f8a$var$getActors,\n    getOrganicActors: $3f6edc4fdcc84f8a$var$getOrganicActors,\n    getArtefacts: $3f6edc4fdcc84f8a$var$getArtefacts,\n    getTileMap: $3f6edc4fdcc84f8a$var$getTileMap,\n    getWorldDims: $3f6edc4fdcc84f8a$var$getWorldDims,\n    removeTileMap: $3f6edc4fdcc84f8a$var$removeTileMap,\n    resolveCancel: $3f6edc4fdcc84f8a$var$resolveCancel,\n    resolveClick: $3f6edc4fdcc84f8a$var$resolveClick,\n    resolveContextMenu: $3f6edc4fdcc84f8a$var$resolveContextMenu,\n    removeActor: $3f6edc4fdcc84f8a$var$removeActor,\n    removeArtefact: $3f6edc4fdcc84f8a$var$removeArtefact,\n    removePassiveSprite: $3f6edc4fdcc84f8a$var$removePassiveSprite,\n    setTileMap: $3f6edc4fdcc84f8a$var$setTileMap,\n    update: $3f6edc4fdcc84f8a$var$update\n};\nvar $3f6edc4fdcc84f8a$export$2e2bcd8739ae039 = $3f6edc4fdcc84f8a$var$WORLD;\n\n\n/**\n * @file Heads-up display. Unlike the world, this never pans and so positions are\n * locked to the canvas coordinates.\n *\n * @module hud/hud\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Actor classes. Actors encapsulate a Sprite and represent moving objects\n * that can interact with the game.\n *\n * @module players/actors\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Handle fights and other interactions.\n *\n * @module dnd/interact\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Create transient effects.\n *\n * @module utils/effects/transient\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Basic sprite control\n *\n * @module utils/sprites/sprite\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Handle sprite rendering on the canvas\n *\n * @module utils/sprites/spriteRenderers\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Canvas functions for handling text.\n *\n * @module utils/text/text\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \nfunction $70f71c2a1614355b$export$85b404b88b79e37e(context, text) {\n    const metrics = context.measureText(text);\n    return {\n        width: metrics.width,\n        height: metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent,\n        offsetTop: -metrics.fontBoundingBoxAscent,\n        offsetCentreY: 0.5 * (metrics.fontBoundingBoxDescent - metrics.fontBoundingBoxAscent)\n    };\n}\n/**\n * Wrap text based on https://codepen.io/nishiohirokazu/pen/jjNyye\n * @param {CanvasRenderingContext2D} context\n * @param {string} paragraph\n * @param {module:utils/geometry~Position} position\n * @param {Object} options\n * @param {number} options.xWrapPosition - position to wrap text.\n * @param {number} [options.lineSpacing = 1] - multiplier for line height. 1 shifts lines by the total font height.\n * @returns {number} the next line y position.\n */ function $70f71c2a1614355b$var$wrapParagraph(context, paragraph, position, options) {\n    const words = paragraph.split(\" \");\n    let x = position.x ?? 0;\n    let y = position.y ?? 0;\n    let maxLineLength = options.xWrapPosition - x;\n    let lineSpacing = options.lineSpacing ?? 1;\n    let line = \"\";\n    let lineHeight;\n    for(let n = 0; n < words.length; n++){\n        let testLine = line + words[n] + \" \";\n        const bounds = $70f71c2a1614355b$export$85b404b88b79e37e(context);\n        if (!lineHeight) lineHeight = lineSpacing * bounds.height;\n        if (bounds.width > maxLineLength && n > 0) {\n            context.fillText(line, x, y);\n            line = words[n] + \" \";\n            y += lineHeight;\n        } else line = testLine;\n    }\n    context.fillText(line, x, y);\n    return y + lineHeight;\n}\nfunction $70f71c2a1614355b$export$bec150f75a9b8f11(context, text, position, options) {\n    context.font = $0aabe9055399f474$export$955358618f994a11(options?.styleName);\n    context.fillStyle = options?.color ?? \"white\";\n    if (!options?.wrapAtX) context.fillText(text, position.x ?? 0, position.y ?? 0);\n    else {\n        var paragraphs = text.split(\"\\n\");\n        for(let n = 0; n < paragraphs.length; n++)options.y = $70f71c2a1614355b$var$wrapParagraph(context, paragraphs[n], position, options);\n    }\n}\n\n\n\n/**\n * @file Debug utilities\n *\n * @module utils/debug\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ const $594075967358f0cc$export$8eb3892b442747bd = {\n    /**\n   * Should sprite boxes be drawn.@type {boolean}\n   */ spriteBoxes: false,\n    /**\n   * Show framerate\n   */ showFps: false\n};\n\n\n\n\n/**\n * @file Animation support\n *\n * @module utils/sprites/animation\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Load and manage images. The image manager is implemented as a singleton.\n *\n * @module utils/sprites/imageManager\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @typedef {Object} SpriteBitmap\n * @property {string} filename\n * @property {Image} image\n * @property {number} width\n * @property {number} height\n * @property {number} centreX\n * @property {number} centreY\n */ /** @type {Map<string, SpriteBitmap>} */ let $abd0af492c6c3f51$var$spriteMap = new Map();\n/**\n * Load an image\n * @param {URL} srcUrl - source URL\n * @returns {Promise} fulfils to @type {Image}.\n */ function $abd0af492c6c3f51$var$loadImage(srcUrl) {\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Loading image ${srcUrl}`);\n    let resolved = false;\n    return new Promise((resolve)=>{\n        const image = new Image();\n        image.addEventListener(\"load\", ()=>{\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Image ${srcUrl} loaded.`);\n            if (!resolved) resolve(image);\n        });\n        image.src = srcUrl;\n        if (image.complete) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Image ${srcUrl} already loaded; possibly cached.`);\n            resolved = true; // event handler shouldn't fire but just in case :)\n            resolve(image);\n        }\n    });\n}\n/**\n * Load a number of images\n * @param {URL[]} srcUrls - array of source URLs\n * @returns {Promise} fulfils to @type {Image[]}.\n */ function $abd0af492c6c3f51$var$loadImages(srcUrls) {\n    const promises = [];\n    srcUrls.forEach((url)=>promises.push($abd0af492c6c3f51$var$loadImage(url)));\n    return Promise.all(promises);\n}\n/**\n * Load sprite map.\n * @param {Object} spriteMapDef Sprite map definition from TexturePacker Array JSON file without multipack\n * @param {URL} textureUrl\n * @returns {Promise} fulfils to array of sprite map keys\n */ function $abd0af492c6c3f51$var$loadSpriteMap(spriteMapDef, textureUrl) {\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Loading sprite map.`);\n    return $abd0af492c6c3f51$var$loadImage(textureUrl).then((image)=>$abd0af492c6c3f51$var$buildSpriteMap(spriteMapDef, image));\n}\n/**\n * Build the sprite map\n * @param {Object} spriteMapDef - map definition from texture mapper. Array JSON no multi pack.\n * @param {Image} texture - images providing texture for sprite map.\n * @returns {Promise} fulfils to array of sprite map keys.\n */ function $abd0af492c6c3f51$var$buildSpriteMap(spriteMapDef, texture) {\n    const promises = [];\n    spriteMapDef.frames.forEach((frame)=>{\n        promises.push(createImageBitmap(texture, frame.frame.x, frame.frame.y, frame.frame.w, frame.frame.h).then((spriteImage)=>{\n            const spriteBitmap = {\n                filename: frame.filename,\n                image: spriteImage,\n                width: frame.frame.w,\n                height: frame.frame.h,\n                centreX: frame.sourceSize.w / 2 - frame.spriteSourceSize.x,\n                centreY: frame.sourceSize.h / 2 - frame.spriteSourceSize.y\n            };\n            $abd0af492c6c3f51$var$spriteMap.set(frame.filename, spriteBitmap);\n            return frame.filename;\n        }));\n    });\n    return Promise.all(promises);\n}\n/**\n * @param {string} filename\n * @param {Object} options\n * @param {string} options.fallback - image name to use if not found.\n * @param {boolean} options.quiet - if true, no message is logged if image not found.\n * @returns {SpriteBitmap} null if filename not found.\n */ function $abd0af492c6c3f51$var$getSpriteBitmap(filename, options) {\n    let result = $abd0af492c6c3f51$var$spriteMap.get(filename);\n    if (!result && !options?.quiet) (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Failed to find image ${filename}.`);\n    if (!result && options?.fallback) {\n        result = $abd0af492c6c3f51$var$spriteMap.get(options.fallback);\n        if (!result) (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Failed to find fallback image ${options.fallback}.`);\n    }\n    return result;\n}\n/**\n * Get image for an undefined bitmap\n * @returns {SpriteBitmap} null if filename not found.\n */ function $abd0af492c6c3f51$var$getUndefinedBitmap() {\n    return $abd0af492c6c3f51$var$spriteMap.get(\"undefined.png\");\n}\n/**\n * Singleton image manager.\n */ const $abd0af492c6c3f51$var$IMAGE_MANAGER = {\n    getSpriteBitmap: $abd0af492c6c3f51$var$getSpriteBitmap,\n    getUndefinedBitmap: $abd0af492c6c3f51$var$getUndefinedBitmap,\n    loadImage: $abd0af492c6c3f51$var$loadImage,\n    loadImages: $abd0af492c6c3f51$var$loadImages,\n    loadSpriteMap: $abd0af492c6c3f51$var$loadSpriteMap\n};\nvar $abd0af492c6c3f51$export$2e2bcd8739ae039 = $abd0af492c6c3f51$var$IMAGE_MANAGER;\n\n\n/**\n * @file Time utilities. Two clocks exist in the games: real and turn based.\n *\n * @module utils/time/clock\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @type {DOMHighResTimeStamp}\n */ let $75e8647c58e323d8$var$currentTimeMs = 0;\n/**\n * @param {DOMHighResTimeStamp} timeNowMs\n */ function $75e8647c58e323d8$var$updateTimeNow(timeNowMs) {\n    $75e8647c58e323d8$var$currentTimeMs = timeNowMs;\n}\n/**\n * Get a frame counter.\n * @param {number} framePeriodMs - time between frames\n * @param {number} [timeOffsetMs = 0] - offset to allow some randomisation\n * @returns {number}\n */ function $75e8647c58e323d8$var$getFrameCount(framePeriodMs, timeOffsetMs = 0) {\n    return Math.floor(($75e8647c58e323d8$var$currentTimeMs + timeOffsetMs) / framePeriodMs);\n}\n/**\n *  Game clock as singleton.\n */ const $75e8647c58e323d8$var$GAME_CLOCK = {\n    updateTimeNow: $75e8647c58e323d8$var$updateTimeNow,\n    getFrameCount: $75e8647c58e323d8$var$getFrameCount\n};\nvar $75e8647c58e323d8$export$2e2bcd8739ae039 = $75e8647c58e323d8$var$GAME_CLOCK;\n\n\n/**\n * @file Simple indexer for arrays.\n *\n * @module utils/arrays/indexer\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \nconst $53f7efcdef9156d3$export$cab6ba75b045ad71 = {\n    WRAP: 0,\n    REVERSE: 1,\n    STOP: 2\n};\nclass $53f7efcdef9156d3$export$7ed7e8a26b54b288 {\n    /** @type {number} */ #length;\n    /** @type {number} */ #maxIndex;\n    /** @type {number} */ #loopMethod;\n    /** @type {number} */ #direction;\n    /** @type {number} */ #index;\n    /**\n   * @param {number} length\n   * @param {LoopMethod} loopMethod\n   */ constructor(length, loopMethod){\n        this.#length = length;\n        this.#maxIndex = length - 1;\n        this.#loopMethod = loopMethod;\n        this.#direction = 1;\n        this.#index = 0;\n    }\n    /**\n   * Get current index.\n   */ get index() {\n        return this.#index;\n    }\n    /**\n   * Set current index. This will be clipped to a valid value.\n   */ set index(value) {\n        this.#index = $95fc563048a48bb6$export$e0b576e7a74416cd(value, 0, this.#length - 1);\n    }\n    /** Advance to the index.\n   * @param {number} distance - amount to move. This should be positive.\n   * @returns {number} the new index\n   */ advanceBy(distance) {\n        if (this.#length < 1) return this.#index;\n        switch(this.#loopMethod){\n            case $53f7efcdef9156d3$export$cab6ba75b045ad71.WRAP:\n                return this.#advanceByWrap(distance);\n            case $53f7efcdef9156d3$export$cab6ba75b045ad71.REVERSE:\n                return this.#advanceByReverse(distance);\n            case $53f7efcdef9156d3$export$cab6ba75b045ad71.NONE:\n            default:\n                return this.#advanceByStop(distance);\n        }\n    }\n    /** Advance the index by distance. The direction is maintained by the indexer\n   * itself. Wrap at ends.\n   * @param {number} distance - amount to move. This should be positive.\n   * @returns {number} the new index\n   */ #advanceByWrap(distance) {\n        distance = distance % this.#length;\n        this.#index += distance % this.#length;\n        if (this.#index >= this.#length) this.#index = this.#index - this.#length;\n        return this.#index;\n    }\n    /** Advance the index by distance. The direction is maintained by the indexer\n   * itself. Reverse at ends.\n   * @param {number} distance - amount to move. This should be positive.\n   * @returns {number} the new index\n   */ #advanceByReverse(distance) {\n        const nFullTraversals = Math.floor(distance / this.#length);\n        if (nFullTraversals % 2) this.#direction = -this.#direction; // odd so reversing\n        distance = distance % this.#length;\n        if (this.#direction > 0) {\n            this.#index += distance;\n            const overshoot = this.#index - this.#maxIndex;\n            if (overshoot > 0) {\n                this.#index = this.#maxIndex - overshoot;\n                this.#direction = -1;\n            }\n        } else if (this.#direction < 0) {\n            this.#index -= distance;\n            if (this.#index < 0) {\n                this.#index = -this.#index;\n                this.#direction = 1;\n            }\n        }\n        return this.#index;\n    }\n    /** Advance the index by distance. The direction is maintained by the indexer\n   * itself. Stop at ends.\n   * @param {number} distance - amount to move. This should be positive.\n   * @returns {number} the new index\n   */ #advanceByStop(distance) {\n        if (this.#direction > 0) this.#index = Math.min(this.#maxIndex, this.#index + distance);\n        else if (this.#direction < 0) this.#index = Math.max(0, this.#index - distance);\n        return this.#index;\n    }\n}\n\n\n\n\nconst $305a56b3d2c1570b$export$22f21f38505e8954 = {\n    NONE: 0,\n    HORIZONTAL: 1,\n    VERTICAL: 2\n};\nclass $305a56b3d2c1570b$export$9d5734c725768403 {\n    /** @type {boolean} */ playing;\n    /** @type {module:utils/sprites/imageManager~SpriteBitmap[]} */ #frameBitmaps;\n    /** @type {Indexer} */ #indexer;\n    /** @type {number} */ #lastFrameCount;\n    /** offset used to randomise animations. @type {number} */ #timeOffset;\n    /** Period in ms for frame animations @type {number}*/ #framePeriodMs;\n    /**\n   * Construct animation.\n   * @param {Object | string} filenamePattern - if a string is parsed then the image is a single frame.\n   * @param {string} filenamePattern.prefix\n   * @param {number} filenamePattern.startIndex - starting index.\n   * @param {number} filePattern.padding - index is padded with leading zeros to padding length\n   * @param {string} filenamePattern.suffix\n   * @param {Object} options\n   * @param {number} options.framePeriodMs - period in ms for frame animations.\n   * @param {LoopMethod} options.loopMethod - method of looping animation.\n   */ constructor(filenamePattern, options){\n        this.#frameBitmaps = [];\n        this.#lastFrameCount = 0;\n        this.#timeOffset = $95fc563048a48bb6$export$b141de964f0a90c1(0, 1000);\n        if (typeof filenamePattern === \"string\") {\n            this.#frameBitmaps.push((0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(filenamePattern));\n            return;\n        }\n        this.#framePeriodMs = Math.max(1, options.framePeriodMs);\n        let index = filenamePattern.startIndex ?? 0;\n        let padding = filenamePattern.padding ?? 0;\n        let textureFrame;\n        do {\n            const fileName = `${filenamePattern.prefix}${index.toString().padStart(padding, \"0\")}${filenamePattern.suffix}`;\n            let quiet;\n            if (index === 0 && (filenamePattern.prefix.endsWith(\"idle\") || filenamePattern.prefix.endsWith(\"dead\"))) quiet = false;\n            else quiet = true;\n            textureFrame = (0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(fileName, {\n                quiet: quiet\n            });\n            if (textureFrame) this.#frameBitmaps.push(textureFrame);\n            index++;\n        }while (textureFrame);\n        this.#indexer = new (0, $53f7efcdef9156d3$export$7ed7e8a26b54b288)(this.#frameBitmaps.length, options.loopMethod);\n        this.playing = true;\n    }\n    /**\n   * Get first frame\n   * @returns {Frame}\n   */ getFirstFrame() {\n        return {\n            bitmap: this.#frameBitmaps[0],\n            rotation: 0,\n            flip: $305a56b3d2c1570b$export$22f21f38505e8954.NONE\n        };\n    }\n    /**\n   * Get current frame\n   * @returns {Frame}\n   */ getCurrentFrame() {\n        const frame = {\n            bitmap: undefined,\n            rotation: 0,\n            flip: $305a56b3d2c1570b$export$22f21f38505e8954.NONE\n        };\n        if (this.#frameBitmaps.length > 1) {\n            if (this.playing) {\n                const frameCount = (0, $75e8647c58e323d8$export$2e2bcd8739ae039).getFrameCount(this.#framePeriodMs, this.#timeOffset);\n                if (frameCount !== this.#lastFrameCount) {\n                    this.#indexer.advanceBy(frameCount - this.#lastFrameCount);\n                    this.#lastFrameCount = frameCount;\n                }\n            }\n            frame.bitmap = this.#frameBitmaps[this.#indexer.index];\n        } else frame.bitmap = this.#frameBitmaps[0];\n        return frame.bitmap ? frame : undefined;\n    }\n    /**\n   * Manual movement of frames. Note this automatically switches off playing.\n   * @param {number} index - frame index. This will be clipped to the ends of the\n   * array.\n   */ setCurrentIndex(index) {\n        if (this.#frameBitmaps.length > 1) {\n            this.playing = false;\n            this.#indexer.index = index;\n        }\n    }\n    /**\n   * Get the current index.\n   * @returns {number}\n   */ getCurrentIndex() {\n        if (this.#frameBitmaps.length > 1) return this.#indexer.index;\n        else return 0;\n    }\n}\nclass $305a56b3d2c1570b$export$7ded0ab8d4b1a54f {\n    /** @type {Object.<string, AnimatedImage>} */ #animatedImages;\n    /** @type {string} */ #currentImage;\n    /**\n   * Create the keyed animated image\n   * @param {string} key\n   * @param {AnimatedImage} animatedImage\n   */ constructor(key, animatedImage){\n        this.#animatedImages = {};\n        if (key) {\n            this.#animatedImages[key] = animatedImage;\n            this.#currentImage = animatedImage;\n        }\n    }\n    /**\n   * Get the current image.\n   */ get image() {\n        return this.#currentImage;\n    }\n    /**\n   * Add image to available images.\n   * @param {string} key\n   * @param {AnimatedImage} animatedImage\n   */ addAnimatedImage(key, animatedImage) {\n        this.#animatedImages[key] = animatedImage;\n    }\n    /**\n   * Set the current animation key. Ignored if it does not exist.\n   * @param {string} key\n   */ setCurrentKey(key) {\n        //eslint-disable-next-line no-prototype-builtins\n        if (this.#animatedImages.hasOwnProperty(key)) this.#currentImage = this.#animatedImages[key];\n        else (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Attempt to set current key to nonexistent value of ${key}`);\n    }\n    /**\n   * Get current frame\n   * @returns {Frame}\n   */ getCurrentFrame() {\n        return this.#currentImage.getCurrentFrame();\n    }\n    /**\n   * Get specific frame.\n   * @param {string} key\n   * @returns {AnimatedImage}\n   */ getAnimatedImage(key) {\n        return this.#animatedImages[key];\n    }\n}\n\n\n/**\n * @typedef {Object} RenderGeometry\n * @property {number} width\n * @property {number} height\n * @property {module:utils/geometry~Point} origin - origin relative to the centre\n */ /**\n * Convert RenderGeometry to Rectangle\n * @param {module:utils/geometry~Position} position\n * @param {RenderGeometry} renderGeom\n * @returns {module:utils/geometry~Rectangle}\n */ function $aa0468ffbc97dbfc$var$renderGeometryToRect(position, renderGeom) {\n    return new (0, $9181799b149b64a5$export$4617fb02663045ef)(position.x - renderGeom.width / 2, position.y - renderGeom.height / 2, renderGeom.width, renderGeom.height);\n}\nclass $aa0468ffbc97dbfc$export$b1e2fc7f480e9342 {\n    /** @type {CanvasRenderingContext2D} */ _context;\n    /** @type {module:utils/geometry~Rectangle} */ _boundingBoxCanvas;\n    /**\n   * Construct base renderer\n   * @param {CanvasRenderingContext2D} context\n   */ constructor(context){\n        this._context = context;\n        this._boundingBoxCanvas = new (0, $9181799b149b64a5$export$4617fb02663045ef)(0, 0, 0, 0);\n    }\n    /**\n   * Return the name of image use to represent the sprite in passive situations\n   * such as dialogs. If there is no image, it returns null;\n   * @returns {string}\n   */ getImageFilename() {\n        return null;\n    }\n    /**\n   * Get the context. This is just provided to allow classes other than children\n   * to read the context. _context could be used but that is not the intent.\n   */ getContext() {\n        return this._context;\n    }\n    /**\n   * Get the axis aligned bounding box\n   * @returns {module:utils/geometry~Rectangle}\n   */ getBoundingBoxCanvas() {\n        return this._boundingBoxCanvas;\n    }\n    /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position in the world\n   * @param {number} opacity\n   */ render(position, opacity) {\n        position = (0, $7aed85f370071bde$export$2e2bcd8739ae039).worldPositionToCanvas(position);\n        if (!this.isOnCanvas(position)) return;\n        const currentAlpha = this._context.globalAlpha;\n        this._context.globalAlpha = currentAlpha * opacity;\n        const rotated = position.rotation;\n        if (rotated) {\n            this._context.save();\n            this._context.translate(position.x, position.y);\n            this._context.rotate(-position.rotation);\n            this._context.translate(-position.x, -position.y);\n        }\n        this._doRender(position);\n        if (rotated) this._context.restore();\n        if ($594075967358f0cc$export$8eb3892b442747bd.spriteBoxes) {\n            this._context.strokeStyle = \"green\";\n            this._context.strokeRect(this._boundingBoxCanvas.x, this._boundingBoxCanvas.y, this._boundingBoxCanvas.width, this._boundingBoxCanvas.height);\n        }\n        this._context.globalAlpha = currentAlpha;\n    }\n    /**\n   * Render the sprite\n   * @param {module:utils/geometry~Position} position\n   */ _doRender(positionUnused) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"_doRender method should be overridden.\");\n    }\n    /**\n   * Check if it will be on screen\n   * @param {module:utils/geometry~Position} position\n   * @returns {boolean} true if on screen.\n   */ isOnScreen(position) {\n        const rect = new (0, $9181799b149b64a5$export$4617fb02663045ef)(position.x - this._boundingBoxCanvas.width / 2, position.y - this._boundingBoxCanvas.height / 2, this._boundingBoxCanvas.width, this._boundingBoxCanvas.height);\n        return (0, $7aed85f370071bde$export$2e2bcd8739ae039).isOnScreen(rect);\n    }\n    /**\n   * Check if it will be on screen\n   * @param {module:utils/geometry~Position} position - this should be in canvas coordinates.\n   * @returns {boolean} true if on screen.\n   */ isOnCanvas(position) {\n        const rect = new (0, $9181799b149b64a5$export$4617fb02663045ef)(position.x - this._boundingBoxCanvas.width / 2, position.y - this._boundingBoxCanvas.height / 2, this._boundingBoxCanvas.width, this._boundingBoxCanvas.height);\n        return (0, $7aed85f370071bde$export$2e2bcd8739ae039).isOnCanvas(rect);\n    }\n}\nclass $aa0468ffbc97dbfc$export$544ff2c168abc0f9 extends $aa0468ffbc97dbfc$export$b1e2fc7f480e9342 {\n    /** Name used to access font styles from the fonts.\n   * @type {string}\n   */ #styleName;\n    /** @type {string} */ #lastCalculatedText;\n    /** @type {RenderGeometry} */ #renderGeometry;\n    /** @type {string} */ text;\n    /** @type {string} */ color;\n    /**\n   * @param {CanvasRenderingContext2D} context\n   * @param {string} text\n   * @param {Object} options\n   * @param {string} [options.styleName = 'normal']\n   * @param {string} [options.color = 'white']\n   */ constructor(context, text, options = {\n        styleName: \"normal\",\n        color: \"white\"\n    }){\n        super(context);\n        this.text = text;\n        this.color = options.color;\n        this.#styleName = options.styleName;\n    }\n    /**\n   * Calculate the renderGeometry of the text.\n   * @param {string} text\n   */ #calculateRenderGeometry(text) {\n        this._context.font = $0aabe9055399f474$export$955358618f994a11(this.#styleName);\n        const metrics = this._context.measureText(text);\n        this.#renderGeometry = {\n            width: metrics.width,\n            height: metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent,\n            origin: {\n                x: -0.5 * metrics.width,\n                y: 0.5 * (metrics.fontBoundingBoxAscent - metrics.fontBoundingBoxDescent)\n            }\n        };\n        this.#lastCalculatedText = text;\n    }\n    /**\n   * Render the sprite\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */ _doRender(position) {\n        if (this.text !== this.#lastCalculatedText) this.#calculateRenderGeometry(this.text);\n        const renderPosition = {\n            x: position.x + this.#renderGeometry.origin.x,\n            y: position.y + this.#renderGeometry.origin.y,\n            rotation: position.rotation\n        };\n        $70f71c2a1614355b$export$bec150f75a9b8f11(this._context, this.#lastCalculatedText, renderPosition, {\n            color: this.color,\n            styleName: this.#styleName\n        });\n        this._boundingBoxCanvas = $aa0468ffbc97dbfc$var$renderGeometryToRect(position, this.#renderGeometry);\n    }\n}\nclass $aa0468ffbc97dbfc$export$bea6a7ef06354cc extends $aa0468ffbc97dbfc$export$b1e2fc7f480e9342 {\n    #width;\n    #height;\n    #halfWidth;\n    #halfHeight;\n    #fillStyle;\n    #strokeStyle;\n    #lineWidth;\n    /**\n   *\n   * @param {CanvasRenderingContext2D} context\n   * @param {Object} options\n   * @param {number} options.width\n   * @param {number} options.height\n   * @param {string} options.fillStyle\n   * @param {string} options.strokeStyle\n   */ constructor(context, options){\n        super(context);\n        this.#width = options.width ?? 10;\n        this.#height = options.height ?? 10;\n        this.#halfWidth = this.#width / 2;\n        this.#halfHeight = this.#height / 2;\n        this.#fillStyle = options.fillStyle;\n        this.#strokeStyle = options.strokeStyle;\n        this.#lineWidth = options.lineWidth ?? 2;\n    }\n    /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */ _doRender(position) {\n        this._context.lineWidth = this.#lineWidth;\n        const x = position.x - this.#halfWidth;\n        const y = position.y - this.#halfHeight;\n        if (this.#fillStyle) {\n            this._context.fillStyle = this.#fillStyle;\n            this._context.fillRect(x, y, this.#width, this.#height);\n        }\n        if (this.#strokeStyle) {\n            this._context.strokeStyle = this.#strokeStyle;\n            this._context.strokeRect(x, y, this.#width, this.#height);\n        }\n        this._boundingBoxCanvas = new (0, $9181799b149b64a5$export$4617fb02663045ef)(x, y, this.#width, this.#height);\n    }\n}\nclass $aa0468ffbc97dbfc$export$184b92f2ec28e2e2 extends $aa0468ffbc97dbfc$export$b1e2fc7f480e9342 {\n    #height;\n    #halfHeight;\n    #width;\n    #halfWidth;\n    #fillStyle;\n    #strokeStyle;\n    #offsetX;\n    #offsetY;\n    #fillHeight;\n    #halfFillHeight;\n    /**\n   *\n   * @param {CanvasRenderingContext2D} context\n   * @param {Object} options\n   * @param {number} options.width\n   * @param {number} options.height\n   * @param {string} options.fillStyle\n   * @param {string} options.strokeStyle\n   * @param {number} options.offsetX - sprite is offset from the normal sprite position.\n   * @param {number} options.offsetY - sprite is offset from the normal sprite position.\n   */ constructor(context, options){\n        super(context);\n        this.#height = options.height;\n        this.#halfHeight = this.#height / 2;\n        this.#width = options.width;\n        this.#halfWidth = this.#width / 2;\n        this.#fillStyle = options.fillStyle;\n        this.#strokeStyle = options.strokeStyle;\n        this.#offsetX = options.offsetX ?? 0;\n        this.#offsetY = options.offsetY ?? 0;\n        this.setLevel(0);\n    }\n    /** Set the level of the gauge.\n   * @param {number} proportion - 0 to 1\n   */ setLevel(proportion) {\n        this.#fillHeight = Math.min(proportion, 1) * this.#height;\n        this.#halfFillHeight = 0.5 * this.#fillHeight;\n    }\n    /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */ _doRender(position) {\n        const topStroke = position.y - this.#halfHeight + this.#offsetY;\n        const topFill = position.y + this.#halfHeight - this.#fillHeight + this.#offsetY;\n        const x = position.x - this.#halfWidth + this.#offsetX;\n        if (this.#fillStyle) {\n            this._context.fillStyle = this.#fillStyle;\n            this._context.fillRect(x, topFill, this.#width, this.#fillHeight);\n        }\n        if (this.#strokeStyle) {\n            this._context.strokeStyle = this.#strokeStyle;\n            this._context.strokeRect(x, topStroke, this.#width, this.#height);\n        }\n        this._boundingBoxCanvas = new (0, $9181799b149b64a5$export$4617fb02663045ef)(x, topStroke, this.#width, this.#height);\n    }\n}\nclass $aa0468ffbc97dbfc$export$f1bb2dcf27836475 extends $aa0468ffbc97dbfc$export$b1e2fc7f480e9342 {\n    #gaugeRenderers;\n    /**\n   * The number of gauges is determined by the maximum length of the fill styles and\n   * stroke styles\n   * @param {CanvasRenderingContext2D} context\n   * @param {Object} options\n   * @param {number} options.tileSize\n   * @param {string[]} options.fillStyles\n   * @param {string[]} options.strokeStyles\n   */ constructor(context, options){\n        super(context);\n        const nGauges = Math.max(options.fillStyles.length ?? 0, options.strokeStyles.length ?? 0);\n        if (nGauges === 0) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Attempt to create MultiGaugeTileRenderer with no gauges.\");\n            return;\n        }\n        this.#gaugeRenderers = [];\n        const gaugeWidth = options.tileSize / nGauges;\n        let gaugePosX = -options.tileSize / 2 + gaugeWidth / 2;\n        for(let index = 0; index < nGauges; index++)this.#gaugeRenderers.push(new $aa0468ffbc97dbfc$export$184b92f2ec28e2e2(context, {\n            width: gaugeWidth,\n            height: options.tileSize,\n            fillStyle: options.fillStyles?.[index],\n            strokeStyle: options.strokeStyles?.[index],\n            offsetX: gaugePosX + gaugeWidth * index,\n            offsetY: 0\n        }));\n    }\n    /**\n   * Set the level of a gauge.\n   * @param {number} gaugeIndex\n   * @param {number} proportion - 0 to 1\n   */ setLevel(gaugeIndex, proportion) {\n        this.#gaugeRenderers[gaugeIndex]?.setLevel(proportion);\n    }\n    /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */ render(position) {\n        this.#gaugeRenderers?.forEach((renderer)=>renderer.render(position));\n    }\n}\nclass $aa0468ffbc97dbfc$export$f6eddc3f9306e494 extends $aa0468ffbc97dbfc$export$b1e2fc7f480e9342 {\n    /** @type {RenderGeometry} */ #renderGeometry;\n    /** @type {Point[]} */ path;\n    /**\n   * Create a path renderer.\n   * @param {CanvasRenderingContext2D} context\n   * @param {Point[]} path\n   */ constructor(context, path){\n        super(context);\n        this.path = path;\n    }\n    /** Calculate the rendering geometry.\n   * @param {Point[]} path\n   * @param {module:utils/geometry~Position} position\n   */ #calculateGeometry(path, positionUnused) {\n        let minPoint = (0, $9181799b149b64a5$export$9bb5b4b8c6114d78);\n        let maxPoint = (0, $9181799b149b64a5$export$ffabdd03f47fc732);\n        path.forEach((point)=>{\n            minPoint.x = Math.min(minPoint.x, point.x);\n            minPoint.y = Math.min(minPoint.y, point.y);\n            maxPoint.x = Math.max(maxPoint.x, point.x);\n            maxPoint.y = Math.max(maxPoint.y, point.y);\n        });\n        this.#renderGeometry = {\n            width: maxPoint.x - minPoint.x,\n            height: maxPoint.y - minPoint.y,\n            origin: {\n                x: 0.5 * (minPoint.x + maxPoint.x),\n                y: 0.5 * (minPoint.y + maxPoint.y)\n            }\n        };\n    }\n    /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */ _doRender(position) {\n        if (this.path.length < 2) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Path sprite needs at least 2 points.\");\n            return;\n        }\n        if (!this.#renderGeometry) this.#calculateGeometry(this.path, position);\n        this._context.beginPath();\n        this._context.strokeStyle = \"blue\";\n        this._context.moveTo(this.path[0].x + position.x, this.path[0].y + position.y);\n        for(let n = 1; n < this.path.length; n++)this._context.lineTo(this.path[n].x + position.x, this.path[n].y + position.y);\n        this._context.closePath();\n        this._context.stroke();\n        this._boundingBoxCanvas = $aa0468ffbc97dbfc$var$renderGeometryToRect(position, this.#renderGeometry);\n    }\n}\nclass $aa0468ffbc97dbfc$export$c1626e6e036a584 extends $aa0468ffbc97dbfc$export$b1e2fc7f480e9342 {\n    /** @type {module:utils/sprites/imageManager~SpriteBitmap} */ #spriteFrame;\n    /** @type {animation.KeyedAnimatedImages} */ #animation;\n    /**\n   * Create an image renderer.\n   * @param {CanvasRenderingContext2D} context\n   * @param {SpriteBitmap | animation.AnimatedImage | animation.KeyAnimatedImages} imageDefinition\n   */ constructor(context, imageDefinition){\n        super(context);\n        if (imageDefinition?.getCurrentFrame) {\n            this.#animation = imageDefinition;\n            this.#spriteFrame = this.#animation.getCurrentFrame();\n        } else this.#spriteFrame = {\n            bitmap: imageDefinition,\n            rotation: 0,\n            flip: $305a56b3d2c1570b$export$22f21f38505e8954.NONE\n        };\n        if (this.#spriteFrame?.bitmap) {\n            this._boundingBoxCanvas.width = this.#spriteFrame.bitmap.width ?? 0;\n            this._boundingBoxCanvas.height = this.#spriteFrame.bitmap.height ?? 0;\n        } else (0, $733fb161db426370$export$2e2bcd8739ae039).error(`No image frame available for sprite.`, imageDefinition);\n    }\n    /**\n   * @override\n   */ getImageFilename() {\n        return this.#spriteFrame?.bitmap.filename;\n    }\n    /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */ _doRender(position) {\n        if (!this.#spriteFrame) return;\n        const frame = this.#animation ? this.#animation.getCurrentFrame() : this.#spriteFrame;\n        this._boundingBoxCanvas.x = position.x - this._boundingBoxCanvas.width / 2;\n        this._boundingBoxCanvas.y = position.y - this._boundingBoxCanvas.height / 2;\n        position.rotation = frame.rotation;\n        this._context.drawImage(frame.bitmap.image, position.x - frame.bitmap.centreX, position.y - frame.bitmap.centreY);\n    }\n}\n\n\nclass $f024f63ce1fb25eb$export$3075603db8e6204c {\n    /** @type {Position}*/ #position = new (0, $9181799b149b64a5$export$13807d9ee5a34a42)(0, 0, 0);\n    /** @type {Velocity} */ #velocity = new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 0);\n    /** @type {Acceleration} */ #acceleration = new (0, $9181799b149b64a5$export$5086e02bc6b47824)(0, 0, 0);\n    /** @type {SpriteCanvasRenderer[]} */ #renderer;\n    /** @type {module:utils/sprite.AbstractModifier} */ #baseModifier;\n    /** @type {module:utils/sprite.AbstractModifier} */ #transientModifier;\n    /** @type {boolean} */ visible;\n    /** @type {number} */ opacity;\n    /**\n   * @param {Object} options\n   * @param {SpriteCanvasRenderer } options.renderer - the renderer or renderers that render the sprite\n   * rather than the world.\n   */ constructor(options){\n        this.#renderer = options?.renderer;\n        this.visible = true;\n        this.opacity = 1;\n    }\n    /**\n   * Get the current position.\n   * @returns {Position}\n   */ get position() {\n        return this.#position;\n    }\n    /**\n   * Set the current position. Invalid values become 0.\n   * @param {Position} nextPosition\n   */ set position(nextPosition) {\n        this.#position.x = this.valueOrZero(nextPosition.x);\n        this.#position.y = this.valueOrZero(nextPosition.y);\n        this.#position.rotation = this.valueOrZero(nextPosition.rotation);\n    }\n    /**\n   * Get the current motion.\n   * @returns {Velocity}\n   */ get velocity() {\n        return this.#velocity;\n    }\n    /**\n   * Get the current motion.\n   * @returns {Acceleration}\n   */ get acceleration() {\n        return this.#acceleration;\n    }\n    /**\n   * Set the current motion.\n   * @param {Acceleration} acceleration\n   */ set acceleration(acceleration) {\n        this.#acceleration = acceleration;\n    }\n    /**\n   * Set the current Velocity. Invalid values become 0.\n   * @param {Velocity} nextVelocity\n   */ set velocity(nextVelocity) {\n        this.#velocity.x = this.valueOrZero(nextVelocity.x);\n        this.#velocity.y = this.valueOrZero(nextVelocity.y);\n        this.#velocity.rotation = this.valueOrZero(nextVelocity.rotation);\n    }\n    /**\n   * Add a new modifier. If there is already a modifier running,\n   * it's kill function is called to make sure any pending promises\n   * are resolved.\n   * @param {module:utils/sprite.AbstractModifier} modifier\n   */ replaceTransientModifier(modifier) {\n        if (this.#transientModifier) this.#transientModifier.kill();\n        this.#transientModifier = modifier;\n    }\n    /**\n   * Set the base modifier. If there is already a modifier running,\n   * it's kill function is called to make sure any pending promises\n   * are resolved.\n   * @param {module:utils/sprite.AbstractModifier} modifier\n   */ replaceBaseModifier(modifier) {\n        if (this.#baseModifier) this.#baseModifier.kill();\n        this.#baseModifier = modifier;\n    }\n    /**\n   * Returns the value but converts non-numeric values to 0.\n   * @param {number} value\n   * @returns {number}\n   */ valueOrZero(value) {\n        return typeof value === \"number\" ? value : 0;\n    }\n    /**\n   * Update the sprite. Calls the sprite's modifier and then renderer.\n   * @param {number} deltaSeconds - elapsed time.\n   */ update(deltaSeconds) {\n        if (this.#baseModifier) this.#baseModifier = this.#baseModifier.update(this, deltaSeconds);\n        if (this.#transientModifier) this.#transientModifier = this.#transientModifier.update(this, deltaSeconds);\n        if (this.visible) this.#render();\n    }\n    /**\n   * Render the sprite by calling the sprite's renderer\n   */ #render() {\n        if (!this.#renderer) return;\n        if (!this.#renderer.forEach) this.#renderer.render(this.#position, this.opacity);\n        else this.#renderer.forEach((renderer)=>renderer.render(this.#position, this.opacity));\n    }\n    /** Get the bounding box for the sprite.\n   * @returns {geometry.Rectangle}\n   */ getBoundingBox() {\n        const boundsCanvas = this.#renderer.getBoundingBoxCanvas();\n        return new (0, $9181799b149b64a5$export$4617fb02663045ef)(this.position.x - boundsCanvas.width / 2, this.position.y - boundsCanvas.height / 2, boundsCanvas.width, boundsCanvas.height);\n    }\n    /**\n   * Get image file name used for passive renderers. If this is a multi-renderer,\n   * the first one with a bitmap is returned.\n   * @returns {module:utils/sprites/imageManager~SpriteBitmap}\n   */ getImageFilename() {\n        if (!this.#renderer.forEach) return this.#renderer.getImageFilename();\n        else for (const renderer of this.#renderer){\n            const bitmap = renderer.getImageFilename();\n            if (bitmap) return bitmap;\n        }\n        return null;\n    }\n}\n\n\n\n\n/**\n * @file Faders which adjust opacity\n *\n * @module utils/sprites/faders\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Modifiers for updates\n *\n * @module utils/sprites/modifiers\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/** Default timeout for transient modifiers. @type {number} */ const $a82a8a6a56fb083b$var$DEFAULT_TIMEOUT_SECS = 10;\nclass $a82a8a6a56fb083b$export$f929ba4d0b405b8b {\n    /** @type {AbstractModifier} */ decoratedModifier;\n    /** The resolve function for transient modifiers @type {function(*)} */ #resolveFunc;\n    /** Total active time in seconds */ #activeSeconds;\n    /** Timeout duration */ #timeoutSeconds;\n    /**\n   *\n   * @param {AbstractModifier} [decoratedModifier]\n   */ constructor(decoratedModifier){\n        this.#activeSeconds = 0;\n        this.#timeoutSeconds = 0;\n        this.decoratedModifier = decoratedModifier;\n    }\n    /**\n   * Resolve any pending promise.\n   * @param {*} fulfilValue\n   */ #resolve(fulfilValue) {\n        if (this.#resolveFunc) {\n            this.#resolveFunc(fulfilValue);\n            this.#resolveFunc = null;\n        }\n    }\n    /**\n   * Kill this modifier. Resolves any pending promises.\n   */ kill() {\n        this.#resolve();\n    }\n    /**\n   * Perform any cleanup if timeout occurs.\n   * Should be overridden if cleanup necessary. Default does nothing.\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   */ cleanUpOnTimeout(spriteUnused) {}\n    /**\n   * Apply the modifier as transient to a sprite.\n   * @param {AbstractModifier} modifier\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   * @param {number} [timeoutSeconds = DEFAULT_TIMEOUT_SECS]\n   * @returns {Promise} fulfils to null on completion;\n   */ applyAsTransientToSprite(sprite, timeoutSeconds = $a82a8a6a56fb083b$var$DEFAULT_TIMEOUT_SECS) {\n        this.#timeoutSeconds = timeoutSeconds;\n        return new Promise((resolve)=>{\n            this.#resolveFunc = resolve;\n            sprite.replaceTransientModifier(this);\n        });\n    }\n    /**\n   * Apply the modifier as continuous to a sprite.\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   */ applyAsContinuousToSprite(sprite) {\n        sprite.replaceBaseModifier(this);\n    }\n    /** Do the update modification. If a decoratedModifier has been set, this is then\n   * called. If after calling update, the modifier is removed, it is removed from\n   * the owning decoratedModifier. Its children are retained.\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time since last update.\n   * @returns {AbstractModifier} - the modifier required for the next update. This\n   * normally returns itself. If null is return, this indicates that the modifier\n   * has completed its action and can be removed from the chain of decorated\n   * modifiers. This method handles removal of its own decoratedModifier, but removal\n   * of the root, if appropriate, is the responsibility of the Sprite.\n   */ update(sprite, deltaSeconds) {\n        if (this.#resolveFunc) this.#activeSeconds += deltaSeconds;\n        if (this.decoratedModifier) this.decoratedModifier = this.decoratedModifier?.update(sprite, deltaSeconds);\n        let nextModifier = this.doUpdate(sprite, deltaSeconds);\n        if (this.#activeSeconds > this.#timeoutSeconds) {\n            this.cleanUpOnTimeout(sprite);\n            nextModifier = null; // end this\n        }\n        if (!nextModifier) {\n            this.#resolve(null);\n            return null;\n        }\n        return nextModifier;\n    }\n    /** Do the update modification for this modifier.\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time since last update.\n   * @returns {AbstractModifier} - the modifier for the next update.\n   */ doUpdate(spriteUnused, deltaSecondsUnused) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"doUpdate should be overridden.\");\n        return this;\n    }\n}\n\n\nclass $a94d5993e44fff52$export$709baf898a5dceda extends (0, $a82a8a6a56fb083b$export$f929ba4d0b405b8b) {\n    /** @type {number} */ #deltaOpacityPerSec;\n    /** @type {number} */ #delaySecs;\n    /** @type {number} */ #elapsedSecs;\n    /** @type {number} */ #easeInDuration;\n    /**\n   * Create fader.\n   * @param {number} delaySecs - default alignment.\n   * @param {number} lifetimeSecs - default alignment.\n   * @param {AbstractModifier} decoratedModifier\n   */ constructor(delaySecs, lifetimeSecs, decoratedModifier){\n        super(decoratedModifier);\n        this.#delaySecs = delaySecs;\n        this.#easeInDuration = 0.3 * lifetimeSecs;\n        const fadeOutDuration = lifetimeSecs - this.#easeInDuration;\n        this.#deltaOpacityPerSec = 1 / Math.max(fadeOutDuration, 0.5);\n        this.#elapsedSecs = -1; // only start counting after first update.\n    }\n    /**\n   * Adjust sprite opacity depending on time. When the time is complete, this\n   * modify returns null to indicate completion.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time\n   * @returns {AbstractModifier}\n   */ doUpdate(sprite, deltaSeconds) {\n        if (this.#elapsedSecs < 0) this.#elapsedSecs = 0; // only start on first update.\n        else this.#elapsedSecs += deltaSeconds;\n        if (this.#elapsedSecs > this.#delaySecs + this.#easeInDuration) sprite.opacity = Math.max(0, 1 - (this.#elapsedSecs - this.#delaySecs - this.#easeInDuration) * this.#deltaOpacityPerSec);\n        else sprite.opacity = 1;\n        return sprite.opacity > 0 ? this : null;\n    }\n}\n\n\n\n/**\n * @file Movers for sprites\n *\n * @module utils/sprites/movers\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\nclass $8e5c8f9d0e1a3528$var$VariableSpeed {\n    /** @type {number} */ #speed;\n    /** @type {boolean} */ #linear;\n    /** Create variable speed.\n   * @param {number} speed - base speed.\n   * @param {boolean} linear - true if speed constant, otherwise speed faster if\n   * further away.\n   */ constructor(speed, linear){\n        this.#speed = speed;\n        this.#linear = linear;\n    }\n    /**\n   * Get speed to move between points.\n   * @param {Point} pointA\n   * @param {Point} pointB\n   * @returns {number}\n   */ getSpeedBetweenPoints(pointA, pointB) {\n        if (this.#linear) return this.#speed;\n        else {\n            const separation = Math.abs(pointA.x - pointB.x) + Math.abs(pointA.y - pointB.y);\n            return (1 + 0.1 * separation) * this.#speed;\n        }\n    }\n}\nclass $8e5c8f9d0e1a3528$export$9600794ac1f85e81 extends (0, $a82a8a6a56fb083b$export$f929ba4d0b405b8b) {\n    /** @type {module:utils/geometry~Point} */ #topLeft;\n    /** @type {module:utils/geometry~Point} */ #bottomRight;\n    /**\n   * @param {AbstractModifier} decoratedModifier\n   */ constructor(decoratedModifier){\n        super(decoratedModifier);\n    }\n    /**\n   * Move sprite using its velocity and acceleration\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time\n   * @returns {AbstractModifier}\n   */ doUpdate(sprite, deltaSeconds) {\n        sprite.position.x += sprite.velocity.x * deltaSeconds;\n        sprite.position.y += sprite.velocity.y * deltaSeconds;\n        sprite.position.rotation += sprite.velocity.rotation * deltaSeconds;\n        if (sprite.acceleration) {\n            sprite.velocity.x += sprite.acceleration.x * deltaSeconds;\n            sprite.velocity.y += sprite.acceleration.y * deltaSeconds;\n            sprite.velocity.rotation += sprite.acceleration.rotation * deltaSeconds;\n        }\n        return this;\n    }\n}\nclass $8e5c8f9d0e1a3528$export$9a9871e8ef5d3528 extends (0, $a82a8a6a56fb083b$export$f929ba4d0b405b8b) {\n    /** @type {number} */ #baseDirection;\n    /**\n   * Construct aligner. Rotations are worked out counter clockwise from the positive\n   * x axis direction. However, sprites are normally drawn vertically as you look at them;\n   * i.e they are pointing downwards or at -90 degrees from the horizontal axis. You can\n   * set this using the baseDirection parameter.\n   * @param {number} baseDirection - default alignment.\n   * @param {AbstractModifier} decoratedModifier\n   */ constructor(baseDirection = -Math.PI / 2, decoratedModifier){\n        super(decoratedModifier);\n        this.#baseDirection = baseDirection;\n    }\n    /**\n   * Create a VelocityAligner. This is a convenience factory method that automatically\n   * sets the base direction to -90 degrees which is how sprites are normally drawn; i.e. upright\n   * instead of horizontally.\n   * @param {AbstractModifier} decoratedModifier\n   * @returns {VelocityAligner}\n   */ static createUprightAligner(decoratedModifier) {\n        return new $8e5c8f9d0e1a3528$export$9a9871e8ef5d3528(-Math.PI / 2, decoratedModifier);\n    }\n    /**\n   * Align sprite using its velocity.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time\n   * @returns {AbstractModifier}\n   */ doUpdate(sprite, deltaSecondsIgnored) {\n        sprite.position.rotation = sprite.velocity.isZero(0.1) ? 0 : sprite.velocity.getScreenDirection() - this.#baseDirection;\n        return this;\n    }\n}\nclass $8e5c8f9d0e1a3528$export$81812ec41a0682d1 extends (0, $a82a8a6a56fb083b$export$f929ba4d0b405b8b) {\n    /** @type {module:utils/geometry~Point} */ #topLeft;\n    /** @type {module:utils/geometry~Point} */ #bottomRight;\n    /**\n   * @param {module:utils/geometry~Rectangle} bounds\n   * @param {AbstractModifier} decoratedModifier\n   */ constructor(bounds, decoratedModifier){\n        super(decoratedModifier);\n        this.#topLeft = bounds.getTopLeft();\n        this.#bottomRight = bounds.getBottomRight();\n    }\n    /**\n   * Move sprite using its velocity and bouncing on screen.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time\n   * @returns {AbstractModifier}\n   */ doUpdate(sprite, deltaSeconds) {\n        const position = sprite.position;\n        const velocity = sprite.velocity;\n        position.x += velocity.x * deltaSeconds;\n        position.y += velocity.y * deltaSeconds;\n        position.rotation += velocity.rotation * deltaSeconds;\n        if (position.x < this.#topLeft.x || position.x > this.#bottomRight.x) velocity.x *= -1;\n        if (position.y < this.#topLeft.y || position.y > this.#bottomRight.y) velocity.y *= -1;\n        sprite.position = position;\n        sprite.velocity = velocity;\n        return this;\n    }\n}\nclass $8e5c8f9d0e1a3528$export$254d9747e34ddc90 extends (0, $a82a8a6a56fb083b$export$f929ba4d0b405b8b) {\n    /** @type {module:utils/sprites/sprite~Sprite} */ #prey;\n    /** @type {number} */ #maxSeparation;\n    /** @type {number} */ #variableSpeed;\n    /**\n   *\n   * @param {Object} options\n   * @param {module:utils/sprites/sprite~Sprite} options.prey\n   * @param {number} options.maxSeparation - allowable distance between hunter and prey\n   * @param {number} options.speed - pixels / second\n   * @param {boolean} options.linear - if linear the speed is constant, otherwise it speeds up if further away\n   * @param {AbstractModifier} decoratedModifier\n   */ constructor(options, decoratedModifier){\n        super(decoratedModifier);\n        this.#prey = options.prey;\n        this.#maxSeparation = options.maxSeparation;\n        this.#variableSpeed = new $8e5c8f9d0e1a3528$var$VariableSpeed(options.speed, options.linear);\n    }\n    /**\n   * Update the sprite to track the hunter.\n   * @param {module:utils/sprites/sprite~Sprite} hunter\n   * @param {*} deltaSeconds\n   * @returns {AbstractModifier}\n   */ doUpdate(hunter, deltaSeconds) {\n        const preyPos = this.#prey.position;\n        const hunterPos = hunter.position;\n        const approachSpeed = this.#variableSpeed.getSpeedBetweenPoints(preyPos, hunterPos);\n        if (!hunterPos.withinSquare(preyPos, this.#maxSeparation)) {\n            const angle = hunterPos.getCartesianAngleTo(preyPos);\n            hunter.velocity.x = approachSpeed * Math.cos(angle);\n            hunter.velocity.y = approachSpeed * Math.sin(angle);\n            const dx = hunter.velocity.x * deltaSeconds;\n            const dy = hunter.velocity.y * deltaSeconds;\n            hunter.position.x += this.getMinMove(dx, preyPos.x, hunterPos.x);\n            hunter.position.y += this.getMinMove(dy, preyPos.y, hunterPos.y);\n        }\n        return this;\n    }\n    /**\n   * Get the minimum movement to go from targetValue to currentValue.\n   * @param {number} maxMovement - maximum movement. NB. In this context, max ignores sign.\n   * @param {number} targetValue\n   * @param {number} currentValue\n   */ getMinMove(maxMovement, targetValue, currentValue) {\n        const requiredMovement = targetValue - currentValue;\n        if (Math.sign(maxMovement) < 0) return Math.max(maxMovement, requiredMovement);\n        else return Math.min(maxMovement, requiredMovement);\n    }\n}\nclass $8e5c8f9d0e1a3528$export$c14f425b03c3e261 extends (0, $a82a8a6a56fb083b$export$f929ba4d0b405b8b) {\n    /** @type {Point[]} */ #path;\n    /** @type {number} */ #index;\n    /** @type {module:utils/geometry~Point} */ #targetPoint;\n    /** @type {VariableSpeed} */ #variableSpeed;\n    /**\n   *\n   * @param {Object} options\n   * @param {Point[]} options.path\n   * @param {number} options.speed - pixels / second\n   * @param {boolean} options.linear - if linear the speed is constant, otherwise it speeds up if further away\n   * @param {AbstractModifier} decoratedModifier\n   */ constructor(options, decoratedModifier){\n        super(decoratedModifier);\n        this.#path = options.path;\n        this.#index = 0;\n        this.#targetPoint = options.path[0];\n        this.#variableSpeed = new $8e5c8f9d0e1a3528$var$VariableSpeed(options.speed, options.linear);\n    }\n    /**\n   * Perform any cleanup if timeout occurs.\n   * Should be overridden if cleanup necessary. Default does nothing.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @override\n   */ cleanUpOnTimeout(sprite) {\n        // move to the end of the path.\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Transient path follower timed out. Moving to end of path.`);\n        const lastPoint = this.#path[this.#path.length - 1];\n        sprite.position.x = lastPoint.x;\n        sprite.position.y = lastPoint.y;\n        sprite.velocity.x = 0;\n        sprite.velocity.y = 0;\n    }\n    /**\n   * Update the sprite to track the hunter.\n   * @param {module:utils/sprites/sprite~Sprite} subject\n   * @param {*} deltaSeconds\n   * @returns {AbstractModifier}\n   */ doUpdate(subject, deltaSeconds) {\n        const subjectPos = subject.position;\n        const approachSpeed = this.#variableSpeed.getSpeedBetweenPoints(this.#targetPoint, subjectPos);\n        const angle = subjectPos.getCartesianAngleTo(this.#targetPoint);\n        subject.velocity.x = approachSpeed * Math.cos(angle);\n        subject.velocity.y = approachSpeed * Math.sin(angle);\n        const dx = subject.velocity.x * deltaSeconds;\n        const dy = subject.velocity.y * deltaSeconds;\n        subjectPos.x += this.getMinMove(dx, this.#targetPoint.x, subjectPos.x);\n        subjectPos.y += this.getMinMove(dy, this.#targetPoint.y, subjectPos.y);\n        if (subjectPos.isCoincident(this.#targetPoint)) {\n            if (++this.#index >= this.#path.length) {\n                subject.velocity.x = 0;\n                subject.velocity.y = 0;\n                return this.decoratedModifier; // Remove itself from chain\n            } else this.#targetPoint = this.#path[this.#index];\n        }\n        return this;\n    }\n    /**\n   * Get the minimum movement to go from targetValue to currentValue.\n   * @param {number} maxMovement - maximum movement. NB. In this context, max ignores sign.\n   * @param {number} targetValue\n   * @param {number} currentValue\n   */ getMinMove(maxMovement, targetValue, currentValue) {\n        const requiredMovement = targetValue - currentValue;\n        if (Math.sign(maxMovement) < 0) return Math.max(maxMovement, requiredMovement);\n        else return Math.min(maxMovement, requiredMovement);\n    }\n}\nfunction $8e5c8f9d0e1a3528$export$6ade622442e46b50(actor, position) {\n    const pathModifier = new $8e5c8f9d0e1a3528$export$c14f425b03c3e261({\n        path: [\n            position\n        ],\n        speed: 100\n    }, actor.sprite.modifier);\n    return pathModifier.applyAsTransientToSprite(actor.sprite);\n}\n\n\n\n\n\n/**\n * Create a transient sprite\n * @param {module:utils/sprites/spriteRenderers~SpriteCanvasRenderer} renderer\n * @param {Object} options\n * @param {Point} options.position\n * @param {Velocity} options.velocity\n * @param {number} options.delaySecs\n * @param {number} options.lifetimeSecs\n */ function $8f3da527d9ba55fc$var$createFadingSprite(renderer, options) {\n    const sprite = new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n        renderer: renderer\n    });\n    sprite.position = options.position;\n    sprite.velocity = options.velocity ?? new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 0);\n    sprite.acceleration = options.acceleration ?? new (0, $9181799b149b64a5$export$5086e02bc6b47824)(0, 0, 0);\n    (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).addPassiveSprite(sprite);\n    new (0, $a94d5993e44fff52$export$709baf898a5dceda)(options.delaySecs, options.lifetimeSecs, new (0, $8e5c8f9d0e1a3528$export$9600794ac1f85e81)()).applyAsTransientToSprite(sprite, 20).then(()=>(0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).removePassiveSprite(sprite));\n}\nfunction $8f3da527d9ba55fc$export$5b6dfdcdc3ef8663(image, options) {\n    $8f3da527d9ba55fc$var$createFadingSprite(new (0, $aa0468ffbc97dbfc$export$c1626e6e036a584)((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), image), options);\n}\nfunction $8f3da527d9ba55fc$export$ae52c687d6df348d(imageRootName, options) {\n    const image = new (0, $305a56b3d2c1570b$export$9d5734c725768403)({\n        prefix: imageRootName,\n        suffix: \".png\",\n        startIndex: 0,\n        padding: 2\n    }, {\n        framePeriodMs: 300,\n        loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).REVERSE\n    });\n    $8f3da527d9ba55fc$var$createFadingSprite(new (0, $aa0468ffbc97dbfc$export$c1626e6e036a584)((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), image), options);\n}\nfunction $8f3da527d9ba55fc$export$dc0b517182376fca(text, options) {\n    $8f3da527d9ba55fc$var$createFadingSprite(new (0, $aa0468ffbc97dbfc$export$544ff2c168abc0f9)((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), text, {\n        color: options.color\n    }), options);\n}\nfunction $8f3da527d9ba55fc$export$a8de794734f9d855(text, position, color = \"white\") {\n    $8f3da527d9ba55fc$export$dc0b517182376fca(text, {\n        color: color,\n        delaySecs: 2,\n        lifetimeSecs: 3,\n        position: new (0, $9181799b149b64a5$export$baf26146a414f24a)(position.x, position.y),\n        velocity: new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, -48, 0),\n        acceleration: new (0, $9181799b149b64a5$export$5086e02bc6b47824)(0, -96, 0)\n    });\n}\n\n\n\n\n\n/**\n * @file Dialogs for use in the game\n *\n * @module utils/dom/ui\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Classes for managing menus.\n *\n * @module utils/dom/menu\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Game constants\n *\n * @module gameutils/gameConstants\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ const $8da6ce05f7802627$var$GameConstants = {\n    TILE_SIZE: 48\n};\nvar $8da6ce05f7802627$export$2e2bcd8739ae039 = $8da6ce05f7802627$var$GameConstants;\n\n\n/**\n * @file Settings\n *\n * @module utils/persistenData\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Simple hashes\n *\n * @module utils/hashes\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * Simple 32 bit hash code. Only for simple hashing.\n * Based on {@link https://stackoverflow.com/questions/18803505/javascript-hashing-algorithm}\n * Note the last line hash | 0 forces 32 bit result. See {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_OR}\n */ function $fea791d11ccfd744$export$73876a7ce00cb028(str) {\n    var hash = 0;\n    for(let i = 0; i < str.length; i++){\n        const chr = str.charCodeAt(i);\n        hash = (hash << 5) - hash + chr;\n        hash = hash | 0;\n    }\n    return Math.abs(hash).toString(16).toLowerCase().padStart(8, \"0\");\n}\n\n\n/**\n * @typedef {Object} ObjectJSON\n * @property {string} reviver - name of the reviver to be called.\n * @property {*} value - value to be passed to the reviver\n */ /** Encapsulate storage. */ class $f0a94f3b2f305120$var$PersistentData {\n    /** @type {Storage}   */ #storage;\n    /**\n   * Cached objects so they don't need to be reparsed.\n   * @type {Map<string, *>}\n   */ #cache;\n    /**\n   * Create persistent data object.\n   */ constructor(){\n        this.#storage = localStorage;\n        this.#cache = new Map();\n    }\n    /**\n   * Set value\n   * @param {string} key\n   * @param {*} value\n   */ set(key, value) {\n        this.#cache.set(key, value);\n        try {\n            this.#storage.setItem(key, this.toChecksummed(JSON.stringify(value)));\n        } catch (error) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Cannot save setting. ${error.message}`);\n        }\n    }\n    /**\n   * Get a value. Uses the cache if already set.\n   * @param {string} key\n   * @param {*} defaultValue\n   * @param {function(key,value)} reviver - reviver function for JSON.parse\n   * @returns {*} stored data or default value if not present or unparsable.\n   */ get(key, defaultValue, reviver) {\n        if (this.#cache.has(key)) return this.#cache.get(key);\n        let value = defaultValue;\n        try {\n            const encodedValue = this.#storage.getItem(key);\n            if (encodedValue !== null) value = JSON.parse(this.fromChecksummed(encodedValue), reviver);\n        } catch (error) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Cannot parse value from local storage. ${error.message}`);\n        }\n        this.#cache.set(key, value);\n        return value;\n    }\n    /**\n   * Clear everything\n   */ clearAll() {\n        this.#storage.clear();\n        this.#cache.clear();\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"All local storage cleared.\");\n    }\n    /**\n   * Set the storage object. This is normally only used for test purposes.\n   * @param {Storage} storage\n   */ setStorage(storage) {\n        this.#storage = storage;\n    }\n    /**\n   * Convert data to JSON and then add a checksum prefix.\n   * @param {string} str\n   * @returns {string}\n   */ toChecksummed(str) {\n        const hash = (0, $fea791d11ccfd744$export$73876a7ce00cb028)(str);\n        return `${hash}*${str}`;\n    }\n    /**\n   * Get the original string from a checksummed version.\n   * @param {*} checksummedStr\n   * @returns {string} data without the checksum\n   * @throws {Error}\n   */ fromChecksummed(checksummedStr) {\n        const matches = checksummedStr.match(/^([a-z0-9]{8})\\*(.*)$/);\n        if (matches) {\n            const checksum = matches[1];\n            const data = matches[2];\n            if (checksum === (0, $fea791d11ccfd744$export$73876a7ce00cb028)(data)) return matches[2];\n            else throw new Error(\"Invalid checksum\");\n        }\n        throw new Error(\"Invalid format\");\n    }\n}\nconst $f0a94f3b2f305120$var$PERSISTENT_DATA = new $f0a94f3b2f305120$var$PersistentData();\nvar $f0a94f3b2f305120$export$2e2bcd8739ae039 = $f0a94f3b2f305120$var$PERSISTENT_DATA;\n\n\n/**\n * Base control\n */ class $58ea3f4a4bcc116e$var$BaseControl {\n    /**\n   * @type {string}\n   */ #id;\n    /**\n   * @type {Element}\n   */ _element;\n    /** @type {*} */ #value;\n    /** @type {boolean} */ #persistent;\n    /** @type {boolean} */ closes;\n    /**\n   * Create base control\n   * @param {Object} options\n   * @param {boolean} options.persistent - is data stored in persistent storage.\n   * @param {*} options.defValue - default value\n   * @param {boolean} options.closes - flag to indicate whether this control should be used\n   * to close a dialog or form when clicked.\n   */ constructor(options){\n        if (options.closes && options.action) throw new Error(`Attempt made to create control that is set to close forms and perform and action. These are mutually exclusive.`);\n        if (options.persistent && !options.id) throw new Error(\"Persistent controls must have an ID set in the options.\");\n        this.#id = options.id;\n        this.#persistent = options.persistent;\n        if (options.persistent) this.#value = (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).get(this.#id, options.defValue);\n        else this.#value = options.defValue;\n        this.closes = options.closes;\n        this.listeners = 0;\n    }\n    /**\n   * Get the underlying element\n   * @returns {Element}\n   */ get element() {\n        return this._element;\n    }\n    /**\n   *\n   * @returns {*}\n   */ get value() {\n        return this.#value;\n    }\n    /**\n   * Set the value.\n   * @param {*} value\n   */ set value(value) {\n        if (value === this.#value) return;\n        if (this.#persistent) (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).set(this.#id, value);\n        this.#value = value;\n    }\n}\nclass $58ea3f4a4bcc116e$export$3e9165d18613c27e extends $58ea3f4a4bcc116e$var$BaseControl {\n    /** Create the button.\n   * @param {Object} options - see BaseControl plus\n   * @param {string} options.label\n   * @param {function():Promise} options.action - function called on click.\n   */ constructor(options){\n        super(options);\n        this._element = this.buildElement(options);\n        if (options.action) this._element.addEventListener(\"click\", ()=>options.action());\n    }\n    /**\n   * @param {Object} options - see Constructor.\n   * @returns {Element}\n   */ buildElement(options) {\n        const element = document.createElement(\"button\");\n        element.appendChild(document.createTextNode(options.label));\n        element.className = \"text-button\";\n        return element;\n    }\n}\nclass $58ea3f4a4bcc116e$export$5519a977876d156d extends $58ea3f4a4bcc116e$var$BaseControl {\n    /** Create the button.\n   * @param {Object} options - see BaseControl. Plus\n   * @param {string} options.leftLabel\n   * @param {string} options.rightLabel\n   * @param {function():Promise} options.action - function called on click.\n   * @param {string} imageName\n   */ constructor(options){\n        super(options);\n        this._element = this.buildElement(options);\n        if (options.action) this._element.addEventListener(\"click\", ()=>options.action());\n    }\n    /**\n   * @param {Object} options - see Constructor.\n   * @returns {Element}\n   */ buildElement(options) {\n        const element = document.createElement(\"button\");\n        if (options.leftLabel) element.appendChild(document.createTextNode(options.leftLabel));\n        element.appendChild($58ea3f4a4bcc116e$export$f119f65a5d88757e(options.imageName, \"button-icon\"));\n        if (options.rightLabel) element.appendChild(document.createTextNode(options.rightLabel));\n        element.className = \"icon-button\";\n        return element;\n    }\n}\nfunction $58ea3f4a4bcc116e$export$f119f65a5d88757e(imageName, className) {\n    const bitmapImage = (0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(imageName ?? \"undefined.png\", {\n        fallback: \"undefined.png\"\n    });\n    const canvas = document.createElement(\"canvas\");\n    canvas.setAttribute(\"width\", (0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE);\n    canvas.setAttribute(\"height\", (0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE);\n    const context = canvas.getContext(\"2d\");\n    context.clearRect(0, 0, (0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE, (0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE);\n    context.drawImage(bitmapImage.image, 0.5 * ((0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE - bitmapImage.width), 0.5 * ((0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE - bitmapImage.height));\n    canvas.className = className;\n    return canvas;\n}\n/**\n * Create a checkbox control\n */ class $58ea3f4a4bcc116e$var$CheckboxControl extends $58ea3f4a4bcc116e$var$BaseControl {\n    /** @type {Element} */ #checkbox;\n    /**\n   * Create the CheckboxControl\n   * @param {ControlDefinition} options - see Base control plus\n   * @param {string} options.label\n   */ constructor(options){\n        super(options);\n        this._element = this.buildElement(options.label);\n        this.#checkbox.checked = this.value;\n        this._element.addEventListener(\"change\", (eventUnused)=>{\n            this.value = this.#checkbox.checked;\n            if (options.onChange) options.onChange(this.value);\n        });\n    }\n    /**\n   * Build the element\n   * @param {string} label\n   * @returns {Element}\n   */ buildElement(label) {\n        const checkboxContainer = document.createElement(\"span\");\n        checkboxContainer.className = \"styled-checkbox\";\n        this.#checkbox = document.createElement(\"input\");\n        this.#checkbox.setAttribute(\"type\", \"checkbox\");\n        checkboxContainer.appendChild(this.#checkbox);\n        checkboxContainer.appendChild($58ea3f4a4bcc116e$export$f119f65a5d88757e(\"ui-checkbox00.png\", \"unchecked\"));\n        checkboxContainer.appendChild($58ea3f4a4bcc116e$export$f119f65a5d88757e(\"ui-checkbox01.png\", \"checked\"));\n        const element = document.createElement(\"label\");\n        element.appendChild(document.createTextNode(label));\n        element.appendChild(checkboxContainer);\n        return element;\n    }\n}\nclass $58ea3f4a4bcc116e$export$432a14a187a97cae extends $58ea3f4a4bcc116e$var$BaseControl {\n    /** @type {Element} */ #rangeInput;\n    /**\n   * Create the RangeControl\n   * @param {ControlDefinition} options - see BaseControl plus\n   * @param {string} options.label\n   */ constructor(options){\n        super(options);\n        this._element = this.buildElement(options.label);\n        this.#rangeInput.value = this.value;\n        this._element.addEventListener(\"change\", (eventUnused)=>{\n            this.value = this.#rangeInput.value;\n            if (options.onChange) options.onChange(this.value);\n        });\n    }\n    /**\n   * Build the element\n   * @param {string} label\n   * @returns {Element}\n   */ buildElement(label) {\n        const rangeContainer = document.createElement(\"span\");\n        rangeContainer.className = \"styled-range\";\n        this.#rangeInput = document.createElement(\"input\");\n        this.#rangeInput.setAttribute(\"type\", \"range\");\n        rangeContainer.appendChild(this.#rangeInput);\n        const element = document.createElement(\"label\");\n        element.appendChild(document.createTextNode(label));\n        element.appendChild(rangeContainer);\n        return element;\n    }\n}\nconst $58ea3f4a4bcc116e$export$82f9c7d14b0424b = {\n    TEXT_BUTTON: \"text button\",\n    CHECKBOX: \"checkbox\",\n    RANGE: \"range\"\n};\nfunction $58ea3f4a4bcc116e$export$b42320c90cd2b176(definition) {\n    let control;\n    switch(definition.controlType){\n        case $58ea3f4a4bcc116e$export$82f9c7d14b0424b.CHECKBOX:\n            control = new $58ea3f4a4bcc116e$var$CheckboxControl(definition);\n            break;\n        case $58ea3f4a4bcc116e$export$82f9c7d14b0424b.RANGE:\n            control = new $58ea3f4a4bcc116e$export$432a14a187a97cae(definition);\n            break;\n        case $58ea3f4a4bcc116e$export$82f9c7d14b0424b.TEXT_BUTTON:\n            control = new $58ea3f4a4bcc116e$export$3e9165d18613c27e(definition);\n            break;\n        default:\n            throw new Error(`Attempt to create unrecognised control type ${definition.controlType}`);\n    }\n    return control;\n}\nfunction $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(tagName, options = {}) {\n    const element = document.createElement(tagName);\n    if (options.className) element.className = options.className;\n    if (options.html) element.innerHTML = options.html;\n    else if (options.text) element.innerText = options.text;\n    if (options.child) element.appendChild(options.child);\n    return element;\n}\n\n\n/**\n * @file Message manager. Wrapper for all ui messages.\n *\n * @module utils/messageManager\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @type{Map<string, string}\n */ let $e6f3aae57afc1cde$var$messages;\n/**\n * Add text to the messages.\n * @param {Map<string, string>} messageMap\n */ function $e6f3aae57afc1cde$var$setMap(messageMap) {\n    $e6f3aae57afc1cde$var$messages = messageMap;\n}\n/**\n * Get a message based on the key.\n * If the value is an array, a random element from the array is chosen.\n * This is to allow variable messages.\n * @param {string} key\n */ function $e6f3aae57afc1cde$var$getText(key) {\n    const value = $e6f3aae57afc1cde$var$messages?.get(key);\n    if (value === undefined || value === null) return key;\n    if (Array.isArray(value)) return value[$95fc563048a48bb6$export$b141de964f0a90c1(0, value.length)];\n    return value;\n}\nfunction $e6f3aae57afc1cde$export$a7357cdd1f0b0168(strings, ...values) {\n    let result = \"\";\n    let key;\n    for (const str of strings){\n        const trimmed = str.trim();\n        if (trimmed !== \"\") {\n            key = trimmed;\n            break;\n        }\n    }\n    if (!key) return values ? values.join(\" \") : \"\";\n    result = $e6f3aae57afc1cde$var$getText(key);\n    values.forEach((value, index)=>{\n        const placeHolder = new RegExp(`\\\\$\\\\{${index}[a-zA-Z_-]*\\\\}`);\n        result = result.replace(placeHolder, value);\n    });\n    return result;\n}\nconst $e6f3aae57afc1cde$export$af7faffe10421f14 = {\n    setMap: $e6f3aae57afc1cde$var$setMap,\n    getText: $e6f3aae57afc1cde$var$getText\n};\n\n\n/**\n * @file CLass to handle routines to improve power management\n *\n * @module gameManagement/powerManager\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/** Class to manage the main animation state. */ class $58e6413bb4f15583$var$AnimationState {\n    /** Function to call when starting animation @type{function} */ onStartAnimation;\n    /** @type {boolean} */ #animationState;\n    /** Used by blur and focus events to restore state @type {boolean} */ #savedAnimationState;\n    /** Construct the animation state. */ constructor(){\n        this.#animationState = false;\n        this.#savedAnimationState = undefined;\n        window.addEventListener(\"blur\", ()=>{\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Blur: current animation state ${this.#animationState}`);\n            this.#savedAnimationState = this.#animationState;\n            this.setAnimationState(false);\n        });\n        window.addEventListener(\"focus\", ()=>{\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Focus: saved animation state ${this.#savedAnimationState}`);\n            this.setAnimationState(this.#savedAnimationState ?? true);\n            this.#savedAnimationState = undefined; // This is to allow for debugger issue where focus can fire without preceding blur.\n        });\n    }\n    /**\n   * Set the animation state.\n   * @param {boolean} state\n   */ setAnimationState(state) {\n        if (state !== this.#animationState) {\n            this.#animationState = state;\n            if (this.#animationState && this.onStartAnimation) this.onStartAnimation();\n        }\n    }\n    /**\n   * @returns {boolean}\n   */ isAnimationOn() {\n        return this.#animationState;\n    }\n}\n/** Singleton animation state */ const $58e6413bb4f15583$var$ANIMATION_STATE_MANAGER = new $58e6413bb4f15583$var$AnimationState();\nvar $58e6413bb4f15583$export$2e2bcd8739ae039 = $58e6413bb4f15583$var$ANIMATION_STATE_MANAGER;\n\n\nconst $3a28f16acdd0ba47$export$c2043c90d147849d = {\n    OK: 0,\n    CANCEL: 1,\n    YES: 2,\n    NO: 3\n};\n/**\n * Called when a dialog is opened.\n */ function $3a28f16acdd0ba47$var$prepareDialog() {\n    (0, $58e6413bb4f15583$export$2e2bcd8739ae039).setAnimationState(false);\n}\n/**\n * Called when a dialog is closed.\n */ function $3a28f16acdd0ba47$var$tearDownDialog() {\n    (0, $58e6413bb4f15583$export$2e2bcd8739ae039).setAnimationState(true);\n}\n/**\n * Wrapper for SCREEN.displayOnGlass but calling tearDownDialog at end.\n * @param {HTMLElement} element\n * @param {Object} options\n * @param {Closers[]} options.closers - array of Closers. If not provided then the entire display\n * is used.\n * @param {string} options.className\n * @param {boolean} options.replace - replace current glass\n * @returns {Promise} fulfils to closers.closes value\n */ function $3a28f16acdd0ba47$var$displayOnGlass(element, options) {\n    return (0, $7aed85f370071bde$export$2e2bcd8739ae039).displayOnGlass(element, options).then((response)=>{\n        $3a28f16acdd0ba47$var$tearDownDialog();\n        return response;\n    });\n}\n/**\n * Get a message element. This returns a div which contains the message text.\n * @param {string | string[]} message\n * @param {string} title\n */ function $3a28f16acdd0ba47$var$createMessageElement(message, title) {\n    const element = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"dialog-scroll-content\"\n    });\n    if (title) element.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        className: \"dialog-title\",\n        text: title\n    }));\n    if (Array.isArray(message)) for (const paragraph of message)element.appendChild($3a28f16acdd0ba47$var$createMessageElement(paragraph));\n    else element.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        text: message\n    }));\n    element.classList.add([\n        \"scrollable\"\n    ]);\n    return element;\n}\n/** Create a message that is removed on any click. This sits above everything\n * as a self contained popup.\n * @param {string} message - message for the message manager.\n */ function $3a28f16acdd0ba47$var$showMessage(message) {\n    const popup = document.createElement(\"div\");\n    popup.appendChild(document.createTextNode(message));\n    popup.className = \"popup\";\n    popup.style.opacity = 1;\n    document.body.appendChild(popup);\n    popup.addEventListener(\"click\", ()=>popup.remove());\n}\n/**\n * Displays a popup element. A background glass layer is shown behind the popup\n * This is displayed in a similar way to showMessage but with the difference that\n * no event listener is added to close the popup. This is the responsibility of\n * the caller who should use the returned element to close it.\n * @param {Element} element\n * @returns {Element} the popup element.\n */ function $3a28f16acdd0ba47$var$popupElement(element) {\n    const popup = document.createElement(\"div\");\n    popup.className = \"popup\";\n    const popupInner = document.createElement(\"div\");\n    popup.appendChild(popupInner);\n    popupInner.appendChild(element);\n    popup.style.opacity = 1;\n    document.body.appendChild(popup);\n    return popup;\n}\n/** Create an okDialog.\n * @param {string | string[]} message\n * @param {Object} [options = {}]\n * @param {string} [options.okButtonLabel = i18n`BUTTON OK`]\n * @param {string} options.className\n * @param {string} options.title\n * @returns {Promise} fulfils to DialogResponse.OK\n */ function $3a28f16acdd0ba47$var$showOkDialog(message, options = {}) {\n    $3a28f16acdd0ba47$var$prepareDialog();\n    const container = document.createElement(\"div\");\n    container.appendChild($3a28f16acdd0ba47$var$createMessageElement(message, options.title));\n    const buttonEl = document.createElement(\"button\");\n    buttonEl.appendChild(document.createTextNode(options.okButtonLabel ?? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON OK`));\n    container.appendChild(buttonEl);\n    return $3a28f16acdd0ba47$var$displayOnGlass(container, {\n        className: options?.className,\n        closers: [\n            {\n                element: buttonEl,\n                closes: $3a28f16acdd0ba47$export$c2043c90d147849d.OK\n            }\n        ]\n    });\n}\n/**\n * Create a choice dialog.\n * @param {string} title\n * @param {string | Element} message\n * @param {string[]} choices - labels for buttons.\n * @param {string} className - class name for the dialog.\n * @returns {number} index of selected button.\n */ function $3a28f16acdd0ba47$var$showChoiceDialog(title, message, choices, className) {\n    const container = document.createElement(\"div\");\n    container.appendChild($3a28f16acdd0ba47$var$createMessageElement(message, title));\n    const actionButtons = [];\n    choices?.forEach((choice, index)=>{\n        const button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            label: choice,\n            closes: index\n        });\n        actionButtons.push(button);\n    });\n    return $3a28f16acdd0ba47$var$showControlsDialog(message, {\n        preamble: title,\n        actionButtons: actionButtons,\n        row: true,\n        className: className\n    });\n}\n/** Create an ok Dialog but just showing a precreate element.\n * @param {string} title\n * @param {Element} element\n * @param {string} [okButtonLabel = 'BUTTON OK']\n * @param {string} className\n * @returns {Promise} fulfils to DialogResponse.OK\n */ function $3a28f16acdd0ba47$var$showElementOkDialog(title, element, okButtonLabel = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON OK`, className) {\n    $3a28f16acdd0ba47$var$prepareDialog();\n    const container = document.createElement(\"div\");\n    const scrollContainer = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"dialog-scroll-content\"\n    });\n    container.appendChild(scrollContainer);\n    if (title) scrollContainer.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        className: \"dialog-title\",\n        text: title\n    }));\n    scrollContainer.appendChild(element);\n    const buttonEl = document.createElement(\"button\");\n    buttonEl.appendChild(document.createTextNode(okButtonLabel));\n    container.appendChild(buttonEl);\n    return $3a28f16acdd0ba47$var$displayOnGlass(container, {\n        closers: [\n            {\n                element: buttonEl,\n                closes: $3a28f16acdd0ba47$export$c2043c90d147849d.OK\n            }\n        ],\n        className: className\n    });\n}\n/** Create a controls dialog.\n * @param {string | Element} mainContent -message or element to show..\n * @param {Object} options\n * @param {Object} options.title - title\n * @param {string | Element} options.preamble - text placed before content..\n * @param {BaseControl[]} options.actionButtons\n * @param {boolean} options.row - if true, controls are in a row rather than the\n * default column.\n * @param {string} options.className\n * @param {string} options.okButtonLabel\n * @returns {Promise} fulfils to closures response value or DialogResponse.OK if\n * no closers.\n */ function $3a28f16acdd0ba47$var$showControlsDialog(mainContent, options = {}) {\n    $3a28f16acdd0ba47$var$prepareDialog();\n    const container = document.createElement(\"div\");\n    const scrollContainer = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"dialog-scroll-content\"\n    });\n    container.appendChild(scrollContainer);\n    if (options.title) scrollContainer.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        className: \"dialog-title\",\n        text: options.title\n    }));\n    if (options.preamble) {\n        if (options.preamble instanceof Element) scrollContainer.appendChild(options.preamble);\n        else scrollContainer.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n            text: options.preamble\n        }));\n    }\n    if (mainContent instanceof Element) scrollContainer.appendChild(mainContent);\n    else scrollContainer.appendChild($3a28f16acdd0ba47$var$createMessageElement(mainContent));\n    const actionButtons = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: options.row ? \"action-buttons-row\" : \"action-buttons-col\"\n    });\n    container.appendChild(actionButtons);\n    const closers = [];\n    options?.actionButtons?.forEach((button)=>{\n        if (!button.element.parentElement) actionButtons.appendChild(button.element);\n        if (button.closes !== null && button.closes !== undefined) closers.push({\n            element: button.element,\n            closes: button.closes\n        });\n    });\n    if (closers.length === 0) {\n        const okButton = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            id: $3a28f16acdd0ba47$export$c2043c90d147849d.OK,\n            label: options.okButtonLabel ?? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON OK`\n        });\n        actionButtons.appendChild(okButton.element);\n        closers.push(okButton);\n    }\n    return $3a28f16acdd0ba47$var$displayOnGlass(container, {\n        closers: closers,\n        className: options?.className\n    });\n}\n/**\n * The UI singleton.\n */ const $3a28f16acdd0ba47$var$UI = {\n    popupElement: $3a28f16acdd0ba47$var$popupElement,\n    showChoiceDialog: $3a28f16acdd0ba47$var$showChoiceDialog,\n    showMessage: $3a28f16acdd0ba47$var$showMessage,\n    showOkDialog: $3a28f16acdd0ba47$var$showOkDialog,\n    showElementOkDialog: $3a28f16acdd0ba47$var$showElementOkDialog,\n    showControlsDialog: $3a28f16acdd0ba47$var$showControlsDialog\n};\nvar $3a28f16acdd0ba47$export$2e2bcd8739ae039 = $3a28f16acdd0ba47$var$UI;\n\n\n/**\n * @file Sound manager\n *\n * @module utils/soundManager\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * Sound manager\n */ class $6f0e758381e3257c$var$SoundManager {\n    /** @type {Map<string, Audio>} */ #effects;\n    /** @type {Audio} */ #music;\n    /** @type {number} */ #musicVolume;\n    /** @type {number} */ #effectsVolume;\n    /**\n   * Construct.\n   */ constructor(){\n        this.#musicVolume = 0.5;\n        this.#effectsVolume = 0.5;\n        this.#effects = new Map();\n    }\n    /**\n   * Load and play music.\n   * @param {string} path - path to music\n   */ loadAndPlayMusic(path) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Loading music ${path}`);\n        if (this.#music) throw new Error(\"Only one music track currently supported.\");\n        this.#music = this.#createAudioIfNotNull(path);\n        if (this.#music) this.#music.addEventListener(\"canplay\", (eventUnused)=>{\n            this.#music.volume = this.#musicVolume;\n            this.#music.loop = true;\n            this.#playMusic();\n            window.addEventListener(\"blur\", ()=>{\n                this.#music.pause();\n            });\n            window.addEventListener(\"focus\", ()=>{\n                this.#playMusic();\n            });\n        });\n    }\n    /**\n   * Load the audio sounds.\n   * @param {Map<string, string>} audioPaths\n   * @returns {Promise} fulfils to undefined\n   */ loadEffects(audioPaths) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Loading sound effects.`);\n        audioPaths.forEach((path, key)=>{\n            const audio = this.#createAudioIfNotNull(path);\n            if (audio) this.#effects.set(key, audio);\n        });\n        return Promise.resolve();\n    }\n    /**\n   * Load the audio if not null\n   * @param {string} url\n   * @returns {Audio} new audio object or null if url is null.\n   */ #createAudioIfNotNull(url) {\n        return url ? new Audio(url) : null;\n    }\n    /**\n   * Play an effect.\n   */ playEffect(key) {\n        if (this.#effectsVolume <= 0.001) return;\n        const effect = this.#effects.get(key);\n        if (effect && effect.readyState >= 3) {\n            effect.volume = this.#effectsVolume;\n            effect.play();\n        }\n    }\n    /**\n   * Set the music volume.\n   * @param {number} percent\n   */ setMusicVolumePercent(percent) {\n        const currentVolume = this.#musicVolume;\n        this.#musicVolume = percent / 100;\n        if (this.#music) {\n            this.#music.volume = this.#musicVolume;\n            if (currentVolume < 0.001 && this.#musicVolume >= 0.001) {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Restarted playing music because of volume change.\");\n                this.#music.play();\n            } else if (this.#musicVolume < 0.001) {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Paused playing music because of low volume.\");\n                this.#music.pause();\n            }\n        }\n    }\n    /**\n   * Play music if volume high enough\n   */ #playMusic() {\n        if (!this.#music) return;\n        if (this.#musicVolume >= 0.001) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Restarted playing music.\");\n            this.#music.play();\n        } else (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Volume too low to start playing music.\");\n    }\n    /**\n   * Set the music volume.\n   * @param {number} percent\n   */ setEffectsVolumePercent(percent) {\n        this.#effectsVolume = percent / 100;\n    }\n}\nconst $6f0e758381e3257c$var$SOUND_MANAGER = new $6f0e758381e3257c$var$SoundManager();\nvar $6f0e758381e3257c$export$2e2bcd8739ae039 = $6f0e758381e3257c$var$SOUND_MANAGER;\n\n\n/**\n * @file Dialogs to show details of actors.\n *\n * @module dialogs/actorDialogs\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n\n/**\n * @file Artefacts\n * Artefacts are items that exist in the game but are never rendered in the\n * tile map. They can be stored, or worn. Examples are money and weapons. They can\n * be held by actors, typically a trader or hiddenArtefact.\n * @module players/artefacts\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Coins\n *\n * @module game/coins\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \nconst $f4fc9532da3395ea$var$COIN_REGEX = /^ *(\\d+(?:\\.\\d*)?) *([a-zA-Z]+) *$/;\nconst $f4fc9532da3395ea$var$EXCHANGE_RATE_TO_GOLD = new Map([\n    [\n        \"PP\",\n        10\n    ],\n    [\n        \"GP\",\n        1\n    ],\n    [\n        \"SP\",\n        0.1\n    ],\n    [\n        \"CP\",\n        0.01\n    ]\n]);\nfunction $f4fc9532da3395ea$export$b0d0adc40593e6c1(coinDefn) {\n    let valueFace = 0;\n    let valueGp = 0;\n    const parts = coinDefn.match($f4fc9532da3395ea$var$COIN_REGEX);\n    if (!parts) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Unrecognised coin \"${coinDefn}\". Value set to zero.`);\n        return {\n            valueFace: 0,\n            valueGp: 0,\n            type: \"GP\"\n        };\n    } else {\n        valueFace = parts[1];\n        const exchangeRate = $f4fc9532da3395ea$var$EXCHANGE_RATE_TO_GOLD.get(parts[2]) ?? 0;\n        valueGp = parseFloat(parts[1]) * exchangeRate;\n    }\n    return {\n        valueFace: valueFace,\n        valueGp: valueGp,\n        type: parts[2]\n    };\n}\nfunction $f4fc9532da3395ea$export$51c187ac2e2bbbe8(coinDefn) {\n    return $f4fc9532da3395ea$export$b0d0adc40593e6c1(coinDefn).valueGp;\n}\nfunction $f4fc9532da3395ea$export$ea0330bb743bb1f5(coinDefn, coinType) {\n    const gp = $f4fc9532da3395ea$export$51c187ac2e2bbbe8(coinDefn);\n    const exchangeRate = $f4fc9532da3395ea$var$EXCHANGE_RATE_TO_GOLD.get(coinType);\n    if (exchangeRate) {\n        const value = gp / exchangeRate;\n        return `${value.toFixed(2)} ${coinType}`;\n    }\n    return `0 ${coinType}`; // worthless in this currency\n}\nfunction $f4fc9532da3395ea$export$1df1004f151c8ed5(gp) {\n    return `${gp.toFixed(2)} GP`;\n}\nfunction $f4fc9532da3395ea$export$c3ea19e5141a48b4(gp) {\n    return `${gp.toFixed(2)}\\u{00A0}GP`;\n}\n\n\n/**\n * @file Build artefact\n *\n * @module dnd/almanacs/artefactBuilder\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n/**\n * @file Dungeon and dragons properties\n *\n * @module dnd/traits\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Simulation of dice\n *\n * @module utils/dice\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\nconst $a4035ea4d528e431$var$MULTIDICE_REGEX = /(\\d+)[dD](\\d+)(?: *([+-]) *(\\d+))?/;\nfunction $a4035ea4d528e431$export$b9d1fef74bbc4c0c(sides = 6) {\n    return $95fc563048a48bb6$export$75c671db1a13cf5f(1, sides);\n}\nfunction $a4035ea4d528e431$export$1ca6b1641ccbf456(str) {\n    return $a4035ea4d528e431$var$MULTIDICE_REGEX.test(str);\n}\nfunction $a4035ea4d528e431$export$7fa777a3b7eeb6e3(dice) {\n    if (!dice) return 1;\n    if (Number.isInteger(dice)) return $a4035ea4d528e431$export$b9d1fef74bbc4c0c(dice);\n    const details = $a4035ea4d528e431$export$39e91293370042d8(dice);\n    if (!details) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`String ${dice} not recognised as a dice roll. Defaulting to 1D1.`);\n        return 1;\n    }\n    let result = 0;\n    for(let roll = 0; roll < details.qty; roll++)result += $a4035ea4d528e431$export$b9d1fef74bbc4c0c(parseInt(details.sides));\n    result += details.offset;\n    return result;\n}\nfunction $a4035ea4d528e431$export$9ceb90c5f924ec24(dice) {\n    const details = $a4035ea4d528e431$export$39e91293370042d8(dice);\n    if (!details) return 1;\n    return details.qty * (details.sides + details.offset);\n}\nfunction $a4035ea4d528e431$export$f93f53a0782fdb15(diceA, diceB) {\n    return $a4035ea4d528e431$export$9ceb90c5f924ec24(diceA) > $a4035ea4d528e431$export$9ceb90c5f924ec24(diceB) ? diceA : diceB;\n}\nfunction $a4035ea4d528e431$export$4f1346faf378181a(dice, delta) {\n    const details = $a4035ea4d528e431$export$39e91293370042d8(dice);\n    if (!details) return dice;\n    details.qty = Math.max(details.qty + delta, 0);\n    return $a4035ea4d528e431$export$6b42f955a363be6b(details);\n}\nfunction $a4035ea4d528e431$export$39e91293370042d8(dice) {\n    const match = dice?.match($a4035ea4d528e431$var$MULTIDICE_REGEX);\n    if (!match) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Invalid dice format: ${dice}`);\n        return {\n            qty: 0,\n            sides: 0,\n            offset: 0\n        };\n    }\n    const qty = parseInt(match[1]);\n    const sides = parseInt(match[2]);\n    const offsetSign = match[3];\n    let offset = match[4] ? parseInt(match[4]) : 0;\n    if (offsetSign === \"-\") offset = -offset;\n    return {\n        qty: qty,\n        sides: sides,\n        offset: offset\n    };\n}\nfunction $a4035ea4d528e431$export$6b42f955a363be6b(details) {\n    if (!details) return \"\";\n    else if (details.offset) return `${details.qty}D${details.sides}+${details.offset}`;\n    else return `${details.qty}D${details.sides}`;\n}\n\n\n/**\n * @file Tables for DND\n *\n * @module dnd/tables\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \nconst $1b84b6462a079121$var$CHALLENGE_XP_TABLE = [\n    10,\n    200,\n    450,\n    700,\n    1100,\n    1800,\n    2300,\n    2900,\n    3900,\n    5000,\n    5900,\n    7200,\n    8400,\n    10000,\n    11500,\n    13000,\n    15000,\n    18000,\n    20000,\n    22000,\n    25000,\n    33000,\n    41000,\n    50000,\n    62000,\n    75000,\n    90000,\n    105000,\n    120000,\n    135000,\n    155000\n];\n/** advancement table. NB. this is zero based whereas level is 1 based.\n * Refer to Beyond 1st Level, p56 in https://media.wizards.com/2023/downloads/dnd/SRD_CC_v5.1.pdf\n */ const $1b84b6462a079121$var$ADVANCEMENT_TABLE = [\n    {\n        exp: 0,\n        profBonus: 2\n    },\n    {\n        exp: 300,\n        profBonus: 2\n    },\n    {\n        exp: 900,\n        profBonus: 2\n    },\n    {\n        exp: 2700,\n        profBonus: 2\n    },\n    {\n        exp: 6500,\n        profBonus: 3\n    },\n    {\n        exp: 14000,\n        profBonus: 3\n    },\n    {\n        exp: 23000,\n        profBonus: 3\n    },\n    {\n        exp: 34000,\n        profBonus: 3\n    },\n    {\n        exp: 48000,\n        profBonus: 4\n    },\n    {\n        exp: 64000,\n        profBonus: 4\n    },\n    {\n        exp: 85000,\n        profBonus: 4\n    },\n    {\n        exp: 100000,\n        profBonus: 4\n    },\n    {\n        exp: 120000,\n        profBonus: 5\n    },\n    {\n        exp: 140000,\n        profBonus: 5\n    },\n    {\n        exp: 165000,\n        profBonus: 5\n    },\n    {\n        exp: 195000,\n        profBonus: 5\n    },\n    {\n        exp: 225000,\n        profBonus: 6\n    },\n    {\n        exp: 265000,\n        profBonus: 6\n    },\n    {\n        exp: 305000,\n        profBonus: 6\n    },\n    {\n        exp: 355000,\n        profBonus: 6\n    }\n];\nfunction $1b84b6462a079121$export$90c939a9a04bf7bb(cr) {\n    let crValue = $95fc563048a48bb6$export$437ba3be5ce2ff51(cr);\n    if (crValue < 0.124) return 10;\n    else if (crValue < 0.249) return 25;\n    else if (crValue < 0.499) return 50;\n    else if (crValue < 0.999) return 100;\n    crValue = Math.min($1b84b6462a079121$var$CHALLENGE_XP_TABLE.length - 1, parseInt(crValue));\n    return $1b84b6462a079121$var$CHALLENGE_XP_TABLE[crValue];\n}\nfunction $1b84b6462a079121$export$42351fd14ab8bd87(exp) {\n    const expValue = $95fc563048a48bb6$export$d6c5c82e8e696750(exp, 0);\n    let level = 0;\n    let index = 0;\n    do {\n        const next = $1b84b6462a079121$var$ADVANCEMENT_TABLE[index++];\n        if (expValue >= next.exp) level = index;\n        else break;\n    }while (index < $1b84b6462a079121$var$ADVANCEMENT_TABLE.length);\n    return {\n        level: level,\n        profBonus: $1b84b6462a079121$var$ADVANCEMENT_TABLE[level - 1].profBonus\n    };\n}\nfunction $1b84b6462a079121$export$deaf172d6f4715c6(level) {\n    level = Math.min(level, $1b84b6462a079121$var$ADVANCEMENT_TABLE.length);\n    level--; // array is zero based.\n    if (level < 0) return $1b84b6462a079121$var$ADVANCEMENT_TABLE[0].exp;\n    return $1b84b6462a079121$var$ADVANCEMENT_TABLE[level].exp;\n}\n\n\n/**\n * @file Generator for standard characters\n *\n * @module dnd/abilityGenerator\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * Array of ability value ranges. The first element is used for the first ability\n * @type {Array.Array<min:number, max:number>}\n */ const $4119f2a8b1aa0207$var$TRAIT_RANGE = [\n    [\n        13,\n        15\n    ],\n    [\n        12,\n        14\n    ],\n    [\n        11,\n        13\n    ],\n    [\n        8,\n        13\n    ],\n    [\n        8,\n        13\n    ],\n    [\n        8,\n        13\n    ]\n];\n/**\n * @type {Array.Array<min:number, max:number>}\n */ const $4119f2a8b1aa0207$var$DEFAULT_RANGE = [\n    8,\n    15\n];\n/**\n * Order of abilities for character classes.\n * @type {Map<string, Array.<string>>}\n */ const $4119f2a8b1aa0207$var$CLASS_TRAIT_ORDER = new Map([\n    [\n        \"BARBARIAN\",\n        [\n            \"STR\",\n            \"CON\",\n            \"DEX\",\n            \"INT\",\n            \"WIS\",\n            \"CHA\"\n        ]\n    ],\n    [\n        \"CLERIC\",\n        [\n            \"WIS\",\n            \"CON\",\n            \"STR\",\n            \"CHA\",\n            \"INT\",\n            \"DEX\"\n        ]\n    ],\n    [\n        \"FIGHTER\",\n        [\n            \"STR\",\n            \"CON\",\n            \"DEX\",\n            \"INT\",\n            \"WIS\",\n            \"CHA\"\n        ]\n    ],\n    [\n        \"RANGER\",\n        [\n            \"STR\",\n            \"DEX\",\n            \"CON\",\n            \"INT\",\n            \"WIS\",\n            \"CHA\"\n        ]\n    ],\n    [\n        \"ROGUE\",\n        [\n            \"DEX\",\n            \"INT\",\n            \"CHA\",\n            \"STR\",\n            \"CON\",\n            \"WIS\"\n        ]\n    ],\n    [\n        \"WIZARD\",\n        [\n            \"INT\",\n            \"WIS\",\n            \"STR\",\n            \"CON\",\n            \"DEX\",\n            \"CHA\"\n        ]\n    ],\n    [\n        \"DEFAULT\",\n        [\n            \"STR\",\n            \"CON\",\n            \"DEX\",\n            \"INT\",\n            \"WIS\",\n            \"CHA\"\n        ]\n    ]\n]);\n/**\n * @typedef {Object} AttackModifiers\n * @property {number} pbMultiplier - multiplication factor for proficiency bonuses\n */ /**\n * Attack modifiers\n * @type {Map<string, AttackModifiers>}\n */ const $4119f2a8b1aa0207$var$CLASS_ATTACK_MODIFIERS = new Map([\n    [\n        \"ROGUE\",\n        {\n            pbMultiplier: 2\n        }\n    ],\n    [\n        \"DEFAULT\",\n        {\n            pbMultiplier: 1\n        }\n    ]\n]);\n/**\n * Trait adjustments for level changes.\n * The array holds the levels at which a trait adjustment takes place. These\n * are indexes into the classes CLASS_TRAIT_ORDER\n * @type {Map<string, number[]}\n */ const $4119f2a8b1aa0207$var$CLASS_TRAIT_ADJUSTMENT_LEVELS = new Map([\n    [\n        \"BARBARIAN\",\n        [\n            4,\n            8,\n            12,\n            16,\n            19\n        ]\n    ],\n    [\n        \"CLERIC\",\n        [\n            4,\n            8,\n            12,\n            16,\n            19\n        ]\n    ],\n    [\n        \"FIGHTER\",\n        [\n            4,\n            6,\n            8,\n            12,\n            14,\n            16,\n            19\n        ]\n    ],\n    [\n        \"RANGER\",\n        [\n            4,\n            8,\n            12,\n            16,\n            19\n        ]\n    ],\n    [\n        \"ROGUE\",\n        [\n            4,\n            8,\n            10,\n            12,\n            16,\n            19\n        ]\n    ],\n    [\n        \"WIZARD\",\n        [\n            4,\n            8,\n            12,\n            16,\n            19\n        ]\n    ]\n]);\nfunction $4119f2a8b1aa0207$export$f14493b7558dc585(characterClass) {\n    const result = new Map();\n    const keys = $4119f2a8b1aa0207$var$CLASS_TRAIT_ORDER.get(characterClass) ?? $4119f2a8b1aa0207$var$CLASS_TRAIT_ORDER.get(\"DEFAULT\");\n    for(let index = 0; index < keys.length; index++){\n        const range = index < $4119f2a8b1aa0207$var$TRAIT_RANGE.length ? $4119f2a8b1aa0207$var$TRAIT_RANGE[index] : $4119f2a8b1aa0207$var$DEFAULT_RANGE;\n        const value = $95fc563048a48bb6$export$75c671db1a13cf5f(range[0], range[1]);\n        result.set(keys[index], value);\n    }\n    return result;\n}\nfunction $4119f2a8b1aa0207$export$d577e582da4f4d49(characterClass) {\n    return $4119f2a8b1aa0207$var$CLASS_ATTACK_MODIFIERS.get(characterClass) ?? $4119f2a8b1aa0207$var$CLASS_ATTACK_MODIFIERS.get(\"DEFAULT\");\n}\nfunction $4119f2a8b1aa0207$export$c6eafc23596b6fbc(characterClass) {\n    return {\n        levels: $4119f2a8b1aa0207$var$CLASS_TRAIT_ADJUSTMENT_LEVELS.get(characterClass) ?? [],\n        traits: $4119f2a8b1aa0207$var$CLASS_TRAIT_ORDER.get(characterClass) ?? $4119f2a8b1aa0207$var$CLASS_TRAIT_ORDER.get(\"DEFAULT\"),\n        gainPerAdjustment: 2,\n        maxAbility: 20\n    };\n}\n\n\n/**\n * @file DnD dice rolls.\n *\n * @module dnd/dndAction\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n/**\n * @file Functions for handling magic\n *\n * @module dnd/magic\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \nfunction $a7679a1c33accf76$export$1d4b318710123c48(spellTraits) {\n    const level = spellTraits.getInt(\"LEVEL\", 1);\n    return Math.round(1 + 5 * (level - 1) / 8);\n}\nfunction $a7679a1c33accf76$export$85717b0e700e5718(characterLevel) {\n    return Math.min(Math.round(1 + 8 * (characterLevel - 1) / 16), 9);\n}\nfunction $a7679a1c33accf76$export$a0ac1da054aaefd1(actorTraits, magicTraits) {\n    // check level\n    const actorLevel = actorTraits.getCharacterLevel();\n    const spellLevel = magicTraits.getInt(\"LEVEL\", 0);\n    const maxSpellLevel = $a7679a1c33accf76$export$85717b0e700e5718(actorLevel);\n    if (spellLevel > maxSpellLevel) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`${actorTraits.get(\"NAME\")} cannot learn level ${spellLevel} ${magicTraits.get(\"NAME\")} as too high.`);\n        return false;\n    }\n    //check casters\n    const casters = magicTraits.get(\"CASTERS\");\n    if (!casters) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`No casters set for ${magicTraits.get(\"NAME\")} so can be learned.`);\n        return true; // no limitations\n    }\n    const actorClass = actorTraits.get(\"CLASS\");\n    if (!casters.includes(actorClass)) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`${actorTraits.get(\"NAME\")} cannot learn ${magicTraits.get(\"NAME\")} as not in casters.`);\n        return false;\n    }\n    return true;\n}\nfunction $a7679a1c33accf76$export$be0c720f8af25518(casterTraits) {\n    const availablePower = casterTraits.getInt(\"CASTING_POWER\");\n    if (casterTraits.has(\"CASTING_POWER\")) return availablePower;\n    else return $a7679a1c33accf76$export$a8635b55c366bbfd(casterTraits);\n}\nfunction $a7679a1c33accf76$export$42488dd933dc2ad9(casterTraits, spellTraits) {\n    const spellPower = $a7679a1c33accf76$export$1d4b318710123c48(spellTraits);\n    const availablePower = $a7679a1c33accf76$export$be0c720f8af25518(casterTraits);\n    const remaining = Math.max(0, availablePower - spellPower);\n    casterTraits.set(\"CASTING_POWER\", remaining);\n}\nfunction $a7679a1c33accf76$export$5bad22818946aef6(casterTraits, spellTraits) {\n    const spellPower = $a7679a1c33accf76$export$1d4b318710123c48(spellTraits);\n    const availablePower = $a7679a1c33accf76$export$be0c720f8af25518(casterTraits);\n    return availablePower >= spellPower;\n}\nfunction $a7679a1c33accf76$export$a8635b55c366bbfd(casterTraits) {\n    const characterLevel = casterTraits.getCharacterLevel();\n    const maxPower = Math.round(4 * (2 + 20 * (characterLevel - 1) / 19));\n    casterTraits.set(\"CASTING_POWER\", maxPower);\n    return maxPower;\n}\nfunction $a7679a1c33accf76$export$be6656d966ac0ec8(casterTraitsUnused, targetTraits, spellTraits) {\n    const maxTargetHp = spellTraits.getInt(\"MAX_TARGET_HP\", 999);\n    const targetHp = targetTraits.getInt(\"HP\");\n    if (targetHp > maxTargetHp) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Targets's HP (${targetHp}) is above max target hp of ${maxTargetHp}. Spell failed.`);\n        return false;\n    }\n    return true;\n}\n\n\n\nconst $930b66d99210d21f$export$f38bd2bad06ce15b = 3;\nconst $930b66d99210d21f$export$acf4bc55b62ab78b = 3;\nconst $930b66d99210d21f$export$f482b03c0d47770c = 1;\nconst $930b66d99210d21f$export$ff8cb03fee7cf5b7 = 1;\nconst $930b66d99210d21f$export$15ea8b6154dfaef = {\n    VERY_EASY: 5,\n    EASY: 10,\n    MEDIUM: 15,\n    HARD: 20,\n    VERY_HARD: 25,\n    NEARLY_IMPOSSIBLE: 30,\n    IMPOSSIBLE: 999\n};\nfunction $930b66d99210d21f$export$a00548f2d1dc9708(attack, targetTraits) {\n    const attackRoll = attack.rollForAttack();\n    // handle fate and curses.\n    if (attackRoll.roll === 1) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Attack dice rolled 0: cursed.\");\n        return 0; // cursed.\n    } else if (attackRoll.roll === 20) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Attack dice rolled 20: critical hit. Damage will be doubled.\");\n        return 2 * attack.rollForDamage(); // critical hit\n    }\n    const targetAc = targetTraits.getEffectiveInt(\"AC\");\n    (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Melee: attack roll ${attackRoll.value} vs target AC ${targetAc}`);\n    if (attackRoll.value >= targetAc) return attack.rollForDamage();\n    return 0;\n}\nfunction $930b66d99210d21f$export$b066f38ab0e5b2dc(attackerTraits, targetTraits) {\n    const damageDice = attackerTraits.get(\"DMG_POISON\") ?? attackerTraits.get(\"DMG\", \"1D4\");\n    const damage = $a4035ea4d528e431$export$7fa777a3b7eeb6e3(damageDice);\n    const saveModifier = targetTraits.getNonMeleeSaveAbilityModifier(attackerTraits);\n    const difficulty = attackerTraits.getInt(\"DC\");\n    if (!difficulty) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Poisoner ${attackerTraits.get(\"NAME\")} has no DC set.`);\n        return damage;\n    }\n    const saveRoll = $a4035ea4d528e431$export$b9d1fef74bbc4c0c(20);\n    (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Poison: save roll ${saveRoll} + modifier ${saveModifier} vs target DC ${difficulty}`);\n    if (saveRoll + saveModifier >= difficulty) {\n        const factor = attackerTraits.getFloat(\"DMG_SAVED\", 0);\n        return Math.round(factor * damage);\n    } else return damage;\n}\nfunction $930b66d99210d21f$export$471963e02ad769b2(consumableTraits, consumerTraits) {\n    const gain = consumableTraits.getInt(\"HP\", 0);\n    const currentHp = consumerTraits.getInt(\"HP\", 0);\n    const maxHp = consumerTraits.getInt(\"HP_MAX\", currentHp);\n    const shortFall = maxHp - currentHp;\n    const appliedGain = shortFall < 0 ? 0 : Math.min(shortFall, gain);\n    return {\n        shortFall: shortFall,\n        oldHp: currentHp,\n        newHp: currentHp + appliedGain,\n        detoxify: consumableTraits.get(\"DETOXIFY\", false)\n    };\n}\nfunction $930b66d99210d21f$export$53864c490cc48ef4(attackerTraits, targetTraits, spellTraits) {\n    if (targetTraits.get(\"UNDEAD\") && spellTraits.get(\"UNDEAD_IMMUNE\")) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Spell does not work on the undead.`);\n        return 0;\n    }\n    switch(spellTraits.get(\"MODE\")){\n        case \"MELEE\":\n        case \"VAMPIRIC MELEE\":\n            return $930b66d99210d21f$var$getSpellMeleeDamage(attackerTraits, targetTraits, spellTraits);\n        default:\n            return $930b66d99210d21f$export$334844f8a6a08ed0(attackerTraits, targetTraits, spellTraits);\n    }\n}\n/**\n * Magic with using melee attack mechanics.\n * @param {module:dnd/traits.CharacterTraits} attackerTraits\n * @param {module:dnd/traits.CharacterTraits} targetTraits\n * @param {module:dnd/traits.MagicTraits} spellTraits\n * @returns {number}\n */ function $930b66d99210d21f$var$getSpellMeleeDamage(attackerTraits, targetTraits, spellTraits) {\n    const spellCastAbility = attackerTraits.get(\"SPELL_CAST\", \"INT\");\n    const spellCastAbilityValue = attackerTraits.getEffectiveInt(spellCastAbility, 1);\n    let damageDice;\n    if (spellTraits.getDamageDiceWhenCastBy) damageDice = spellTraits.getDamageDiceWhenCastBy(attackerTraits);\n    else damageDice = spellTraits.get(\"DMG\", \"1D4\");\n    const attack = new (0, $b7c201230645b878$export$6aedcecc644e4b96)({\n        damageDice: damageDice,\n        weaponType: \"UNARMED\",\n        proficiencyBonus: attackerTraits.getCharacterPb(spellTraits),\n        abilityModifier: (0, $b7c201230645b878$export$1a1308ca8502831f)(spellCastAbilityValue)\n    });\n    return $930b66d99210d21f$export$a00548f2d1dc9708(attack, targetTraits);\n}\nfunction $930b66d99210d21f$export$334844f8a6a08ed0(attackerTraits, targetTraits, spellTraits) {\n    const saveModifier = targetTraits.getNonMeleeSaveAbilityModifier(spellTraits);\n    let spellModifier = 0;\n    let attackLabel;\n    if (attackerTraits.get(\"ATTACK\") === (0, $ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72).RANGED) attackLabel = \"Ranged attack\";\n    else {\n        attackLabel = \"Magic\";\n        const spellCastAbility = attackerTraits.get(\"SPELL_CAST\", \"INT\");\n        const spellCastAbilityValue = attackerTraits.getInt(spellCastAbility, 1);\n        spellModifier = attackerTraits.getCharacterPb(spellTraits) + (0, $b7c201230645b878$export$1a1308ca8502831f)(spellCastAbilityValue);\n    }\n    let difficulty = spellTraits.getInt(\"DC\");\n    if (difficulty === null || difficulty === undefined) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`${attackLabel} ${attackerTraits.get(\"NAME\")} has no DC set.`);\n        difficulty = 0;\n    }\n    const fullDifficulty = difficulty + spellModifier;\n    let savingThrow = $a4035ea4d528e431$export$b9d1fef74bbc4c0c(20) + saveModifier;\n    let damageDice;\n    if (spellTraits.getDamageDiceWhenCastBy) damageDice = spellTraits.getDamageDiceWhenCastBy(attackerTraits);\n    else damageDice = spellTraits.get(\"DMG\", \"1D4\");\n    const damage = $a4035ea4d528e431$export$7fa777a3b7eeb6e3(damageDice);\n    (0, $733fb161db426370$export$2e2bcd8739ae039).info(`${attackLabel}: saving throw ${savingThrow} vs target DC ${fullDifficulty}`);\n    if (savingThrow >= fullDifficulty) {\n        const factor = spellTraits.getFloat(\"DMG_SAVED\", 0);\n        return Math.round(factor * damage);\n    } else return damage;\n}\nfunction $930b66d99210d21f$export$e3e87e6231f5dc4d(casterTraits, targetTraits, spellTraits) {\n    if (!spellTraits.has(\"HP_GAIN\")) return 0;\n    let hpGainDice;\n    if (spellTraits.getHpGainDiceWhenCastBy) hpGainDice = spellTraits.getHpGainDiceWhenCastBy(casterTraits);\n    else hpGainDice = spellTraits.get(\"HP_GAIN\", 0);\n    const result = $a4035ea4d528e431$export$7fa777a3b7eeb6e3(hpGainDice);\n    const currentHp = targetTraits.getInt(\"HP\");\n    const hpMax = targetTraits.getInt(\"HP_MAX\");\n    return Math.min(result, hpMax - currentHp);\n}\nconst $930b66d99210d21f$export$58d02c0b3958dc5 = {\n    NONE: \"\",\n    NEED_LONG_REST: \"need long rest\",\n    NEED_MORE_RATIONS: \"need more rations\"\n};\nfunction $930b66d99210d21f$export$f7b7586b654373a2(traits) {\n    const hitDice = traits.get(\"HIT_DICE\", \"0D6\");\n    return $a4035ea4d528e431$export$39e91293370042d8(hitDice).qty - traits.getInt(\"SPENT_HIT_DICE\");\n}\nfunction $930b66d99210d21f$export$105ff773d2a2501a(nMeals, nDrinks, traits) {\n    const shortRest = {\n        possible: true,\n        failure: $930b66d99210d21f$export$58d02c0b3958dc5.NONE\n    };\n    const longRest = {\n        possible: true,\n        failure: $930b66d99210d21f$export$58d02c0b3958dc5.NONE\n    };\n    const availableDice = $930b66d99210d21f$export$f7b7586b654373a2(traits);\n    if (availableDice < 1) {\n        shortRest.possible = false;\n        shortRest.failure = $930b66d99210d21f$export$58d02c0b3958dc5.NEED_LONG_REST;\n    } else if (nMeals < $930b66d99210d21f$export$f482b03c0d47770c || nDrinks < $930b66d99210d21f$export$ff8cb03fee7cf5b7) {\n        shortRest.possible = false;\n        shortRest.failure = $930b66d99210d21f$export$58d02c0b3958dc5.NEED_MORE_RATIONS;\n    }\n    if (nMeals < $930b66d99210d21f$export$f38bd2bad06ce15b || nDrinks < $930b66d99210d21f$export$acf4bc55b62ab78b) {\n        longRest.possible = false;\n        longRest.failure = $930b66d99210d21f$export$58d02c0b3958dc5.NEED_MORE_RATIONS;\n    }\n    return {\n        shortRest: shortRest,\n        longRest: longRest\n    };\n}\nfunction $930b66d99210d21f$export$1f1ba427ee30f22d(actor, length) {\n    const currentHp = actor.traits.getInt(\"HP\", 0);\n    let newHp = currentHp;\n    switch(length){\n        case \"SHORT\":\n            {\n                const hitDice = actor.traits.get(\"HIT_DICE\");\n                const spentHitDice = actor.traits.getInt(\"SPENT_HIT_DICE\", 0);\n                const hpMax = actor.traits.getInt(\"HP_MAX\", currentHp);\n                const constitutionModifier = actor.traits.getAsModifier(\"CON\");\n                const diceDetails = $a4035ea4d528e431$export$39e91293370042d8(hitDice);\n                const availableHitDice = diceDetails.qty - spentHitDice;\n                if (availableHitDice > 0) {\n                    newHp = currentHp + $a4035ea4d528e431$export$b9d1fef74bbc4c0c(diceDetails.sides) + constitutionModifier; // just roll one.\n                    newHp = Math.min(newHp, hpMax);\n                    actor.traits.set(\"HP\", newHp);\n                    actor.traits.set(\"SPENT_HIT_DICE\", spentHitDice + 1);\n                }\n                actor.toxify?.cure();\n            }\n            break;\n        case \"LONG\":\n            {\n                const hitDice = actor.traits.get(\"HIT_DICE\");\n                const diceDetails = $a4035ea4d528e431$export$39e91293370042d8(hitDice);\n                const recoveredHitDice = Math.max(1, Math.ceil(0.5 * diceDetails.qty));\n                let spentDice = actor.traits.getInt(\"SPENT_HIT_DICE\", 0) - recoveredHitDice;\n                spentDice = Math.max(0, spentDice);\n                actor.traits.set(\"SPENT_HIT_DICE\", spentDice);\n                newHp = actor.traits.getInt(\"HP_MAX\", currentHp);\n                actor.traits.set(\"HP\", newHp);\n                $a7679a1c33accf76$export$a8635b55c366bbfd(actor.traits);\n                actor.toxify?.cure();\n            }\n            break;\n        default:\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Attempt to rest for unknown length of ${length}`);\n    }\n    return {\n        oldHp: currentHp,\n        newHp: newHp\n    };\n}\nfunction $930b66d99210d21f$export$38cf22ccfd40810d(detectorTraits, trapDetails) {\n    return $930b66d99210d21f$export$3b89c7789beca9d3(detectorTraits, {\n        ability: trapDetails.detectBy,\n        difficulty: trapDetails.difficulty,\n        proficiency: \"TRAPS\"\n    });\n}\nfunction $930b66d99210d21f$export$ddf75a74280e6cb7(detectorTraits, trapDetails) {\n    return $930b66d99210d21f$export$3b89c7789beca9d3(detectorTraits, {\n        ability: trapDetails.disableBy,\n        difficulty: trapDetails.difficulty,\n        proficiency: \"TRAPS\"\n    });\n}\nfunction $930b66d99210d21f$export$990ff48a2b0ba22a(robberTraits, traderTraits) {\n    return $930b66d99210d21f$export$3b89c7789beca9d3(robberTraits, {\n        ability: \"DEX\",\n        difficulty: traderTraits.getInt(\"DC\", $930b66d99210d21f$export$15ea8b6154dfaef.HARD),\n        proficiency: \"STEALING\"\n    });\n}\nfunction $930b66d99210d21f$export$83de0ce3f692f041(robberTraits, keyTraits) {\n    return $930b66d99210d21f$export$3b89c7789beca9d3(robberTraits, {\n        ability: \"DEX\",\n        difficulty: keyTraits.get(\"DC\", $930b66d99210d21f$export$15ea8b6154dfaef.EASY),\n        proficiency: \"PICK LOCK\"\n    });\n}\nfunction $930b66d99210d21f$export$4255569f55f6b169(identifierTraits, objectTraits) {\n    return $930b66d99210d21f$export$3b89c7789beca9d3(identifierTraits, {\n        ability: \"WIS\",\n        difficulty: objectTraits.get(\"IDENTIFY_DC\", $930b66d99210d21f$export$15ea8b6154dfaef.EASY),\n        proficiency: objectTraits.get(\"SUBTYPE\")\n    });\n}\nfunction $930b66d99210d21f$export$3b89c7789beca9d3(pickerTraits, task) {\n    const abilityValue = pickerTraits.getEffectiveInt(task.ability, 1);\n    const modifier = (0, $b7c201230645b878$export$1a1308ca8502831f)(abilityValue);\n    const profBonus = task.proficiency ? pickerTraits.getCharacterPb(task.proficiency) : 0;\n    const pickRoll = $a4035ea4d528e431$export$b9d1fef74bbc4c0c(20) + modifier + profBonus;\n    return pickRoll >= task.difficulty;\n}\n\n\n\n\n/**  Main character stats. Note that armour class is included. */ const $b7c201230645b878$var$CHAR_STATS_KEYS = [\n    \"STR\",\n    \"DEX\",\n    \"CON\",\n    \"INT\",\n    \"WIS\",\n    \"CHA\",\n    \"AC\"\n];\nconst $b7c201230645b878$var$FEET_PER_TILE = 7.5;\nfunction $b7c201230645b878$export$1a1308ca8502831f(value) {\n    return Math.floor((value - 10) / 2);\n}\nclass $b7c201230645b878$export$6aedcecc644e4b96 {\n    /** @type {string} */ damageDice;\n    /** @type {number} */ proficiencyBonus;\n    /** @type {number} */ abilityModifier;\n    /** @type {boolean} */ #twoWeaponFighting;\n    /** @type {boolean} */ unarmed;\n    /**\n   *\n   * @param {module:players/artefacts.Artefact} weapon\n   * @param {Object} options\n   * @param {string} options.damageDice\n   * @param {string} options.weaponType - UNARMED makes this an unarmed strike.\n   * @param {number} options.proficiencyBonus\n   * @param {number} options.abilityModifier\n   */ constructor(options){\n        this.damageDice = options.damageDice ?? \"1D1\";\n        const subType = options.weaponType ?? \"\";\n        if (subType === \"UNARMED\") {\n            this.unarmed = true;\n            this.#twoWeaponFighting = false;\n        } else if (subType.includes(\"SIMPLE\") && subType.includes(\"LIGHT\")) {\n            this.unarmed = false;\n            this.#twoWeaponFighting = true;\n        } else {\n            this.unarmed = false;\n            this.#twoWeaponFighting = false;\n        }\n        this.proficiencyBonus = options?.proficiencyBonus ?? 0;\n        this.abilityModifier = options?.abilityModifier ?? 0;\n    }\n    /**\n   * Get unarmed damage.\n   * @returns {number}\n   */ #getUnarmedDamage() {\n        return 1 + this.abilityModifier; // ability modifier is the same as strength for melee\n    }\n    /**\n   * Get maximum possible damage from this weapon ignoring the ability modifier\n   * which applies to all weapons equally.\n   * @returns {number}\n   */ getMaxDamage() {\n        if (this.unarmed) return this.#getUnarmedDamage();\n        else return $a4035ea4d528e431$export$9ceb90c5f924ec24(this.damageDice) + this.abilityModifier;\n    }\n    /**\n   * Is two weapon fighting allowed.\n   * @returns {boolean}\n   */ canUseTwoWeapons() {\n        return this.#twoWeaponFighting;\n    }\n    /**\n   * Roll for attack.\n   * @returns {{roll:number, value: number}}\n   */ rollForAttack() {\n        const roll = $a4035ea4d528e431$export$b9d1fef74bbc4c0c(20);\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Attack roll ${roll} + ability(${this.abilityModifier})+ proficiency(${this.proficiencyBonus})`);\n        return {\n            roll: roll,\n            value: roll + this.abilityModifier + this.proficiencyBonus\n        };\n    }\n    /**\n   * Roll for damage.\n   * @returns {number}\n   */ rollForDamage() {\n        if (this.unarmed) return this.#getUnarmedDamage();\n        const damage = Math.max($a4035ea4d528e431$export$7fa777a3b7eeb6e3(this.damageDice) + this.abilityModifier);\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Damage: ${this.damageDice} + ability(${this.abilityModifier}) = ${damage}`);\n        return damage;\n    }\n    /**\n   * Clone\n   * @returns {AttackDetail}\n   */ clone() {\n        const attackDetail = new $b7c201230645b878$export$6aedcecc644e4b96({});\n        attackDetail.abilityModifier = this.abilityModifier;\n        attackDetail.damageDice = this.damageDice;\n        attackDetail.proficiencyBonus = this.proficiencyBonus;\n        attackDetail.#twoWeaponFighting = this.#twoWeaponFighting;\n        attackDetail.unarmed = this.unarmed;\n        return attackDetail;\n    }\n}\nclass $b7c201230645b878$export$f0f803f528a8d270 {\n    /** Characteristics @type {Map<string, *>} */ _traits;\n    /**\n   * Initialise the traits.\n   * @param {Map<string, *> | string} initialValues\n   */ constructor(initialValues){\n        if (typeof initialValues === \"string\") {\n            this._traits = new Map();\n            this.#setFromString(initialValues);\n        } else this._traits = new Map(initialValues);\n    }\n    /**\n   * Populate the traits from a string definition. The definition comprises a\n   * comma separated list of characteristics with each characteristic comprising\n   * a keyword followed by a space or equals sign and then its value.\n   * Keywords are converted to uppercase.\n   * @param {string} definition\n   * @returns {Traits} returns this to allow chaining.\n   * @throws {Error} if definition invalid.\n   */ #setFromString(definition) {\n        definition.split(\",\").forEach((item)=>{\n            const match = item.match(/^\\s*(\\w+)\\s*[=: ]\\s*(.+?)\\s*$/);\n            if (!match) return;\n            const [key, value] = this.#imposeCase(match[1], match[2]);\n            if (match) this.#setValueFromString(key, value.trim());\n            else throw new Error(`Invalid property definition'${item}'`);\n        });\n        return this;\n    }\n    /**\n   * Does traits have key.\n   * @param {string} key\n   * @returns {boolean}\n   */ has(key) {\n        return this._traits.has(key) || this._traits.has(\"_\" + key);\n    }\n    /**\n   * @param {string} key\n   * @param {*} value\n   */ set(key, value) {\n        this._traits.set(key, value);\n        this._refreshDerivedValues(key);\n    }\n    /**\n   * Get the trait value. This will look first for the key and then the key\n   * preceded by an underscore.\n   * @param {string} key\n   * @param {*} defValue - default value;\n   * @returns {*}\n   */ get(key, defValue) {\n        return this._traits.get(key) ?? this._traits.get(\"_\" + key) ?? defValue;\n    }\n    /**\n   * Delete the trait value.\n   * @param {string} key\n   * @returns {boolean} true if deleted; false if didn't  exist\n   */ delete(key) {\n        return this._traits.delete(key);\n    }\n    /**\n   * Refresh derived values.\n   * This is expected to be overridden.\n   * @param {string} key - key that was updated and triggered refresh.\n   */ _refreshDerivedValues(updatedKeyUnused) {}\n    /**\n   * Get the trait value as an int. This will look first for the key and then the key\n   * preceded by an underscore.\n   * @param {string} key\n   * @param {*} defValue - default value;\n   * @returns {number}\n   */ getInt(key, defValue) {\n        const result = this.get(key, defValue);\n        return $95fc563048a48bb6$export$d6c5c82e8e696750(result, defValue);\n    }\n    /**\n   * Add an integer value. Derived values are not recalculated.\n   * @param {string} key\n   * @param {number} value\n   * @param {boolean} clipToZero\n   */ addInt(key, value, clipToZero = false) {\n        const currentValue = this.getInt(key);\n        let newValue = $95fc563048a48bb6$export$d6c5c82e8e696750(value) + currentValue;\n        if (clipToZero && newValue < 0) newValue = 0;\n        this._traits.set(key, newValue);\n    }\n    /**\n   * Take a value normally entered in feet and convert to tiles.\n   * @param {string} key\n   * @param {number} defValue - default if not found.\n   * @returns {number} results rounded to nearest int.\n   */ getValueInFeetInTiles(key, defValue) {\n        const valueInFeet = this.getInt(key);\n        if (valueInFeet === null || valueInFeet === undefined) return defValue;\n        return $b7c201230645b878$export$f0f803f528a8d270.feetToTiles(valueInFeet);\n    }\n    /**\n   * Convert a value in feet to whole number of tiles.\n   * @param {*} valueInFeet\n   * @returns {number}\n   */ static feetToTiles(valueInFeet) {\n        return Math.round(valueInFeet / $b7c201230645b878$var$FEET_PER_TILE);\n    }\n    /**\n   * Get the trait value as an float. This will look first for the key and then the key\n   * preceded by an underscore.\n   * @param {string} key\n   * @param {*} defValue - default value;\n   * @returns {number}\n   */ getFloat(key, defValue) {\n        const result = this.get(key, defValue);\n        return $95fc563048a48bb6$export$437ba3be5ce2ff51(result, defValue);\n    }\n    /**\n   * Get the trait value as a modifier int. This will look first for the key and then the key\n   * preceded by an underscore.\n   * @param {string} key\n   * @param {*} defValue - default value;\n   * @returns {number}\n   */ getAsModifier(key, defValue) {\n        const value = this.getInt(key);\n        if (value === null || value === undefined) return defValue;\n        return $b7c201230645b878$export$1a1308ca8502831f(value);\n    }\n    /**\n   * Adjust case to uppercase unless an excluded characteristic. Most values are\n   * converted to uppercase with a few exceptions.\n   * @param {string} key\n   * @param {string} value\n   * @returns {string[]} first element has the adjusted key and the second the value.\n   */ #imposeCase(key, value) {\n        key = key.toUpperCase();\n        if (key !== \"NAME\" && key !== \"REWARD\") value = value.toUpperCase();\n        return [\n            key,\n            value\n        ];\n    }\n    /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method.\n   * + If the value comprises two numbers separated by\n   * a /, the value for the key is set to the numerator and a new key key_MAX is created,\n   * set to the denominator.\n   * + If the value comprises two numbers separated by a >, the value for the key\n   * is set to a random value between (inclusive) the two values, and a new key key_MAX is created,set to the second number.\n   * @param {string} key\n   * @param {string} value\n   */ #setValueFromString(key, value) {\n        switch(key){\n            case \"PROF\":\n            case \"_PROF\":\n                return this.#setProficienciesFromString(key, value);\n            case \"VALUE\":\n            case \"_VALUE\":\n                return this.#setCostValueFromString(key, value);\n            case \"DMG\":\n            case \"_DMG\":\n            case \"DMG_MELEE\":\n            case \"_DMG_MELEE\":\n            case \"DMG_POISON\":\n            case \"_DMG_POISON\":\n            case \"HP_GAIN\":\n            case \"_HP_GAIN\":\n                return this.#setIntOrDiceValueFromString(key, value);\n            case \"HIT_DICE\":\n            case \"_HIT_DICE\":\n                return this.#setDiceValueFromString(key, value);\n            case \"DC\":\n            case \"_DC\":\n            case \"IDENTIFY_DC\":\n            case \"_IDENTIFY_DC\":\n                return this.#setDCValueFromString(key, value);\n            default:\n                return this.#setGenericValueFromString(key, value);\n        }\n    }\n    /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method.\n   * + If the value comprises two numbers separated by\n   * a /, the value for the key is set to the numerator and a new key key_MAX is created,\n   * set to the denominator.\n   * + If the value comprises two numbers separated by a >, the value for the key\n   * is set to a random value between (inclusive) the two values, and a new key key_MAX is created,set to the second number.\n   * @param {string} key\n   * @param {string} value\n   */ #setCostValueFromString(key, value) {\n        const match = value.match(/^(.*)([a-zA-Z]{2})$/);\n        if (!match) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Invalid value for VALUE trait: ${value}`);\n            value = \"0 GP\";\n        } else {\n            const diceDefn = match[1].trim();\n            let faceValue;\n            if ($a4035ea4d528e431$export$1ca6b1641ccbf456(diceDefn)) faceValue = $a4035ea4d528e431$export$7fa777a3b7eeb6e3(diceDefn);\n            else faceValue = $95fc563048a48bb6$export$d6c5c82e8e696750(match[1], 0);\n            value = `${faceValue} ${match[2]}`;\n        }\n        this.set(key, value);\n    }\n    /**\n   * Set the trait for key to value.\n   * The DC value is normally an int but a dndAction difficulty can be\n   * used.\n   * @param {string} key\n   * @param {string} value\n   */ #setDCValueFromString(key, value) {\n        let difficulty;\n        if (isNaN(value)) difficulty = (0, $930b66d99210d21f$export$15ea8b6154dfaef)[value] ?? 1;\n        else difficulty = $95fc563048a48bb6$export$d6c5c82e8e696750(value);\n        this.set(key, difficulty);\n    }\n    /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method. The dice is not rolled but stored as is.\n   * @param {string} key\n   * @param {string} value\n   */ #setDiceValueFromString(key, value) {\n        if (!$a4035ea4d528e431$export$1ca6b1641ccbf456(value)) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Invalid trait value ${value} for ${key}. Dice definition required.`);\n            value = \"1D6\";\n        }\n        this.set(key, value);\n    }\n    /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method.\n   * If the value is a multidice, it is rolled and the resulting value used.\n   * @param {string} key\n   * @param {string} value\n   */ #setIntOrDiceValueFromString(key, value) {\n        let result;\n        if ($a4035ea4d528e431$export$1ca6b1641ccbf456(value)) result = value;\n        else {\n            result = parseInt(value);\n            if (isNaN(result)) {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Invalid trait value ${value} for ${key}. Integer or dice definition required.`);\n                result = 0;\n            }\n        }\n        this.set(key, result);\n    }\n    /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method.\n   * If the value is a multidice, it is rolled and the resulting value used.\n   * @param {string} key\n   * @param {string} value\n   */ #setGenericValueFromString(key, value) {\n        if (value === \"YES\" || value === \"TRUE\") value = true;\n        else if (value === \"NO\" || value === \"FALSE\") value = false;\n        else if ($a4035ea4d528e431$export$1ca6b1641ccbf456(value) && key !== \"DMG\") value = $a4035ea4d528e431$export$7fa777a3b7eeb6e3(value); // Note DMG is stored as dice definition as it is rolled on demand.\n        this.set(key, value);\n    }\n    /**\n   * Set proficiencies.\n   * @param {string} key\n   * @param {string} value - ids of items in which the user is proficient. Items\n   * are separated by &.\n   */ #setProficienciesFromString(key, value) {\n        const items = value.split(/\\s*&\\s*/);\n        const proficiencies = [];\n        items.forEach((item)=>proficiencies.push(item.toUpperCase()));\n        this._traits.set(key, proficiencies);\n    }\n    /**\n   * Clone traits.\n   * @return {Traits}\n   */ clone() {\n        return new $b7c201230645b878$export$f0f803f528a8d270(this._traits);\n    }\n    /**\n   * Get all traits. This is a copy of the underlying traits.\n   * @returns {Map<string, *>}\n   */ getAllTraits() {\n        return new Map([\n            ...this._traits.entries()\n        ]);\n    }\n    /**\n   * Get all traits. This is a copy of the underlying traits sorted by key name.\n   * @returns {Map<string, *>}\n   */ getAllTraitsSorted() {\n        return new Map([\n            ...this._traits.entries()\n        ].sort());\n    }\n    /**\n   * Get all trait values as a string\n   */ valuesToString() {\n        let result = \"\";\n        this._traits.forEach((value, key)=>{\n            if (result !== \"\") result += \",\";\n            result += `${key}:${value}`;\n        });\n        return result;\n    }\n    /**\n   * Stringify traits.\n   * @return {module:utils/persistentData~ObjectJSON}\n   */ toJSON() {\n        return {\n            reviver: \"Traits\",\n            data: [\n                ...this._traits\n            ]\n        };\n    }\n    /**\n   * Revive object created using toJSON\n   * @param {Array.Array<key,value>} data - array of map initialisation values\n   * @returns {Traits}\n   */ static revive(data) {\n        return new $b7c201230645b878$export$f0f803f528a8d270(new Map(data));\n    }\n}\nclass $b7c201230645b878$export$57c6a82d5c690092 extends $b7c201230645b878$export$f0f803f528a8d270 {\n    /**\n   *\n   * @param {Map<string, *>} initialTraits\n   */ constructor(initialTraits){\n        super(initialTraits ?? new Map());\n    }\n    /**\n   * Get the damage dice when cast by an actor.\n   * @param {Traits} actorTraits\n   * @returns {string}\n   */ getDamageDiceWhenCastBy(actorTraits) {\n        const damageDice = this.get(\"DMG\");\n        return this.#getAdjustedDiceWhenCastBy(damageDice, actorTraits);\n    }\n    /**\n   * Get the damage dice when cast by an actor.\n   * @param {Traits} actorTraits\n   * @returns {string}\n   */ getHpGainDiceWhenCastBy(actorTraits) {\n        const hpDice = this.get(\"HP_GAIN\");\n        return this.#getAdjustedDiceWhenCastBy(hpDice, actorTraits);\n    }\n    /**\n   * Get the health or damage dice when cast by an actor.\n   * @param {string} baseDice\n   * @param {Traits} actorTraits\n   * @returns {string}\n   */ #getAdjustedDiceWhenCastBy(baseDice, actorTraits) {\n        const extraDicePerLevel = this.getFloat(\"DICE_PER_LEVEL\", 0);\n        const baseLevel = this.getInt(\"LEVEL\", 0);\n        const characterLevel = actorTraits.getCharacterLevel();\n        let currentLevel;\n        if (baseLevel === 0) currentLevel = Math.min(17, characterLevel);\n        else currentLevel = $a7679a1c33accf76$export$85717b0e700e5718(characterLevel);\n        const levelChange = Math.max(currentLevel - baseLevel, 0);\n        const extraDice = Math.floor(levelChange * extraDicePerLevel);\n        let adjustedDice = $a4035ea4d528e431$export$4f1346faf378181a(baseDice, extraDice);\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Spell cast: base dice = ${baseDice} raised to ${adjustedDice} for level.`);\n        return adjustedDice;\n    }\n    /**\n   * Convert to JSON\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */ toJSON() {\n        const json = super.toJSON();\n        json.reviver = \"MagicTraits\";\n        return json;\n    }\n    /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   */ static revive(data) {\n        return new $b7c201230645b878$export$57c6a82d5c690092(new Map(data));\n    }\n}\nclass $b7c201230645b878$export$939a756f171fd090 extends $b7c201230645b878$export$f0f803f528a8d270 {\n    /** @type {number} */ _proficiencyBonus;\n    /** @type {number} */ _level;\n    /** @type {AttackDetail[]} */ _attacks;\n    /** @type {ArtefactTraitsCollection} */ _availableArtefactTraits;\n    /** @type {Traits[]} */ _transientFxTraits;\n    /** @type {Traits} */ _effectiveTraits;\n    /** @type {Object} */ transientProperties;\n    /** Amount movement is reduced in tiles */ _maxTileMovePerTurn;\n    /** Flag to allow calculation of derived parameters. @type{boolean} */ _allowRefreshDerived = false;\n    /**\n   *\n   * @param {Map<string, *>} initialTraits\n   */ constructor(initialTraits){\n        super(initialTraits ?? new Map([\n            [\n                \"NAME\",\n                \"mystery\"\n            ]\n        ]));\n        this._proficiencyBonus = 0;\n        this.#setInitialAbilityScores();\n        this._transientFxTraits = [];\n        this.transientProperties = {};\n        this._allowRefreshDerived = true;\n        this._refreshDerivedValues();\n    }\n    /**\n   * Get the movement per turn.\n   * This takes into account any impediments to motion.\n   */ getMaxTilesPerMove() {\n        return this._maxTileMovePerTurn;\n    }\n    /**\n   * Clone traits.\n   * @return {Traits}\n   */ clone() {\n        /** @type {CharacterTraits} */ const actorTraits = new $b7c201230645b878$export$939a756f171fd090(this._traits);\n        actorTraits._proficiencyBonus = this._proficiencyBonus;\n        actorTraits._level = this._level;\n        actorTraits._attacks = this._attacks.map((attack)=>attack.clone());\n        actorTraits._availableArtefactTraits = this._availableArtefactTraits; //reference okay\n        actorTraits._effectiveTraits = this._effectiveTraits.clone();\n        actorTraits._transientFxTraits = [];\n        this._transientFxTraits.forEach((traits)=>actorTraits._transientFxTraits.push(traits.clone()));\n        actorTraits._maxTileMovePerTurn = this._maxTileMovePerTurn;\n        return actorTraits;\n    }\n    /**\n   * Exceed abilities of another character. The character's key stats, excluding AC,\n   * and EXP are set the other's + extra if they exceed the current values.\n   * @param {Traits} other\n   * @param {number} [extra = 0]\n   */ exceedAbilitiesAndExp(other, extra = 0) {\n        [\n            \"STR\",\n            \"DEX\",\n            \"INT\",\n            \"WIS\",\n            \"CON\",\n            \"CHA\",\n            \"EXP\"\n        ].forEach((key)=>{\n            const otherValue = other.getInt(key) + extra;\n            const myValue = this.getInt(key);\n            if (otherValue > myValue) this.set(key, otherValue);\n        });\n    }\n    /** Add transient traits. Note only values which affect CHAR_STATS_KEYS are\n   * used. To be used, the trait should begin with FX_. This is to distinguish\n   * traits which affect a victim from traits which are characteristics of the\n   * owner.\n   * @param {Traits}\n   */ addTransientFxTraits(traits) {\n        const traitsSubset = new $b7c201230645b878$export$f0f803f528a8d270();\n        let hasEffect = false;\n        $b7c201230645b878$var$CHAR_STATS_KEYS.forEach((key)=>{\n            const fxKey = $b7c201230645b878$export$939a756f171fd090.toFxKey(key);\n            const value = traits.getInt(fxKey);\n            if (value) {\n                hasEffect = true;\n                traitsSubset.set(fxKey, value);\n            }\n        });\n        if (hasEffect) {\n            this._transientFxTraits.push(traitsSubset);\n            this._refreshDerivedValues();\n        }\n    }\n    /**\n   * Clear transient traits.\n   */ clearTransientFxTraitsAndProperties() {\n        this._transientFxTraits = [];\n        this.transientProperties = {};\n        this._refreshDerivedValues();\n    }\n    /**\n   * Set initial ability scores and EXP unless already set.\n   */ #setInitialAbilityScores() {\n        const baseAbilities = (0, $4119f2a8b1aa0207$export$f14493b7558dc585)(this.get(\"CLASS\"));\n        baseAbilities.forEach((value, key)=>{\n            if (!this.get(key)) this.set(key, value ?? 8);\n        });\n        if (!this.has(\"EXP\")) this.set(\"EXP\", 0);\n    }\n    /**\n   * Initialise the hit points unless already set.\n   * This is calculated as the maximum hit dice roll + the constitution modifier.\n   */ _updateHitPoints() {\n        const alreadyHasHp = this.has(\"HP\");\n        const alreadyHasHpMax = this.has(\"HP_MAX\");\n        const hitDice = this.get(\"HIT_DICE\");\n        if (alreadyHasHp && alreadyHasHpMax && !hitDice) return;\n        if (hitDice) {\n            if (!this.has(\"SPENT_HIT_DICE\")) this._traits.set(\"SPENT_HIT_DICE\", 0); // act directly on traits or refresh derived can be called again.\n            const con = this.getInt(\"CON\", 0); // use standard constitution and do not include transients.\n            const conMod = $b7c201230645b878$export$1a1308ca8502831f(con);\n            const maxRoll = $a4035ea4d528e431$export$9ceb90c5f924ec24(hitDice);\n            const averageDiceRoll = Math.ceil((maxRoll + 1) / 2);\n            const hpMax = maxRoll + conMod + (this._level - 1) * (averageDiceRoll + conMod);\n            this._traits.set(\"HP_MAX\", hpMax);\n            if (!alreadyHasHp) this._traits.set(\"HP\", $a4035ea4d528e431$export$9ceb90c5f924ec24(hitDice) + conMod);\n        } else if (alreadyHasHp) this._traits.set(\"HP_MAX\", this.get(\"HP\"));\n    }\n    /** Traits that affect victims rather than the owner are preceded by 'FX'.\n   * This function converts a key to an FX key; i.e. 'FX_key'.\n   * @param {string} key\n   * @returns {string}\n   */ static toFxKey(key) {\n        return `FX_${key}`;\n    }\n    /**\n   * Test if there is an effective trait overriding the base trait.\n   * @param {key}\n   * @returns {boolean}\n   */ hasEffective(key) {\n        return this._effectiveTraits ? this._effectiveTraits.has(key) : false;\n    }\n    /**\n   * Get the effective traits value. This differs from the underlying traits\n   * value as it can include armour, weapons, transient effects, and magical\n   * items. If the value is not in the _effectiveTraits, the underlying value is\n   * returned.\n   * @param {key}\n   * @param {*} defaultValue\n   * @returns {*}\n   */ getEffective(key, defaultValue) {\n        return this._effectiveTraits.get(key) ?? this.get(key, defaultValue);\n    }\n    /**\n   * Get the effective traits value. This differs from the underlying traits\n   * value as it can include armour, weapons, transient effects, and magical\n   * items. If the value is not in the _effectiveTraits, the underlying value is\n   * returned.\n   * @param {key}\n   * @param {number} defaultValue\n   * @returns {number}\n   */ getEffectiveInt(key, defaultValue) {\n        return $95fc563048a48bb6$export$d6c5c82e8e696750(this.getEffective(key), defaultValue);\n    }\n    /**\n   * Get the effective character level;\n   * @returns {number}\n   */ getCharacterLevel() {\n        return this._level;\n    }\n    /** Get the save ability modifier for an attack by the attacker.\n   * This is not applicable to melee attacks.\n   *\n   */ getNonMeleeSaveAbilityModifier(attackerTraits) {\n        const saveAbility = attackerTraits.get(\"SAVE_BY\");\n        if (!saveAbility) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Non-melee ${attackerTraits.get(\"NAME\")} has no SAVE_BY set.`);\n            return 0;\n        }\n        const ability = this.getInt(saveAbility);\n        return $b7c201230645b878$export$1a1308ca8502831f(ability ?? 0);\n    }\n    /**\n   * Get the proficiency bonus;\n   * @param {Traits| string} artefactTraitsOrType - traits or the artefact TYPE trait\n   * @returns {number}\n   */ getCharacterPb(artefactTraitsOrType) {\n        return this.isProficient(artefactTraitsOrType) ? this._proficiencyBonus : 0;\n    }\n    /**\n   * Get attacks.\n   * @returns {AttackDetail[]}\n   */ getAttacks() {\n        return this._attacks;\n    }\n    /**\n   * Update derived values for new artefacts.\n   * @param {ArtefactTraitsCollection} availableTraits\n   */ utiliseAdditionalTraits(availableTraits) {\n        this._availableArtefactTraits = availableTraits;\n        this._refreshDerivedValues();\n    }\n    /**\n   * Refresh all derived values. Note that if the traits has a damage property\n   * set, the values are taken directly from the traits, rather than looking\n   * at equipped weapons and armour. This is because monsters have their properties\n   * set including the weapons they carry. This also means it is possible to\n   * equip a monster without it affecting its fighting characteristics.\n   * @override\n   * @param {string} updatedKey\n   */ _refreshDerivedValues(updatedKey) {\n        if (!this._allowRefreshDerived) return;\n        if (!updatedKey || $b7c201230645b878$var$CHAR_STATS_KEYS.includes(updatedKey)) {\n            this._adjustForExperience();\n            this._updateHitPoints();\n            this._initialiseEffectiveTraits();\n            if (this.get(\"TYPE_ID\") === \"ENEMY\") this._deriveValuesFromTraits();\n            else {\n                this._utiliseTransientTraits();\n                this._utiliseMagicTraits();\n                this._utiliseWeaponsTraits();\n                this._utiliseArmourAndShieldTraits();\n                this._adjustMovementForArmour();\n            }\n        }\n    }\n    /**\n   * Calculate derived values directly from the traits. I.e. ignore any equipped\n   * armour or weapons.\n   */ _deriveValuesFromTraits() {\n        this._maxTileMovePerTurn = this.getValueInFeetInTiles(\"SPEED\", 1);\n        this._attacks = [];\n        const attack = new $b7c201230645b878$export$6aedcecc644e4b96({\n            damageDice: this._traits.get(\"DMG\"),\n            weaponType: \"ALMANAC\",\n            proficiencyBonus: this.getInt(\"PB\", 0),\n            abilityModifier: 0,\n            secondAttack: false\n        });\n        this._attacks.push(attack);\n    }\n    /**\n   * Initialise the effective traits to the base values.\n   */ _initialiseEffectiveTraits() {\n        this._effectiveTraits = new $b7c201230645b878$export$f0f803f528a8d270();\n        $b7c201230645b878$var$CHAR_STATS_KEYS.forEach((key)=>{\n            this._effectiveTraits.set(key, this.getInt(key, 0));\n        });\n    }\n    /**\n   * Utilise transient traits. Only character stat keys are used.\n   * These are added to the effect traits and should be called before\n   * utilising magic, armour or weapons.\n\n   */ _utiliseTransientTraits() {\n        this._transientFxTraits?.forEach((traits)=>{\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Transient traits: ${traits.valuesToString()}`);\n            this._addFxTraitsToEffectiveTraits(traits);\n        });\n    }\n    /**\n   * Add FX traits to effective traits.\n   * Any traits for a CHAR_STATS_KEY preceded by 'FX_' is added to the effective\n   * traits. Note the value is **added** to the existing value;\n   * @param {Traits} traits\n   */ _addFxTraitsToEffectiveTraits(traits) {\n        $b7c201230645b878$var$CHAR_STATS_KEYS.forEach((key)=>{\n            const value = traits.getInt($b7c201230645b878$export$939a756f171fd090.toFxKey(key));\n            if (value) this._effectiveTraits.addInt(key, value, true); // clipped to zero\n        });\n    }\n    /**\n   * Utilise magic traits. Only character stat keys are used.\n   * Note that magic items should only affect the 6 key abilities and not the\n   * armour class. An item that directly affects the AC value should be treated\n   * as an ARMOUR or SHIELD item rather than a magical item.\n   */ _utiliseMagicTraits() {\n        if (!this?._availableArtefactTraits?.magic) return;\n        for (const traits of this._availableArtefactTraits.magic){\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Magic traits: ${traits.valuesToString()}`);\n            this._addFxTraitsToEffectiveTraits(traits);\n        }\n    }\n    /**\n   * Utilise armour and shields. The armour classes are combined.\n   * Note that magical items must be utilised first as these might affect\n   * the actor's dexterity.\n   */ _utiliseArmourAndShieldTraits() {\n        let armourClass = this.getEffectiveInt(\"AC\", 0); // character's base AC\n        const armourTraits = this?._availableArtefactTraits?.armour;\n        const shieldTraits = this?._availableArtefactTraits?.shields;\n        let additionalArmourClass = 0;\n        let shieldArmourClass = 0;\n        armourTraits?.forEach((traits)=>{\n            const acInfo = this._getAcFromTraits(traits);\n            if (acInfo.additional) additionalArmourClass += acInfo.value;\n            else if (acInfo.value > armourClass) armourClass = acInfo.value;\n        });\n        shieldTraits?.forEach((traits)=>{\n            shieldArmourClass = Math.max(shieldArmourClass, traits.getInt(\"AC\", 0));\n        });\n        const compositeAc = armourClass + additionalArmourClass + shieldArmourClass;\n        this._effectiveTraits.set(\"AC\", compositeAc);\n    }\n    /**\n   * Armour can impede an actor's movement. This sets any movement inhibition\n   * based on the armour.\n   */ _adjustMovementForArmour() {\n        const baseSpeedInFeet = this.getFloat(\"SPEED\", 1);\n        this._maxTileMovePerTurn = Math.max(1, $b7c201230645b878$export$f0f803f528a8d270.feetToTiles(baseSpeedInFeet)); // default base movement\n        if (!this._availableArtefactTraits?.armour) return;\n        for (const traits of this._availableArtefactTraits.armour)if (traits.get(\"TYPE\", \"\").toUpperCase().includes(\"HEAVY\") && traits.getInt(\"STR\", 0) > this.getEffectiveInt(\"STR\")) {\n            this._maxTileMovePerTurn = Math.max(0, $b7c201230645b878$export$f0f803f528a8d270.feetToTiles(baseSpeedInFeet - 10));\n            return;\n        }\n    }\n    /**\n   * Utilise weapons traits. The best option for equipped weapons is automatically selected\n   * to give the maximum chance of damage. Up to two weapons are supported.\n   * Note that magical items must be utilised first as these might affect the\n   * character's strength.\n   */ _utiliseWeaponsTraits() {\n        this._attacks = [];\n        const weaponsTraits = this?._availableArtefactTraits?.weapons ?? [];\n        const strength = this.getEffectiveInt(\"STR\", 1);\n        const abilityModifier = $b7c201230645b878$export$1a1308ca8502831f(strength);\n        const attackModifiers = (0, $4119f2a8b1aa0207$export$d577e582da4f4d49)(this.get(\"CLASS\"));\n        const effectivePb = this._proficiencyBonus * attackModifiers.pbMultiplier;\n        if (weaponsTraits.length > 2) (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Unexpected number of equipped weapons. Expected 2; received ${weaponsTraits.length}`);\n        let firstAttack;\n        let weaponType;\n        let damageDice;\n        let proficient;\n        let attackBonus;\n        if (weaponsTraits.length === 0) {\n            damageDice = \"\";\n            weaponType = \"UNARMED\";\n            proficient = true;\n            attackBonus = 0;\n        } else {\n            damageDice = weaponsTraits[0].get(\"DMG\", \"1D1\") ?? \"1D1\";\n            weaponType = weaponsTraits[0].get(\"TYPE\") ?? \"\";\n            proficient = this.isProficient(weaponsTraits[0]);\n            attackBonus = weaponsTraits[0].getInt(\"ATTACK_BONUS\", 0);\n        }\n        firstAttack = new $b7c201230645b878$export$6aedcecc644e4b96({\n            damageDice: damageDice,\n            weaponType: weaponType,\n            proficiencyBonus: proficient ? effectivePb : 0,\n            abilityModifier: abilityModifier + attackBonus\n        });\n        let secondAttack;\n        if (weaponsTraits.length > 1) {\n            attackBonus = weaponsTraits[1].getInt(\"ATTACK_BONUS\", 0);\n            secondAttack = new $b7c201230645b878$export$6aedcecc644e4b96({\n                damageDice: weaponsTraits[1].get(\"DMG\", \"1D1\") ?? \"1D1\",\n                weaponType: weaponsTraits[1].get(\"TYPE\") ?? \"\",\n                proficiencyBonus: this.isProficient(weaponsTraits[1]) ? effectivePb : 0,\n                abilityModifier: abilityModifier + attackBonus\n            });\n        }\n        if (secondAttack?.canUseTwoWeapons() && firstAttack.canUseTwoWeapons()) {\n            this._attacks.push(firstAttack);\n            if (abilityModifier > 0) secondAttack.abilityModifier -= abilityModifier; // still leave in place attackBonus\n            this._attacks.push(secondAttack);\n        } else if (secondAttack && secondAttack.getMaxDamage() > firstAttack.getMaxDamage()) this._attacks.push(secondAttack);\n        else this._attacks.push(firstAttack);\n    }\n    /**\n   * Apply dexterity modifier to an item to get its AC value.\n   * @param {Traits} traits\n   * @returns {{additional:boolean, value:number}} additional is true if this should\n   * be added to current value rather than as a replacement.\n   */ _getAcFromTraits(traits) {\n        const dexterity = this.getEffectiveInt(\"DEX\", 1);\n        const modifier = $b7c201230645b878$export$1a1308ca8502831f(dexterity);\n        const armourType = traits.get(\"TYPE\", \"\").toUpperCase();\n        const acTrait = traits.get(\"AC\", 1);\n        let armourClass = $95fc563048a48bb6$export$d6c5c82e8e696750(acTrait);\n        if (armourType.includes(\"MEDIUM\")) armourClass += Math.min(2, modifier);\n        else if (!armourType.includes(\"HEAVY\")) armourClass += modifier;\n        return {\n            additional: /^[+-]/.test(acTrait),\n            value: armourClass\n        };\n    }\n    /**\n   * Set the level and prof bonus. These are calculated from the experience.\n   */ _adjustForExperience() {\n        const currentLevel = this._level ?? 1;\n        const values = $1b84b6462a079121$export$42351fd14ab8bd87(this._traits.get(\"EXP\"));\n        this._level = values.level;\n        this._proficiencyBonus = values.profBonus;\n        this._adjustTraitsForLevelChange(currentLevel, this._level);\n    }\n    /**\n   * Adjust traits for a level change.\n   * @param {number} oldLevel\n   * @param {number} newLevel\n   */ _adjustTraitsForLevelChange(oldLevel, nextLevel) {\n        const details = (0, $4119f2a8b1aa0207$export$c6eafc23596b6fbc)(this.get(\"CLASS\"));\n        if (details.levels.length === 0) return;\n        let availableGain = 0;\n        for (const level of details.levels){\n            if (level > nextLevel) break;\n            if (level > oldLevel) availableGain += details.gainPerAdjustment;\n        }\n        let traitIndex = 0;\n        while(availableGain > 0 && traitIndex < details.traits.length){\n            const key = details.traits[traitIndex];\n            let value = this.get(key);\n            if (value < details.maxAbility) {\n                this.set(key, value + 1);\n                availableGain--;\n            } else traitIndex++;\n        }\n    }\n    /**\n   * @typedef {Object} ValueChangeInfo\n   * @property {*} was\n   * @property {*} now\n   */ /**\n   * Increase experience, level and proficiency bonus\n   *  based on challenge rating.\n   * @param {Traits} defeatedTraits\n   * @returns {{exp: ValueChangeInfo, level: ValueChangeInfo}}\n   */ adjustForDefeatOfActor(defeatedTraits) {\n        const challengeRating = defeatedTraits.get(\"CR\");\n        const gainedExp = $1b84b6462a079121$export$90c939a9a04bf7bb(challengeRating);\n        const currentExp = this.getInt(\"EXP\", 0);\n        const newExp = currentExp + gainedExp;\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Experience increased from ${currentExp} to ${newExp}.`);\n        this.set(\"EXP\", newExp);\n        const currentLevel = this._level;\n        this._adjustForExperience();\n        const newLevel = this._level;\n        return {\n            exp: {\n                was: currentExp,\n                now: newExp\n            },\n            level: {\n                was: currentLevel,\n                now: newLevel\n            }\n        };\n    }\n    /**\n   * Test if proficient with an item.\n   * The test looks at the artefact's TYPE trait. If it includes one of this trait's\n   * PROF entries, the result is true. This means that a PROF entry of 'melee' would\n   * match 'simple melee' and 'martial melee'. You can pass in a string which will be\n   * taken as the TYPE trait.\n   * @param {Traits | string} artefactTraitsOrType\n   * @returns {boolean}\n   */ isProficient(artefactTraitsOrType) {\n        const proficiencies = this.get(\"PROF\");\n        const artefactSubtype = typeof artefactTraitsOrType === \"string\" ? artefactTraitsOrType : artefactTraitsOrType.get(\"TYPE\");\n        if (!proficiencies || !artefactSubtype) return false;\n        for (const prof of proficiencies){\n            const words = prof.split(\" \");\n            let allWordsIncluded = true;\n            for (const word of words)if (!artefactSubtype.includes(word)) {\n                allWordsIncluded = false;\n                break;\n            }\n            if (allWordsIncluded) return true;\n        }\n        return false;\n    }\n    /**\n   * Convert to JSON. Note transient FXs are not saved as these are\n   * not persistent. Also additional traits from equipment are not\n   * included as equipment, etc. are utilised when a character is revived.\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */ toJSON() {\n        const json = super.toJSON();\n        json.reviver = \"CharacterTraits\";\n        return json;\n    }\n    /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   */ static revive(data) {\n        return new $b7c201230645b878$export$939a756f171fd090(new Map(data));\n    }\n}\n\n\n\n/**\n * @file Almanacs\n *\n * @module dnd/almanacs/almanacs\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Utilities for working with almanacs\n *\n * @module dnd/almanacs/almanacUtils\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\nfunction $63e994f329905eac$export$9544647517c5db11(idMain = \"?\") {\n    if (idMain.len < 2) return idMain;\n    const name = idMain.replace(/_pv$/i, \"\").replace(/_/g, \" \");\n    const capitalisedName = name.charAt(0).toUpperCase() + name.substring(1);\n    return (0, $e6f3aae57afc1cde$export$af7faffe10421f14).getText(capitalisedName);\n}\nfunction $63e994f329905eac$export$83737b3fc54f1416(id) {\n    const messageKey = `DESCRIPTION ${id.toUpperCase()}`;\n    const result = (0, $e6f3aae57afc1cde$export$af7faffe10421f14).getText(messageKey);\n    if (messageKey === result) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`No description set for ${messageKey}.`);\n        return \"\";\n    }\n    return result;\n}\nfunction $63e994f329905eac$export$7659ebb14ded9371(id = \"?\") {\n    const parts = id.match(/^(\\w+)([+?/])?(\\w*)?$/);\n    if (!parts) return {};\n    let nameId;\n    let imageId = parts[1];\n    let descriptionId;\n    let unknownDescriptionId;\n    switch(parts[2]){\n        case \"?\":\n            nameId = imageId;\n            descriptionId = id;\n            unknownDescriptionId = imageId;\n            break;\n        case \"+\":\n            nameId = imageId;\n            descriptionId = imageId;\n            unknownDescriptionId = undefined;\n            break;\n        case \"/\":\n            nameId = parts[3];\n            descriptionId = parts[3];\n            unknownDescriptionId = undefined;\n            break;\n        default:\n            nameId = id;\n            descriptionId = id;\n            unknownDescriptionId = undefined;\n    }\n    return {\n        name: $63e994f329905eac$export$9544647517c5db11(nameId),\n        imageName: imageId.toLowerCase(),\n        description: $63e994f329905eac$export$83737b3fc54f1416(descriptionId),\n        unknownDescription: unknownDescriptionId ? $63e994f329905eac$export$83737b3fc54f1416(unknownDescriptionId) : undefined\n    };\n}\n\n\n/**\n * @file Load assets. This module is placed in the assets folder to simplify\n * dynamic imports using Parcel's import.meta.url property.\n *\n * @module utils/assetLoaders.js\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \nfunction $4f6b2ca1724556cd$export$fa2f0f26e19d189b(url) {\n    return fetch(url).then((response)=>response.text()).then((text)=>text).catch((reason)=>{\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Error fetching ${url}: ${reason}`);\n        return null;\n    });\n}\nfunction $4f6b2ca1724556cd$export$942e11b08cbf2222(url) {\n    return fetch(url).then((response)=>response.text()).then((text)=>text).catch((reason)=>{\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Error fetching ${url}: ${reason}`);\n        return null;\n    });\n}\n\n\n\n\n\n/** Cutoff points according to rarity. Scale is 0 to 1 so these given the proportion */ const $ecf189a3ccc267f7$var$COMMON_CUTOFF = 0.8;\nconst $ecf189a3ccc267f7$var$UNCOMMON_CUTOFF = 0.95;\nconst $ecf189a3ccc267f7$var$RARE_CUTOFF = 0.99;\nconst $ecf189a3ccc267f7$export$a1da6658a8e18ee2 = {\n    COMMON: \"COMMON\",\n    UNCOMMON: \"UNCOMMON\",\n    RARE: \"RARE\",\n    VERY_RARE: \"VERY_RARE\"\n};\nclass $ecf189a3ccc267f7$export$291e94b80cdb6dd6 {\n    /** @type {AlmanacEntry[]} */ common;\n    /** @type {AlmanacEntry[]} */ uncommon;\n    /** @type {AlmanacEntry[]} */ rare;\n    /** @type {AlmanacEntry[]} */ veryRare;\n    /**\n   * Create the almanac\n   */ constructor(){\n        this.common = [];\n        this.uncommon = [];\n        this.rare = [];\n        this.veryRare = [];\n    }\n    /**\n   * Merge almanac with this.\n   * @param {Almanac} almanac\n   */ mergeAlmanac(almanac) {\n        this.common.push(...almanac.common);\n        this.uncommon.push(...almanac.uncommon);\n        this.rare.push(...almanac.rare);\n        this.veryRare.push(...almanac.veryRare);\n    }\n    /** Find first element matching the callback. The search starts with common entries and moves on to\n   * rare.\n   * @param {function(element:AlmanacEntry, index:number, AlmanacEntry[]):truthy} callback\n   * @returns {AlmanacEntry} undefined if not found.\n   */ find(callback) {\n        let result = this.common.find(callback);\n        if (result) return result;\n        result = this.uncommon.find(callback);\n        if (result) return result;\n        result = this.rare.find(callback);\n        if (result) return result;\n        return this.veryRare.find(callback);\n    }\n    /** Create a new almanac filtering the values.\n   * @param {function(element:AlmanacEntry, index:number, AlmanacEntry[]):truthy} filterFn\n   * @returns {Almanac} undefined if not found.\n   */ filter(filterFn) {\n        const almanac = new $ecf189a3ccc267f7$export$291e94b80cdb6dd6();\n        almanac.common = filterFn ? this.common.filter(filterFn) : [\n            ...this.common\n        ];\n        almanac.uncommon = filterFn ? this.uncommon.filter(filterFn) : [\n            ...this.uncommon\n        ];\n        almanac.rare = filterFn ? this.rare.filter(filterFn) : [\n            ...this.rare\n        ];\n        almanac.veryRare = filterFn ? this.veryRare.filter(filterFn) : [\n            ...this.veryRare\n        ];\n        return almanac;\n    }\n    /**\n   * Get a random entry from the almanac.\n   * @returns {AlmanacEntry}\n   */ getRandomEntry() {\n        const cutoff = Math.random();\n        if (cutoff < $ecf189a3ccc267f7$var$COMMON_CUTOFF) return this.getRandomCommonEntry();\n        else if (cutoff < $ecf189a3ccc267f7$var$UNCOMMON_CUTOFF) return this.getRandomUncommonEntry();\n        else if (cutoff < $ecf189a3ccc267f7$var$RARE_CUTOFF) return this.getRandomRareEntry();\n        else return this.getRandomVeryRareEntry();\n    }\n    /**\n   * Get a random entry from the almanac's common elements.\n   * @returns {AlmanacEntry}\n   */ getRandomCommonEntry() {\n        return $95fc563048a48bb6$export$a885de3766ef0b4c(this.common);\n    }\n    /**\n   * Get a random entry from the almanac's uncommon elements. If there are no\n   * uncommon entries, it falls back to common.\n   * @returns {AlmanacEntry}\n   */ getRandomUncommonEntry() {\n        if (this.uncommon.length === 0) return this.getRandomCommonEntry();\n        else return $95fc563048a48bb6$export$a885de3766ef0b4c(this.uncommon);\n    }\n    /**\n   * Get a random entry from the almanac's rare elements. If there are no\n   * rare entries, it falls back to uncommon.\n   * @returns {AlmanacEntry}\n   */ getRandomRareEntry() {\n        if (this.rare.length === 0) return this.getRandomUncommonEntry();\n        else return $95fc563048a48bb6$export$a885de3766ef0b4c(this.rare);\n    }\n    /**\n   * Get a random entry from the almanac's very rare elements. If there are no\n   * very rare entries, it falls back to rare.\n   * @returns {AlmanacEntry}\n   */ getRandomVeryRareEntry() {\n        if (this.veryRare.length === 0) return this.getRandomRareEntry();\n        else return $95fc563048a48bb6$export$a885de3766ef0b4c(this.veryRare);\n    }\n}\nclass $ecf189a3ccc267f7$var$AlmanacLibrary {\n    /** @type {Map<string, Almanac>} */ #almanacs;\n    constructor(){\n        this.#almanacs = new Map();\n    }\n    /**\n   * Add Almanac\n   * @param {string} key\n   * @param {Almanac} almanac\n   */ addAlmanac(key, almanac) {\n        this.#almanacs.set(key, almanac);\n    }\n    /**\n   * Get Almanac\n   * @param {string} key\n   * @returns {Almanac}\n   */ getAlmanac(key) {\n        const result = this.#almanacs.get(key);\n        if (!result) (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Attempt to get non-existent almanac ${key}`);\n        return result;\n    }\n    /**\n   * Get a random entry from the key\n   * @param {string | string[]} keyOrKeys - almanac\n   * @param {function(entry:AlmanacEntry):boolean} filterFn\n   * @returns {AlmanacEntry} null if none found.\n   */ getRandomEntry(keyOrKeys, filterFn) {\n        let key;\n        if (Array.isArray(keyOrKeys)) key = $95fc563048a48bb6$export$a885de3766ef0b4c(keyOrKeys);\n        else key = keyOrKeys;\n        let almanac = this.getAlmanac(key).filter(filterFn);\n        if (almanac) return almanac.getRandomEntry();\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Failed to find almanac with key ${key}`);\n        return;\n    }\n    /** Find an entry by its id.\n   * @param {string} id\n   * @param {string[]} keys - the almanacs to search\n   * @returns {AlmanacEntry}\n   */ findById(id, keys) {\n        if (!keys) keys = this.#almanacs.keys();\n        for (const key of keys){\n            const result = this.#almanacs.get(key)?.find((entry)=>entry.id === id);\n            if (result) return result;\n        }\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Failed to find almanac entry for '${id}' in ${keys.join(\", \")}`);\n        return;\n    }\n    /** Create a pool of almanacs as one new almanac.\n   * Only entries who pass the filterFn test, if provided, are returned.\n   * @param {string[]} keys - almanacs to search\n   * @param {function(entry:AlmanacEntry):boolean} filterFn\n   * @returns {Almanac}\n   */ getPooledAlmanac(almanacKeys, filterFn) {\n        const pooledAlmanac = new $ecf189a3ccc267f7$export$291e94b80cdb6dd6();\n        almanacKeys.forEach((key)=>{\n            const almanac = this.getAlmanac(key).filter(filterFn);\n            pooledAlmanac.mergeAlmanac(almanac);\n        });\n        return pooledAlmanac;\n    }\n    /**\n   *\n   * @param {string} key - almanac key\n   * @param {*} type - entry type\n   * @returns {module:players/artefacts~ArtefactTypeValue | module:players/actors~ActorTypeValue }\n   */ getItemType(key, type) {\n        switch(key){\n            case \"HEROES\":\n            case \"ENEMIES\":\n            case \"PORTALS\":\n            case \"TRADERS\":\n                return (0, $ce45fe1849aeb7ad$export$4a19f89b3effac)(type);\n            default:\n                return (0, $547c634f23f1bc62$export$6f0824563061af7a)(type);\n        }\n    }\n}\nfunction $ecf189a3ccc267f7$export$1943ae6675bfce8b(line, almanacKey) {\n    const parts = line.match(/^ *(\\d+) *, *(\\w+ ?\\w+) *, *(\\w+) *, *([\\w+?/]*) *(?:\\[ *([\\w, ]*?)])? *\\*(.*)$/);\n    if (!parts) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Invalid almanac entry ${line}`);\n        return null;\n    }\n    const entry = {};\n    const traitsString = parts[6] ?? \"\";\n    entry.minLevel = parseInt(parts[1]);\n    entry.rarity = parts[2].toUpperCase();\n    entry.typeId = parts[3];\n    entry.type = $ecf189a3ccc267f7$export$62947dea9802b3b0.getItemType(almanacKey, entry.typeId);\n    entry.id = parts[4];\n    const derivedParts = $63e994f329905eac$export$7659ebb14ded9371(entry.id);\n    entry.name = derivedParts.name;\n    entry.imageName = derivedParts.imageName;\n    entry.description = derivedParts.description;\n    entry.unknownDescription = derivedParts.unknownDescription;\n    entry.equipmentIds = $ecf189a3ccc267f7$var$csvToArray(parts[5]);\n    entry.traitsString = `_TYPE_ID:${entry.typeId},${traitsString}`;\n    entry.challengeRating = $ecf189a3ccc267f7$var$extractCrValue(entry.traitsString);\n    return entry;\n}\n/**\n * Extract the CR rating as this is used as a filter.\n * @param {string} traits\n */ function $ecf189a3ccc267f7$var$extractCrValue(traits) {\n    const match = traits?.match(/CR *[:=] *([\\d.]+)/);\n    return match ? $95fc563048a48bb6$export$437ba3be5ce2ff51(match[1], 0) : 0;\n}\n/**\n * Parse comma separated list of equipment ids into array.\n * @param {string} list\n * @returns {string[]}\n */ function $ecf189a3ccc267f7$var$csvToArray(list) {\n    return list ? list.trim().split(/\\s*,\\s*/) : list;\n}\n/**\n * Parse text file into almanac\n * @param {string} text\n * @param {string} key - Almanac key\n * @returns {Almanac}\n */ function $ecf189a3ccc267f7$var$parseAlmanacText(text, key) {\n    const almanac = new $ecf189a3ccc267f7$export$291e94b80cdb6dd6();\n    const lines = text.split(/[\\r\\n]+/);\n    lines.forEach((line)=>{\n        line = line.trim();\n        if (line !== \"\" && !line.startsWith(\"#\")) {\n            const entry = $ecf189a3ccc267f7$export$1943ae6675bfce8b(line, key);\n            if (entry) switch(entry.rarity){\n                case $ecf189a3ccc267f7$export$a1da6658a8e18ee2.VERY_RARE:\n                    almanac.veryRare.push(entry);\n                    break;\n                case $ecf189a3ccc267f7$export$a1da6658a8e18ee2.RARE:\n                    almanac.rare.push(entry);\n                    break;\n                case $ecf189a3ccc267f7$export$a1da6658a8e18ee2.UNCOMMON:\n                    almanac.uncommon.push(entry);\n                    break;\n                case $ecf189a3ccc267f7$export$a1da6658a8e18ee2.COMMON:\n                default:\n                    almanac.common.push(entry);\n                    break;\n            }\n        }\n    });\n    return almanac;\n}\nfunction $ecf189a3ccc267f7$export$8775ef33499e3a00(urlMap) {\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Loading almanacs.`);\n    const promises = [];\n    urlMap.forEach((url, key)=>{\n        const promise = $4f6b2ca1724556cd$export$fa2f0f26e19d189b(url).then((text)=>{\n            const almanac = $ecf189a3ccc267f7$var$parseAlmanacText(text, key);\n            $ecf189a3ccc267f7$export$62947dea9802b3b0.addAlmanac(key, almanac);\n        });\n        promises.push(promise);\n    });\n    return Promise.all(promises);\n}\nconst $ecf189a3ccc267f7$export$62947dea9802b3b0 = new $ecf189a3ccc267f7$var$AlmanacLibrary();\n\n\n/**\n * Create an artefact.\n * @param {module:dnd/almanacs/almanacActors~AlmanacEntry} almanacEntry\n * @param {Object} detail\n * @param {string} detail.imageName\n * @param {module:dnd/traits~Traits} detail.traits\n * @param {string} detail.description\n * @param {string} detail.unknownDescription\n *\n */ function $bc745e7d6b7258f3$var$createArtefact(almanacEntry, detail) {\n    const artefact = new (0, $547c634f23f1bc62$export$5612627710242fc2)(almanacEntry, detail.description, `${detail.imageName}.png`, detail.unknownDescription);\n    artefact.traits = detail.traits;\n    return artefact;\n}\nfunction $bc745e7d6b7258f3$export$f71b2f640dbd3eb(almanacEntry, initialTraits) {\n    let traits;\n    let imageName;\n    if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(almanacEntry.type, (0, $547c634f23f1bc62$export$e451727f06f039f2).SPELL)) {\n        traits = initialTraits ?? new (0, $b7c201230645b878$export$57c6a82d5c690092)(almanacEntry.traitsString);\n        imageName = \"spell\";\n    } else if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(almanacEntry.type, (0, $547c634f23f1bc62$export$e451727f06f039f2).CANTRIP)) {\n        traits = initialTraits ?? new (0, $b7c201230645b878$export$57c6a82d5c690092)(almanacEntry.traitsString);\n        imageName = \"cantrip\";\n    } else {\n        traits = initialTraits ?? new (0, $b7c201230645b878$export$f0f803f528a8d270)(almanacEntry.traitsString);\n        imageName = almanacEntry.imageName;\n    }\n    traits.set(\"NAME\", almanacEntry.name);\n    const artefact = $bc745e7d6b7258f3$var$createArtefact(almanacEntry, {\n        description: almanacEntry.description,\n        unknownDescription: almanacEntry.unknownDescription,\n        imageName: imageName,\n        traits: traits\n    });\n    if (artefact.isTrap()) artefact.interaction = new (0, $018d326b648bc43d$export$7d71571167194fbd)(artefact);\n    else if (artefact.isMagic()) artefact.interaction = new (0, $018d326b648bc43d$export$eecad08565115e9c)(artefact);\n    else if (artefact.isConsumable()) artefact.interaction = new (0, $018d326b648bc43d$export$91e310df03ee2deb)(artefact);\n    return artefact;\n}\nfunction $bc745e7d6b7258f3$export$9ff69a0a08d11ae5(id, keys = [\n    \"MONEY\"\n]) {\n    const artefactEntry = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).findById(id, keys);\n    if (!artefactEntry) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Could not find artefact ${id} in ${keys} almanacs.`);\n        return null;\n    }\n    return $bc745e7d6b7258f3$export$f71b2f640dbd3eb(artefactEntry);\n}\n\n\n\n/**\n * @typedef {Object} StoreTypeValue\n * @property {number} space - amount of space in store.\n * @property {boolean} money - if true, a MoneyStore is used.\n * @property {boolean} spacesExpand - if true every artefact takes one space.\n */ /** @type {number} */ const $547c634f23f1bc62$var$UNKNOWN_ARTEFACT_COST_GP = 0.08;\nconst $547c634f23f1bc62$export$39337ab5872e9457 = {\n    HEAD: {\n        id: \"HEAD\",\n        space: 1,\n        money: false,\n        spacesExpand: false\n    },\n    BODY: {\n        id: \"BODY\",\n        space: 1,\n        money: false,\n        spacesExpand: false\n    },\n    WAIST: {\n        id: \"WAIST\",\n        space: 1,\n        money: false,\n        spacesExpand: false\n    },\n    HANDS: {\n        id: \"HANDS\",\n        space: 2,\n        money: false,\n        spacesExpand: false\n    },\n    FEET: {\n        id: \"FEET\",\n        space: 2,\n        money: false,\n        spacesExpand: false\n    },\n    BACKPACK: {\n        id: \"BACKPACK\",\n        space: 8,\n        money: false,\n        spacesExpand: true\n    },\n    WAGON: {\n        id: \"WAGON\",\n        space: 8,\n        money: false,\n        spacesExpand: true\n    },\n    CANTRIPS: {\n        id: \"CANTRIPS\",\n        space: 999,\n        money: false,\n        spacesExpand: true\n    },\n    RING_FINGERS: {\n        id: \"RING_FINGERS\",\n        space: 2,\n        money: false,\n        spacesExpand: false\n    },\n    SPELLS: {\n        id: \"SPELLS\",\n        space: 9,\n        money: false,\n        spacesExpand: true\n    },\n    PREPARED_SPELLS: {\n        id: \"PREPARED SPELLS\",\n        space: 9,\n        money: false,\n        spacesExpand: true\n    },\n    PURSE: {\n        id: \"PURSE\",\n        space: Number.MAX_SAFE_INTEGER,\n        money: true,\n        spacesExpand: false\n    }\n};\nconst $547c634f23f1bc62$export$e451727f06f039f2 = {\n    ARMOUR: {\n        id: \"armour\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.WAGON,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.BODY\n        }\n    },\n    BELT: {\n        id: \"belt\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.WAIST\n        }\n    },\n    CANTRIP: {\n        id: \"cantrip\",\n        storageSpace: 1,\n        storeType: {\n            stash: null,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.CANTRIPS\n        }\n    },\n    COINS: {\n        id: \"coins\",\n        storageSpace: 0,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.PURSE\n        }\n    },\n    CONSUMABLE: {\n        id: \"consumable\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK\n        }\n    },\n    GENERIC: {\n        id: \"generic\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK\n        }\n    },\n    HEAD_GEAR: {\n        id: \"head_gear\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.HEAD\n        }\n    },\n    KEY: {\n        id: \"key\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK\n        }\n    },\n    RING: {\n        id: \"ring\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.RING_FINGERS\n        }\n    },\n    SHIELD: {\n        id: \"shield\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.HANDS\n        }\n    },\n    SPELL: {\n        id: \"spell\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.SPELLS,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.PREPARED_SPELLS\n        }\n    },\n    TRAP: {\n        id: \"trap\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK\n        }\n    },\n    TWO_HANDED_WEAPON: {\n        id: \"two_handed_weapon\",\n        storageSpace: 2,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.HANDS\n        }\n    },\n    WEAPON: {\n        id: \"weapon\",\n        storageSpace: 1,\n        storeType: {\n            stash: $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK,\n            equip: $547c634f23f1bc62$export$39337ab5872e9457.HANDS\n        }\n    }\n};\nfunction $547c634f23f1bc62$export$6a37929f445864b2(id) {\n    return $547c634f23f1bc62$export$e451727f06f039f2[id.toUpperCase()];\n}\nfunction $547c634f23f1bc62$export$e633b6e759dec9c9(itemA, itemB) {\n    return itemA?.id === itemB?.id;\n}\nfunction $547c634f23f1bc62$export$6f0824563061af7a(str) {\n    const type = $547c634f23f1bc62$export$e451727f06f039f2[str];\n    if (type === null || type === undefined) (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Unrecognised artefact type: ${str}`);\n    return type;\n}\n/**\n * @interface StoreInterface\n */ /**\n * @function StoreInterface.store\n * @param {Artefact} artefact\n * @returns {boolean} true if stored, else false.\n */ /**\n * @function StoreInterface.retrieve\n * @param {Artefact} artefact\n * @returns {Artefact} the retrieved artefact which is removed from the store.\n */ /**\n * @function StoreInterface.canAdd\n * @param {Artefact} artefact\n * @returns {boolean} true if it can be added.\n */ /**\n * @function StoreInterface.has\n * @param {Artefact} artefact\n * @returns {boolean} true if it has the artefact.\n */ /**\n * @property {StoreType} StoreInterface.storeType\n */ /**\n * @property {string} StoreInterface.storeTypeId\n */ /**\n * Store for artefacts\n * @implements {StoreInterface}\n */ class $547c634f23f1bc62$var$ArtefactStore {\n    /** @type {number} */ #maxSize;\n    /** @type {Map<Artefact, Artefact>} */ #artefacts;\n    /** @type {number} */ #usedSpace;\n    /** @type {boolean} */ #spacesExpand;\n    /** @type {StoreType} */ #storeType;\n    /** Create store.\n   * @param {number} maxSize;\n   * @param {boolean} spacesExpand - if true, each space can take an artefact of\n   * any size.\n   */ constructor(maxSize, spacesExpand, storeType){\n        this.#maxSize = maxSize;\n        this.#usedSpace = 0;\n        this.#artefacts = new Map();\n        this.#spacesExpand = spacesExpand;\n        this.#storeType = storeType;\n    }\n    /**\n   * Get store type ID\n   * @returns {string}\n   */ get storeTypeId() {\n        return this.#storeType.id;\n    }\n    /**\n   * Get the store type\n   * @returns {StoreType}\n   */ get storeType() {\n        return this.#storeType;\n    }\n    /**\n   * Get free space\n   * @returns {number}\n   */ get freeSpace() {\n        return this.#maxSize - this.#usedSpace;\n    }\n    /**\n   * Get maximum space\n   * @returns {number}\n   */ get maxSpace() {\n        return this.#maxSize;\n    }\n    /**\n   * Adjust capacity. Note it cannot be reduced below the number of items already\n   * contained.\n   * @param {number} capacity\n   * @returns {number} resulting capacity\n   */ adjustCapacity(capacity) {\n        this.#maxSize = Math.max(capacity, this.#usedSpace);\n        return this.#maxSize;\n    }\n    /**\n   * Test if empty\n   * @returns {boolean}\n   */ isEmpty() {\n        return this.#usedSpace === 0;\n    }\n    /** Get the space required by an artefact. If #spacesExpand\n   * this is always 1.\n   * @param {Artefact}\n   * @returns {number}\n   */ getRequiredSpace(artefact) {\n        return this.#spacesExpand ? 1 : artefact.storageSpace;\n    }\n    /**\n   * Test if store has artefact.\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */ has(artefact) {\n        return this.#artefacts.has(artefact);\n    }\n    /**\n   *\n   * @param {Artefact} artefact\n   * @returns {boolean} true if stored; false if no room.\n   */ add(artefact) {\n        const space = this.#maxSize - this.#usedSpace;\n        const requiredSpace = this.getRequiredSpace(artefact);\n        if (space >= requiredSpace) {\n            this.#artefacts.set(artefact, artefact);\n            this.#usedSpace += requiredSpace;\n            return true;\n        }\n        return false;\n    }\n    /**\n   * Retrieve artefact. This removes it from the store.\n   * @param {Artefact} artefact - to retrieve.\n   * @returns {Artefact} null if not found.\n   */ take(artefact) {\n        const storedArtefact = this.#artefacts.get(artefact);\n        const requiredSpace = this.getRequiredSpace(artefact);\n        if (storedArtefact) {\n            this.#usedSpace -= requiredSpace;\n            this.#artefacts.delete(storedArtefact);\n        }\n        return storedArtefact;\n    }\n    /**\n   * Get the first element. It isn't removed from storage\n   * @returns {Artefact} null if empty.\n   */ getFirst() {\n        if (this.isEmpty()) return null;\n        return this.#artefacts.values().next().value;\n    }\n    /**\n   * Take the first element.\n   * @returns {Artefact} null if empty.\n   */ takeFirst() {\n        if (this.isEmpty()) return null;\n        const firstArtefact = this.#artefacts.values().next().value;\n        return this.take(firstArtefact);\n    }\n    /**\n   * Iterable values in the store.\n   * @returns {Iterable<Artefacts>}\n   */ values() {\n        return this.#artefacts.values();\n    }\n    /**\n   * Test if an artefact can be stored.\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */ canAdd(artefact) {\n        const requiredSpace = this.getRequiredSpace(artefact);\n        return this.#maxSize - this.#usedSpace >= requiredSpace;\n    }\n}\n/**\n * Gold storage. This effectively merges artifacts into one combining the VALUE trait.\n * Note that if only one artefact is added, it is returned. Once more than one has been\n * added a composite money artefact is returned.\n * @implements {StoreInterface}\n */ class $547c634f23f1bc62$var$MoneyStore {\n    /** @type {Artefact} */ #artefact;\n    /** @type {boolean} */ #multipleArtefacts;\n    /** Create store.\n   * @param {number} maxSize;\n   */ constructor(){\n        this.#multipleArtefacts = false;\n    }\n    /**\n   * Get store type\n   * @returns {StoreType}\n   */ get storeType() {\n        return $547c634f23f1bc62$export$39337ab5872e9457.PURSE;\n    }\n    /**\n   * Get store type Id\n   * @returns {StoreType}\n   */ get storeTypeId() {\n        return $547c634f23f1bc62$export$39337ab5872e9457.PURSE.id;\n    }\n    /**\n   * Test if empty\n   * @override\n   * @returns {boolean}\n   */ isEmpty() {\n        return !this.#artefact || this.#artefact.costInGp === 0;\n    }\n    /**\n   * Test if store has any money.\n   * @override\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */ has(artefactUnused) {\n        return this.#artefact.costInGp > 0;\n    }\n    /**\n   * The artefact is just used as a carrier for the cost.\n   * @override\n   */ add(artefact) {\n        const costDetails = artefact.costDetails;\n        if (!this.#artefact) {\n            this.#artefact = artefact.clone();\n            return true;\n        }\n        const currentCostDetails = this.#artefact.costDetails;\n        if (!this.#multipleArtefacts) {\n            this.#artefact = $547c634f23f1bc62$var$MoneyStore.createGoldCoinArtefact(currentCostDetails.valueGp);\n            this.#multipleArtefacts = true;\n        }\n        this.#artefact.costInGp = currentCostDetails.valueGp + costDetails.valueGp;\n        return true;\n    }\n    /**\n   * Retrieve an artefact.\n   * @param {Artefact} artefact\n   * @returns {Artefact} value set to value of gold taken which may be less\n   * than the requested amount..\n   */ take(artefact) {\n        const taken = Math.min(this.#artefact.costInGp, artefact.costInGp);\n        this.#artefact.costInGp = this.#artefact.costInGp - taken;\n        artefact.costInGp = taken; //may be less than requested.\n        return artefact;\n    }\n    /**\n   * Test if artefact can be added.\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */ canAdd(artefactUnused) {\n        return true;\n    }\n    /**\n   * Get iterable of values. For the gold store there is only one.\n   * @returns {Iterable<Artefacts>}\n   */ values() {\n        if (!this.#artefact || this.#artefact.costInGp === 0) return [].values();\n        else return [\n            this.#artefact.clone()\n        ].values();\n    }\n    /**\n   * Create a gold coin artefact.\n   * @param {number} gp\n   * @returns {Artefact}\n   */ static createGoldCoinArtefact(gp) {\n        const almanacEntry = (0, $ecf189a3ccc267f7$export$1943ae6675bfce8b)(`0,COMMON,COINS,gold_coins * VALUE:${gp}GP`);\n        const artefact = (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(almanacEntry);\n        artefact.costInGp = gp;\n        return artefact;\n    }\n}\nclass $547c634f23f1bc62$export$5612627710242fc2 {\n    /** @type {string} */ id;\n    /** @type {string} */ iconImageName;\n    /** @type {string} */ description;\n    /** @type {ArtefactTypeValue} */ artefactType;\n    /** @type {module:dnd/traits~ArtefactTraits} */ traits;\n    /** @type {AbstractInteraction} */ interaction;\n    /** @type {module:dnd/almanacs/almanacs~AlmanacEntry} */ almanacEntry;\n    /** @type {boolean} */ unknown;\n    /**\n   * Create artefact.\n   * @param {AlmanacEntry} almanacEntry\n   * @param {string} description\n   * @param {string} iconImageName\n   * @param {number} artefactType - artefact enumeration\n   * @param {string} unknownDescription - description if not identified. If null\n   * or undefined or '' the artefact is regarded as identified.\n   */ constructor(almanacEntry, description, iconImageName, unknownDescription){\n        this.id = almanacEntry.id;\n        this.description = description;\n        this.iconImageName = iconImageName;\n        this.artefactType = almanacEntry.type;\n        this.almanacEntry = almanacEntry;\n        this.unknownDescription = unknownDescription;\n        this.unknown = !!unknownDescription;\n    }\n    /** Get the cost details.\n   * @returns {module:game/coins~CoinDetails}\n   */ get costDetails() {\n        const coinDefn = this.traits?.get(\"VALUE\");\n        return $f4fc9532da3395ea$export$b0d0adc40593e6c1(coinDefn);\n    }\n    /**\n   * Get the artefact cost in GP;\n   * @returns {number}\n   */ get costInGp() {\n        if (this.unknown) return $547c634f23f1bc62$var$UNKNOWN_ARTEFACT_COST_GP;\n        const coinDefn = this.traits?.get(\"VALUE\");\n        return $f4fc9532da3395ea$export$51c187ac2e2bbbe8(coinDefn);\n    }\n    /**\n   * Get the artefact sell back price in GP. Coins are sold back at normal cost.\n   * @returns {number}\n   */ get sellBackPriceInGp() {\n        if ($547c634f23f1bc62$export$e633b6e759dec9c9(this.artefactType, $547c634f23f1bc62$export$e451727f06f039f2.COINS)) return this.costInGp;\n        else {\n            const cost = this.unknown ? $547c634f23f1bc62$var$UNKNOWN_ARTEFACT_COST_GP : this.costInGp;\n            return Math.round(50 * cost) / 100; // 50% from p62 SRD 5.1\n        }\n    }\n    /**\n   * Set the artefact cost in GP;\n   * @param {number} gp\n   */ set costInGp(gp) {\n        if (!this.traits) throw new Error(\"Artefact has no traits so cannot set cost.\");\n        this.traits.set(\"VALUE\", $f4fc9532da3395ea$export$1df1004f151c8ed5(gp));\n    }\n    /** Get the storage space used by this artefact.\n   * @returns {number}\n   */ get storageSpace() {\n        return this.artefactType.storageSpace;\n    }\n    /**\n   * Get stash store type\n   * @returns {StoreTypeValue}\n   */ get stashStoreType() {\n        return this.artefactType.storeType.stash;\n    }\n    /**\n   * Get equip store type\n   * @returns {StoreTypeValue}\n   */ get equipStoreType() {\n        return this.artefactType.storeType.equip;\n    }\n    /** Convenience method to test if the stash store is a wagon.\n   * @returns {boolean}\n   */ get stashInWagon() {\n        return this.stashStoreType === $547c634f23f1bc62$export$39337ab5872e9457.WAGON;\n    }\n    /**\n   * @returns {StoreTypeValue}\n   */ getDefaultStoreType() {\n        return this.artefactType.storeType.stash ?? this.artefactType.storeType.equip;\n    }\n    /**\n   * Get all store types\n   * @returns {StoreTypeValue[]}\n   */ getStoreTypes() {\n        const storeTypes = [];\n        if (this.artefactType.storeType.stash) storeTypes.push(this.artefactType.storeType.stash);\n        if (this.artefactType.storeType.equip) storeTypes.push(this.artefactType.storeType.equip);\n        return storeTypes;\n    }\n    /**\n   * Clone the artefact\n   */ clone() {\n        const clone = new $547c634f23f1bc62$export$5612627710242fc2(this.almanacEntry, this.description, this.iconImageName, this.unknownDescription);\n        clone.traits = this.traits.clone();\n        clone.value = this.value;\n        clone.unknown = this.unknown;\n        return clone;\n    }\n    /**\n   * Test if this is a magical item.\n   * @returns {boolean}\n   */ isMagic() {\n        return $547c634f23f1bc62$export$e633b6e759dec9c9(this.artefactType, $547c634f23f1bc62$export$e451727f06f039f2.SPELL) || $547c634f23f1bc62$export$e633b6e759dec9c9(this.artefactType, $547c634f23f1bc62$export$e451727f06f039f2.CANTRIP);\n    }\n    /**\n   * Test if this is a trap item.\n   * @returns {boolean}\n   */ isTrap() {\n        return $547c634f23f1bc62$export$e633b6e759dec9c9(this.artefactType, $547c634f23f1bc62$export$e451727f06f039f2.TRAP);\n    }\n    /**\n   * Test if this is a useable item.\n   * @returns {boolean}\n   */ isUsable() {\n        return !!this.interaction?.canReact();\n    }\n    /** Test if this is consumable.\n   * @returns {boolean}\n   */ isConsumable() {\n        return $547c634f23f1bc62$export$e633b6e759dec9c9(this.artefactType, $547c634f23f1bc62$export$e451727f06f039f2.CONSUMABLE);\n    }\n    /**\n   * Convert to JSON.\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */ toJSON() {\n        return {\n            reviver: \"Artefact\",\n            data: {\n                almanacEntry: this.almanacEntry,\n                traits: this.traits,\n                unknown: this.unknown\n            }\n        };\n    }\n    /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   * @param {function(module:dnd/almanacs~AlmanacEntry,module:dnd/traits.Traits)} builder\n   * @returns {Artefact}\n   */ static revive(data, builder) {\n        data.almanacEntry.type = $547c634f23f1bc62$export$6a37929f445864b2(data.almanacEntry.type.id);\n        const artefact = builder(data.almanacEntry, data.traits);\n        artefact.unknown = data.unknown;\n        return artefact;\n    }\n}\nclass $547c634f23f1bc62$export$39a477c01214ccc0 {\n    /** @type {Map<StoreLocation, Artefact[]>} */ #stores;\n    /** @type {boolean} */ #hasWagon;\n    /** @type {function} */ #onChange;\n    /**\n   * Construct artefact storage.\n   * @param {boolean} hasWagon\n   * @param {function()} onChange - called when there is an inventory change.\n   */ constructor(hasWagon, onChange){\n        this.#stores = new Map();\n        this.#hasWagon = hasWagon;\n        for(const storeTypeName in $547c634f23f1bc62$export$39337ab5872e9457){\n            const storeType = $547c634f23f1bc62$export$39337ab5872e9457[storeTypeName];\n            this.#addStore(storeType);\n        }\n        this.#onChange = onChange;\n    }\n    /**\n   * Test if this has a wagon\n   */ get hasWagon() {\n        return this.#hasWagon;\n    }\n    /**\n   * Notify change.\n   */ #notifyChange() {\n        if (this.#onChange) this.#onChange();\n    }\n    /**\n   *\n   * @param {StoreType} storeType\n   */ #addStore(storeType) {\n        if (storeType.money) return this.#stores.set(storeType, new $547c634f23f1bc62$var$MoneyStore(storeType.space, storeType.spacesExpand));\n        let storeValid = true;\n        if (this.#hasWagon && storeType === $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK) storeValid = false;\n        else if (!this.#hasWagon && storeType === $547c634f23f1bc62$export$39337ab5872e9457.WAGON) storeValid = false;\n        if (storeValid) this.#stores.set(storeType, new $547c634f23f1bc62$var$ArtefactStore(storeType.space, storeType.spacesExpand, storeType));\n    }\n    /** Get a store from the store type. Note that a trader's wagon serves\n   * both as a backpack and a wagon.\n   * @param {StoreTypeValue} storeType\n   * @returns {ArtefactStore}\n   */ getStore(storeType) {\n        if (this.#hasWagon && storeType === $547c634f23f1bc62$export$39337ab5872e9457.BACKPACK) storeType = $547c634f23f1bc62$export$39337ab5872e9457.WAGON;\n        return this.#stores.get(storeType);\n    }\n    /** Get a store from the store type. Note that a trader's wagon serves\n   * both as a backpack and a wagon.\n   * @param {string} storeId\n   * @returns {ArtefactStore} null if not found\n   */ getStoreByTypeId(storeTypeId) {\n        for (const store of this.#stores.values()){\n            if (store.storeTypeId === storeTypeId) return store;\n        }\n        return null;\n    }\n    /**\n   * Get the store where an item should be stored. This is normally\n   * the stash store. If a suitable stash store is not available, the equip store is\n   * returned. This is because armour cannot be carried, just worn. The exception is\n   * traders, who can store anything in their packs.\n   * @param {Artefact}\n   * @returns {ArtefactStore} null if it cannot be stored\n   */ findSuitableStore(artefact) {\n        let storeType = artefact.stashStoreType;\n        let store = this.getStore(storeType);\n        if (!store) {\n            storeType = artefact.equipStoreType;\n            store = this.getStore(storeType);\n        }\n        if (store?.canAdd(artefact)) return store;\n        return null;\n    }\n    /**\n   * @param {Artefact} artefact\n   * @returns {boolean} true if successful; false if no space.\n   */ addArtefact(artefact) {\n        const store = this.getStore(artefact.getDefaultStoreType());\n        const result = store?.add(artefact);\n        this.#notifyChange();\n        return result;\n    }\n    /**\n   * @typedef {Object} StorageDetails\n   * @property {ArtefactStore} store\n   * @property {Artefact} artefact\n   */ /**\n   * Get the first stored artefact.\n   * @returns {StorageDetails} null if nothing found\n   */ getFirstStorageDetails() {\n        for (const store of this.#stores.values()){\n            const artefacts = store.values();\n            const value = artefacts.next()?.value;\n            if (value) return {\n                store: store,\n                artefact: value\n            };\n        }\n        return null;\n    }\n    /** Test whether a similar artefact is stored. This is done by\n   * testing the id.\n   * @param {Artefact | string} artefactOrId\n   * @returns {boolean}\n   */ hasArtefactWithSameId(artefactOrId) {\n        const id = typeof artefactOrId === \"string\" ? artefactOrId : artefactOrId.id;\n        const storageDetails = this.getAllStorageDetails();\n        for (const details of storageDetails){\n            if (details.artefact.id === id) return true;\n        }\n        return false;\n    }\n    /** Test whether a specific artefact is stored.\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */ hasArtefact(artefact) {\n        const storageDetails = this.getAllStorageDetails();\n        for (const details of storageDetails){\n            if (details.artefact === artefact) return true;\n        }\n        return false;\n    }\n    /**\n   * Get all equipped artefacts.\n   * @returns {Artefact[]}\n   */ getAllEquippedArtefacts() {\n        const result = [];\n        const stores = [\n            this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.HEAD),\n            this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.BODY),\n            this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.WAIST),\n            this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.HANDS),\n            this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.RING_FINGERS),\n            this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.FEET),\n            this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.CANTRIPS),\n            this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.PREPARED_SPELLS)\n        ];\n        for (const store of stores)for (const item of store.values())result.push(item);\n        return result;\n    }\n    /**\n   * Get all stored artefacts.\n   * @returns {StorageDetails[]}\n   */ getAllStorageDetails() {\n        const storageDetails = [];\n        this.#stores.forEach((store)=>{\n            for (const artefact of store.values())storageDetails.push({\n                store: store,\n                artefact: artefact\n            });\n        });\n        return storageDetails;\n    }\n    /**\n   * Get current gold. A convenience method to access the PURSE\n   * @returns {number}\n   */ getPurseValue() {\n        const content = this.getStore($547c634f23f1bc62$export$39337ab5872e9457.PURSE).values();\n        const artefact = content.next()?.value;\n        return artefact ? artefact.costInGp : 0;\n    }\n    /** Add gold to purse.\n   * @param {number} gp\n   */ addToPurse(gp) {\n        const artefact = $547c634f23f1bc62$var$MoneyStore.createGoldCoinArtefact(gp);\n        this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.PURSE).add(artefact);\n        this.#notifyChange();\n    }\n    /**\n   * Take gold from purse.\n   * @param {number} gp - amount to take.\n   * @returns {number} amount taken.\n   */ takeFromPurse(gp) {\n        const artefact = $547c634f23f1bc62$var$MoneyStore.createGoldCoinArtefact(gp);\n        const taken = this.#stores.get($547c634f23f1bc62$export$39337ab5872e9457.PURSE).take(artefact);\n        this.#notifyChange();\n        return taken.costInGp;\n    }\n    /**\n   * Convenience method to get contents of a store.\n   *\n   * @param {StoreTypeValue} storeType\n   * @returns {Iterable<Artefact>} null if empty\n   */ getStoreContents(storeType) {\n        const store = this.getStore(storeType);\n        return !store || store.isEmpty() ? null : store.values();\n    }\n    /**\n   * Discard an artefact that has been equipped or stashed.\n   * @param {Artefact} artefact\n   * @returns {boolean} true on success.\n   */ discard(artefact) {\n        if (this.discardStashed(artefact, true)) return true;\n        else return this.discardEquipped(artefact);\n    }\n    /**\n   * Discard an artefact that has been equipped.\n   * @param {Artefact} artefact\n   * @param {boolean} quiet\n   * @returns {boolean} true on success.\n   */ discardEquipped(artefact, quiet) {\n        const equipStore = this.getStore(artefact.equipStoreType);\n        if (!equipStore) {\n            if (!quiet) (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Cannot discard artefact as there isn't an equip store.\");\n            return false;\n        }\n        if (!equipStore.take(artefact)) {\n            if (!quiet) (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Artefact could not be found so not discarded.\");\n            return false;\n        }\n        this.#notifyChange();\n        return true;\n    }\n    /**\n   * Discard an artefact that has been stashed.\n   * @param {Artefact} artefact\n   * @param {boolean} quiet\n   * @returns {boolean} true on success.\n   */ discardStashed(artefact, quiet) {\n        const stashStore = this.getStore(artefact.stashStoreType);\n        if (!stashStore) {\n            if (!quiet) (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Cannot discard artefact as there isn't a stash store.\");\n            return false;\n        }\n        if (!stashStore.take(artefact)) {\n            if (!quiet) (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Artefact could not be found so not discarded.\");\n            return false;\n        }\n        this.#notifyChange();\n        return true;\n    }\n    /**\n   * Equip artefact. The artefact should normally exist in the stash unless\n   * the options.direct flag is set.\n   * If space is required, artefacts will be unequipped to make space.\n   * @param {Artefact} artefact\n   * @param {Object} options\n   * @param {boolean} direct - if true, this can be a new object that does not\n   * exist in the stash.\n   * @returns {boolean} true on success.\n   */ equip(artefact, options = {}) {\n        const stashStore = this.getStore(artefact.stashStoreType);\n        const equipStore = this.getStore(artefact.equipStoreType);\n        if (!stashStore && !options.direct) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Cannot equip artefact as there isn`t a stash store to take it from.\");\n            return false;\n        }\n        if (!equipStore) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Cannot equip artefact as there isn't an equip store.\");\n            return false;\n        }\n        const spaceRequired = artefact.storageSpace;\n        if (spaceRequired > equipStore.maxSpace) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"The equip store cannot hold this item.\");\n            return false;\n        }\n        const takenArtefact = stashStore?.take(artefact);\n        if (!takenArtefact && !options.direct) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Could not find artefact in the stash.\");\n            return false;\n        }\n        while(equipStore.freeSpace < spaceRequired){\n            const unequiped = equipStore.takeFirst();\n            stashStore?.add(unequiped);\n        }\n        const result = equipStore.add(artefact);\n        this.#notifyChange();\n        return result;\n    }\n    /**\n   * Unequip and stash artefact. The artefact should normally exist in the equip store unless\n   * the options.direct flag is set.\n   * If space is required in the stash, the attempt fails.\n   * @param {Artefact} artefact\n   * @param {Object} options\n   * @param {boolean} direct - if true, this can be a new object that does not\n   * exist in the stash.\n   * @returns {boolean} true on success.\n   */ stash(artefact, options = {}) {\n        const stashStore = this.getStore(artefact.stashStoreType);\n        const equipStore = this.getStore(artefact.equipStoreType);\n        if (!stashStore) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Cannot stash artefact as there isn`t a suitable stash store to put it in.\");\n            return false;\n        }\n        if (!equipStore && !options.direct) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"No suitable equip store found. If stashing a new artefact, the direct option should be set.\");\n            return false;\n        }\n        const spaceRequired = artefact.storageSpace;\n        if (spaceRequired > stashStore.freeSpace) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"The stash store cannot hold this item.\");\n            return false;\n        }\n        const takenArtefact = equipStore?.take(artefact);\n        if (!takenArtefact && !options.direct) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"The artefact hasn't been equipped so can't unequip it.\");\n            return false;\n        }\n        const result = stashStore.add(artefact);\n        this.#notifyChange();\n        return result;\n    }\n}\n\n\n/**\n * @file Scene manager\n *\n * @module gameManagement/sceneManager\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Convert a screen definition into a scene.\n *\n * @module scriptReaders/sceneDefinitionParser\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Tile map support\n *\n * @module utils/tileMaps/tilePlan\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Various utilities for handling arrays\n *\n * @module utils/arrays/arrayManip\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @typedef Surrounds\n * @property {*} centre - value at centre\n * @property {*} tl - value to top left\n * @property {*} above - value above\n * @property {*} tr - value to top right\n * @property {*} right - value to right\n * @property {*} br - value to bottom right\n * @property {*} below - value below\n * @property {*} bl - value to bottom\n * @property {*} left - value to left\n */ /**\n * Get the surround values from a 2D matrix\n * @param {Array.<Array.<*>>} matrix\n * @param {number} rowIndex\n * @param {number} columnIndex\n * @returns {Surrounds}\n */ function $d9c69096b805bafd$export$7c548b14ef6e7713(matrix, rowIndex, columnIndex) {\n    return {\n        centre: matrix[rowIndex]?.[columnIndex],\n        tl: matrix[rowIndex - 1]?.[columnIndex - 1],\n        above: matrix[rowIndex - 1]?.[columnIndex],\n        tr: matrix[rowIndex - 1]?.[columnIndex + 1],\n        right: matrix[rowIndex]?.[columnIndex + 1],\n        br: matrix[rowIndex + 1]?.[columnIndex + 1],\n        below: matrix[rowIndex + 1]?.[columnIndex],\n        bl: matrix[rowIndex + 1]?.[columnIndex - 1],\n        left: matrix[rowIndex]?.[columnIndex - 1]\n    };\n}\nfunction $d9c69096b805bafd$export$3b231af6e692233f(matrix, options) {\n    const centreX = options.columnIndex;\n    const centreY = options.rowIndex;\n    const result = [];\n    let lookNorth = true;\n    let lookEast = true;\n    let lookSouth = true;\n    let lookWest = true;\n    let offset = 1;\n    let member;\n    let distance = options.distance ?? 1;\n    while(distance-- > 0){\n        if (lookWest) {\n            member = matrix[centreY][centreX - offset];\n            if (options.filter && !options.filter(member)) lookWest = false;\n            else result.push(member);\n        }\n        if (lookEast) {\n            member = matrix[centreY][centreX + offset];\n            if (options.filter && !options.filter(member)) lookEast = false;\n            else result.push(member);\n        }\n        if (lookNorth) {\n            member = matrix[centreY - offset][centreX];\n            if (options.filter && !options.filter(member)) lookNorth = false;\n            else result.push(member);\n        }\n        if (lookSouth) {\n            member = matrix[centreY + offset][centreX];\n            if (options.filter && !options.filter(member)) lookSouth = false;\n            else result.push(member);\n        }\n        offset++;\n    }\n    return result;\n}\n/**\n * Get radiating cross from centre. Takes a 2D matrix and finds all cells\n * that radiate horizontally and vertically from a point.\n * @param {Array.<Array.<*>>} matrix\n * @param {Object} options\n * @param {number} options.rowIndex\n * @param {number} options.columnIndex\n * @param {number} [options.distance = 1] - distance from centre\n * @param {function(member):boolean} options.filter - if provided, must be true otherwise\n * radiation stops.\n * @returns {Array.<*>}\n */ function $d9c69096b805bafd$var$radiateUpAndDown(matrix, options) {\n    const centreX = options.columnIndex;\n    const centreY = options.rowIndex;\n    const result = [];\n    let lookNorth = true;\n    let lookSouth = true;\n    let offset = 1;\n    let member;\n    let distance = options.distance ?? 1;\n    while(distance-- > 0){\n        if (lookNorth) {\n            member = matrix[centreY - offset][centreX];\n            if (options.filter && !options.filter(member)) lookNorth = false;\n            else result.push(member);\n        }\n        if (lookSouth) {\n            member = matrix[centreY + offset][centreX];\n            if (options.filter && !options.filter(member)) lookSouth = false;\n            else result.push(member);\n        }\n        offset++;\n    }\n    return result;\n}\nfunction $d9c69096b805bafd$export$e3a4b77e15204ac(matrix, options) {\n    const centreX = options.columnIndex;\n    const centreY = options.rowIndex;\n    const radius = options.distance ?? 1;\n    let result = [];\n    let lookEast = true;\n    let lookWest = true;\n    let member;\n    const radiusSquared = radius * radius;\n    const upDownOptions = {\n        rowIndex: centreY,\n        columnIndex: centreX,\n        distance: radius,\n        filter: options.filter\n    };\n    result = result.concat($d9c69096b805bafd$var$radiateUpAndDown(matrix, upDownOptions));\n    for(let offset = 1; offset <= radius; offset++){\n        if (!lookWest && !lookEast) break;\n        if (lookWest) {\n            member = matrix[centreY][centreX - offset];\n            if (options.filter && !options.filter(member)) lookWest = false;\n            else {\n                result.push(member);\n                const upDownOptions = {\n                    rowIndex: centreY,\n                    columnIndex: centreX - offset,\n                    distance: Math.round(Math.sqrt(radiusSquared - (offset - 0.5) * (offset - 0.5))),\n                    filter: options.filter\n                };\n                result = result.concat($d9c69096b805bafd$var$radiateUpAndDown(matrix, upDownOptions));\n            }\n        }\n        if (lookEast) {\n            member = matrix[centreY][centreX + offset];\n            if (options.filter && !options.filter(member)) lookEast = false;\n            else {\n                result.push(member);\n                const upDownOptions = {\n                    rowIndex: centreY,\n                    columnIndex: centreX + offset,\n                    distance: Math.round(Math.sqrt(radiusSquared - (offset - 0.5) * (offset - 0.5))),\n                    filter: options.filter\n                };\n                result = result.concat($d9c69096b805bafd$var$radiateUpAndDown(matrix, upDownOptions));\n            }\n        }\n    }\n    return result;\n}\nfunction $d9c69096b805bafd$export$f3448602f079b6d0(source) {\n    let currentIndex = source.length;\n    let randomIndex;\n    // While there remain elements to shuffle.\n    while(currentIndex > 0){\n        randomIndex = Math.floor(Math.random() * currentIndex);\n        currentIndex--;\n        // swap\n        [source[currentIndex], source[randomIndex]] = [\n            source[randomIndex],\n            source[currentIndex]\n        ];\n    }\n    return source;\n}\n\n\n\n/** Symbol used to mark void tiles @type {string} */ const $87eafdba0a48c3b2$var$VOID_SYMBOL = \" \";\nconst $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304 = {\n    WALL: [\n        \"#\",\n        \"*\",\n        \"|\"\n    ],\n    DOOR_IN: [\n        \"-\",\n        \"~\"\n    ],\n    DOOR_OUT: [\n        \"=\",\n        \">\"\n    ],\n    GROUND: [\n        \".\",\n        \":\",\n        \",\",\n        \";\"\n    ],\n    VOID: [\n        \" \"\n    ]\n};\n/**\n * Clarifiers appended to ambiguous design symbols.\n */ const $87eafdba0a48c3b2$var$Clarifiers = {\n    TOP_LEFT: \"-TL\",\n    TOP_LEFT_INTERNAL: \"-TLI\",\n    TOP: \"-T\",\n    TOP_RIGHT: \"-TR\",\n    TOP_RIGHT_INTERNAL: \"-TRI\",\n    RIGHT: \"-R\",\n    BOTTOM_RIGHT: \"-BR\",\n    BOTTOM_RIGHT_INTERNAL: \"-BRI\",\n    BOTTOM: \"-B\",\n    BOTTOM_LEFT: \"-BL\",\n    BOTTOM_LEFT_INTERNAL: \"-BLI\",\n    LEFT: \"-L\",\n    TOP_TEE: \"-TTEE\",\n    RIGHT_TEE: \"-RTEE\",\n    BOTTOM_TEE: \"-BTEE\",\n    LEFT_TEE: \"-LTEE\",\n    INTERNAL_CROSS: \"-XI\",\n    INTERNAL_VERTICAL: \"-VI\",\n    INTERNAL_HORIZONTAL: \"-HI\"\n};\n/**\n * Shadow clarifiers. Added to some symbols to mark it as being below a top wall.\n */ const $87eafdba0a48c3b2$var$ShadowClarifier = {\n    BELOW_WALL: \"-SBW\",\n    BELOW_END_WALL: \"-SBE\"\n};\nclass $87eafdba0a48c3b2$export$5bb21ea01a6aaf38 {\n    /** @type {Array.<Array.<*>>} */ matrix;\n    /** @type {Point} */ entryPointByDoor;\n    /** @type {Point} */ exitPointByDoor;\n    constructor(){\n        this.entryPointByDoor = new (0, $9181799b149b64a5$export$baf26146a414f24a)(0, 0);\n        this.exitPointByDoor = new (0, $9181799b149b64a5$export$baf26146a414f24a)(0, 0);\n    }\n    /**\n   * Converts a tile map design into a tile map plan\n   * @param {TileMapDesign} design\n   * @param {SymbolMap}} symbolMap\n   * @returns {TilePlan}\n   */ static generateTileMapPlan(design, symbolMap) {\n        const tilePlan = new $87eafdba0a48c3b2$export$5bb21ea01a6aaf38();\n        let matrix = tilePlan.convertToMatrix(design);\n        matrix = tilePlan.clarifyMatrix(matrix);\n        tilePlan.createPlan(matrix, symbolMap);\n        return tilePlan;\n    }\n    /**\n   * Convert the user's design from array of strings into a 2D array.\n   * @returns {Array.string[]}\n   */ convertToMatrix(design) {\n        const matrix = [];\n        let nColumns = 0;\n        design.forEach((row)=>{\n            nColumns = Math.max(nColumns, row.length);\n        });\n        design.forEach((row)=>{\n            if (row.length < nColumns) row = row + \" \".repeat(nColumns - length);\n            matrix.push(row.split(\"\"));\n        });\n        return matrix;\n    }\n    /**\n   * Go through the design matrix and convert any ambiguous symbols to more specific\n   * ones. Note the tilePlan matrix is not adjusted. The entry and exit tiles are discovered though.\n   * @param {Array.string[]} matrix\n   */ clarifyMatrix(matrix) {\n        const unambiguousMatrix = [];\n        matrix.forEach((rowValue, rowIndex)=>{\n            const correctedRow = [];\n            unambiguousMatrix.push(correctedRow);\n            rowValue.forEach((colValue, colIndex)=>{\n                const surrounds = (0, $d9c69096b805bafd$export$7c548b14ef6e7713)(matrix, rowIndex, colIndex);\n                if ($87eafdba0a48c3b2$var$isVoid(colValue)) colValue = $87eafdba0a48c3b2$var$VOID_SYMBOL;\n                else if ($87eafdba0a48c3b2$var$isGround(colValue)) {\n                    colValue = $87eafdba0a48c3b2$var$clarifyGround(colValue, surrounds);\n                    if ($87eafdba0a48c3b2$var$isEntryTile(colValue, surrounds)) this.entryPointByDoor = new (0, $9181799b149b64a5$export$baf26146a414f24a)(colIndex, rowIndex);\n                    else if ($87eafdba0a48c3b2$var$isExitTile(colValue, surrounds)) this.exitPointByDoor = new (0, $9181799b149b64a5$export$baf26146a414f24a)(colIndex, rowIndex);\n                } else if ($87eafdba0a48c3b2$var$isPartOfWall(colValue)) colValue = $87eafdba0a48c3b2$var$clarifyWallPart(colValue, surrounds);\n                correctedRow.push(colValue);\n            });\n        });\n        return unambiguousMatrix;\n    }\n    /**\n   * Convert a clarified design plan matrix into a tile plan.\n   * @param {string[][]} matrix\n   * @param {Map<string, *>} symbolMap\n   * @returns {Array.<Array.<*>>}\n   */ createPlan(matrix, symbolMap) {\n        const planMatrix = [];\n        matrix.forEach((rowValue)=>{\n            const planRow = [];\n            planMatrix.push(planRow);\n            rowValue.forEach((columnValue)=>{\n                planRow.push($87eafdba0a48c3b2$var$getDesignInfo(columnValue, symbolMap));\n            });\n        });\n        this.matrix = planMatrix;\n    }\n}\n/**\n * Test if symbol is a void.\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isVoid(symbol) {\n    return $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304.VOID.includes(symbol);\n}\n/**\n * Test if symbol is an entrance.\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isEntrance(symbol) {\n    return $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304.DOOR_IN.includes(symbol);\n}\n/**\n * Test if symbol is an exit.\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isExit(symbol) {\n    return $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304.DOOR_OUT.includes(symbol);\n}\n/**\n * Test if symbol is a door.\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isDoor(symbol) {\n    return $87eafdba0a48c3b2$var$isEntrance(symbol) || $87eafdba0a48c3b2$var$isExit(symbol);\n}\n/**\n * Test if symbol is a wall.\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isWall(symbol) {\n    return $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304.WALL.includes(symbol);\n}\n/**\n * Test if symbol is ground.\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isGround(symbol) {\n    return $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304.GROUND.includes(symbol);\n}\n/**\n * Test if the symbol, unclarified, is part of a wall.\n * @param {string} symbol\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isPartOfWall(symbol) {\n    return $87eafdba0a48c3b2$var$isWall(symbol) || $87eafdba0a48c3b2$var$isDoor(symbol);\n}\n/**\n * Clarify the ground.\n * @param {string} value\n * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n * @return {string}\n */ function $87eafdba0a48c3b2$var$clarifyGround(value, surrounds) {\n    if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.above)) {\n        if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.tl)) value += $87eafdba0a48c3b2$var$ShadowClarifier.BELOW_WALL;\n        else value += $87eafdba0a48c3b2$var$ShadowClarifier.BELOW_END_WALL;\n    }\n    return value;\n}\n/**\n * Check if this floor tile is the entry tile. This is the tile the hero will\n * appear on when entering the map. The tests are made in the order of where\n * the doors is most likely to be placed assuming a left to right, top to bottom\n * design.\n * @param {string} value\n * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isEntryTile(value, surrounds) {\n    return $87eafdba0a48c3b2$var$isEntrance(surrounds.left) || $87eafdba0a48c3b2$var$isEntrance(surrounds.above) || $87eafdba0a48c3b2$var$isEntrance(surrounds.right) || $87eafdba0a48c3b2$var$isEntrance(surrounds.below);\n}\n/**\n * Check if this floor tile is the exit tile. This is the tile the hero will\n * be on when trying to exit the map. The tests are made in the order of where\n * the doors is most likely to be placed assuming a left to right, top to bottom\n * design.\n * @param {string} value\n * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n * @returns {boolean}\n */ function $87eafdba0a48c3b2$var$isExitTile(value, surrounds) {\n    return $87eafdba0a48c3b2$var$isExit(surrounds.right) || $87eafdba0a48c3b2$var$isExit(surrounds.below) || $87eafdba0a48c3b2$var$isExit(surrounds.left) || $87eafdba0a48c3b2$var$isExit(surrounds.above);\n}\n/**\n * Distinguish the type of tile based on its surroundings.\n * This function does not handle corners.\n * @param {string} value\n * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n * @return {string}\n */ function $87eafdba0a48c3b2$var$clarifyWallPart(value, surrounds) {\n    let result = value;\n    // internals centre cross\n    if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.above) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.right) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.below) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.left)) result += $87eafdba0a48c3b2$var$Clarifiers.INTERNAL_CROSS;\n    else if ($87eafdba0a48c3b2$var$isGround(surrounds.left) && $87eafdba0a48c3b2$var$isGround(surrounds.right)) result += $87eafdba0a48c3b2$var$Clarifiers.INTERNAL_VERTICAL;\n    else if ($87eafdba0a48c3b2$var$isGround(surrounds.above) && $87eafdba0a48c3b2$var$isGround(surrounds.below)) result += $87eafdba0a48c3b2$var$Clarifiers.INTERNAL_HORIZONTAL;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.left) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.right) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.below)) result += $87eafdba0a48c3b2$var$Clarifiers.TOP_TEE;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.above) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.below) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.left)) result += $87eafdba0a48c3b2$var$Clarifiers.RIGHT_TEE;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.left) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.right) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.above)) result += $87eafdba0a48c3b2$var$Clarifiers.BOTTOM_TEE;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.above) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.below) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.right)) result += $87eafdba0a48c3b2$var$Clarifiers.LEFT_TEE;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.right) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.below)) result += $87eafdba0a48c3b2$var$isGround(surrounds.br) ? $87eafdba0a48c3b2$var$Clarifiers.TOP_LEFT : $87eafdba0a48c3b2$var$Clarifiers.TOP_LEFT_INTERNAL;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.left) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.below)) result += $87eafdba0a48c3b2$var$isGround(surrounds.bl) ? $87eafdba0a48c3b2$var$Clarifiers.TOP_RIGHT : $87eafdba0a48c3b2$var$Clarifiers.TOP_RIGHT_INTERNAL;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.left) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.above)) result += $87eafdba0a48c3b2$var$isGround(surrounds.tl) ? $87eafdba0a48c3b2$var$Clarifiers.BOTTOM_RIGHT : $87eafdba0a48c3b2$var$Clarifiers.BOTTOM_RIGHT_INTERNAL;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.right) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.above)) result += $87eafdba0a48c3b2$var$isGround(surrounds.tr) ? $87eafdba0a48c3b2$var$Clarifiers.BOTTOM_LEFT : $87eafdba0a48c3b2$var$Clarifiers.BOTTOM_LEFT_INTERNAL;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.above) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.below)) // vertical\n    result += $87eafdba0a48c3b2$var$isGround(surrounds.right) ? $87eafdba0a48c3b2$var$Clarifiers.LEFT : $87eafdba0a48c3b2$var$Clarifiers.RIGHT;\n    else if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.right) && $87eafdba0a48c3b2$var$isPartOfWall(surrounds.left)) // horizontal\n    result += $87eafdba0a48c3b2$var$isGround(surrounds.below) ? $87eafdba0a48c3b2$var$Clarifiers.TOP : $87eafdba0a48c3b2$var$Clarifiers.BOTTOM;\n    if ($87eafdba0a48c3b2$var$isPartOfWall(surrounds.above)) return result += $87eafdba0a48c3b2$var$ShadowClarifier.BELOW_WALL;\n    return result;\n}\n/** Get the design info from the symbol map. The function reduces the specialism\n * of the symbol if it cannot find it. I.e it removes any shadow clarifiers and\n * then all other clarifiers when hunting for the symbol in the symbol map.\n * @param {string} symbol - clarified symbol.\n * @param {Map<string, *>} symbolMap\n * @returns {TileDesignInfo}\n */ function $87eafdba0a48c3b2$var$getDesignInfo(symbol, symbolMap) {\n    if (symbol === $87eafdba0a48c3b2$var$VOID_SYMBOL) return null;\n    const match = symbol.match(/(.)(-[^-]*)?(-[^-]*)?/);\n    let info = symbolMap.get(symbol);\n    if (!info && match[2] && match[3]) info = symbolMap.get(`${match[1]}${match[2]}`); // no shadow clarifier\n    if (!info && match[2]) info = symbolMap.get(match[1]); // no clarifiers at all\n    if (!info) {\n        const fallbackSymbol = $87eafdba0a48c3b2$var$getFirstOfCohort(match[1]);\n        if (fallbackSymbol && fallbackSymbol !== match[1]) return $87eafdba0a48c3b2$var$getDesignInfo($87eafdba0a48c3b2$var$formClarifiedSymbol(fallbackSymbol, match[2], match[3]), symbolMap);\n        else (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Failed to find symbol for ${symbol}`);\n    }\n    return info;\n}\n/**\n * Searches the SpecialSymbols and finds the first entry in the array that matches\n * the unclarified symbol.\n * @param {string} unclarifiedSymbol\n * @returns {string} null if not found\n */ function $87eafdba0a48c3b2$var$getFirstOfCohort(unclarifiedSymbol) {\n    for(const prop in $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304){\n        if ($87eafdba0a48c3b2$export$1b3c5bcd5a8a9304[prop].includes(unclarifiedSymbol)) return $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304[prop][0];\n    }\n    return null;\n}\n/**\n * Add clarifiers onto symbol.\n * @param {string} unclarifiedSymbol\n * @param {string} clarifier\n * @param {string} shadowClarifier\n */ function $87eafdba0a48c3b2$var$formClarifiedSymbol(unclarifiedSymbol, clarifier, shadowClarifier) {\n    let result = unclarifiedSymbol;\n    if (clarifier) result += clarifier;\n    if (shadowClarifier) result += shadowClarifier;\n    return result;\n}\n\n\n/**\n * @file Tile map\n *\n * @module utils/tileMaps/tileMap\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n\n\n/**\n * @file Interactions with the ui\n *\n * @module utils/ui/interactions\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @typedef {function} UiClickCallback\n * @param {Object} target - initial object that triggered the handler\n * @param {module:utils/geometry.Point} point - the position that was clicked in world coordinates\n */ /**\n * BAse for all UiClickHandlers\n */ class $74d763ce9aa88625$export$a82f6454288e7804 {\n    /** @type {UiClickCallback} */ #onClick;\n    /** @type {UiClickCallback} */ #onContextClick;\n    /** @type {UiClickCallback} */ #onPointerDown;\n    /** @type {UiClickCallback} */ #onPointerUp;\n    /** Set click handler. Note that this does not add a listener for the event.\n   * @param {UiClickCallback} handler\n   */ setOnClick(handler) {\n        this.#onClick = handler;\n    }\n    /** Set on context Click handler.\n   * @param {UiClickCallback} handler\n   */ setOnContextClick(handler) {\n        this.#onContextClick = handler;\n    }\n    /** Set pointer down handler. Note that this does not add a listener for the event.\n   * @param {UiClickCallback} handler\n   */ setOnPointerDown(handler) {\n        this.#onPointerDown = handler;\n    }\n    /** Set pointer up handler. Note that this does not add a listener for the event.\n   * @param {UiClickCallback} handler\n   */ setOnPointerUp(handler) {\n        this.#onPointerUp = handler;\n    }\n    /**\n   * Handle click\n   * @param {module:utils/geometry.Point} point\n   */ actionClick(point) {\n        this.#onClick?.(this, point);\n    }\n    /**\n   * Handle context click\n   * @param {module:utils/geometry.Point} point\n   */ actionContextClick(point) {\n        this.#onContextClick?.(this, point);\n    }\n    /**\n   * Handle pointer down\n   * @param {module:utils/geometry.Point} point\n   */ actionPointerDown(point) {\n        this.#onPointerDown?.(this, point);\n    }\n    /**\n   * Handle pointer up\n   * @param {module:utils/geometry.Point} point\n   */ actionPointerUp(point) {\n        this.#onPointerUp?.(this, point);\n    }\n}\n\n\n\n\n/**\n * @file Path finders within a tile map\n *\n * @module utils/tileMaps/pathFinder\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\nclass $a3020fd1bff41e76$export$3565eb3d00ca5a74 {\n    /** @type {Map<string, Point[]>} */ #routes;\n    /** @type {module:utils/tileMaps/tileMap~TileMap} */ #tileMap;\n    /**\n   * Create routes.\n   * @param {module:utils/tileMaps/tileMap~TileMap} tileMap\n   */ constructor(tileMap){\n        this.#tileMap = tileMap;\n        this.#routes = new Map();\n    }\n    /**\n   * Set route to reach coordinates\n   * @param {Point[]} route\n   * @param {*} x\n   * @param {*} y\n   */ setRouteToCoords(route, x, y) {\n        this.#routes.set(this.coordsToKey(x, y), route);\n    }\n    /**\n   * Get route to reach coordinates\n   * @param {*} x\n   * @param {*} y\n   * @returns {Point[]} route}\n   */ getRouteToCoords(x, y) {\n        return this.#routes.get(this.coordsToKey(x, y));\n    }\n    /** Test if routes has route to coords.\n   * @param {number} x - grid position\n   * @param {number} y - grid position\n   * @returns {boolean}\n   */ hasRouteToCoords(x, y) {\n        return this.#routes.has(this.coordsToKey(x, y));\n    }\n    /**\n   * Create a key for the routes map from a row and column.\n   * @param {number} x\n   * @param {number} y\n   * @returns {string}\n   */ coordsToKey(x, y) {\n        return `${x}|${y}`;\n    }\n    /**\n   * Convert a map key to a grid reference.\n   * @param {string} key\n   * @returns {Point} Point giving the tile map grid reference.\n   */ keyToGridPoint(key) {\n        const reference = key.split(\"|\");\n        return new (0, $9181799b149b64a5$export$baf26146a414f24a)(parseInt(reference[0]), parseInt(reference[1]));\n    }\n    /**\n   * Get the entries\n   * @returns {Iterator}\n   */ forEach(callback) {\n        this.#routes.forEach((value, key, map)=>callback(value, key, map));\n    }\n    /**\n   * Check if any routes contains the coordinates\n   * @param {Point} point\n   * @returns {boolean}\n   */ containsGridPoint(point) {\n        return this.#routes.has(this.coordsToKey(point.x, point.y));\n    }\n    /**\n   * Get wayPoints to get to destination of x, y. The starting point is stripped\n   * off. Points are returned as grid references\n   * @param {Point} destination\n   * @returns {Point[]} array of points to reach grid reference x, y. Null if no route.\n   */ getWaypointsAsGridPoints(destination) {\n        const points = this.getRouteToCoords(destination.x, destination.y);\n        if (points && points.length > 1) return points.slice(1);\n        else return null;\n    }\n    /**\n   * Get wayPoints to get to destination of x, y. The starting point is stripped\n   * off.\n   * @param {Point} destination\n   * @returns {Point[]} array of points to reach grid reference x, y\n   */ getWaypointsAsWorldPoints(destination) {\n        const waypoints = this.getWaypointsAsGridPoints(destination);\n        if (waypoints) return waypoints.map((gridPoint)=>this.#tileMap.gridPointToWorldPoint(gridPoint));\n        else return waypoints;\n    }\n}\nclass $a3020fd1bff41e76$export$4c535f8fc4520664 {\n    /** Actor trying to find routes. @type {module:players/actors~Actor} */ actor;\n    /** @type {Route[]} */ #routes;\n    /** @type {module:utils/tileMaps/tileMap~TileMap} */ #tileMap;\n    /** @type {Point} */ #startPoint;\n    /** Create the route finder.\n   * @param {module:utils/tileMaps/tileMap~TileMap} tileMap\n   * @param {module:players/actors.Actor} actor\n   */ constructor(tileMap, actor){\n        this.#tileMap = tileMap;\n        this.actor = actor;\n    }\n    /**\n   * Find a route to the destination gridPoint. Note that it tries to find a route\n   * adjacent to the target grid point, not actually on the grid point. The resulting\n   * route is dumb, in that it does not try all options to maximise movement.\n   * @param {Point} startingGridPoint - starting point\n   * @param {Point} targetGridPoint - starting point\n   * @param {*} maxMove - maximum number of moves allowed.\n   * @returns {Map<string, Point[]>} null if no path available or necessary.\n   */ getDumbRouteNextTo(startingGridPoint, targetGridPoint, maxMove) {\n        let destination = this.#getAdjacentTarget(startingGridPoint, targetGridPoint);\n        if (destination.coincident(startingGridPoint)) return [];\n        if (!this.#tileMap.canGridPointBeOccupiedByActor(destination, this.actor)) destination = this.#rotateGridPointAbout(destination, targetGridPoint);\n        let path = [];\n        let dX = Math.sign(destination.x - startingGridPoint.x);\n        let dY = Math.sign(destination.y - startingGridPoint.y);\n        let waypoint = (0, $9181799b149b64a5$export$baf26146a414f24a).copy(startingGridPoint);\n        let movingX = Math.random() < 0.5;\n        let consecutiveFails = 0;\n        while(maxMove > 0){\n            let nextPoint = (0, $9181799b149b64a5$export$baf26146a414f24a).copy(waypoint);\n            let moved = false;\n            if (movingX && dX !== 0 && waypoint.x != destination.x) {\n                nextPoint.x += dX;\n                moved = true;\n            } else if (!movingX && dY !== 0 && waypoint.y != destination.y) {\n                nextPoint.y += dY;\n                moved = true;\n            }\n            moved = moved && this.#tileMap.canGridPointBeOccupiedByActor(nextPoint, this.actor);\n            if (moved) {\n                consecutiveFails = 0;\n                waypoint = nextPoint;\n                maxMove--;\n            } else {\n                if (++consecutiveFails >= 2) break;\n                if (!waypoint.coincident(startingGridPoint)) path.push(this.#tileMap.gridPointToWorldPoint(waypoint));\n                startingGridPoint = waypoint;\n                movingX = !movingX; //flip axi\n            }\n        }\n        if (!waypoint.coincident(startingGridPoint)) path.push(this.#tileMap.gridPointToWorldPoint(waypoint));\n        return path;\n    }\n    /**\n   * Get all available routes as a Map of paths.\n   * @param {Point} startingGridPoint - starting point\n   * @param {*} maxMove - maximum number of moves allowed.\n   * @returns {Map<string, Point[]>}\n   */ getAllRoutesFrom(startingGridPoint, maxMove) {\n        this.#routes = new $a3020fd1bff41e76$export$3565eb3d00ca5a74(this.#tileMap);\n        this.#startPoint = startingGridPoint;\n        this.#findRoutes(startingGridPoint.x, startingGridPoint.y, maxMove, null);\n        return this.#routes;\n    }\n    /**\n   * @param {number} x - tile x index of current tile\n   * @param {number} y - tile y index of current tile\n   * @param {number} maxTiles - the maximum number of tiles that can be moved.\n   * @param {Point[]} [routePoints] - array of points that\n   * represent current path taken to get here. If null, this is the start of the\n   * route.\n   */ #findRoutes(x, y, movesLeft, routePoints) {\n        if (!routePoints) /* Initialise route. Don't check if it's clear as it may well be occupied\n       * by the sprite seeking a route.\n       */ routePoints = [\n            new (0, $9181799b149b64a5$export$baf26146a414f24a)(x, y)\n        ];\n        else {\n            if (x === this.#startPoint.x && y === this.#startPoint.y) return;\n            else if (!this.#isTilePassable(x, y)) return;\n            const existingRoute = this.#routes.getRouteToCoords(x, y);\n            if (!existingRoute || routePoints.length < existingRoute.length - 1) {\n                routePoints.push(new (0, $9181799b149b64a5$export$baf26146a414f24a)(x, y)); // we have a route to this point\n                if (this.#canTileBeOccupied(x, y)) // only save route if we are actually allowed to occupy its end point.\n                this.#routes.setRouteToCoords(routePoints, x, y);\n                movesLeft--;\n            } else return;\n        }\n        if (movesLeft > 0) {\n            // try all 4 directions\n            this.#findRoutes(x, y - 1, movesLeft, [\n                ...routePoints\n            ]); // up\n            this.#findRoutes(x + 1, y, movesLeft, [\n                ...routePoints\n            ]); // right\n            this.#findRoutes(x, y + 1, movesLeft, [\n                ...routePoints\n            ]); // down\n            this.#findRoutes(x - 1, y, movesLeft, [\n                ...routePoints\n            ]); // left\n        }\n    }\n    /** Check if tile is passable.\n   * @param {number} x\n   * @param {number} y\n   * @returns {boolean}\n   *\n   */ #isTilePassable(x, y) {\n        return this.#tileMap.isGridPointPassableByActor(new (0, $9181799b149b64a5$export$baf26146a414f24a)(x, y), this.actor);\n    }\n    /** Check if tile can be occupied.\n   * @param {number} x\n   * @param {number} y\n   * @returns {boolean}\n   *\n   */ #canTileBeOccupied(x, y) {\n        return this.#tileMap.canGridPointBeOccupiedByActor(new (0, $9181799b149b64a5$export$baf26146a414f24a)(x, y), this.actor);\n    }\n    #getAdjacentTarget(current, target) {\n        const deltaX = target.x - current.x;\n        const deltaY = target.y - current.y;\n        let adjX = target.x;\n        let adjY = target.y;\n        if (Math.abs(deltaX) > Math.abs(deltaY)) adjX -= Math.sign(deltaX);\n        else adjY -= Math.sign(deltaY);\n        return new (0, $9181799b149b64a5$export$baf26146a414f24a)(adjX, adjY);\n    }\n    /**\n   * Rotate a grid point about a target grid point. This does not rotate to\n   * diagonals.\n   */ #rotateGridPointAbout(gridPoint, originPoint) {\n        if (gridPoint.x === originPoint.x && gridPoint.y < originPoint.y) return new (0, $9181799b149b64a5$export$baf26146a414f24a)(gridPoint.x + 1, gridPoint.y + 1);\n        else if (gridPoint.x > originPoint.x && gridPoint.y === originPoint.y) return new (0, $9181799b149b64a5$export$baf26146a414f24a)(gridPoint.x - 1, gridPoint.y + 1);\n        if (gridPoint.x === originPoint.x && gridPoint.y > originPoint.y) return new (0, $9181799b149b64a5$export$baf26146a414f24a)(gridPoint.x - 1, gridPoint.y - 1);\n        if (gridPoint.x < originPoint.x && gridPoint.y === originPoint.y) return new (0, $9181799b149b64a5$export$baf26146a414f24a)(gridPoint.x + 1, gridPoint.y - 1);\n        return gridPoint;\n    }\n}\nclass $a3020fd1bff41e76$export$e832cee54e4e1a4d {\n    /** Actor tracing rays. @type {module:players/actors~Actor} */ #actor;\n    /** Start point of the ray. @type {Point} */ #rayStartPoint;\n    /** @type {module:utils/tileMaps/tileMap~TileMap} */ #tileMap;\n    /** @type {Map<string, Point>} */ #reachedPoints;\n    /** @type {Point}   */ #lastStartPoint;\n    /** @type {Rectangle} */ #bounds;\n    /** @type {Rectangle} */ #lastBounds;\n    /** Create the ray tracer.\n   * @param {module:utils/tileMaps/tileMap~TileMap} tileMap\n   * @param {module:players/actors.Actor} actor\n   */ constructor(tileMap, actor){\n        this.#tileMap = tileMap;\n        this.#actor = actor;\n    }\n    /**\n   * Find all the tiles that are reached from the actor.\n   * @returns {Map<Point>} grid points of reached tiles.\n   */ findReachedTiles() {\n        this.#rayStartPoint = this.#tileMap.worldPointToGrid(this.#actor.position);\n        // this.#bounds = this.#tileMap.getVisibleGridPointRect();\n        this.#bounds = this.#tileMap.getMapGridPointRect();\n        if (this.#lastStartPoint && this.#lastStartPoint.coincident(this.#rayStartPoint) && this.#bounds && this.#bounds.equals(this.#lastBounds)) return this.#reachedPoints;\n        this.#reachedPoints = new Map();\n        this.#reachedPoints.set(this.#rayStartPoint.toString(), this.#rayStartPoint);\n        this.#getRayEnds().forEach((endPoint)=>{\n            this.#traceRayToEnd(endPoint);\n        });\n        this.#lastStartPoint = this.#rayStartPoint;\n        this.#lastBounds = this.#bounds;\n        return this.#reachedPoints;\n    }\n    /**\n   * Test if grid point in rays.\n   * @param {Point} gridPoint\n   * @returns {boolean}\n   */ isGridPointInRays(gridPoint) {\n        return this.#reachedPoints ? this.#reachedPoints.has(gridPoint.toString()) : false;\n    }\n    /**\n   * Get the end point of the rays.\n   * @returns {Point[]} array of the end grid points for each ray.\n   */ #getRayEnds() {\n        const rayEnds = [];\n        for(let col = this.#bounds.x; col <= this.#bounds.x + this.#bounds.width; col++){\n            rayEnds.push(new (0, $9181799b149b64a5$export$baf26146a414f24a)(col, this.#bounds.y));\n            rayEnds.push(new (0, $9181799b149b64a5$export$baf26146a414f24a)(col, this.#bounds.y + this.#bounds.height));\n        }\n        for(let row = this.#bounds.y + 1; row <= this.#bounds.y + this.#bounds.height - 1; row++){\n            rayEnds.push(new (0, $9181799b149b64a5$export$baf26146a414f24a)(this.#bounds.x, row));\n            rayEnds.push(new (0, $9181799b149b64a5$export$baf26146a414f24a)(this.#bounds.x + this.#bounds.width, row));\n        }\n        return rayEnds;\n    }\n    /**\n   * Trace the ray to its end. Note that calculations are done in cartesian coordinates\n   * and so Y values need to be negated during calculations.\n   * @param {Point} endPoint\n   */ #traceRayToEnd(endPoint) {\n        let dx;\n        let dy;\n        let steps;\n        const angle = this.#rayStartPoint.getScreenAngleTo(endPoint);\n        const compassDirection = $95fc563048a48bb6$export$d9ac11c8e8c20b77(angle);\n        if (Math.abs(endPoint.x - this.#rayStartPoint.x) >= Math.abs(endPoint.y - this.#rayStartPoint.y)) {\n            dx = Math.sign(endPoint.x - this.#rayStartPoint.x);\n            steps = Math.abs(endPoint.x - this.#rayStartPoint.x);\n            dy = steps < 1 ? 0 : (endPoint.y - this.#rayStartPoint.y) / steps;\n        } else {\n            dy = Math.sign(endPoint.y - this.#rayStartPoint.y);\n            steps = Math.abs(endPoint.y - this.#rayStartPoint.y);\n            dx = steps < 1 ? 0 : (endPoint.x - this.#rayStartPoint.x) / steps;\n        }\n        let x = this.#rayStartPoint.x;\n        let y = this.#rayStartPoint.y;\n        let firstPoint = true;\n        while(steps >= 0){\n            const gridPoint = new (0, $9181799b149b64a5$export$baf26146a414f24a)(Math.round(x), Math.round(y));\n            if (firstPoint || this.#tileMap.isSeeThrough(gridPoint, this.#actor)) this.#markReachedPoint(gridPoint, compassDirection);\n            else break; // ray ends.\n            firstPoint = false;\n            x += dx;\n            y += dy;\n            steps--;\n        }\n    }\n    /**\n   * Mark the point as reached. Note that surrounding obstacle tiles need to be\n   * shown as well otherwise wall will not appear.\n   * @param {Point} point\n   * @param {number} compassDir - eight point compass direction of ray\n   */ #markReachedPoint(point, compassDir) {\n        this.#reachedPoints.set(point.toString(), point);\n        switch(compassDir){\n            case $95fc563048a48bb6$export$624e7ee3f0468367.N:\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y - 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x, point.y - 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y - 1));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.NE:\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x, point.y - 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y - 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.E:\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y - 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y + 1));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.SE:\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y + 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x, point.y + 1));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.S:\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y + 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x, point.y + 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x + 1, point.y + 1));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.SW:\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y + 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x, point.y + 1));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.W:\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y - 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y + 1));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.NW:\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x - 1, point.y - 1));\n                this.#markReachedIfNotSeeThrough(new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x, point.y - 1));\n                break;\n        }\n    }\n    /**\n   * Mark a tile as Reached if not see through\n   * @param {Point} point\n   */ #markReachedIfNotSeeThrough(point) {\n        if (!this.#tileMap.isSeeThrough(point)) this.#reachedPoints.set(point.toString(), point);\n    }\n}\n\n\n/**\n * @file Colours used in the game.\n *\n * @module constants/colours\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * Colours used in the game.\n * @enum {string}\n */ const $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b = {\n    DOOR_HIGHLIGHT_FILL: \"rgba(0, 255, 0, 0.2)\",\n    DOOR_HIGHLIGHT_STROKE: \"green\",\n    HP_GAUGE: \"rgba(204, 51, 0, 0.4)\",\n    HP_TRANSIENT_TEXT_HERO: \"white\",\n    HP_TRANSIENT_TEXT_ENEMY: \"black\",\n    INTERACT_HIGHLIGHT_FILL: undefined,\n    INTERACT_HIGHLIGHT_STROKE: \"red\",\n    MORALE_GAUGE: \"rgba(0, 0, 255, 0.4)\",\n    MOVE_HIGHLIGHT_FILL: undefined,\n    MOVE_HIGHLIGHT_STROKE: \"white\"\n};\n\n\nconst $ac2e0e274b6f5d79$export$ea490c48f1c71643 = {\n    MOVEMENT_TILE: 0,\n    INTERACT_TILE: 1,\n    OCCUPIED_TILE: 2,\n    HERO_TILE: 3,\n    MOVE_OR_INTERACT_TILE: 4\n};\nconst $ac2e0e274b6f5d79$export$b57fd20cbd2711c3 = {\n    OBSTACLE: -1,\n    GROUND: 0,\n    ENTRANCE: 1,\n    EXIT: 2,\n    STAIRS_UP: 3,\n    STAIRS_DOWN: 4\n};\nclass $ac2e0e274b6f5d79$export$235cb65c20ad2b7 extends (0, $74d763ce9aa88625$export$a82f6454288e7804) {\n    /** @type {module:utils/sprites/sprites.Sprite} */ sprite;\n    /** @type {boolean} */ obstacle;\n    /** @type {module:players/actors~Actor} */ #occupants;\n    /** @type {Point} */ #gridPoint;\n    /** @type {Point} */ #worldPoint;\n    /** @type {TileRole} */ #role;\n    /** Construct tile\n   * @param {module:utils/sprites/sprites.Sprite} tileSprite;\n   * @param {Object} options;\n   * @param {boolean} options.obstacle;\n   * @param {!Point} options.gridPoint;\n   * @param {!Point} options.worldPoint;\n   * @param {TileRole} options.role;\n   */ constructor(tileSprite, options){\n        super();\n        this.sprite = tileSprite;\n        this.#occupants = new Map();\n        this.obstacle = options.obstacle;\n        this.#gridPoint = options.gridPoint;\n        this.#worldPoint = options.worldPoint;\n        this.#role = options.role;\n    }\n    /**\n   * Get the role.\n   */ get role() {\n        return this.#role;\n    }\n    /**\n   * Get the grid point.\n   * @returns {Point}\n   */ get gridPoint() {\n        return this.#gridPoint;\n    }\n    /**\n   * Get the world point.\n   * @returns {Point}\n   */ get worldPoint() {\n        return this.#worldPoint;\n    }\n    /** Add occupant.\n   * @param {import('..utils/game/actors.js').Actor\n   */ addOccupant(occupant) {\n        this.#occupants.set(occupant, occupant);\n    }\n    /** Remove occupant.\n   * @param {module:players/actors.Actor}\n   */ deleteOccupant(occupant) {\n        this.#occupants.delete(occupant);\n    }\n    /** get occupants.\n   * @returns {module:players/actors~Actor[]}\n   */ getOccupants() {\n        return this.#occupants;\n    }\n    /**\n   * Handle the click but change the point to the sprites' position\n   */ actionClick(pointUnused) {\n        super.actionClick(this.sprite.position);\n    }\n    /**\n   * Handle the click but change the point to the sprites' position\n   */ actionContextClick(pointUnused) {\n        super.actionClick(this.sprite.position);\n    }\n    /**\n   * Test if occupied\n   * @returns {boolean}\n   */ isOccupied() {\n        return this.#occupants.size > 0;\n    }\n    /**\n   * Test if tile can be passed by the actor\n   * @param {Object} actor\n   * @returns {boolean}\n   */ isPassableByActor(actor) {\n        if (this.#role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.ENTRANCE || this.#role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.EXIT) return false;\n        if (this.obstacle) return false;\n        for (const occupant of this.#occupants.values()){\n            if (occupant !== actor && !occupant.isPassableByActor(actor)) return false;\n        }\n        return true;\n    }\n    /**\n   * Test if tile can be occupied by the actor\n   * @param {Object} actor\n   * @returns {boolean}\n   */ canBeOccupiedByActor(actor) {\n        if ((this.#role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.ENTRANCE || this.#role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.EXIT) && !actor.isHero()) return false;\n        if (this.obstacle) return false;\n        for (const occupant of this.#occupants.values()){\n            if (occupant !== actor && !occupant.canShareLocationWithActor(actor)) return false;\n        }\n        return true;\n    }\n    /**\n   * Test if tile can be seen through by the actor\n   * @param {Object} actor\n   * @returns {boolean}\n   */ isSeeThrough(actorUnused) {\n        if (this.obstacle || this.#role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.ENTRANCE || this.#role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.EXIT) return false;\n        return true;\n    }\n}\nclass $ac2e0e274b6f5d79$export$16ec26812de3ce7a {\n    /** @type {CanvasRenderingContext2D} */ #context;\n    /** @type {Tile[]} */ #tiles;\n    #tilesX;\n    #tilesY;\n    #gridSize;\n    #width;\n    #height;\n    /** @type {module:utils/tileMaps/pathFinder~Routes} */ #movementRoutes;\n    /** @type {Point[]} */ #movementGridPoints;\n    /** @type {module:utils/sprites/sprites.Sprite} */ #movementTileHighlighter;\n    /** @type {module:utils/sprites/sprites.Sprite} */ #reachableDoorTileHighlighter;\n    /** @type {Tile[]} */ #reachableDoorTileGridPoints;\n    /** @type {Tile} */ #entranceTile;\n    /** @type {Tile} */ #exitTile;\n    /** @type {Point} */ #entryGridPointByDoor;\n    /** @type {Point} */ #exitGridPointByDoor;\n    /** @type {Tile[]} */ #randomGround;\n    /** @type {RayTracer} */ #heroRayTracer;\n    /** @type {Point[]} */ #interactTileGridPoints;\n    /** @type {module:utils/sprites/sprites.Sprite} */ #interactTileHighlighter;\n    /** @type {module:players/actors.Actor} */ #heroActor;\n    /**\n   * Create tile map from 2D matrix\n   * @param {CanvasRenderingContext2D} context\n   * @param {TilePlan} plan\n   * @param {number} gridSize - in world coordinates\n   */ constructor(context, plan, gridSize, heroActor){\n        this.#heroActor = heroActor;\n        const matrix = plan.matrix;\n        this.#entryGridPointByDoor = plan.entryPointByDoor;\n        this.#exitGridPointByDoor = plan.exitPointByDoor;\n        this.#context = context;\n        this.#movementTileHighlighter = new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n            renderer: new (0, $aa0468ffbc97dbfc$export$bea6a7ef06354cc)(context, {\n                width: gridSize,\n                height: gridSize,\n                fillStyle: (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).MOVE_HIGHLIGHT_FILL,\n                strokeStyle: (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).MOVE_HIGHLIGHT_STROKE\n            })\n        });\n        this.#reachableDoorTileHighlighter = new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n            renderer: new (0, $aa0468ffbc97dbfc$export$bea6a7ef06354cc)(context, {\n                width: gridSize,\n                height: gridSize,\n                fillStyle: (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).DOOR_HIGHLIGHT_FILL,\n                strokeStyle: \"green\"\n            })\n        });\n        this.#interactTileHighlighter = new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n            renderer: new (0, $aa0468ffbc97dbfc$export$bea6a7ef06354cc)(context, {\n                width: gridSize,\n                height: gridSize,\n                fillStyle: (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).INTERACT_HIGHLIGHT_FILL,\n                strokeStyle: (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).INTERACT_HIGHLIGHT_STROKE\n            })\n        });\n        this.#gridSize = gridSize;\n        this.#tiles = [];\n        this.#tilesY = matrix.length;\n        this.#tilesX = matrix[0].length;\n        this.#width = gridSize * this.tilesX;\n        this.#height = gridSize * this.tilesY;\n        this.#randomGround = [];\n        matrix.forEach((row, rowIndex)=>{\n            const tileRow = [];\n            this.#tiles.push(tileRow);\n            row.forEach((tileDefn, columnIndex)=>{\n                if (tileDefn) {\n                    const sprite = new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n                        renderer: new (0, $aa0468ffbc97dbfc$export$c1626e6e036a584)(context, (0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(tileDefn.image))\n                    });\n                    const gridPoint = new (0, $9181799b149b64a5$export$baf26146a414f24a)(columnIndex, rowIndex);\n                    const worldPoint = this.gridPointToWorldPoint(gridPoint);\n                    let tile = new $ac2e0e274b6f5d79$export$235cb65c20ad2b7(sprite, {\n                        obstacle: tileDefn.role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.OBSTACLE,\n                        gridPoint: gridPoint,\n                        worldPoint: worldPoint,\n                        role: tileDefn.role\n                    });\n                    if (tileDefn.onClick) tile.setOnClick((target, point)=>this.#filterClick(target, point, tileDefn.onClick));\n                    this.processTileRole(tile);\n                    tileRow.push(tile);\n                    sprite.position.x = columnIndex * this.#gridSize + this.#gridSize / 2;\n                    sprite.position.y = rowIndex * this.#gridSize + this.#gridSize / 2;\n                } else tileRow.push(null);\n            });\n        });\n        if (!this.#entranceTile) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"No entrance has been set. Setting to the first ground tile\");\n            this.#entranceTile = this.#randomGround[0];\n        }\n        if (!this.#exitTile) throw new Error(\"No exit tile.\");\n    }\n    /**\n   * Get tile map dimensions in terms of number of tiles.\n   * @returns {module:utils/geometry~Dims2D}\n   */ getDimsInTiles() {\n        return {\n            width: this.#tilesX,\n            height: this.#tilesY\n        };\n    }\n    /**\n   * Process a tile's specific role.\n   * @param {Tile} tile\n   */ processTileRole(tile) {\n        switch(tile.role){\n            case $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.ENTRANCE:\n                if (this.#entranceTile) {\n                    const gp = tile.gridPoint;\n                    (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Duplicate entrance found at (${gp.x}, ${gp.y}). Ignored.`);\n                } else this.#entranceTile = tile;\n                break;\n            case $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.EXIT:\n                if (this.#exitTile) {\n                    const gp = tile.gridPoint;\n                    (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Duplicate exit found at (${gp.x}, ${gp.y}). Ignored.`);\n                } else this.#exitTile = tile;\n                break;\n            case $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.GROUND:\n                if (!tile.gridPoint.coincident(this.#entryGridPointByDoor)) this.#randomGround.push(tile);\n                break;\n        }\n    }\n    /**\n   * Update method to render tiles.\n   * @param {number} deltaSeconds - elapsed time.\n   */ update(deltaSeconds) {\n        this.#setRayTracer();\n        const visibleGridPoints = this.getVisibleGridPointRect();\n        for(let row = visibleGridPoints.y; row <= visibleGridPoints.y + visibleGridPoints.height; row++){\n            for(let col = visibleGridPoints.x; col <= visibleGridPoints.x + visibleGridPoints.width; col++)if (this.#heroRayTracer?.isGridPointInRays(new (0, $9181799b149b64a5$export$baf26146a414f24a)(col, row))) {\n                const tile = this.#tiles[row][col];\n                tile?.sprite.update(deltaSeconds);\n            }\n        }\n    }\n    /**\n   * Post update. This is used to highlight tiles which should be done after\n   * actors have been drawn.\n   * @param {number} deltaSeconds - elapsed time.\n   */ updateHighlights(deltaSeconds) {\n        this.#highlightTiles(deltaSeconds);\n    }\n    /**\n   * Set up the ray tracer if not already set.\n   */ #setRayTracer() {\n        if (this.#heroActor) {\n            if (!this.#heroRayTracer) this.#heroRayTracer = new (0, $a3020fd1bff41e76$export$e832cee54e4e1a4d)(this, this.#heroActor);\n            const heroTile = this.getTileAtWorldPoint(this.#heroActor.position);\n            if (heroTile) {\n                const heroTileRole = heroTile.role;\n                if (heroTileRole != $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.ENTRANCE && heroTileRole != $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.EXIT) this.#heroRayTracer.findReachedTiles();\n            }\n        }\n    }\n    /**\n   * Get the tile map bounds as a rectangle in grid points.\n   * @returns {Rectangle}\n   */ getMapGridPointRect() {\n        return new (0, $9181799b149b64a5$export$4617fb02663045ef)(0, 0, this.#tilesX, this.#tilesY);\n    }\n    /**\n   * Get the visible bounds as a rectangle in grid points.\n   * @returns {Rectangle}\n   */ getVisibleGridPointRect() {\n        const visibleBounds = (0, $7aed85f370071bde$export$2e2bcd8739ae039).getWorldInCanvasBounds();\n        const gridPointTL = this.worldPointToGrid(new (0, $9181799b149b64a5$export$baf26146a414f24a)(visibleBounds.x, visibleBounds.y));\n        const gridPointBR = this.worldPointToGrid(new (0, $9181799b149b64a5$export$baf26146a414f24a)(visibleBounds.x + visibleBounds.width, visibleBounds.y + visibleBounds.height));\n        const minCol = Math.max(0, gridPointTL.x);\n        const maxCol = Math.min(this.#tilesX - 1, gridPointBR.x);\n        const minRow = Math.max(0, gridPointTL.y);\n        const maxRow = Math.min(this.#tilesY - 1, gridPointBR.y);\n        return new (0, $9181799b149b64a5$export$4617fb02663045ef)(minCol, minRow, maxCol - minCol, maxRow - minRow);\n    }\n    /**\n   * Get the grid size\n   * @returns {number}\n   */ getGridSize() {\n        return this.#gridSize;\n    }\n    /** Get world dimensions.\n   * @returns {module:utils/geometry~Dims2D}\n   */ getDimensions() {\n        return {\n            width: this.#width,\n            height: this.#height\n        };\n    }\n    /**\n   * Get sprite at position.\n   * @param {Point} point - in world coordinates.\n   * @returns {Tile} null if no tile.\n   */ getTileAtWorldPoint(point) {\n        const gridPoint = this.worldPointToGrid(point);\n        return this.getTileAtGridPoint(gridPoint);\n    }\n    /**\n   * Get sprite at position.\n   * @param {Point} point - in grid coordinates.\n   * @returns {Tile} null if no tile.\n   */ getTileAtGridPoint(gridPoint) {\n        if (!gridPoint) return null;\n        const row = gridPoint.y;\n        const col = gridPoint.x;\n        if (col >= 0 && row >= 0 && col < this.#tilesX && row < this.#tilesY) return this.#tiles[row][col];\n        return null;\n    }\n    /**\n   * Convert world coordinate to mad grid reference.\n   * @param {Point} point\n   * @returns {Point}\n   */ worldPointToGrid(point) {\n        return new (0, $9181799b149b64a5$export$baf26146a414f24a)(Math.floor(point.x / this.#gridSize), Math.floor(point.y / this.#gridSize));\n    }\n    /**\n   * Get a world point aligned to the centre of a tile\n   * @param {Point} point\n   */ gridAlignedWorldPoint(point) {\n        const gridPoint = this.worldPointToGrid(point);\n        return this.gridPointToWorldPoint(gridPoint);\n    }\n    /** Convert a point in tile coordinates to world coordinates.\n   * @param {Point}\n   * @returns {Point}\n   */ gridPointToWorldPoint(point) {\n        const halfGrid = 0.5 * this.#gridSize;\n        return new (0, $9181799b149b64a5$export$baf26146a414f24a)(point.x * this.#gridSize + halfGrid, point.y * this.#gridSize + halfGrid);\n    }\n    /** Get the world position of the entrance. The default is the first tile if there\n   * is no door\n   * @returns {Point}\n   */ getWorldPositionOfTileByEntry() {\n        return this.gridPointToWorldPoint(this.#entryGridPointByDoor);\n    }\n    /** Get the grid position of the door at index. If there are no doors, then\n   * the entrance is the first ground tile\n   * @returns {Point}\n   */ getGridPositionOfEntrance() {\n        return this.#entranceTile.gridPoint;\n    }\n    /**\n   * Set the highlighted routes.\n   * @param {*} routes\n   */ setMovementRoutes(routes) {\n        this.#movementRoutes = routes;\n        if (routes) {\n            this.#movementGridPoints = new Map();\n            this.#movementRoutes.forEach((gridPoints)=>gridPoints.forEach((gridPoint)=>{\n                    this.#movementGridPoints.set(gridPoint, gridPoint);\n                }));\n        } else this.#movementGridPoints = null;\n    }\n    /**\n   * Set interaction tiles\n   * @param {Actor[]} actors - actors where a reaction can take place.\n   */ setInteractActors(actors) {\n        this.#interactTileGridPoints = [];\n        actors?.forEach((actor)=>{\n            if (actor.interaction.canReact()) this.#interactTileGridPoints.push(this.worldPointToGrid(actor.position));\n        });\n    }\n    /**\n   * Recalculate the reachable doors.\n   */ calcReachableDoors(heroPosition) {\n        this.#reachableDoorTileGridPoints = [];\n        const surrounds = this.getSurroundingTiles(this.worldPointToGrid(heroPosition));\n        [\n            surrounds.above,\n            surrounds.right,\n            surrounds.below,\n            surrounds.left\n        ].forEach((tile)=>{\n            if (tile.gridPoint.coincident(this.#exitTile.gridPoint)) this.#reachableDoorTileGridPoints.push(tile.gridPoint);\n            else if (tile.gridPoint.coincident(this.#entranceTile.gridPoint)) this.#reachableDoorTileGridPoints.push(tile.gridPoint);\n        });\n    }\n    /**\n   * Highlight routes marked by the highlighters. There are three possible highlights:\n   * movement, interaction and event tiles.\n   * @param {number} deltaSeconds\n   */ #highlightTiles(deltaSeconds) {\n        this.#highlightMovementTiles(deltaSeconds);\n        this.#highlightInteractTiles(deltaSeconds);\n        this.#highlightReachableDoorTiles(deltaSeconds);\n    }\n    /**\n   * Highlight movement routes.\n   * @param {number} deltaSeconds\n   */ #highlightMovementTiles(deltaSeconds) {\n        this.#movementGridPoints?.forEach((gridPoint)=>{\n            this.#movementTileHighlighter.position = this.gridPointToWorldPoint(gridPoint);\n            this.#movementTileHighlighter.update(deltaSeconds);\n        });\n    }\n    /**\n   * Highlight movement routes.\n   * @param {number} deltaSeconds\n   */ #highlightInteractTiles(deltaSeconds) {\n        this.#interactTileGridPoints?.forEach((gp)=>{\n            this.#interactTileHighlighter.position = this.gridPointToWorldPoint(gp);\n            this.#interactTileHighlighter.update(deltaSeconds);\n        });\n    }\n    /**\n   * Highlight reachable door tiles.\n   * @param {number} deltaSeconds\n   */ #highlightReachableDoorTiles(deltaSeconds) {\n        this.#reachableDoorTileGridPoints?.forEach((gp)=>{\n            this.#reachableDoorTileHighlighter.position = this.gridPointToWorldPoint(gp);\n            this.#reachableDoorTileHighlighter.update(deltaSeconds);\n        });\n    }\n    /**\n   * Handle a tile click.\n   * To be actioned a tile must be in the highlightedRoutes\n   * @param {module:utils/sprites/sprites.Sprite} target - the sprite that was clicked. This prevents the need\n   * to use 'this' which may not be correct in the context.\n   * @param {Point} point - the position in the world that was clicked\n   * @param {module:utils/sprites/sprite~SpriteClickHandler} clickHandler\n   */ #filterClick(target, point, clickHandler) {\n        const gridPoint = this.worldPointToGrid(point);\n        let occupant;\n        const occupants = target.getOccupants();\n        if (occupants.size > 0) occupant = occupants.values().next().value;\n        const movement = this.#movementRoutes?.containsGridPoint(gridPoint);\n        let interaction = false;\n        if (this.#interactTileGridPoints) {\n            for (const point of this.#interactTileGridPoints)if (point.isCoincident(gridPoint)) {\n                interaction = true;\n                break;\n            }\n        }\n        const isDeadProp = !occupant?.alive && occupant?.isProp();\n        if (movement && interaction || interaction && isDeadProp) {\n            clickHandler(target, point, {\n                filter: $ac2e0e274b6f5d79$export$ea490c48f1c71643.MOVE_OR_INTERACT_TILE,\n                occupant: occupant\n            });\n            return;\n        } else if (movement) {\n            clickHandler(target, point, {\n                filter: $ac2e0e274b6f5d79$export$ea490c48f1c71643.MOVEMENT_TILE,\n                occupant: occupant\n            });\n            return;\n        } else if (interaction) {\n            clickHandler(target, point, {\n                filter: $ac2e0e274b6f5d79$export$ea490c48f1c71643.INTERACT_TILE,\n                occupant: occupant\n            });\n            return;\n        }\n        if (this.#reachableDoorTileGridPoints) {\n            for (const gp of this.#reachableDoorTileGridPoints)if (gp.isCoincident(gridPoint)) {\n                clickHandler(target, point, {\n                    filter: $ac2e0e274b6f5d79$export$ea490c48f1c71643.INTERACT_TILE\n                });\n                return;\n            }\n        }\n        const heroGridPoint = this.worldPointToGrid(this.#heroActor.position);\n        if (gridPoint.coincident(heroGridPoint)) {\n            clickHandler(target, point, {\n                occupant: this.#heroActor,\n                filter: $ac2e0e274b6f5d79$export$ea490c48f1c71643.OCCUPIED_TILE\n            });\n            return;\n        }\n        if (occupant) clickHandler(target, point, {\n            occupant: occupant,\n            filter: $ac2e0e274b6f5d79$export$ea490c48f1c71643.OCCUPIED_TILE\n        });\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Ignore click outside of highlighted area\");\n    }\n    /**\n   * Get waypoints to reach destination grid point\n   * @param {Point} worldPoint - destination\n   * @returns {Point[]} null if no route currently found.\n   */ getWaypointsToWorldPoint(worldPoint) {\n        const destination = this.worldPointToGrid(worldPoint);\n        return this.#movementRoutes?.getWaypointsAsWorldPoints(destination);\n    }\n    /**\n   * Get a random unoccupied ground tile.\n   * @returns {Tile} null if no free ground tile.\n   */ getRandomFreeGroundTile() {\n        (0, $d9c69096b805bafd$export$f3448602f079b6d0)(this.#randomGround);\n        for (const tile of this.#randomGround){\n            if (!tile.isOccupied()) return tile;\n        }\n        return null;\n    }\n    /**\n   * Test if point is passable.\n   * @param {Point} gridPoint - row and col coordinates.\n   * @param {module:players/actors.Actor} actor - actor trying to pass\n   * @returns {boolean}\n   */ isGridPointPassableByActor(gridPoint, actor) {\n        const tile = this.getTileAtGridPoint(gridPoint);\n        if (!tile) return false;\n        return tile.isPassableByActor(actor);\n    }\n    /**\n   * Test if tile can be occupied by the actor\n   * @param {Point} gridPoint - row and col coordinates.\n   * @param {module:players/actors.Actor} actor - actor trying to occupy location\n   * @returns {boolean}\n   */ canGridPointBeOccupiedByActor(gridPoint, actor) {\n        const tile = this.getTileAtGridPoint(gridPoint);\n        if (!tile) return false;\n        return tile.canBeOccupiedByActor(actor);\n    }\n    /**\n   * Is the grid point visible by the hero.\n   * @param {Point} gridPoint\n   * @returns {boolean}\n   */ canHeroSeeGridPoint(gridPoint) {\n        return this.#heroRayTracer?.isGridPointInRays(gridPoint) ?? true;\n    }\n    /**\n   * Test if point can be seen through.\n   * @param {Point} gridPoint - row and col coordinates.\n   * @param {module:players/actors.Actor} actor - actor trying to see\n   * @returns {boolean}\n   */ isSeeThrough(gridPoint, actor) {\n        const tile = this.getTileAtGridPoint(gridPoint);\n        if (!tile) return true;\n        return tile.isSeeThrough(actor);\n    }\n    /**\n   * Get the tiles surrounding a reference.\n   * @param {Point} gridPoint\n   * @returns {module:utils/arrays/arrayManip~Surrounds}\n   */ getSurroundingTiles(gridPoint) {\n        return (0, $d9c69096b805bafd$export$7c548b14ef6e7713)(this.#tiles, gridPoint.y, gridPoint.x);\n    }\n    /**\n   * Get tiles radiating up and down.\n   * @param {Point} gridPoint\n   * @param {number} [distance = 1] - in tiles.\n   * @returns {Tiles[]}\n   */ getRadiatingCross(gridPoint, distance = 1) {\n        return (0, $d9c69096b805bafd$export$3b231af6e692233f)(this.#tiles, {\n            rowIndex: gridPoint.y,\n            columnIndex: gridPoint.x,\n            distance: distance,\n            filter: (tile)=>tile.role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.GROUND\n        });\n    }\n    /**\n   * Get tiles radiating from a point.\n   * @param {Point} gridPoint\n   * @param {number} [distance = 1] - in tiles.\n   * @returns {Tiles[]}\n   */ getRadiating(gridPoint, distance = 1) {\n        return (0, $d9c69096b805bafd$export$e3a4b77e15204ac)(this.#tiles, {\n            rowIndex: gridPoint.y,\n            columnIndex: gridPoint.x,\n            distance: distance,\n            filter: (tile)=>tile.role === $ac2e0e274b6f5d79$export$b57fd20cbd2711c3.GROUND\n        });\n    }\n    /** Get radial visible tiles around the hero\n   * @param {number} rangeInTiles\n   * @returns {Tile[]}\n   */ getRadiatingVisibleTiles(rangeInTiles) {\n        const tiles = [];\n        const centrePoint = this.worldPointToGrid(this.#heroActor.position);\n        const minX = Math.max(0, centrePoint.x - rangeInTiles);\n        const minY = Math.max(0, centrePoint.y - rangeInTiles);\n        const maxX = centrePoint.x + rangeInTiles;\n        const maxY = centrePoint.y + rangeInTiles;\n        for(let x = minX; x <= maxX; x++)for(let y = minY; y <= maxY; y++){\n            const gridPoint = new (0, $9181799b149b64a5$export$baf26146a414f24a)(x, y);\n            if (!gridPoint.coincident(centrePoint)) {\n                const tile = this.getTileAtGridPoint(gridPoint);\n                if (this.canHeroSeeGridPoint(gridPoint) && tile.isSeeThrough()) tiles.push(tile);\n            }\n        }\n        return tiles;\n    }\n    /**\n   * Removed occupant from the list of occupants\n   * of the tile at the grid point.\n   * @param {Object} occupant\n   * @param {Point} gridPoint\n   */ deleteOccupancyOfGridPoint(occupant, gridPoint) {\n        this.getTileAtGridPoint(gridPoint)?.deleteOccupant(occupant);\n    }\n    /**\n   * Set the object's tile occupancy. It is removed from the list of occupants\n   * of the tile at the previous point and added to those of the next.\n   * @param {Object} occupant\n   * @param {Point} oldGridPoint\n   * @param {Point} newGridPoint\n   */ moveTileOccupancyGridPoint(occupant, oldGridPoint, newGridPoint) {\n        if (newGridPoint !== oldGridPoint) {\n            this.getTileAtGridPoint(oldGridPoint)?.deleteOccupant(occupant);\n            this.getTileAtGridPoint(newGridPoint)?.addOccupant(occupant);\n        }\n    }\n    /**\n   * Get coincident actors.\n   * @param {module:players/actors.Actor} actor\n   * @returns {Actor[]}\n   */ getCoincidentActors(actor) {\n        const tile = this.getTileAtWorldPoint(actor.position);\n        return tile.getOccupants();\n    }\n    /**\n   * Get all the participants around an actor. Diagonals are not included in\n   * potential participants.\n   * @param {module:players/actors.Actor} actor\n   * @returns {Actor[]}\n   */ getParticipants(actor) {\n        const participants = [];\n        const surrounds = this.getSurroundingTiles(this.worldPointToGrid(actor.position));\n        const tiles = [\n            surrounds.above,\n            surrounds.right,\n            surrounds.below,\n            surrounds.left\n        ];\n        tiles.forEach((tile)=>{\n            let tileOccupants = tile?.getOccupants();\n            tileOccupants?.forEach((occupant)=>{\n                participants.push(occupant);\n            });\n        });\n        return participants;\n    }\n}\n\n\n/**\n * @file Manage the game turns. The turnManager is a state machine and implemented\n * as a singleton.\n *\n * @module gameManagement/turnManager\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n\n\n\n\n/**\n * @file Timers\n *\n * @module utils/timers\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n *\n * @param {number} secs\n * @returns {Promise} fulfils to null\n */ function $47c057e9d418a795$export$229c72e5fdee233b(secs) {\n    return new Promise((resolve)=>{\n        setTimeout(()=>resolve(), secs * 1000);\n    });\n}\n\n\n\n\n\n/**\n * @file Main menu\n *\n * @module menus/mainMenu\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n/**\n * @file Settings dialog\n *\n * @module dialogs/settingsDialog\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n\n\n/**\n * @file Simple log dialog\n *\n * @module dialogs/logDialog\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\nfunction $690a7a648c0b26b2$export$4575fc5a7d5a5c4b() {\n    (0, $733fb161db426370$export$2e2bcd8739ae039).getMessages();\n    let text = \"\";\n    for (const msg of (0, $733fb161db426370$export$2e2bcd8739ae039).getMessages())text += msg + \"\\n\";\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog(text, {\n        title: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE DEBUG LOG`,\n        className: \"wall\"\n    });\n}\n\n\n/**\n * @file Fullscreen functions\n *\n * @module utils/fullscreen\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * Set fullscreen state\n * @param {boolean} fullscreen - true for fullscreen.\n */ function $805a550ae64cfa4a$export$6f18ed54727f6878(fullscreen) {\n    if (fullscreen) {\n        if (!document.fullscreenElement) document.body.requestFullscreen?.();\n    } else if (document.fullscreenElement) document.exitFullscreen?.();\n}\n\n\n/** Settings */ const $09b31fa5c65d5acd$var$SETTINGS = [\n    {\n        id: \"MUSIC_VOLUME\",\n        labelKey: \"CONTROL MUSIC VOLUME\",\n        defValue: 50,\n        controlType: (0, $58ea3f4a4bcc116e$export$82f9c7d14b0424b).RANGE,\n        persistent: true,\n        action: null,\n        onChange: (value)=>(0, $6f0e758381e3257c$export$2e2bcd8739ae039).setMusicVolumePercent(value)\n    },\n    {\n        id: \"EFFECTS_VOLUME\",\n        labelKey: \"CONTROL EFFECTS VOLUME\",\n        defValue: 50,\n        controlType: (0, $58ea3f4a4bcc116e$export$82f9c7d14b0424b).RANGE,\n        persistent: true,\n        action: null,\n        onChange: (value)=>{\n            (0, $6f0e758381e3257c$export$2e2bcd8739ae039).setEffectsVolumePercent(value);\n            (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"PUNCH\");\n        }\n    },\n    {\n        id: \"SHOW_QUICK_TIPS_AT_START\",\n        labelKey: \"CONTROL SHOW QUICK TIPS\",\n        defValue: true,\n        controlType: (0, $58ea3f4a4bcc116e$export$82f9c7d14b0424b).CHECKBOX,\n        persistent: true,\n        action: null,\n        onChange: null\n    },\n    {\n        id: \"START_IN_FULLSCREEN\",\n        labelKey: \"CONTROL RUN FULLSCREEN\",\n        defValue: false,\n        controlType: (0, $58ea3f4a4bcc116e$export$82f9c7d14b0424b).CHECKBOX,\n        persistent: true,\n        action: null,\n        onChange: null\n    },\n    {\n        id: \"DO_NOT_SCALE\",\n        labelKey: \"CONTROL DO NOT SCALE\",\n        defValue: false,\n        controlType: (0, $58ea3f4a4bcc116e$export$82f9c7d14b0424b).CHECKBOX,\n        persistent: true,\n        action: null,\n        onChange: ()=>(0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE REQUIRES RESTART`),\n        doNotInitialise: true\n    },\n    {\n        id: \"SHOW_DEBUG_LOG\",\n        labelKey: \"BUTTON SHOW DEBUG LOG\",\n        defValue: true,\n        controlType: (0, $58ea3f4a4bcc116e$export$82f9c7d14b0424b).TEXT_BUTTON,\n        persistent: false,\n        action: ()=>(0, $690a7a648c0b26b2$export$4575fc5a7d5a5c4b)(),\n        onChange: null\n    },\n    {\n        id: \"CLEAR_MEMORY\",\n        labelKey: \"BUTTON DELETE MEMORY\",\n        defValue: true,\n        controlType: (0, $58ea3f4a4bcc116e$export$82f9c7d14b0424b).TEXT_BUTTON,\n        persistent: false,\n        action: ()=>$09b31fa5c65d5acd$var$deleteMemory(),\n        onChange: null\n    }\n];\n/**\n * Delete memory. Confirmation is required.\n */ function $09b31fa5c65d5acd$var$deleteMemory() {\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showChoiceDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE DELETE MEMORY`, (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CONFIRM DELETE MEMORY`, [\n        (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON DELETE`,\n        (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CANCEL`\n    ]).then((choice)=>{\n        if (choice === 0) {\n            (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).clearAll();\n            return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE MEMORY DELETED`);\n        }\n    });\n}\nfunction $09b31fa5c65d5acd$export$7da80b63b5cb0fd0() {\n    const controls = [];\n    $09b31fa5c65d5acd$var$SETTINGS.forEach((setting)=>{\n        controls.push((0, $58ea3f4a4bcc116e$export$b42320c90cd2b176)(setting));\n    });\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE SETTINGS`, {\n        actionButtons: controls,\n        className: \"door\"\n    }).then(()=>(0, $805a550ae64cfa4a$export$6f18ed54727f6878)((0, $f0a94f3b2f305120$export$2e2bcd8739ae039).get(\"START_IN_FULLSCREEN\")));\n}\nfunction $09b31fa5c65d5acd$export$ef0c17c6967bb348() {\n    $09b31fa5c65d5acd$var$SETTINGS.forEach((setting)=>{\n        setting.label = (0, $e6f3aae57afc1cde$export$af7faffe10421f14).getText(setting.labelKey);\n        if (setting.persistent && setting.onChange && !setting.doNotInitialise) {\n            const value = (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).get(setting.id, setting.defValue);\n            setting.onChange(value);\n        }\n    });\n}\n\n\n\n/**\n * @file Dialog to show the hall of fame\n *\n * @module dialogs/hallOfFameDialog\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n/**\n * @file Saver for games\n *\n * @module gameManagement/gameSaver\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n/**\n * @file Actor and artefact builder\n *\n * @module dnd/almanacs/actorBuilder\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n\n\n\n\n\n/**\n * @file Standard animation keys.\n *\n * @module scriptReaders/actorAnimationKeys\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n/**\n * @typedef {Object} AnimationDefinition\n * @property {string} keyName - animation key name.\n * @property {string} suffix - appended to the image name for this animation\n * @property {Object} options - passed to AnimatedImage constructor\n */ /**\n * @typedef {Object<string, AnimationDefinition>} AnimationDefinitions\n */ /**\n * Standard animation definitions for an actor.\n * It is assumed that animation images are formed from a root name.\n * @type {AnimationDefinitions}\n */ const $52c63697474a5ea6$var$PeripateticAnimationDefns = {\n    DEAD: {\n        keyName: \"DEAD\",\n        suffix: \"dead\",\n        options: {\n            framePeriodMs: 100,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).STOP\n        }\n    },\n    IDLE: {\n        keyName: \"IDLE\",\n        suffix: \"idle\",\n        options: {\n            framePeriodMs: 300,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).REVERSE\n        }\n    },\n    WALK_NORTH: {\n        keyName: \"WALK_N\",\n        suffix: \"walk-n\",\n        options: {\n            framePeriodMs: 100,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).REVERSE\n        }\n    },\n    WALK_EAST: {\n        keyName: \"WALK_E\",\n        suffix: \"walk-e\",\n        options: {\n            framePeriodMs: 100,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).REVERSE\n        }\n    },\n    WALK_SOUTH: {\n        keyName: \"WALK_S\",\n        suffix: \"walk-s\",\n        options: {\n            framePeriodMs: 100,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).REVERSE\n        }\n    },\n    WALK_WEST: {\n        keyName: \"WALK_W\",\n        suffix: \"walk-w\",\n        options: {\n            framePeriodMs: 100,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).REVERSE\n        }\n    }\n};\n/**\n * Standard animation definitions for an actor holding an artefact.\n * It is assumed that animation images are formed from a root name\n */ const $52c63697474a5ea6$var$ArtefactHolderAnimationDefns = {\n    DEAD: {\n        keyName: \"DEAD\",\n        suffix: \"dead\",\n        options: {\n            framePeriodMs: 100,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).STOP\n        }\n    },\n    IDLE: {\n        keyName: \"IDLE\",\n        suffix: \"idle\",\n        options: {\n            framePeriodMs: 300,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).REVERSE\n        }\n    }\n};\n/**\n *\n */ class $52c63697474a5ea6$var$AnimationKeys {\n    /** @type {AnimationDefinitions} */ #definitions;\n    /**\n   * @param {AnimationDefinitions[]} definitions\n   */ constructor(definitions){\n        this.#definitions = definitions;\n    }\n    /**\n   * Form the frame name for an image\n   * @param {string} key - the key name for the animation.\n   * @param {string} imageName\n   */ #formFrameNameRoot(key, imageName) {\n        const suffix = this.#definitions[key]?.suffix;\n        if (!suffix) throw new Error(`Attempt made to use invalid standard animation key of '${key}'`);\n        return `${imageName}-${suffix}`;\n    }\n    /**\n   * Get the key name.\n   * @param {string} key\n   * @return {string}\n   */ getKeyName(key) {\n        return this.#definitions[key].keyName;\n    }\n    /**\n   * Get default image name. This is the first frame of IDLE.\n   * @returns {string} root\n   */ getDefaultImageName(root) {\n        return `${this.#formFrameNameRoot(\"IDLE\", root)}00.png`;\n    }\n    /**\n   * Get the fallback key\n   * @returns {string}\n   */ getFallbackKey() {\n        return this.getKeyName(\"IDLE\");\n    }\n    /**\n   * Add all animations to the keyed animation.\n   * @param {KeyedAnimatedImages} keyedAnimations\n   * @param {string} imageName - root name for the animation image.\n   */ addAllToKeyedAnimation(keyedAnimations, imageName) {\n        for(const key in this.#definitions){\n            const anim = this.#definitions[key];\n            keyedAnimations.addAnimatedImage(this.#definitions[key].keyName, new (0, $305a56b3d2c1570b$export$9d5734c725768403)({\n                prefix: this.#formFrameNameRoot(key, imageName),\n                suffix: \".png\",\n                startIndex: 0,\n                padding: 2\n            }, anim.options));\n        }\n        keyedAnimations.setCurrentKey(this.#definitions.IDLE.keyName);\n    }\n}\n/** Object to access standard animations. */ const $52c63697474a5ea6$var$StdAnimations = {\n    peripatetic: new $52c63697474a5ea6$var$AnimationKeys($52c63697474a5ea6$var$PeripateticAnimationDefns),\n    artefact: new $52c63697474a5ea6$var$AnimationKeys($52c63697474a5ea6$var$ArtefactHolderAnimationDefns)\n};\nvar $52c63697474a5ea6$export$2e2bcd8739ae039 = $52c63697474a5ea6$var$StdAnimations;\n\n\n\n\n\n\n\n\n\n/**\n * @file Name generator\n *\n * @module utils/nameGenerator\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n// cspell:disable\nconst $d6ec5a9c4a77bbf5$var$VOWEL_SOUNDS = [\n    \"a\",\n    \"e\",\n    \"i\",\n    \"o\",\n    \"u\",\n    \"ee\",\n    \"oo\"\n];\nconst $d6ec5a9c4a77bbf5$var$START_SOUNDS = [\n    \"b\",\n    \"br\",\n    \"ch\",\n    \"chr\",\n    \"cl\",\n    \"cr\",\n    \"d\",\n    \"dr\",\n    \"fl\",\n    \"fr\",\n    \"g\",\n    \"gl\",\n    \"gr\",\n    \"h\",\n    \"j\",\n    \"k\",\n    \"kr\",\n    \"kl\",\n    \"l\",\n    \"m\",\n    \"n\",\n    \"p\",\n    \"pl\",\n    \"pr\",\n    \"qu\",\n    \"r\",\n    \"s\",\n    \"sch\",\n    \"sh\",\n    \"st\",\n    \"t\",\n    \"th\",\n    \"tr\",\n    \"v\",\n    \"w\",\n    \"y\",\n    \"z\"\n];\nconst $d6ec5a9c4a77bbf5$var$END_SOUNDS = [\n    \"b\",\n    \"bbey\",\n    \"bble\",\n    \"bboy\",\n    \"bby\",\n    \"c\",\n    \"ch\",\n    \"ck\",\n    \"cky\",\n    \"ct\",\n    \"d\",\n    \"f\",\n    \"ff\",\n    \"ffle\",\n    \"ffy\",\n    \"ffey\",\n    \"g\",\n    \"ge\",\n    \"gey\",\n    \"gle\",\n    \"k\",\n    \"l\",\n    \"ll\",\n    \"lly\",\n    \"lley\",\n    \"m\",\n    \"n\",\n    \"ngle\",\n    \"nny\",\n    \"p\",\n    \"r\",\n    \"s\",\n    \"sk\",\n    \"ss\",\n    \"ssy\",\n    \"st\",\n    \"sty\",\n    \"t\",\n    \"th\",\n    \"thy\",\n    \"v\",\n    \"w\",\n    \"y\",\n    \"z\",\n    \"zzle\",\n    \"zzy\"\n];\nfunction $d6ec5a9c4a77bbf5$export$899caa88e79f0830() {\n    let name;\n    if (Math.random() < 0.5) name = $95fc563048a48bb6$export$a885de3766ef0b4c($d6ec5a9c4a77bbf5$var$START_SOUNDS) + $95fc563048a48bb6$export$a885de3766ef0b4c($d6ec5a9c4a77bbf5$var$VOWEL_SOUNDS) + $95fc563048a48bb6$export$a885de3766ef0b4c($d6ec5a9c4a77bbf5$var$END_SOUNDS);\n    else name = $95fc563048a48bb6$export$a885de3766ef0b4c($d6ec5a9c4a77bbf5$var$START_SOUNDS) + $95fc563048a48bb6$export$a885de3766ef0b4c($d6ec5a9c4a77bbf5$var$VOWEL_SOUNDS) + $95fc563048a48bb6$export$a885de3766ef0b4c($d6ec5a9c4a77bbf5$var$START_SOUNDS) + $95fc563048a48bb6$export$a885de3766ef0b4c($d6ec5a9c4a77bbf5$var$VOWEL_SOUNDS) + $95fc563048a48bb6$export$a885de3766ef0b4c($d6ec5a9c4a77bbf5$var$END_SOUNDS);\n    return name.charAt(0).toUpperCase() + name.substring(1);\n}\nfunction $d6ec5a9c4a77bbf5$export$7bca63501c2c13de() {\n    return `${$d6ec5a9c4a77bbf5$export$899caa88e79f0830()} ${$d6ec5a9c4a77bbf5$export$899caa88e79f0830()}`;\n}\n\n\n\n\n/**\n * Specialist traits renderer\n */ class $d8cd23d1a2971b65$var$TraitsRenderer extends $aa0468ffbc97dbfc$export$f1bb2dcf27836475 {\n    /** @type {module:players/actors.Actor} */ actor;\n    /**\n   * The number of gauges is determined by the maximum length of the fill styles and\n   * stroke styles\n   * @param {CanvasRenderingContext2D} context\n   * @param {Object} options\n   * @param {number} options.tileSize\n   * @param {string[]} options.fillStyles\n   * @param {string[]} options.strokeStyles\n   */ constructor(context, options){\n        super(context, options);\n    }\n    /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */ render(position) {\n        if (this.actor && this.actor.traits) {\n            const hp = this.actor.traits.getInt(\"HP\", 0);\n            const hpMax = this.actor.traits.getInt(\"HP_MAX\", 1);\n            this.setLevel(0, hp / hpMax);\n        }\n        super.render(position);\n    }\n}\n/**\n * Animation that automatically adjusts the animation based on the actor's velocity\n * and alive property.\n */ class $d8cd23d1a2971b65$var$ActorStateAnimator extends $305a56b3d2c1570b$export$7ded0ab8d4b1a54f {\n    /** @type {module:players/actors.Actor} */ #actor;\n    /** Number from eight point compass. */ #compassDir;\n    /** @type{boolean}*/ #aliveStatus;\n    /** @type {animation.AnimatedImage} */ #fallbackImage;\n    /** @type {number} */ #rotation;\n    /**\n   * Create the empty keyed animated image\n   * @param {string} [key]\n   * @param {AnimatedImage} [animatedImage]\n   */ constructor(key, animatedImage){\n        super(key, animatedImage);\n        this.#compassDir = $95fc563048a48bb6$export$624e7ee3f0468367.NONE;\n        this.#fallbackImage = animatedImage;\n        this.#rotation = 0;\n    }\n    /**\n   * Set the actor who's velocity will be monitored.\n   * @param {module:players/actors.Actor} actor\n   */ setActor(actor) {\n        this.#actor = actor;\n        this.#aliveStatus = this.#actor.alive;\n    }\n    /**\n   * Set fallback key\n   * @param {string} key\n   */ setFallbackKey(key) {\n        this.#fallbackImage = this.getAnimatedImage(key);\n        if (!this.#fallbackImage?.getCurrentFrame()) (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Fallback key ${key} has no image.`);\n    }\n    /** override */ getCurrentFrame() {\n        const dir = this.#getCurrentDirection();\n        if (dir !== this.#compassDir || this.#aliveStatus != this.#actor?.alive) {\n            this.#compassDir = dir;\n            this.#aliveStatus = this.#actor?.alive;\n            this.#setAnimationForState();\n        }\n        const frame = super.getCurrentFrame() ?? this.#fallbackImage?.getCurrentFrame() ?? {\n            bitmap: (0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getUndefinedBitmap(),\n            rotation: 0,\n            flip: $305a56b3d2c1570b$export$22f21f38505e8954.NONE\n        };\n        frame.rotation = this.#rotation;\n        return frame;\n    }\n    #getCurrentDirection() {\n        if (!this.#actor || this.#actor.velocity.isZero(0.1)) return $95fc563048a48bb6$export$624e7ee3f0468367.NONE;\n        else {\n            const dir = this.#actor.velocity.getScreenDirection();\n            return $95fc563048a48bb6$export$cf2deb104c051cb7(dir);\n        }\n    }\n    /**\n   * Set the appropriate animation based on the the current compass direction.\n   * Only four points supported.\n   */ #setAnimationForState() {\n        if (!this.#actor.alive) return this.setCurrentKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getKeyName(\"DEAD\"));\n        else if (this.#compassDir === $95fc563048a48bb6$export$624e7ee3f0468367.NONE) return this.setCurrentKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getKeyName(\"IDLE\"));\n        return this.#setAnimationForStateByFrame();\n    }\n    /**\n   * Set the appropriate animation based on the the current compass direction.\n   * Only four points supported.\n   */ #setAnimationForStateByFrame() {\n        const reverse = this.#actor.disengaging;\n        switch(this.#compassDir){\n            case $95fc563048a48bb6$export$624e7ee3f0468367.NONE:\n                this.setCurrentKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getKeyName(\"IDLE\"));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.E:\n                this.setCurrentKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getKeyName(reverse ? \"WALK_WEST\" : \"WALK_EAST\"));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.N:\n            case $95fc563048a48bb6$export$624e7ee3f0468367.NW:\n            case $95fc563048a48bb6$export$624e7ee3f0468367.NE:\n                this.setCurrentKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getKeyName(reverse ? \"WALK_SOUTH\" : \"WALK_NORTH\"));\n                break;\n            case $95fc563048a48bb6$export$624e7ee3f0468367.W:\n                this.setCurrentKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getKeyName(reverse ? \"WALK_EAST\" : \"WALK_WEST\"));\n                break;\n            default:\n                this.setCurrentKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getKeyName(reverse ? \"WALK_NORTH\" : \"WALK_SOUTH\"));\n                break;\n        }\n    }\n}\n/**\n * Create set of standard animations.\n * @param {string} imageName - root name for images.\n * @returns {animation.KeyedAnimatedImages}\n */ function $d8cd23d1a2971b65$var$createStandardKeyFrames(imageName) {\n    const keyedAnimations = new $d8cd23d1a2971b65$var$ActorStateAnimator();\n    (0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.addAllToKeyedAnimation(keyedAnimations, imageName);\n    keyedAnimations.setFallbackKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getFallbackKey());\n    return keyedAnimations;\n}\n/**\n * Create set of standard artefact animations.\n * @returns {animation.KeyedAnimatedImages}\n */ function $d8cd23d1a2971b65$var$createArtefactHolderKeyFrames(imageName) {\n    const keyedAnimations = new $d8cd23d1a2971b65$var$ActorStateAnimator();\n    (0, $52c63697474a5ea6$export$2e2bcd8739ae039).artefact.addAllToKeyedAnimation(keyedAnimations, imageName);\n    keyedAnimations.setFallbackKey((0, $52c63697474a5ea6$export$2e2bcd8739ae039).artefact.getFallbackKey());\n    return keyedAnimations;\n}\n/**\n * Create the actor.\n * @param {string} imageName - no extension\n * @param {string} iconImageName - alternative image used for dialogs. Falls back to imageName. png extension automatically added.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */ function $d8cd23d1a2971b65$var$createActor(imageName, iconImageName, traits, almanacEntry) {\n    const keyedAnimation = $d8cd23d1a2971b65$var$createStandardKeyFrames(imageName);\n    const imageRenderer = new $aa0468ffbc97dbfc$export$c1626e6e036a584((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), keyedAnimation);\n    let renderers;\n    let traitsRenderer;\n    if (almanacEntry.typeId !== \"PORTAL\" && traits.get(\"MOVE\") !== (0, $ce45fe1849aeb7ad$export$be204faa7b4ee90a).ORGANIC) {\n        traitsRenderer = new $d8cd23d1a2971b65$var$TraitsRenderer((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), {\n            tileSize: (0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE - 2,\n            fillStyles: [\n                (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).HP_GAUGE\n            ],\n            strokeStyles: []\n        });\n        renderers = [\n            traitsRenderer,\n            imageRenderer\n        ];\n    } else renderers = [\n        imageRenderer\n    ];\n    const actor = new (0, $ce45fe1849aeb7ad$export$f73d3eb6fd876d80)(new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n        renderer: renderers\n    }), almanacEntry.type);\n    keyedAnimation.setActor(actor);\n    if (traitsRenderer) traitsRenderer.actor = actor;\n    actor.position = new (0, $9181799b149b64a5$export$13807d9ee5a34a42)((0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE, (0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE, 0);\n    actor.almanacEntry = almanacEntry;\n    actor.traits = traits;\n    actor.velocity = {\n        x: 0,\n        y: 0,\n        rotation: 0\n    };\n    actor.iconImageName = iconImageName ? `${iconImageName}.png` : (0, $52c63697474a5ea6$export$2e2bcd8739ae039).peripatetic.getDefaultImageName(imageName);\n    const planView = /\\w+_pv/.test(imageName);\n    if (planView) actor.sprite.replaceBaseModifier((0, $8e5c8f9d0e1a3528$export$9a9871e8ef5d3528).createUprightAligner());\n    else if (almanacEntry.typeId === \"PORTAL\") actor.sprite.replaceBaseModifier(new (0, $8e5c8f9d0e1a3528$export$9600794ac1f85e81)());\n    return actor;\n}\n/**\n * Create the artefact holder.\n * @param {string} imageName - no extension\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */ function $d8cd23d1a2971b65$var$createArtefactHolder(imageName, traits, almanacEntry) {\n    const keyedAnimation = $d8cd23d1a2971b65$var$createArtefactHolderKeyFrames(imageName);\n    const imageRenderer = new $aa0468ffbc97dbfc$export$c1626e6e036a584((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), keyedAnimation);\n    const actor = new (0, $ce45fe1849aeb7ad$export$f73d3eb6fd876d80)(new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n        renderer: [\n            imageRenderer\n        ]\n    }), almanacEntry.type === \"SPELL\" ? (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).PROP : (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).HIDDEN_ARTEFACT);\n    keyedAnimation.setActor(actor);\n    actor.position = new (0, $9181799b149b64a5$export$13807d9ee5a34a42)((0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE, (0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE, 0);\n    actor.velocity = {\n        x: 0,\n        y: 0,\n        rotation: 0\n    };\n    actor.interaction = new (0, $018d326b648bc43d$export$13d2779752f0bd8f)(actor);\n    actor.iconImageName = `${imageName}.png`;\n    actor.traits = traits ?? new (0, $b7c201230645b878$export$939a756f171fd090)();\n    return actor;\n}\n/**\n * Create animated enemy\n * @param {string} imageName - without extension\n * @param {string} iconImageName - without extension. Name of icon for dialogs.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */ function $d8cd23d1a2971b65$var$createEnemy(imageName, iconImageName, traits, almanacEntry) {\n    const actor = $d8cd23d1a2971b65$var$createActor(imageName, iconImageName, traits, almanacEntry);\n    if (actor.isOrganic()) {\n        actor.interaction = new (0, $018d326b648bc43d$export$bbfcae392104b4c9)(actor);\n        actor.obstacle = false;\n    } else actor.interaction = new (0, $018d326b648bc43d$export$56070c78bbcda189)(actor);\n    return actor;\n}\n/**\n * Create animated prop\n * @param {string} imageName - without extension\n * @param {string} iconImageName - without extension. Name of icon for dialogs.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */ function $d8cd23d1a2971b65$var$createProp(imageName, iconImageName, traits, almanacEntry) {\n    const actor = $d8cd23d1a2971b65$var$createActor(imageName, iconImageName, traits, almanacEntry);\n    actor.interaction = new (0, $018d326b648bc43d$export$13d2779752f0bd8f)(actor);\n    return actor;\n}\n/**\n * Create animated trader\n * @param {string} imageName - without extension\n * @param {string} iconImageName - alternative image used for dialogs. Falls back to imageName. png extension automatically added.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */ function $d8cd23d1a2971b65$var$createTrader(imageName, iconImageName, traits, actorType) {\n    const actor = $d8cd23d1a2971b65$var$createActor(imageName, iconImageName, traits, actorType);\n    actor.interaction = new (0, $018d326b648bc43d$export$366210f9de782ba6)(actor);\n    return actor;\n}\n/**\n * Create portal\n * @param {string} imageName - without extension\n * @param {string} iconImageName - alternative image used for dialogs. Falls back to imageName. png extension automatically added.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */ function $d8cd23d1a2971b65$var$createPortal(imageName, iconImageName, traits, actorType) {\n    const actor = $d8cd23d1a2971b65$var$createActor(imageName, iconImageName, traits, actorType);\n    actor.interaction = new (0, $018d326b648bc43d$export$7b0f49f9ef95a7b0)(actor);\n    return actor;\n}\n/**\n * Equip the actor. Note only MONEY, WEAPONS and ARMOUR are equipped. Anything else\n * is ignored.\n * @param {module:players/actors.Actor} actor\n * @param {string[]} equipmentIds - ids of artefacts in the artefacts almanac.\n */ function $d8cd23d1a2971b65$var$equipActor(actor, equipmentIds) {\n    if (!equipmentIds || equipmentIds.length === 0) return;\n    for (const id of equipmentIds){\n        const artefactEntry = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).findById(id, [\n            \"MONEY\",\n            \"WEAPONS\",\n            \"ARMOUR\",\n            \"MAGIC\",\n            \"ARTEFACTS\"\n        ]);\n        if (artefactEntry) {\n            const artefact = (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(artefactEntry);\n            if (artefact.equipStoreType) actor.storeManager.equip(artefact, {\n                direct: true\n            });\n            else actor.storeManager.stash(artefact, {\n                direct: true\n            });\n        } else (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Cannot find ${id} artefact in almanac to equip actor.`);\n    }\n}\nfunction $d8cd23d1a2971b65$export$260a0189ba712b47(almanacEntry, initialTraits) {\n    const traits = initialTraits ?? new (0, $b7c201230645b878$export$939a756f171fd090)(almanacEntry.traitsString);\n    if (!traits.get(\"NAME\")) traits.set(\"NAME\", almanacEntry.name);\n    let actor;\n    switch(almanacEntry.type){\n        case (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).HERO:\n            actor = $d8cd23d1a2971b65$var$createActor(almanacEntry.imageName, null, traits, almanacEntry);\n            actor.type = (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).HERO;\n            if (!initialTraits) {\n                traits.set(\"NAME\", (0, $d6ec5a9c4a77bbf5$export$7bca63501c2c13de)());\n                $a7679a1c33accf76$export$a8635b55c366bbfd(traits);\n            }\n            actor.toxify = new (0, $018d326b648bc43d$export$a008c8b96400e731)();\n            break;\n        case (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).PORTAL:\n            actor = $d8cd23d1a2971b65$var$createPortal(almanacEntry.imageName, null, traits, almanacEntry);\n            break;\n        case (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).TRADER:\n            actor = $d8cd23d1a2971b65$var$createTrader(almanacEntry.imageName, null, traits, almanacEntry);\n            break;\n        case (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).HIDDEN_ARTEFACT:\n            actor = $d8cd23d1a2971b65$var$createArtefactHolder(almanacEntry.imageName, null, traits, almanacEntry);\n            break;\n        case (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).PROP:\n            actor = $d8cd23d1a2971b65$var$createProp(almanacEntry.imageName, null, traits, almanacEntry);\n            break;\n        default:\n            actor = $d8cd23d1a2971b65$var$createEnemy(almanacEntry.imageName, null, traits, almanacEntry);\n            break;\n    }\n    actor.description = almanacEntry.description;\n    if (!initialTraits && almanacEntry.equipmentIds) $d8cd23d1a2971b65$var$equipActor(actor, almanacEntry.equipmentIds);\n    return actor;\n}\n\n\n\n\n\n\n/**\n * @file Long term effect of toxins; this is broad and can be used for poisons\n * or diseases\n *\n * @module dnd/toxins\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ class $209cccf9e7a37d77$export$c420872fac89c2a3 {\n    /** @type {number} */ #pendingHpChange;\n    /** @type {number} */ #hpPerTurn;\n    /**\n   * Construct toxin\n   * @param {number} [hpPerTurn = 0] - HP change per turn. Can be fractional\n   * @param {number} [pendingHpChange = 0] - initial amount already pending\n   */ constructor(hpPerTurn = 0, pendingHpChange = 0){\n        this.#hpPerTurn = hpPerTurn;\n        this.#pendingHpChange = pendingHpChange;\n    }\n    /**\n   * Apply toxin effect. This should be called once per turn.\n   * @returns {number} change in HP for this turn. This is an integer so\n   * there may not be a change on every call.\n   */ getChangeInHpThisTurn() {\n        const deltaHp = this.#hpPerTurn + this.#pendingHpChange;\n        const reportedChange = Math.floor(deltaHp);\n        this.#pendingHpChange = deltaHp - reportedChange;\n        return reportedChange;\n    }\n    /**\n   * Apply another toxin\n   * @param {number} hpPerTurn - HP per change. Can be fractional.\n   */ addToxicEffect(hpPerTurn) {\n        this.#hpPerTurn += hpPerTurn;\n    }\n    /**\n   * Clear effects.\n   */ cure() {\n        this.#hpPerTurn = 0;\n        this.#pendingHpChange = 0;\n    }\n    /**\n   * Test if this is active.\n   * @returns {boolean}\n   */ get isActive() {\n        return this.#hpPerTurn !== 0 || this.#pendingHpChange !== 0;\n    }\n    /**\n   * Convert to JSON.\n   * Note this only stores the actor. It does not store\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */ toJSON() {\n        return {\n            reviver: \"Toxin\",\n            data: {\n                pendingHpChange: this.#pendingHpChange,\n                hpPerTurn: this.#hpPerTurn\n            }\n        };\n    }\n    /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   * @returns {Toxin}\n   */ static revive(data) {\n        return new $209cccf9e7a37d77$export$c420872fac89c2a3(data.hpPerTurn, data.pendingHpChange);\n    }\n}\n\n\n/**\n * @file Floor numbering utils\n *\n * @module dnd/floorNumbering\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * Convert a scene number to a floor.\n * Scene levels go 0, 1, 2 ... etc.\n * Floors adopt US numbering and go 1, B1, B2, B3 ... etc. for basement.\n * @param {number} scene\n * @returns {string}\n */ function $125f5f2e3c48ca5e$export$cc5edb2b1b75cf3d(scene) {\n    return scene === 0 ? \"1\" : `B${scene}`;\n}\n\n\n/**\n * @file Simple management of a leaderboard\n *\n * @module utils/leaderBoard\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ class $eec528ab74dc2bea$export$e439bffd17c92e84 {\n    /** @type {number} */ #maxLength;\n    /** @type {Array.<*>} */ #values;\n    /** @type {function(a:Object, b:Object):number} */ #sortFn;\n    /** @type {function(a:Object, b:Object):boolean} */ #equalFn;\n    /**\n   * Create a leaderboard. If no initialValues or maxLength are\n   * provided, the max length is set to 1.\n   * @param {number|Array.<*>} initialValues\n   * @param {Object} options\n   * @param {number} [options.maxLength = 10]\n   * @param {function(a:Object, b:Object):number} sortFn - function used for sorting. Returns -1 if a comes\n   * before b, 0 if they are the same position, and 1 if b comes after a.\n   * @param {function(a:Object, b:Object):boolean} equalFn - function used for testing if objects are the same..\n   *\n   */ constructor(initialValues, options = {}){\n        this.#values = initialValues ?? [];\n        this.#maxLength = options?.maxLength ?? 10;\n        this.#sortFn = options.sortFn;\n        this.#equalFn = options.equalFn ?? ((a, b)=>a == b);\n    }\n    /** Add item to leader board.\n   * @param {Object} item - item to add.\n   * @returns {number} position on board. 0 is top, -1 is unplaced.\n   */ add(item) {\n        const existingIndex = this.indexOfEqual(item);\n        if (existingIndex >= 0) {\n            const existingValue = this.#values[existingIndex];\n            if (this.#sortFn(item, existingValue) < 0) this.#values[existingIndex] = item;\n            else return existingIndex; // This object already exists and the new version is not better.\n        } else this.#values.push(item); // it's a new item.\n        this.#values.sort(this.#sortFn);\n        if (this.#values.length > this.#maxLength) this.#values.pop();\n        return this.#values.indexOf(item);\n    }\n    /**\n   * Find object. Uses the this.#equalFn.\n   * @param {Object} value\n   * @returns {number} the index of the found object. -1 if not found.\n   */ indexOfEqual(value) {\n        for(let index = 0; index < this.#values.length; index++){\n            if (this.#equalFn(value, this.#values[index])) return index;\n        }\n        return -1;\n    }\n    /**\n   * Get the current leaderboard.\n   * @returns {Array.<*>} copy of leaderboard\n   */ getCurrentData() {\n        return [\n            ...this.#values\n        ];\n    }\n    /**\n   * Get the max length\n   * @returns {number}\n   */ getMaxLength() {\n        return this.#maxLength;\n    }\n}\n\n\n/** @type {number} */ const $ece912613ca227a3$var$DEFAULT_LEADERBOARD_LEN = 10;\n/** @type {string} */ const $ece912613ca227a3$var$LEADERBOARD_DATA_KEY = \"LEADERBOARD_DATA\";\n/** @typedef {Object} AdventureResult\n * @property {number} adventureStartTime\n * @property {string} name\n * @property {number} gold\n * @property {number} goldSent\n * @property {number} exp\n * @property {number} characterLevel\n * @property {number} dungeonFloor\n */ /**\n * Create an adventure result\n * @param {module:players/actors.Actor} hero\n * @param {boolean} completed\n * @returns {AdventureResult}\n */ function $ece912613ca227a3$var$createAdventureResult(hero, completed) {\n    const result = {\n        adventureStartTime: 0,\n        name: \"unknown\",\n        class: \"unknown\",\n        gold: 0,\n        goldSent: 0,\n        exp: 0,\n        characterLevel: 0,\n        dungeonFloor: 0,\n        completed: false\n    };\n    if (hero) {\n        result.adventureStartTime = hero.adventureStartTime;\n        result.name = hero.traits.get(\"NAME\");\n        result.class = hero.traits.get(\"CLASS\");\n        result.gold = hero.storeManager.getPurseValue();\n        result.goldSent = hero.traits.getInt(\"GOLD_SENT\", 0);\n        result.exp = hero.traits.getInt(\"EXP\", 0);\n        result.characterLevel = hero.traits.getCharacterLevel();\n        result.dungeonFloor = (0, $125f5f2e3c48ca5e$export$cc5edb2b1b75cf3d)((0, $cd2e32752119e7f3$export$2e2bcd8739ae039).getCurrentSceneLevel());\n        result.completed = completed;\n    }\n    return result;\n}\nfunction $ece912613ca227a3$export$a432f328c781673f() {\n    const data = (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).get($ece912613ca227a3$var$LEADERBOARD_DATA_KEY);\n    return new (0, $eec528ab74dc2bea$export$e439bffd17c92e84)(data, {\n        maxLength: $ece912613ca227a3$var$DEFAULT_LEADERBOARD_LEN,\n        sortFn: (a, b)=>a.goldSent > b.goldSent ? -1 : 1,\n        equalFn: (a, b)=>a.adventureStartTime === b.adventureStartTime && a.name === b.name\n    });\n}\n/**\n * Get the best stored adventure result.\n * @param {AdventureResult} adventureResult\n * @returns {number} index of the new entry 0 is first. -1 is unplaced.\n */ function $ece912613ca227a3$var$saveToLeaderboard(adventureResult) {\n    const leaderboard = $ece912613ca227a3$export$a432f328c781673f();\n    const index = leaderboard.add(adventureResult);\n    if (index >= 0) (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).set($ece912613ca227a3$var$LEADERBOARD_DATA_KEY, leaderboard.getCurrentData());\n    return index;\n}\nfunction $ece912613ca227a3$export$384cd953322e3851(hero, completed = false) {\n    const adventureResult = $ece912613ca227a3$var$createAdventureResult(hero, completed);\n    const leaderboardIndex = $ece912613ca227a3$var$saveToLeaderboard(adventureResult);\n    const gameState = {\n        sceneLevel: (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).getCurrentSceneLevel(),\n        hero: hero,\n        completed: completed\n    };\n    (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).set(\"GAME_STATE\", gameState);\n    return leaderboardIndex;\n}\nfunction $ece912613ca227a3$export$e5b7197cc57951e6() {\n    const gameState = (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).get(\"GAME_STATE\", null, $ece912613ca227a3$var$revive);\n    if (!gameState) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"No saved game state to restore.\");\n        return;\n    }\n    if (!gameState.hero.alive) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Last hero state was dead, so not restoring.\");\n        return;\n    }\n    if (gameState.completed) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Last game was completed, so not restoring.\");\n        return;\n    }\n    return {\n        hero: gameState.hero,\n        sceneLevel: gameState.sceneLevel\n    };\n}\n/**\n * Reviver function called by JSON.parse\n * @param {string} keyUnused\n * @param {*} value\n */ function $ece912613ca227a3$var$revive(keyUnused, value) {\n    switch(value?.reviver){\n        case \"Actor\":\n            return (0, $ce45fe1849aeb7ad$export$f73d3eb6fd876d80).revive(value.data, (0, $d8cd23d1a2971b65$export$260a0189ba712b47));\n        case \"Toxin\":\n            return (0, $209cccf9e7a37d77$export$c420872fac89c2a3).revive(value.data);\n        case \"Artefact\":\n            return (0, $547c634f23f1bc62$export$5612627710242fc2).revive(value.data, (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb));\n        case \"Traits\":\n            return (0, $b7c201230645b878$export$f0f803f528a8d270).revive(value.data);\n        case \"CharacterTraits\":\n            return (0, $b7c201230645b878$export$939a756f171fd090).revive(value.data);\n        case \"MagicTraits\":\n            return (0, $b7c201230645b878$export$57c6a82d5c690092).revive(value.data);\n        default:\n            return value;\n    }\n}\n\n\n/**\n *\n * @param {module:gameManagement/gameSaver~AdventureResult} adventure\n * @returns {string}\n */ function $2f0424278e098787$var$formHallOfFameEntry(adventure) {\n    let startDate = new Date(adventure.adventureStartTime).toISOString().split(\"T\")[0];\n    const chrClass = adventure.class?.toLowerCase() ?? \"\";\n    return (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE HALL OF FAME ENTRY ${adventure.name} ${adventure.characterLevel} ${chrClass} ${startDate} ${adventure.goldSent} ${adventure.dungeonFloor}`;\n}\nfunction $2f0424278e098787$export$c17614412cc5a163() {\n    const container = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"best-adventure\"\n    });\n    const leaderboardData = (0, $ece912613ca227a3$export$a432f328c781673f)().getCurrentData();\n    if (leaderboardData.length === 0) container.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE NO SAVED ADVENTURE`\n    }));\n    else {\n        const list = document.createElement(\"ul\");\n        container.appendChild(list);\n        for (const adventure of leaderboardData)list.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"li\", {\n            text: $2f0424278e098787$var$formHallOfFameEntry(adventure)\n        }));\n    }\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showElementOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE HALL OF FAME`, container);\n}\n\n\n/**\n * @file Dialogs showing guides which are in Markdown.\n *\n * @module dialogs/guideDialogs\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Light markdown parser\n *\n * @module utils/text/markdown/markdown\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Simple protection from future parsing.\n *\n * @module utils/text/markdown/parsingWarden\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Base64 routines\n *\n * @module utils/text/markdown/base64\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * @file Safe version of encode functions.\n *\n * @module utils/text/safeEncoder\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * Encode the uri. This just calls encodeURIComponent. If it fails, the string\n * will be converted using `toWellFormed()` to remove any lone surrogates.\n * The function `toWellFormed` is not called by default as it is expensive and\n * lone surrogates are unlikely to be encountered.\n * @param {string} uri\n * @returns {string}\n * @throws {URIError}\n */ function $f3bebfd9526ac2fc$export$493c6e092b6b7343(uri) {\n    try {\n        return encodeURIComponent(uri);\n    } catch (error) {\n        console.error(error);\n        return encodeURIComponent(uri.toWellFormed());\n    }\n}\n\n\nfunction $6ed93f37c039b89b$export$17093f29c5387c55(str) {\n    return window.btoa((0, $f3bebfd9526ac2fc$export$493c6e092b6b7343)(str));\n}\nfunction $6ed93f37c039b89b$export$f729b1c6dd29c383(base64) {\n    return decodeURIComponent(window.atob(base64));\n}\n\n\nclass $2815bbe36e5ce5cf$export$194ecf1460f71071 {\n    #wards = new Map();\n    constructor(){}\n    /** Clear all the entries */ clear() {\n        this.#wards.clear();\n    }\n    /**\n   * Create a key code from the data.\n   * @param {string} data\n   * @returns {string} a unique key.\n   */ #createKeyCode(data) {\n        return (0, $6ed93f37c039b89b$export$17093f29c5387c55)(data).replace(/=/g, \":\"); // == is markdown\n    }\n    /**\n   *\n   * @param {string} data - the data to guard\n   * @returns {string} the key. This can be used as the protected data. If data\n   * is empty, it is returned untouched.\n   */ protect(data) {\n        if (!data) return data; // nothing to protect\n        const key = `???${this.#wards.size}${this.#createKeyCode(data)}???`;\n        this.#wards.set(key, data);\n        return key;\n    }\n    /**\n   * Get the originally protected string. The protected value is removed.\n   * @returns {string} the originally protected value. If not found, the key is returned.\n   */ retrieve(key) {\n        const value = this.#wards.get(key);\n        this.#wards.delete(key);\n        if (!value) {\n            console.error(`Could not find ${key} in protected data.`);\n            return key;\n        } else return value;\n    }\n    /**\n   * Search for keys in the data and reinstate. Any retrieved values are removed.\n   * @param {string} data\n   * @returns {string}\n   */ reinstate(data) {\n        return data.replace(/[?]{3}\\d+[a-zA-Z0-9+/]+:{0,2}[?]{3}/g, (match)=>this.retrieve(match));\n    }\n}\n\n\n/**\n * @typedef {Object} Replacement\n * @property {RegExp} re - the expression to match.\n * @property {string | function(match, ...captures): string} rep - replacement. If a function is\n * passed, it is provided with the string that matched followed by the captured\n * groups.\n */ /**\n * @type {ParsingWarden}\n */ const $75e9abed2bf14854$var$parsingWarden = new (0, $2815bbe36e5ce5cf$export$194ecf1460f71071)();\nfunction $75e9abed2bf14854$export$8df0edb81ed6c93c(href, parentheses) {\n    return `<span class=\"printable-link for-print-only\">${parentheses ? \"(\" : \"\"}${href}${parentheses ? \")\" : \"\"}</span>`;\n}\n/**\n * Applies an appropriate icon to the label text of a link. Applies none if no icon.\n * @param {string} href\n * @param {string} label\n * @returns {string}\n */ function $75e9abed2bf14854$var$addIconToLink(href, label) {\n    let iconHtml = \"\";\n    if (/^https:\\/\\/vimeo.com\\//.test(href)) iconHtml = '<i class=\"fa-brands fa-vimeo\"></i>';\n    else if (/^https:\\/\\/(www\\.)?youtube.com\\//.test(href)) iconHtml = '<i class=\"fa-brands fa-youtube\"></i>';\n    if (iconHtml) iconHtml = `<span class='link-icon'>${iconHtml}</span>`;\n    return `${label}${iconHtml}`;\n}\n/**\n * Block replacements (flow) {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Content_categories}\n * When processing the Markdown, blocks are created. These are defined as blocks\n * of text separated by at least one blank line. The following replacements\n * are used for code which should be treated as independent blocks. To ensure\n * post processing is correct, they should insert two newlines at the end to\n * create an independent block.\n * @type {Replacement[]}\n */ const $75e9abed2bf14854$var$blockReps = [\n    /** Setext heading 1 */ {\n        re: /(?:(.+)\\n=+\\n)/g,\n        rep: \"\\n\\n<h1>$1</h1>\\n\\n\"\n    },\n    /** Setext heading 2 */ {\n        re: /(?:(.+)\\n-+\\n)/g,\n        rep: \"\\n\\n<h2>$1</h2>\\n\\n\"\n    },\n    /** ATX heading. Any level. */ {\n        re: /^(#+)(?: *)(.+?)(?:#*)[ \\t]*$/gm,\n        rep: (matched, hashes, txt)=>{\n            const level = Math.min(hashes.length, 6);\n            return `\\n\\n<h${level}>${txt.trim()}</h${level}>\\n`;\n        }\n    },\n    /** block quote */ $75e9abed2bf14854$var$reAllLinesStartWith(\">[ \t]*\", {\n        blockPrefix: \"<blockquote>\",\n        blockSuffix: \"</blockquote>\"\n    }),\n    /** code block */ $75e9abed2bf14854$var$reAllLinesStartWith(\"(?: {4}|\t)\", {\n        blockPrefix: \"<pre><code>\",\n        blockSuffix: \"</code></pre>\",\n        trimContents: true,\n        useWarden: true\n    }),\n    /** horizontal rule. This must come before unordered lists to prevent interpretation of - as bullet */ {\n        re: /^(?:[*_-] *){3,}\\s*$/gm,\n        rep: \"\\n\\n<hr>\\n\\n\"\n    },\n    /** unordered list */ $75e9abed2bf14854$var$reAllLinesStartWith(\" {0,3}[*+-][ \t]+\", {\n        blockPrefix: \"<ul>\",\n        blockSuffix: \"</ul>\",\n        linePrefix: \"<li>\",\n        lineSuffix: \"</li>\"\n    }),\n    /** ordered list */ $75e9abed2bf14854$var$reAllLinesStartWith(\" {0,3}\\\\d+\\\\.[ \t]+\", {\n        blockPrefix: \"<ol>\",\n        blockSuffix: \"</ol>\",\n        linePrefix: \"<li>\",\n        lineSuffix: \"</li>\"\n    })\n];\n/**\n * Block replacements used for creating paragraphs.\n * @type {Replacement[]}\n */ const $75e9abed2bf14854$var$paragraphReps = [\n    /** paragraphs of elements not in blocks */ {\n        re: /(?:(?:^|\\n{2,})(?!<\\w+>))((?:.(?:\\n(?!\\n))?)+)/g,\n        rep: \"\\n\\n<p>$1</p>\\n\\n\"\n    },\n    /** tidy up */ {\n        re: /\\n{2,}/g,\n        rep: \"\\n\\n\"\n    }\n];\n/**\n * Span replacements used for Markdown.\n * @type {Replacement[]}\n */ const $75e9abed2bf14854$var$spanReps = [\n    /** image */ {\n        re: /!(&lt;)?\\[(.*?)\\]\\((https?:\\/\\/[-\\w@:%.+~#=/]+?)(?: +\"(.*?)\")?\\)/gm,\n        rep: (match, floatLeft, altText, src, title)=>{\n            const additionalClass = floatLeft ? \"floatable\" : \"\";\n            const html = `<img alt=\"${altText ?? \"\"}\" class=\"${additionalClass}\" src=\"${src}\" title=\"${title ?? \"\"}\"/>`;\n            return $75e9abed2bf14854$var$parsingWarden.protect(html);\n        }\n    },\n    /** link */ {\n        re: /\\[(.*?)\\]\\((https?:\\/\\/[-\\w@:%.+~#=/]+?)(?: +\"(.*?)\")?\\)/gm,\n        rep: (match, label, href, title)=>{\n            label = $75e9abed2bf14854$var$addIconToLink(href, label);\n            const html = `<a target=\"_blank\" href=\"${href}\" title=\"${title ?? \"\"}\">${label ?? \"\"}</a>${$75e9abed2bf14854$export$8df0edb81ed6c93c(href, true)}`;\n            return $75e9abed2bf14854$var$parsingWarden.protect(html);\n        }\n    },\n    /** automatic link */ {\n        re: /(?:&lt;|<)(https?:\\/\\/[-\\w@:%.+~#=/]+?)>/gm,\n        rep: (match, href)=>{\n            const html = `<a target=\"_blank\" href=\"${href}\">${href}</a>${$75e9abed2bf14854$export$8df0edb81ed6c93c(href, true)}`;\n            return $75e9abed2bf14854$var$parsingWarden.protect(html);\n        }\n    },\n    /** automatic email */ {\n        re: /(?:&lt;|<)([\\w.-]+@(?:[\\w-]+\\.)+[\\w-]+)/gm,\n        rep: (match, address)=>{\n            const encoded = $75e9abed2bf14854$export$52ce4ed9be59edb4(address);\n            const html = `<a href=\"${encoded}\">${encoded}</a>`;\n            return $75e9abed2bf14854$var$parsingWarden.protect(html);\n        }\n    },\n    /** code */ {\n        re: /(?:`{2,}(.*?)`{2,}|`(.*?)`)/gm,\n        rep: (match, codeA, codeB)=>{\n            const html = `<code>${codeA ?? codeB}</code>`;\n            return $75e9abed2bf14854$var$parsingWarden.protect(html);\n        }\n    },\n    /** emphasis single letters*/ {\n        re: /\\*\\*([^\\s])\\*\\*/gm,\n        rep: \"<strong>$1</strong>\"\n    },\n    {\n        re: /__([^\\s])__/gm,\n        rep: \"<strong>$1</strong>\"\n    },\n    {\n        re: /\\*([^\\s])\\*/gm,\n        rep: \"<em>$1</em>\"\n    },\n    {\n        re: /_([^\\s])_/gm,\n        rep: \"<em>$1</em>\"\n    },\n    /** emphasis words */ {\n        re: /\\*\\*([^\\s])(.*?)([^\\s])\\*\\*/gm,\n        rep: \"<strong>$1$2$3</strong>\"\n    },\n    {\n        re: /__([^\\s])(.*?)([^\\s])__/gm,\n        rep: \"<strong>$1$2$3</strong>\"\n    },\n    {\n        re: /\\*([^\\s])(.*?)([^\\s])\\*/gm,\n        rep: \"<em>$1$2$3</em>\"\n    },\n    {\n        re: /_([^\\s])(.*?)([^\\s])_/gm,\n        rep: \"<em>$1$2$3</em>\"\n    }\n];\n/**\n * Escape replacements used for Markdown\n * @type {Replacement[]}\n */ const $75e9abed2bf14854$var$markdownEscReps = [\n    {\n        re: /\\\\([\\\\`*_{}[\\]()#+.!-])/g,\n        rep: (match, chr)=>$75e9abed2bf14854$var$encodeCharToEntity(chr)\n    }\n];\n/**\n * Replacements for security reasons.\n */ const $75e9abed2bf14854$var$securityReps = [\n    {\n        re: \"\\x00\",\n        rep: \"\\uFFFD\"\n    }\n];\n/**\n * Escape HTML\n * @type {Replacement}\n */ const $75e9abed2bf14854$var$htmlEscIgnoringBrReps = [\n    {\n        re: /&(?![\\w#]+?;)/gm,\n        rep: \"&amp;\"\n    },\n    {\n        re: /<(?!\\/?(?:br|sub|sup)>)/gim,\n        rep: \"&lt;\"\n    }\n];\n/**\n * Escape HTML\n * @type {Replacement}\n */ const $75e9abed2bf14854$var$htmlEscAllReps = [\n    {\n        re: /&(?![\\w#]+?;)/gm,\n        rep: \"&amp;\"\n    },\n    {\n        re: /</gim,\n        rep: \"&lt;\"\n    }\n];\n/**\n * Clean up HTML\n */ const $75e9abed2bf14854$var$htmlCleanUpReps = [\n    {\n        re: /^\\s*$/gm,\n        rep: \"\"\n    },\n    {\n        re: /<(?:p|div)>\\s*?<\\/(?:p|div)>/gim,\n        rep: \"\"\n    }\n];\n/**\n * Parse data using replacements.\n * @param {string} data - text to be parsed.\n * @param {Replacement} replacements - replacements to apply.\n * @returns {string}\n */ function $75e9abed2bf14854$var$processReplacements(data, replacements) {\n    if (!data) return data;\n    replacements.forEach((sub)=>{\n        data = data.replaceAll(sub.re, sub.rep);\n    });\n    return data;\n}\n/**\n * Create Replacement for consecutive block of lines that all begin with the\n * specified character. This will form part of a regular expression so should be\n * escaped if special characters are to be matched.\n * @param {string} reStart - expression to match at start of each line. NB. if this\n * is a group, it must be non-capturing.\n * @param {Object} [options] - options for the block formation.\n * @param {string} options.blockPrefix - characters placed at the beginning of the resulting block.\n * @param {string} options.blockSuffix - characters placed at the end of the resulting block.\n * @param {string} options.linePrefix - characters placed at the beginning of each resulting line.\n * @param {string} options.lineSuffix - characters placed at the end of each resulting line.\n * @param {boolean} options.trimContents - if true, leading and trailing newlines and carriage returns are stripped\n * @param {boolean} options.useWarden - if true, the result is protected from further parsing.\n * from the block's contents\n * @returns {Replacement}\n */ function $75e9abed2bf14854$var$reAllLinesStartWith(reStart, options) {\n    const reBlockSearchRe = new RegExp(`(?:^|\\\\n)${reStart}(?:.|\\\\n)*?(?:(\\\\n(?!${reStart}))|$)`, \"g\");\n    const lineReplacementRe = new RegExp(`^${reStart}([ \\\\t]*.*)$`, \"gm\");\n    const lineReplacement = `${options?.linePrefix ?? \"\"}$1${options?.lineSuffix ?? \"\"}`;\n    return {\n        re: reBlockSearchRe,\n        rep: (match)=>{\n            let blockContents = match.replaceAll(lineReplacementRe, lineReplacement);\n            if (options.trimContents) blockContents = blockContents.replace(/^[\\n\\r]*/, \"\").trimEnd();\n            if (options.useWarden) blockContents = $75e9abed2bf14854$var$parsingWarden.protect(blockContents);\n            let html = `\\n\\n${options?.blockPrefix ?? \"\"}${blockContents}${options?.blockSuffix ?? \"\"}\\n\\n`;\n            return html;\n        }\n    };\n}\n/**\n * Encode character to HTML entity\n * @param {string} chr - character to encode. Although accepting a string, only the first\n * character is encoded.\n * @returns{string} HTML entity for first character.\n */ function $75e9abed2bf14854$var$encodeCharToEntity(chr) {\n    return `&#${chr.charCodeAt(0).toString()};`;\n}\nfunction $75e9abed2bf14854$export$52ce4ed9be59edb4(data) {\n    let result = \"\";\n    for (const chr of data)result += $75e9abed2bf14854$var$encodeCharToEntity(chr);\n    return result;\n}\nfunction $75e9abed2bf14854$export$e861db14a47fdf73(data) {\n    let decoded = data.replaceAll(/&#([0-9]{1,4});/g, (match, value)=>String.fromCharCode(parseInt(value)) + \"\\xad\");\n    decoded = decoded.replace(/&lt;/gi, \"<\");\n    decoded = decoded.replace(/&gt;/gi, \">\");\n    decoded = decoded.replace(/&nbsp;/gi, \" \");\n    decoded = decoded.replace(/&amp;/gi, \"&\");\n    decoded = decoded.replace(/</gi, \"<\\xad\");\n    decoded = decoded.replace(/&/gi, \"&\\xad\");\n    return decoded;\n}\nfunction $75e9abed2bf14854$export$bd6a2eae5de02ff5(data, options) {\n    $75e9abed2bf14854$var$parsingWarden.clear(); // this shouldn't be necessary as the warden automatically clears on retrieval.\n    var result = data.replaceAll(/\\r/g, \"\"); // normalise line endings\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$securityReps);\n    if (options?.pre) result = $75e9abed2bf14854$var$processReplacements(result, options.pre);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$htmlEscIgnoringBrReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$markdownEscReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$blockReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$paragraphReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$spanReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$htmlCleanUpReps);\n    if (options?.post) result = $75e9abed2bf14854$var$processReplacements(result, options.post);\n    return $75e9abed2bf14854$var$parsingWarden.reinstate(result);\n}\nfunction $75e9abed2bf14854$export$e635f05a4ac9fdf7(data) {\n    $75e9abed2bf14854$var$parsingWarden.clear(); // this shouldn't be necessary as the warden automatically clears on retrieval.\n    var result = data.replaceAll(/\\r/g, \"\"); // normalise line endings\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$securityReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$htmlEscIgnoringBrReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$markdownEscReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$spanReps);\n    result = $75e9abed2bf14854$var$processReplacements(result, $75e9abed2bf14854$var$htmlCleanUpReps);\n    return $75e9abed2bf14854$var$parsingWarden.reinstate(result);\n}\nfunction $75e9abed2bf14854$export$4cf11838cdc2a8a8(data) {\n    data = $75e9abed2bf14854$var$processReplacements(data, $75e9abed2bf14854$var$securityReps);\n    return $75e9abed2bf14854$var$processReplacements(data, $75e9abed2bf14854$var$htmlEscAllReps);\n}\nfunction $75e9abed2bf14854$export$15c8d03178b27d68(html) {\n    let plain = html.replace(/<[^>]*>/g, \"\").replace(/\\s+/g, \" \");\n    return $75e9abed2bf14854$export$e861db14a47fdf73(plain);\n}\n\n\n\n\n\n/**\n * @file Urls\n *\n * @module src/assets/urls.js\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ var $ab02f2464c9ae977$exports = {};\n$ab02f2464c9ae977$exports = JSON.parse('{\"frames\":[{\"filename\":\"acid00.png\",\"frame\":{\"x\":1,\"y\":293,\"w\":49,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":49,\"h\":48},\"sourceSize\":{\"w\":49,\"h\":48}},{\"filename\":\"amber.png\",\"frame\":{\"x\":197,\"y\":150,\"w\":47,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":47,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"aquamarine.png\",\"frame\":{\"x\":250,\"y\":52,\"w\":42,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":1,\"w\":42,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"arcane_orb.png\",\"frame\":{\"x\":544,\"y\":51,\"w\":47,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":2,\"w\":47,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"axe.png\",\"frame\":{\"x\":52,\"y\":191,\"w\":42,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":0,\"w\":42,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"barbarian1-dead00.png\",\"frame\":{\"x\":658,\"y\":287,\"w\":47,\"h\":33},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":11,\"w\":47,\"h\":33},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-idle00.png\",\"frame\":{\"x\":337,\"y\":301,\"w\":44,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":1,\"w\":44,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-idle01.png\",\"frame\":{\"x\":52,\"y\":293,\"w\":45,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":0,\"w\":45,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-e00.png\",\"frame\":{\"x\":246,\"y\":305,\"w\":41,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":0,\"w\":41,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-e01.png\",\"frame\":{\"x\":52,\"y\":343,\"w\":46,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":46,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-e02.png\",\"frame\":{\"x\":307,\"y\":448,\"w\":40,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":0,\"w\":40,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-e03.png\",\"frame\":{\"x\":349,\"y\":447,\"w\":36,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":0,\"w\":36,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-n00.png\",\"frame\":{\"x\":200,\"y\":52,\"w\":48,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":48,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-n01.png\",\"frame\":{\"x\":303,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-n02.png\",\"frame\":{\"x\":196,\"y\":101,\"w\":48,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":48,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-n03.png\",\"frame\":{\"x\":99,\"y\":292,\"w\":45,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":45,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-s00.png\",\"frame\":{\"x\":430,\"y\":301,\"w\":44,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":1,\"w\":44,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-s01.png\",\"frame\":{\"x\":100,\"y\":342,\"w\":44,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":0,\"w\":44,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-s02.png\",\"frame\":{\"x\":337,\"y\":350,\"w\":44,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":1,\"w\":44,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-s03.png\",\"frame\":{\"x\":100,\"y\":392,\"w\":46,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":46,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-w00.png\",\"frame\":{\"x\":525,\"y\":101,\"w\":38,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":38,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-w01.png\",\"frame\":{\"x\":246,\"y\":355,\"w\":42,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":42,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-w02.png\",\"frame\":{\"x\":473,\"y\":201,\"w\":38,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":38,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"barbarian1-walk-w03.png\",\"frame\":{\"x\":852,\"y\":243,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"battleaxe.png\",\"frame\":{\"x\":666,\"y\":196,\"w\":46,\"h\":42},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":6,\"w\":46,\"h\":42},\"sourceSize\":{\"w\":49,\"h\":48}},{\"filename\":\"belt_of_strength.png\",\"frame\":{\"x\":1088,\"y\":194,\"w\":47,\"h\":41},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":8,\"w\":47,\"h\":41},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"berserker-dead00.png\",\"frame\":{\"x\":97,\"y\":150,\"w\":48,\"h\":40},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":2,\"w\":48,\"h\":40},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"berserker-idle00.png\",\"frame\":{\"x\":1088,\"y\":51,\"w\":47,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":47,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"berserker-idle01.png\",\"frame\":{\"x\":100,\"y\":442,\"w\":46,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":46,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"black_flask.png\",\"frame\":{\"x\":246,\"y\":101,\"w\":28,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":10,\"y\":0,\"w\":28,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"blank.png\",\"frame\":{\"x\":561,\"y\":201,\"w\":3,\"h\":3},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":3,\"h\":3},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"block.png\",\"frame\":{\"x\":353,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"blood-splat-twice.png\",\"frame\":{\"x\":1,\"y\":1,\"w\":96,\"h\":94},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":96,\"h\":94},\"sourceSize\":{\"w\":96,\"h\":96}},{\"filename\":\"blood-splat.png\",\"frame\":{\"x\":1,\"y\":97,\"w\":94,\"h\":92},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":4,\"w\":94,\"h\":92},\"sourceSize\":{\"w\":96,\"h\":96}},{\"filename\":\"blue_flask.png\",\"frame\":{\"x\":246,\"y\":152,\"w\":28,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":10,\"y\":0,\"w\":28,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"bugbear-dead00.png\",\"frame\":{\"x\":566,\"y\":196,\"w\":48,\"h\":38},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":8,\"w\":48,\"h\":38},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"bugbear-idle00.png\",\"frame\":{\"x\":148,\"y\":392,\"w\":46,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":46,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"bugbear-idle01.png\",\"frame\":{\"x\":791,\"y\":51,\"w\":47,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":2,\"w\":47,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"bull00.png\",\"frame\":{\"x\":147,\"y\":150,\"w\":48,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cantrip.png\",\"frame\":{\"x\":430,\"y\":350,\"w\":44,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":44,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"chain_mail_armour.png\",\"frame\":{\"x\":476,\"y\":449,\"w\":42,\"h\":43},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":42,\"h\":43},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"cleric1-dead00.png\",\"frame\":{\"x\":697,\"y\":393,\"w\":47,\"h\":31},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":12,\"w\":47,\"h\":31},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-idle00.png\",\"frame\":{\"x\":840,\"y\":51,\"w\":47,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":2,\"w\":47,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-idle01.png\",\"frame\":{\"x\":51,\"y\":393,\"w\":47,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":47,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-e00.png\",\"frame\":{\"x\":902,\"y\":196,\"w\":42,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":42,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-e01.png\",\"frame\":{\"x\":889,\"y\":51,\"w\":47,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":2,\"w\":47,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-e02.png\",\"frame\":{\"x\":859,\"y\":195,\"w\":41,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":3,\"w\":41,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-e03.png\",\"frame\":{\"x\":870,\"y\":458,\"w\":38,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":4,\"w\":38,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-n00.png\",\"frame\":{\"x\":382,\"y\":251,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-n01.png\",\"frame\":{\"x\":51,\"y\":443,\"w\":47,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":47,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-n02.png\",\"frame\":{\"x\":289,\"y\":301,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-n03.png\",\"frame\":{\"x\":383,\"y\":299,\"w\":45,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":45,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-s00.png\",\"frame\":{\"x\":383,\"y\":348,\"w\":45,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":45,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-s01.png\",\"frame\":{\"x\":1137,\"y\":51,\"w\":47,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":47,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-s02.png\",\"frame\":{\"x\":336,\"y\":399,\"w\":45,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":45,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-s03.png\",\"frame\":{\"x\":403,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-w00.png\",\"frame\":{\"x\":1009,\"y\":420,\"w\":40,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":40,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-w01.png\",\"frame\":{\"x\":246,\"y\":405,\"w\":43,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":43,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-w02.png\",\"frame\":{\"x\":1051,\"y\":420,\"w\":40,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":40,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"cleric1-walk-w03.png\",\"frame\":{\"x\":1268,\"y\":144,\"w\":38,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":4,\"w\":38,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"club.png\",\"frame\":{\"x\":252,\"y\":1,\"w\":49,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":49,\"h\":48},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"coins.png\",\"frame\":{\"x\":99,\"y\":1,\"w\":49,\"h\":49},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":49,\"h\":49},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"copper_coins.png\",\"frame\":{\"x\":1041,\"y\":194,\"w\":45,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":4,\"w\":45,\"h\":44},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"copper_dragon_wyrmling-dead00.png\",\"frame\":{\"x\":802,\"y\":243,\"w\":48,\"h\":37},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":6,\"w\":48,\"h\":37},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"copper_dragon_wyrmling-idle00.png\",\"frame\":{\"x\":1186,\"y\":51,\"w\":48,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":48,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"copper_dragon_wyrmling-idle01.png\",\"frame\":{\"x\":1236,\"y\":51,\"w\":48,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":48,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"dagger.png\",\"frame\":{\"x\":951,\"y\":293,\"w\":40,\"h\":35},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":8,\"w\":40,\"h\":35},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"diamond.png\",\"frame\":{\"x\":432,\"y\":445,\"w\":42,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":1,\"w\":42,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"door-B.png\",\"frame\":{\"x\":453,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"door-L.png\",\"frame\":{\"x\":928,\"y\":243,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":15,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"door-R.png\",\"frame\":{\"x\":963,\"y\":242,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"door-T.png\",\"frame\":{\"x\":503,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"door2-B.png\",\"frame\":{\"x\":553,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"door2-T.png\",\"frame\":{\"x\":603,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"dretch-dead00.png\",\"frame\":{\"x\":938,\"y\":51,\"w\":48,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"dretch-idle00.png\",\"frame\":{\"x\":653,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"dretch-idle01.png\",\"frame\":{\"x\":703,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"enchanted_battleaxe.png\",\"frame\":{\"x\":1,\"y\":343,\"w\":49,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":49,\"h\":48},\"sourceSize\":{\"w\":49,\"h\":48}},{\"filename\":\"enchanted_greataxe.png\",\"frame\":{\"x\":753,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"enchanted_greatsword.png\",\"frame\":{\"x\":1,\"y\":393,\"w\":48,\"h\":49},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"enchanted_handaxe.png\",\"frame\":{\"x\":803,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"enchanted_shortsword.png\",\"frame\":{\"x\":1,\"y\":191,\"w\":49,\"h\":49},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":49,\"h\":49},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"engraved_pillar-idle00.png\",\"frame\":{\"x\":1184,\"y\":98,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":10,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"failed-spell.png\",\"frame\":{\"x\":921,\"y\":420,\"w\":42,\"h\":42},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":3,\"w\":42,\"h\":42},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fetid_water-idle00.png\",\"frame\":{\"x\":853,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-dead00.png\",\"frame\":{\"x\":791,\"y\":423,\"w\":46,\"h\":29},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":12,\"w\":46,\"h\":29},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-idle00.png\",\"frame\":{\"x\":1187,\"y\":244,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-idle01.png\",\"frame\":{\"x\":1268,\"y\":237,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-e00.png\",\"frame\":{\"x\":1434,\"y\":328,\"w\":30,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":3,\"w\":30,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-e01.png\",\"frame\":{\"x\":1352,\"y\":284,\"w\":35,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":4,\"w\":35,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-e02.png\",\"frame\":{\"x\":1128,\"y\":420,\"w\":29,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":3,\"w\":29,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-e03.png\",\"frame\":{\"x\":1373,\"y\":408,\"w\":28,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":4,\"w\":28,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-n00.png\",\"frame\":{\"x\":1149,\"y\":370,\"w\":35,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":35,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-n01.png\",\"frame\":{\"x\":825,\"y\":327,\"w\":41,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":4,\"w\":41,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-n02.png\",\"frame\":{\"x\":1159,\"y\":417,\"w\":35,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":35,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-n03.png\",\"frame\":{\"x\":1308,\"y\":247,\"w\":37,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":4,\"w\":37,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-s00.png\",\"frame\":{\"x\":1346,\"y\":96,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-s01.png\",\"frame\":{\"x\":1506,\"y\":192,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-s02.png\",\"frame\":{\"x\":1346,\"y\":143,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-s03.png\",\"frame\":{\"x\":1347,\"y\":237,\"w\":37,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":3,\"w\":37,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-w00.png\",\"frame\":{\"x\":1202,\"y\":321,\"w\":29,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":3,\"w\":29,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-w01.png\",\"frame\":{\"x\":1271,\"y\":327,\"w\":35,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":4,\"w\":35,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-w02.png\",\"frame\":{\"x\":1196,\"y\":415,\"w\":29,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":3,\"w\":29,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fighter1-walk-w03.png\",\"frame\":{\"x\":1494,\"y\":411,\"w\":28,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":4,\"w\":28,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fire00.png\",\"frame\":{\"x\":903,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fire01.png\",\"frame\":{\"x\":1,\"y\":444,\"w\":48,\"h\":49},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"fire_beetle_pv-dead00.png\",\"frame\":{\"x\":707,\"y\":283,\"w\":47,\"h\":38},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":5,\"w\":47,\"h\":38},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fire_beetle_pv-idle00.png\",\"frame\":{\"x\":953,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fire_beetle_pv-idle01.png\",\"frame\":{\"x\":1003,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"flail.png\",\"frame\":{\"x\":99,\"y\":52,\"w\":49,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":4,\"w\":49,\"h\":45},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"floor-SBE.png\",\"frame\":{\"x\":1053,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"floor-SBW.png\",\"frame\":{\"x\":1103,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"floor.png\",\"frame\":{\"x\":1153,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"floor2-SBE.png\",\"frame\":{\"x\":1203,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"floor2-SBW.png\",\"frame\":{\"x\":1253,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"floor2.png\",\"frame\":{\"x\":1303,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fungal_film-idle00.png\",\"frame\":{\"x\":1353,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fungal_film-idle01.png\",\"frame\":{\"x\":1403,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"fungus.png\",\"frame\":{\"x\":746,\"y\":393,\"w\":43,\"h\":31},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":9,\"w\":43,\"h\":31},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"gargoyle-dead00.png\",\"frame\":{\"x\":852,\"y\":293,\"w\":48,\"h\":32},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":9,\"w\":48,\"h\":32},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"gargoyle-idle00.png\",\"frame\":{\"x\":1386,\"y\":51,\"w\":48,\"h\":42},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":6,\"w\":48,\"h\":42},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"gargoyle-idle01.png\",\"frame\":{\"x\":1436,\"y\":51,\"w\":48,\"h\":42},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":6,\"w\":48,\"h\":42},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"gas00.png\",\"frame\":{\"x\":1453,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ghoul-dead00.png\",\"frame\":{\"x\":1545,\"y\":162,\"w\":43,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":11,\"w\":43,\"h\":30},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ghoul-idle00.png\",\"frame\":{\"x\":1469,\"y\":98,\"w\":37,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":3,\"w\":37,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ghoul-idle01.png\",\"frame\":{\"x\":1346,\"y\":190,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"giant_wasp_pv-dead00.png\",\"frame\":{\"x\":148,\"y\":442,\"w\":47,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":47,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"giant_wasp_pv-idle00.png\",\"frame\":{\"x\":197,\"y\":442,\"w\":47,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":47,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"giant_wasp_pv-idle01.png\",\"frame\":{\"x\":1503,\"y\":1,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"goblin-dead00.png\",\"frame\":{\"x\":1227,\"y\":284,\"w\":43,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":12,\"w\":43,\"h\":30},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"goblin-idle00.png\",\"frame\":{\"x\":654,\"y\":322,\"w\":43,\"h\":42},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":6,\"w\":43,\"h\":42},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"goblin-idle01.png\",\"frame\":{\"x\":763,\"y\":195,\"w\":46,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":46,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"gold_coins.png\",\"frame\":{\"x\":150,\"y\":1,\"w\":49,\"h\":49},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":49,\"h\":49},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"gold_portal-dead00.png\",\"frame\":{\"x\":428,\"y\":397,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"gold_portal-idle00.png\",\"frame\":{\"x\":993,\"y\":292,\"w\":31,\"h\":36},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":12,\"y\":8,\"w\":31,\"h\":36},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"greataxe.png\",\"frame\":{\"x\":425,\"y\":201,\"w\":46,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":1,\"w\":46,\"h\":48},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"greatsword.png\",\"frame\":{\"x\":97,\"y\":99,\"w\":47,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":47,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"green_flask.png\",\"frame\":{\"x\":246,\"y\":203,\"w\":28,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":10,\"y\":0,\"w\":28,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"half_plate_armour.png\",\"frame\":{\"x\":616,\"y\":196,\"w\":48,\"h\":39},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":5,\"w\":48,\"h\":39},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"handaxe.png\",\"frame\":{\"x\":52,\"y\":242,\"w\":42,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":0,\"w\":42,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"helmet.png\",\"frame\":{\"x\":1467,\"y\":145,\"w\":37,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":1,\"w\":37,\"h\":45},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"helmet_of_ogre_power.png\",\"frame\":{\"x\":1553,\"y\":1,\"w\":40,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":0,\"w\":40,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"hidden_artefact-dead00.png\",\"frame\":{\"x\":744,\"y\":426,\"w\":32,\"h\":32},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":5,\"w\":32,\"h\":32},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hidden_artefact-idle00.png\",\"frame\":{\"x\":1524,\"y\":427,\"w\":28,\"h\":27},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":5,\"w\":28,\"h\":27},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-arrow-down00.png\",\"frame\":{\"x\":565,\"y\":100,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-arrow-down01.png\",\"frame\":{\"x\":613,\"y\":100,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-arrow-left00.png\",\"frame\":{\"x\":566,\"y\":148,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-arrow-left01.png\",\"frame\":{\"x\":614,\"y\":148,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-arrow-right00.png\",\"frame\":{\"x\":661,\"y\":100,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-arrow-right01.png\",\"frame\":{\"x\":709,\"y\":99,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-arrow-up00.png\",\"frame\":{\"x\":757,\"y\":99,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-arrow-up01.png\",\"frame\":{\"x\":805,\"y\":99,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-auto-centre00.png\",\"frame\":{\"x\":853,\"y\":99,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-auto-centre01.png\",\"frame\":{\"x\":662,\"y\":148,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-fullscreen00.png\",\"frame\":{\"x\":146,\"y\":100,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hud-fullscreen01.png\",\"frame\":{\"x\":710,\"y\":147,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"hunting_trap.png\",\"frame\":{\"x\":999,\"y\":467,\"w\":46,\"h\":28},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":11,\"w\":46,\"h\":28},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"ice00.png\",\"frame\":{\"x\":658,\"y\":240,\"w\":42,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":3,\"w\":42,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"iron_rations.png\",\"frame\":{\"x\":696,\"y\":426,\"w\":46,\"h\":32},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":10,\"w\":46,\"h\":32},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"kobold-dead00.png\",\"frame\":{\"x\":1076,\"y\":336,\"w\":42,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":12,\"w\":42,\"h\":30},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"kobold-idle00.png\",\"frame\":{\"x\":1272,\"y\":284,\"w\":34,\"h\":41},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":7,\"w\":34,\"h\":41},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"kobold-idle01.png\",\"frame\":{\"x\":1082,\"y\":375,\"w\":35,\"h\":43},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":5,\"w\":35,\"h\":43},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"leather_armour.png\",\"frame\":{\"x\":752,\"y\":242,\"w\":48,\"h\":38},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":5,\"w\":48,\"h\":38},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"lichen.png\",\"frame\":{\"x\":562,\"y\":236,\"w\":44,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":3,\"w\":44,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"lightning00.png\",\"frame\":{\"x\":376,\"y\":201,\"w\":47,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":47,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"lock_pick.png\",\"frame\":{\"x\":901,\"y\":99,\"w\":41,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":1,\"w\":41,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"lute.png\",\"frame\":{\"x\":949,\"y\":330,\"w\":40,\"h\":38},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":6,\"w\":40,\"h\":38},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"magic00.png\",\"frame\":{\"x\":965,\"y\":420,\"w\":42,\"h\":42},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":42,\"h\":42},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"manhole_cover-dead00.png\",\"frame\":{\"x\":887,\"y\":423,\"w\":32,\"h\":33},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":6,\"w\":32,\"h\":33},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"manhole_cover-idle00.png\",\"frame\":{\"x\":1166,\"y\":464,\"w\":30,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":9,\"w\":30,\"h\":30},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"meat.png\",\"frame\":{\"x\":1035,\"y\":328,\"w\":39,\"h\":40},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":6,\"w\":39,\"h\":40},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"miss.png\",\"frame\":{\"x\":562,\"y\":282,\"w\":44,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":44,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ogre-dead00.png\",\"frame\":{\"x\":756,\"y\":282,\"w\":48,\"h\":37},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":7,\"w\":48,\"h\":37},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ogre-idle00.png\",\"frame\":{\"x\":430,\"y\":251,\"w\":44,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":44,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ogre-idle01.png\",\"frame\":{\"x\":291,\"y\":398,\"w\":43,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":43,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"orc-dead00.png\",\"frame\":{\"x\":699,\"y\":323,\"w\":48,\"h\":36},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":8,\"w\":48,\"h\":36},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"orc-idle00.png\",\"frame\":{\"x\":383,\"y\":396,\"w\":43,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":43,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"orc-idle01.png\",\"frame\":{\"x\":387,\"y\":446,\"w\":43,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":43,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"orc-walk-w00.png\",\"frame\":{\"x\":524,\"y\":151,\"w\":40,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":40,\"h\":48},\"sourceSize\":{\"w\":49,\"h\":48}},{\"filename\":\"orc_skull.png\",\"frame\":{\"x\":246,\"y\":254,\"w\":40,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":0,\"w\":40,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"padded_armour.png\",\"frame\":{\"x\":1286,\"y\":51,\"w\":48,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":48,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"plate_armour.png\",\"frame\":{\"x\":96,\"y\":192,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"platinum_coins.png\",\"frame\":{\"x\":1,\"y\":242,\"w\":49,\"h\":49},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":49,\"h\":49},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"poisoners_kit.png\",\"frame\":{\"x\":806,\"y\":282,\"w\":44,\"h\":39},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":5,\"w\":44,\"h\":39},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"poleaxe.png\",\"frame\":{\"x\":201,\"y\":1,\"w\":49,\"h\":49},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":49,\"h\":49},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"potion_of_healing.png\",\"frame\":{\"x\":246,\"y\":455,\"w\":29,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":10,\"y\":0,\"w\":29,\"h\":49},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"purple_plant.png\",\"frame\":{\"x\":702,\"y\":242,\"w\":48,\"h\":39},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":7,\"w\":48,\"h\":39},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"quarterstaff.png\",\"frame\":{\"x\":288,\"y\":251,\"w\":45,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":1,\"w\":45,\"h\":48},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"quartz.png\",\"frame\":{\"x\":902,\"y\":147,\"w\":42,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":1,\"w\":42,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"ranger1-dead00.png\",\"frame\":{\"x\":839,\"y\":423,\"w\":46,\"h\":33},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":12,\"w\":46,\"h\":33},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-idle00.png\",\"frame\":{\"x\":1224,\"y\":368,\"w\":33,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":33,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-idle01.png\",\"frame\":{\"x\":1506,\"y\":239,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-e00.png\",\"frame\":{\"x\":1427,\"y\":141,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-e01.png\",\"frame\":{\"x\":1428,\"y\":95,\"w\":39,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":4,\"w\":39,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-e02.png\",\"frame\":{\"x\":1427,\"y\":188,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-e03.png\",\"frame\":{\"x\":1544,\"y\":241,\"w\":36,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":4,\"w\":36,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-n00.png\",\"frame\":{\"x\":1308,\"y\":329,\"w\":35,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":3,\"w\":35,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-n01.png\",\"frame\":{\"x\":1345,\"y\":330,\"w\":35,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":4,\"w\":35,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-n02.png\",\"frame\":{\"x\":1227,\"y\":415,\"w\":33,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":3,\"w\":33,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-n03.png\",\"frame\":{\"x\":1544,\"y\":287,\"w\":36,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":4,\"w\":36,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-s00.png\",\"frame\":{\"x\":1544,\"y\":194,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-s01.png\",\"frame\":{\"x\":1466,\"y\":332,\"w\":36,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":4,\"w\":36,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-s02.png\",\"frame\":{\"x\":1389,\"y\":281,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-s03.png\",\"frame\":{\"x\":1504,\"y\":332,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-w00.png\",\"frame\":{\"x\":1467,\"y\":192,\"w\":37,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":37,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-w01.png\",\"frame\":{\"x\":1226,\"y\":144,\"w\":40,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":4,\"w\":40,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-w02.png\",\"frame\":{\"x\":1467,\"y\":239,\"w\":37,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":37,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ranger1-walk-w03.png\",\"frame\":{\"x\":1508,\"y\":99,\"w\":37,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":4,\"w\":37,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat-dead00.png\",\"frame\":{\"x\":1026,\"y\":291,\"w\":45,\"h\":35},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":13,\"w\":45,\"h\":35},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat-idle00.png\",\"frame\":{\"x\":1137,\"y\":194,\"w\":48,\"h\":40},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":7,\"w\":48,\"h\":40},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat-idle01.png\",\"frame\":{\"x\":608,\"y\":237,\"w\":48,\"h\":40},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":6,\"w\":48,\"h\":40},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat-walk-e00.png\",\"frame\":{\"x\":146,\"y\":349,\"w\":48,\"h\":41},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":5,\"w\":48,\"h\":41},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat-walk-n00.png\",\"frame\":{\"x\":910,\"y\":464,\"w\":39,\"h\":40},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":6,\"w\":39,\"h\":40},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat-walk-s00.png\",\"frame\":{\"x\":654,\"y\":460,\"w\":42,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":42,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat-walk-w00.png\",\"frame\":{\"x\":196,\"y\":399,\"w\":48,\"h\":41},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":5,\"w\":48,\"h\":41},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat.png\",\"frame\":{\"x\":608,\"y\":279,\"w\":48,\"h\":40},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":7,\"w\":48,\"h\":40},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat_pv-dead00.png\",\"frame\":{\"x\":1308,\"y\":293,\"w\":42,\"h\":34},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":13,\"w\":42,\"h\":34},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat_pv-idle00.png\",\"frame\":{\"x\":476,\"y\":351,\"w\":41,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":41,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rat_pv-idle01.png\",\"frame\":{\"x\":476,\"y\":400,\"w\":42,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":42,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"red_flask.png\",\"frame\":{\"x\":277,\"y\":455,\"w\":28,\"h\":49},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":10,\"y\":0,\"w\":28,\"h\":49},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"restorative_ointment.png\",\"frame\":{\"x\":1093,\"y\":469,\"w\":39,\"h\":35},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":7,\"w\":39,\"h\":35},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"ring_mail_armour.png\",\"frame\":{\"x\":826,\"y\":458,\"w\":42,\"h\":43},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":42,\"h\":43},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"ring_of_charisma.png\",\"frame\":{\"x\":1198,\"y\":462,\"w\":40,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":10,\"w\":40,\"h\":30},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"ring_of_constitution.png\",\"frame\":{\"x\":1259,\"y\":373,\"w\":40,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":10,\"w\":40,\"h\":30},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"ring_of_dexterity.png\",\"frame\":{\"x\":1301,\"y\":376,\"w\":40,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":10,\"w\":40,\"h\":30},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"ring_of_intelligence.png\",\"frame\":{\"x\":1343,\"y\":376,\"w\":40,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":10,\"w\":40,\"h\":30},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"ring_of_strength.png\",\"frame\":{\"x\":1240,\"y\":462,\"w\":40,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":10,\"w\":40,\"h\":30},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"ring_of_wisdom.png\",\"frame\":{\"x\":1459,\"y\":378,\"w\":40,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":10,\"w\":40,\"h\":30},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"RIP.png\",\"frame\":{\"x\":150,\"y\":52,\"w\":48,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":2,\"w\":48,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-dead00.png\",\"frame\":{\"x\":951,\"y\":464,\"w\":46,\"h\":31},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":12,\"w\":46,\"h\":31},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-idle00.png\",\"frame\":{\"x\":1403,\"y\":403,\"w\":33,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":33,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-idle01.png\",\"frame\":{\"x\":1542,\"y\":333,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-e00.png\",\"frame\":{\"x\":1354,\"y\":454,\"w\":33,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":33,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-e01.png\",\"frame\":{\"x\":1282,\"y\":454,\"w\":34,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":4,\"w\":34,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-e02.png\",\"frame\":{\"x\":1389,\"y\":454,\"w\":33,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":33,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-e03.png\",\"frame\":{\"x\":868,\"y\":327,\"w\":31,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":4,\"w\":31,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-n00.png\",\"frame\":{\"x\":1262,\"y\":405,\"w\":35,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":3,\"w\":35,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-n01.png\",\"frame\":{\"x\":1299,\"y\":408,\"w\":35,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":4,\"w\":35,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-n02.png\",\"frame\":{\"x\":1424,\"y\":450,\"w\":33,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":3,\"w\":33,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-n03.png\",\"frame\":{\"x\":1336,\"y\":408,\"w\":35,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":4,\"w\":35,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-s00.png\",\"frame\":{\"x\":1109,\"y\":287,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-s01.png\",\"frame\":{\"x\":1385,\"y\":357,\"w\":35,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":4,\"w\":35,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-s02.png\",\"frame\":{\"x\":1164,\"y\":321,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-s03.png\",\"frame\":{\"x\":1186,\"y\":368,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-w00.png\",\"frame\":{\"x\":1537,\"y\":380,\"w\":33,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":33,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-w01.png\",\"frame\":{\"x\":1318,\"y\":454,\"w\":34,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":4,\"w\":34,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-w02.png\",\"frame\":{\"x\":1459,\"y\":442,\"w\":33,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":33,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rogue1-walk-w03.png\",\"frame\":{\"x\":1076,\"y\":290,\"w\":31,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":4,\"w\":31,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"rusty_key.png\",\"frame\":{\"x\":1093,\"y\":420,\"w\":33,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":2,\"w\":33,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"scale_mail_armour.png\",\"frame\":{\"x\":608,\"y\":321,\"w\":44,\"h\":43},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":3,\"w\":44,\"h\":43},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"shadow-dead00.png\",\"frame\":{\"x\":1120,\"y\":334,\"w\":42,\"h\":34},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":9,\"w\":42,\"h\":34},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"shadow-idle00.png\",\"frame\":{\"x\":96,\"y\":242,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"shadow-idle01.png\",\"frame\":{\"x\":146,\"y\":199,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"shield.png\",\"frame\":{\"x\":994,\"y\":194,\"w\":45,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":3,\"w\":45,\"h\":45},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"shortsword.png\",\"frame\":{\"x\":758,\"y\":147,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"silver_coins.png\",\"frame\":{\"x\":290,\"y\":349,\"w\":45,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":2,\"w\":45,\"h\":47},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"skeleton-dead00.png\",\"frame\":{\"x\":1047,\"y\":467,\"w\":44,\"h\":28},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":13,\"w\":44,\"h\":28},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"skeleton-idle00.png\",\"frame\":{\"x\":1427,\"y\":282,\"w\":37,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":4,\"w\":37,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"skeleton-idle01.png\",\"frame\":{\"x\":1186,\"y\":145,\"w\":38,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":1,\"w\":38,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"skull.png\",\"frame\":{\"x\":475,\"y\":151,\"w\":47,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":47,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"slime-idle00.png\",\"frame\":{\"x\":146,\"y\":249,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"slime-idle01.png\",\"frame\":{\"x\":146,\"y\":299,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"spell.png\",\"frame\":{\"x\":518,\"y\":249,\"w\":42,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":1,\"w\":42,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"spider_pv-dead00.png\",\"frame\":{\"x\":901,\"y\":330,\"w\":46,\"h\":38},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":5,\"w\":46,\"h\":38},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"spider_pv-idle00.png\",\"frame\":{\"x\":1494,\"y\":457,\"w\":32,\"h\":28},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":10,\"w\":32,\"h\":28},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"spider_pv-idle01.png\",\"frame\":{\"x\":1438,\"y\":410,\"w\":32,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":8,\"y\":10,\"w\":32,\"h\":30},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"stirge-dead00.png\",\"frame\":{\"x\":1389,\"y\":328,\"w\":43,\"h\":27},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":11,\"w\":43,\"h\":27},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"stirge-idle00.png\",\"frame\":{\"x\":1147,\"y\":286,\"w\":38,\"h\":28},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":10,\"w\":38,\"h\":28},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"stirge-idle01.png\",\"frame\":{\"x\":1187,\"y\":291,\"w\":38,\"h\":28},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":10,\"w\":38,\"h\":28},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"studded_leather_armour.png\",\"frame\":{\"x\":1336,\"y\":51,\"w\":48,\"h\":43},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":48,\"h\":43},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"tiger_eye.png\",\"frame\":{\"x\":593,\"y\":51,\"w\":47,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":47,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"trader1-dead00.png\",\"frame\":{\"x\":196,\"y\":199,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"trader1-idle00.png\",\"frame\":{\"x\":1486,\"y\":51,\"w\":47,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":3,\"w\":47,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"trader1-idle01.png\",\"frame\":{\"x\":426,\"y\":151,\"w\":47,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":47,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"trader2-dead00.png\",\"frame\":{\"x\":196,\"y\":249,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"trader2-idle00.png\",\"frame\":{\"x\":1535,\"y\":52,\"w\":47,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":3,\"w\":47,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"trader2-idle01.png\",\"frame\":{\"x\":476,\"y\":101,\"w\":47,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":47,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"trapdoor-dead00.png\",\"frame\":{\"x\":1501,\"y\":379,\"w\":34,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":9,\"w\":34,\"h\":30},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"trapdoor-idle00.png\",\"frame\":{\"x\":1134,\"y\":467,\"w\":30,\"h\":36},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":9,\"y\":9,\"w\":30,\"h\":36},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-checkbox00.png\",\"frame\":{\"x\":806,\"y\":147,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-checkbox01.png\",\"frame\":{\"x\":854,\"y\":147,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-guides00.png\",\"frame\":{\"x\":944,\"y\":98,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-guides01.png\",\"frame\":{\"x\":992,\"y\":98,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-hall-of-fame00.png\",\"frame\":{\"x\":1040,\"y\":98,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-hall-of-fame01.png\",\"frame\":{\"x\":1088,\"y\":98,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-play00.png\",\"frame\":{\"x\":1136,\"y\":98,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-play01.png\",\"frame\":{\"x\":946,\"y\":146,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-settings00.png\",\"frame\":{\"x\":994,\"y\":146,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-settings01.png\",\"frame\":{\"x\":1042,\"y\":146,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-spinner-down00.png\",\"frame\":{\"x\":1090,\"y\":146,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-spinner-down01.png\",\"frame\":{\"x\":1138,\"y\":146,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-spinner-left00.png\",\"frame\":{\"x\":513,\"y\":201,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-spinner-left01.png\",\"frame\":{\"x\":519,\"y\":347,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-spinner-right00.png\",\"frame\":{\"x\":520,\"y\":395,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-spinner-right01.png\",\"frame\":{\"x\":520,\"y\":443,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-spinner-up00.png\",\"frame\":{\"x\":811,\"y\":195,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"ui-spinner-up01.png\",\"frame\":{\"x\":946,\"y\":194,\"w\":46,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":1,\"w\":46,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"undead00.png\",\"frame\":{\"x\":196,\"y\":299,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"undefined.png\",\"frame\":{\"x\":1119,\"y\":375,\"w\":28,\"h\":43},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":11,\"y\":3,\"w\":28,\"h\":43},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"vegetation-dead00.png\",\"frame\":{\"x\":432,\"y\":494,\"w\":29,\"h\":10},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":10,\"y\":18,\"w\":29,\"h\":10},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"vegetation-idle00.png\",\"frame\":{\"x\":520,\"y\":491,\"w\":29,\"h\":13},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":10,\"y\":15,\"w\":29,\"h\":13},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"violet_fungus-dead00.png\",\"frame\":{\"x\":991,\"y\":330,\"w\":42,\"h\":38},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":3,\"w\":42,\"h\":38},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"violet_fungus-idle00.png\",\"frame\":{\"x\":988,\"y\":51,\"w\":48,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":48,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"violet_fungus-idle01.png\",\"frame\":{\"x\":1038,\"y\":51,\"w\":48,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":1,\"w\":48,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-B.png\",\"frame\":{\"x\":196,\"y\":349,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-BL.png\",\"frame\":{\"x\":749,\"y\":323,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":15,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-BLI.png\",\"frame\":{\"x\":294,\"y\":51,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-BR.png\",\"frame\":{\"x\":791,\"y\":373,\"w\":34,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":34,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-BRI.png\",\"frame\":{\"x\":276,\"y\":101,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-BTEE.png\",\"frame\":{\"x\":344,\"y\":51,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-HI.png\",\"frame\":{\"x\":276,\"y\":151,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-L.png\",\"frame\":{\"x\":867,\"y\":373,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":15,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-LTEE.png\",\"frame\":{\"x\":942,\"y\":370,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":15,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-R.png\",\"frame\":{\"x\":977,\"y\":370,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-RTEE.png\",\"frame\":{\"x\":1012,\"y\":370,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-T.png\",\"frame\":{\"x\":326,\"y\":101,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-TL.png\",\"frame\":{\"x\":1039,\"y\":241,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":15,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-TLI.png\",\"frame\":{\"x\":394,\"y\":51,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-TR.png\",\"frame\":{\"x\":1047,\"y\":370,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-TRI.png\",\"frame\":{\"x\":276,\"y\":201,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-TTEE.png\",\"frame\":{\"x\":326,\"y\":151,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-VI.png\",\"frame\":{\"x\":376,\"y\":101,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall-XI.png\",\"frame\":{\"x\":444,\"y\":51,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall2-B.png\",\"frame\":{\"x\":326,\"y\":201,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall2-HI.png\",\"frame\":{\"x\":376,\"y\":151,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wall2-T.png\",\"frame\":{\"x\":426,\"y\":101,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warhammer.png\",\"frame\":{\"x\":642,\"y\":51,\"w\":47,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":2,\"w\":47,\"h\":47},\"sourceSize\":{\"w\":49,\"h\":49}},{\"filename\":\"warlock1-dead00.png\",\"frame\":{\"x\":1547,\"y\":129,\"w\":44,\"h\":31},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":12,\"w\":44,\"h\":31},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-idle00.png\",\"frame\":{\"x\":1226,\"y\":190,\"w\":39,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":39,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-idle01.png\",\"frame\":{\"x\":609,\"y\":366,\"w\":42,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":42,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-e00.png\",\"frame\":{\"x\":1267,\"y\":190,\"w\":39,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":39,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-e01.png\",\"frame\":{\"x\":698,\"y\":460,\"w\":42,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":4,\"w\":42,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-e02.png\",\"frame\":{\"x\":1227,\"y\":237,\"w\":39,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":39,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-e03.png\",\"frame\":{\"x\":1466,\"y\":286,\"w\":37,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":4,\"w\":37,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-n00.png\",\"frame\":{\"x\":609,\"y\":413,\"w\":42,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":42,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-n01.png\",\"frame\":{\"x\":609,\"y\":460,\"w\":43,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":4,\"w\":43,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-n02.png\",\"frame\":{\"x\":653,\"y\":366,\"w\":42,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":3,\"w\":42,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-n03.png\",\"frame\":{\"x\":742,\"y\":460,\"w\":42,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":4,\"w\":42,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-s00.png\",\"frame\":{\"x\":1224,\"y\":97,\"w\":40,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":3,\"w\":40,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-s01.png\",\"frame\":{\"x\":1386,\"y\":95,\"w\":40,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":4,\"w\":40,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-s02.png\",\"frame\":{\"x\":1266,\"y\":97,\"w\":40,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":3,\"w\":40,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-s03.png\",\"frame\":{\"x\":653,\"y\":413,\"w\":41,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":41,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-w00.png\",\"frame\":{\"x\":1386,\"y\":141,\"w\":39,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":39,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-w01.png\",\"frame\":{\"x\":1386,\"y\":235,\"w\":39,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":4,\"w\":39,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-w02.png\",\"frame\":{\"x\":1386,\"y\":188,\"w\":39,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":3,\"w\":39,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warlock1-walk-w03.png\",\"frame\":{\"x\":1505,\"y\":286,\"w\":37,\"h\":44},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":4,\"w\":37,\"h\":44},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"warning00.png\",\"frame\":{\"x\":494,\"y\":51,\"w\":48,\"h\":48},\"rotated\":false,\"trimmed\":false,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":48,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"waterskin.png\",\"frame\":{\"x\":518,\"y\":298,\"w\":42,\"h\":47},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":2,\"w\":42,\"h\":47},\"sourceSize\":{\"w\":48,\"h\":49}},{\"filename\":\"wight-dead00.png\",\"frame\":{\"x\":699,\"y\":361,\"w\":48,\"h\":30},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":16,\"w\":48,\"h\":30},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wight-idle00.png\",\"frame\":{\"x\":1233,\"y\":316,\"w\":36,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":3,\"w\":36,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wight-idle01.png\",\"frame\":{\"x\":1074,\"y\":240,\"w\":33,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":0,\"w\":33,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-dead00.png\",\"frame\":{\"x\":902,\"y\":293,\"w\":47,\"h\":35},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":10,\"w\":47,\"h\":35},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-idle00.png\",\"frame\":{\"x\":476,\"y\":251,\"w\":40,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":0,\"w\":40,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-idle01.png\",\"frame\":{\"x\":567,\"y\":328,\"w\":39,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":0,\"w\":39,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-e00.png\",\"frame\":{\"x\":568,\"y\":378,\"w\":39,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":0,\"w\":39,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-e01.png\",\"frame\":{\"x\":335,\"y\":251,\"w\":45,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":0,\"w\":45,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-e02.png\",\"frame\":{\"x\":568,\"y\":428,\"w\":39,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":2,\"y\":0,\"w\":39,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-e03.png\",\"frame\":{\"x\":1109,\"y\":237,\"w\":36,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":0,\"w\":36,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-n00.png\",\"frame\":{\"x\":887,\"y\":243,\"w\":39,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":0,\"w\":39,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-n01.png\",\"frame\":{\"x\":476,\"y\":301,\"w\":40,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":0,\"w\":40,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-n02.png\",\"frame\":{\"x\":998,\"y\":241,\"w\":39,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":0,\"w\":39,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-n03.png\",\"frame\":{\"x\":1187,\"y\":194,\"w\":37,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":3,\"y\":0,\"w\":37,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-s00.png\",\"frame\":{\"x\":1308,\"y\":97,\"w\":36,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":0,\"w\":36,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-s01.png\",\"frame\":{\"x\":827,\"y\":373,\"w\":38,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":0,\"w\":38,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-s02.png\",\"frame\":{\"x\":1308,\"y\":147,\"w\":36,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":7,\"y\":0,\"w\":36,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-s03.png\",\"frame\":{\"x\":784,\"y\":323,\"w\":39,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":0,\"w\":39,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-w00.png\",\"frame\":{\"x\":902,\"y\":370,\"w\":38,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":0,\"w\":38,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-w01.png\",\"frame\":{\"x\":1147,\"y\":236,\"w\":38,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":0,\"w\":38,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-w02.png\",\"frame\":{\"x\":786,\"y\":454,\"w\":38,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":0,\"w\":38,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wizard1-walk-w03.png\",\"frame\":{\"x\":1308,\"y\":197,\"w\":36,\"h\":48},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":6,\"y\":0,\"w\":36,\"h\":48},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wraith-dead00.png\",\"frame\":{\"x\":714,\"y\":195,\"w\":47,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":0,\"w\":47,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wraith-idle00.png\",\"frame\":{\"x\":691,\"y\":51,\"w\":48,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":2,\"w\":48,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"wraith-idle01.png\",\"frame\":{\"x\":741,\"y\":51,\"w\":48,\"h\":46},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":0,\"y\":2,\"w\":48,\"h\":46},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"zombie-dead00.png\",\"frame\":{\"x\":1547,\"y\":99,\"w\":46,\"h\":28},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":1,\"y\":13,\"w\":46,\"h\":28},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"zombie-idle00.png\",\"frame\":{\"x\":1506,\"y\":145,\"w\":37,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":5,\"y\":3,\"w\":37,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}},{\"filename\":\"zombie-idle01.png\",\"frame\":{\"x\":1427,\"y\":235,\"w\":38,\"h\":45},\"rotated\":false,\"trimmed\":true,\"spriteSourceSize\":{\"x\":4,\"y\":3,\"w\":38,\"h\":45},\"sourceSize\":{\"w\":48,\"h\":48}}],\"meta\":{\"app\":\"https://www.codeandweb.com/texturepacker\",\"version\":\"1.0\",\"image\":\"dungeon.png\",\"format\":\"RGBA8888\",\"size\":{\"w\":1594,\"h\":505},\"scale\":\"1\",\"smartupdate\":\"$TexturePacker:SmartUpdate:306392f56936c372f3f3518ca39917bd:eeab59f6750eb69f8e287201aad70291:9c0fba27a8a0c106083a8713f6c67b32$\"}}');\n\n\nvar $e930bf3cf7113404$exports = {};\n\n$e930bf3cf7113404$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"about.9d8bcf91.md\";\n\n\nvar $de81d41e34f30975$exports = {};\n\n$de81d41e34f30975$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"armour.bfc2be64.txt\";\n\n\nvar $62c3d80d1fa7bce4$exports = {};\n\n$62c3d80d1fa7bce4$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"artefacts.a11b197b.txt\";\n\n\nvar $9747fa697e881e78$exports = {};\n\n$9747fa697e881e78$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"magic.33097e30.txt\";\n\n\nvar $7ad4ee7b5c11248a$exports = {};\n\n$7ad4ee7b5c11248a$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"monsters.1161fbe8.txt\";\n\n\nvar $5576e8927572aaec$exports = {};\n\n$5576e8927572aaec$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"heroes.57c67ffd.txt\";\n\n\nvar $278bd977bbb3b534$exports = {};\n\n$278bd977bbb3b534$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"money.dc77b2a9.txt\";\n\n\nvar $25e8874d301378f7$exports = {};\n\n$25e8874d301378f7$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"traders.1d8d82a4.txt\";\n\n\nvar $bc21e390b0fbed77$exports = {};\n\n$bc21e390b0fbed77$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"weapons.e6080a43.txt\";\n\n\nvar $d33c974414460e80$exports = {};\n\n$d33c974414460e80$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"keys.f3b71340.txt\";\n\n\nvar $e5d3e25384a15a7d$exports = {};\n\n$e5d3e25384a15a7d$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"traps.57e309f4.txt\";\n\n\nvar $3fa8da015b3ced9d$exports = {};\n\n$3fa8da015b3ced9d$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"plants.4dd5938e.txt\";\n\n\nvar $ac6220174f427a19$exports = {};\n\n$ac6220174f427a19$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"portals.7bb576d2.txt\";\n\n\nvar $5ace0b636c6742b7$exports = {};\n\n$5ace0b636c6742b7$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"dungeon-completed.6e49dc4f.md\";\n\n\nvar $66b5f503d95640f1$exports = {};\n\n$66b5f503d95640f1$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"dungeon_script.34f994bb.txt\";\n\n\nvar $5516e1e778d22f49$exports = {};\n\n$5516e1e778d22f49$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"dungeon-welcome.832f01e2.md\";\n\n\nvar $5cdcac5d848181d6$exports = {};\n\n$5cdcac5d848181d6$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"dungeon-welcome-casual.d4a9c126.md\";\n\n\nvar $338ffdf8742c1f6d$exports = {};\n\n$338ffdf8742c1f6d$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"help.87da7d72.md\";\n\n\nvar $fddd64966a57c95a$exports = {};\n\n$fddd64966a57c95a$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"do-alto-do-trono-da-desolacao-trimmed.18cbfbbb.mp3\";\n\n\nvar $ec2dd53d90da22db$exports = {};\n\n$ec2dd53d90da22db$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"privacy.7ffe5882.md\";\n\n\nvar $a20ffeb5ab13c768$exports = {};\n\n$a20ffeb5ab13c768$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"startupTips.1c63a486.md\";\n\n\nvar $4dd02297961bb41c$exports = {};\n\n$4dd02297961bb41c$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"quickStart.761d94a5.md\";\n\n\nvar $b3adf99d440c8ee3$exports = {};\n\n$b3adf99d440c8ee3$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"punch-trimmed.d5ee82fe.mp3\";\n\n\nvar $ba00409886f2510e$exports = {};\n\n$ba00409886f2510e$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"punch-trimmed-double.7756f095.mp3\";\n\n\nvar $7fb36697ad94c646$exports = {};\n\n$7fb36697ad94c646$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"long-medium-swish-trimmed.69cad07b.mp3\";\n\n\nvar $9199aa49f8197197$exports = {};\n\n$9199aa49f8197197$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"bubbling-trimmed.361718fa.mp3\";\n\n\nvar $11193d19f4bf8c94$exports = {};\n\n$11193d19f4bf8c94$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"male-hurt-sound-trimmed.76fa38ed.mp3\";\n\n\nvar $eaba73c9dc9a0837$exports = {};\n\n$eaba73c9dc9a0837$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"pig-oink-47167.4d796935.mp3\";\n\n\nvar $6f219908ff4df928$exports = {};\n\n$6f219908ff4df928$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"squeal-thing-103111.d7f21093.mp3\";\n\n\nvar $aeeaca21509f249d$exports = {};\n\n$aeeaca21509f249d$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"zombie-6851_derived.1619a046.mp3\";\n\n\nvar $19935fe2d37942a0$exports = {};\n\n$19935fe2d37942a0$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"metal-blade-slice-32-195321.f9effd4c.mp3\";\n\n\nvar $d6694d143d02c676$exports = {};\n\n$d6694d143d02c676$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"spell_chant.49e88815.mp3\";\n\n\nvar $d66938ef515a4789$exports = {};\n\n$d66938ef515a4789$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"door-43633_trimmed_exit.f51c6df4.mp3\";\n\n\nvar $74d39ee2601cbed2$exports = {};\n\n$74d39ee2601cbed2$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"door-43633_trimmed_enter.7b3b8ba7.mp3\";\n\n\nvar $f99d789ddad1509e$exports = {};\n\n$f99d789ddad1509e$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"sci-fi-portal-83746-trimmed.d1598f9a.mp3\";\n\n\nvar $b43e391b1487f933$exports = {};\n\n$b43e391b1487f933$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"click-and-crawl.10b21974.png\";\n\n\nconst $a4c3b9ba384fa621$export$54b43579d6cb0cf2 = {\n    ABOUT_MD: new URL($e930bf3cf7113404$exports),\n    ALMANAC_MAP: new Map([\n        [\n            \"ARMOUR\",\n            new URL($de81d41e34f30975$exports)\n        ],\n        [\n            \"ARTEFACTS\",\n            new URL($62c3d80d1fa7bce4$exports)\n        ],\n        [\n            \"MAGIC\",\n            new URL($9747fa697e881e78$exports)\n        ],\n        [\n            \"ENEMIES\",\n            new URL($7ad4ee7b5c11248a$exports)\n        ],\n        [\n            \"HEROES\",\n            new URL($5576e8927572aaec$exports)\n        ],\n        [\n            \"MONEY\",\n            new URL($278bd977bbb3b534$exports)\n        ],\n        [\n            \"TRADERS\",\n            new URL($25e8874d301378f7$exports)\n        ],\n        [\n            \"WEAPONS\",\n            new URL($bc21e390b0fbed77$exports)\n        ],\n        [\n            \"KEYS\",\n            new URL($d33c974414460e80$exports)\n        ],\n        [\n            \"TRAPS\",\n            new URL($e5d3e25384a15a7d$exports)\n        ],\n        [\n            \"PLANTS\",\n            new URL($3fa8da015b3ced9d$exports)\n        ],\n        [\n            \"PORTALS\",\n            new URL($ac6220174f427a19$exports)\n        ]\n    ]),\n    DUNGEON_COMPLETE: new URL($5ace0b636c6742b7$exports),\n    DUNGEON_SCRIPT: new URL($66b5f503d95640f1$exports),\n    DUNGEON_WELCOME: new URL($5516e1e778d22f49$exports),\n    DUNGEON_WELCOME_CASUAL: new URL($5cdcac5d848181d6$exports),\n    HELP_MD: new URL($338ffdf8742c1f6d$exports),\n    MUSIC: new URL($fddd64966a57c95a$exports),\n    PRIVACY_MD: new URL($ec2dd53d90da22db$exports),\n    STARTUP_TIPS_MD: new URL($a20ffeb5ab13c768$exports),\n    QUICK_START_MD: new URL($4dd02297961bb41c$exports),\n    SOUND_EFFECTS_MAP: new Map([\n        [\n            \"PUNCH\",\n            new URL($b3adf99d440c8ee3$exports)\n        ],\n        [\n            \"DOUBLE PUNCH\",\n            new URL($ba00409886f2510e$exports)\n        ],\n        [\n            \"MISS\",\n            new URL($7fb36697ad94c646$exports)\n        ],\n        [\n            \"POISONED\",\n            new URL($9199aa49f8197197$exports)\n        ],\n        [\n            \"DIE\",\n            new URL($11193d19f4bf8c94$exports)\n        ],\n        [\n            \"DIE_MONSTER\",\n            new URL($eaba73c9dc9a0837$exports)\n        ],\n        [\n            \"DIE_MONSTER_SMALL\",\n            new URL($6f219908ff4df928$exports)\n        ],\n        [\n            \"DIE_MONSTER_UNDEAD\",\n            new URL($aeeaca21509f249d$exports)\n        ],\n        [\n            \"TRIGGER TRAP\",\n            new URL($19935fe2d37942a0$exports)\n        ],\n        [\n            \"SPELL_CHANT\",\n            new URL($d6694d143d02c676$exports)\n        ],\n        [\n            \"DOOR_EXIT\",\n            new URL($d66938ef515a4789$exports)\n        ],\n        [\n            \"DOOR_ENTER\",\n            new URL($74d39ee2601cbed2$exports)\n        ],\n        [\n            \"PORTAL\",\n            new URL($f99d789ddad1509e$exports)\n        ]\n    ]),\n    SPLASH_IMAGE: new URL($b43e391b1487f933$exports)\n};\nvar $fad5984ad571e100$exports = {};\n\n$fad5984ad571e100$exports = (parcelRequire(\"5waPY\")).getBundleURL(\"9veYn\") + \"dungeon.f859c4d9.png\";\n\n\nconst $a4c3b9ba384fa621$export$bd73ddfe5f8475d8 = {\n    data: (0, (/*@__PURE__*/$parcel$interopDefault($ab02f2464c9ae977$exports))),\n    textureUrl: new URL($fad5984ad571e100$exports)\n};\n\n\n/**\n * Automatically created version file. Do not edit!\n */ const $a874257a1a34ac31$export$a4ad2735b021c132 = {\n    build: \"1.0.0-beta+seo0ak\",\n    date: \"2024-06-06\",\n    copyright: \"\\xa9 2024 Steve Butler\"\n};\n\n\nfunction $821757827816346b$export$ef24b48d1bf77082() {\n    const about = new (0, $58ea3f4a4bcc116e$export$3e9165d18613c27e)({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON ABOUT`,\n        action: ()=>$821757827816346b$export$8bd46d86307c9a41((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).ABOUT_MD)\n    });\n    const help = new (0, $58ea3f4a4bcc116e$export$3e9165d18613c27e)({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON HELP`,\n        action: ()=>$821757827816346b$export$8bd46d86307c9a41((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).HELP_MD)\n    });\n    const privacy = new (0, $58ea3f4a4bcc116e$export$3e9165d18613c27e)({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON PRIVACY`,\n        action: ()=>$821757827816346b$export$8bd46d86307c9a41((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).PRIVACY_MD)\n    });\n    return $821757827816346b$export$8bd46d86307c9a41((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).QUICK_START_MD, {\n        actionButtons: [\n            help,\n            about,\n            privacy\n        ]\n    });\n}\nfunction $821757827816346b$export$8bd46d86307c9a41(url, options = {}) {\n    return (0, $4f6b2ca1724556cd$export$fa2f0f26e19d189b)(url).then((markdown)=>{\n        let html;\n        let text;\n        if (markdown) html = (0, $75e9abed2bf14854$export$bd6a2eae5de02ff5)(markdown);\n        else text = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CANNOT LOAD URL ${url.toString()}`;\n        html = html.replace(/\\$\\{VERSION\\}/g, `${(0, $a874257a1a34ac31$export$a4ad2735b021c132).build} ${(0, $a874257a1a34ac31$export$a4ad2735b021c132).date}`).replace(/\\$\\{COPYRIGHT\\}/g, `${(0, $a874257a1a34ac31$export$a4ad2735b021c132).copyright}`);\n        const container = (0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"div\", {\n            className: \"parsed-markdown\",\n            text: text,\n            html: html\n        });\n        return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container, {\n            actionButtons: options.actionButtons,\n            row: true,\n            okButtonLabel: options.okButtonLabel\n        });\n    });\n}\n\n\nfunction $a1eb2cc493356a27$export$7e05f8bc47a87cf8(continuation) {\n    const playAdventure = new (0, $58ea3f4a4bcc116e$export$5519a977876d156d)({\n        leftLabel: continuation ? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE ADVENTURE` : (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON PLAY ADVENTURE`,\n        imageName: \"ui-play00.png\",\n        internalLabel: true,\n        closes: \"PLAY ADVENTURE\"\n    });\n    const playCasual = new (0, $58ea3f4a4bcc116e$export$5519a977876d156d)({\n        leftLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON PLAY CASUAL`,\n        imageName: \"ui-play00.png\",\n        internalLabel: true,\n        closes: \"PLAY CASUAL\"\n    });\n    const settings = new (0, $58ea3f4a4bcc116e$export$5519a977876d156d)({\n        leftLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON SETTINGS`,\n        imageName: \"ui-settings00.png\",\n        internalLabel: true,\n        action: ()=>(0, $09b31fa5c65d5acd$export$7da80b63b5cb0fd0)()\n    });\n    const bestAdventure = new (0, $58ea3f4a4bcc116e$export$5519a977876d156d)({\n        leftLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON HALL OF FAME`,\n        imageName: \"ui-hall-of-fame00.png\",\n        internalLabel: true,\n        action: ()=>(0, $2f0424278e098787$export$c17614412cc5a163)()\n    });\n    const guides = new (0, $58ea3f4a4bcc116e$export$5519a977876d156d)({\n        leftLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON GUIDES`,\n        imageName: \"ui-guides00.png\",\n        internalLabel: true,\n        action: ()=>(0, $821757827816346b$export$ef24b48d1bf77082)()\n    });\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MENU TITLE MAIN`, {\n        actionButtons: [\n            guides,\n            settings,\n            bestAdventure,\n            playAdventure,\n            playCasual\n        ],\n        className: \"door\"\n    });\n}\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * @file Dialogs for opening an exit.\n *\n * @module dialogs/openExitDialogs\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\nfunction $0901ee0d2d0e236f$export$12257a9a333b6f47(actor, key) {\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showChoiceDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE LOCKED`, (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE EXIT LOCKED`, [\n        (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON TRY TO PICK`,\n        (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON LEAVE IT`\n    ]).then((choice)=>choice === 0 ? $0901ee0d2d0e236f$var$tryToPickLock(actor, key) : false);\n}\n/**\n * Try to pick a lock\n * @param {module:players/actors.Actor} actor\n * @param {module:players/artefacts.Artefact} key\n * @returns {Promise<boolean>} fulfils to true if picked.\n */ function $0901ee0d2d0e236f$var$tryToPickLock(actor, key) {\n    if (!actor.storeManager.hasArtefactWithSameId(\"lock_pick\")) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE NEED LOCK PICK`).then(()=>false);\n    if ($930b66d99210d21f$export$83de0ce3f692f041(actor.traits, key.traits)) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE YOU PICK THE LOCK`).then(()=>true);\n    else return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE YOU FAIL TO PICK THE LOCK`).then(()=>false);\n}\n\n\n/**\n * @file Dialog with rune puzzle.\n *\n * @module dialogs/runeQuestionDialog\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @file Sequence generator for puzzles involving pattern matching.\n *\n * @module dnd\\sequenceGenerator\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ /**\n * Create a logical sequence of characters.\n * @param {Object} options\n * @param {string} [runes = 'ABCD'] - characters used for sequencing\n * @param {number} [repetitions] - number of repetitions. Min is 4.\n * @param {number} [sequences = 1] - number of interleaved sequences\n * @param {number[]} [sequenceOffsets = [1]] - offset per sequence. If array length is shorter\n * than the number of sequences, the last entry is used\n * @param {number} [startOffset = 0] - offset at start\n * @param {number} [nextLength = 1] - length of next characters in sequence\n * @returns {<sequence:string, next:string}\n */ function $cb2bde7968ffd8c2$export$37e136f84782bffd(options = {}) {\n    const runes = options.runes ?? \"ABCD\";\n    const sequences = options.sequences ?? 1;\n    const repetitions = Math.max(options.repetitions ?? 0, 4);\n    const sequenceOffsets = options.sequenceOffsets ?? [\n        1\n    ];\n    const startOffset = options.startOffset ?? 0;\n    let nextLength = options.nextLength ?? 1;\n    nextLength = Math.min((repetitions - 3) * sequences, nextLength);\n    let result = \"\";\n    for(let rep = 0; rep < repetitions; rep++)for(let sequence = 0; sequence < sequences; sequence++){\n        let sequenceOffset;\n        if (sequence < sequenceOffsets.length) sequenceOffset = sequenceOffsets[sequence];\n        else sequenceOffset = sequenceOffsets[sequenceOffsets.length - 1];\n        const offset = startOffset + sequenceOffset * (1 + rep);\n        result += $cb2bde7968ffd8c2$var$getRune(runes, offset);\n    }\n    return {\n        sequence: result.substring(0, result.length - nextLength),\n        next: result.substring(result.length - nextLength)\n    };\n}\n/**\n * Get the rune at the offset. The offset wraps if greater\n * than the length of runes.\n * @param {string} runes\n * @param {number} offset\n * @returns {string} the character\n */ function $cb2bde7968ffd8c2$var$getRune(runes, offset) {\n    return runes.charAt(offset % runes.length);\n}\n\n\n\n\n\n/** @type {string} */ const $97137e829c6605e7$var$RUNES = \"\\u16A0\\u16A2\\u16A6\\u16A8\\u16B1\\u16B2\\u16B7\\u16B9\\u16BA\\u16BE\\u16C1\\u16C3\\u16C7\\u16C8\\u16C9\\u16CA\\u16CF\\u16D2\\u16D6\\u16D7\\u16DA\\u16DC\\u16DE\\u16DF\";\nfunction $97137e829c6605e7$export$a2b7eb05f7b8eccf(currentSceneLevel) {\n    const options = $97137e829c6605e7$var$createSequenceOptions(currentSceneLevel);\n    const sequence = (0, $cb2bde7968ffd8c2$export$37e136f84782bffd)(options);\n    const correct = sequence.next;\n    const incorrect = $97137e829c6605e7$var$createIncorrectSequence(correct, options.runes);\n    if (incorrect === correct) return Promise.resolve(true); // just assume successful answer.\n    const container = (0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"div\");\n    container.appendChild((0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"p\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE RUNES ON WALL`\n    }));\n    container.appendChild((0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"p\", {\n        className: \"runes\",\n        text: `${options.runes} ${sequence.sequence}`\n    }));\n    container.appendChild((0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"p\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE RUNES OVER DOORS`\n    }));\n    const goodIndex = $95fc563048a48bb6$export$b141de964f0a90c1(0, 1);\n    const badIndex = 1 - goodIndex;\n    const choices = [\n        \"\",\n        \"\"\n    ];\n    choices[goodIndex] = correct;\n    choices[badIndex] = incorrect;\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showChoiceDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE RUNE PUZZLE`, container, choices, \"rune-puzzle\").then((choice)=>choice === goodIndex);\n}\n/**\n *\n * @param {number} currentSceneLevel\n * @returns {Object} options for createSequence.\n */ function $97137e829c6605e7$var$createSequenceOptions(currentSceneLevel) {\n    const minRunes = 4;\n    const maxRunes = 15;\n    const maxSequences = 4;\n    const sequences = $95fc563048a48bb6$export$75c671db1a13cf5f(1, Math.min(maxSequences, 1 + currentSceneLevel));\n    const nRunes = $95fc563048a48bb6$export$75c671db1a13cf5f(minRunes, Math.min(minRunes + currentSceneLevel, maxRunes));\n    const runesStart = $95fc563048a48bb6$export$b141de964f0a90c1(0, $97137e829c6605e7$var$RUNES.length - nRunes);\n    const runes = $97137e829c6605e7$var$RUNES.substring(runesStart, runesStart + nRunes);\n    const offsets = [];\n    for(let seq = 0; seq < nRunes; seq++)offsets.push($95fc563048a48bb6$export$75c671db1a13cf5f(1, nRunes));\n    return {\n        runes: runes,\n        repetitions: 4 + currentSceneLevel,\n        sequences: sequences,\n        sequenceOffsets: offsets,\n        startOffset: $95fc563048a48bb6$export$75c671db1a13cf5f(0, nRunes),\n        nextLength: $95fc563048a48bb6$export$75c671db1a13cf5f(2, 5)\n    };\n}\n/**\n * Create a wrong sequence based on the correct sequence\n * @param {string} correct\n * @param {string} runes\n * @returns {string} incorrect\n */ function $97137e829c6605e7$var$createIncorrectSequence(correct, runes) {\n    const letters = correct.split(\"\");\n    const changedIndex = $95fc563048a48bb6$export$b141de964f0a90c1(0, letters.length);\n    for(let index = 0; index < runes.length; index++){\n        const substitute = runes.charAt(index);\n        if (substitute !== letters[changedIndex]) {\n            letters[changedIndex] = substitute;\n            break; // now incorrect\n        }\n    }\n    return letters.join(\"\");\n}\n\n\n/**\n * @file Automatic scene generator\n *\n * @module scriptReaders/autoSceneList\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n\n/**\n * @file Random room generator\n *\n * @module utils/tileMaps/roomGenerator\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\nclass $0d952fff85f71606$export$46f5471185d8bc9e {\n    #maxCols;\n    #maxRows;\n    #maxRoomCols;\n    #maxRoomRows;\n    #dungeon;\n    /**\n   *\n   * @param {Object} options\n   * @param {number} options.minCols\n   * @param {number} options.minRows\n   * @param {number} options.maxCols\n   * @param {number} options.maxRows\n   * @param {number} options.maxRoomWidth\n   * @param {number} options.maxRoomHeight\n   */ constructor(options){\n        this.#maxCols = $95fc563048a48bb6$export$75c671db1a13cf5f(options.minCols, options.maxCols);\n        this.#maxRows = $95fc563048a48bb6$export$75c671db1a13cf5f(options.minRows, options.maxRows);\n        this.#maxRoomCols = options.maxRoomCols;\n        this.#maxRoomRows = options.maxRoomRows;\n    }\n    /**\n   * Get a random wall char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */ #getWallChr(qty = 1) {\n        let result = \"\";\n        while(qty-- > 0)result += $95fc563048a48bb6$export$a885de3766ef0b4c((0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).WALL);\n        return result;\n    }\n    /**\n   * Get a random ground char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */ #getFloorChr(qty = 1) {\n        let result = \"\";\n        while(qty-- > 0)result += $95fc563048a48bb6$export$a885de3766ef0b4c((0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).GROUND);\n        return result;\n    }\n    /**\n   * Get a random void char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */ #getLandChr(qty = 1) {\n        let result = \"\";\n        while(qty-- > 0)result += $95fc563048a48bb6$export$a885de3766ef0b4c((0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).VOID);\n        return result;\n    }\n    /**\n   * Get a random door in char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */ #getDoorInChr(qty = 1) {\n        let result = \"\";\n        while(qty-- > 0)result += $95fc563048a48bb6$export$a885de3766ef0b4c((0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).DOOR_IN);\n        return result;\n    }\n    /**\n   * Get a random door out char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */ #getDoorOutChr(qty = 1) {\n        let result = \"\";\n        while(qty-- > 0)result += $95fc563048a48bb6$export$a885de3766ef0b4c((0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).DOOR_OUT);\n        return result;\n    }\n    /** Test is a wall char.\n   * @param {string} char\n   * @returns {boolean}\n   */ #isWallChr(chr) {\n        return (0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).WALL.includes(chr);\n    }\n    /** Test is a floor character.\n   * @param {string} char\n   * @returns {boolean}\n   */ #isFloorChr(chr) {\n        return (0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).GROUND.includes(chr);\n    }\n    /** Test is a land character.\n   * @param {string} char\n   * @returns {boolean}\n   */ #isLandChr(chr) {\n        return (0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).VOID.includes(chr);\n    }\n    /** Test is a entrance character.\n   * @param {string} char\n   * @returns {boolean}\n   */ #isDoorInChr(chr) {\n        return (0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).DOOR_IN.includes(chr);\n    }\n    /** Test is a exit character.\n   * @param {string} char\n   * @returns {boolean}\n   */ #isDoorOutChr(chr) {\n        return (0, $87eafdba0a48c3b2$export$1b3c5bcd5a8a9304).DOOR_OUT.includes(chr);\n    }\n    /**\n   * Generate a room.\n   * @returns {String[]}\n   */ generate() {\n        const minRoomCols = 4;\n        const minRoomRows = 4;\n        this.#dungeon = [];\n        let lastLeftLandCols = 0;\n        let lastRoomCols = this.#maxCols;\n        while(this.#dungeon.length < this.#maxRows - minRoomRows){\n            const maxLeftLand = lastLeftLandCols + lastRoomCols - minRoomCols - 2;\n            const leftLandCols = maxLeftLand > 0 ? $95fc563048a48bb6$export$b141de964f0a90c1(0, maxLeftLand) : 0;\n            const reqdMinRoomWidth = Math.max(lastLeftLandCols - leftLandCols + minRoomCols, minRoomCols);\n            let reqdMaxRoomWidth = Math.min(this.#maxRoomCols, this.#maxCols - leftLandCols);\n            const roomCols = reqdMaxRoomWidth > reqdMinRoomWidth ? $95fc563048a48bb6$export$b141de964f0a90c1(reqdMinRoomWidth, reqdMaxRoomWidth) : reqdMinRoomWidth;\n            const rightLandCols = this.#maxCols - leftLandCols - roomCols;\n            const maxHeight = Math.min(this.#maxRoomRows, this.#maxRows - this.#dungeon.length);\n            const roomRows = $95fc563048a48bb6$export$b141de964f0a90c1(minRoomRows, maxHeight);\n            this.#createRoom(leftLandCols, roomCols, rightLandCols, roomRows);\n            lastLeftLandCols = leftLandCols;\n            lastRoomCols = roomCols;\n        }\n        this.#removeInternalWalls();\n        this.#locateDoors();\n        return this.getMatrixAsStrings();\n    }\n    /**\n   * Convert matrix to a plan design.\n   * @returns {string[]}\n   */ getMatrixAsStrings() {\n        return this.#dungeon.map((columns)=>columns.join(\"\"));\n    }\n    /**\n   *\n   * @param {number} leftLandCols\n   * @param {number} roomCols\n   * @param {number} rightLandCols\n   * @param {number} numberOfRows\n   */ #createRoom(leftLandCols, roomCols, rightLandCols, numberOfRows) {\n        let columns = \"\";\n        columns += this.#getLandChr(leftLandCols);\n        columns += this.#getWallChr(roomCols);\n        columns += this.#getLandChr(rightLandCols);\n        this.#dungeon.push(columns.split(\"\"));\n        for(let internalRow = 0; internalRow < numberOfRows - 2; internalRow++){\n            columns = \"\";\n            columns += this.#getLandChr(leftLandCols);\n            columns += this.#getWallChr(1);\n            columns += this.#getFloorChr(roomCols - 2);\n            columns += this.#getWallChr(1);\n            columns += this.#getLandChr(rightLandCols);\n            this.#dungeon.push(columns.split(\"\"));\n        }\n        columns = \"\";\n        columns += this.#getLandChr(leftLandCols);\n        columns += this.#getWallChr(roomCols);\n        columns += this.#getLandChr(rightLandCols);\n        this.#dungeon.push(columns.split(\"\"));\n    }\n    /** Go through the dungeon removing internal walls. */ #removeInternalWalls() {\n        for(let row = 1; row < this.#dungeon.length - 1; row++){\n            for(let col = 1; col < this.#dungeon[0].length - 2; col++)if (this.#isWallChr(this.#dungeon[row][col]) && this.#isWallChr(this.#dungeon[row + 1][col]) && this.#isFloorChr(this.#dungeon[row - 1][col]) && this.#isFloorChr(this.#dungeon[row + 2][col])) {\n                this.#dungeon[row][col] = this.#getFloorChr(1);\n                this.#dungeon[row + 1][col] = this.#getFloorChr(1);\n            }\n        }\n    }\n    /**\n   * Is this a vertical wall where a door could go.\n   * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n   * @returns {boolean}\n   */ #isVerticalWall(surrounds) {\n        return this.#isWallChr(surrounds.above) && this.#isWallChr(surrounds.centre) && this.#isWallChr(surrounds.below);\n    }\n    /**\n   * Is this a Horizontal wall where a door could go.\n   * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n   * @returns {boolean}\n   */ #isHorizontalWall(surrounds) {\n        return this.#isWallChr(surrounds.left) && this.#isWallChr(surrounds.centre) && this.#isWallChr(surrounds.right);\n    }\n    /**\n   * Position the doors.\n   */ #locateDoors() {\n        const possibleLocations = [];\n        this.#dungeon.forEach((rowValue, rowIndex)=>rowValue.forEach((colValue, colIndex)=>{\n                const surrounds = $d9c69096b805bafd$export$7c548b14ef6e7713(this.#dungeon, rowIndex, colIndex);\n                if (this.#isHorizontalWall(surrounds) || this.#isVerticalWall(surrounds)) possibleLocations.push({\n                    row: rowIndex,\n                    col: colIndex\n                });\n            }));\n        const randomLocations = $d9c69096b805bafd$export$f3448602f079b6d0(possibleLocations);\n        let location = randomLocations[0];\n        this.#dungeon[location.row][location.col] = this.#getDoorInChr();\n        location = randomLocations[1];\n        this.#dungeon[location.row][location.col] = this.#getDoorOutChr();\n    }\n}\n\n\n\n\n\n\n/**\n * @file Class for building a debug actor\n *\n * @module dnd/almanacs/debugBuilder\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n\n\nconst $17f6c6e2292a8d96$var$GANDALPH = \"0,COMMON,HERO,wizard1 [chain_mail_armour,iron_rations, iron_rations, iron_rations, waterskin, waterskin, waterskin,copper_coins] * NAME:Gandalph,CLASS:WIZARD,HIT_DICE:1D8,EXP:0, AC:10,_SPEED:30 FEET\";\nfunction $17f6c6e2292a8d96$export$4ec414657ab8cb27() {\n    if (window.location.hostname !== \"localhost\") return;\n    const searchParams = new URLSearchParams(window.location.search);\n    const enemyId = searchParams.get(\"ENEMY\");\n    if (enemyId) {\n        const actors = $ecf189a3ccc267f7$export$62947dea9802b3b0.getAlmanac(\"ENEMIES\");\n        return actors?.find((entry)=>entry.id === enemyId);\n    } else return;\n}\nfunction $17f6c6e2292a8d96$export$972f3a0264a03812() {\n    if (window.location.hostname !== \"localhost\") return;\n    const searchParams = new URLSearchParams(window.location.search);\n    const heroId = searchParams.get(\"HERO\");\n    if (!heroId) return;\n    let hero;\n    let hasAllMagic = false;\n    if (heroId.toUpperCase() === \"GANDALPH\") {\n        const almanacEntry = $ecf189a3ccc267f7$export$1943ae6675bfce8b($17f6c6e2292a8d96$var$GANDALPH, \"HEROES\");\n        hero = (0, $d8cd23d1a2971b65$export$260a0189ba712b47)(almanacEntry);\n        hasAllMagic = true;\n    } else {\n        hero = $17f6c6e2292a8d96$var$buildActorFromAlmanac(\"HEROES\", heroId);\n        if (!hero) return;\n    }\n    const equipSpells = searchParams.get(\"equipSpells\") !== null;\n    const stashSpells = searchParams.get(\"stashSpells\") !== null;\n    if (equipSpells || stashSpells) {\n        const magic = $ecf189a3ccc267f7$export$62947dea9802b3b0.getAlmanac(\"MAGIC\");\n        $17f6c6e2292a8d96$var$addAllMagicToHero(hero, magic.common, equipSpells, hasAllMagic);\n        $17f6c6e2292a8d96$var$addAllMagicToHero(hero, magic.uncommon, equipSpells, hasAllMagic);\n        $17f6c6e2292a8d96$var$addAllMagicToHero(hero, magic.rare, equipSpells, hasAllMagic);\n        $17f6c6e2292a8d96$var$addAllMagicToHero(hero, magic.veryRare, equipSpells, hasAllMagic);\n    }\n    // Give hero an artefact defined in the search params..\n    for (const key of [\n        \"ARMOUR\",\n        \"ARTEFACTS\",\n        \"PLANTS\",\n        \"WEAPONS\"\n    ])$17f6c6e2292a8d96$var$addToBackpack(hero, key, searchParams.get(key));\n    return hero;\n}\n/**\n * Build actor from almanac.\n * @param {string} almanacKey\n * @param {string} actorId\n * @returns {module:players/actors.Actor}\n */ function $17f6c6e2292a8d96$var$buildActorFromAlmanac(almanacKey, actorId) {\n    const actors = $ecf189a3ccc267f7$export$62947dea9802b3b0.getAlmanac(almanacKey);\n    const almanacEntry = actors?.find((entry)=>entry.id === actorId);\n    if (!almanacEntry) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Cannot find actor ${actorId} in ${almanacKey} almanac, so ignoring.`);\n        return;\n    }\n    const actor = (0, $d8cd23d1a2971b65$export$260a0189ba712b47)(almanacEntry);\n    if (!actor) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Cannot build actor ${actorId} in ${almanacKey} almanac, so ignoring.`);\n        return;\n    }\n    return actor;\n}\n/**\n *\n * @param {module:players/actors.Actor} hero\n * @param {module:dnd/almanacs/almanacs.AlmanacEntry[]} entries\n * @param {boolean} equipSpells - if true, spells don't need to be prepared.\n * @param {boolean} allMagic - if true, the hero gets everything even if they are the wrong caster\n */ function $17f6c6e2292a8d96$var$addAllMagicToHero(hero, entries, equipSpells, allMagic) {\n    for (const entry of entries){\n        const traits = new (0, $b7c201230645b878$export$f0f803f528a8d270)(entry.traitsString);\n        if (allMagic || traits.get(\"CASTERS\", \"\").indexOf(hero.traits.get(\"CLASS\", \"\")) >= 0) {\n            const magic = (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(entry);\n            if (entry.typeId === \"CANTRIP\" || equipSpells) hero.storeManager.equip(magic, {\n                direct: true\n            });\n            else hero.storeManager.stash(magic, {\n                direct: true\n            });\n        }\n    }\n}\n/**\n * Add item to hero's backpack (i.e. stash)\n * @param {module:players/actors.Actor} hero\n * @param {string} key - almanac key\n * @param {string} itemId - id of the item\n */ function $17f6c6e2292a8d96$var$addToBackpack(hero, key, itemId) {\n    if (!itemId) return;\n    const items = $ecf189a3ccc267f7$export$62947dea9802b3b0.getAlmanac(key);\n    const entry = items?.find((entry)=>entry.id === itemId);\n    if (!entry) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Could not find ${itemId} in ${key} almanac. Ignoring.`);\n        return;\n    }\n    const item = (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(entry);\n    hero.storeManager.stash(item, {\n        direct: true\n    });\n}\n\n\n/** @type {module:players/actors~Actor} */ let $94049cc5d4f81fad$var$heroActor;\nconst $94049cc5d4f81fad$export$baa1f113a47bd01a = {\n    INSIGNIFICANT: 1 / 64,\n    EASY: 3 / 16,\n    MEDIUM: 1 / 4\n};\n/**\n * Get the maximum challenge rating for an enemy encountered in the scene\n * @param {DungeonChallengeValue} challenge\n */ function $94049cc5d4f81fad$var$getMaxEnemyCr(challenge) {\n    const level = $94049cc5d4f81fad$var$heroActor?.traits.getCharacterLevel() ?? 1;\n    return challenge * level + 0.001; // prevent float issues.\n}\n/**\n * Create a pool of enemies based on the dungeon rating.\n * @param {DungeonChallengeValue} dungeonRating\n * @param {number} minLevel\n * @returns {module:almanacs/almanacs~Almanac}\n */ function $94049cc5d4f81fad$var$createEnemyPoolAlmanac(dungeonRating, minLevel) {\n    const maxMonsterChallenge = $94049cc5d4f81fad$var$getMaxEnemyCr(dungeonRating);\n    return (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).getAlmanac(\"ENEMIES\").filter((entry)=>entry.challengeRating <= maxMonsterChallenge && entry.minLevel <= minLevel);\n}\n/**\n * @implements {module:gameManagement/sceneManager~SceneList}\n */ class $94049cc5d4f81fad$var$AutoSceneList {\n    /** @type {number} */ #index;\n    /** @type {SceneDefinition} */ #sceneDefn;\n    /** @type {DungeonChallenge} */ #dungeonChallenge;\n    /**\n   */ constructor(){\n        this.reset();\n    }\n    /**\n   * @param {DungeonChallengeValue} dungeonChallenge\n   */ setChallenge(dungeonChallenge) {\n        this.#dungeonChallenge = dungeonChallenge;\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Dungeon challenge rating set to ${dungeonChallenge}`);\n    }\n    /**\n   * @returns {number}\n   */ getIndex() {\n        return this.#index;\n    }\n    /**\n   * Get the next scene.\n   * @returns {SceneDefinition}\n   */ getNext() {\n        this.#index++;\n        if (this.#index === 0) $94049cc5d4f81fad$var$heroActor = null; // always a new actor at level 0\n        this.#buildScene();\n        return this.#sceneDefn;\n    }\n    /**\n   * Test to see if there is another scene.\n   * @returns {boolean}\n   */ hasNext() {\n        return true;\n    }\n    /**\n   * Reset\n   */ reset() {\n        this.#dungeonChallenge = $94049cc5d4f81fad$export$baa1f113a47bd01a.MEDIUM;\n        this.#index = -1;\n    }\n    /**\n   * Restore a saved game. Game are saved when a dungeon is exited so the call should\n   * be to the next scene.\n   * @param {number} index\n   * @param {module:players/actors.Actor} hero\n   */ restore(index, hero) {\n        $94049cc5d4f81fad$var$heroActor = hero;\n        this.#index = index;\n    }\n    /** Build a scene */ #buildScene() {\n        this.#sceneDefn = new (0, $cd2e32752119e7f3$export$2a8e6ebcf5b5c91)();\n        this.#setHero();\n        this.#addIntro();\n        this.#addEnemies(this.#dungeonChallenge);\n        this.#addTraders();\n        this.#addArtefacts();\n        this.#addMap();\n        if ($a4035ea4d528e431$export$b9d1fef74bbc4c0c(20) > 13) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Adding a portal.\");\n            this.#addPortal();\n        }\n    }\n    /**\n   * Add scene introduction.\n   */ #addIntro() {\n        this.#sceneDefn.intro = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE ENTER FLOOR ${(0, $125f5f2e3c48ca5e$export$cc5edb2b1b75cf3d)(this.#index)}`;\n    }\n    /**\n   * Add hero to scene.\n   */ #setHero() {\n        if (!$94049cc5d4f81fad$var$heroActor) $94049cc5d4f81fad$var$heroActor = (0, $17f6c6e2292a8d96$export$972f3a0264a03812)();\n        if (!$94049cc5d4f81fad$var$heroActor) {\n            const almanacEntry = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).getRandomEntry(\"HEROES\");\n            if (!almanacEntry) (0, $733fb161db426370$export$2e2bcd8739ae039).fatal(new Error(`Could not find hero in almanacs.`));\n            $94049cc5d4f81fad$var$heroActor = (0, $d8cd23d1a2971b65$export$260a0189ba712b47)(almanacEntry);\n        }\n        this.#sceneDefn.hero = $94049cc5d4f81fad$var$heroActor;\n    }\n    /**\n   * Add enemies to scene.\n   * @param {DungeonChallengeValue} [challenge = DungeonChallenge.MEDIUM]\n   */ #addEnemies(challenge = $94049cc5d4f81fad$export$baa1f113a47bd01a.MEDIUM) {\n        const debugEnemy = (0, $17f6c6e2292a8d96$export$4ec414657ab8cb27)();\n        if (debugEnemy) {\n            this.#sceneDefn.enemies.push(debugEnemy);\n            return;\n        }\n        const maxEnemyCr = $94049cc5d4f81fad$var$getMaxEnemyCr(challenge);\n        let maxEnemies;\n        let maxTotalChallenge;\n        switch(challenge){\n            case $94049cc5d4f81fad$export$baa1f113a47bd01a.EASY:\n                maxEnemies = 6;\n                maxTotalChallenge = maxEnemyCr;\n                break;\n            case $94049cc5d4f81fad$export$baa1f113a47bd01a.MEDIUM:\n            default:\n                maxEnemies = 8;\n                maxTotalChallenge = maxEnemyCr * 1.25;\n                break;\n        }\n        const enemyPoolAlmanac = $94049cc5d4f81fad$var$createEnemyPoolAlmanac(challenge, this.#index);\n        let totalChallenge = 0;\n        let totalEnemies = 0;\n        while(totalChallenge < maxTotalChallenge && totalEnemies < maxEnemies){\n            const enemy = enemyPoolAlmanac.getRandomEntry();\n            totalChallenge += Math.max(enemy.challengeRating, $94049cc5d4f81fad$export$baa1f113a47bd01a.INSIGNIFICANT);\n            totalEnemies++;\n            this.#sceneDefn.enemies.push(enemy);\n        }\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Scene challenge rating ${totalChallenge.toFixed(3)} from ${totalEnemies} enemies.`);\n    }\n    /**\n   * Add enemies to scene.\n   */ #addTraders() {\n        const totalTraders = 1;\n        for(let traderIndex = 0; traderIndex < totalTraders; traderIndex++){\n            const almanacEntry = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).getRandomEntry(\"TRADERS\", (entry)=>entry.minLevel <= this.#index);\n            this.#sceneDefn.enemies.push(almanacEntry);\n        }\n    }\n    /**\n   * Add artefacts to scene.\n   */ #addArtefacts() {\n        const pooledAlmanac = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).getPooledAlmanac([\n            \"ARTEFACTS\",\n            \"MAGIC\",\n            \"MONEY\",\n            \"WEAPONS\",\n            \"TRAPS\",\n            \"PLANTS\"\n        ], (entry)=>entry.minLevel <= this.#index);\n        let totalArtefacts = $95fc563048a48bb6$export$75c671db1a13cf5f(4, 12);\n        while(totalArtefacts-- > 0){\n            const almanacEntry = pooledAlmanac.getRandomEntry();\n            if (almanacEntry) this.#sceneDefn.artefacts.push(almanacEntry);\n        }\n    }\n    /**\n   * Add an portal to the scene\n   */ #addPortal() {\n        const almanacEntry = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).getRandomEntry(\"PORTALS\", (entry)=>entry.minLevel <= this.#index);\n        if (almanacEntry) this.#sceneDefn.portal = almanacEntry;\n    }\n    /** Add a random map */ #addMap() {\n        const creator = new (0, $0d952fff85f71606$export$46f5471185d8bc9e)({\n            minCols: 12,\n            maxCols: 40,\n            maxRoomCols: 10,\n            minRows: 12,\n            maxRows: 40,\n            maxRoomRows: 6\n        });\n        this.#sceneDefn.mapDesign = creator.generate();\n    }\n}\nfunction $94049cc5d4f81fad$export$e41f9be9fd588ed(scriptUnused) {\n    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Creating automatic scene list.`);\n    return new $94049cc5d4f81fad$var$AutoSceneList();\n}\n\n\n\n/**\n * @file Prevent multiple identification attempts. This is to make identification\n * turn based.\n *\n * @module gameManagement\\identifyLimiter\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/** @type {boolean} */ let $6993a9a5d7595cd1$var$idCheckAllowed = true;\nfunction $6993a9a5d7595cd1$export$cf5ed8ecc4ec774d() {\n    const allowed = $6993a9a5d7595cd1$var$idCheckAllowed;\n    $6993a9a5d7595cd1$var$idCheckAllowed = false;\n    if (!allowed) (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Identification checks not allowed at present.\");\n    return allowed;\n}\nfunction $6993a9a5d7595cd1$export$6fb3a797494847de() {\n    $6993a9a5d7595cd1$var$idCheckAllowed = true;\n}\n\n\n/**\n * Factor that is multiplied by the maxMovesPerTurn property of an actor to determine\n * if it will bother trying to reach the hero.\n */ const $6e0aaad189039339$var$TOO_MANY_TURNS_TO_REACH = 1.5;\n/**\n * Max number of tiles that the hero can move for it to be allowed as disengagement.\n */ const $6e0aaad189039339$var$MAX_TILES_FOR_DISENGAGEMENT = 2;\n/**\n * Enumeration of supported events\n * @enum {number}\n */ const $6e0aaad189039339$var$EventId = {\n    MAIN_MENU: 0,\n    CLICKED_FREE_GROUND: 1,\n    CLICKED_ENTRANCE: 2,\n    CLICKED_EXIT: 3\n};\n/** Should the game be saved and restored @type {boolean} */ let $6e0aaad189039339$var$persistentGame = true;\n/**\n * Class that allows a simulated movement of an actor. The movement using\n * the route finder takes place immediately, so that the effect of the actor's\n * final position can be used to affect other actors without waiting for the normal\n * duration of the move. The actual motion can then be actioned by a subsequent call to reenact.\n *\n */ class $6e0aaad189039339$var$ReplayableActorMover {\n    /** @type {module:players/actors.Actor} */ #actor;\n    /** @type {AbstractModifier} */ #modifier;\n    /** @type {Position} */ #originalPosition;\n    /** @type {TileMap} */ #tileMap;\n    /** @type {RouteFinder} */ #routeFinder;\n    /** @type {boolean} */ #heroDisengaging;\n    /**\n   *\n   * @param {module:players/actors.Actor} actor\n   * @param {TileMap} tileMap\n   * @param {RouteFinder} routeFinder\n   * @param {boolean} heroDisengaging\n   */ constructor(actor, tileMap, routeFinder, heroDisengaging){\n        this.#actor = actor;\n        this.#tileMap = tileMap;\n        this.#routeFinder = routeFinder;\n        this.#heroDisengaging = heroDisengaging;\n    }\n    /**\n   * Get a target grid position based on actor type\n   * @param {Point} actorGridPos\n   * @returns {Point}\n   */ #getTargetGridPoint(actorGridPos) {\n        if (this.#actor.moveType === (0, $ce45fe1849aeb7ad$export$be204faa7b4ee90a).HUNT) {\n            if (this.#heroDisengaging) return actorGridPos; // frozen\n            else {\n                const heroGridPos = this.#tileMap.worldPointToGrid($6e0aaad189039339$var$heroActor.position);\n                const orthoSeparation = actorGridPos.getOrthoSeparation(heroGridPos) - 1;\n                const maxHuntSeparation = this.#actor.getMaxTilesPerMove() * $6e0aaad189039339$var$TOO_MANY_TURNS_TO_REACH;\n                if (orthoSeparation <= maxHuntSeparation) return this.#tileMap.worldPointToGrid($6e0aaad189039339$var$heroActor.position);\n            }\n        }\n        // everything else falls back to random walk.\n        return this.#getRandomGridPosition(actorGridPos, this.#actor.getMaxTilesPerMove());\n    }\n    /**\n   * Move actor to new position using the route finder. The move takes place instantly\n   * but can be replayed using the replay method.\n   */ moveInstantly() {\n        this.#originalPosition = (0, $9181799b149b64a5$export$13807d9ee5a34a42).copy(this.#actor.position);\n        const tilesToMove = this.#actor.getMaxTilesPerMove();\n        if (tilesToMove === 0) return;\n        const actorGridPos = this.#tileMap.worldPointToGrid(this.#actor.position);\n        const targetGridPos = this.#getTargetGridPoint(actorGridPos);\n        if (!targetGridPos.coincident(actorGridPos) // && this.#tileMap.canHeroSeeGridPoint(actorGridPos)\n        ) {\n            this.#routeFinder.actor = this.#actor;\n            let waypoints = this.#routeFinder.getDumbRouteNextTo(actorGridPos, targetGridPos, tilesToMove);\n            if (waypoints.length > 0) {\n                this.#modifier = new (0, $8e5c8f9d0e1a3528$export$c14f425b03c3e261)({\n                    path: waypoints,\n                    speed: 100\n                }, this.#actor.sprite.modifier);\n                this.#setActorsPosition(waypoints[waypoints.length - 1]);\n            }\n        }\n    }\n    /**\n   * Get a random target point.\n   * @param {Point} currentGrid\n   * @param {number} maxDistance - max movement in any direction\n   * @returns {Point}\n   */ #getRandomGridPosition(currentGrid, maxDistance) {\n        const x = $95fc563048a48bb6$export$75c671db1a13cf5f(currentGrid.x - maxDistance, currentGrid.x + maxDistance);\n        const y = $95fc563048a48bb6$export$75c671db1a13cf5f(currentGrid.y - maxDistance, currentGrid.y + maxDistance);\n        const dims = this.#tileMap.getDimsInTiles();\n        return new (0, $9181799b149b64a5$export$baf26146a414f24a)($95fc563048a48bb6$export$e0b576e7a74416cd(x, 0, dims.width - 1), $95fc563048a48bb6$export$e0b576e7a74416cd(y, 0, dims.height - 1));\n    }\n    /**\n   * Set the actors position, updating the tile map occupancy as required.\n   * @param {Position} position\n   */ #setActorsPosition(position) {\n        const oldGridPoint = this.#tileMap.worldPointToGrid(this.#actor.position);\n        this.#actor.position = position;\n        const newGridPoint = this.#tileMap.worldPointToGrid(this.#actor.position);\n        this.#tileMap.moveTileOccupancyGridPoint(this.#actor, oldGridPoint, newGridPoint);\n    }\n    /**\n   * Restore the actor's original position.\n   */ #restorePosition() {\n        this.#setActorsPosition(this.#originalPosition);\n    }\n    /**\n   * Undertake the move defined by the modifier.\n   * @returns {Promise} fulfils to undefined.\n   */ replay() {\n        this.#restorePosition();\n        if (this.#modifier) {\n            this.#cloneIfOrganic();\n            return this.#modifier.applyAsTransientToSprite(this.#actor.sprite);\n        }\n        return Promise.resolve();\n    }\n    /**\n   * Clone the actor if currently spawning.\n   */ #cloneIfOrganic() {\n        if (this.#actor.isOrganic()) {\n            const clonedActor = (0, $d8cd23d1a2971b65$export$260a0189ba712b47)(this.#actor.almanacEntry);\n            clonedActor.position = this.#originalPosition;\n            clonedActor.freezeMovement();\n            (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).addActor(clonedActor);\n        }\n    }\n}\n/**\n * Class used to handle multiple ReplayableActorMovers.\n */ class $6e0aaad189039339$var$MovementReplayer {\n    /** @type {TileMap} */ #tileMap;\n    /** @type {RouteFinder} */ #routeFinder;\n    /** @type {ReplayableActorMover[]} */ #movers;\n    /** @type {boolean} */ #heroDisengaging;\n    /**\n   *\n   * @param {TileMap} tileMap\n   * @param {RouteFinder} routeFinder\n   * @param {boolean} heroDisengaging\n   */ constructor(tileMap, routeFinder, heroDisengaging){\n        this.#movers = [];\n        this.#tileMap = tileMap;\n        this.#routeFinder = routeFinder;\n        this.#heroDisengaging = heroDisengaging;\n    }\n    /**\n   * Add the actor and move immediately to hero. Note if the actor's movement\n   * is zero, the function does nothing.\n   * @param {module:players/actors.Actor} actor\n   */ addAndMoveActor(actor) {\n        if (actor.getMaxTilesPerMove() === 0) return;\n        const replayableMover = new $6e0aaad189039339$var$ReplayableActorMover(actor, this.#tileMap, this.#routeFinder, this.#heroDisengaging);\n        replayableMover.moveInstantly();\n        this.#movers.push(replayableMover);\n    }\n    /**\n   * Replay all movements in parallel.\n   * @returns {Promise} fulfils to undefined when all movements complete.\n   */ replay() {\n        const promises = [];\n        this.#movers.forEach((mover)=>promises.push(mover.replay()));\n        return Promise.all(promises);\n    }\n}\n/**\n * Basic State class\n */ class $6e0aaad189039339$var$State {\n    constructor(){}\n    /**\n   * Transition to a new state\n   * @returns {Promise} fulfills to null\n   */ async transitionTo(state) {\n        await this.onExit().then(()=>{\n            $6e0aaad189039339$var$currentState = state;\n            return state.onEntry();\n        });\n    }\n    /**\n   * Perform actions on entering the state.\n   * @returns {Promise} fulfills to null\n   */ onEntry() {\n        return Promise.resolve();\n    }\n    /**\n   * Handle event.\n   * @param {number} eventId\n   * @param  {module:utils/sprites/sprite~Sprite} sprite - the sprite initiating the event\n   * @param {Object} detail - object will depend on the eventId\n   * @returns {Promise} fulfills to null\n   */ onEvent(eventIdUnused) {\n        return Promise.resolve(null);\n    }\n    /**\n   * Actions when the state exits\n   * @returns {Promise} fulfills to null\n   */ onExit() {\n        return Promise.resolve(null);\n    }\n}\n/**\n * At WaitingToStart\n */ class $6e0aaad189039339$var$WaitingToStart extends $6e0aaad189039339$var$State {\n    onEntry() {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"WaitingToStart state\");\n    }\n    /**\n   * @override\n   * @param {number} eventId\n   * @param  {module:utils/sprites/sprite~Sprite} point - the point initiating the event\n   * @param {Object} detail - object will depend on the eventId\n   */ async onEvent(eventId, pointUnused, detailUnused) {\n        if (eventId === $6e0aaad189039339$var$EventId.MAIN_MENU) await this.transitionTo(new $6e0aaad189039339$var$AtMainMenu());\n        else return Promise.resolve();\n    }\n}\n/**\n * At main Menu\n */ class $6e0aaad189039339$var$AtMainMenu extends $6e0aaad189039339$var$State {\n    onEntry() {\n        const continuation = !!(0, $ece912613ca227a3$export$e5b7197cc57951e6)();\n        return (0, $a1eb2cc493356a27$export$7e05f8bc47a87cf8)(continuation).then(async (response)=>{\n            $6e0aaad189039339$var$persistentGame = response !== \"PLAY CASUAL\";\n            await this.transitionTo(new $6e0aaad189039339$var$AtStart());\n            return;\n        });\n    }\n}\n/**\n * At start state\n */ class $6e0aaad189039339$var$AtStart extends $6e0aaad189039339$var$State {\n    onEntry() {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Enter AtStart\");\n        return this.#showQuickTips().then(()=>this.#loadFirstOrContinuationScene()).then((continuation)=>{\n            const name = $6e0aaad189039339$var$heroActor.traits.get(\"NAME\");\n            if (continuation) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE DUNGEON INTRO CONTINUE ${name}`, {\n                okButtonLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON ENTER DUNGEON`,\n                className: \"wall\"\n            }).then(()=>$b5bda9c98c481f6f$export$1fa1f898df932d80($6e0aaad189039339$var$heroActor)).then((response)=>{\n                if (response === \"MAIN MENU\") return Promise.reject(\"MAIN_MENU\");\n                if (!$6e0aaad189039339$var$heroActor.alive) return Promise.reject(\"DEAD\");\n            });\n            else {\n                const mdUrl = $6e0aaad189039339$var$persistentGame ? (0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).DUNGEON_WELCOME : (0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).DUNGEON_WELCOME_CASUAL;\n                return (0, $821757827816346b$export$8bd46d86307c9a41)(mdUrl, {\n                    okButtonLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON ENTER DUNGEON`\n                });\n            }\n        }).then(()=>{\n            $6e0aaad189039339$var$heroActor.sprite.position = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap().getWorldPositionOfTileByEntry();\n            return;\n        }).then(()=>{\n            const intro = (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).getCurrentSceneIntro();\n            if (intro) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog(intro, {\n                className: \"mask\"\n            });\n            else return;\n        }).then(()=>(0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"DOOR_ENTER\")).then(()=>$6e0aaad189039339$var$currentState.transitionTo(new $6e0aaad189039339$var$HeroTurnIdle())).catch((rejection)=>{\n            if (rejection === \"DEAD\") {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Hero died during rest.\");\n                $6e0aaad189039339$var$currentState.transitionTo(new $6e0aaad189039339$var$AtGameOver());\n            } else $6e0aaad189039339$var$currentState.transitionTo(new $6e0aaad189039339$var$AtMainMenu());\n        });\n    }\n    /**\n   * Load the first scene or if using saved games and there\n   * is one in progress, load that.\n   * @returns {Promise<boolean>} fulfils to true if continuation\n   */ #loadFirstOrContinuationScene() {\n        const savedGame = $6e0aaad189039339$var$persistentGame ? (0, $ece912613ca227a3$export$e5b7197cc57951e6)() : null;\n        if (savedGame) return (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).continueFromSavedScene(savedGame.sceneLevel, savedGame.hero).then(()=>true);\n        else return (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).switchToFirstScene().then(()=>false);\n    }\n    /** Show quick tips if required.\n   * @returns {Promise}\n   */ #showQuickTips() {\n        if (!(0, $f0a94f3b2f305120$export$2e2bcd8739ae039).get(\"SHOW_QUICK_TIPS_AT_START\", true)) return Promise.resolve();\n        const okButton = new (0, $58ea3f4a4bcc116e$export$3e9165d18613c27e)({\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON OK`,\n            closes: \"OK\"\n        });\n        const notAgainButton = new (0, $58ea3f4a4bcc116e$export$3e9165d18613c27e)({\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON DO NOT SHOW AGAIN`,\n            closes: \"NOT AGAIN\"\n        });\n        return (0, $821757827816346b$export$8bd46d86307c9a41)((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).STARTUP_TIPS_MD, {\n            actionButtons: [\n                okButton,\n                notAgainButton\n            ]\n        }).then((choice)=>{\n            if (choice === \"NOT AGAIN\") (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).set(\"SHOW_QUICK_TIPS_AT_START\", false);\n            return;\n        });\n    }\n}\n/**\n * At Game Over\n */ class $6e0aaad189039339$var$AtGameOver extends $6e0aaad189039339$var$State {\n    async onEntry() {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Enter AtGameOver\");\n        let leaderboardIndex = -1;\n        if ($6e0aaad189039339$var$persistentGame) leaderboardIndex = (0, $ece912613ca227a3$export$384cd953322e3851)($6e0aaad189039339$var$heroActor);\n        (0, $8f3da527d9ba55fc$export$dc0b517182376fca)((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`YOU DIED!`, {\n            delaySecs: 1,\n            lifetimeSecs: 3,\n            position: $6e0aaad189039339$var$heroActor.position,\n            velocity: new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, -100, 0)\n        });\n        await (0, $47c057e9d418a795$export$229c72e5fdee233b)(2).then(()=>$b5bda9c98c481f6f$export$13f9064afcdbcb51($6e0aaad189039339$var$heroActor, leaderboardIndex, {\n                okButtonLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON TRY AGAIN`\n            })).then(()=>(0, $cd2e32752119e7f3$export$2e2bcd8739ae039).unloadCurrentScene()).then(()=>this.transitionTo(new $6e0aaad189039339$var$AtMainMenu()));\n    }\n}\n/**\n * At Game Completed\n */ class $6e0aaad189039339$var$AtGameCompleted extends $6e0aaad189039339$var$State {\n    async onEntry() {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Enter AtGameCompleted\");\n        await (0, $821757827816346b$export$8bd46d86307c9a41)((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).DUNGEON_COMPLETE, {\n            okButtonLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON TRY AGAIN`\n        }).then(()=>(0, $cd2e32752119e7f3$export$2e2bcd8739ae039).unloadCurrentScene()).then(()=>this.transitionTo(new $6e0aaad189039339$var$AtMainMenu()));\n    }\n}\n/**\n * State where the hero is in the map.\n */ class $6e0aaad189039339$var$HeroTurnIdle extends $6e0aaad189039339$var$State {\n    constructor(){\n        super();\n    }\n    /**\n   * @override\n   */ async onEntry() {\n        await super.onEntry();\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Enter HeroTurnIdle\");\n        await $6e0aaad189039339$var$prepareHeroTurn();\n        const dead = await $6e0aaad189039339$var$doToxicEffectsKillHero();\n        if (dead) await this.transitionTo(new $6e0aaad189039339$var$AtGameOver());\n    }\n    /**\n   * @override\n   * @param {number} eventId\n   * @param  {module:utils/sprites/sprite~Sprite} point - the point initiating the event\n   * @param {Object} [detail = {}] - object will depend on the eventId\n   */ async onEvent(eventId, point, detail = {}) {\n        switch(eventId){\n            case $6e0aaad189039339$var$EventId.CLICKED_FREE_GROUND:\n                {\n                    const filter = await $6e0aaad189039339$var$disambiguateFilter(detail.filter, detail.occupant);\n                    if (filter === (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).INTERACT_TILE) await $6e0aaad189039339$var$interact(point);\n                    else if (filter === (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).OCCUPIED_TILE) await $6e0aaad189039339$var$showOccupantDetails(detail.occupant);\n                    else await $6e0aaad189039339$var$moveHeroToPoint(point, {\n                        usePathFinder: detail.filter !== (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).MOVE_OR_INTERACT_TILE\n                    });\n                    if ($6e0aaad189039339$var$heroActor.traits.get(\"HP\", 0) === 0) await this.transitionTo(new $6e0aaad189039339$var$AtGameOver());\n                    else await this.transitionTo(new $6e0aaad189039339$var$ComputerTurnIdle());\n                }\n                break;\n            case $6e0aaad189039339$var$EventId.CLICKED_ENTRANCE:\n                await (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE ENTRANCE STUCK`);\n                await this.transitionTo(new $6e0aaad189039339$var$ComputerTurnIdle());\n                break;\n            case $6e0aaad189039339$var$EventId.CLICKED_EXIT:\n                {\n                    (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Escaping\");\n                    const unlocked = await $6e0aaad189039339$var$tryToUnlockExit();\n                    if (unlocked) await $6e0aaad189039339$var$moveHeroToPoint(point, {\n                        usePathFinder: false\n                    }).then(()=>$6e0aaad189039339$var$startNextScene(this));\n                    else await this.transitionTo(new $6e0aaad189039339$var$ComputerTurnIdle());\n                    break;\n                }\n        }\n        return Promise.resolve(null);\n    }\n}\n/**\n * State where the hero is in the map.\n */ class $6e0aaad189039339$var$HeroTurnInteracting extends $6e0aaad189039339$var$State {\n    constructor(){\n        super();\n    }\n    /**\n   * @override\n   */ async onEntry() {\n        await super.onEntry();\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Enter HeroTurnInteracting\");\n        await $6e0aaad189039339$var$prepareHeroTurn();\n        const dead = await $6e0aaad189039339$var$doToxicEffectsKillHero();\n        if (dead) await this.transitionTo(new $6e0aaad189039339$var$AtGameOver());\n    }\n    /**\n   * @override\n   * @param {number} eventId\n   * @param  {module:utils/sprites/sprite~Sprite} point - the point initiating the event\n   * @param {Object} [detail = {}] - object will depend on the eventId\n   */ async onEvent(eventId, point, detail = {}) {\n        switch(eventId){\n            case $6e0aaad189039339$var$EventId.CLICKED_FREE_GROUND:\n                {\n                    const filter = await $6e0aaad189039339$var$disambiguateFilter(detail.filter, detail.occupant);\n                    if (filter === (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).INTERACT_TILE) await $6e0aaad189039339$var$interact(point);\n                    else if (filter === (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).OCCUPIED_TILE) await $6e0aaad189039339$var$showOccupantDetails(detail.occupant);\n                    else await this.#tryToDisengage(point, {\n                        usePathFinder: detail.filter !== (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).MOVE_OR_INTERACT_TILE\n                    });\n                    if ($6e0aaad189039339$var$heroActor.traits.get(\"HP\", 0) === 0) await this.transitionTo(new $6e0aaad189039339$var$AtGameOver());\n                    else await this.#transitionToComputerTurn();\n                }\n                break;\n            case $6e0aaad189039339$var$EventId.CLICKED_ENTRANCE:\n                await (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE ENTRANCE STUCK`);\n                await this.#transitionToComputerTurn();\n                break;\n            case $6e0aaad189039339$var$EventId.CLICKED_EXIT:\n                {\n                    const unlocked = await $6e0aaad189039339$var$tryToUnlockExit();\n                    if (unlocked) await this.#tryToDisengage(point, {\n                        usePathFinder: false\n                    }).then(()=>$6e0aaad189039339$var$startNextScene(this));\n                    else await this.#transitionToComputerTurn();\n                    break;\n                }\n        }\n        return Promise.resolve(null);\n    }\n    /**\n   * Transition to the appropriate computer turn\n   */ async #transitionToComputerTurn() {\n        if ((0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap().getParticipants($6e0aaad189039339$var$heroActor).length === 0) await this.transitionTo(new $6e0aaad189039339$var$ComputerTurnIdle());\n        else await this.transitionTo(new $6e0aaad189039339$var$ComputerTurnInteracting());\n    }\n    /**\n   * Try to run. Note the hero always moves. Disengaging means the enemies won't\n   * follow.\n   * @param {Point} point - position in world.\n   * @param {Object} [options = {usePathFinder: true}]\n   * @param {boolean} options.usePathFinder - should path finder be used.\n   * @returns {Promise} fulfils to undefined\n   */ #tryToDisengage(point, options = {\n        usePathFinder: true\n    }) {\n        const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n        const opponents = tileMap.getParticipants($6e0aaad189039339$var$heroActor);\n        let respectDisengage = false;\n        for (const opponent of opponents)if (opponent.alive && opponent.interaction.respectDisengage($6e0aaad189039339$var$heroActor)) {\n            respectDisengage = true;\n            break;\n        }\n        const currentGridPoint = tileMap.worldPointToGrid($6e0aaad189039339$var$heroActor.position);\n        const targetGridPoint = tileMap.worldPointToGrid(point);\n        const movement = currentGridPoint.getOrthoSeparation(targetGridPoint);\n        if (respectDisengage && movement <= $6e0aaad189039339$var$MAX_TILES_FOR_DISENGAGEMENT) $6e0aaad189039339$var$heroActor.disengaging = true;\n        return $6e0aaad189039339$var$moveHeroToPoint(point, options).then(()=>true);\n    }\n}\nclass $6e0aaad189039339$var$ComputerTurnIdle extends $6e0aaad189039339$var$State {\n    constructor(){\n        super();\n    }\n    async onEntry() {\n        await super.onEntry();\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Enter ComputerTurnIdle\");\n        await $6e0aaad189039339$var$applyOrganicToActors();\n        const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n        const routeFinder = new (0, $a3020fd1bff41e76$export$4c535f8fc4520664)(tileMap);\n        const replayer = new $6e0aaad189039339$var$MovementReplayer(tileMap, routeFinder, $6e0aaad189039339$var$heroActor.disengaging);\n        for (const actor of (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getActors().values()){\n            if (actor !== $6e0aaad189039339$var$heroActor && actor.alive) {\n                if (!actor.isWandering() || $a4035ea4d528e431$export$b9d1fef74bbc4c0c(6) > 3) replayer.addAndMoveActor(actor);\n            }\n        }\n        for (const actor of (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getOrganicActors().values())if (actor.alive) replayer.addAndMoveActor(actor);\n        await replayer.replay();\n        const participants = tileMap.getParticipants($6e0aaad189039339$var$heroActor);\n        for (const actor of participants)if (actor.isEnemy()) {\n            await this.transitionTo(new $6e0aaad189039339$var$HeroTurnInteracting());\n            return Promise.resolve(null);\n        }\n        await this.transitionTo(new $6e0aaad189039339$var$HeroTurnIdle());\n    }\n}\nclass $6e0aaad189039339$var$ComputerTurnInteracting extends $6e0aaad189039339$var$State {\n    constructor(){\n        super();\n    }\n    async onEntry() {\n        await super.onEntry();\n        await $6e0aaad189039339$var$applyOrganicToActors();\n        const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n        const routeFinder = new (0, $a3020fd1bff41e76$export$4c535f8fc4520664)(tileMap);\n        const replayer = new $6e0aaad189039339$var$MovementReplayer(tileMap, routeFinder, $6e0aaad189039339$var$heroActor.disengaging);\n        const participants = tileMap.getParticipants($6e0aaad189039339$var$heroActor);\n        for (const actor of (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getActors().values())if (actor !== $6e0aaad189039339$var$heroActor && actor.alive && actor.interaction) {\n            if (participants.includes(actor) && actor.willInteract()) await actor.interaction.enact($6e0aaad189039339$var$heroActor);\n            else replayer.addAndMoveActor(actor);\n        }\n        for (const actor of (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getOrganicActors().values())if (actor.alive) replayer.addAndMoveActor(actor);\n        await replayer.replay();\n        if ($6e0aaad189039339$var$heroActor.traits.get(\"HP\", 0) === 0) await this.transitionTo(new $6e0aaad189039339$var$AtGameOver());\n        else if (participants.length === 0) await this.transitionTo(new $6e0aaad189039339$var$HeroTurnIdle());\n        else await this.transitionTo(new $6e0aaad189039339$var$HeroTurnInteracting());\n        return Promise.resolve(null);\n    }\n}\n/**\n * Prepare hero turn\n * @returns {Promise}\n */ function $6e0aaad189039339$var$prepareHeroTurn() {\n    $6993a9a5d7595cd1$export$6fb3a797494847de();\n    $6e0aaad189039339$var$heroActor.disengaging = false;\n    const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n    const routes = new (0, $a3020fd1bff41e76$export$4c535f8fc4520664)(tileMap, $6e0aaad189039339$var$heroActor).getAllRoutesFrom(tileMap.worldPointToGrid($6e0aaad189039339$var$heroActor.sprite.position), $6e0aaad189039339$var$heroActor.getMaxTilesPerMove());\n    tileMap.setMovementRoutes(routes);\n    tileMap.setInteractActors(tileMap.getParticipants($6e0aaad189039339$var$heroActor));\n    tileMap.calcReachableDoors($6e0aaad189039339$var$heroActor.position);\n    return Promise.resolve(null);\n}\n/**\n * Apply any toxic effects to the hero.\n * @returns {boolean} true if dead.\n */ function $6e0aaad189039339$var$doToxicEffectsKillHero() {\n    if ($6e0aaad189039339$var$heroActor.toxify?.isActive) {\n        $6e0aaad189039339$var$heroActor.toxify.enact($6e0aaad189039339$var$heroActor);\n        return $6e0aaad189039339$var$heroActor.traits.getInt(\"HP\", 0) <= 0;\n    }\n    return false;\n}\n/**\n * Move to point\n * @param {Point} point\n * @param {Object} [options = {usePathFinder:true}]\n * @param {boolean} options.usePathFinder\n * @returns {Promise}\n */ function $6e0aaad189039339$var$moveHeroToPoint(point, options = {\n    usePathFinder: true\n}) {\n    const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n    let waypoints;\n    if (options.usePathFinder) waypoints = tileMap.getWaypointsToWorldPoint(point);\n    else waypoints = [\n        $6e0aaad189039339$var$heroActor.position,\n        point\n    ];\n    tileMap.setMovementRoutes(null);\n    tileMap.setInteractActors(null);\n    if (waypoints) {\n        const modifier = new (0, $8e5c8f9d0e1a3528$export$c14f425b03c3e261)({\n            path: waypoints,\n            speed: 100\n        }, $6e0aaad189039339$var$heroActor.sprite.modifier);\n        return modifier.applyAsTransientToSprite($6e0aaad189039339$var$heroActor.sprite);\n    } else return Promise.resolve();\n}\n/**\n * Apply organic actions to all actors.\n * @returns {Promise} fulfils to undefined on completion.\n */ function $6e0aaad189039339$var$applyOrganicToActors() {\n    const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n    const promises = [];\n    (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getOrganicActors().forEach((organic)=>{\n        const participants = tileMap.getCoincidentActors(organic);\n        participants.forEach((actor)=>{\n            if (actor.alive && !actor.isOrganic() && organic.interaction) promises.push(organic.interaction.enact(actor));\n        });\n    });\n    return Promise.all(promises);\n}\n/**\n * Interact with point\n * @param {Point} point - position in world.\n * @returns {Promise}\n */ function $6e0aaad189039339$var$interact(point) {\n    /** @type {module:utils/tileMaps/tileMap~TileMap} */ const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n    const tile = tileMap.getTileAtWorldPoint(point);\n    const targets = tile.getOccupants();\n    const promises = [];\n    for (const target of targets.values())if (target.interaction) promises.push(target.interaction.react($6e0aaad189039339$var$heroActor));\n    return Promise.all(promises);\n}\n/**\n * Start next scene.\n * @param {State} currentState\n * @returns {Promise} fulfils to undefined.\n */ function $6e0aaad189039339$var$startNextScene(currentState) {\n    $6e0aaad189039339$var$heroActor.traits.clearTransientFxTraitsAndProperties();\n    if ($6e0aaad189039339$var$persistentGame) (0, $ece912613ca227a3$export$384cd953322e3851)($6e0aaad189039339$var$heroActor);\n    if (!(0, $cd2e32752119e7f3$export$2e2bcd8739ae039).areThereMoreScenes()) return currentState.transitionTo(new $6e0aaad189039339$var$AtGameCompleted());\n    return (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).unloadCurrentScene().then(()=>$b5bda9c98c481f6f$export$1fa1f898df932d80($6e0aaad189039339$var$heroActor)).then((response)=>{\n        if (response === \"MAIN MENU\") return Promise.reject(\"MAIN_MENU\");\n        if (!$6e0aaad189039339$var$heroActor.alive) return Promise.reject(\"DEAD\");\n    }).then(()=>$6e0aaad189039339$var$randomlySelectDifficulty()).then(()=>(0, $cd2e32752119e7f3$export$2e2bcd8739ae039).switchToNextScene()).then((scene)=>{\n        $6e0aaad189039339$var$heroActor.sprite.position = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap().getWorldPositionOfTileByEntry();\n        return scene;\n    }).then((scene)=>{\n        if (scene.intro) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog(scene.intro, {\n            className: \"wall\"\n        });\n        else return;\n    }).then(()=>(0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"DOOR_ENTER\")).then(()=>currentState.transitionTo(new $6e0aaad189039339$var$HeroTurnIdle())).catch((rejection)=>{\n        if (rejection === \"DEAD\") {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Hero died during rest.\");\n            currentState.transitionTo(new $6e0aaad189039339$var$AtGameOver());\n        } else currentState.transitionTo(new $6e0aaad189039339$var$AtMainMenu());\n    });\n}\n/**\n * Occasionally show a rune puzzle to set the next scene's difficulty.\n * @returns {Promise} fulfils to undefined.\n */ function $6e0aaad189039339$var$randomlySelectDifficulty() {\n    if ($a4035ea4d528e431$export$b9d1fef74bbc4c0c(6) > 3) return Promise.resolve();\n    return (0, $97137e829c6605e7$export$a2b7eb05f7b8eccf)((0, $cd2e32752119e7f3$export$2e2bcd8739ae039).getCurrentSceneLevel()).then((solved)=>{\n        let message;\n        if (solved) {\n            (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).setDungeonChallenge((0, $94049cc5d4f81fad$export$baa1f113a47bd01a).EASY);\n            message = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE ROUTE CHOICE - EASY`;\n        } else {\n            (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).setDungeonChallenge((0, $94049cc5d4f81fad$export$baa1f113a47bd01a).MEDIUM);\n            message = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE ROUTE CHOICE - MEDIUM`;\n        }\n        return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog(message);\n    });\n}\n/**\n * Show occupant details.\n * @param {module:players/actors.Actor} occupant\n * @returns {Promise} fulfils to undefined.\n */ function $6e0aaad189039339$var$showOccupantDetails(occupant) {\n    if (!occupant) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Clicked on tile but no occupant to view.\");\n        return Promise.resolve();\n    }\n    if (occupant.isHiddenArtefact()) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog(occupant.description);\n    return $b5bda9c98c481f6f$export$634672c91d44b77e(occupant, {\n        allowConsumption: occupant.isHero(),\n        allowMagicUse: occupant.isHero()\n    }).then((delayedAction)=>{\n        if (delayedAction?.invoke) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Invoke action.\");\n            return delayedAction.invoke();\n        }\n    });\n}\n/**\n * Trigger an event. This will then be passed to the current State to handle.\n * @param {number} eventId\n * @param  {module:utils/sprites/sprite~Sprite} sprite - the sprite initiating the event\n * @param {Object} detail - object will depend on the eventId\n */ function $6e0aaad189039339$var$triggerEvent(eventId, sprite, detail) {\n    if ($6e0aaad189039339$var$ignoreEvents) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Ignoring event ${eventId} as still processing earlier event.`);\n        return;\n    }\n    $6e0aaad189039339$var$ignoreEvents = true;\n    $6e0aaad189039339$var$currentState.onEvent(eventId, sprite, detail).then(()=>{\n        $6e0aaad189039339$var$ignoreEvents = false;\n    });\n}\n/**\n * @param {ClickEventFilter} filter\n * @param {module:players/actors.Actor} occupant\n * @returns {Promise<ClickEventFilter>}\n */ function $6e0aaad189039339$var$disambiguateFilter(filter, occupant) {\n    if (filter === (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).MOVE_OR_INTERACT_TILE) {\n        if (occupant?.isHiddenArtefact()) {\n            const storageDetails = occupant.storeManager.getFirstStorageDetails();\n            const artefact = storageDetails?.artefact;\n            if (occupant.alive && artefact && !occupant.discovered) return Promise.resolve((0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).INTERACT_TILE);\n            else if (!occupant.alive && !artefact) return Promise.resolve((0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).MOVEMENT_TILE);\n        }\n        let message;\n        let moveLabel;\n        let interactLabel;\n        if (occupant.isPortal()) {\n            message = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE USE PORTAL OR MOVE`;\n            moveLabel = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON MOVE`;\n            interactLabel = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON USE`;\n        } else {\n            message = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE SEARCH OR MOVE`;\n            moveLabel = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON MOVE`;\n            interactLabel = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON SEARCH`;\n        }\n        return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showChoiceDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE CHOICES`, message, [\n            moveLabel,\n            interactLabel\n        ]).then((choice)=>{\n            if (choice === 0) return (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).MOVEMENT_TILE;\n            else return (0, $ac2e0e274b6f5d79$export$ea490c48f1c71643).INTERACT_TILE;\n        });\n    }\n    return filter;\n}\n/**\n * Set the current hero sprite.\n * @returns {module:players/actors~Actor}\n */ function $6e0aaad189039339$var$getHeroActor() {\n    return $6e0aaad189039339$var$heroActor;\n}\n/** Unlock the exit if necessary.\n * @returns {Promise} fulfils to true if exit can be unlocked.\n */ function $6e0aaad189039339$var$tryToUnlockExit() {\n    if ($6e0aaad189039339$var$exitKeyArtefact) {\n        if ($6e0aaad189039339$var$heroActor.storeManager.hasArtefact($6e0aaad189039339$var$exitKeyArtefact)) {\n            $6e0aaad189039339$var$heroActor.storeManager.discard($6e0aaad189039339$var$exitKeyArtefact);\n            return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE KEY UNLOCKS EXIT`).then(()=>{\n                (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"DOOR_EXIT\");\n                return true;\n            });\n        } else return (0, $0901ee0d2d0e236f$export$12257a9a333b6f47)($6e0aaad189039339$var$heroActor, $6e0aaad189039339$var$exitKeyArtefact).then((success)=>{\n            if (success) (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"DOOR_EXIT\");\n            return success;\n        });\n    } else {\n        (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"DOOR_EXIT\");\n        return Promise.resolve(true);\n    }\n}\n/**\n * Start\n * @param {module:players/actors.Actor} actor - the hero actor\n */ function $6e0aaad189039339$var$setHero(actor) {\n    $6e0aaad189039339$var$heroActor = actor;\n}\n/** Lock the exit. The actor will need to possess the artefact unlock it.\n * @param {module:players/ArtefactStoreManager.Artefact}\n */ function $6e0aaad189039339$var$setExitKeyArtefact(artefact) {\n    $6e0aaad189039339$var$exitKeyArtefact = artefact;\n}\n/**\n * @type {module:players/actors~Actor}\n */ let $6e0aaad189039339$var$heroActor;\n/**\n * @type {State}\n */ let $6e0aaad189039339$var$currentState = new $6e0aaad189039339$var$WaitingToStart();\n/**\n * Flag to determine whether events are accepted.\n */ let $6e0aaad189039339$var$ignoreEvents = false;\n/** Key required to unlock the exit. @type {module:players/artefacts.Artefact} */ let $6e0aaad189039339$var$exitKeyArtefact;\n/**\n * Single instance of the turn manager.\n */ const $6e0aaad189039339$var$TURN_MANAGER = {\n    EventId: $6e0aaad189039339$var$EventId,\n    getHeroActor: $6e0aaad189039339$var$getHeroActor,\n    setHero: $6e0aaad189039339$var$setHero,\n    triggerEvent: $6e0aaad189039339$var$triggerEvent,\n    setExitKeyArtefact: $6e0aaad189039339$var$setExitKeyArtefact\n};\nvar $6e0aaad189039339$export$2e2bcd8739ae039 = $6e0aaad189039339$var$TURN_MANAGER;\n\n\n\n\n/**\n * @file Conversion of map plan keys to images and tile definitions.\n *\n * @module scriptReaders/symbolMapping\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n/**\n * @typedef {module:scriptReaders/sceneDefinitionParser~TileDefinition} TileDefinition\n */ /**\n * @param {string} imageName\n * @returns {TileDefinition}\n */ function $20be302081331f54$var$createGroundDefn(imageName) {\n    return {\n        role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).GROUND,\n        onClick: (target, point, detail)=>(0, $6e0aaad189039339$export$2e2bcd8739ae039).triggerEvent((0, $6e0aaad189039339$export$2e2bcd8739ae039).EventId.CLICKED_FREE_GROUND, point, detail),\n        image: imageName\n    };\n}\n/**\n * @param {string} imageName\n * @returns {TileDefinition}\n */ function $20be302081331f54$var$createEntranceDefn(imageName) {\n    return {\n        role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).ENTRANCE,\n        onClick: (target, point, detail)=>(0, $6e0aaad189039339$export$2e2bcd8739ae039).triggerEvent((0, $6e0aaad189039339$export$2e2bcd8739ae039).EventId.CLICKED_ENTRANCE, point, detail),\n        image: imageName\n    };\n}\n/**\n * @param {string} imageName\n * @returns {TileDefinition}\n */ function $20be302081331f54$var$createExitDefn(imageName) {\n    return {\n        role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).EXIT,\n        onClick: (target, point, detail)=>(0, $6e0aaad189039339$export$2e2bcd8739ae039).triggerEvent((0, $6e0aaad189039339$export$2e2bcd8739ae039).EventId.CLICKED_EXIT, point, detail),\n        image: imageName\n    };\n}\nconst $20be302081331f54$export$7dccdb77f761a8ef = new Map([\n    [\n        \"x\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"block.png\"\n        }\n    ],\n    // wall parts\n    [\n        \"#-TL\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-TL.png\"\n        }\n    ],\n    [\n        \"#-TLI\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-TLI.png\"\n        }\n    ],\n    [\n        \"#-T\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-T.png\"\n        }\n    ],\n    [\n        \"*-T\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall2-T.png\"\n        }\n    ],\n    [\n        \"#-TR\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-TR.png\"\n        }\n    ],\n    [\n        \"#-TRI\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-TRI.png\"\n        }\n    ],\n    [\n        \"#-R\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-R.png\"\n        }\n    ],\n    [\n        \"#-BR\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-BR.png\"\n        }\n    ],\n    [\n        \"#-BRI\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-BRI.png\"\n        }\n    ],\n    [\n        \"#-B\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-B.png\"\n        }\n    ],\n    [\n        \"*-B\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall2-B.png\"\n        }\n    ],\n    [\n        \"#-BL\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-BL.png\"\n        }\n    ],\n    [\n        \"#-BLI\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-BLI.png\"\n        }\n    ],\n    [\n        \"#-L\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-L.png\"\n        }\n    ],\n    [\n        \"#-XI\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-XI.png\"\n        }\n    ],\n    [\n        \"#-VI\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-VI.png\"\n        }\n    ],\n    [\n        \"#-HI\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-HI.png\"\n        }\n    ],\n    [\n        \"#-TTEE\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-TTEE.png\"\n        }\n    ],\n    [\n        \"#-RTEE\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-RTEE.png\"\n        }\n    ],\n    [\n        \"#-BTEE\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-BTEE.png\"\n        }\n    ],\n    [\n        \"#-LTEE\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"wall-LTEE.png\"\n        }\n    ],\n    [\n        \"#\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"block.png\"\n        }\n    ],\n    // doors\n    [\n        \"=-T\",\n        $20be302081331f54$var$createExitDefn(\"door-T.png\")\n    ],\n    [\n        \">-T\",\n        $20be302081331f54$var$createExitDefn(\"door2-T.png\")\n    ],\n    [\n        \"=-R\",\n        $20be302081331f54$var$createExitDefn(\"door-R.png\")\n    ],\n    [\n        \"=-B\",\n        $20be302081331f54$var$createExitDefn(\"door-B.png\")\n    ],\n    [\n        \">-B\",\n        $20be302081331f54$var$createExitDefn(\"door2-B.png\")\n    ],\n    [\n        \"=-L\",\n        $20be302081331f54$var$createExitDefn(\"door-L.png\")\n    ],\n    [\n        \"--T\",\n        $20be302081331f54$var$createEntranceDefn(\"door-T.png\")\n    ],\n    [\n        \"~-T\",\n        $20be302081331f54$var$createEntranceDefn(\"door2-T.png\")\n    ],\n    [\n        \"--R\",\n        $20be302081331f54$var$createEntranceDefn(\"door-R.png\")\n    ],\n    [\n        \"--B\",\n        $20be302081331f54$var$createEntranceDefn(\"door-B.png\")\n    ],\n    [\n        \"~-B\",\n        $20be302081331f54$var$createEntranceDefn(\"door2-B.png\")\n    ],\n    [\n        \"--L\",\n        $20be302081331f54$var$createEntranceDefn(\"door-L.png\")\n    ],\n    [\n        \"=\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"block.png\"\n        }\n    ],\n    [\n        \"-\",\n        {\n            role: (0, $ac2e0e274b6f5d79$export$b57fd20cbd2711c3).OBSTACLE,\n            image: \"block.png\"\n        }\n    ],\n    // ground\n    [\n        \".\",\n        $20be302081331f54$var$createGroundDefn(\"floor.png\")\n    ],\n    [\n        \".-SBW\",\n        $20be302081331f54$var$createGroundDefn(\"floor-SBW.png\")\n    ],\n    [\n        \".-SBE\",\n        $20be302081331f54$var$createGroundDefn(\"floor-SBE.png\")\n    ],\n    [\n        \",-SBE\",\n        $20be302081331f54$var$createGroundDefn(\"floor2-SBE.png\")\n    ],\n    [\n        \",-SBW\",\n        $20be302081331f54$var$createGroundDefn(\"floor2-SBW.png\")\n    ],\n    [\n        \",\",\n        $20be302081331f54$var$createGroundDefn(\"floor2.png\")\n    ]\n]);\n\n\n/**\n * @file Encapsulation of a Scene. A scene equates normally to a level in a\n * dungeon.\n *\n * @module game/scene\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\nclass $65611a44f4d7d3b3$export$765fdbac0eda2a0b {\n    /** @type {number} */ #globalOpacity;\n    /** @type {number} */ #deltaOpacityPerSec;\n    /** @type {number} */ #fadeInSecs;\n    /** @type {number} */ #fadeOutSecs;\n    /** Fade out promise resolution @type {function}  */ #fadeOutResolve;\n    /** @type {module:players/actors~Actor} */ heroActor;\n    /** @type {string} */ intro;\n    /**\n   * Create the scene.\n   * @param {number} [fadeInSecs = 2]\n   * @param {number} [fadeOutSecs = 2]\n   */ constructor(fadeInSecs = 2, fadeOutSecs = 2){\n        if (fadeInSecs > 0) {\n            this.#globalOpacity = 0;\n            this.#deltaOpacityPerSec = 1 / fadeInSecs;\n        } else this.#deltaOpacityPerSec = 1;\n        this.#fadeInSecs = fadeInSecs;\n        this.#fadeOutSecs = fadeOutSecs;\n    }\n    /**\n   * Get the global opacity.\n   * @returns {number}\n   */ getOpacity() {\n        return this.#globalOpacity;\n    }\n    /**\n   * Called at start. Game waits for preload before calling initialise.\n   * @function Scene#load\n   * @returns {Promise} fulfills to null\n   */ load() {\n        return this.doLoad();\n    }\n    /**\n   * Called after load. Game waits for initialise before starting the loop.\n   * @function Scene#initialise\n   * @returns {Promise} fulfills to null\n   */ initialise() {\n        return this.doInitialise();\n    }\n    /**\n   * Called in animation phase\n   * @function Scene#update\n   * @param {number} deltaSeconds\n   */ update(deltaSeconds) {\n        (0, $7aed85f370071bde$export$2e2bcd8739ae039).clearCanvas();\n        (0, $7aed85f370071bde$export$2e2bcd8739ae039).setOpacity(this.#globalOpacity);\n        (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).update(deltaSeconds);\n        this.doUpdate(deltaSeconds);\n        (0, $7aed85f370071bde$export$2e2bcd8739ae039).setOpacity(1);\n        if (this.#deltaOpacityPerSec !== 0) {\n            this.#globalOpacity += deltaSeconds * this.#deltaOpacityPerSec;\n            if (this.#globalOpacity > 1) {\n                this.#deltaOpacityPerSec = 0;\n                this.#globalOpacity = 1;\n            } else if (this.#globalOpacity < 0) {\n                this.#deltaOpacityPerSec = 0;\n                this.#globalOpacity = 0;\n            }\n        }\n        if (this.#fadeOutResolve && this.#globalOpacity === 0) {\n            this.#fadeOutResolve();\n            this.#fadeOutResolve = null;\n        }\n    }\n    /**\n   * Called when scene swapped out\n   * @function Scene#unload\n   * @returns {Promise} fulfills to null\n   */ unload() {\n        return this.#fadeOut().then(()=>this.doUnload());\n    }\n    /**\n   * Fade out the scene\n   * @returns {Promise} fulfils to undefined when fade complete.\n   */ #fadeOut() {\n        if (this.#fadeOutSecs > 0) {\n            this.#deltaOpacityPerSec = -1 / this.#fadeOutSecs;\n            return new Promise((resolve)=>{\n                this.#fadeOutResolve = resolve;\n            });\n        } else return Promise.resolve();\n    }\n    /**\n   * Called at start. Game waits for preload before calling initialise.\n   * This should be overridden.\n   * @returns {Promise} fulfills to null\n   */ doLoad() {\n        return Promise.resolve();\n    }\n    /**\n   * Called after load. Game waits for initialise before starting the loop.\n   * This should be overridden\n   * @returns {Promise} fulfills to null\n   */ doInitialise() {\n        return Promise.resolve();\n    }\n    /**\n   * Called in animation phase\n   * This should be overridden\n   * @param {number} deltaSeconds\n   */ doUpdate(deltaSecondsUnused) {\n        return Promise.resolve();\n    }\n    /**\n   * Called when scene swapped out\n   * This should be overridden\n   * @returns {Promise} fulfills to null\n   */ doUnload() {\n        return Promise.resolve();\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\n\nconst $b618d869f3b8e384$var$GRID_SIZE = (0, $8da6ce05f7802627$export$2e2bcd8739ae039).TILE_SIZE;\n/** @type {module:players/actors.Actor} */ let $b618d869f3b8e384$var$lastHero;\n/**\n * @typedef {Object} ActorDefn\n * @property {string} id\n * @property {module:dnd/traits~CharacterTraits} traits\n * @property {string} description\n */ /**\n * Create the hero. If the scene definition doesn't have a hero definition, the\n * lastHero is used.\n * @param {SceneDefinition} sceneDefn\n * @returns {module:players/actors.Actor}\n */ function $b618d869f3b8e384$var$createHero(sceneDefn) {\n    if (sceneDefn.hero instanceof (0, $ce45fe1849aeb7ad$export$f73d3eb6fd876d80)) $b618d869f3b8e384$var$lastHero = sceneDefn.hero;\n    else if (sceneDefn.hero) {\n        const actor = (0, $d8cd23d1a2971b65$export$260a0189ba712b47)(sceneDefn.hero);\n        $b618d869f3b8e384$var$lastHero = actor;\n    } else if (!$b618d869f3b8e384$var$lastHero) throw new Error(\"No hero has been defined.\");\n    return $b618d869f3b8e384$var$lastHero;\n}\n/**\n * Create the enemies.\n * @param {SceneDefinition} sceneDefn\n * @returns {Actor[]}\n */ function $b618d869f3b8e384$var$createEnemies(sceneDefn) {\n    const enemies = [];\n    sceneDefn.enemies.forEach((almanacEntry)=>{\n        const actor = (0, $d8cd23d1a2971b65$export$260a0189ba712b47)(almanacEntry);\n        enemies.push(actor);\n    });\n    return enemies;\n}\n/**\n * Create the portal.\n * @param {SceneDefinition} sceneDefn\n * @returns {module:players/actors.Actor} null if not created.\n */ function $b618d869f3b8e384$var$createPortal(sceneDefn) {\n    return sceneDefn.portal ? (0, $d8cd23d1a2971b65$export$260a0189ba712b47)(sceneDefn.portal) : null;\n}\n/** Create an artefact that is located in the dungeon.\n * The artefact is placed in a suitable actor such as a\n * pillar or as a hidden artefact.\n * @param {AlmanacEntry} almanacEntry\n * @param {module:players/artefacts.Artefact} [preBuiltArtefact] if not provided, the artefact is built from the\n * almanac entry.\n * @returns {module:players/actors.Actor} actor containing the artefact\n */ function $b618d869f3b8e384$var$createFindableArtefact(almanacEntry, preBuiltArtefact) {\n    let id;\n    let type;\n    if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(almanacEntry.type, (0, $547c634f23f1bc62$export$e451727f06f039f2).CONSUMABLE) && /SUBTYPE *: *VEGETATION/i.test(almanacEntry.traitsString)) {\n        id = \"vegetation\";\n        type = (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).HIDDEN_ARTEFACT;\n    } else switch(almanacEntry.type.id){\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).SPELL.id:\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).CANTRIP.id:\n            id = \"engraved_pillar\";\n            type = (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).PROP;\n            break;\n        default:\n            {\n                const roll = (0, $a4035ea4d528e431$export$b9d1fef74bbc4c0c)(6);\n                if (roll < 3) id = \"hidden_artefact\";\n                else if (roll < 5) id = \"trapdoor\";\n                else id = \"manhole_cover\";\n            }\n            type = (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).HIDDEN_ARTEFACT;\n            break;\n    }\n    const actor = (0, $d8cd23d1a2971b65$export$260a0189ba712b47)({\n        id: id,\n        name: $63e994f329905eac$export$9544647517c5db11(id),\n        description: $63e994f329905eac$export$83737b3fc54f1416(id),\n        imageName: id,\n        type: type,\n        traitsString: \"\"\n    });\n    const artefact = preBuiltArtefact ?? (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(almanacEntry);\n    actor.storeManager.addArtefact(artefact);\n    return actor;\n}\n/**\n * Create the artefacts.\n * @param {SceneDefinition} sceneDefn\n * @returns {Actor[]}\n */ function $b618d869f3b8e384$var$createArtefacts(sceneDefn) {\n    const artefacts = [];\n    sceneDefn.artefacts.forEach((almanacEntry)=>{\n        const holdingActor = $b618d869f3b8e384$var$createFindableArtefact(almanacEntry);\n        artefacts.push(holdingActor);\n    });\n    return artefacts;\n}\n/**\n * Add an artefact from the almanac.\n * @param {Actor[]} actors\n * @param {AlmanacEntry} almanacEntry\n * @param {Object} options\n * @param {boolean} options.equip - if true, try to equip rather than stash.\n */ function $b618d869f3b8e384$var$addArtefactToActor(actor, almanacEntry, options) {\n    if (almanacEntry) {\n        const artefact = (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(almanacEntry);\n        if (options.equip && artefact.equipStoreType) actor.storeManager?.equip(artefact, {\n            direct: true\n        });\n        else actor.storeManager?.stash(artefact, {\n            direct: true\n        });\n    }\n}\n/**\n * Add an artefact from the almanac.\n * @param {Actor[]} actors\n * @param {Almanac} almanac\n * @param {Object} options\n * @param {number} options.qty - number to add.\n * @param {boolean} options.equip - if true, try to equip rather than stash.\n */ function $b618d869f3b8e384$var$addRandomArtefactsToActor(actor, almanac, options) {\n    while(options.qty-- > 0){\n        const almanacEntry = almanac.getRandomEntry();\n        $b618d869f3b8e384$var$addArtefactToActor(actor, almanacEntry, options);\n    }\n}\n/**\n * Scene created from a scene definition.\n */ class $b618d869f3b8e384$var$ParsedScene extends (0, $65611a44f4d7d3b3$export$765fdbac0eda2a0b) {\n    /** @type {SceneDefinition} */ #sceneDefn;\n    /** Construct the scene from a definition. */ constructor(sceneDefn){\n        super();\n        this.#sceneDefn = sceneDefn;\n        this.intro = sceneDefn.intro;\n    }\n    /** @override */ doLoad() {\n        return Promise.resolve();\n    }\n    doInitialise() {\n        const tilePlan = (0, $87eafdba0a48c3b2$export$5bb21ea01a6aaf38).generateTileMapPlan(this.#sceneDefn.mapDesign, (0, $20be302081331f54$export$7dccdb77f761a8ef));\n        this.heroActor = $b618d869f3b8e384$var$createHero(this.#sceneDefn);\n        const tileMap = new (0, $ac2e0e274b6f5d79$export$16ec26812de3ce7a)((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), tilePlan, $b618d869f3b8e384$var$GRID_SIZE, this.heroActor);\n        (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).setTileMap(tileMap);\n        let portal = $b618d869f3b8e384$var$createPortal(this.#sceneDefn);\n        if (portal) {\n            const freeTile = tileMap.getRandomFreeGroundTile();\n            if (freeTile) {\n                portal.position = freeTile.worldPoint;\n                (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).addArtefact(portal);\n            } else {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"No free tiles for portal.\");\n                portal = null;\n            }\n        }\n        const exitKeyAlmanacEntry = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).getRandomEntry(\"KEYS\");\n        const exitKeyArtefact = (0, $a4035ea4d528e431$export$b9d1fef74bbc4c0c)(6) > 3 ? (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(exitKeyAlmanacEntry) : null;\n        let keysToAdd = exitKeyArtefact ? 1 : 0;\n        const pooledArtefactAlmanac = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).getPooledAlmanac([\n            \"ARTEFACTS\",\n            \"ARMOUR\",\n            \"WEAPONS\"\n        ], (entry)=>entry.minLevel <= (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).getCurrentSceneLevel());\n        const water = pooledArtefactAlmanac.find((entry)=>entry.id === \"waterskin\");\n        const rations = pooledArtefactAlmanac.find((entry)=>entry.id === \"iron_rations\");\n        for (const enemy of $b618d869f3b8e384$var$createEnemies(this.#sceneDefn)){\n            const freeTile = tileMap.getRandomFreeGroundTile();\n            if (!freeTile) {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"No free tiles for enemy.\");\n                break;\n            }\n            enemy.position = freeTile.worldPoint;\n            (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).addActor(enemy);\n            if (enemy.isTrader()) {\n                enemy.traits.exceedAbilitiesAndExp?.(this.heroActor.traits, 1);\n                let qtyOfItems = 7;\n                if ((0, $a4035ea4d528e431$export$b9d1fef74bbc4c0c)(6) > 3) {\n                    $b618d869f3b8e384$var$addArtefactToActor(enemy, water, {\n                        equip: false\n                    });\n                    qtyOfItems--;\n                }\n                if ((0, $a4035ea4d528e431$export$b9d1fef74bbc4c0c)(6) > 3) {\n                    $b618d869f3b8e384$var$addArtefactToActor(enemy, rations, {\n                        equip: false\n                    });\n                    qtyOfItems--;\n                }\n                $b618d869f3b8e384$var$addRandomArtefactsToActor(enemy, pooledArtefactAlmanac, {\n                    qty: qtyOfItems,\n                    equip: false\n                });\n            } else if (keysToAdd && !enemy.isOrganic() && enemy.traits.get(\"HAS_KEYS\")) {\n                enemy.storeManager.stash(exitKeyArtefact, {\n                    direct: true\n                });\n                keysToAdd = 0;\n                (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Added key to actor.\");\n            }\n        }\n        if (keysToAdd) {\n            const holdingActor = $b618d869f3b8e384$var$createFindableArtefact(exitKeyAlmanacEntry, exitKeyArtefact);\n            const freeTile = tileMap.getRandomFreeGroundTile();\n            if (freeTile) {\n                holdingActor.position = freeTile.worldPoint;\n                (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).addArtefact(holdingActor);\n                keysToAdd = 0;\n                (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Added key as hidden object.\");\n            }\n        }\n        for (const artefact of $b618d869f3b8e384$var$createArtefacts(this.#sceneDefn)){\n            const freeTile = tileMap.getRandomFreeGroundTile();\n            if (!freeTile) {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"No free tile to add artefact.\");\n                break;\n            }\n            artefact.position = freeTile.worldPoint;\n            (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).addArtefact(artefact);\n        }\n        (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).setCameraToTrack(this.heroActor.sprite, 200, 0);\n        (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).addActor(this.heroActor);\n        (0, $6e0aaad189039339$export$2e2bcd8739ae039).setHero(this.heroActor);\n        // if keysToAdd > 0 we couldn't find a free tile for it, son don't use.\n        if (keysToAdd > 0) (0, $6e0aaad189039339$export$2e2bcd8739ae039).setExitKeyArtefact(null);\n        else (0, $6e0aaad189039339$export$2e2bcd8739ae039).setExitKeyArtefact(exitKeyArtefact);\n        return Promise.resolve();\n    }\n    /**\n   * @override\n   */ doUpdate(deltaSecondsUnused) {\n        return;\n    }\n    /**\n   * @override\n   */ doUnload() {\n        return Promise.resolve(null);\n    }\n}\nfunction $b618d869f3b8e384$export$cc8138686166266c(sceneDefn) {\n    return new $b618d869f3b8e384$var$ParsedScene(sceneDefn);\n}\n\n\n\n/**\n * @file Navigation button set for the HUD\n *\n * @module hud/hudNavSet\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n/**\n * @file Camera dolly class. This provides a mechanism to allow the canvas to\n * track a specified Sprite.\n *\n * @module game/camera\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\n\nconst $a102cd63725cc805$export$17735bdb93cbf279 = {\n    OFF: 0,\n    HERO: 1,\n    VELOCITY: 2\n};\nclass $a102cd63725cc805$export$39ca3bda943df04d {\n    /** @type {module:utils/sprites/sprite~Sprite} */ #sprite;\n    /** @type {module:utils/sprites/modifiers~AbstractModifier} */ #heroTracker;\n    /** @type {module:utils/sprites/modifiers~AbstractModifier} */ #velocityTracker;\n    /** @type {number} */ #trackingMethod;\n    /**\n   * Create a camera dolly. This is a sprite that is designed to track a target.\n   * @param {module:utils/sprites/sprites.Sprite} target\n   * @param {number} speed\n   * @param {number} proportionSeparated - max space between camera and target as proportion of minimum screen dimension.\n   */ constructor(target, speed, proportionSeparated = 0){\n        const canvasDims = (0, $7aed85f370071bde$export$2e2bcd8739ae039).getCanvasDimensions();\n        const separation = proportionSeparated * Math.min(canvasDims.width, canvasDims.height);\n        this.#sprite = new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)();\n        this.#heroTracker = new (0, $8e5c8f9d0e1a3528$export$254d9747e34ddc90)({\n            prey: target,\n            speed: speed,\n            maxSeparation: separation\n        });\n        this.#velocityTracker = new (0, $8e5c8f9d0e1a3528$export$9600794ac1f85e81)();\n        this.#heroTracker.applyAsContinuousToSprite(this.#sprite);\n    }\n    /**\n   * Update the camera position.\n   * @param {number} deltaSeconds - elapsed time since last update.\n   */ update(deltaSeconds) {\n        if (this.#trackingMethod !== $a102cd63725cc805$export$17735bdb93cbf279.OFF) {\n            this.#sprite.update(deltaSeconds);\n            (0, $7aed85f370071bde$export$2e2bcd8739ae039).centreCanvasOn(this.#sprite.position);\n        }\n    }\n    /**\n   * Set the velocity to dX, dY. This will automatically set tracking to velocity.\n   * @param {number} dX\n   * @param {number} dY\n   */ setVelocity(vX, vY) {\n        this.setTrackingMethod($a102cd63725cc805$export$17735bdb93cbf279.VELOCITY);\n        this.#sprite.velocity.x = vX;\n        this.#sprite.velocity.y = vY;\n    }\n    /**\n   * Pan the camera by dx, dy. Automatic tracking is switched off.\n   * @param {number} dx\n   * @param {number} dy\n   */ panBy(dx, dy) {\n        this.#sprite.position.x += dx;\n        this.#sprite.position.y += dy;\n        (0, $7aed85f370071bde$export$2e2bcd8739ae039).centreCanvasOn(this.#sprite.position);\n    }\n    /**\n   * Set the trackingMethod\n   * @param {number} method - CameraTracking enum\n   */ setTrackingMethod(method) {\n        if (method === this.#trackingMethod) return;\n        this.#trackingMethod = method;\n        switch(method){\n            case $a102cd63725cc805$export$17735bdb93cbf279.HERO:\n                this.#heroTracker.applyAsContinuousToSprite(this.#sprite);\n                break;\n            case $a102cd63725cc805$export$17735bdb93cbf279.VELOCITY:\n                this.#velocityTracker.applyAsContinuousToSprite(this.#sprite);\n                break;\n            case $a102cd63725cc805$export$17735bdb93cbf279.OFF:\n                break;\n            default:\n                (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Attempt to set invalid tracking method of ${method} ignored.`);\n        }\n    }\n}\n\n\n\n\n\n/**\n * @type {number}\n */ const $188f4f09d5382053$var$SCROLL_TILES_PER_SEC = 3;\nconst $188f4f09d5382053$export$763f95e026c05695 = {\n    TR: 0,\n    BR: 1,\n    BL: 2,\n    TL: 3\n};\nclass $188f4f09d5382053$export$5e8c6d32f039cdeb {\n    /** @type {CameraDolly} */ #cameraDolly;\n    /** @type {module:players/actors.Actor} */ #trackingButton;\n    /** @type {module:utils/sprites/imageManager~SpriteBitmap} */ #trackingButtonImage;\n    /**\n   *\n   * @param {CameraDolly} cameraDolly\n   * @param {number} gridSize\n   * @param {NavigationLocation} locationNav\n   * @param {NavigationLocation} locationFullscreen\n   */ constructor(cameraDolly, gridSize, locationNav, locationFullscreen){\n        this.#cameraDolly = cameraDolly;\n        this.#createButtonSet(gridSize, locationNav, false);\n        this.#createSettingsButton(gridSize, locationFullscreen);\n    /* not required\n    this.#createFullscreenButton(gridSize, locationFullscreen, {\n      x: gridSize,\n      y: 0,\n    });\n    */ }\n    /**\n   * Create the button to handle showing settings.\n   */ #createSettingsButton(gridSize, location) {\n        const buttonImage = new (0, $305a56b3d2c1570b$export$9d5734c725768403)({\n            prefix: \"ui-settings\",\n            startIndex: 0,\n            padding: 2,\n            suffix: \".png\"\n        }, {\n            framePeriodMs: 1,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).STOP\n        });\n        const settingsButton = (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).addButton(buttonImage, ()=>(0, $09b31fa5c65d5acd$export$7da80b63b5cb0fd0)());\n        const centre = this.#getLocationPoint(gridSize, location, 1);\n        settingsButton.position.x = centre.x;\n        settingsButton.position.y = centre.y;\n    }\n    /**\n   * Create the button to handle showing settings.\n   * @param {number} gridSize\n   * @param {NavigationLocation} location\n   * @param {Object} offset\n   * @param {number} offset.x\n   * @param {number} offset.y\n   *\n   */ #createFullscreenButton(gridSize, location, offset) {\n        const buttonImage = new (0, $305a56b3d2c1570b$export$9d5734c725768403)({\n            prefix: \"hud-fullscreen\",\n            startIndex: 0,\n            padding: 2,\n            suffix: \".png\"\n        }, {\n            framePeriodMs: 1,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).STOP\n        });\n        const fullscreenButton = (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).addButton(buttonImage, ()=>{\n            document.body.requestFullscreen?.({\n                navigationUI: \"hide\"\n            });\n        }, ()=>{\n            document.exitFullscreen?.();\n        });\n        const centre = this.#getLocationPoint(gridSize, location, 1);\n        fullscreenButton.position.x = centre.x + offset.x;\n        fullscreenButton.position.y = centre.y + offset.y;\n        window.addEventListener(\"fullscreenchange\", ()=>{\n            if (document.fullscreenElement) {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Switched to fullscreen mode.\");\n                buttonImage.setCurrentIndex(1);\n            } else {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"Exited fullscreen mode.\");\n                buttonImage.setCurrentIndex(0);\n            }\n        });\n    }\n    /** Get centre point information\n   * @param {number} gridSize - tile size\n   * @param {NavigationLocation} location\n   * @param {number} offset - offset applied to location.\n   * This grid units (i.e. tiles).\n   * @returns {Point}\n   */ #getLocationPoint(gridSize, location, offset) {\n        const point = new (0, $9181799b149b64a5$export$baf26146a414f24a)(0, 0);\n        switch(location){\n            case $188f4f09d5382053$export$763f95e026c05695.TL:\n                point.x = offset * gridSize;\n                point.y = offset * gridSize;\n                break;\n            case $188f4f09d5382053$export$763f95e026c05695.TR:\n                point.x = -offset * gridSize;\n                point.y = offset * gridSize;\n                break;\n            case $188f4f09d5382053$export$763f95e026c05695.BR:\n                point.x = -offset * gridSize;\n                point.y = -offset * gridSize;\n                break;\n            case $188f4f09d5382053$export$763f95e026c05695.BL:\n                point.x = offset * gridSize;\n                point.y = -offset * gridSize;\n                break;\n        }\n        return point;\n    }\n    /**\n   * Create the buttons.\n   * @param {number} gridSize\n   * @param {NavigationLocation} location\n   * @param {boolean} showArrows\n   */ #createButtonSet(gridSize, location, showArrows) {\n        const offset = showArrows ? 2 : 1;\n        const centre = this.#getLocationPoint(gridSize, location, offset);\n        this.#createCentreButton(centre.x, centre.y);\n        if (showArrows) this.#createArrowButtons(centre.x, centre.y, gridSize);\n    }\n    /** Create the centre button.\n   * @param {number} centreX\n   * @param {number} centreY\n   */ #createCentreButton(centreX, centreY) {\n        this.#trackingButtonImage = new (0, $305a56b3d2c1570b$export$9d5734c725768403)({\n            prefix: \"hud-auto-centre\",\n            startIndex: 0,\n            padding: 2,\n            suffix: \".png\"\n        }, {\n            framePeriodMs: 1,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).STOP\n        });\n        this.#trackingButton = (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).addButton(this.#trackingButtonImage, ()=>{\n            this.setTrackingState(true);\n        }, ()=>{\n            this.setTrackingState(false);\n        });\n        this.#trackingButton.position.x = centreX;\n        this.#trackingButton.position.y = centreY;\n        this.#trackingButton.actionClick(null); // defaulting to selected.\n    }\n    /**\n   * Set the tracking state.\n   * @param {boolean} on\n   */ setTrackingState(on) {\n        if (on) {\n            this.#trackingButtonImage.setCurrentIndex(1);\n            this.#cameraDolly.setTrackingMethod((0, $a102cd63725cc805$export$17735bdb93cbf279).HERO);\n        } else {\n            this.#trackingButtonImage.setCurrentIndex(0);\n            this.#cameraDolly.setTrackingMethod((0, $a102cd63725cc805$export$17735bdb93cbf279).OFF);\n        }\n    }\n    /**\n   * Create the arrow buttons\n   * @param {number} centreX\n   * @param {number} centreY\n   * @param {number} gridSize\n   */ #createArrowButtons(centreX, centreY, gridSize) {\n        const scrollSpeed = $188f4f09d5382053$var$SCROLL_TILES_PER_SEC * gridSize;\n        this.#createMomentaryButton(\"hud-arrow-up\", centreX, centreY - gridSize, ()=>{\n            this.setTrackingState(false);\n            this.#cameraDolly.setVelocity(0, -scrollSpeed);\n        }, ()=>this.#cameraDolly.setTrackingMethod((0, $a102cd63725cc805$export$17735bdb93cbf279).OFF));\n        this.#createMomentaryButton(\"hud-arrow-right\", centreX + gridSize, centreY, ()=>{\n            this.setTrackingState(false);\n            this.#cameraDolly.setVelocity(scrollSpeed, 0);\n        }, ()=>this.#cameraDolly.setTrackingMethod((0, $a102cd63725cc805$export$17735bdb93cbf279).OFF));\n        this.#createMomentaryButton(\"hud-arrow-down\", centreX, centreY + gridSize, ()=>{\n            this.setTrackingState(false);\n            this.#cameraDolly.setVelocity(0, scrollSpeed);\n        }, ()=>this.#cameraDolly.setTrackingMethod((0, $a102cd63725cc805$export$17735bdb93cbf279).OFF));\n        this.#createMomentaryButton(\"hud-arrow-left\", centreX - gridSize, centreY, ()=>{\n            this.setTrackingState(false);\n            this.#cameraDolly.setVelocity(-scrollSpeed, 0);\n        }, ()=>this.#cameraDolly.setTrackingMethod((0, $a102cd63725cc805$export$17735bdb93cbf279).OFF));\n    }\n    /**\n   * Create a momentary button.\n   * @param {string} imageNamePrefix - images are assumed to be imageNamePrefixNNN.png\n   * @param {number} x - x position\n   * @param {number} y - y position\n   * @param {function} callbackDown\n   * @param {function} callbackUp\n   */ #createMomentaryButton(imageNamePrefix, x, y, callbackDown, callbackUp) {\n        const animatedImage = new (0, $305a56b3d2c1570b$export$9d5734c725768403)({\n            prefix: imageNamePrefix,\n            startIndex: 0,\n            padding: 2,\n            suffix: \".png\"\n        }, {\n            framePeriodMs: 1,\n            loopMethod: (0, $53f7efcdef9156d3$export$cab6ba75b045ad71).STOP\n        });\n        let button = (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).addMomentaryButton(animatedImage, callbackDown, callbackUp);\n        button.position.x = x;\n        button.position.y = y;\n        animatedImage.setCurrentIndex(0);\n    }\n}\n\n\n\n\n\n/**\n * @interface SceneList\n */ /**\n * Get the next scene.\n * @function SceneList.getNext\n * @param{number} index\n * @returns {SceneDefinition}\n *\n */ /**\n * Has another scene.\n * @function SceneList.hasNext\n * @returns {boolean}\n *\n */ /**\n * Reset to the first scene.\n * @function SceneList.reset\n */ /**\n * Get the scene index. This will be the index of the last scene retrieved by\n * a call to getNext.\n * @function SceneList.getIndex\n * @returns {number}\n */ /**\n * Restore a saved game\n * @function SceneList.restore\n * @param {number} index\n * @param {module:players/actors.Actor} hero\n */ /** @type {module:utils/sprites/sprite~Sprite}  */ let $cd2e32752119e7f3$var$cameraDolly;\n/** @type {SceneList} */ let $cd2e32752119e7f3$var$sceneDefnList;\nlet $cd2e32752119e7f3$var$currentScene;\nlet $cd2e32752119e7f3$var$navigationButtons;\nclass $cd2e32752119e7f3$export$2a8e6ebcf5b5c91 {\n    /** @type {string} */ intro;\n    /** @type {Actor | ActorDefn} */ hero;\n    /** @type {ActorDefn[]} */ enemies;\n    /** @type {ActorDefn[]} */ artefacts;\n    /** @type {string[]} */ mapDesign;\n    /** @type {ActorDefn[]} */ portal;\n    /**\n   * Construct an empty scene\n   */ constructor(){\n        this.hero = null;\n        this.enemies = [];\n        this.artefacts = [];\n        this.mapDesign = [];\n    }\n}\n/**\n * Set camera dolly\n * @param {module:utils/sprites/sprite~Sprite} sprite\n * @param {number} speed - See {@link module:game/camera.createCameraDolly}\n * @param {number} proportionSeparated - See {@link module:game/camera.createCameraDolly}\n */ function $cd2e32752119e7f3$var$setCameraToTrack(sprite, speed, proportionSeparated) {\n    $cd2e32752119e7f3$var$cameraDolly = new (0, $a102cd63725cc805$export$39ca3bda943df04d)(sprite, speed, proportionSeparated);\n}\n/**\n * Create the HUD\n */ function $cd2e32752119e7f3$var$createHud() {\n    $cd2e32752119e7f3$var$navigationButtons = new (0, $188f4f09d5382053$export$5e8c6d32f039cdeb)($cd2e32752119e7f3$var$cameraDolly, 48, (0, $188f4f09d5382053$export$763f95e026c05695).BR, (0, $188f4f09d5382053$export$763f95e026c05695).BL);\n    (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).setVisible(true);\n}\n/**\n * Clear the HUD.\n */ function $cd2e32752119e7f3$var$clearHud() {\n    $cd2e32752119e7f3$var$navigationButtons = null;\n    (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).clear();\n    (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).setVisible(false);\n}\n/** Set the current scene, unloading any existing scene\n * @param {module:game/scene~Scene} scene\n * @returns {Promise} fulfils to undefined.\n * Rejects if scene is undefined or null.\n */ function $cd2e32752119e7f3$var$setScene(scene) {\n    if (!scene) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Attempt made to switch to the next scene when there are no more.\");\n        return Promise.reject();\n    }\n    return $cd2e32752119e7f3$var$unloadScene($cd2e32752119e7f3$var$currentScene).then(()=>$cd2e32752119e7f3$var$loadScene(scene)).then(()=>scene);\n}\n/**\n * Load scene\n * @param {module:game/scene~Scene} scene\n * @returns {Promise} fulfills to null\n */ function $cd2e32752119e7f3$var$loadScene(scene) {\n    return scene.load().then(()=>scene.initialise()).then(()=>{\n        $cd2e32752119e7f3$var$createHud();\n        $cd2e32752119e7f3$var$currentScene = scene;\n    });\n}\n/**\n * Unload scene. This can be safely called even if the\n * current scene has already been unloaded.\n * @param {module:game/scene~Scene} scene\n * @returns {Promise} fulfills to null\n */ function $cd2e32752119e7f3$var$unloadScene(scene) {\n    if (scene) return scene.unload().then(()=>{\n        (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).clearAll();\n        $cd2e32752119e7f3$var$currentScene = null;\n        $cd2e32752119e7f3$var$clearHud();\n        return Promise.resolve();\n    });\n    else return Promise.resolve(null);\n}\n/**\n * Unload current scene\n * @returns {Promise} fulfills to null\n */ function $cd2e32752119e7f3$var$unloadCurrentScene() {\n    return $cd2e32752119e7f3$var$unloadScene($cd2e32752119e7f3$var$currentScene);\n}\n/**\n * Configure the scenes from the script.\n * @param {module:gameManagement/sceneManager~SceneDefinition} listOfScenes\n */ function $cd2e32752119e7f3$var$setSceneList(listOfScenes) {\n    $cd2e32752119e7f3$var$sceneDefnList = listOfScenes;\n    $cd2e32752119e7f3$var$sceneDefnList.reset();\n}\n/**\n * Test to see if there are more scenes.\n * @returns {boolean}\n */ function $cd2e32752119e7f3$var$areThereMoreScenes() {\n    return $cd2e32752119e7f3$var$sceneDefnList.hasNext();\n}\n/**\n * Continue from a saved scene.\n * @param {number} savedSceneLevel\n * @param {module:players/actors.Actor} savedHero\n * @returns {Promise} fulfils to the loaded scene.\n * Rejects if no scenes.\n */ function $cd2e32752119e7f3$var$continueFromSavedScene(savedSceneLevel, savedHero) {\n    $cd2e32752119e7f3$var$sceneDefnList.restore(savedSceneLevel, savedHero);\n    return $cd2e32752119e7f3$var$setScene($cd2e32752119e7f3$var$getNextSceneFromList());\n}\n/**\n * Switch to the first scene.\n * @returns {Promise} fulfils to the loaded scene.\n * Rejects if no scenes.\n */ function $cd2e32752119e7f3$var$switchToFirstScene() {\n    $cd2e32752119e7f3$var$sceneDefnList.reset();\n    return $cd2e32752119e7f3$var$setScene($cd2e32752119e7f3$var$getNextSceneFromList());\n}\n/**\n * Switch to the next scene.\n * @returns {Promise} fulfils to the loaded scene.\n * Rejects if there are no more.\n */ function $cd2e32752119e7f3$var$switchToNextScene() {\n    return $cd2e32752119e7f3$var$setScene($cd2e32752119e7f3$var$getNextSceneFromList());\n}\n/**\n * Gets the next scene from the scene definition list.\n * @returns {Scene}\n */ function $cd2e32752119e7f3$var$getNextSceneFromList() {\n    return (0, $b618d869f3b8e384$export$cc8138686166266c)($cd2e32752119e7f3$var$sceneDefnList.getNext());\n}\n/**\n * UPdate the scene\n * @param {number} deltaSeconds\n */ function $cd2e32752119e7f3$var$update(deltaSeconds) {\n    $cd2e32752119e7f3$var$currentScene?.update(deltaSeconds);\n    $cd2e32752119e7f3$var$cameraDolly?.update(deltaSeconds);\n}\n/**\n * Pan the camera.\n * @param {number} dx\n * @param {number} dy\n */ function $cd2e32752119e7f3$var$panCameraBy(dx, dy) {\n    if ($cd2e32752119e7f3$var$cameraDolly && $cd2e32752119e7f3$var$navigationButtons) {\n        $cd2e32752119e7f3$var$cameraDolly.panBy(dx, dy);\n        $cd2e32752119e7f3$var$cameraDolly.setTrackingMethod((0, $a102cd63725cc805$export$17735bdb93cbf279).OFF);\n        $cd2e32752119e7f3$var$navigationButtons.setTrackingState(false);\n    }\n}\n/**\n * Get the current scene level.\n * @returns {number}\n */ function $cd2e32752119e7f3$var$getCurrentSceneLevel() {\n    return $cd2e32752119e7f3$var$sceneDefnList.getIndex();\n}\n/**\n * Get the current scene intro.\n * @returns {string} undefined if not set\n */ function $cd2e32752119e7f3$var$getCurrentSceneIntro() {\n    return $cd2e32752119e7f3$var$sceneDefnList.intro;\n}\n/**\n * Set the dungeon challenge.\n * @param {module:scriptReaders/autoSceneList~DungeonChallengeValue} challenge\n */ function $cd2e32752119e7f3$var$setDungeonChallenge(challenge) {\n    if ($cd2e32752119e7f3$var$sceneDefnList.setChallenge) $cd2e32752119e7f3$var$sceneDefnList.setChallenge(challenge);\n    else (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Attempt to setDungeonChallenge on list that does not support it.\");\n}\n/**\n * SCENE_MANAGER Singleton.\n */ const $cd2e32752119e7f3$var$SCENE_MANAGER = {\n    areThereMoreScenes: $cd2e32752119e7f3$var$areThereMoreScenes,\n    continueFromSavedScene: $cd2e32752119e7f3$var$continueFromSavedScene,\n    getCurrentSceneLevel: $cd2e32752119e7f3$var$getCurrentSceneLevel,\n    getCurrentSceneIntro: $cd2e32752119e7f3$var$getCurrentSceneIntro,\n    panCameraBy: $cd2e32752119e7f3$var$panCameraBy,\n    setCameraToTrack: $cd2e32752119e7f3$var$setCameraToTrack,\n    setDungeonChallenge: $cd2e32752119e7f3$var$setDungeonChallenge,\n    setSceneList: $cd2e32752119e7f3$var$setSceneList,\n    switchToFirstScene: $cd2e32752119e7f3$var$switchToFirstScene,\n    switchToNextScene: $cd2e32752119e7f3$var$switchToNextScene,\n    unloadCurrentScene: $cd2e32752119e7f3$var$unloadCurrentScene,\n    update: $cd2e32752119e7f3$var$update\n};\nvar $cd2e32752119e7f3$export$2e2bcd8739ae039 = $cd2e32752119e7f3$var$SCENE_MANAGER;\n\n\n\n\n\n\n\n\nconst $b5bda9c98c481f6f$export$30b1e0f61711dee7 = {\n    VIEW: 0,\n    SELL: 1,\n    PILLAGE: 2,\n    FIND: 3\n};\n/**\n * ArtefactActions\n * @enum {string}\n */ const $b5bda9c98c481f6f$var$ArtefactAction = {\n    CONTINUE: \"continue\",\n    CONSUME: \"consume\",\n    LEAVE: \"leave\",\n    LEARN_SPELL: \"learn\",\n    DISCARD: \"discard\",\n    EQUIP: \"equip\",\n    PREPARE_SPELL: \"prepare\",\n    STASH: \"stash\",\n    TAKE: \"take\",\n    SELL: \"sell\",\n    PILLAGE: \"pillage\",\n    USE: \"use\"\n};\n/**\n * @typedef {Object} ArtefactDialogOptions\n * @property {module:players/actors.Actor} currentOwner - who currently owns the artefact.\n * @property {module:players/actors.Actor} prospectiveOwner - who currently owns the artefact.\n * @property {boolean} allowMagicUse - allow an item to be used.\n * @property {boolean} allowConsumption - allow an item to be consumed.\n * @property {boolean} allowSpellPrep - allow a spell to be prepared.\n * @property {module:players/artefacts.Artefact} artefact - the item .\n * @property {StoreType} storeType\n * @property {ArtefactActionTypeValue} actionType\n * @param {function(noChain:boolean):Promise} refresh - function to call if storage changed.\n * if noChain is set, linkedInventories are not called. This is used to prevent\n * circular loops.\n * @param {boolean} showPrice\n * @param {boolean} showDamage - add damage detail to button labels.\n * @param {string} delayedReaction - If true, clicking on the\n * artefact will close the dialog and it will return a DelayedAction response.\n */ /**\n * @typedef {Object} DelayedAction\n * @property {function():Promise} invoke - function that can be called to instigate the\n * delayed action.\n */ /**\n * @typedef {string} InventoryLimitationValue\n */ /**\n * @enum {InventoryLimitationValue}\n */ const $b5bda9c98c481f6f$var$InventoryLimitation = {\n    STANDARD: \"standard\",\n    STASH_ONLY: \"stash\",\n    SPELLS: \"spells\",\n    MAGIC: \"magic\",\n    READY_MAGIC: \"ready magic\",\n    CANTRIPS: \"cantrips\"\n};\n/**\n * @typedef {Object} InventoryOptions\n * @property {InventoryLimitationValue} limitation\n * @property {InventoryOptions} linkedInventory - this will be refreshed at the same\n * time as the inventory.\n * @property {function()} onRefresh - function to call on an inventory refresh.\n **/ /**\n * Container for an inventory.\n */ class $b5bda9c98c481f6f$var$InventoryContainerElement {\n    /** @type {ArtefactDialogOptions} */ #options;\n    /** @type {InventoryOptions} */ #inventoryOptions;\n    /** @type {Element} */ #content;\n    /** This will be refresh when this is refreshed. @type {InventoryContainerElement} */ linkedInventory;\n    /** Action buttons @type {BaseControl[]} */ #actionButtons;\n    /**\n   * Construct\n   * @param {ArtefactDialogOptions} options;\n   * @param {InventoryOptions} inventoryOptions\n   */ constructor(options, inventoryOptions = {}){\n        this.#options = options;\n        this.#inventoryOptions = inventoryOptions;\n        this.#content = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n            className: \"stores\"\n        });\n        this.refresh();\n    }\n    /**\n   * Get the container element\n   * @returns {Element}\n   */ get element() {\n        return this.#content;\n    }\n    /**\n   * Get the container action buttons.\n   * @returns {BaseControl[]}\n   */ get actionButtons() {\n        return this.#actionButtons;\n    }\n    /**\n   * Rebuild the list.\n   * @param {boolean} noChain - prevent calls to linkedInventories.\n   */ refresh(noChain) {\n        let empty = true;\n        this.#actionButtons = [];\n        if (!noChain && this.linkedInventory) this.linkedInventory.refresh(true); // suppress linking\n        this.#content.replaceChildren();\n        if (!this.#options.currentOwner.isHero() || this.#options.currentOwner.alive) {\n            let storesToShow = this.#getStoresToShow();\n            storesToShow.forEach((storeInfo)=>{\n                const contents = this.#options.currentOwner.storeManager.getStoreContents(storeInfo.storeType);\n                if (contents) {\n                    empty = false;\n                    const storeContentsElement = this.#createStoreContents(storeInfo.label, storeInfo.storeType, contents);\n                    this.#content.appendChild(storeContentsElement);\n                }\n            });\n        }\n        if (empty) {\n            let emptyMessage;\n            if (this.#options.currentOwner.isHero() && !this.#options.currentOwner.alive) emptyMessage = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE DEAD HERO HAS NO INVENTORY`;\n            else emptyMessage = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE NOTHING HERE`;\n            this.#content.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n                text: emptyMessage\n            }));\n        }\n        if (this.#inventoryOptions.onRefresh) this.#inventoryOptions.onRefresh();\n    }\n    /**\n   * Get array of stores to show.\n   * @return {{label: string, storeType: StoreType}}\n   */ #getStoresToShow() {\n        let storesToShow;\n        switch(this.#inventoryOptions.limitation){\n            case $b5bda9c98c481f6f$var$InventoryLimitation.SPELLS:\n                storesToShow = [\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Prepared spells`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).PREPARED_SPELLS\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Known spells`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).SPELLS\n                    }\n                ];\n                break;\n            case $b5bda9c98c481f6f$var$InventoryLimitation.MAGIC:\n                storesToShow = [\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Cantrips`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).CANTRIPS\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Prepared spells`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).PREPARED_SPELLS\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Known spells`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).SPELLS\n                    }\n                ];\n                break;\n            case $b5bda9c98c481f6f$var$InventoryLimitation.READY_MAGIC:\n                storesToShow = [\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Ready magic`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).PREPARED_SPELLS\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Cantrips`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).CANTRIPS\n                    }\n                ];\n                break;\n            case $b5bda9c98c481f6f$var$InventoryLimitation.CANTRIPS:\n                (0, $547c634f23f1bc62$export$39337ab5872e9457).CANTRIPS;\n                break;\n            case $b5bda9c98c481f6f$var$InventoryLimitation.STASH_ONLY:\n                storesToShow = [\n                    this.#getStashStoreInfo()\n                ];\n                break;\n            case $b5bda9c98c481f6f$var$InventoryLimitation.STANDARD:\n            default:\n                storesToShow = [\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Purse`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).PURSE\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Head`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).HEAD\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Body`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).BODY\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Waist`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).WAIST\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Hands`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).HANDS\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Ring fingers`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).RING_FINGERS\n                    },\n                    {\n                        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Feet`,\n                        storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).FEET\n                    },\n                    this.#getStashStoreInfo()\n                ];\n                break;\n        }\n        return storesToShow;\n    }\n    /** Get the stash store for the actor.\n   * This gets the WAGON for a trader\n   * @returns {{label:string,storeType:StoreType}}\n   */ #getStashStoreInfo() {\n        if (this.#options.currentOwner.isTrader()) return {\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Wagon`,\n            storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).WAGON\n        };\n        else return {\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Backpack`,\n            storeType: (0, $547c634f23f1bc62$export$39337ab5872e9457).BACKPACK\n        };\n    }\n    /**\n   * Create element showing store contents. Buttons created are pushed to\n   * this.#actionButtons.\n   * @param {string} label\n   * @param {StoreTypeValue} storeType\n   * @param {Iterator<Artefact>} contents\n   * @returns {Element}\n   */ #createStoreContents(label, storeType, contents) {\n        const container = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n            className: \"store\"\n        });\n        container.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"span\", {\n            className: \"store-label\",\n            text: label\n        }));\n        const contentsElement = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n            className: \"store-contents\"\n        });\n        container.appendChild(contentsElement);\n        [\n            ...contents\n        ].sort((a, b)=>a.id < b.id ? -1 : 1).forEach((artefact)=>{\n            const options = {\n                ...this.#options\n            };\n            options.refresh = this.refresh.bind(this);\n            options.storeType = storeType;\n            options.artefact = artefact;\n            let button;\n            if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).SPELL) && options.allowMagicUse && !(0, $a7679a1c33accf76$export$5bad22818946aef6)(options.currentOwner.traits, artefact.traits)) button = this.#createUncastableSpellButtonControl(options);\n            else button = this.#createArtefactButtonControl(options);\n            if (button.closes !== null && button.closes !== undefined) this.#actionButtons.push(button);\n            contentsElement.appendChild(button.element);\n        });\n        return container;\n    }\n    /**\n   * Create an artefact button. If a custom action is set, the button is a closer.\n   * Otherwise it just pops up a dialog giving details about the artefact.\n   * @param {ArtefactDialogOptions} options\n   * @returns {components.BitmapButtonControl}\n   */ #createUncastableSpellButtonControl(options) {\n        const label = $b5bda9c98c481f6f$var$createArtefactButtonLabel(options);\n        let action;\n        action = async ()=>{\n            await (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE NO CASTING POWER LEFT`);\n        };\n        const control = new $58ea3f4a4bcc116e$export$5519a977876d156d({\n            rightLabel: label,\n            imageName: options.artefact.iconImageName,\n            action: action\n        });\n        control.element.classList.add(\"uncastable\");\n        return control;\n    }\n    /**\n   * Create an artefact button. If a custom action is set, the button is a closer.\n   * Otherwise it just pops up a dialog giving details about the artefact.\n   * @param {ArtefactDialogOptions} options\n   * @returns {components.BitmapButtonControl}\n   */ #createArtefactButtonControl(options) {\n        const label = $b5bda9c98c481f6f$var$createArtefactButtonLabel(options);\n        let action;\n        let closes;\n        if (options.delayedReaction) closes = {\n            invoke: ()=>options.artefact.interaction.react(options.currentOwner)\n        };\n        else action = async ()=>{\n            await $b5bda9c98c481f6f$export$19550c7d374fe949(options).then(()=>options.refresh?.());\n        };\n        return new $58ea3f4a4bcc116e$export$5519a977876d156d({\n            rightLabel: label,\n            imageName: options.artefact.iconImageName,\n            action: action,\n            closes: closes\n        });\n    }\n}\n/**\n * Show the actor's traits.\n * @param {module:players/actors.Actor} actor\n * @returns {Promise}\n */ function $b5bda9c98c481f6f$var$showTraits(actor) {\n    const container = document.createElement(\"div\");\n    container.appendChild($b5bda9c98c481f6f$var$createActorElement(actor, {\n        hideDescription: true\n    }));\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container);\n}\n/**\n * Show a rest action dialog.\n * @param {module:players/actors.Actor} actor\n * @returns {Promise} fulfils to undefined.\n */ function $b5bda9c98c481f6f$var$showRestActionDialog(actor) {\n    const store = actor.storeManager.getStore((0, $547c634f23f1bc62$export$39337ab5872e9457).BACKPACK);\n    const meals = [];\n    const drinks = [];\n    store.values().forEach((item)=>{\n        if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(item.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).CONSUMABLE)) {\n            const type = item.traits.get(\"TYPE\");\n            if (type === \"MEAL\") meals.push(item);\n            else if (type === \"DRINK\") drinks.push(item);\n        }\n    });\n    const messageContainer = document.createElement(\"div\");\n    messageContainer.appendChild($b5bda9c98c481f6f$var$createIdCard(actor));\n    messageContainer.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE EXPLAIN REST`\n    }));\n    const choices = [];\n    let shortIndex = -1;\n    let longIndex = -1;\n    const restDetails = $930b66d99210d21f$export$105ff773d2a2501a(meals.length, drinks.length, actor.traits);\n    let message = \"\";\n    if (!restDetails.shortRest.possible) {\n        if (restDetails.shortRest.failure === $930b66d99210d21f$export$58d02c0b3958dc5.NEED_LONG_REST) message = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CANNOT REST SHORT NEED LONG REST`;\n        else message = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CANNOT REST SHORT NEED RATIONS`;\n        messageContainer.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n            text: message\n        }));\n    }\n    if (!restDetails.longRest.possible) {\n        message = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CANNOT REST LONG NEED RATIONS`;\n        messageContainer.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n            text: message\n        }));\n    }\n    if (restDetails.shortRest.possible) {\n        shortIndex = choices.length;\n        choices.push((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON REST SHORT`);\n    }\n    if (restDetails.longRest.possible) {\n        longIndex = choices.length;\n        choices.push((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON REST LONG`);\n    }\n    choices.push((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE`);\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showChoiceDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE CHOICES`, messageContainer, choices).then((choice)=>{\n        if (choice === shortIndex) {\n            $b5bda9c98c481f6f$var$discardItemsFromStore(store, meals, $930b66d99210d21f$export$f482b03c0d47770c);\n            $b5bda9c98c481f6f$var$discardItemsFromStore(store, drinks, $930b66d99210d21f$export$ff8cb03fee7cf5b7);\n            const result = $930b66d99210d21f$export$1f1ba427ee30f22d(actor, \"SHORT\");\n            return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE REST SHORT HP GAIN ${result.newHp - result.oldHp}`);\n        } else if (choice === longIndex) {\n            $b5bda9c98c481f6f$var$discardItemsFromStore(store, meals, $930b66d99210d21f$export$f38bd2bad06ce15b);\n            $b5bda9c98c481f6f$var$discardItemsFromStore(store, drinks, $930b66d99210d21f$export$acf4bc55b62ab78b);\n            const result = $930b66d99210d21f$export$1f1ba427ee30f22d(actor, \"LONG\");\n            return $b5bda9c98c481f6f$var$showPrepareSpellsDialog(actor).then(()=>(0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE REST LONG HP GAIN ${result.newHp - result.oldHp}`));\n        }\n        return;\n    });\n}\n/**\n * Show dialog allowing the player to prepare their spells.\n * @param {module:players/actors.Actor} actor\n */ function $b5bda9c98c481f6f$var$showPrepareSpellsDialog(actor) {\n    const container = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"inventory\"\n    });\n    container.appendChild($b5bda9c98c481f6f$var$createActorElement(actor, {\n        hideDescription: true,\n        hideTraits: true\n    }));\n    const inventoryContainer = new $b5bda9c98c481f6f$var$InventoryContainerElement({\n        currentOwner: actor,\n        prospectiveOwner: actor,\n        allowSpellPrep: true\n    }, {\n        limitation: $b5bda9c98c481f6f$var$InventoryLimitation.SPELLS\n    });\n    container.appendChild(inventoryContainer.element);\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container, {\n        title: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE PREPARE SPELLS`,\n        preamble: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE EXPLAIN SPELL PREP`\n    });\n}\n/**\n * @param {module:players/artefacts~StoreInterface}\n * @param {module:players/artefacts~Artefact[]} items\n * @param {number} qty\n */ function $b5bda9c98c481f6f$var$discardItemsFromStore(store, items, qty) {\n    if (qty > items.length) (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Attempt being made to discard more items than provided in array.\");\n    for(let index = 0; index < qty && index < items.length; index++){\n        const taken = store.take(items[index]);\n        if (!taken) (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Trying to take artefact ${items[index]}, but none found.`);\n    }\n}\n/**\n * Show actor's inventory.\n * @param {module:players/actors.Actor} actor\n * @param {{allowConsumption: boolean, allowMagicUse: boolean, limitation:InventoryLimitation}} [options = {}]\n */ function $b5bda9c98c481f6f$var$showInventory(actor, options = {}) {\n    const container = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"inventory\"\n    });\n    const actorContainer = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"actor-container\"\n    });\n    container.appendChild(actorContainer);\n    actorContainer.appendChild($b5bda9c98c481f6f$var$createActorElement(actor, {\n        hideDescription: true,\n        hideTraits: true\n    }));\n    const inventoryContainer = new $b5bda9c98c481f6f$var$InventoryContainerElement({\n        currentOwner: actor,\n        prospectiveOwner: actor,\n        allowMagicUse: options.allowMagicUse,\n        allowConsumption: options.allowConsumption\n    }, {\n        limitation: options.limitation,\n        onRefresh: ()=>actorContainer.replaceChildren($b5bda9c98c481f6f$var$createActorElement(actor, {\n                hideDescription: true,\n                hideTraits: true\n            }))\n    });\n    container.appendChild(inventoryContainer.element);\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container);\n}\n/**\n * Show actor's inventory and allow casting of spells.\n * @param {module:players/actors.Actor} actor\n * @param {{allowMagicUse: boolean, limitation:InventoryLimitation}} [options = {}]\n * @returns {Promise<DelayedAction>}\n */ function $b5bda9c98c481f6f$var$showCastSpells(actor) {\n    const container = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"inventory\"\n    });\n    const inventoryContainer = new $b5bda9c98c481f6f$var$InventoryContainerElement({\n        currentOwner: actor,\n        prospectiveOwner: actor,\n        allowMagicUse: true,\n        showDamage: true,\n        delayedReaction: true\n    }, {\n        limitation: $b5bda9c98c481f6f$var$InventoryLimitation.READY_MAGIC\n    });\n    container.appendChild(inventoryContainer.element);\n    const cancelButton = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE`,\n        closes: (0, $3a28f16acdd0ba47$export$c2043c90d147849d).CANCEL\n    });\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container, {\n        title: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE PICK SPELL TO CAST`,\n        actionButtons: [\n            ...inventoryContainer.actionButtons,\n            cancelButton\n        ]\n    });\n}\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement}\n */ function $b5bda9c98c481f6f$var$createArtefactDialogButtons(container, options) {\n    const selfAction = options.currentOwner === options.prospectiveOwner || !options.prospectiveOwner;\n    if (selfAction) return $b5bda9c98c481f6f$var$createSelfActionArtefactDialogButtons(container, options);\n    switch(options.actionType){\n        case $b5bda9c98c481f6f$export$30b1e0f61711dee7.FIND:\n            return $b5bda9c98c481f6f$var$createFindArtefactDialogButtons(container, options);\n        case $b5bda9c98c481f6f$export$30b1e0f61711dee7.SELL:\n            return $b5bda9c98c481f6f$var$createSellArtefactDialogButtons(container, options);\n        case $b5bda9c98c481f6f$export$30b1e0f61711dee7.PILLAGE:\n            return $b5bda9c98c481f6f$var$createPillageArtefactDialogButtons(container, options);\n        case $b5bda9c98c481f6f$export$30b1e0f61711dee7.VIEW:\n        default:\n            return [];\n    }\n}\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */ function $b5bda9c98c481f6f$var$createFindArtefactDialogButtons(container, options) {\n    const actionButtons = [];\n    const possibleStore = options.prospectiveOwner.storeManager.findSuitableStore(options.artefact);\n    let button;\n    if (!possibleStore) container.appendChild($b5bda9c98c481f6f$var$createFailedStorageGuidance(options));\n    else {\n        let label;\n        let action;\n        if (possibleStore.storeType === (0, $547c634f23f1bc62$export$39337ab5872e9457).CANTRIPS || possibleStore.storeType === (0, $547c634f23f1bc62$export$39337ab5872e9457).SPELLS || possibleStore.storeType === (0, $547c634f23f1bc62$export$39337ab5872e9457).READY_SPELLS) {\n            label = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON LEARN SPELL`;\n            action = $b5bda9c98c481f6f$var$ArtefactAction.LEARN_SPELL;\n        } else {\n            label = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON TAKE ARTEFACT`;\n            action = $b5bda9c98c481f6f$var$ArtefactAction.TAKE;\n        }\n        button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            label: label,\n            closes: action\n        });\n        actionButtons.push(button);\n    }\n    button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON LEAVE ARTEFACT`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.LEAVE\n    });\n    actionButtons.push(button);\n    return actionButtons;\n}\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement}\n */ function $b5bda9c98c481f6f$var$createSelfActionArtefactDialogButtons(container, options) {\n    if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(options.artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).COINS)) return;\n    let actionButtons = [];\n    switch(options.artefact.artefactType?.id){\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).SPELL.id:\n            actionButtons = $b5bda9c98c481f6f$var$createSpellButtons(options);\n            break;\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).CANTRIP.id:\n            actionButtons = $b5bda9c98c481f6f$var$createCantripButtons(options);\n            break;\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).CONSUMABLE.id:\n            actionButtons = $b5bda9c98c481f6f$var$createConsumeButtons(options);\n            break;\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).KEY.id:\n            actionButtons = $b5bda9c98c481f6f$var$createKeyButtons(options);\n            break;\n        default:\n            actionButtons = $b5bda9c98c481f6f$var$createStandardArtefactButtons(options);\n            break;\n    }\n    //actionButtons.forEach((button) => container.appendChild(button.element));\n    actionButtons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.CONTINUE\n    }));\n    return actionButtons;\n}\n/**\n * Create KEY artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */ function $b5bda9c98c481f6f$var$createKeyButtons(optionsUnused) {\n    const buttons = [];\n    // nothing you can do with keys. If you discard or sell it you could get stuck.\n    return buttons;\n}\n/**\n * Create cantrip artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */ function $b5bda9c98c481f6f$var$createCantripButtons(options) {\n    const buttons = [];\n    if (options.allowMagicUse) (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Unexpected creation of Cantrip buttons with magic allowed. Use of Cantrips is handled by custom actions.\");\n    buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Forget`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.DISCARD\n    }));\n    return buttons;\n}\n/**\n * Create spell artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */ function $b5bda9c98c481f6f$var$createSpellButtons(options) {\n    const buttons = [];\n    const artefact = options.artefact;\n    if (options.allowMagicUse) (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Unexpected creation of Spell buttons with magic allowed. Use of Spells is handled by custom actions.\");\n    else if (options.storeType === artefact.stashStoreType && options.allowSpellPrep) buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON PREPARE SPELL`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.PREPARE_SPELL\n    }));\n    if (options.allowSpellPrep) buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON FORGET`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.DISCARD\n    }));\n    return buttons;\n}\n/**\n * Create consume artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */ function $b5bda9c98c481f6f$var$createConsumeButtons(options) {\n    const buttons = [];\n    if ($b5bda9c98c481f6f$var$isArtefactUsable(options)) buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: $b5bda9c98c481f6f$var$getLabelForUse(options.artefact),\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.CONSUME\n    }));\n    buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON DISCARD`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.DISCARD\n    }));\n    return buttons;\n}\n/**\n * Check to see if the artefact is allowed to be used.\n * @param {ArtefactDialogOptions} options\n * @returns {boolean}\n */ function $b5bda9c98c481f6f$var$isArtefactUsable(options) {\n    const artefact = options.artefact;\n    if (!artefact.isUsable()) return false;\n    if (artefact.isMagic()) return options.allowMagicUse;\n    if (artefact.isConsumable()) return options.allowConsumption;\n}\n/**\n * Create standard artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */ function $b5bda9c98c481f6f$var$createStandardArtefactButtons(options) {\n    const buttons = [];\n    if ($b5bda9c98c481f6f$var$isArtefactUsable(options)) buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: $b5bda9c98c481f6f$var$getLabelForUse(options.artefact),\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.USE\n    }));\n    else if (options.storeType === options.artefact.stashStoreType && options.artefact.equipStoreType) buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON EQUIP`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.EQUIP\n    }));\n    else if (options.storeType === options.artefact.equipStoreType && (!options.artefact.stashInWagon || options.currentOwner.storeManager.hasWagon)) buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON STASH`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.STASH\n    }));\n    buttons.push(new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: options.artefact.isMagic() ? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Forget` : (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON DISCARD`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.DISCARD\n    }));\n    return buttons;\n}\n/**\n * Get a suitable label for a button to use an artefact.\n * @param {module:players/artefacts.Artefact} artefact\n * @returns {string}\n */ function $b5bda9c98c481f6f$var$getLabelForUse(artefact) {\n    switch(artefact.artefactType.id){\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).CONSUMABLE.id:\n            return (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONSUME`;\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).SPELL.id:\n        case (0, $547c634f23f1bc62$export$e451727f06f039f2).CANTRIP.id:\n            return (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CAST SPELL`;\n        default:\n            return (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON USE`;\n    }\n}\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement}\n */ function $b5bda9c98c481f6f$var$createSellArtefactDialogButtons(container, options) {\n    if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(options.artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).COINS)) return;\n    const actionButtons = [];\n    const artefactCostInGp = options.artefact.costInGp;\n    let buyersFundsInGp;\n    if (options.prospectiveOwner.isTrader()) buyersFundsInGp = Number.MAX_SAFE_INTEGER; // traders have unlimited funds.\n    else buyersFundsInGp = options.prospectiveOwner.storeManager.getPurseValue();\n    if (buyersFundsInGp < options.artefact.costInGp) {\n        container.appendChild($b5bda9c98c481f6f$var$createNoFundsGuidance(buyersFundsInGp, artefactCostInGp));\n        if (!options.currentOwner.isTrader()) $b5bda9c98c481f6f$var$createSelfActionArtefactDialogButtons(container, options);\n        return;\n    }\n    // button labels shows action relative to the hero.\n    // i.e. although the action may be the trader selling\n    // an item, to the player this is viewed as buying.\n    const prospectiveStore = options.prospectiveOwner.storeManager.findSuitableStore(options.artefact);\n    if (!prospectiveStore) {\n        container.appendChild($b5bda9c98c481f6f$var$createFailedStorageGuidance(options));\n        if (!options.currentOwner.isTrader()) $b5bda9c98c481f6f$var$createSelfActionArtefactDialogButtons(container, options);\n        return;\n    }\n    let button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: options.currentOwner.isTrader() ? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON BUY FOR GP ${options.artefact.costInGp.toFixed(2)}` : (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON SELL FOR GP ${options.artefact.sellBackPriceInGp.toFixed(2)}`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.SELL\n    });\n    actionButtons.push(button);\n    button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.CONTINUE\n    });\n    actionButtons.push(button);\n    return actionButtons;\n}\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement}\n */ function $b5bda9c98c481f6f$var$createPillageArtefactDialogButtons(container, options) {\n    if (options.currentOwner.alive) return $b5bda9c98c481f6f$var$createSelfActionArtefactDialogButtons(container, options);\n    const actionButtons = [];\n    const prospectiveStore = options.prospectiveOwner.storeManager.findSuitableStore(options.artefact);\n    if (!prospectiveStore) {\n        container.appendChild($b5bda9c98c481f6f$var$createFailedStorageGuidance(options));\n        if (options.currentOwner.alive) $b5bda9c98c481f6f$var$createSelfActionArtefactDialogButtons(container, options);\n        return;\n    }\n    let button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON PILLAGE`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.PILLAGE\n    });\n    actionButtons.push(button);\n    button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON LEAVE ARTEFACT`,\n        closes: $b5bda9c98c481f6f$var$ArtefactAction.CONTINUE\n    });\n    actionButtons.push(button);\n    return actionButtons;\n}\n/**\n * Create an element advising that insufficient funds are available.\n * @param {number} availableGp\n * @param {number} requiredGp\n * @returns {Element}\n */ function $b5bda9c98c481f6f$var$createNoFundsGuidance(availableGp, requiredGp) {\n    let text;\n    text = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE INSUFFICIENT FUNDS ${requiredGp.toFixed(2)} ${availableGp.toFixed(2)}`;\n    return $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        className: \"guidance\",\n        text: text\n    });\n}\n/**\n * Create an element that provides guidance about why something cannot be stored.\n * @param {ArtefactDialogOptions} options\n * @returns {Element}\n */ function $b5bda9c98c481f6f$var$createFailedStorageGuidance(options) {\n    let text;\n    if (options.prospectiveOwner.isTrader()) text = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRADER CANNOT STASH`;\n    else if (options.artefact.stashInWagon) text = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE MAKE SPACE IN EQUIP`;\n    else text = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE MAKE SPACE IN BACKPACK`;\n    return $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        className: \"guidance\",\n        text: text\n    });\n}\n/**\n * Show equipment dialog.\n * @param {ArtefactDialogOptions} options\n * @return {Promise} fulfils to response from the dialog.\n */ function $b5bda9c98c481f6f$var$showEquipDialog(options) {\n    const artefact = options.artefact;\n    const container = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"use-weapon-dialog\"\n    });\n    container.appendChild($b5bda9c98c481f6f$var$createActorElement(artefact, options));\n    const actionButtons = $b5bda9c98c481f6f$var$createArtefactDialogButtons(container, options);\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container, {\n        preamble: options.preamble,\n        actionButtons: actionButtons,\n        row: true\n    });\n}\n/**\n * Create an id card element for an actor.\n * @param {module:players/actors~Actor|module:game/artefact~Artefacts} actor\n * @returns {Element}\n */ function $b5bda9c98c481f6f$var$createIdCard(actor) {\n    const idCard = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"actor-id-card\"\n    });\n    idCard.appendChild($58ea3f4a4bcc116e$export$f119f65a5d88757e(actor.iconImageName));\n    idCard.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"span\", {\n        text: actor.traits?.get(\"NAME\") ?? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Unknown`\n    }));\n    const hp = actor.traits.getInt(\"HP\");\n    if (!actor.artefactType && hp && !actor.traits.get(\"_HP\")) {\n        const hpMax = actor.traits.getInt(\"HP_MAX\");\n        let hpText;\n        if (hp === 0) hpText = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`(DEAD)`;\n        else if (hpMax) hpText = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`(HP OUT OF VALUE) ${hp} ${hpMax}`;\n        else hpText = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`(HP VALUE) ${hp}`;\n        idCard.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"span\", {\n            text: hpText\n        }));\n    }\n    const characterClass = actor.traits.get(\"CLASS\", \"\").toLowerCase();\n    if (actor.traits.getCharacterLevel && characterClass) idCard.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"span\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`CHARACTER LEVEL: ${actor.traits.getCharacterLevel()} ${characterClass}`\n    }));\n    return idCard;\n}\n/**\n * Create an element describing an actor.\n * @param {module:players/actors.Actor} actor\n * @param {Object} options\n * @param {boolean} options.hideDescription\n * @param {boolean} options.hideTraits\n * @param {string | Element} options.description - override the normal\n * description of the actor.\n * @returns {Element}\n */ function $b5bda9c98c481f6f$var$createActorElement(actor, options = {}) {\n    const container = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"actor-detail\"\n    });\n    const idCard = $b5bda9c98c481f6f$var$createIdCard(actor);\n    container.appendChild(idCard);\n    let descriptionElement;\n    if (!options.hideDescription) {\n        if (!actor.artefactType && !actor.alive) descriptionElement = $b5bda9c98c481f6f$var$createCorpseDescriptionElement(actor);\n        else if (options.description) descriptionElement = options.description instanceof Element ? options.description : $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n            text: options.description\n        });\n        else if (actor.description) descriptionElement = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n            text: actor.unknown && actor.unknownDescription ? actor.unknownDescription : actor.description\n        });\n    }\n    if (descriptionElement) container.appendChild(descriptionElement);\n    if (!options.hideTraits) container.appendChild($b5bda9c98c481f6f$var$createTraitsList(actor, [\n        \"NAME\"\n    ], true));\n    return container;\n}\n/**\n * Create an element describing a corpse.\n * @param {module:players/actors~Actor}\n * @returns {Element}\n */ function $b5bda9c98c481f6f$var$createCorpseDescriptionElement(actor) {\n    let text;\n    if (actor.isHero()) {\n        const name = actor.traits.get(\"NAME\");\n        text = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE HERO EPITAPH FOR ${name}`;\n    } else text = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE GENERIC EPITAPH`;\n    return $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        text: text\n    });\n}\n/**\n * Create an element showing an actor's traits. Gold coins contained in the actor's\n * purse are included as a trait if includeGold flag is set.\n * @param {module:players/actors~Actor|module:players/artefacts~Artefact} actor\n * @param {string[]} excludedKeys - Keys to ignore. Elements starting with an\n * underscore are automatically hidden.\n * @param {boolean} includeGold - flag to determine if gold pieces are included.\n * @returns {Element}\n */ function $b5bda9c98c481f6f$var$createTraitsList(actor, excludedKeys, includeGold) {\n    if (!actor.artefactType && !actor.alive) return $b5bda9c98c481f6f$var$createCorpseDescriptionElement(actor);\n    const traitsList = document.createElement(\"ul\");\n    if (includeGold) {\n        const goldPieces = actor.storeManager?.getPurseValue();\n        if (goldPieces) traitsList.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"li\", {\n            text: (0, $f4fc9532da3395ea$export$c3ea19e5141a48b4)(goldPieces)\n        }));\n    }\n    const readableArray = [];\n    const remainingRestsTrait = $b5bda9c98c481f6f$var$createRemainingShortRestTrait(actor);\n    if (remainingRestsTrait) readableArray.push(remainingRestsTrait);\n    const transientPropertiesTrait = $b5bda9c98c481f6f$var$getTransientPropertiesTrait(actor);\n    if (transientPropertiesTrait) readableArray.push(transientPropertiesTrait);\n    actor.traits?.getAllTraits().forEach((value, key)=>{\n        if (!excludedKeys.includes(key) && !key.startsWith(\"_\")) {\n            if (actor.traits.hasEffective?.(key)) {\n                const effectiveValue = actor.traits.getEffectiveInt(key);\n                const baseValue = $95fc563048a48bb6$export$d6c5c82e8e696750(value);\n                if (effectiveValue !== baseValue) {\n                    const diff = effectiveValue - baseValue;\n                    value = `${effectiveValue} [${baseValue}${diff < 0 ? \"-\" : \"+\"}${diff}]`;\n                }\n            }\n            readableArray.push([\n                $b5bda9c98c481f6f$var$createReadableKey(key),\n                $b5bda9c98c481f6f$var$createReadableValue(value)\n            ]);\n        }\n    });\n    readableArray.sort((a, b)=>a[0] < b[0] ? -1 : 1);\n    for (const traitEntry of readableArray){\n        const key = traitEntry[0];\n        let value = traitEntry[1];\n        if (value && value !== \"0\") {\n            const displayedValue = Array.isArray(value) ? value.join(\", \") : value;\n            const item = document.createElement(\"li\");\n            const label = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"span\", {\n                text: `${key}: `\n            });\n            const content = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"span\", {\n                text: displayedValue\n            });\n            traitsList.appendChild(item);\n            item.appendChild(label);\n            item.appendChild(content);\n        }\n    }\n    return traitsList;\n}\n/**\n * Create a trait representing any transient properties.\n * @param {module:players/actors~Actor|module:players/artefacts~Artefact} actor\n * @returns {<key:string, value: number>} null if not applicable.\n */ function $b5bda9c98c481f6f$var$getTransientPropertiesTrait(actor) {\n    if (!actor.traits.transientProperties) return null;\n    const readableProps = [];\n    for(const prop in actor.traits.transientProperties)readableProps.push((0, $e6f3aae57afc1cde$export$af7faffe10421f14).getText(prop).toLowerCase());\n    return [\n        $b5bda9c98c481f6f$var$createReadableKey(\"TRANSIENT\"),\n        readableProps.sort().join(\", \")\n    ];\n}\n/**\n * Create a remaining short rest trait for adding to the traits list. This is\n * just a more user friendly version of the SPENT_HIT_DICE value;\n * @param {module:players/actors~Actor|module:players/artefacts~Artefact} actor\n * @returns {<key:string, value: number>} null if not applicable.\n */ function $b5bda9c98c481f6f$var$createRemainingShortRestTrait(actor) {\n    if (!actor.isHero?.()) return null;\n    const remainingDice = $930b66d99210d21f$export$f7b7586b654373a2(actor.traits);\n    return [\n        $b5bda9c98c481f6f$var$createReadableKey(\"SHORT_RESTS_REMAINING\"),\n        remainingDice === 0 ? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`zero` : remainingDice\n    ];\n}\n/**\n * Convert a traits key into a more human readable version.\n * @param {string} key\n * @returns {string}\n */ function $b5bda9c98c481f6f$var$createReadableKey(key) {\n    let revised = (0, $e6f3aae57afc1cde$export$af7faffe10421f14).getText(key);\n    if (revised === key) revised = key?.replace(/_/g, \" \");\n    return revised.charAt(0).toUpperCase() + revised.substring(1).toLowerCase();\n}\n/**\n * Convert a traits value into a more human readable version.\n * @param {string} key\n * @returns {string}\n */ function $b5bda9c98c481f6f$var$createReadableValue(value) {\n    // money as is\n    if (/\\d*\\.?\\d* *[CSGP]P/.test(value)) return value; // money\n    // dice roll\n    if (/\\d+D\\d+(?: *[+-]? *\\d+)?/.test(value)) return value;\n    if (Array.isArray(value)) return value.map((entry)=>(0, $e6f3aae57afc1cde$export$af7faffe10421f14).getText(entry).toLowerCase());\n    return typeof value === \"string\" ? (0, $e6f3aae57afc1cde$export$af7faffe10421f14).getText(value).toLowerCase() : value;\n}\n/**\n * Create a label for an artefact button.\n * @param {ArtefactDialogOptions} options\n * @return {string}\n */ function $b5bda9c98c481f6f$var$createArtefactButtonLabel(options) {\n    const traits = options.artefact.traits;\n    let label = traits.get(\"NAME\");\n    if (options.showDamage) {\n        let dice;\n        let diceLabel;\n        if (traits.has(\"HP_GAIN\")) {\n            diceLabel = \"HP: +\";\n            dice = traits.getHpGainDiceWhenCastBy ? traits.getHpGainDiceWhenCastBy(options.currentOwner.traits) : traits.get(\"HP_GAIN\");\n        } else if (traits.has(\"DMG\")) {\n            diceLabel = \"DMG: \";\n            dice = traits.getDamageDiceWhenCastBy ? traits.getDamageDiceWhenCastBy(options.currentOwner.traits) : traits.get(\"DMG\");\n        }\n        if (dice) label = `${label}; ${diceLabel}${dice}`;\n        let rangeText;\n        const range = traits.get(\"RANGE\", \"0\");\n        if ($95fc563048a48bb6$export$d6c5c82e8e696750(range, 0) === 0) rangeText = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`ACTS ON CASTER`;\n        else if (range) rangeText = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Range: ${range}`;\n        label = `${label}; ${rangeText}`;\n    }\n    if (options.showPrice || (0, $547c634f23f1bc62$export$e633b6e759dec9c9)(options.artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).COINS)) {\n        const price = options.currentOwner.isTrader() ? options.artefact.costInGp : options.artefact.sellBackPriceInGp;\n        label = `${label} ${price.toFixed(2)} GP`;\n    }\n    return label;\n}\nfunction $b5bda9c98c481f6f$export$22192403b4d58a2d(buyer, seller, pillage) {\n    const container = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"trade\"\n    });\n    const sideBySide = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"side-by-side\"\n    });\n    container.appendChild(sideBySide);\n    const buyerSide = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {});\n    const sellerSide = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {});\n    sideBySide.appendChild(buyerSide);\n    sideBySide.appendChild(sellerSide);\n    buyerSide.appendChild($b5bda9c98c481f6f$var$createIdCard(buyer));\n    sellerSide.appendChild($b5bda9c98c481f6f$var$createIdCard(seller));\n    const actionType = pillage ? $b5bda9c98c481f6f$export$30b1e0f61711dee7.PILLAGE : $b5bda9c98c481f6f$export$30b1e0f61711dee7.SELL;\n    const buyerInventory = new $b5bda9c98c481f6f$var$InventoryContainerElement({\n        currentOwner: buyer,\n        prospectiveOwner: seller,\n        actionType: actionType,\n        showPrice: true\n    });\n    const sellerInventory = new $b5bda9c98c481f6f$var$InventoryContainerElement({\n        currentOwner: seller,\n        prospectiveOwner: buyer,\n        actionType: actionType,\n        showPrice: true\n    }, {\n        limitation: pillage ? $b5bda9c98c481f6f$var$InventoryLimitation.STANDARD : $b5bda9c98c481f6f$var$InventoryLimitation.STASH_ONLY\n    });\n    buyerInventory.linkedInventory = sellerInventory;\n    sellerInventory.linkedInventory = buyerInventory;\n    buyerSide.appendChild(buyerInventory.element);\n    sellerSide.appendChild(sellerInventory.element);\n    const button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n        label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE`\n    });\n    button.closes = (0, $3a28f16acdd0ba47$export$c2043c90d147849d).CANCEL;\n    const actionButtons = [];\n    actionButtons.push(button);\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container, {\n        preamble: pillage ? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE PILLAGE` : (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE TRADE`,\n        actionButtons: actionButtons\n    });\n}\nfunction $b5bda9c98c481f6f$export$b41ef3e846117718(buyer, seller) {\n    return $b5bda9c98c481f6f$export$22192403b4d58a2d(buyer, seller, false);\n}\nfunction $b5bda9c98c481f6f$export$57057306d4e02258(pillager, victim) {\n    return $b5bda9c98c481f6f$export$22192403b4d58a2d(pillager, victim, true);\n}\nfunction $b5bda9c98c481f6f$export$634672c91d44b77e(actor, options = {}) {\n    const container = document.createElement(\"div\");\n    let buttonRestElement;\n    container.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"span\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`Dungeon floor: ${(0, $125f5f2e3c48ca5e$export$cc5edb2b1b75cf3d)((0, $cd2e32752119e7f3$export$2e2bcd8739ae039).getCurrentSceneLevel())}`\n    }));\n    const actorContainer = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"actor-container\"\n    });\n    container.appendChild(actorContainer);\n    const actorElement = $b5bda9c98c481f6f$var$createActorElement(actor, {\n        hideTraits: true,\n        description: options.description\n    });\n    actorContainer.appendChild(actorElement);\n    let button;\n    let actionButtons;\n    if (!actor.isProp()) {\n        button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON INVENTORY`,\n            action: ()=>$b5bda9c98c481f6f$var$showInventory(actor, {\n                    allowConsumption: options.allowConsumption,\n                    allowMagicUse: options.allowMagicUse\n                }).then(()=>{\n                    actorContainer.replaceChildren($b5bda9c98c481f6f$var$createActorElement(actor, {\n                        hideTraits: true,\n                        description: options.description\n                    }));\n                    if (buttonRestElement && !actor.alive) {\n                        container.removeChild(buttonRestElement);\n                        buttonRestElement = undefined;\n                    }\n                })\n        });\n        container.appendChild(button.element);\n        button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON TRAITS`,\n            action: ()=>$b5bda9c98c481f6f$var$showTraits(actor)\n        });\n        container.appendChild(button.element);\n        button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON MAGIC`,\n            action: ()=>$b5bda9c98c481f6f$var$showInventory(actor, {\n                    allowMagicUse: false,\n                    limitation: $b5bda9c98c481f6f$var$InventoryLimitation.MAGIC\n                })\n        });\n        container.appendChild(button.element);\n        if (options.allowRest) {\n            button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n                label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON REST`,\n                action: ()=>{\n                    return $b5bda9c98c481f6f$var$showRestActionDialog(actor).then(()=>actorContainer.replaceChildren($b5bda9c98c481f6f$var$createActorElement(actor, {\n                            hideTraits: true,\n                            description: options.description\n                        })));\n                }\n            });\n            buttonRestElement = button.element;\n            container.appendChild(button.element);\n        }\n        if (options.allowMagicUse) {\n            actionButtons = actionButtons ?? [];\n            button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n                label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CAST SPELL`\n            });\n            button.closes = \"CAST SPELL\";\n            actionButtons.push(button);\n        }\n    }\n    if (actionButtons) {\n        button = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE`\n        });\n        button.closes = (0, $3a28f16acdd0ba47$export$c2043c90d147849d).CANCEL;\n        actionButtons.push(button);\n    }\n    if (options.additionalControls) {\n        actionButtons = actionButtons || [];\n        for (const control of options.additionalControls)actionButtons.push(control);\n    }\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container, {\n        okButtonLabel: options.okButtonLabel,\n        actionButtons: actionButtons\n    }).then((closes)=>{\n        switch(closes){\n            case \"CAST SPELL\":\n                return $b5bda9c98c481f6f$var$showCastSpells(actor);\n            default:\n                return Promise.resolve(closes);\n        }\n    });\n}\nfunction $b5bda9c98c481f6f$export$19550c7d374fe949(options) {\n    if (!options.prospectiveOwner) options.prospectiveOwner = options.currentOwner; // self action\n    const sourceStoreManager = options.currentOwner?.storeManager;\n    const destStoreManager = options.prospectiveOwner.storeManager;\n    const artefact = options.artefact;\n    const originalHideTraits = options.hideTraits;\n    return $b5bda9c98c481f6f$var$identifyArtefact(options).then((known)=>{\n        if (!known) options.hideTraits = true; // hide traits if item not known\n        return $b5bda9c98c481f6f$var$showEquipDialog(options);\n    }).then((response)=>{\n        options.hideTraits = originalHideTraits; // restore\n        switch(response){\n            case $b5bda9c98c481f6f$var$ArtefactAction.CONSUME:\n                sourceStoreManager.discard(artefact);\n                return artefact.interaction.react(options.currentOwner);\n            case $b5bda9c98c481f6f$var$ArtefactAction.DISCARD:\n                sourceStoreManager.discard(artefact);\n                break;\n            case $b5bda9c98c481f6f$var$ArtefactAction.PREPARE_SPELL:\n            case $b5bda9c98c481f6f$var$ArtefactAction.EQUIP:\n                destStoreManager.equip(artefact);\n                break;\n            case $b5bda9c98c481f6f$var$ArtefactAction.LEARN_SPELL:\n                if (artefact.isMagic() && destStoreManager.hasArtefactWithSameId(artefact)) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE SPELL ALREADY KNOWN`);\n                else {\n                    sourceStoreManager.discard(artefact);\n                    const store = destStoreManager.findSuitableStore(artefact);\n                    store.add(artefact);\n                }\n                if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).SPELL)) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE EXPLAIN SPELL NEEDS REST`);\n                break;\n            case $b5bda9c98c481f6f$var$ArtefactAction.PILLAGE:\n                {\n                    sourceStoreManager.discard(artefact);\n                    const store = destStoreManager.findSuitableStore(artefact);\n                    store.add(artefact);\n                }\n                break;\n            case $b5bda9c98c481f6f$var$ArtefactAction.SELL:\n                {\n                    const money = options.currentOwner.isTrader() ? artefact.costInGp : artefact.sellBackPriceInGp;\n                    sourceStoreManager.addToPurse(money);\n                    if (!options.prospectiveOwner.isTrader()) destStoreManager.takeFromPurse(money); // traders have unlimited funds\n                    sourceStoreManager.discard(artefact);\n                    if (artefact.stashInWagon && !destStoreManager.hasWagon) destStoreManager.equip(artefact, {\n                        direct: true\n                    });\n                    else destStoreManager.stash(artefact, {\n                        direct: true\n                    });\n                }\n                break;\n            case $b5bda9c98c481f6f$var$ArtefactAction.STASH:\n                if (!destStoreManager.stash(artefact)) (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog(options.prospectiveOwner.isTrader() ? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRADER CANNOT STASH` : (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CANNOT STASH`);\n                break;\n            case $b5bda9c98c481f6f$var$ArtefactAction.TAKE:\n                sourceStoreManager?.discard(artefact); // store manager could be null for programmatically created artefact.\n                if (artefact.stashInWagon && !destStoreManager.hasWagon) destStoreManager.equip(artefact, {\n                    direct: true\n                });\n                else destStoreManager.stash(artefact, {\n                    direct: true\n                });\n                break;\n            case $b5bda9c98c481f6f$var$ArtefactAction.USE:\n                return artefact.interaction.react(options.currentOwner);\n        }\n        return Promise.resolve();\n    });\n}\n/**\n * Show dialog allowing the identification of an artefact if necessary.\n * @param {ArtefactDialogOptions} options\n * @returns {Promise<boolean>} true if known.\n */ function $b5bda9c98c481f6f$var$identifyArtefact(options) {\n    if (!options.artefact?.unknown) return Promise.resolve(true);\n    else if (!(0, $6993a9a5d7595cd1$export$cf5ed8ecc4ec774d)()) return Promise.resolve(false); // need to wait till next turn\n    const tester = options.prospectiveOwner ?? options.currentOwner;\n    const recognised = $930b66d99210d21f$export$4255569f55f6b169(tester.traits, options.artefact.traits);\n    if (recognised) {\n        options.artefact.unknown = false;\n        return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE IDENTIFIED ITEM`).then(()=>true);\n    } else return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE FAILED TO IDENTIFY`).then(()=>false);\n}\nfunction $b5bda9c98c481f6f$export$1fa1f898df932d80(heroActor, allowMainMenu = false) {\n    const messageContainer = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\");\n    const nextFloor = (0, $125f5f2e3c48ca5e$export$cc5edb2b1b75cf3d)((0, $cd2e32752119e7f3$export$2e2bcd8739ae039).getCurrentSceneLevel() + 1);\n    messageContainer.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE REST DIALOG ${nextFloor}`\n    }));\n    let additionalControls;\n    if (allowMainMenu) {\n        const mainMenuButton = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON MAIN MENU`\n        });\n        mainMenuButton.closes = \"MAIN MENU\";\n        const continueButton = new $58ea3f4a4bcc116e$export$3e9165d18613c27e({\n            label: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE`\n        });\n        continueButton.closes = \"CONTINUE\";\n        additionalControls = [\n            mainMenuButton,\n            continueButton\n        ];\n    }\n    return $b5bda9c98c481f6f$export$634672c91d44b77e(heroActor, {\n        allowConsumption: true,\n        allowRest: true,\n        description: messageContainer,\n        okButtonLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON CONTINUE`,\n        additionalControls: additionalControls\n    });\n}\nfunction $b5bda9c98c481f6f$export$13f9064afcdbcb51(hero, leaderboardIndex, options) {\n    const container = document.createElement(\"div\");\n    const heroContainer = $58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"div\", {\n        className: \"actor-container\"\n    });\n    container.appendChild(heroContainer);\n    heroContainer.appendChild($b5bda9c98c481f6f$var$createActorElement(hero, {\n        hideTraits: true,\n        description: options.description\n    }));\n    const floor = (0, $125f5f2e3c48ca5e$export$cc5edb2b1b75cf3d)((0, $cd2e32752119e7f3$export$2e2bcd8739ae039).getCurrentSceneLevel());\n    const goldSent = hero.traits.getInt(\"GOLD_SENT\", 0);\n    container.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE ACHIEVEMENTS ${floor} ${goldSent}`\n    }));\n    const messageDefeat = leaderboardIndex < 0 ? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE DEFEAT UNPLACED` : (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE DEFEAT`;\n    container.appendChild($58ea3f4a4bcc116e$export$c8a8987d4410bf2d(\"p\", {\n        text: messageDefeat\n    }));\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container, options);\n}\n\n\n\n\n\n\n\n\n\n\n/**\n * @file Trap characteristics. These are derived from the 5e Severity levels p196.\n *\n * @module dnd/trapCharacteristics\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n/**\n * @typedef {Object} TrapDetails\n * @property {number} difficulty\n * @property {AttackDetail} attack\n * @property {string} detectBy\n * @property {string} disableBy\n * @property {number} goldCoins\n */ const $d6f5b166d007f5fc$var$CHARACTERISTICS = {\n    SETBACK: {\n        dc: 11,\n        bonus: 4,\n        damage: [\n            \"1D10\",\n            \"2D10\",\n            \"4D10\",\n            \"10D10\"\n        ]\n    },\n    DANGEROUS: {\n        dc: 14,\n        bonus: 7,\n        damage: [\n            \"2D10\",\n            \"4D10\",\n            \"10D10\",\n            \"18D10\"\n        ]\n    },\n    DEADLY: {\n        dc: 18,\n        bonus: 11,\n        damage: [\n            \"4D10\",\n            \"10D10\",\n            \"18D10\",\n            \"24D10\"\n        ]\n    }\n};\nfunction $d6f5b166d007f5fc$export$24ed1b3598f489eb(characterLevel, trapTraits) {\n    const severity = trapTraits.get(\"SEVERITY\", \"SETBACK\");\n    const details = $d6f5b166d007f5fc$var$CHARACTERISTICS[severity] ?? $d6f5b166d007f5fc$var$CHARACTERISTICS[\"SETBACK\"];\n    let damage;\n    if (characterLevel < 5) damage = details.damage[0];\n    else if (characterLevel < 11) damage = details.damage[1];\n    else if (characterLevel < 17) damage = details.damage[2];\n    else damage = details.damage[3];\n    return {\n        difficulty: details.dc,\n        attack: new (0, $b7c201230645b878$export$6aedcecc644e4b96)({\n            damageDice: damage,\n            weaponType: \"TRAP\",\n            proficiencyBonus: 0,\n            abilityModifier: details.bonus\n        }),\n        detectBy: trapTraits.get(\"DETECT_BY\", \"WIS\"),\n        disableBy: trapTraits.get(\"DISABLE_BY\", \"INT\"),\n        reward: trapTraits.get(\"REWARD\")\n    };\n}\n\n\n/**\n * @file Dialogs for handling traps\n *\n * @module dialogs/trapDialogs\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\nfunction $cad59b8eddb1e3f8$export$2d8fb94cfec71c61(enactorTraitsUnused, trapDetails, trapDescriptionUnused) {\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showChoiceDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE TRAP DETECTED`, (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRAP ATTEMPT DISABLE`, [\n        (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON TRAP DISABLE`,\n        (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON TRAP LEAVE`\n    ]).then((index)=>index === 0 ? (0, $018d326b648bc43d$export$5cbf62c05633d8fa).ATTEMPT_DISABLE : (0, $018d326b648bc43d$export$5cbf62c05633d8fa).LEAVE);\n}\nfunction $cad59b8eddb1e3f8$export$e72089820699e9b5(enactorTraitsUnused, trapDetailsUnused, trapDescription) {\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showElementOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE TRAP TRIGGERED SURVIVED`, $cad59b8eddb1e3f8$var$createTrapElement(trapDescription, (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRAP TRIGGERED SURVIVED`));\n}\nfunction $cad59b8eddb1e3f8$export$833953164c92e92d(enactorTraitsUnused, trapDetailsUnused, trapDescription) {\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showElementOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE TRAP TRIGGERED INJURED`, $cad59b8eddb1e3f8$var$createTrapElement(trapDescription, (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRAP TRIGGERED INJURED`));\n}\nfunction $cad59b8eddb1e3f8$export$7a0edf0949c382a7(enactorTraitsUnused, trapDetailsUnused, trapDescriptionUnused) {\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE TRAP DISABLED`, $cad59b8eddb1e3f8$var$createTrapElement((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRAP DISABLED`));\n}\n/**\n * Create an element to describe trap and action.\n * @param {string} trapDescription\n * @param {string} message\n * @returns {Element}\n */ function $cad59b8eddb1e3f8$var$createTrapElement(trapDescription, message) {\n    const container = document.createElement(\"div\");\n    const description = document.createElement(\"p\");\n    description.innerText = trapDescription;\n    container.appendChild(description);\n    const messageEl = document.createElement(\"p\");\n    messageEl.innerText = message;\n    container.appendChild(messageEl);\n    return container;\n}\n\n\n\n\n/**\n * @file Money portal dialog\n *\n * @module dialogs/moneyPortalDialog\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\n\nfunction $9babbca44be91b27$export$3c889751b3f88fc3(actor) {\n    const storeManager = actor.storeManager;\n    if (!storeManager) (0, $733fb161db426370$export$2e2bcd8739ae039).error(\"Actor with no storeManager is trying to use a gold portal.\");\n    const gold = Math.floor(storeManager.getPurseValue());\n    if (gold < 1) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE GOLD_PORTAL - INSUFFICIENT GOLD`).then(()=>0);\n    const labels = [\n        \"0%\"\n    ];\n    const transfers = [\n        0\n    ];\n    for (const percent of [\n        25,\n        50,\n        75,\n        100\n    ]){\n        const transferValue = Math.round(gold * percent / 100);\n        if (transferValue > 0) {\n            labels.push(`${percent}%`);\n            transfers.push(transferValue);\n        }\n    }\n    return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showChoiceDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE GOLD_PORTAL`, (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE GOLD_PORTAL - EXPLAIN`, labels).then((choice)=>{\n        const transferValue = transfers[choice];\n        if (transferValue) {\n            let transferredGold = actor.traits.getInt(\"GOLD_SENT\", 0);\n            transferredGold += transferValue;\n            actor.traits.set(\"GOLD_SENT\", transferredGold);\n        }\n        return transferValue;\n    }).then((transferValue)=>{\n        if (transferValue) {\n            storeManager.takeFromPurse(transferValue);\n            return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE GOLD_PORTAL - EXPLAIN CLOSURE ${transferValue}`).then(()=>transferValue);\n        } else return 0;\n    });\n}\n\n\n\n\n\n/**\n * Apply poison damage to defender\n * @param {module:players/artefacts.Artefact | module:players/artefacts.Actor } poison\n * @param {module:players/actors.Actor} victim\n * @param {number} damage\n * @returns {number} resulting HP of defender\n */ function $018d326b648bc43d$var$applyPoisonDamage(poison, victim, damage) {\n    (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"POISONED\");\n    if (damage > 0) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Poisoned\");\n        (0, $8f3da527d9ba55fc$export$5b6dfdcdc3ef8663)((0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(\"skull.png\"), {\n            delaySecs: 0,\n            lifetimeSecs: 1,\n            position: victim.position,\n            velocity: new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 0)\n        });\n        return $018d326b648bc43d$var$applyDamage(poison, victim, damage);\n    } else {\n        (0, $8f3da527d9ba55fc$export$5b6dfdcdc3ef8663)((0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(\"miss.png\"), {\n            delaySecs: 0,\n            lifetimeSecs: 1,\n            position: victim.position,\n            velocity: new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 0)\n        });\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Poison resisted.`);\n    }\n}\n/**\n * Apply damage to defender\n * @param {Artefact | Actor} attacker\n * @param {module:players/actors.Actor} defender\n * @param {number} damage\n * @returns {number} resulting HP of defender\n */ function $018d326b648bc43d$var$applyDamage(attacker, defender, damage) {\n    if (!damage || !defender.alive || defender.isProp() || defender.isHiddenArtefact()) return 0;\n    const defenderName = defender.traits.get(\"NAME\");\n    (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Damage ${damage} on ${defenderName}`);\n    let defenderHP = defender.traits.get(\"HP\", 0);\n    defenderHP = Math.max(0, defenderHP - damage);\n    defender.traits.set(\"HP\", defenderHP);\n    if (defenderHP === 0) {\n        (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(defender.traits.get(\"SOUND\", \"DIE\"));\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Killed ${defenderName}`);\n        defender.interaction = new $018d326b648bc43d$export$b0a99659d931757e(defender);\n        defender.alive = false;\n        if (attacker?.isHero?.()) {\n            const change = attacker.traits.adjustForDefeatOfActor(defender.traits);\n            let text;\n            if (change.level.now > change.level.was) text = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`LEVEL UP ${change.level.now}`;\n            else if (change.exp.now > change.exp.was) text = `+${change.exp.now - change.exp.was} EXP`;\n            if (text) {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).info(text);\n                (0, $8f3da527d9ba55fc$export$a8de794734f9d855)(text, attacker.position, (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).HP_TRANSIENT_TEXT_HERO);\n            }\n        }\n    } else {\n        const textColor = defender.isHero() ? (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).HP_TRANSIENT_TEXT_HERO : (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).HP_TRANSIENT_TEXT_ENEMY;\n        (0, $8f3da527d9ba55fc$export$a8de794734f9d855)(`-${damage} HP`, defender.position, textColor);\n    }\n    return defenderHP;\n}\nclass $018d326b648bc43d$export$f7b5529658291013 {\n    /** Actor owning the interaction @type {module:players/actors.Actor} */ owner;\n    /**\n   *\n   * @param {Actor|Artefact} owner\n   */ constructor(owner){\n        this.owner = owner;\n    }\n    /**\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise} fulfils to value depending on interaction. Can be undefined\n   */ enact(reactorUnused) {\n        return Promise.resolve();\n    }\n    /**\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise} fulfils to value depending on interaction. Can be undefined\n   */ react(enactorUnused) {\n        return Promise.resolve();\n    }\n    /**\n   * Test to see if the interaction can react.\n   * This should be overridden.\n   * @returns {boolean}\n   */ canReact() {\n        return false;\n    }\n    /**\n   * Test to see if the interaction can enact.\n   * This should be overridden.\n   * @returns {boolean}\n   */ canEnact() {\n        return false;\n    }\n    /**\n   * Test to see if actor can disengage from an interaction. Actors can\n   * always move away from an interaction. Disengaging is different in that\n   * following actions can be affected. The interaction will not do anything\n   * about the disengaging. This flag merely indicates whether callers should\n   * respect an attempt to disengage.\n   * @param {module:players/actors.Actor} escaper\n   * @returns {boolean} true if can run\n   */ respectDisengage(escaperUnused) {\n        return false;\n    }\n}\nclass $018d326b648bc43d$export$56070c78bbcda189 extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */ constructor(owner){\n        super(owner);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return true;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return true;\n    }\n    /**\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */ enact(reactor) {\n        return this.#resolveAttackerDefender(this.owner, reactor);\n    }\n    /**\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */ react(enactor) {\n        return this.#resolveAttackerDefender(enactor, this.owner);\n    }\n    /**\n   * Test to see if actor can run away from an interaction. If the actor cannot,\n   * a failed message appears. The actual move is not undertaken\n   * @param {module:players/actors.Actor} escaper\n   * @returns {boolean} true if can run\n   */ respectDisengage(escaperUnused) {\n        return true;\n    }\n    /**\n   * Display an attack\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise}\n   */ #displayAttack(attacker, defender) {\n        const startPoint = (0, $9181799b149b64a5$export$baf26146a414f24a).copy(attacker.position);\n        const attackPoint = new (0, $9181799b149b64a5$export$baf26146a414f24a)(attacker.position.x + 0.2 * (defender.position.x - attacker.position.x), attacker.position.y + 0.2 * (defender.position.y - attacker.position.y));\n        const pathModifier = new (0, $8e5c8f9d0e1a3528$export$c14f425b03c3e261)({\n            path: [\n                attackPoint,\n                startPoint\n            ],\n            speed: 100\n        });\n        return pathModifier.applyAsTransientToSprite(attacker.sprite);\n    }\n    /**\n   * Undertake attack. Note that the defender is not removed if its hit points\n   * hit zero.\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise} fulfils to the defender's HP.\n   */ #undertakeAllAttacks(attacker, defender) {\n        if (attacker.isHero()) return this.#undertakeAllMeleeAttacks(attacker, defender);\n        switch(attacker.attackMode){\n            case (0, $ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72).COMBO:\n                return this.#undertakeComboAttacks(attacker, defender);\n            case (0, $ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72).POISON:\n                return new $018d326b648bc43d$export$bbfcae392104b4c9(attacker).enact(defender);\n            case (0, $ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72).MAGIC:\n            case (0, $ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72).RANGED:\n                return new $018d326b648bc43d$export$eecad08565115e9c(attacker).react(attacker);\n            case (0, $ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72).COMBAT:\n            default:\n                return this.#undertakeCombatAttack(attacker, defender);\n        }\n    }\n    /**\n   * Undertake comb0 attack\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise} fulfils to the defender's HP.\n   */ #undertakeComboAttacks(attacker, defender) {\n        const currentHp = defender.traits.getInt(\"HP\");\n        return this.#undertakeAllMeleeAttacks(attacker, defender).then((hp)=>{\n            if (hp <= 0) return hp;\n            if (attacker.traits.has(\"DMG_POISON\")) {\n                // in combo, only poison if first attack hit.\n                if (hp < currentHp) return new $018d326b648bc43d$export$bbfcae392104b4c9(attacker).enact(defender);\n                else return Promise.resolve(hp);\n            } else return this.#undertakeAllMeleeAttacks(attacker, defender); // double attack\n        });\n    }\n    /**\n   * Undertake combat attack\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise} fulfils to the defender's HP.\n   */ #undertakeCombatAttack(attacker, defender) {\n        if (!attacker.isHero()) {\n            // Monsters use a spell or cantrip if available.\n            const storeManager = attacker.storeManager;\n            let spell = storeManager.getStore((0, $547c634f23f1bc62$export$39337ab5872e9457).PREPARED_SPELLS).getFirst();\n            if (!spell) spell = storeManager.getStore((0, $547c634f23f1bc62$export$39337ab5872e9457).CANTRIPS).getFirst();\n            if (spell) return spell.interaction.react(attacker);\n        }\n        return this.#undertakeAllMeleeAttacks(attacker, defender);\n    }\n    /**\n   * Undertake attack. Note that the defender is not removed if its hit points\n   * hit zero.\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise} fulfils to the defender's HP.\n   */ #undertakeAllMeleeAttacks(attacker, defender) {\n        let totalDamage = 0;\n        let successfulAttacks = 0;\n        attacker.traits.getAttacks().forEach((attack)=>{\n            const damage = $930b66d99210d21f$export$a00548f2d1dc9708(attack, defender.traits);\n            if (damage > 0) {\n                successfulAttacks++;\n                totalDamage += damage;\n            }\n        });\n        return new Promise((resolve)=>{\n            if (totalDamage <= 0) {\n                (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"MISS\");\n                (0, $8f3da527d9ba55fc$export$5b6dfdcdc3ef8663)((0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(\"miss.png\"), {\n                    delaySecs: 0,\n                    lifetimeSecs: 1,\n                    position: defender.position,\n                    velocity: new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 0)\n                });\n                resolve(defender.traits.getInt(\"HP\", 0));\n                return;\n            }\n            let hitSound = successfulAttacks > 1 ? \"DOUBLE PUNCH\" : \"PUNCH\";\n            let hitImage = successfulAttacks > 1 ? \"blood-splat-twice.png\" : \"blood-splat.png\";\n            (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(hitSound);\n            (0, $8f3da527d9ba55fc$export$5b6dfdcdc3ef8663)((0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(hitImage), {\n                delaySecs: 0,\n                lifetimeSecs: 1,\n                position: defender.position,\n                velocity: new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 0)\n            });\n            const defenderHP = $018d326b648bc43d$var$applyDamage(attacker, defender, totalDamage);\n            resolve(defenderHP);\n        });\n    }\n    /**\n   * Resolve a fight.\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise}\n   */ #resolveAttackerDefender(attacker, defender) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).info(`${attacker.traits?.get(\"NAME\")} attacks ${defender.traits.get(\"NAME\")}`);\n        return this.#displayAttack(attacker, defender).then(()=>this.#undertakeAllAttacks(attacker, defender));\n    }\n}\nclass $018d326b648bc43d$export$b0a99659d931757e extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */ constructor(owner){\n        super(owner);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return false;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return true;\n    }\n    /**\n   * Respond to a search\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */ async react(enactor) {\n        return $b5bda9c98c481f6f$export$57057306d4e02258(enactor, this.owner);\n    }\n}\nclass $018d326b648bc43d$export$366210f9de782ba6 extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */ constructor(owner){\n        super(owner);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return false;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return true;\n    }\n    /**\n   * Trades are passive. Only the hero can initiate a trade.\n   * Note there is possibility for traders to block the exit, so\n   * the option to barge past is provided.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */ react(enactor) {\n        if (this.owner.traits.get(\"NO_TRADE\")) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog([\n            (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRADER WILL NOT TRADE`,\n            (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRADERS PROTECTED`\n        ]);\n        return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showChoiceDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`DIALOG TITLE CHOICES`, (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRADE STEAL OR BARGE`, [\n            (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON TRADE`,\n            (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON STEAL`,\n            (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON BARGE`\n        ]).then((choice)=>{\n            if (choice === 0) return $b5bda9c98c481f6f$export$b41ef3e846117718(enactor, this.owner);\n            else if (choice === 1) return this.#attemptTheftBy(enactor);\n            else return this.#swapPositions(enactor);\n        });\n    }\n    /**\n   * Attempt by robber steal.\n   * @param {module:players/actors.Actor} robber\n   * @returns {Promise} fulfils to undefined when complete.\n   */ #attemptTheftBy(robber) {\n        if ($930b66d99210d21f$export$990ff48a2b0ba22a(robber.traits, this.owner.traits)) {\n            const maxGold = this.owner.traits.getInt(\"MAX_THEFT\", 1);\n            const takenGold = $95fc563048a48bb6$export$75c671db1a13cf5f(1, maxGold);\n            robber.storeManager.addToPurse(takenGold);\n            return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE STOLE GOLD ${takenGold}`);\n        } else {\n            this.owner.traits.set(\"_NO_TRADE\", true);\n            return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE TRADER ATTACKS BACK`).then(()=>{\n                const fight = new $018d326b648bc43d$export$56070c78bbcda189(this.owner);\n                return fight.enact(robber);\n            });\n        }\n    }\n    /**\n   * Swap position with another actor\n   * @param {module:players/actors.Actor} them\n   * @returns {Promise} fulfils to undefined when complete.\n   */ #swapPositions(them) {\n        const myPosition = (0, $9181799b149b64a5$export$baf26146a414f24a).copy(this.owner.position);\n        const theirPosition = (0, $9181799b149b64a5$export$baf26146a414f24a).copy(them.position);\n        return Promise.all([\n            (0, $8e5c8f9d0e1a3528$export$6ade622442e46b50)(them, myPosition),\n            (0, $8e5c8f9d0e1a3528$export$6ade622442e46b50)(this.owner, theirPosition)\n        ]);\n    }\n}\nclass $018d326b648bc43d$export$13d2779752f0bd8f extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} actor - parent actor.\n   */ constructor(actor){\n        super(actor);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return false;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return true;\n    }\n    /**\n   * Finding an artefact is a passive action and can only be initiated by another\n   * actor.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */ async react(enactor) {\n        this.owner.discovered = true;\n        this.owner.alive = false;\n        const storageDetails = this.owner.storeManager.getFirstStorageDetails();\n        if (storageDetails) {\n            let artefact = storageDetails.artefact;\n            if (artefact.isTrap()) {\n                const trapResult = await artefact.interaction.react(enactor);\n                if (trapResult.outcome === $018d326b648bc43d$export$5cbf62c05633d8fa.LEAVE) {\n                    this.owner.alive = true; // reset trap\n                    return Promise.resolve();\n                }\n                this.owner.storeManager.discardStashed(artefact, true); // remove trap\n                if (!trapResult.artefact) return Promise.resolve(); // nothing to find\n                artefact = trapResult.artefact;\n                this.owner.storeManager.stash(artefact, {\n                    direct: true\n                }); // trap now just found artefact.\n            } else if (artefact.isMagic() && !$a7679a1c33accf76$export$a0ac1da054aaefd1(enactor.traits, artefact.traits)) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CANNOT UNDERSTAND MAGIC`);\n            return $b5bda9c98c481f6f$export$19550c7d374fe949({\n                preamble: this.#createDiscoveryMessage(artefact),\n                currentOwner: this.owner,\n                prospectiveOwner: enactor,\n                storeType: storageDetails.store.storeType,\n                artefact: artefact,\n                actionType: $b5bda9c98c481f6f$export$30b1e0f61711dee7.FIND,\n                hideTraits: artefact.isMagic()\n            }).then(()=>{\n                if (this.owner.storeManager.getFirstStorageDetails()) this.owner.alive = true; // still something to find.\n            });\n        } else return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE NOTHING MORE TO DISCOVER`);\n    }\n    /**\n   * Create a message describing the action of discovery rather\n   * than the artefact itself.\n   * @param {*} foundArtefact\n   * @returns {string}\n   */ #createDiscoveryMessage(foundArtefact) {\n        if (this.owner.type === (0, $ce45fe1849aeb7ad$export$ec2f7d5cc9321319).HIDDEN_ARTEFACT) return (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE FOUND HIDDEN ARTEFACT`;\n        else if (foundArtefact.isMagic()) // must be a prop and only engraved pillars currently supported.\n        return (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE FOUND ENGRAVING`;\n        return (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE FOUND GENERIC`;\n    }\n}\nclass $018d326b648bc43d$export$bbfcae392104b4c9 extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */ constructor(owner){\n        super(owner);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return true;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return false;\n    }\n    /**\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */ enact(reactor) {\n        if (this.#isImmune(reactor)) return Promise.resolve();\n        const damage = $930b66d99210d21f$export$b066f38ab0e5b2dc(this.owner.traits, reactor.traits);\n        $018d326b648bc43d$var$applyPoisonDamage(this.owner, reactor, damage);\n        if (damage) reactor.toxify?.addToxicEffect(this.owner.traits);\n        reactor.traits.addTransientFxTraits(this.owner.traits);\n        return Promise.resolve();\n    }\n    /** Check if the actor is immune.\n   * @return {boolean} true if immune.\n   */ #isImmune(reactor) {\n        if (this.owner.isOrganic?.() && reactor.traits.transientProperties?.hover) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).info(`${reactor.traits.get(\"NAME\")} hovering so immune from organic attack.`);\n            return true;\n        }\n        return false;\n    }\n}\nclass $018d326b648bc43d$export$a008c8b96400e731 extends $018d326b648bc43d$export$f7b5529658291013 {\n    /** @type {Toxin} */ #toxin;\n    /**\n   * Construct the interaction.\n   * @param {module:dnd/toxins.Toxin} toxin - if not supplies an inactive toxin\n   * is added.\n   */ constructor(toxin){\n        super(null); // no owner\n        this.#toxin = toxin ?? new (0, $209cccf9e7a37d77$export$c420872fac89c2a3)();\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return true;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return false;\n    }\n    /**\n   * Each call applies the toxic effect so it should only be called once per turn.\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */ enact(reactor) {\n        if (!this.#toxin.isActive) return;\n        const damage = -this.#toxin.getChangeInHpThisTurn();\n        $018d326b648bc43d$var$applyPoisonDamage(null, reactor, damage);\n        return Promise.resolve();\n    }\n    /**\n   * Add toxic effects.\n   * @param {module:dnd/traits.Traits} toxinTraits\n   */ addToxicEffect(toxinTraits) {\n        const hpPerTurn = -toxinTraits.getFloat(\"DMG_PER_TURN\", 0);\n        if (hpPerTurn) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Add toxic effect of ${hpPerTurn} HP/turn`);\n            this.#toxin.addToxicEffect(hpPerTurn);\n        }\n    }\n    /**\n   * Cure the toxic effects.\n   */ cure() {\n        this.#toxin.cure();\n    }\n    /**\n   * Test if toxins active\n   */ get isActive() {\n        return this.#toxin.isActive;\n    }\n    /**\n   * Get the underlying toxin\n   * @returns {Toxin}\n   */ getToxin() {\n        return this.#toxin;\n    }\n}\nclass $018d326b648bc43d$export$eecad08565115e9c extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/artefacts.Artefact} owner - parent spell.\n   */ constructor(owner){\n        super(owner);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return false;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return true;\n    }\n    /**\n   * Respond to a spell cast. Note that the magic system does not require an\n   * attack role unless the attack mode is set to ATTACK\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */ async react(enactor) {\n        let retValue;\n        (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"SPELL_CHANT\");\n        switch(this.owner.traits.get(\"MODE\")){\n            case \"BLESS\":\n                retValue = this.#enactBless(enactor);\n                break;\n            case \"CONJURE MEAL\":\n                retValue = this.#enactConjureMeal(enactor);\n                break;\n            case \"DETECT POISON\":\n                retValue = this.#enactDetectPoison(enactor);\n                break;\n            case \"FIND TRAPS\":\n                retValue = this.#enactFindTraps(enactor);\n                break;\n            case \"HOVER\":\n                retValue = this.#enactHover(enactor);\n                break;\n            case \"VAMPIRIC MELEE\":\n                retValue = this.#enactVampiricTouch(enactor);\n                break;\n            default:\n                retValue = this.#enactMagic(enactor);\n                break;\n        }\n        if ((0, $547c634f23f1bc62$export$e633b6e759dec9c9)(this.owner.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).SPELL)) $a7679a1c33accf76$export$42488dd933dc2ad9(enactor.traits, this.owner.traits);\n        return retValue;\n    }\n    /**\n   * Cast a standard magic spell\n   * @param {module:players/actors.Actor} caster\n   * @returns {Promise<number>} total damage inflicted.\n   */ #enactMagic(enactor) {\n        const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n        const gridPoint = tileMap.worldPointToGrid(enactor.position);\n        const range = this.owner.traits.getValueInFeetInTiles(\"RANGE\", 1);\n        const maxTargets = this.owner.traits.getInt(\"MAX_TARGETS\", 999);\n        let totalDamage = 0;\n        let hitTargets = 0;\n        let validTargets = 0;\n        const radial = this.owner.traits.get(\"DIRECTION\") === \"RADIAL\";\n        const indiscriminate = this.owner.traits.get(\"INDISCRIMINATE\");\n        const affectedTiles = radial ? tileMap.getRadiatingVisibleTiles(range) : tileMap.getRadiatingCross(gridPoint, range);\n        for (const tile of affectedTiles){\n            if (hitTargets >= maxTargets) break;\n            let descendingHp = [\n                ...tile.getOccupants().values()\n            ].sort((a, b)=>b.traits.getInt(\"HP\") - a.traits.getInt(\"HP\"));\n            for (const occupant of descendingHp)if (this.#IsValidTarget(enactor, occupant, indiscriminate)) {\n                validTargets++;\n                const damage = $930b66d99210d21f$export$53864c490cc48ef4(enactor.traits, occupant.traits, this.owner.traits);\n                if (damage > 0) {\n                    totalDamage += damage;\n                    this.#displaySpell(tile.worldPoint);\n                    hitTargets++;\n                    $018d326b648bc43d$var$applyDamage(enactor, occupant, damage);\n                    occupant.traits.addTransientFxTraits(this.owner.traits);\n                } else this.#displayFailedSpell(tile.worldPoint);\n            }\n        }\n        if (validTargets === 0) this.#displayFailedSpell(enactor.position);\n        return (0, $47c057e9d418a795$export$229c72e5fdee233b)(1.5).then(()=>{\n            return totalDamage;\n        }); // pause to allow visuals and spell chant.\n    }\n    /**\n   * Cast a spell to find traps. The exact location is not shown but a warning is placed.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise<undefined>}\n   */ #enactFindTraps(enactor) {\n        const tileMap = (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).getTileMap();\n        const gridPoint = tileMap.worldPointToGrid(enactor.position);\n        const range = this.owner.traits.getValueInFeetInTiles(\"RANGE\", 1);\n        const radial = this.owner.traits.get(\"DIRECTION\") === \"RADIAL\";\n        const searchedTiles = radial ? tileMap.getRadiatingVisibleTiles(range) : tileMap.getRadiatingCross(gridPoint, range);\n        let foundTrap = false;\n        for (const tile of searchedTiles){\n            if (foundTrap) break;\n            const occupants = tile.getOccupants().values();\n            for (const occupant of occupants)if (occupant.isHiddenArtefact?.()) {\n                const storageDetails = occupant.storeManager.getFirstStorageDetails();\n                let artefact = storageDetails?.artefact;\n                if (artefact?.isTrap()) {\n                    foundTrap = true;\n                    break;\n                }\n            }\n        }\n        for (const tile of searchedTiles)if (foundTrap) this.#displaySpell(tile.worldPoint);\n        else this.#displayFailedSpell(tile.worldPoint);\n    }\n    /**\n   * Cast a spell on oneself. These are only for spells that have\n   *  a benefit and only for heroes.\n   * @param {module:players/actors.Actor} caster\n   * @returns {Promise<undefined>}\n   */ #enactBless(caster) {\n        if (!caster.isHero()) return;\n        if (!$a7679a1c33accf76$export$be6656d966ac0ec8(caster.traits, caster.traits, this.owner.traits)) {\n            this.#displayFailedSpell(caster.position);\n            return;\n        }\n        const hpGain = $930b66d99210d21f$export$e3e87e6231f5dc4d(caster.traits, caster.traits, this.owner.traits);\n        this.#displaySpell(caster.position);\n        this.#applyAndShowHpGain(caster, hpGain);\n        caster.traits.addTransientFxTraits(this.owner.traits);\n        return Promise.resolve();\n    }\n    /** Apply and show gain for caster.\n   * @param {module:players/actors.Actor} caster\n   * @param {number} hpGain\n   */ #applyAndShowHpGain(caster, hpGain) {\n        if (hpGain > 0) {\n            caster.traits.addInt(\"HP\", hpGain);\n            (0, $8f3da527d9ba55fc$export$a8de794734f9d855)(`+${hpGain}HP`, caster.position, (0, $44e5a2ab0227b2c3$export$1f4d983d2ef95b6b).HP_TRANSIENT_TEXT_HERO);\n        }\n    }\n    /**\n   * Cast a standard magic spell\n   * @param {module:players/actors.Actor} caster\n   * @returns {Promise<undefined>}\n   */ #enactConjureMeal(enactor) {\n        const almanac = (0, $ecf189a3ccc267f7$export$62947dea9802b3b0).getAlmanac(\"ARTEFACTS\");\n        const foodEntry = almanac.find((entry)=>entry.id === \"iron_rations\");\n        const waterEntry = almanac.find((entry)=>entry.id === \"waterskin\");\n        let itemsStashed = 0;\n        const maxMeals = 3;\n        for(let meals = 0; meals < maxMeals; meals++){\n            const food = (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(foodEntry);\n            if (!enactor.storeManager.stash(food, {\n                direct: true\n            })) break;\n            itemsStashed++;\n            const water = (0, $bc745e7d6b7258f3$export$f71b2f640dbd3eb)(waterEntry);\n            if (!enactor.storeManager.stash(water, {\n                direct: true\n            })) break;\n            itemsStashed++;\n        }\n        if (itemsStashed === 0) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE NO SPACE FOR CONJURED FOOD AND WATER`);\n        else if (itemsStashed < maxMeals * 2) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE NO SPACE FOR ALL CONJURED FOOD AND WATER`);\n        else return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CONJURED FOOD AND WATER`);\n    }\n    /**\n   * Detect poison of any items in the users backpack.\n   * @param {module:players/actors.Actor} caster\n   * @returns {Promise<undefined>}\n   */ #enactDetectPoison(enactor) {\n        const backpackContents = enactor.storeManager.getStore((0, $547c634f23f1bc62$export$39337ab5872e9457).BACKPACK).values();\n        let identifiedItem = false;\n        backpackContents.forEach((artefact)=>{\n            if (artefact.unknown) {\n                identifiedItem = true;\n                artefact.unknown = false;\n            }\n        });\n        if (identifiedItem) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE DETECT POISON SUCCESS`);\n        else return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE DETECT POISON FAILURE`);\n    }\n    /**\n   * Enact a vampiric touch.\n   * This is a melee attack followed by a self-cure.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise<undefined>}\n   */ #enactVampiricTouch(enactor) {\n        this.#enactMagic(enactor).then((damage)=>{\n            if (damage > 0) {\n                const hpGain = Math.round(damage / 2);\n                const currentHp = enactor.traits.getInt(\"HP\");\n                const hpMax = enactor.traits.getInt(\"HP_MAX\");\n                const appliedGain = Math.min(hpMax - currentHp, hpGain);\n                (0, $733fb161db426370$export$2e2bcd8739ae039).info(`Vampiric touch convert ${damage} damage to ${appliedGain} HP.`);\n                this.#applyAndShowHpGain(enactor, appliedGain);\n            }\n        });\n    }\n    /**\n   * Apply transient hover\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise<undefined>}\n   */ #enactHover(enactor) {\n        if (enactor.traits.transientProperties) {\n            enactor.traits.transientProperties.hover = true;\n            this.#displaySpell(enactor.position);\n        }\n    }\n    /**\n   * Test if this is a valid target.\n   * @param {module:dnd/players.Actor} caster\n   * @param {module:dnd/players.Actor} target\n   * @param {boolean} includeTrader\n   * @returns {boolean}\n   */ #IsValidTarget(caster, target, includeTrader) {\n        if (caster.isHero()) {\n            const possibleTarget = includeTrader ? target.isEnemy() || target.isTrader() : target.isEnemy();\n            return possibleTarget && target.alive;\n        } else return target.isHero() && target.alive;\n    }\n    /**\n   * Display a spell attack at a point.\n   * @param {Point} worldPoint\n   */ #displaySpell(worldPoint) {\n        const spellType = this.owner.traits.get(\"EFFECT\");\n        (0, $8f3da527d9ba55fc$export$ae52c687d6df348d)(spellType.toLowerCase(), {\n            position: worldPoint,\n            delaySecs: 0,\n            lifetimeSecs: 2\n        });\n    }\n    /**\n   * Display a spell attack at a point.\n   * @param {Point} worldPoint\n   */ #displayFailedSpell(worldPoint) {\n        (0, $8f3da527d9ba55fc$export$5b6dfdcdc3ef8663)((0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(\"failed-spell.png\"), {\n            position: worldPoint,\n            delaySecs: 0,\n            lifetimeSecs: 2\n        });\n    }\n}\nclass $018d326b648bc43d$export$91e310df03ee2deb extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/artefacts.Artefact} owner - parent actor.\n   */ constructor(owner){\n        super(owner);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return false;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return true;\n    }\n    /**\n   * Respond to a consume instruction\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */ async react(enactor) {\n        const traits = this.owner.traits;\n        const foodType = traits.get(\"TYPE\");\n        if (foodType === \"POTION\") {\n            enactor.traits.addTransientFxTraits(this.owner.traits);\n            this.#addTransientActions(enactor);\n            return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE FX TRAITS APPLIED`);\n        }\n        if (foodType === \"POISON\") {\n            const damage = $930b66d99210d21f$export$b066f38ab0e5b2dc(this.owner.traits, enactor.traits);\n            if (damage === 0) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE RESISTED POISON`);\n            else if ($018d326b648bc43d$var$applyPoisonDamage(this.owner, enactor, damage) <= 0) return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE KILLED BY POISON`);\n            else return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showOkDialog((0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE IT'S POISON ${damage}`);\n        } else {\n            const gainDetail = $930b66d99210d21f$export$471963e02ad769b2(this.owner.traits, enactor.traits);\n            const gainHp = gainDetail.newHp - gainDetail.oldHp;\n            let hpMessage;\n            if (gainDetail.shortFall <= 0) hpMessage = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CONSUME BUT ALREADY FULL HP`;\n            else if (gainHp === 0) hpMessage = (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CONSUME BUT NO HP GAIN`;\n            else hpMessage = foodType === \"MEDICINE\" ? (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE IT'S A HEALTHY DRINK ${gainHp}` : (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE IT'S HEALTHY ${gainHp}`;\n            const container = (0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"div\");\n            container.appendChild((0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"p\", {\n                text: hpMessage\n            }));\n            if (gainDetail.detoxify) {\n                enactor.toxify?.cure();\n                container.appendChild((0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"p\", {\n                    text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE CURED OF TOXINS`\n                }));\n            }\n            return (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog(container).then(()=>enactor.traits.set(\"HP\", gainDetail.newHp));\n        }\n    }\n    /**\n   * Add transient actions to the enactor.\n   * @param {module:players/actors.Actor} enactor\n   */ #addTransientActions(enactor) {\n        const action = this.owner.traits.get(\"ACTION\");\n        if (!action) return;\n        if (!enactor.traits.transientProperties) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Actor ${enactor.traits.get(\"NAME\")} has no transientProperties.`);\n            return;\n        }\n        switch(action){\n            case \"HOVER\":\n                enactor.traits.transientProperties.hover = true;\n                break;\n            default:\n                (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Did not recognise action: ${action}.`);\n        }\n    }\n}\nconst $018d326b648bc43d$export$5cbf62c05633d8fa = {\n    ATTEMPT_DISABLE: \"attempt disable\",\n    LEAVE: \"leave\",\n    DISABLED: \"disabled\",\n    TRIGGERED: \"triggered\"\n};\nclass $018d326b648bc43d$export$7d71571167194fbd extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/artefacts.Artefact} owner - parent actor.\n   */ constructor(owner){\n        super(owner);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return false;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return true;\n    }\n    /**\n   * Respond to a trap being triggered.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise<{outcome:TrapOutcome, artefact:module:players/artefacts.Artefact}>} fulfils to artefact that is found if successfully disabled.\n   */ async react(enactor) {\n        let foundArtefact = null;\n        const trapDetails = $d6f5b166d007f5fc$export$24ed1b3598f489eb(enactor.traits.getCharacterLevel(), this.owner.traits);\n        const action = await this.#attemptToDisable(enactor.traits, trapDetails);\n        let damage;\n        switch(action){\n            case $018d326b648bc43d$export$5cbf62c05633d8fa.TRIGGERED:\n                {\n                    (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Trigger the trap.\");\n                    damage = $930b66d99210d21f$export$a00548f2d1dc9708(trapDetails.attack, enactor.traits);\n                    const dialog = damage === 0 ? $cad59b8eddb1e3f8$export$e72089820699e9b5 : $cad59b8eddb1e3f8$export$833953164c92e92d;\n                    return dialog(enactor, trapDetails, this.owner.description).then(()=>this.#applyAndShowDamage(enactor, damage)).then(()=>({\n                            outcome: action,\n                            artefact: foundArtefact\n                        }));\n                }\n            case $018d326b648bc43d$export$5cbf62c05633d8fa.DISABLED:\n                (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Disabled the trap.\");\n                foundArtefact = (0, $bc745e7d6b7258f3$export$9ff69a0a08d11ae5)(trapDetails.reward);\n                return $cad59b8eddb1e3f8$export$7a0edf0949c382a7(enactor, trapDetails, this.owner.description).then(()=>({\n                        outcome: action,\n                        artefact: foundArtefact\n                    }));\n            case $018d326b648bc43d$export$5cbf62c05633d8fa.LEAVE:\n                (0, $733fb161db426370$export$2e2bcd8739ae039).info(\"Left the trap.\");\n                return Promise.resolve({\n                    outcome: action,\n                    artefact: foundArtefact\n                });\n        }\n    }\n    /**\n   * Apply and show damage.\n   * @param {module:players/actors.Actor} enactor\n   * @param {number} damage\n   */ #applyAndShowDamage(enactor, damage) {\n        return new Promise((resolve)=>{\n            (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"TRIGGER TRAP\");\n            if (damage <= 0) (0, $8f3da527d9ba55fc$export$5b6dfdcdc3ef8663)((0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(\"miss.png\"), {\n                delaySecs: 0,\n                lifetimeSecs: 1,\n                position: enactor.position,\n                velocity: new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 0)\n            });\n            else {\n                (0, $8f3da527d9ba55fc$export$5b6dfdcdc3ef8663)((0, $abd0af492c6c3f51$export$2e2bcd8739ae039).getSpriteBitmap(\"blood-splat.png\"), {\n                    delaySecs: 0,\n                    lifetimeSecs: 1,\n                    position: enactor.position,\n                    velocity: new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 0)\n                });\n                $018d326b648bc43d$var$applyDamage(this.owner, enactor, damage);\n            }\n            resolve();\n        });\n    }\n    /**\n   * Attempt to disable a trap if possible\n   * @param {module:dnd/traits.Traits} enactorTraits\n   * @param {module:dnd/trapCharacteristics~TrapDetails} trapDetails\n   * @returns {Promise<string>} fulfils to 'leave', 'disable' or 'trigger'\n   */ #attemptToDisable(enactorTraits, trapDetails) {\n        if ($930b66d99210d21f$export$38cf22ccfd40810d(enactorTraits, trapDetails)) return $cad59b8eddb1e3f8$export$2d8fb94cfec71c61(enactorTraits, trapDetails, this.owner.description).then((outcome)=>{\n            if (outcome === $018d326b648bc43d$export$5cbf62c05633d8fa.LEAVE) return outcome;\n            if ($930b66d99210d21f$export$ddf75a74280e6cb7(enactorTraits, trapDetails)) return $018d326b648bc43d$export$5cbf62c05633d8fa.DISABLED;\n            else return $018d326b648bc43d$export$5cbf62c05633d8fa.TRIGGERED;\n        });\n        else return Promise.resolve($018d326b648bc43d$export$5cbf62c05633d8fa.TRIGGERED);\n    }\n}\nclass $018d326b648bc43d$export$7b0f49f9ef95a7b0 extends $018d326b648bc43d$export$f7b5529658291013 {\n    /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */ constructor(owner){\n        super(owner);\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canEnact() {\n        return false;\n    }\n    /**\n   * @override\n   * @returns {boolean}\n   */ canReact() {\n        return true;\n    }\n    /**\n   * Respond to a interaction\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */ async react(enactor) {\n        return (0, $9babbca44be91b27$export$3c889751b3f88fc3)(enactor).then((sentGold)=>{\n            if (sentGold) {\n                (0, $6f0e758381e3257c$export$2e2bcd8739ae039).playEffect(\"PORTAL\");\n                if (this.owner.alive) {\n                    this.owner.velocity = new (0, $9181799b149b64a5$export$4a23b3811cef465)(0, 0, 3);\n                    this.owner.alive = false; // dead in this context means the portal is open\n                }\n            }\n        });\n    }\n}\n\n\n\n\n\n\nconst $ce45fe1849aeb7ad$export$ec2f7d5cc9321319 = {\n    HERO: 0,\n    ENEMY: 1,\n    ARTEFACT: 2,\n    HIDDEN_ARTEFACT: 3,\n    TRADER: 4,\n    PROP: 5,\n    PORTAL: 6\n};\nconst $ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72 = {\n    COMBAT: \"COMBAT\",\n    COMBO: \"COMBO\",\n    POISON: \"POISON\",\n    MAGIC: \"MAGIC\",\n    RANGED: \"RANGED\"\n};\nconst $ce45fe1849aeb7ad$export$be204faa7b4ee90a = {\n    WANDER: \"WANDER\",\n    HUNT: \"HUNT\",\n    ORGANIC: \"ORGANIC\"\n};\nfunction $ce45fe1849aeb7ad$export$4a19f89b3effac(str) {\n    const type = $ce45fe1849aeb7ad$export$ec2f7d5cc9321319[str];\n    if (type === null || type === undefined) (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Unrecognised actor type: ${str}`);\n    return type;\n}\nclass $ce45fe1849aeb7ad$export$f73d3eb6fd876d80 extends (0, $74d763ce9aa88625$export$a82f6454288e7804) {\n    /** @type {module:dnd/almanacs/almanacs~AlmanacEntry} */ almanacEntry;\n    /** @type {boolean} */ #frozen;\n    /** @type {module:utils/sprites/sprite~Sprite} */ sprite;\n    /** @type {Traits} */ traits;\n    /** @type {module:dnd/interact.AbstractInteraction} */ interaction;\n    /** @type {module:dnd/interact.Toxify} */ toxify;\n    /** @type {boolean} */ alive;\n    /** Flag used for actors that have a hidden artefact to be discovered. @type {boolean} */ discovered;\n    /** True if actor is disengaging from a fight. @type {boolean} */ disengaging;\n    /** @type {string} */ description;\n    /** @type {string} */ iconImageName;\n    /** @type {ArtefactStoreManager} */ storeManager;\n    /** @type {ActorType} */ type;\n    /** @type {number} */ adventureStartTime;\n    /**\n   * Create the actor.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} [type = ActorType.ENEMY] type of actor. See @link {ActorType}\n   */ constructor(sprite, type = $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.ENEMY){\n        super();\n        this.interaction = new (0, $018d326b648bc43d$export$f7b5529658291013)();\n        this.sprite = sprite;\n        this.sprite.obstacle = true;\n        this.#frozen = false;\n        this.alive = true;\n        this.discovered = false;\n        this.disengaging = false;\n        this.type = type;\n        this.storeManager = new (0, $547c634f23f1bc62$export$39a477c01214ccc0)(type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.TRADER || type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.HIDDEN_ARTEFACT, ()=>this.#updateTraitsFromStore());\n        if (type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.HERO) this.adventureStartTime = new Date().getTime();\n    }\n    /**\n   * Refresh DnD properties.\n   */ #updateTraitsFromStore() {\n        const items = this.storeManager.getAllEquippedArtefacts();\n        const weapons = items.filter((artefact)=>(0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).WEAPON) || (0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).TWO_HANDED_WEAPON));\n        const armour = items.filter((artefact)=>(0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).ARMOUR) || (0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).HEAD_GEAR));\n        const shields = items.filter((artefact)=>(0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).SHIELD));\n        const magic = items.filter((artefact)=>(0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).RING) || (0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).BELT) || (0, $547c634f23f1bc62$export$e633b6e759dec9c9)(artefact.artefactType, (0, $547c634f23f1bc62$export$e451727f06f039f2).HEAD_GEAR));\n        this.traits.utiliseAdditionalTraits({\n            weapons: weapons.map((artefact)=>artefact.traits),\n            armour: armour.map((artefact)=>artefact.traits),\n            shields: shields.map((artefact)=>artefact.traits),\n            magic: magic.map((artefact)=>artefact.traits)\n        });\n    }\n    /**\n   * Freeze any movement.\n   */ freezeMovement() {\n        this.#frozen = true;\n    }\n    /**\n   * Get max tiles per move\n   */ getMaxTilesPerMove() {\n        return this.#frozen ? 0 : this.traits.getMaxTilesPerMove();\n    }\n    /**\n   * Test if this actor is the hero.\n   * @returns {boolean}\n   */ isHero() {\n        return this.type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.HERO;\n    }\n    /**\n   * Test if this actor is an enemy.\n   * @returns {boolean}\n   */ isEnemy() {\n        return this.type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.ENEMY;\n    }\n    /**\n   * Test if this actor is a trader.\n   * @returns {boolean}\n   */ isTrader() {\n        return this.type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.TRADER;\n    }\n    /**\n   * Test if this actor is a hidden artefact.\n   * @returns {boolean}\n   */ isHiddenArtefact() {\n        return this.type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.HIDDEN_ARTEFACT;\n    }\n    /** Set the underlying sprite visibility.\n   * @param {boolean}\n   */ set visible(value) {\n        this.sprite.visible = value;\n    }\n    /** Get the underlying sprite visibility.\n   * @returns {boolean}\n   */ get visible() {\n        return this.sprite.visible;\n    }\n    /**\n   * Get obstacle property. This comes from the underlying sprite.\n   * @param {boolean} value\n   */ get obstacle() {\n        return this.sprite.obstacle;\n    }\n    /**\n   * Set as obstacle. This sets the underlying sprite's property.\n   * @param {boolean} value\n   */ set obstacle(value) {\n        this.sprite.obstacle = value;\n    }\n    /**\n   * Get the actor's position.\n   * @returns {module:utils/geometry~Position}\n   */ get position() {\n        return this.sprite.position;\n    }\n    /**\n   * Set the actor's position.\n   * @param {module:utils/geometry~Position} value\n   */ set position(value) {\n        this.sprite.position = value;\n    }\n    /**\n   * Get the current motion.\n   * @returns {Velocity}\n   */ get velocity() {\n        return this.sprite.velocity;\n    }\n    /**\n   * Set the current Velocity. Invalid values become 0.\n   * @param {Velocity} nextVelocity\n   */ set velocity(nextVelocity) {\n        this.sprite.velocity = nextVelocity;\n    }\n    /**\n   * Get the sprite's image name.\n   * @returns {string} null if none.\n   */ getImageFilename() {\n        return this.sprite.getImageFilename();\n    }\n    /**\n   * Is this a wandering actor.\n   * @returns {boolean}\n   */ isWandering() {\n        return this.traits?.get(\"MOVE\") === $ce45fe1849aeb7ad$export$be204faa7b4ee90a.WANDER;\n    }\n    /**\n   * Is this an organic actor.\n   * @returns {boolean}\n   */ isOrganic() {\n        return this.traits?.get(\"MOVE\") === $ce45fe1849aeb7ad$export$be204faa7b4ee90a.ORGANIC;\n    }\n    /**\n   * Is this a prop.\n   * @returns {boolean}\n   */ isProp() {\n        return this?.type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.PROP;\n    }\n    /**\n   * Is this a portal\n   * @returns {boolean}\n   */ isPortal() {\n        return this?.type === $ce45fe1849aeb7ad$export$ec2f7d5cc9321319.PORTAL;\n    }\n    /**\n   * Get the move type\n   * @returns {MoveTypeValue}\n   */ get moveType() {\n        return this?.traits.get(\"MOVE\");\n    }\n    /**\n   * Get the attack mode\n   * @returns {AttackModeValue} defaults to combat\n   */ get attackMode() {\n        return this?.traits.get(\"ATTACK\", $ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72.COMBAT);\n    }\n    /**\n   * Test if the actor will interact.\n   * @returns {boolean}\n   */ willInteract() {\n        if (!this.interaction) return false;\n        if (this.isWandering()) return $a4035ea4d528e431$export$b9d1fef74bbc4c0c(6) > 3;\n        return true;\n    }\n    /**\n   * Is the actor passable?\n   * @param {Actor} otherActor\n   * @returns {boolean}\n   */ isPassableByActor(otherActor) {\n        if (otherActor.isHero() && (this.isHiddenArtefact() || this.isPortal())) return true;\n        else return !this.alive && !this.isProp() || !this.obstacle;\n    }\n    /**\n   * Can it share a tile location with another actor?\n   * @param {Actor} otherActor\n   * @returns {boolean}\n   */ canShareLocationWithActor(otherActor) {\n        if (this.isPortal()) return otherActor.isHero();\n        else if (this.isOrganic()) return !otherActor.isOrganic() && !otherActor.isTrader(); // don't kill off traders.\n        else if (this.isHiddenArtefact()) return otherActor.isHero();\n        else if (!this.alive && otherActor.isHero()) return true;\n        else return !this.obstacle;\n    }\n    /**\n   * Call update on the underlying sprite\n   * @param {number} deltaSeconds\n   */ update(deltaSeconds) {\n        this.sprite.update(deltaSeconds);\n    }\n    /**\n   * Handle the click but change the point to the sprite's position\n   */ actionClick(pointUnused) {\n        super.actionClick(this.sprite.position);\n    }\n    /**\n   * Handle the click but change the point to the sprite's position\n   */ actionContextClick(pointUnused) {\n        super.actionContextClick(this.sprite.position);\n    }\n    /**\n   * Handle the pointer up event but change the point to the sprite's position\n   */ actionPointerUp(pointUnused) {\n        super.actionPointerUp(this.sprite.position);\n    }\n    /**\n   * Handle the pointer down event but change the point to the sprite's position\n   */ actionPointerDown(pointUnused) {\n        super.actionPointerDown(this.sprite.position);\n    }\n    /**\n   * Convert to JSON.\n   * Note this only stores the actor.\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */ toJSON() {\n        const storageDetails = this.storeManager.getAllStorageDetails();\n        const inventory = [];\n        for (const detail of storageDetails)inventory.push({\n            storeTypeId: detail.store.storeTypeId,\n            artefact: detail.artefact\n        });\n        return {\n            reviver: \"Actor\",\n            data: {\n                adventureStartTime: this.adventureStartTime,\n                alive: this.alive,\n                discovered: this.discovered,\n                almanacEntry: this.almanacEntry,\n                traits: this.traits,\n                inventory: inventory,\n                toxin: this?.toxify.getToxin()\n            }\n        };\n    }\n    /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   * @param {function(module:dnd/almanacs~AlmanacEntry,module:dnd/traits.Traits)} builder\n   * @returns {Actor}\n   */ static revive(data, builder) {\n        data.almanacEntry.equipmentIds = []; // remove so we don't reequip\n        const actor = builder(data.almanacEntry, data.traits);\n        actor.adventureStartTime = data.adventureStartTime;\n        actor.alive = data.alive;\n        actor.discovered = data.discovered;\n        actor.toxify = new (0, $018d326b648bc43d$export$a008c8b96400e731)(data.toxin);\n        for (const item of data.inventory){\n            const store = actor.storeManager.getStoreByTypeId(item.storeTypeId);\n            if (!store) {\n                (0, $733fb161db426370$export$2e2bcd8739ae039).error(`Unable to find store matching ${item.storeTypeId}. Game restore abandoned.`);\n                return;\n            }\n            store.add(item.artefact);\n        }\n        return actor;\n    }\n}\n\n\n\n\n\n\n/**\n * @type {Map<string, Sprite>}\n */ const $fd5e96b24678cb30$var$actors = new Map();\n/** @type {boolean} */ let $fd5e96b24678cb30$var$visible = false;\n/**\n * Add a button to the hud. If two callbacks are provided, an AnimatedImage\n * is required with two frames.\n * @param {SpriteBitmap | AnimatedImage} image\n * @param {module:ui/interactions~UiClickCallback} callbackOn\n * @param {module:ui/interactions~UiClickCallback} callbackOff\n * @returns {module:players/actors.Actor}\n */ function $fd5e96b24678cb30$var$addButton(image, callbackOn, callbackOff) {\n    const actor = new (0, $ce45fe1849aeb7ad$export$f73d3eb6fd876d80)(new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n        renderer: new (0, $aa0468ffbc97dbfc$export$c1626e6e036a584)((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), image)\n    }));\n    $fd5e96b24678cb30$var$actors.set(actor, actor);\n    actor.setOnClick(()=>{\n        if (!callbackOff) callbackOn();\n        else if (image.getCurrentIndex() === 0) {\n            image.setCurrentIndex(1);\n            callbackOn();\n        } else {\n            image.setCurrentIndex(0);\n            callbackOff();\n        }\n    });\n    image.setCurrentIndex(0);\n    return actor;\n}\n/**\n * Add a momentary button to the hud. If two callbacks are provided, an AnimatedImage\n * is required with two frames.\n * @param {SpriteBitmap | AnimatedImage} image\n * @param {module:ui/interactions~UiClickCallback} callbackOn\n * @param {module:ui/interactions~UiClickCallback} callbackOff\n * @returns {module:players/actors.Actor}\n */ function $fd5e96b24678cb30$var$addMomentaryButton(image, callbackOn, callbackOff) {\n    const actor = new (0, $ce45fe1849aeb7ad$export$f73d3eb6fd876d80)(new (0, $f024f63ce1fb25eb$export$3075603db8e6204c)({\n        renderer: new (0, $aa0468ffbc97dbfc$export$c1626e6e036a584)((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), image)\n    }));\n    $fd5e96b24678cb30$var$actors.set(actor, actor);\n    actor.setOnPointerDown(()=>{\n        image.setCurrentIndex(1);\n        callbackOn?.();\n    });\n    actor.setOnPointerUp(()=>{\n        image.setCurrentIndex(0);\n        callbackOff?.();\n    });\n    return actor;\n}\n/**\n * Remove sprite from the hud.\n * @param {module:utils/sprites/sprite~Sprite}\n */ function $fd5e96b24678cb30$var$removeButton(target) {\n    $fd5e96b24678cb30$var$actors.delete(target);\n}\n/**\n * Clear the HUD\n */ function $fd5e96b24678cb30$var$clear() {\n    $fd5e96b24678cb30$var$actors.clear();\n}\n/**\n * Update the world. This calls the update methods of the tile map and all sprites/\n * @param {number} deltaSeconds\n */ function $fd5e96b24678cb30$var$update(deltaSeconds) {\n    if (!$fd5e96b24678cb30$var$visible) return;\n    $fd5e96b24678cb30$var$actors.forEach((sprite)=>{\n        const uiPos = (0, $9181799b149b64a5$export$13807d9ee5a34a42).copy(sprite.position);\n        sprite.position = (0, $7aed85f370071bde$export$2e2bcd8739ae039).glassPositionToWorld(sprite.position);\n        sprite.update(deltaSeconds);\n        sprite.position = uiPos;\n    });\n}\n/**\n * Check if the click is in a actor.\n * @param {module:ui/interactions~MappedPositions} positions - canvas and world positions\n * @param {module:players/actors.Actor} actor\n */ function $fd5e96b24678cb30$var$isHittingActor(positions, actor) {\n    const actorCanvasPos = (0, $7aed85f370071bde$export$2e2bcd8739ae039).glassPositionToWorld(actor.position);\n    let boundingBox = actor.sprite.getBoundingBox();\n    const canvasBox = new (0, $9181799b149b64a5$export$4617fb02663045ef)(actorCanvasPos.x - boundingBox.width / 2, actorCanvasPos.y - boundingBox.height / 2, boundingBox.width, boundingBox.height);\n    return canvasBox.containsCoordinate(positions.world.x, positions.world.y);\n}\n/**\n * Resolve a ui click\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */ function $fd5e96b24678cb30$var$resolveClick(positions) {\n    if (!$fd5e96b24678cb30$var$visible) return false;\n    for (const [keyUnused, actor] of $fd5e96b24678cb30$var$actors)if ($fd5e96b24678cb30$var$isHittingActor(positions, actor)) {\n        actor.actionClick(actor, positions.canvas);\n        return true;\n    }\n    return false;\n}\n/**\n * Resolve a pointer down\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */ function $fd5e96b24678cb30$var$resolvePointerDown(positions) {\n    if (!$fd5e96b24678cb30$var$visible) return false;\n    if (!$fd5e96b24678cb30$var$visible) return false;\n    for (const [keyUnused, actor] of $fd5e96b24678cb30$var$actors)if ($fd5e96b24678cb30$var$isHittingActor(positions, actor)) {\n        actor.actionPointerDown(actor, positions.canvas);\n        return true;\n    }\n    return false;\n}\n/**\n * Resolve a ui pointer up event\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */ function $fd5e96b24678cb30$var$resolvePointerUp(positions) {\n    if (!$fd5e96b24678cb30$var$visible) return false;\n    if (!$fd5e96b24678cb30$var$visible) return false;\n    for (const [keyUnused, actor] of $fd5e96b24678cb30$var$actors)if ($fd5e96b24678cb30$var$isHittingActor(positions, actor)) {\n        actor.actionPointerUp(actor, positions.canvas);\n        return true;\n    }\n    return false;\n}\n/**\n * Resolve a context menu event.\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */ function $fd5e96b24678cb30$var$resolveContextMenu(positionsUnused) {\n    return false;\n}\n/**\n * Resolve a cancel event. For the HUD, a cancel event is treated the same as a pointer\n * up event.\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */ function $fd5e96b24678cb30$var$resolvePointerCancel(positions) {\n    return $fd5e96b24678cb30$var$resolvePointerUp(positions);\n}\n/**\n * Set the visibility of the HUD.\n * @param {boolean} visibility - true to show.\n */ function $fd5e96b24678cb30$var$setVisible(visibility) {\n    $fd5e96b24678cb30$var$visible = visibility;\n}\n/**\n * HUD object\n */ const $fd5e96b24678cb30$var$HUD = {\n    addButton: $fd5e96b24678cb30$var$addButton,\n    addMomentaryButton: $fd5e96b24678cb30$var$addMomentaryButton,\n    clear: $fd5e96b24678cb30$var$clear,\n    removeButton: $fd5e96b24678cb30$var$removeButton,\n    update: $fd5e96b24678cb30$var$update,\n    resolvePointerCancel: $fd5e96b24678cb30$var$resolvePointerCancel,\n    resolveClick: $fd5e96b24678cb30$var$resolveClick,\n    resolveContextMenu: $fd5e96b24678cb30$var$resolveContextMenu,\n    resolvePointerDown: $fd5e96b24678cb30$var$resolvePointerDown,\n    resolvePointerUp: $fd5e96b24678cb30$var$resolvePointerUp,\n    setVisible: $fd5e96b24678cb30$var$setVisible\n};\nvar $fd5e96b24678cb30$export$2e2bcd8739ae039 = $fd5e96b24678cb30$var$HUD;\n\n\n/**\n * @file Support for emojis, especially as sprites.\n *\n * @module utils/text/emojis\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \nconst $777fa57823e630b1$export$57244dfe9a4da758 = {\n    GRINNING: \"\\uD83D\\uDE00\",\n    SANTA: \"\\uD83C\\uDF85\",\n    SHAKING: \"\\uD83E\\uDEE8\"\n};\nfunction $777fa57823e630b1$export$9d534e3026b35ff(context) {\n    let fallbackIndex = 0;\n    for(const key in $777fa57823e630b1$export$57244dfe9a4da758){\n        const metrics = context.measureText($777fa57823e630b1$export$57244dfe9a4da758[key]);\n        const height = metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent;\n        const centreToBaseLine = 0.5 * height - metrics.fontBoundingBoxDescent;\n        context.fillText($777fa57823e630b1$export$57244dfe9a4da758[key], -0.5 * metrics.width, centreToBaseLine);\n        const alphaAtCentre = context.getImageData(0, 0, 1, 1).data[3];\n        if (alphaAtCentre <= 0) {\n            (0, $733fb161db426370$export$2e2bcd8739ae039).debug(`Emoji ${key} not supported.`);\n            $777fa57823e630b1$export$57244dfe9a4da758[key] = `[${fallbackIndex++}]`;\n        }\n        context.clearRect(0, 0, metrics.width, height);\n    }\n}\n\n\n\n\n\n\n\n\n\n\n/**\n * @file Functions to allow touch and mouse handling.\n *\n * @module utils/dom/pointerActions\n */ /**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ \n\nconst $d56a39ce6823f5f2$export$90ded0e426ce21 = \"custom-pointer-down-event\";\nconst $d56a39ce6823f5f2$export$3853e404217e8f25 = \"custom-pointer-up-event\";\nconst $d56a39ce6823f5f2$export$f1ed6970fd95c8d6 = \"custom-pointer-cancel-event\";\nconst $d56a39ce6823f5f2$export$a5ec1de9afad15ae = \"custom-click-event\";\nconst $d56a39ce6823f5f2$export$fc5c5be4a666ab48 = \"custom-context-click-event\";\nconst $d56a39ce6823f5f2$export$d69198a72de4964d = \"custom-pointer-drag-event\";\nconst $d56a39ce6823f5f2$export$3ddad254732bb8a8 = \"custom-pointer-drag-end-event\";\n/** Minimum movement that constitutes a drag. */ const $d56a39ce6823f5f2$var$MIN_DRAG_MOVEMENT = 10;\n/** @enum {number} */ const $d56a39ce6823f5f2$var$EventSource = {\n    MOUSE: 0,\n    TOUCH: 1\n};\n/**\n * @typedef {Object} CustomEventDetail\n * @property {number} x\n * @property {number} y\n * @property {number} dx\n * @property {number} dy\n */ /**\n * @typedef {Object} DragData\n * @param {ELement} element\n * @property {boolean} actionStarted\n * @property {boolean} dragging\n * @property {number} lastX\n * @property {number} lastY\n * @property {number} startX\n * @property {number} startY\n * @property {number} x\n * @property {number} y\n * @property {Point} lastTouchStartPoint\n * @property {boolean} suppressClickEvent\n */ /**\n * Dispatch an event. Detail is dispatched in the event detail.\n * @param {Element} element\n * @param {string} eventName\n * @param {Object} detail\n */ function $d56a39ce6823f5f2$var$dispatchEvent(element, eventName, detail) {\n    const event = new CustomEvent(eventName, {\n        detail: detail\n    });\n    element.dispatchEvent(event);\n}\n/**\n * Gets offsetX and offsetY equivalent to a MouseEvent\n * @param {TouchEvent} event\n * @returns {Object}\n */ function $d56a39ce6823f5f2$var$getOffsetFromTouch(event) {\n    const rect = event.target.getBoundingClientRect();\n    return {\n        x: event.touches[0].pageX - rect.left,\n        y: event.touches[0].pageY - rect.top\n    };\n}\n/**\n * Process the start of the action.\n * @param {number} eventSource\n * @param {number} x - x coordinate relative to target\n * @param {number} y - y coordinate relative to target\n * @param {DragData} data\n */ function $d56a39ce6823f5f2$var$processStartAction(eventSource, x, y, data) {\n    data.actionStarted = true;\n    data.dragging = false;\n    data.distance = 0;\n    data.lastX = x;\n    data.lastY = y;\n    data.startX = x;\n    data.startY = y;\n    $d56a39ce6823f5f2$var$dispatchEvent(data.element, $d56a39ce6823f5f2$export$90ded0e426ce21, {\n        x: x,\n        y: y\n    });\n}\n/**\n * Process the start of the action.\n * @param {number} eventSource\n * @param {number} x - x coordinate relative to target\n * @param {number} y - y coordinate relative to target\n * @param {DragData} data\n */ function $d56a39ce6823f5f2$var$processEndAction(eventSource, x, y, data) {\n    const eventName = data.dragging ? $d56a39ce6823f5f2$export$3ddad254732bb8a8 : $d56a39ce6823f5f2$export$3853e404217e8f25;\n    data.actionStarted = false;\n    data.dragging = false;\n    data.distance = 0;\n    data.lastX = x;\n    data.lastY = y;\n    data.startX = x;\n    data.startY = y;\n    $d56a39ce6823f5f2$var$dispatchEvent(data.element, eventName, {\n        x: x,\n        y: y\n    });\n}\n/**\n * Process the start of the action.\n * @param {number} eventSource\n * @param {number} x - x coordinate relative to target\n * @param {number} y - y coordinate relative to target\n * @param {DragData} data\n */ function $d56a39ce6823f5f2$var$processCancelAction(eventSource, x, y, data) {\n    const eventName = $d56a39ce6823f5f2$export$f1ed6970fd95c8d6;\n    data.actionStarted = false;\n    data.dragging = false;\n    data.distance = 0;\n    data.lastX = x;\n    data.lastY = y;\n    data.startX = x;\n    data.startY = y;\n    $d56a39ce6823f5f2$var$dispatchEvent(data.element, eventName, {\n        x: x,\n        y: y\n    });\n}\n/**\n * Process the start of the action.\n * @param {number} eventSource\n * @param {number} x - x coordinate relative to target\n * @param {number} y - y coordinate relative to target\n * @param {DragData} data\n * @return {CustomEvent} null if no event should be dispatched.\n */ function $d56a39ce6823f5f2$var$processMoveAction(eventSource, x, y, data) {\n    const eventName = $d56a39ce6823f5f2$export$d69198a72de4964d;\n    let dx = x - data.lastX;\n    let dy = y - data.lastY;\n    data.lastX = x;\n    data.lastY = y;\n    if (data.dragging) {\n        const event = new CustomEvent(eventName, {\n            detail: {\n                x: x,\n                y: y,\n                dx: dx,\n                dy: dy\n            }\n        });\n        data.element.dispatchEvent(event);\n    } else if (Math.abs(x - data.startX) > $d56a39ce6823f5f2$var$MIN_DRAG_MOVEMENT || Math.abs(y - data.startY) > $d56a39ce6823f5f2$var$MIN_DRAG_MOVEMENT) {\n        data.dragging = true;\n        data.suppressClickEvent = true;\n    }\n}\nfunction $d56a39ce6823f5f2$export$2b4524682ad19724(element) {\n    let dragData = {\n        element: element,\n        actionStarted: false,\n        dragging: false,\n        x: 0,\n        y: 0,\n        lastTouchStartPoint: null,\n        suppressClickEvent: false\n    };\n    element.addEventListener(\"mousedown\", (event)=>{\n        return $d56a39ce6823f5f2$var$processStartAction($d56a39ce6823f5f2$var$EventSource.MOUSE, event.offsetX, event.offsetY, dragData);\n    }, {\n        passive: true\n    });\n    element.addEventListener(\"mouseup\", (event)=>{\n        return $d56a39ce6823f5f2$var$processEndAction($d56a39ce6823f5f2$var$EventSource.MOUSE, event.offsetX, event.offsetY, dragData);\n    }, {\n        passive: true\n    });\n    element.addEventListener(\"mousemove\", (event)=>{\n        if (event.buttons & 1) $d56a39ce6823f5f2$var$processMoveAction($d56a39ce6823f5f2$var$EventSource.MOUSE, event.offsetX, event.offsetY, dragData);\n    }, {\n        passive: true\n    });\n    element.addEventListener(\"touchstart\", (event)=>{\n        if (event.changedTouches.length === 1) {\n            const offset = $d56a39ce6823f5f2$var$getOffsetFromTouch(event);\n            dragData.lastTouchStartPoint = new (0, $9181799b149b64a5$export$baf26146a414f24a)(offset.x, offset.y);\n            $d56a39ce6823f5f2$var$processStartAction($d56a39ce6823f5f2$var$EventSource.TOUCH, offset.x, offset.y, dragData);\n        }\n    }, {\n        passive: true\n    });\n    element.addEventListener(\"touchend\", (event)=>{\n        if (event.changedTouches.length === 1) $d56a39ce6823f5f2$var$processEndAction($d56a39ce6823f5f2$var$EventSource.TOUCH, dragData.lastTouchStartPoint?.x, dragData.lastTouchStartPoint?.y, dragData);\n        dragData.lastTouchStartPoint = null;\n        dragData.suppressClickEvent = false;\n    }, {\n        passive: true\n    });\n    element.addEventListener(\"touchmove\", (event)=>{\n        if (event.changedTouches.length === 1) {\n            const offset = $d56a39ce6823f5f2$var$getOffsetFromTouch(event);\n            $d56a39ce6823f5f2$var$processMoveAction($d56a39ce6823f5f2$var$EventSource.TOUCH, offset.x, offset.y, dragData);\n            dragData.suppressClickEvent = true;\n        }\n    }, {\n        passive: true\n    });\n    element.addEventListener(\"touchcancel\", (eventUnused)=>{\n        $d56a39ce6823f5f2$var$processCancelAction($d56a39ce6823f5f2$var$EventSource.TOUCH, dragData.lastTouchStartPoint?.x, dragData.lastTouchStartPoint?.y, dragData);\n        dragData.lastTouchStartPoint = null;\n    }, {\n        passive: true\n    });\n    element.addEventListener(\"click\", (event)=>{\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"click\");\n        if (!dragData.suppressClickEvent) $d56a39ce6823f5f2$var$dispatchEvent(element, $d56a39ce6823f5f2$export$a5ec1de9afad15ae, {\n            x: event.offsetX,\n            y: event.offsetY\n        });\n        dragData.suppressClickEvent = false;\n    });\n    element.addEventListener(\"contextmenu\", (event)=>{\n        event.preventDefault();\n        $d56a39ce6823f5f2$var$dispatchEvent(element, $d56a39ce6823f5f2$export$fc5c5be4a666ab48, {\n            x: event.offsetX,\n            y: event.offsetY\n        });\n    });\n}\n\n\n\n\n\n\n/**\n * @file Messages used in the application.\n *\n * @module constants/messages\n */ /**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */ const $2651cee9e4814cb3$var$MESSAGE_MAP = new Map([\n    [\n        \"BUTTON ABOUT\",\n        \"About\"\n    ],\n    [\n        \"BUTTON BUY FOR GP\",\n        \"Buy for ${0}\\xa0GP\"\n    ],\n    [\n        \"BUTTON CANCEL\",\n        \"Cancel\"\n    ],\n    [\n        \"BUTTON CAST SPELL\",\n        \"Cast spell\"\n    ],\n    [\n        \"BUTTON DELETE MEMORY\",\n        \"Delete memory\"\n    ],\n    [\n        \"BUTTON CONSUME\",\n        \"Consume\"\n    ],\n    [\n        \"BUTTON CONTINUE\",\n        \"Continue\"\n    ],\n    [\n        \"BUTTON CONTINUE ADVENTURE\",\n        \"Continue adventure\"\n    ],\n    [\n        \"BUTTON CLIMB OVER\",\n        \"Climb over\"\n    ],\n    [\n        \"BUTTON BARGE\",\n        \"Barge past\"\n    ],\n    [\n        \"BUTTON HALL OF FAME\",\n        \"Hall of fame\"\n    ],\n    [\n        \"BUTTON DELETE\",\n        \"DELETE!\"\n    ],\n    [\n        \"BUTTON DISCARD\",\n        \"Discard\"\n    ],\n    [\n        \"BUTTON DO NOT SHOW AGAIN\",\n        \"Do not show again\"\n    ],\n    [\n        \"BUTTON ENTER DUNGEON\",\n        \"Enter if you dare\"\n    ],\n    [\n        \"BUTTON EQUIP\",\n        \"Equip\"\n    ],\n    [\n        \"BUTTON FORGET\",\n        \"Forget\"\n    ],\n    [\n        \"BUTTON GUIDES\",\n        \"About and Help\"\n    ],\n    [\n        \"BUTTON HELP\",\n        \"Help\"\n    ],\n    [\n        \"BUTTON INVENTORY\",\n        \"Inventory\"\n    ],\n    [\n        \"BUTTON LEARN SPELL\",\n        \"Learn spell\"\n    ],\n    [\n        \"BUTTON LEAVE ARTEFACT\",\n        \"Leave\"\n    ],\n    [\n        \"BUTTON LEAVE IT\",\n        \"Leave it\"\n    ],\n    [\n        \"BUTTON MAGIC\",\n        \"Magic\"\n    ],\n    [\n        \"BUTTON MAIN MENU\",\n        \"Main menu\"\n    ],\n    [\n        \"BUTTON MOVE\",\n        \"Move\"\n    ],\n    [\n        \"BUTTON OK\",\n        \"OK\"\n    ],\n    [\n        \"BUTTON PILLAGE\",\n        \"Stash\"\n    ],\n    [\n        \"BUTTON PLAY ADVENTURE\",\n        \"Start adventure\"\n    ],\n    [\n        \"BUTTON PLAY CASUAL\",\n        \"Casual exploration\"\n    ],\n    [\n        \"BUTTON PRIVACY\",\n        \"Privacy\"\n    ],\n    [\n        \"BUTTON PREPARE SPELL\",\n        \"Prepare\"\n    ],\n    [\n        \"BUTTON REST\",\n        \"Rest\"\n    ],\n    [\n        \"BUTTON REST LONG\",\n        \"Long rest\"\n    ],\n    [\n        \"BUTTON READY MAGIC\",\n        \"Ready Magic\"\n    ],\n    [\n        \"BUTTON REST SHORT\",\n        \"Short rest\"\n    ],\n    [\n        \"BUTTON SEARCH\",\n        \"Search\"\n    ],\n    [\n        \"BUTTON SELL FOR GP\",\n        \"Sell for ${0}\\xa0GP\"\n    ],\n    [\n        \"BUTTON SETTINGS\",\n        \"Settings\"\n    ],\n    [\n        \"BUTTON SHOW DEBUG LOG\",\n        \"The chronicles of DeBuggle Logitall\"\n    ],\n    [\n        \"BUTTON START\",\n        \"Let's get started.\"\n    ],\n    [\n        \"BUTTON STASH\",\n        \"Stash\"\n    ],\n    [\n        \"BUTTON STEAL\",\n        \"Steal\"\n    ],\n    [\n        \"BUTTON TRAP DISABLE\",\n        \"Try to disable\"\n    ],\n    [\n        \"BUTTON TRAP LEAVE\",\n        \"Leave it alone\"\n    ],\n    [\n        \"BUTTON TAKE ARTEFACT\",\n        \"Stash\"\n    ],\n    [\n        \"BUTTON TRADE\",\n        \"Trade\"\n    ],\n    [\n        \"BUTTON TRAITS\",\n        \"Traits\"\n    ],\n    [\n        \"BUTTON TRY AGAIN\",\n        \"Try again\"\n    ],\n    [\n        \"BUTTON TRY TO PICK\",\n        \"Pick lock\"\n    ],\n    [\n        \"BUTTON USE\",\n        \"Use\"\n    ],\n    [\n        \"CONTROL DO NOT SCALE\",\n        \"Maximum scale 1:1\"\n    ],\n    [\n        \"CONTROL EFFECTS VOLUME\",\n        \"Effects volume\"\n    ],\n    [\n        \"CONTROL MUSIC VOLUME\",\n        \"Music volume\"\n    ],\n    [\n        \"CONTROL SHOW QUICK TIPS\",\n        \"Show quick tips\"\n    ],\n    [\n        \"CONTROL RUN FULLSCREEN\",\n        \"Run fullscreen\"\n    ],\n    [\n        \"DESCRIPTION ACID_SPLASH\",\n        \"You hurl a bubble of acid over up to two creatures within your touch.\"\n    ],\n    [\n        \"DESCRIPTION ACID_ARROW\",\n        \"You send out a shimmering green arrow that bursts into a spray of acid on impact.\"\n    ],\n    [\n        \"DESCRIPTION AMBER\",\n        \"Precious fossilized tree resin, which is much sought after in these realms.\"\n    ],\n    [\n        \"DESCRIPTION ARCANE_ORB\",\n        \"Orb used by some users of magic to focus their spells.\"\n    ],\n    [\n        \"DESCRIPTION ARCANE_SWORD\",\n        \"You create a sword-shaped plane of energy that hovers over your target and initiates a melee spell attack.\"\n    ],\n    [\n        \"DESCRIPTION AQUAMARINE\",\n        \"A precious crystal of rare beauty.\"\n    ],\n    [\n        \"DESCRIPTION BARBARIAN1\",\n        \"You are a barbarian ready to battle to the end of this dungeon in search of wealth and glory.\"\n    ],\n    [\n        \"DESCRIPTION BATTLEAXE\",\n        \"A mighty battleaxe.\"\n    ],\n    [\n        \"DESCRIPTION BELT_OF_STRENGTH\",\n        \"A rare belt, originally crafted by dwarves and significantly increasing the strength of the wearer.\"\n    ],\n    [\n        \"DESCRIPTION BERSERKER\",\n        \"A hate crazed berserker.\"\n    ],\n    [\n        \"DESCRIPTION BLACK_FLASK\",\n        \"A black flask containing a clear, pungent liquid.\"\n    ],\n    [\n        \"DESCRIPTION BLACK_FLASK?POTION_OF_FLYING\",\n        \"A black flask containing a clear, pungent potion that allows the user to hover temporarily above the ground.\"\n    ],\n    [\n        \"DESCRIPTION BLACK_FLASK?SERPENT_VENOM\",\n        \"A black flask containing a clear, pungent poison.\"\n    ],\n    [\n        \"DESCRIPTION BLADE_BARRIER\",\n        \"You create a whirling ringed-wall of spinning blades.\"\n    ],\n    [\n        \"DESCRIPTION BLIGHT\",\n        \"You cause necromantic energy to flow over a creature, draining moisture and vitality from it. The spell does not work on the undead.\"\n    ],\n    [\n        \"DESCRIPTION BUGBEAR\",\n        \"A ferocious humanoid and evil creature bent on mayhem and carnage.\"\n    ],\n    [\n        \"DESCRIPTION BURNING_HANDS\",\n        \"Casting this spell with your thumbs touching and fingers spread creates a thin sheet of flames enveloping your enemies.\"\n    ],\n    [\n        \"DESCRIPTION CHAIN_MAIL_ARMOUR\",\n        \"Armour comprising interlocking steel rings over a soft cushioning fabric. The suit includes gauntlets.\"\n    ],\n    [\n        \"DESCRIPTION CHILL_TOUCH\",\n        \"You create a ghostly skeletal hand on a creature you can touch and assail it with the chill of the grave.\"\n    ],\n    [\n        \"DESCRIPTION CIRCLE_OF_DEATH\",\n        \"You create a sphere of negative energy that ripples out around you.\"\n    ],\n    [\n        \"DESCRIPTION CLERIC1\",\n        \"You are a powerful cleric who can act as a conduit between divine powers and the mortal world.\"\n    ],\n    [\n        \"DESCRIPTION CLUB\",\n        \"A simple wooden club that's seen a lot of action.\"\n    ],\n    [\n        \"DESCRIPTION COINS\",\n        \"Various coins stamped with the image of latter day kings and queens.\"\n    ],\n    [\n        \"DESCRIPTION CONE_OF_COLD\",\n        \"You create a blast of cold air that erupts from your hands.\"\n    ],\n    [\n        \"DESCRIPTION COPPER_COINS\",\n        \"Old copper coins of low value.\"\n    ],\n    [\n        \"DESCRIPTION COPPER_DRAGON_WYRMLING\",\n        \"A very young copper dragon. Young, but capable of inflicting serious damage with its bite and claws.\"\n    ],\n    [\n        \"DESCRIPTION CREATE_FOOD_AND_WATER\",\n        \"You conjure some food and water to create up to three meals. You need space in your backpack to store the meals.\"\n    ],\n    [\n        \"DESCRIPTION CURE_MY_WOUNDS\",\n        \"You cast a spell allowing you to cure some of your wounds\"\n    ],\n    [\n        \"DESCRIPTION DAGGER\",\n        \"A short and very sharp piercing weapon.\"\n    ],\n    [\n        \"DESCRIPTION DETECT_POISON\",\n        \"You perform a ritual to identify any poisons or unidentified items in your backpack.\"\n    ],\n    [\n        \"DESCRIPTION DIAMOND\",\n        \"A valuable and rare crystal.\"\n    ],\n    [\n        \"DESCRIPTION DRETCH\",\n        \"The lowest and least respected of all demons.\"\n    ],\n    [\n        \"DESCRIPTION EARTHQUAKE\",\n        \"You create a seismic disturbance causing an intense tremor to rip through the ground.\"\n    ],\n    [\n        \"DESCRIPTION ENCHANTED_BATTLEAXE\",\n        \"A mighty battleaxe. This magical weapon increases the likelihood and severity of damage.\"\n    ],\n    [\n        \"DESCRIPTION ENCHANTED_GREATAXE\",\n        \"A heavy two-handed axe capable of inflicting severe wounds when in the right hands. This magical weapon increases the likelihood and severity of damage.\"\n    ],\n    [\n        \"DESCRIPTION ENCHANTED_GREATSWORD\",\n        \"A two-handed massive sword inflicting serious slashing damage. This magical weapon increases the likelihood and severity of damage.\"\n    ],\n    [\n        \"DESCRIPTION ENCHANTED_HANDAXE\",\n        \"A small, light axe. This magical weapon increases the likelihood and severity of damage.\"\n    ],\n    [\n        \"DESCRIPTION ENCHANTED_SHORTSWORD\",\n        \"A light and highly versatile sword. This magical weapon increases the likelihood and severity of damage.\"\n    ],\n    [\n        \"DESCRIPTION ENGRAVED_PILLAR\",\n        \"A large stone pillar covered with mystical engravings.\"\n    ],\n    [\n        \"DESCRIPTION FETID_WATER\",\n        \"A fetid, murky film of liquid covering the dungeon flagstones.\"\n    ],\n    [\n        \"DESCRIPTION FIGHTER1\",\n        \"You are a fighter whose family have fallen out of favour. This is your chance to restore your family's good name.\"\n    ],\n    [\n        \"DESCRIPTION FIND_TRAPS\",\n        \"You sense the presence of traps around you. You cannot learn the location of the traps though.\"\n    ],\n    [\n        \"DESCRIPTION FINGER_OF_DEATH\",\n        \"You send negative energy coursing through a creature you can see within range, causing it searing pain.\"\n    ],\n    [\n        \"DESCRIPTION FIRE_BEETLE_PV\",\n        \"A giant fire beetle. Glowing gland radiate a fiery light across the dungeon.\"\n    ],\n    [\n        \"DESCRIPTION FIRE_BOLT\",\n        \"You hurl fire at a creature.\"\n    ],\n    [\n        \"DESCRIPTION FIRE_STORM\",\n        \"You create sheets of roaring flames.\"\n    ],\n    [\n        \"DESCRIPTION FLAIL\",\n        \"A fear inducing bludgeoning weapon.\"\n    ],\n    [\n        \"DESCRIPTION FLAME_STRIKE\",\n        \"You create a column of divine fire almost forty feet high.\"\n    ],\n    [\n        \"DESCRIPTION FUNGAL_FILM\",\n        \"A sticky fungal film that coats the dungeon floor. Poisonous and strength sapping\"\n    ],\n    [\n        \"DESCRIPTION FUNGUS\",\n        \"A brightly coloured red and white fungus.\"\n    ],\n    [\n        \"DESCRIPTION FUNGUS?BERSERKER_COURAGE\",\n        \"Berserker courage fungus. Consumption creates a feeling of unstoppable power and provides a temporary adrenalin-fueled increase in strength.\"\n    ],\n    [\n        \"DESCRIPTION FUNGUS?DEATH_FLY\",\n        \"Death fly fungus. A poisonous fungus often confused with Berserker Courage.\"\n    ],\n    [\n        \"DESCRIPTION GARGOYLE\",\n        \"A chaotic evil gargoyle.\"\n    ],\n    [\n        \"DESCRIPTION GIANT_WASP_PV\",\n        \"A gigantic wasp making a deafening buzzing sound that echoes round the dungeon.\"\n    ],\n    [\n        \"DESCRIPTION GOBLIN\",\n        \"Small humanoid creature.Treat with caution. They're small but vicious.\"\n    ],\n    [\n        \"DESCRIPTION GOLD_COINS\",\n        \"Gold coins stamped with the image of latter day kings and queens.\"\n    ],\n    [\n        \"DESCRIPTION GHOUL\",\n        \"An undead creature, living amongst the dead and dying.\"\n    ],\n    [\n        \"DESCRIPTION GOLD_PORTAL\",\n        \"A magical dwarven portal used for transporting gold and platinum back to the surface.\"\n    ],\n    [\n        \"DESCRIPTION GREATAXE\",\n        \"A heavy two-handed axe capable of inflicting severe wounds when in the right hands.\"\n    ],\n    [\n        \"DESCRIPTION GREATSWORD\",\n        \"A two-handed massive sword inflicting serious slashing damage.\"\n    ],\n    [\n        \"DESCRIPTION HALF_PLATE_ARMOUR\",\n        \"Shaped metal plates covering most of the body. Simple greaves protect the legs.\"\n    ],\n    [\n        \"DESCRIPTION HANDAXE\",\n        \"A small, light axe. The blade is sharp and has been looked after with care.\"\n    ],\n    [\n        \"DESCRIPTION HELMET\",\n        \"A simple steel helmet\"\n    ],\n    [\n        \"DESCRIPTION HELMET_OF_OGRE_POWER\",\n        \"A magical steel helmet offering the normal protection of a steel helmet along with a massive increase in strength.\"\n    ],\n    [\n        \"DESCRIPTION HIDDEN_ARTEFACT\",\n        \"The ground appears to have been disturbed.\"\n    ],\n    [\n        \"DESCRIPTION HUNTING_TRAP\",\n        \"A old battered hunting trap designed for catching monsters and humans.\"\n    ],\n    [\n        \"DESCRIPTION ICE_STORM\",\n        \"You cause a hail of rock-hard ice to pound to the ground around you.\"\n    ],\n    [\n        \"DESCRIPTION INCENDIARY_CLOUD\",\n        \"You create a swirling cloud of smoke shot through with white hot embers.\"\n    ],\n    [\n        \"DESCRIPTION INFLICT_WOUNDS\",\n        \"You make a melee spell attack against a creature you can touch to inflict necrotic damage.\"\n    ],\n    [\n        \"DESCRIPTION IRON_RATIONS\",\n        \"Simple emergency rations. Crucial for resting between floors.\"\n    ],\n    [\n        \"DESCRIPTION KOBOLD\",\n        \"A small reptilian humanoid.\"\n    ],\n    [\n        \"DESCRIPTION LEATHER_ARMOUR\",\n        \"Simple armour comprising stiffened leather boiled in oil along with some more flexible sections.\"\n    ],\n    [\n        \"DESCRIPTION LICHEN\",\n        \"A type of lichen that grows between the flagstones.\"\n    ],\n    [\n        \"DESCRIPTION LICHEN?DRAGON_SCALE_LICHEN\",\n        \"Dragon scale lichen. A green lichen, much sought after by explorers because of it's legendary health benefits.\"\n    ],\n    [\n        \"DESCRIPTION LICHEN?LIZARD_SKIN_LICHEN\",\n        \"Lizard skin lichen. A green lichen, closely related to dragon scale lichen, but mildly poisonous.\"\n    ],\n    [\n        \"DESCRIPTION LIGHTNING_BOLT\",\n        \"You create a stroke of lightning that shoots out from you hitting all creatures in it's path.\"\n    ],\n    [\n        \"DESCRIPTION LOCK_PICK\",\n        \"Set of lock picks.\"\n    ],\n    [\n        \"DESCRIPTION LUTE\",\n        \"A beautiful lute in remarkable condition.\"\n    ],\n    [\n        \"DESCRIPTION MANHOLE_COVER\",\n        \"A small manhole cover set into the dungeon floor.\"\n    ],\n    [\n        \"DESCRIPTION MEAT\",\n        \"A joint of some type of meat.\"\n    ],\n    [\n        \"DESCRIPTION MEAT?HAM\",\n        \"A joint of meat which can be used as a meal while you rest between floors.\"\n    ],\n    [\n        \"DESCRIPTION MEAT?POISON_LIZARD\",\n        \"A hunk of meat from a dungeon lizard. This is toxic to humans.\"\n    ],\n    [\n        \"DESCRIPTION MEAT?ROTTING\",\n        \"A joint of meat, but it looks and smells like it is well past it's best.\"\n    ],\n    [\n        \"DESCRIPTION OGRE\",\n        \"A large and incredibly strong ogre.\"\n    ],\n    [\n        \"DESCRIPTION ORC\",\n        \"A monstrous creature with an intense hatred of humans.\"\n    ],\n    [\n        \"DESCRIPTION ORC_SKULL\",\n        \"An old and slightly cracked skull from a orc.\"\n    ],\n    [\n        \"DESCRIPTION PADDED_ARMOUR\",\n        \"Simple quilted layers of cloth and batting.\"\n    ],\n    [\n        \"DESCRIPTION PLATE_ARMOUR\",\n        \"Full plate armour with interlocking steel plates covering the entire body. A visored helmet, gauntlets, boots, and padding are included.\"\n    ],\n    [\n        \"DESCRIPTION PLATINUM_COINS\",\n        \"Highly valued large platinum coins.\"\n    ],\n    [\n        \"DESCRIPTION POISON_SPRAY\",\n        \"You extend your hand toward your enemy and project a puff of noxious gas.\"\n    ],\n    [\n        \"DESCRIPTION POISONERS_KIT\",\n        \"A kit of vials of poisons and other toxic materials.\"\n    ],\n    [\n        \"DESCRIPTION POWER_WORD_KILL\",\n        \"You utter a word of power that compels a creature to die instantly.\"\n    ],\n    [\n        \"DESCRIPTION POTION_OF_HEALING\",\n        \"An aromatic potion, treasured for it's health restoration properties.\"\n    ],\n    [\n        \"DESCRIPTION PURPLE_PLANT\",\n        \"A small herb with a purple flower.\"\n    ],\n    [\n        \"DESCRIPTION PURPLE_PLANT?DRAGON_WORT\",\n        \"Purple dragon wort. Renowned for it's health giving properties.\"\n    ],\n    [\n        \"DESCRIPTION PURPLE_PLANT?FALSUS_DRAGON_WORT\",\n        \"Falsus dragon wort. Mimicking the medicinal dragon wort herb, this plant is highly toxic.\"\n    ],\n    [\n        \"DESCRIPTION QUARTERSTAFF\",\n        \"A large quarterstaff capable of causing significant damage in the right hands.\"\n    ],\n    [\n        \"DESCRIPTION QUARTZ\",\n        \"A precious crystal.\"\n    ],\n    [\n        \"DESCRIPTION RAT_PV\",\n        \"A giant rat, diseased and vicious.\"\n    ],\n    [\n        \"DESCRIPTION RANGER1\",\n        \"You are a ranger who is more at one with the forest. The dungeon is not your natural realm, but you are ready to take it on.\"\n    ],\n    [\n        \"DESCRIPTION RESTORATIVE_OINTMENT\",\n        \"An ointment that can be rubbed into the skin or eaten to improve health and neutralise any poisons.\"\n    ],\n    [\n        \"DESCRIPTION RING_MAIL_ARMOUR\",\n        \"Leather armour reinforced with heavy steel rings sown into the material.\"\n    ],\n    [\n        \"DESCRIPTION RING_OF_CHARISMA\",\n        \"A magical ring that increases the charisma of the wearer.\"\n    ],\n    [\n        \"DESCRIPTION RING_OF_CONSTITUTION\",\n        \"A magical ring that increases the constitution of the wearer.\"\n    ],\n    [\n        \"DESCRIPTION RING_OF_DEXTERITY\",\n        \"A magical ring that increases the dexterity of the wearer.\"\n    ],\n    [\n        \"DESCRIPTION RING_OF_INTELLIGENCE\",\n        \"A magical ring that increases the intelligence of the wearer.\"\n    ],\n    [\n        \"DESCRIPTION RING_OF_STRENGTH\",\n        \"A magical ring that increases the strength of the wearer.\"\n    ],\n    [\n        \"DESCRIPTION RING_OF_WISDOM\",\n        \"A magical ring that increases the wisdom of the wearer.\"\n    ],\n    [\n        \"DESCRIPTION ROGUE1\",\n        \"You are a rogue whose slippery character may help you creep your way through the depths of this dark and unforgiving dungeon.\"\n    ],\n    [\n        \"DESCRIPTION RUSTY_KEY\",\n        \"A large iron key, covered in rust. It's been lost a long time.\"\n    ],\n    [\n        \"DESCRIPTION SCALE_MAIL_ARMOUR\",\n        \"Leather coat and legging covered with overlapping steel scales.\"\n    ],\n    [\n        \"DESCRIPTION SHADOW\",\n        \"An undead shadow creature, hiding in the darkness.\"\n    ],\n    [\n        \"DESCRIPTION SHATTER\",\n        \"You create a sudden loud ringing noise, painfully intense, that inflicts thunder damage on a creature.\"\n    ],\n    [\n        \"DESCRIPTION SHIELD\",\n        \"A wooden shield, carried in one hand and offering some protection.\"\n    ],\n    [\n        \"DESCRIPTION SHOCKING_GRASP\",\n        \"You create lightning which springs from your hands, delivering a massive shock to a creature within touching distance.\"\n    ],\n    [\n        \"DESCRIPTION SHORTSWORD\",\n        \"A light and highly versatile sword.\"\n    ],\n    [\n        \"DESCRIPTION SILVER_COINS\",\n        \"Silver coins, worn and tarnished but still of value.\"\n    ],\n    [\n        \"DESCRIPTION SKELETON\",\n        \"A skeleton of someone who died here many years ago. It's intent on revenge.\"\n    ],\n    [\n        \"DESCRIPTION SLIME\",\n        \"A green sticky substance that seems to be growing.\"\n    ],\n    [\n        \"DESCRIPTION SPARE_ME\",\n        \"You use your knowledge of necromancy to raise your health if you are nearly dying.\"\n    ],\n    [\n        \"DESCRIPTION SPIDER_PV\",\n        \"A giant spider with fangs dripping green venom.\"\n    ],\n    [\n        \"DESCRIPTION SPIKES\",\n        \"It's a trap. Sharp iron spikes shoot up from the ground.\"\n    ],\n    [\n        \"DESCRIPTION STIRGE\",\n        \"A blood-sucking cross between a giant mosquito and a blood curdling bat.\"\n    ],\n    [\n        \"DESCRIPTION ENHANCE_ABILITY_AS_BULL\",\n        \"You bestow upon yourself a temporary increase in your strength.\"\n    ],\n    [\n        \"DESCRIPTION STUDDED_LEATHER_ARMOUR\",\n        \"Tough and flexible leather armour with the addition of steel spikes and rivets.\"\n    ],\n    [\n        \"DESCRIPTION TIGER_EYE\",\n        \"A precious gemstone\"\n    ],\n    [\n        \"DESCRIPTION TOMB_OF_ELDER\",\n        \"A large ancient shrine. It appears to be stone but with a magical gold lustre.\"\n    ],\n    [\n        \"DESCRIPTION TRADER1\",\n        \"A wandering trader selling all manner of things gathered during many months in the dungeon.\"\n    ],\n    [\n        \"DESCRIPTION TRADER2\",\n        \"A wandering trader with a wagon stacked high with a variety of artefacts found in the dungeon.\"\n    ],\n    [\n        \"DESCRIPTION TRAPDOOR\",\n        \"A small door in the floor. You can't tell what it hides.\"\n    ],\n    [\n        \"DESCRIPTION VAMPIRIC_TOUCH\",\n        \"You touch a shadow-wreathed hand on a creature to inflict necrotic damage. You draw upon the damage inflicted to help heal your own wounds.\"\n    ],\n    [\n        \"DESCRIPTION VEGETATION\",\n        \"A patch of vegetation managing to grow between the cracks in the flagstones.\"\n    ],\n    [\n        \"DESCRIPTION VIOLET_FUNGUS\",\n        \"A moving fungus inflicting severe damage.\"\n    ],\n    [\n        \"DESCRIPTION WATERSKIN\",\n        \"A leather drinking flask with fresh water. Crucial for resting between floors.\"\n    ],\n    [\n        \"DESCRIPTION WARHAMMER\",\n        \"A bludgeoning, versatile iron hammer favoured by many clerics.\"\n    ],\n    [\n        \"DESCRIPTION WARLOCK1\",\n        \"You are a warlock, known for you great knowledge of the supernatural forces that drive the multiverse.\"\n    ],\n    [\n        \"DESCRIPTION WATER_WALK\",\n        \"You perform a ritual to allow yourself to move across any liquid surface unharmed as your feet hover an inch or two above the ground.\"\n    ],\n    [\n        \"DESCRIPTION WIGHT\",\n        \"A wight, reanimated from the corpse of a rogue fighter whose rotting body was raised by evil necromancy.\"\n    ],\n    [\n        \"DESCRIPTION WIZARD1\",\n        \"You are a wizard determined to find your way to the final level of this dungeon using your control of magical chaos.\"\n    ],\n    [\n        \"DESCRIPTION WRAITH\",\n        \"An undead, neutral evil creature with a touch of death.\"\n    ],\n    [\n        \"DESCRIPTION ZOMBIE\",\n        \"An undead creature roaming the dungeon floors.\"\n    ],\n    [\n        \"DIALOG TITLE DEBUG LOG\",\n        \"Chronicles of Debug Loggerman\"\n    ],\n    [\n        \"DIALOG TITLE DELETE MEMORY\",\n        \"DELETE MEMORY!\"\n    ],\n    [\n        \"DIALOG TITLE HALL OF FAME\",\n        \"Hall of Fame\"\n    ],\n    [\n        \"DIALOG TITLE CHOICES\",\n        \"Decisions, decisions\"\n    ],\n    [\n        \"DIALOG TITLE LOCKED\",\n        \"Locked\"\n    ],\n    [\n        \"DIALOG TITLE GOLD_PORTAL\",\n        \"Use the gold portal\"\n    ],\n    [\n        \"DIALOG TITLE PICK SPELL TO CAST\",\n        \"Pick spell to cast\"\n    ],\n    [\n        \"DIALOG TITLE PILLAGE\",\n        \"Pillage corpse\"\n    ],\n    [\n        \"DIALOG TITLE PREPARE SPELLS\",\n        \"Prepare spells\"\n    ],\n    [\n        \"DIALOG TITLE RUNE PUZZLE\",\n        \"Where next?\"\n    ],\n    [\n        \"DIALOG TITLE SETTINGS\",\n        \"Adjust settings\"\n    ],\n    [\n        \"DIALOG TITLE TRADE\",\n        \"Buy and sell with trader\"\n    ],\n    [\n        \"DIALOG TITLE TRAP DETECTED\",\n        \"Trap detected!\"\n    ],\n    [\n        \"DIALOG TITLE TRAP DISABLED\",\n        \"Trap disabled!\"\n    ],\n    [\n        \"DIALOG TITLE TRAP TRIGGERED SURVIVED\",\n        \"Trap triggered!\"\n    ],\n    [\n        \"DIALOG TITLE TRAP TRIGGERED INJURED\",\n        \"Trap triggered!\"\n    ],\n    [\n        \"MENU TITLE MAIN\",\n        \"Click and Crawl\"\n    ],\n    [\n        \"MENU TITLE GUIDES\",\n        \"Guides and information\"\n    ],\n    [\n        \"MESSAGE ACHIEVEMENTS\",\n        \"You managed to reach floor ${0-floor} and sent back ${1}\\xa0GP to the struggling townsfolk beyond these dungeon walls.\"\n    ],\n    [\n        \"MESSAGE CANNOT LOAD URL\",\n        \"Cannot load data from ${0}\"\n    ],\n    [\n        \"MESSAGE CANNOT REST SHORT NEED LONG REST\",\n        \"You've had too many short rests. You need to take a long rest first.\"\n    ],\n    [\n        \"MESSAGE CANNOT REST SHORT NEED RATIONS\",\n        \"You don't have enough food or drink for a short rest. One meal and one drink are required to enjoy a short rest.\"\n    ],\n    [\n        \"MESSAGE CANNOT REST LONG NEED RATIONS\",\n        \"You don't have enough food or drink for a long rest. Three meals and three drinks are required to enjoy a long rest.\"\n    ],\n    [\n        \"MESSAGE CANNOT STASH\",\n        \"You need to make space in your backpack to stash this.\"\n    ],\n    [\n        \"MESSAGE CANNOT STORE\",\n        \"You're carrying too much stuff to pick up what you've found.\"\n    ],\n    [\n        \"MESSAGE CANNOT UNDERSTAND MAGIC\",\n        \"There is strange magic written here, but it's beyond your comprehension.\"\n    ],\n    [\n        \"MESSAGE CONFIRM DELETE MEMORY\",\n        \"Are you sure you want to delete the game's memory? The Hall of Fame will be lost along with all the game settings.\"\n    ],\n    [\n        \"MESSAGE CONJURED FOOD AND WATER\",\n        \"You conjure some food and water and stash it in your backpack.\"\n    ],\n    [\n        \"MESSAGE CONSUME BUT ALREADY FULL HP\",\n        \"It tastes good, but you're already in prime health. Perhaps you should've waited.\"\n    ],\n    [\n        \"MESSAGE CONSUME BUT NO HP GAIN\",\n        \"It tastes nice, but your health doesn`t improve.\"\n    ],\n    [\n        \"MESSAGE CURED OF TOXINS\",\n        \"Any poisons that may have been affecting you are now neutralised and cease to have any further effect.\"\n    ],\n    [\n        \"MESSAGE DEAD HERO HAS NO INVENTORY\",\n        \"Dead heroes have no use for material belongings. Your inventory is lost in the dungeon, perhaps to be rediscovered by the next intrepid explorer.\"\n    ],\n    [\n        \"MESSAGE DEFEAT\",\n        \"To honour your achievements, the grateful townsfolk will add your name to a plaque in the town's Hall of Fame. Tonight the inns will be filled with songs of your heroism.\"\n    ],\n    [\n        \"MESSAGE DEFEAT UNPLACED\",\n        \"Despite your valiant efforts, your efforts will be forgotten and no bards will sing of your exploits.\"\n    ],\n    [\n        \"MESSAGE DETECT POISON FAILURE\",\n        \"You waste your spell. There were no unidentified items in your backpack.\"\n    ],\n    [\n        \"MESSAGE DETECT POISON SUCCESS\",\n        \"You identify everything in your backpack.\"\n    ],\n    [\n        \"MESSAGE DUNGEON INTRO CONTINUE\",\n        \"Welcome back, ${0}. The adventure continues. You recognise the familiar smell of death.\"\n    ],\n    [\n        \"MESSAGE DUNGEON INTRO CASUAL\",\n        \"You enter the dungeon for a quick exploration and to check on what dangers might exist before starting a full adventure. You progress will not be saved and any achievements will be lost.\"\n    ],\n    [\n        \"MESSAGE ENTER FLOOR\",\n        \"You enter dungeon floor ${0}. The door slams shut behind you. There's no way back. Like it or not, your only path is to continue deeper into the depths of this stone hell.\"\n    ],\n    [\n        \"MESSAGE ENTRANCE STUCK\",\n        [\n            \"The entrance is locked or jammed. You can't tell which, but either way, you can't escape in that direction.\",\n            \"You can't open the entrance. It seems locked or jammed. There's no way back.\"\n        ]\n    ],\n    [\n        \"MESSAGE EXPLAIN SPELL PREP\",\n        \"After a long rest, you can prepare spells ready for use.\"\n    ],\n    [\n        \"MESSAGE EXIT LOCKED\",\n        \"The exit is locked. There must be a key somewhere.\"\n    ],\n    [\n        \"MESSAGE EXPLAIN REST\",\n        \"Trying to use the safety of the corridor to rest and eat?\"\n    ],\n    [\n        \"MESSAGE EXPLAIN SPELL NEEDS REST\",\n        \"To use a spell you need to prepare it. Preparation can only be done between dungeon floors after a long rest.\"\n    ],\n    [\n        \"MESSAGE FAILED TO IDENTIFY\",\n        \"You try to identify this item, but you're not sure exactly what it is. You might remember later.\"\n    ],\n    [\n        \"MESSAGE FOUND HIDDEN ARTEFACT\",\n        [\n            \"Good fortune smiles upon you. You find something.\",\n            \"You find something that has been hidden or lost.\",\n            \"Buried beneath the surface, you find something.\"\n        ]\n    ],\n    [\n        \"MESSAGE FOUND ENGRAVING\",\n        \"You find strange words engraved on the cold stone surface.\"\n    ],\n    [\n        \"MESSAGE FOUND GENERIC\",\n        \"It 's your lucky day. You find something that appears to have been hidden for many years.\"\n    ],\n    [\n        \"MESSAGE FX TRAITS APPLIED\",\n        \"You feel a strange effect on your abilities.\"\n    ],\n    [\n        \"MESSAGE GENERIC EPITAPH\",\n        \"Here lies the corpse of one more defeated enemy.\"\n    ],\n    [\n        \"MESSAGE HALL OF FAME ENTRY\",\n        \"${3-startDate}: ${0-name}; level ${1-level} ${2-class}; ${4-gold} GP sent; floor ${5-floor}\"\n    ],\n    [\n        \"MESSAGE HERO EPITAPH FOR\",\n        \"Here lies the body of ${0}. Rest in peace.\"\n    ],\n    [\n        \"MESSAGE IDENTIFIED ITEM\",\n        \"You manage to identify an item you've found.\"\n    ],\n    [\n        \"MESSAGE INSUFFICIENT FUNDS\",\n        \"You don't have enough funds to purchase this item. The item costs ${0}\\xa0GP but you only have ${1}\\xa0GP.\"\n    ],\n    [\n        \"MESSAGE IT'S A HEALTHY DRINK\",\n        \"That tastes good. +${0}HP\"\n    ],\n    [\n        \"MESSAGE IT'S HEALTHY\",\n        \"A bit chewy, but tastes good. +${0}HP\"\n    ],\n    [\n        \"MESSAGE KILLED BY POISON\",\n        \"Yuk! Poison! You start to burn up, cough and vomit, before falling to the floor and dying.\"\n    ],\n    [\n        \"MESSAGE IT'S POISON\",\n        \"Yuk! It's poison. -${0}HP\"\n    ],\n    [\n        \"MESSAGE KEY UNLOCKS EXIT\",\n        \"You use the key you found earlier to unlock the door.\"\n    ],\n    [\n        \"MESSAGE MAKE SPACE IN BACKPACK\",\n        \"You need to make space in your backpack by discarding or using something.\"\n    ],\n    [\n        \"MESSAGE MAKE SPACE IN EQUIP\",\n        \"This is too big to store. Sell or discard what you're wearing so you can wear this.\"\n    ],\n    [\n        \"MESSAGE MEMORY DELETED\",\n        \"The memory has been deleted.\"\n    ],\n    [\n        \"MESSAGE NO SPACE FOR CONJURED FOOD AND WATER\",\n        \"You conjure food and water, but it all goes to waste as you have no room left in your backpack.\"\n    ],\n    [\n        \"MESSAGE NO SPACE FOR ALL CONJURED FOOD AND WATER\",\n        \"You conjure food and water, but some of it goes to waste as you have no room left in your backpack.\"\n    ],\n    [\n        \"MESSAGE GOLD_PORTAL - EXPLAIN\",\n        \"This old dwarven gold portal can be used to transfer gold to help the desperate townsfolk who are struggling above ground. Choose how much gold you want to send.\"\n    ],\n    [\n        \"MESSAGE GOLD_PORTAL - EXPLAIN CLOSURE\",\n        \"You add ${0-gold}\\xa0GP to the portal. Dwarven portals remain open until they can no longer detect the presence of the opener. To prevent gold staying locked in the portal, you will need to exit the room or die to allow the portal to close.\"\n    ],\n    [\n        \"MESSAGE GOLD_PORTAL - INSUFFICIENT GOLD\",\n        \"You don't have enough gold for the portal. Copper and silver cannot be sent via the portal.\"\n    ],\n    [\n        \"MESSAGE NEED LOCK PICK\",\n        \"You can't pick a lock without a set of lock picks.\"\n    ],\n    [\n        \"MESSAGE NO CASTING POWER LEFT\",\n        \"You don't have enough casting power left to cast this spell. You will need to take a long rest to recover your energy.\"\n    ],\n    [\n        \"MESSAGE NO SAVED ADVENTURE\",\n        \"No adventure has been saved yet.\"\n    ],\n    [\n        \"MESSAGE NOTHING HERE\",\n        \"There's nothing here.\"\n    ],\n    [\n        \"MESSAGE NOTHING MORE TO DISCOVER\",\n        \"There's nothing more for you to learn or discover here.\"\n    ],\n    [\n        \"MESSAGE REQUIRES RESTART\",\n        \"Change will take place when the game is next reloaded.\"\n    ],\n    [\n        \"MESSAGE RESISTED POISON\",\n        \"Yuk! It's poisonous, but you resist its toxic effects.\"\n    ],\n    [\n        \"MESSAGE REST DIALOG\",\n        \"You're at the top of a dark staircase leading even deeper down to floor ${0-floor}. You're safe for now. If you have enough food and drink, you can rest to recuperate, but if you don't need to recover, save your rations.\"\n    ],\n    [\n        \"MESSAGE REST LONG HP GAIN\",\n        \"Your long rest recovered ${0} HP. You are also now cured of the toxic effects of any poisons you may have encountered.\"\n    ],\n    [\n        \"MESSAGE REST SHORT HP GAIN\",\n        \"Your short rest recovered ${0} HP and gave you time to rid your body of any poisons.\"\n    ],\n    [\n        \"MESSAGE ROUTE CHOICE - EASY\",\n        \"You choose the easier route.\"\n    ],\n    [\n        \"MESSAGE ROUTE CHOICE - MEDIUM\",\n        \"You choose the harder route.\"\n    ],\n    [\n        \"MESSAGE RUNES ON WALL\",\n        \"At the bottom of the stairs there are two doors. There's an ancient inscription on wall.\"\n    ],\n    [\n        \"MESSAGE RUNES OVER DOORS\",\n        \"Above each door is a shorter inscription carved into the arch. You need to choose your path.\"\n    ],\n    [\n        \"MESSAGE SEARCH CORPSE OR MOVE\",\n        [\n            \"You have a choice. Do you want to search the body or climb on top?\",\n            \"You find a corpse, but what should you do? Search for weapons and treasure or climb on top of the body?\"\n        ]\n    ],\n    [\n        \"MESSAGE SEARCH HOLE OR MOVE\",\n        [\n            \"You have a choice. Do you want to search this hole or move into it?\",\n            \"You've been here before. Do you want to search again or climb into the hole you dug?\"\n        ]\n    ],\n    [\n        \"MESSAGE SEARCH OR MOVE\",\n        \"You have a choice. Do you want to search this tile or move onto it?\"\n    ],\n    [\n        \"MESSAGE SPELL ALREADY KNOWN\",\n        \"You find a spell, but you already know this incantation.\"\n    ],\n    [\n        \"MESSAGE STOLE GOLD\",\n        \"Success. You pick the trader's pocket undetected and steal ${0} gold coins.\"\n    ],\n    [\n        \"MESSAGE TRADE STEAL OR BARGE\",\n        \"Do you want to trade or barge past this guy?\"\n    ],\n    [\n        \"MESSAGE TRADER ATTACKS BACK\",\n        \"The angry trader detects your clumsy attempt at robbery and strikes back at you.\"\n    ],\n    [\n        \"MESSAGE TRADER CANNOT STASH\",\n        \"The trader has no space for this.\"\n    ],\n    [\n        \"MESSAGE TRADER WILL NOT TRADE\",\n        \"The trader has had enough of your trickery and will not trade with you.\"\n    ],\n    [\n        \"MESSAGE TRADERS PROTECTED\",\n        \"Traders are protected from attack under the ancient law for the protection of travelling merchants.\"\n    ],\n    [\n        \"MESSAGE TRAP ATTEMPT DISABLE\",\n        \"You find a trap. You can't tell what it is though. Do you want to try to disable it?\"\n    ],\n    [\n        \"MESSAGE TRAP TRIGGERED SURVIVED\",\n        \"The trap triggers, but luckily you avoid any injury.\"\n    ],\n    [\n        \"MESSAGE TRAP TRIGGERED INJURED\",\n        \"You're caught by surprise and sustain a number of injuries from the trap.\"\n    ],\n    [\n        \"MESSAGE TRAP DISABLED\",\n        \"Taking great care you manage to disable the trap.\"\n    ],\n    [\n        \"MESSAGE USE PORTAL OR MOVE\",\n        \"You have a choice. Do you want to use this portal or move onto it?\"\n    ],\n    [\n        \"MESSAGE YOU FAIL TO PICK THE LOCK\",\n        \"This lock is tricky. Your attempt to pick it fails.\"\n    ],\n    [\n        \"MESSAGE YOU PICK THE LOCK\",\n        \"Using your skills, you manage to pick the lock.\"\n    ],\n    [\n        \"MESSAGE WELCOME\",\n        \"Welcome to the Click and Crawl old-school dungeon crawler. How far will you get?\"\n    ],\n    // Traits keys\n    [\n        \"STR\",\n        \"Strength\"\n    ],\n    [\n        \"DEX\",\n        \"Dexterity\"\n    ],\n    [\n        \"CON\",\n        \"Constitution\"\n    ],\n    [\n        \"INT\",\n        \"Intelligence\"\n    ],\n    [\n        \"WIS\",\n        \"Wisdom\"\n    ],\n    [\n        \"CHA\",\n        \"Charisma\"\n    ],\n    [\n        \"FX_STR\",\n        \"Strength change\"\n    ],\n    [\n        \"FX_DEX\",\n        \"Dexterity change\"\n    ],\n    [\n        \"FX_CON\",\n        \"Constitution change\"\n    ],\n    [\n        \"FX_INT\",\n        \"Intelligence change\"\n    ],\n    [\n        \"FX_WIS\",\n        \"Wisdom change\"\n    ],\n    [\n        \"FX_CHA\",\n        \"Charisma change\"\n    ],\n    [\n        \"AC\",\n        \"Armour class\"\n    ],\n    [\n        \"DMG\",\n        \"Damage\"\n    ],\n    [\n        \"DMG_PER_TURN\",\n        \"Damage per turn\"\n    ],\n    [\n        \"DC\",\n        \"Difficulty\"\n    ],\n    [\n        \"HP\",\n        \"Hit points\"\n    ],\n    [\n        \"TRIGGERS\",\n        \"Content warning: this game is intended for ages 16 and up and contains violence towards fantasy characters, mild horror atmospherics, comic book blood effects, and death of characters.\"\n    ],\n    // Miscellaneous words and phrases.\n    [\n        \"AC\",\n        \"armour class\"\n    ],\n    [\n        \"AC (including armour)\",\n        \"AC (+armour): ${0}\"\n    ],\n    [\n        \"ACTS ON CASTER\",\n        \"Acts on caster\"\n    ],\n    [\n        \"Backpack\",\n        \"Backpack\"\n    ],\n    [\n        \"Body\",\n        \"Body\"\n    ],\n    [\n        \"Cantrips\",\n        \"Cantrips\"\n    ],\n    [\n        \"Consumables\",\n        \"Consumables\"\n    ],\n    [\n        \"CHARACTER LEVEL:\",\n        \"level: ${0-level} ${1-class}\"\n    ],\n    [\n        \"CHA\",\n        \"charisma\"\n    ],\n    [\n        \"CON\",\n        \"constitution\"\n    ],\n    [\n        \"DC\",\n        \"difficulty challenge\"\n    ],\n    [\n        \"(DEAD)\",\n        \"(DEAD!)\"\n    ],\n    [\n        \"DEX\",\n        \"dexterity\"\n    ],\n    [\n        \"Dungeon floor:\",\n        \"Dungeon floor: ${0}\"\n    ],\n    [\n        \"Experience:\",\n        \"Experience: ${0}\"\n    ],\n    [\n        \"Feet\",\n        \"Feet\"\n    ],\n    [\n        \"Score:\",\n        \"Score: ${0}\"\n    ],\n    [\n        \"Gold:\",\n        \"Gold: ${0}\\xa0GP\"\n    ],\n    [\n        \"GOLD PIECES\",\n        \" gold pieces\"\n    ],\n    [\n        \"Hands\",\n        \"Hands\"\n    ],\n    [\n        \"Head\",\n        \"Head\"\n    ],\n    [\n        \"hover\",\n        \"hover\"\n    ],\n    [\n        \"(HP OUT OF VALUE)\",\n        \"(HP:\\xa0${0}/${1})\"\n    ],\n    [\n        \"(HP VALUE)\",\n        \"(HP:\\xa0${0})\"\n    ],\n    [\n        \"INT\",\n        \"intelligence\"\n    ],\n    [\n        \"Known spells\",\n        \"Known spells\"\n    ],\n    [\n        \"level\",\n        \"level\"\n    ],\n    [\n        \"LEVEL UP\",\n        \"Level up to ${0}\"\n    ],\n    [\n        \"Name:\",\n        \"Name: ${0}\"\n    ],\n    [\n        \"NSEW\",\n        \"north-south-east-west\"\n    ],\n    [\n        \"PB\",\n        \"proficiency bonus\"\n    ],\n    [\n        \"Prepared spells\",\n        \"Prepared spells\"\n    ],\n    [\n        \"Range:\",\n        \"Range: ${0-range}\"\n    ],\n    [\n        \"Ready magic\",\n        \"Ready magic\"\n    ],\n    [\n        \"Ring fingers\",\n        \"Ring fingers\"\n    ],\n    [\n        \"SHORT_RESTS_REMAINING\",\n        \"Short rests remaining\"\n    ],\n    [\n        \"STR\",\n        \"strength\"\n    ],\n    [\n        \"TRANSIENT\",\n        \"TRANSIENT\"\n    ],\n    [\n        \"Unknown\",\n        \"Unknown\"\n    ],\n    [\n        \"Wagon\",\n        \"Wagon\"\n    ],\n    [\n        \"Waist\",\n        \"Waist\"\n    ],\n    [\n        \"WIS\",\n        \"wisdom\"\n    ],\n    [\n        \"YOU DIED!\",\n        \"YOU DIED!\"\n    ],\n    [\n        \"zero\",\n        \"zero\"\n    ]\n]);\nvar $2651cee9e4814cb3$export$2e2bcd8739ae039 = $2651cee9e4814cb3$var$MESSAGE_MAP;\n\n\n\n\n\n\n\n\n\n/**\n * Tile size to use throughout the game\n */ const $3ddff52f0a89f4e7$var$TILE_SIZE = 48;\n/** @type {DOMHighResTimeStamp} */ let $3ddff52f0a89f4e7$var$lastTimeStamp;\n/**\n * Initialise the game engine.\n * @param {Object} screenOptions - @see {@link module:game/screen~setScreen} for\n * details of options.\n */ async function $3ddff52f0a89f4e7$var$initialise(screenOptions) {\n    (0, $7aed85f370071bde$export$2e2bcd8739ae039).setOptions(screenOptions);\n    const splashPopup = (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).popupElement($3ddff52f0a89f4e7$var$createSplashElement());\n    (0, $e6f3aae57afc1cde$export$af7faffe10421f14).setMap((0, $2651cee9e4814cb3$export$2e2bcd8739ae039));\n    (0, $777fa57823e630b1$export$9d534e3026b35ff)((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D());\n    $3ddff52f0a89f4e7$var$setupListeners();\n    (0, $09b31fa5c65d5acd$export$ef0c17c6967bb348)();\n    (0, $3a28f16acdd0ba47$export$2e2bcd8739ae039).showControlsDialog($3ddff52f0a89f4e7$var$createWelcomeElement(), {\n        okButtonLabel: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`BUTTON START`,\n        className: \"door\"\n    }).then(()=>(0, $805a550ae64cfa4a$export$6f18ed54727f6878)((0, $f0a94f3b2f305120$export$2e2bcd8739ae039).get(\"START_IN_FULLSCREEN\"))).then(()=>(0, $6f0e758381e3257c$export$2e2bcd8739ae039).loadAndPlayMusic((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).MUSIC)).then(()=>(0, $6f0e758381e3257c$export$2e2bcd8739ae039).loadEffects((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).SOUND_EFFECTS_MAP)).then(()=>(0, $abd0af492c6c3f51$export$2e2bcd8739ae039).loadSpriteMap((0, $a4c3b9ba384fa621$export$bd73ddfe5f8475d8).data, (0, $a4c3b9ba384fa621$export$bd73ddfe5f8475d8).textureUrl)).then(()=>$4f6b2ca1724556cd$export$fa2f0f26e19d189b((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).DUNGEON_SCRIPT)).then((script)=>(0, $cd2e32752119e7f3$export$2e2bcd8739ae039).setSceneList((0, $94049cc5d4f81fad$export$e41f9be9fd588ed)(script))).then(()=>(0, $ecf189a3ccc267f7$export$8775ef33499e3a00)((0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).ALMANAC_MAP)).then(()=>{\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(\"All assets loaded. Trigger main menu.\");\n        splashPopup.remove();\n        return (0, $6e0aaad189039339$export$2e2bcd8739ae039).triggerEvent((0, $6e0aaad189039339$export$2e2bcd8739ae039).EventId.MAIN_MENU);\n    }).then(()=>{\n        (0, $58e6413bb4f15583$export$2e2bcd8739ae039).onStartAnimation = ()=>$3ddff52f0a89f4e7$var$startAnimation();\n        (0, $58e6413bb4f15583$export$2e2bcd8739ae039).setAnimationState(true);\n    }).catch((error)=>{\n        (0, $733fb161db426370$export$2e2bcd8739ae039).error(error);\n        alert(`Fatal error in main game. ${error.message}`);\n        return;\n    });\n}\n/**\n * Set up the listeners.\n */ function $3ddff52f0a89f4e7$var$setupListeners() {\n    const canvas = (0, $7aed85f370071bde$export$2e2bcd8739ae039).getCanvas();\n    $d56a39ce6823f5f2$export$2b4524682ad19724(canvas);\n    canvas.addEventListener($d56a39ce6823f5f2$export$a5ec1de9afad15ae, (event)=>{\n        const x = event.detail.x;\n        const y = event.detail.y;\n        const mappedPositions = (0, $7aed85f370071bde$export$2e2bcd8739ae039).uiCoordsToMappedPositions(x, y);\n        if (!(0, $fd5e96b24678cb30$export$2e2bcd8739ae039).resolveClick(mappedPositions)) (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).resolveClick(mappedPositions);\n    });\n    canvas.addEventListener($d56a39ce6823f5f2$export$90ded0e426ce21, (event)=>{\n        const x = event.detail.x;\n        const y = event.detail.y;\n        const mappedPositions = (0, $7aed85f370071bde$export$2e2bcd8739ae039).uiCoordsToMappedPositions(x, y);\n        (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).resolvePointerDown(mappedPositions);\n    });\n    canvas.addEventListener($d56a39ce6823f5f2$export$3853e404217e8f25, (event)=>{\n        const x = event.detail.x;\n        const y = event.detail.y;\n        const mappedPositions = (0, $7aed85f370071bde$export$2e2bcd8739ae039).uiCoordsToMappedPositions(x, y);\n        (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).resolvePointerUp(mappedPositions);\n    });\n    canvas.addEventListener($d56a39ce6823f5f2$export$f1ed6970fd95c8d6, (event)=>{\n        const x = event.detail.x;\n        const y = event.detail.y;\n        const mappedPositions = (0, $7aed85f370071bde$export$2e2bcd8739ae039).uiCoordsToMappedPositions(x, y);\n        (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).resolvePointerCancel(mappedPositions);\n    });\n    canvas.addEventListener($d56a39ce6823f5f2$export$d69198a72de4964d, (event)=>{\n        (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).panCameraBy(-event.detail.dx, -event.detail.dy);\n    });\n    canvas.addEventListener($d56a39ce6823f5f2$export$fc5c5be4a666ab48, (event)=>{\n        const x = event.detail.x;\n        const y = event.detail.y;\n        const mappedPositions = (0, $7aed85f370071bde$export$2e2bcd8739ae039).uiCoordsToMappedPositions(x, y);\n        if (!(0, $fd5e96b24678cb30$export$2e2bcd8739ae039).resolveContextMenu(mappedPositions)) (0, $3f6edc4fdcc84f8a$export$2e2bcd8739ae039).resolveContextMenu(mappedPositions);\n        event.preventDefault();\n    });\n}\n/**\n * Start the game.\n */ function $3ddff52f0a89f4e7$var$startAnimation() {\n    window.requestAnimationFrame($3ddff52f0a89f4e7$var$gameLoop);\n}\n/**\n * Main animation loop.\n * @param {DOMHighResTimeStamp} timeStamp\n */ function $3ddff52f0a89f4e7$var$gameLoop(timeStamp) {\n    (0, $75e8647c58e323d8$export$2e2bcd8739ae039).updateTimeNow(timeStamp);\n    if ($3ddff52f0a89f4e7$var$lastTimeStamp) {\n        const deltaSeconds = (timeStamp - $3ddff52f0a89f4e7$var$lastTimeStamp) / 1000;\n        (0, $cd2e32752119e7f3$export$2e2bcd8739ae039).update(deltaSeconds);\n        (0, $fd5e96b24678cb30$export$2e2bcd8739ae039).update(deltaSeconds);\n        if ($594075967358f0cc$export$8eb3892b442747bd.showFps) $3ddff52f0a89f4e7$var$showFps(1 / deltaSeconds);\n    }\n    $3ddff52f0a89f4e7$var$lastTimeStamp = timeStamp;\n    if ((0, $58e6413bb4f15583$export$2e2bcd8739ae039).isAnimationOn()) window.requestAnimationFrame($3ddff52f0a89f4e7$var$gameLoop);\n}\n/**\n * Show frames per second on screen.\n * @param {number} fps - frames per second\n */ function $3ddff52f0a89f4e7$var$showFps(fps) {\n    $70f71c2a1614355b$export$bec150f75a9b8f11((0, $7aed85f370071bde$export$2e2bcd8739ae039).getContext2D(), `FPS: ${Math.round(fps)}`, {\n        x: 0,\n        y: (0, $7aed85f370071bde$export$2e2bcd8739ae039).getCanvasDimensions().height\n    }, {\n        color: \"green\"\n    });\n}\n/**\n * Create welcome element including content warnings\n */ function $3ddff52f0a89f4e7$var$createWelcomeElement() {\n    const container = document.createElement(\"div\");\n    container.appendChild((0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"p\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`MESSAGE WELCOME`\n    }));\n    container.appendChild((0, $58ea3f4a4bcc116e$export$c8a8987d4410bf2d)(\"p\", {\n        text: (0, $e6f3aae57afc1cde$export$a7357cdd1f0b0168)`TRIGGERS`\n    }));\n    return container;\n}\n/**\n * Create the splash screen element.\n * @returns {ELement}\n */ function $3ddff52f0a89f4e7$var$createSplashElement() {\n    const splash = document.createElement(\"div\");\n    const image = document.createElement(\"img\");\n    image.src = (0, $a4c3b9ba384fa621$export$54b43579d6cb0cf2).SPLASH_IMAGE;\n    splash.appendChild(image);\n    const loading = document.createElement(\"div\");\n    loading.className = \"progress-indicator\";\n    splash.appendChild(loading);\n    const loadingText = document.createElement(\"p\");\n    loadingText.innerText = \"Loading\"; // do not use message map as not loaded yet.\n    splash.appendChild(loadingText);\n    return splash;\n}\n/**\n * The game singleton\n */ const $3ddff52f0a89f4e7$var$GAME = {\n    TILE_SIZE: $3ddff52f0a89f4e7$var$TILE_SIZE,\n    initialise: $3ddff52f0a89f4e7$var$initialise\n};\nvar $3ddff52f0a89f4e7$export$2e2bcd8739ae039 = $3ddff52f0a89f4e7$var$GAME;\n\n\n\n/**\n * Class that allows testing of features that may fall over in unsupported\n * browsers. As they generate a syntax error, this will not be caught.\n * The static testSupportedFeatures method should be called before clearing the\n * default HTML.\n */ class $25d927bcec52155b$var$FeatureSupportTest {\n    #privateMember;\n    arrowFunction;\n    constructor(){\n        this.#privateMember = [\n            \"one\",\n            \"two\",\n            \"three\"\n        ];\n        this.arrowFunction = (data)=>`[${data}]`;\n    }\n    /**\n   * Getter\n   * @returns {string}\n   */ get privateMember() {\n        return this.#privateMember;\n    }\n    /**\n   * @param {string} value\n   */ set privateMember(value) {\n        this.#privateMember = value;\n    }\n    /**\n   * Code that uses modern features that may not be supported by the browser.\n   * @returns {string} test message\n   */ #test() {\n        const arr = [\n            this.#privateMember,\n            \"two\",\n            \"three\"\n        ];\n        const copy = [\n            ...arr\n        ].map((entry)=>this.arrowFunction(entry));\n        return copy.join(\", \");\n    }\n    /**\n   * @param {string} text\n   */ static testSupportedFeatures(text) {\n        const tester = new $25d927bcec52155b$var$FeatureSupportTest();\n        tester.privateMember = text; // setter\n        const result = tester.#test();\n        (0, $733fb161db426370$export$2e2bcd8739ae039).debug(result);\n    }\n}\n/**\n * Get the maximum scale allowed for the game.\n * @returns {number}\n */ function $25d927bcec52155b$var$getMaxScale() {\n    return (0, $f0a94f3b2f305120$export$2e2bcd8739ae039).get(\"DO_NOT_SCALE\", false) ? 1 : 2.4;\n}\nwindow.addEventListener(\"load\", ()=>{\n    $25d927bcec52155b$var$FeatureSupportTest.testSupportedFeatures(\"one\");\n    const DESIGN_WIDTH = 800;\n    const DESIGN_HEIGHT = 600;\n    try {\n        (0, $3ddff52f0a89f4e7$export$2e2bcd8739ae039).initialise({\n            width: DESIGN_WIDTH,\n            height: DESIGN_HEIGHT,\n            maxScale: $25d927bcec52155b$var$getMaxScale(),\n            minScale: 1,\n            sizingMethod: \"COVER\",\n            alpha: false\n        });\n    } catch (error) {\n        (0, $733fb161db426370$export$2e2bcd8739ae039).fatal(error);\n    }\n});\n\n})();\n//# sourceMappingURL=index.9a982cac.js.map\n","/**\n * @file Main entry point\n *\n * @module index\n */\n/**\n * @license See {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n */\n/**\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport './utils/polyfills/string.js';\nimport LOG from './utils/logging.js';\nimport GAME from './gameManagement/game.js';\nimport PERSISTENT_DATA from './utils/persistentData.js';\n/**\n * Class that allows testing of features that may fall over in unsupported\n * browsers. As they generate a syntax error, this will not be caught.\n * The static testSupportedFeatures method should be called before clearing the\n * default HTML.\n */\nclass FeatureSupportTest {\n  #privateMember;\n  arrowFunction;\n\n  constructor() {\n    this.#privateMember = ['one', 'two', 'three'];\n    this.arrowFunction = (data) => `[${data}]`;\n  }\n  /**\n   * Getter\n   * @returns {string}\n   */\n  get privateMember() {\n    return this.#privateMember;\n  }\n\n  /**\n   * @param {string} value\n   */\n  set privateMember(value) {\n    this.#privateMember = value;\n  }\n\n  /**\n   * Code that uses modern features that may not be supported by the browser.\n   * @returns {string} test message\n   */\n  #test() {\n    const arr = [this.#privateMember, 'two', 'three'];\n    const copy = [...arr].map((entry) => this.arrowFunction(entry));\n    return copy.join(', ');\n  }\n\n  /**\n   * @param {string} text\n   */\n  static testSupportedFeatures(text) {\n    const tester = new FeatureSupportTest();\n    tester.privateMember = text; // setter\n    const result = tester.#test();\n    LOG.debug(result);\n  }\n}\n\n/**\n * Get the maximum scale allowed for the game.\n * @returns {number}\n */\nfunction getMaxScale() {\n  return PERSISTENT_DATA.get('DO_NOT_SCALE', false) ? 1 : 2.4;\n}\n\nwindow.addEventListener('load', () => {\n  FeatureSupportTest.testSupportedFeatures('one');\n  const DESIGN_WIDTH = 800;\n  const DESIGN_HEIGHT = 600;\n\n  try {\n    GAME.initialise({\n      width: DESIGN_WIDTH,\n      height: DESIGN_HEIGHT,\n      maxScale: getMaxScale(),\n      minScale: 1,\n      sizingMethod: 'COVER',\n      alpha: false,\n    });\n  } catch (error) {\n    LOG.fatal(error);\n  }\n});\n","/**\n * @file Polyfills\n *\n * @module utils/polyfills/string\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n/**\n * @file Polyfills and shims for String\n *\n * @module utils/polyfills/string\n *\n * @license GPL-3.0-or-later\n * Create quizzes and lessons from plain text files.\n * Copyright 2023 Steve Butler (henspace.com)\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n */\n\n/**\n * Implement replaceAll function if not already implemented.\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replaceAll}\n *\n * @param {string} str - the source string\n * @param {string | RegExp} pattern - the pattern to look for in the source string\n * @param {string} replacement - the replacement\n */\n\nif (!String.prototype.replaceAll) {\n  String.prototype.replaceAll = function stringReplaceAll(\n    pattern,\n    replacement\n  ) {\n    if (pattern instanceof RegExp) {\n      if (pattern.flags.indexOf('g') < 0) {\n        throw new TypeError(\n          'String.prototype.replaceAll called with a non-global RegExp argument'\n        );\n      }\n      return this.replace(pattern, replacement);\n    } else {\n      return this.replace(new RegExp(pattern, 'g'), replacement);\n    }\n  };\n}\n\nfunction isLeadingSurrogate(codePoint) {\n  return codePoint >= 0xd800 && codePoint <= 0xdbff;\n}\n\nfunction isTrailingSurrogate(codePoint) {\n  return codePoint >= 0xdc00 && codePoint <= 0xdfff;\n}\n\nconst UNICODE_REPLACEMENT = '\\uFFFD';\n\n/**\n * Replace lone surrogates with UNICODE_REPLACEMENT\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toWellFormed}\n * @param {string} str\n * @returns {string}\n */\nexport function toWellFormed(str) {\n  if (!str) {\n    return str;\n  }\n  let result = '';\n  for (const chr of str) {\n    const codePoint = chr.codePointAt(0);\n    if (isLeadingSurrogate(codePoint) || isTrailingSurrogate(codePoint)) {\n      result += UNICODE_REPLACEMENT; // next character is not a trailing surrogate\n    } else {\n      result += chr;\n    }\n  }\n  return result;\n}\n\n/**\n * Shim toWellFormed\n */\nif (!String.prototype.toWellFormed) {\n  String.prototype.toWellFormed = function toWellFormed() {\n    const str = this;\n    if (!str) {\n      return str;\n    }\n    let result = '';\n    for (const chr of str) {\n      const codePoint = chr.codePointAt(0);\n      if (isLeadingSurrogate(codePoint) || isTrailingSurrogate(codePoint)) {\n        result += UNICODE_REPLACEMENT; // next character is not a trailing surrogate\n      } else {\n        result += chr;\n      }\n    }\n    return result;\n  };\n}\n","/**\n * @file Handle logging. This allows easier access to logs on mobile devices.\n *\n * @module utils/logging\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport { RingBuffer } from './ringBuffer.js';\n\n/**\n * @typedef {number} LogTypeValue\n */\n/**\n * @enum {LogTypeValue}\n */\nconst LogType = {\n  LOG: 0,\n  INFO: 1,\n  DEBUG: 2,\n  ERROR: 3,\n};\n\n/**\n * Only info and errors are recorded.\n * @type {RingBuffer<LogEntry>}\n */\nlet messages = new RingBuffer(50);\n\n/** Add listener for syntax errors. */\nwindow.addEventListener('error', (event) => {\n  alert(\n    `ERROR: ${event.filename}; line ${event.lineno}\\n${event.message}\\n:Stack:\\n${event.error.stack}`\n  );\n});\n\n/**\n * Add data to messages.\n * @param {*} data\n */\nfunction addDataToMessages(data, logType) {\n  let prefix;\n  switch (logType) {\n    case LogType.DEBUG:\n      prefix = ':-/ ';\n      break;\n    case LogType.INFO:\n      prefix = '(i) ';\n      break;\n    case LogType.ERROR:\n      prefix = '/! ';\n      break;\n    case LogType.LOG:\n    default:\n      prefix = '';\n      break;\n  }\n  for (const item of data) {\n    messages.add(`${prefix}${item}`);\n  }\n}\n/**\n * Log information.\n * @param  {...any} data\n */\nfunction logGeneral(...data) {\n  console.log(...data);\n  //addDataToMessages(LogType.LOG);\n}\n\n/**\n * Log information.\n * @param  {...any} data\n */\nfunction logInfo(...data) {\n  console.info(...data);\n  addDataToMessages(data, LogType.INFO);\n}\n\n/**\n * Log information.\n * @param  {...any} data\n */\nfunction logDebug(...data) {\n  console.debug(...data);\n  //addDataToMessages(data, LogType.DEBUG);\n}\n\n/**\n * Log error information.\n * @param  {...any} data\n */\nfunction logError(...data) {\n  console.error(...data);\n  addDataToMessages(data, LogType.ERROR);\n}\n\n/**\n * Log error information.\n * @param  {Error}} data\n */\nfunction logFatal(error) {\n  console.error(error);\n  let message;\n  if (error.message) {\n    message = `${error.message}\\nStack:\\n${error.stack}`;\n  } else {\n    message = error;\n  }\n  alert(`Fatal error: ${message}\\nPrevious errors:\\n${messages.join('\\n')}`);\n  addDataToMessages(message, LogType.ERROR);\n}\n\n/**\n * Get the messages.\n * @returns {string[]}\n */\nfunction getAll() {\n  return messages.getAll();\n}\n\n/**\n * Object to access logging routines.\n */\nconst LOG = {\n  log: logGeneral,\n  info: logInfo,\n  debug: logDebug,\n  error: logError,\n  fatal: logFatal,\n  getMessages: getAll,\n};\n\nexport default LOG;\n","/**\n * @file Simple ring buffer\n *\n * @module utils/ringBuffer\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nexport class RingBuffer {\n  /** @type {number} */\n  #indexIn;\n  /** @type {number} */\n  #indexOut;\n  /** @type {number} */\n  #size;\n  /** @type {Array.<*>} */\n  #data;\n  /**\n   * Create ring buffer\n   * @param {number} size\n   */\n  constructor(size) {\n    this.#size = size;\n    this.#indexIn = 0;\n    this.#indexOut = 0;\n    this.#data = [];\n  }\n\n  /**\n   * Clear all\n   */\n  clear() {\n    this.#data = [];\n    this.#indexIn = 0;\n    this.#indexOut = 0;\n  }\n  /**\n   * Add item to the buffer.\n   * @param {*} item\n   */\n  add(item) {\n    this.#data[this.#indexIn] = item;\n    this.#indexIn = this.#incIndex(this.#indexIn);\n    if (this.#indexIn === this.#indexOut) {\n      this.#indexOut = this.#incIndex(this.#indexOut);\n    }\n  }\n\n  /** Get all the items from the buffer.\n   * @returns {Array.<*>}\n   */\n  getAll() {\n    const result = [];\n    let out = this.#indexOut;\n    while (out !== this.#indexIn) {\n      result.push(this.#data[out]);\n      out = this.#incIndex(out);\n    }\n    return result;\n  }\n\n  #incIndex(index) {\n    index++;\n    if (index > this.#size) {\n      index = 0;\n    }\n    return index;\n  }\n}\n","/**\n * @file The main game. This is a singleton as there can only be a single game.\n *\n * @module gameManagement/game\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport SCREEN from '../utils/game/screen.js';\nimport WORLD from '../utils/game/world.js';\nimport HUD from '../hud/hud.js';\nimport { checkEmojis } from '../utils/text/emojis.js';\nimport GAME_CLOCK from '../utils/time/clock.js';\nimport * as debug from '../utils/debug.js';\nimport * as text from '../utils/text/text.js';\nimport * as assetLoaders from '../utils/assetLoaders.js';\nimport { createAutoSceneList } from '../scriptReaders/autoSceneList.js';\nimport SCENE_MANAGER from './sceneManager.js';\nimport UI from '../utils/dom/ui.js';\nimport LOG from '../utils/logging.js';\n\nimport * as pointerActions from '../utils/dom/pointerActions.js';\nimport TURN_MANAGER from './turnManager.js';\n\nimport IMAGE_MANAGER from '../utils/sprites/imageManager.js';\nimport SOUND_MANAGER from '../utils/soundManager.js';\nimport { initialiseSettings } from '../dialogs/settingsDialog.js';\n\nimport MESSAGE_MAP from '../constants/messageMap.js';\nimport { i18n, MESSAGES } from '../utils/messageManager.js';\nimport { loadAlmanacs } from '../dnd/almanacs/almanacs.js';\nimport { AssetUrls, SpriteSheet } from '../../assets/assets.js';\nimport ANIMATION_STATE_MANAGER from './animationState.js';\nimport PERSISTENT_DATA from '../utils/persistentData.js';\nimport { setFullscreenState } from '../utils/fullscreen.js';\nimport { createElement } from '../utils/dom/components.js';\n\n/**\n * Tile size to use throughout the game\n */\nconst TILE_SIZE = 48;\n\n/** @type {DOMHighResTimeStamp} */\nlet lastTimeStamp;\n\n/**\n * Initialise the game engine.\n * @param {Object} screenOptions - @see {@link module:game/screen~setScreen} for\n * details of options.\n */\nasync function initialise(screenOptions) {\n  SCREEN.setOptions(screenOptions);\n  const splashPopup = UI.popupElement(createSplashElement());\n  MESSAGES.setMap(MESSAGE_MAP);\n  checkEmojis(SCREEN.getContext2D());\n  setupListeners();\n  initialiseSettings();\n  UI.showControlsDialog(createWelcomeElement(), {\n    okButtonLabel: i18n`BUTTON START`,\n    className: 'door',\n  })\n    .then(() => setFullscreenState(PERSISTENT_DATA.get('START_IN_FULLSCREEN')))\n    .then(() => SOUND_MANAGER.loadAndPlayMusic(AssetUrls.MUSIC))\n    .then(() => SOUND_MANAGER.loadEffects(AssetUrls.SOUND_EFFECTS_MAP))\n\n    .then(() =>\n      IMAGE_MANAGER.loadSpriteMap(SpriteSheet.data, SpriteSheet.textureUrl)\n    )\n    .then(() => assetLoaders.loadTextFromUrl(AssetUrls.DUNGEON_SCRIPT))\n    .then((script) => SCENE_MANAGER.setSceneList(createAutoSceneList(script)))\n    .then(() => loadAlmanacs(AssetUrls.ALMANAC_MAP))\n    .then(() => {\n      LOG.debug('All assets loaded. Trigger main menu.');\n      splashPopup.remove();\n      return TURN_MANAGER.triggerEvent(TURN_MANAGER.EventId.MAIN_MENU);\n    })\n    .then(() => {\n      ANIMATION_STATE_MANAGER.onStartAnimation = () => startAnimation();\n      ANIMATION_STATE_MANAGER.setAnimationState(true);\n    })\n    .catch((error) => {\n      LOG.error(error);\n      alert(`Fatal error in main game. ${error.message}`);\n      return;\n    });\n}\n\n/**\n * Set up the listeners.\n */\nfunction setupListeners() {\n  const canvas = SCREEN.getCanvas();\n  pointerActions.addPointerListeners(canvas);\n\n  canvas.addEventListener(pointerActions.CUSTOM_CLICK_EVENT_NAME, (event) => {\n    const x = event.detail.x;\n    const y = event.detail.y;\n    const mappedPositions = SCREEN.uiCoordsToMappedPositions(x, y);\n    if (!HUD.resolveClick(mappedPositions)) {\n      WORLD.resolveClick(mappedPositions);\n    }\n  });\n\n  canvas.addEventListener(\n    pointerActions.CUSTOM_POINTER_DOWN_EVENT_NAME,\n    (event) => {\n      const x = event.detail.x;\n      const y = event.detail.y;\n      const mappedPositions = SCREEN.uiCoordsToMappedPositions(x, y);\n      HUD.resolvePointerDown(mappedPositions);\n    }\n  );\n\n  canvas.addEventListener(\n    pointerActions.CUSTOM_POINTER_UP_EVENT_NAME,\n    (event) => {\n      const x = event.detail.x;\n      const y = event.detail.y;\n      const mappedPositions = SCREEN.uiCoordsToMappedPositions(x, y);\n      HUD.resolvePointerUp(mappedPositions);\n    }\n  );\n\n  canvas.addEventListener(\n    pointerActions.CUSTOM_POINTER_CANCEL_EVENT_NAME,\n    (event) => {\n      const x = event.detail.x;\n      const y = event.detail.y;\n      const mappedPositions = SCREEN.uiCoordsToMappedPositions(x, y);\n      HUD.resolvePointerCancel(mappedPositions);\n    }\n  );\n\n  canvas.addEventListener(\n    pointerActions.CUSTOM_POINTER_DRAG_EVENT_NAME,\n    (event) => {\n      SCENE_MANAGER.panCameraBy(-event.detail.dx, -event.detail.dy);\n    }\n  );\n\n  canvas.addEventListener(\n    pointerActions.CUSTOM_CONTEXT_MENU_EVENT_NAME,\n    (event) => {\n      const x = event.detail.x;\n      const y = event.detail.y;\n      const mappedPositions = SCREEN.uiCoordsToMappedPositions(x, y);\n      if (!HUD.resolveContextMenu(mappedPositions)) {\n        WORLD.resolveContextMenu(mappedPositions);\n      }\n      event.preventDefault();\n    }\n  );\n}\n\n/**\n * Start the game.\n */\nfunction startAnimation() {\n  window.requestAnimationFrame(gameLoop);\n}\n\n/**\n * Main animation loop.\n * @param {DOMHighResTimeStamp} timeStamp\n */\nfunction gameLoop(timeStamp) {\n  GAME_CLOCK.updateTimeNow(timeStamp);\n  if (lastTimeStamp) {\n    const deltaSeconds = (timeStamp - lastTimeStamp) / 1000;\n    SCENE_MANAGER.update(deltaSeconds);\n    HUD.update(deltaSeconds);\n    if (debug.OPTIONS.showFps) {\n      showFps(1 / deltaSeconds);\n    }\n  }\n\n  lastTimeStamp = timeStamp;\n  if (ANIMATION_STATE_MANAGER.isAnimationOn()) {\n    window.requestAnimationFrame(gameLoop);\n  }\n}\n\n/**\n * Show frames per second on screen.\n * @param {number} fps - frames per second\n */\nfunction showFps(fps) {\n  text.writeText(\n    SCREEN.getContext2D(),\n    `FPS: ${Math.round(fps)}`,\n    {\n      x: 0,\n      y: SCREEN.getCanvasDimensions().height,\n    },\n    { color: 'green' }\n  );\n}\n\n/**\n * Create welcome element including content warnings\n */\nfunction createWelcomeElement() {\n  const container = document.createElement('div');\n  container.appendChild(createElement('p', { text: i18n`MESSAGE WELCOME` }));\n  container.appendChild(createElement('p', { text: i18n`TRIGGERS` }));\n\n  return container;\n}\n/**\n * Create the splash screen element.\n * @returns {ELement}\n */\nfunction createSplashElement() {\n  const splash = document.createElement('div');\n  const image = document.createElement('img');\n  image.src = AssetUrls.SPLASH_IMAGE;\n  splash.appendChild(image);\n\n  const loading = document.createElement('div');\n  loading.className = 'progress-indicator';\n  splash.appendChild(loading);\n\n  const loadingText = document.createElement('p');\n  loadingText.innerText = 'Loading'; // do not use message map as not loaded yet.\n  splash.appendChild(loadingText);\n\n  return splash;\n}\n\n/**\n * The game singleton\n */\nconst GAME = {\n  TILE_SIZE: TILE_SIZE,\n  initialise: initialise,\n};\n\nexport default GAME;\n","/**\n * @file Utilities for handling the screen size. The screen is implemented as\n * a singleton.\n * The game is configured as a world and a screen. The screen is the area that is\n * rendered with a canvas. The world is the total space in which objects can\n * exist. The world is potentially unbounded.\n *\n * The canvas is set to the same size as the screen and then the canvas is\n * resized to fit the display using CSS.\n *\n * The canvas is centred on the camera, so although the canvas rect and screen\n * rect are the same size, the screen always has its top left at 0, 0 in the world\n * whereas the canvas rect may effectively move around the world.\n *\n * @module utils/screen\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as fonts from '../text/fonts.js';\nimport { Position, Rectangle } from '../geometry.js';\nimport LOG from '../logging.js';\n\n/**\n * @typedef {Object} ScreenDetails\n * @property {HTMLCanvasElement} canvas\n * @property {number} width\n * @property {number} height\n * @property {number} x\n * @property {number} y\n */\nlet throttleTimer = null;\n\nlet canvas = null;\nlet canvasRect = null;\nlet canvasHalfWidth = 0;\nlet canvasHalfHeight = 0;\nlet canvasAlpha = true;\nlet visibleCanvasRect = null;\nlet gameElement = null;\n\nlet left = 0;\nlet top = 0;\n//let screenRect;\nlet scale = 1;\nlet maxScale = 1;\nlet minScale = 0.1;\nlet sizingMethod = 'COVER';\nlet cameraPosition = new Position(0, 0, 0);\n\n/**\n * Add event listener to handle resizing of the window.\n */\nwindow.addEventListener('resize', () => {\n  if (throttleTimer !== null) {\n    return; // it will get handled.\n  }\n  throttleTimer = window.setTimeout(() => {\n    resize();\n    throttleTimer = null;\n  }, 200);\n});\n\n/**\n * Get dimensions of the working area for the game.\n * @returns {module:utils/geometry~Dims2D}\n */\nfunction getDisplayDims() {\n  return { width: window.innerWidth, height: window.innerHeight };\n}\n/**\n * @param {Object} options - config options.\n * @param {number} options.width - the design width for the screen.\n * @param {number} options.height - the design height for the page.\n * @param {number} options.maxScale - maximum scaling allowed\n * @param {string} options.sizingMethod  - 'FIT' or 'COVER'. Defaults to 'FIT'\n * @param {boolean} options.alpha - Should canvas have an alpha channel\n */\nfunction setOptions(options) {\n  if (canvas) {\n    LOG.error('Multiple calls to setScreen ignored.');\n    return;\n  }\n\n  LOG.debug(`Max canvas scaling set to ${options.maxScale}.`);\n  gameElement = document?.getElementById('game-content');\n  if (!gameElement) {\n    LOG.debug('No game element so assuming running as Jest test. No ui');\n    return;\n  }\n  gameElement.replaceChildren();\n  fonts.initialise(options.width);\n  canvas = document.createElement('canvas');\n  canvas.id = 'game-canvas';\n  canvas.setAttribute('width', options.width);\n  canvas.setAttribute('height', options.height);\n  canvas.innerText = 'Loading the app.';\n  canvasRect = new Rectangle(0, 0, options.width, options.height);\n  canvasHalfWidth = options.width / 2;\n  canvasHalfHeight = options.height / 2;\n\n  gameElement.appendChild(canvas);\n\n  maxScale = options.maxScale;\n  minScale = options.minScale;\n  sizingMethod = options.sizingMethod;\n  canvasAlpha = options.alpha;\n  setVhCssVariable();\n  sizeScreen();\n  syncDomFonts();\n}\n\n/**\n * Size the screen\n * @param {number} aspectRatio - aspect ratio (width / height) of the screen\n * @param {number} windowAspectRatio - aspect ratio (width / height) of the screen\n * @param {string} method - FIT or COVER. Defaults to FIT\n */\nfunction shouldFitHeight(aspectRatio, windowAspectRatio, sizingMethod) {\n  if (sizingMethod === 'COVER') {\n    return aspectRatio > windowAspectRatio;\n  } else {\n    return aspectRatio < windowAspectRatio;\n  }\n}\n/**\n * Resize the screen according to the current inner window dimensions.\n */\nfunction sizeScreen() {\n  const dims = getDisplayDims();\n  let aspectRatio = canvasRect.width / canvasRect.height;\n  let displayedHeight = 0;\n  let displayedWidth = 0;\n  const windowAspectRatio = dims.width / dims.height;\n  const fitHeight = shouldFitHeight(\n    aspectRatio,\n    windowAspectRatio,\n    sizingMethod\n  );\n  if (fitHeight) {\n    displayedHeight = dims.height;\n    displayedWidth = displayedHeight * aspectRatio;\n  } else {\n    displayedWidth = dims.width;\n    displayedHeight = displayedWidth / aspectRatio;\n  }\n\n  scale = displayedWidth / canvasRect.width;\n  if (scale > maxScale) {\n    scale = maxScale;\n    displayedWidth = scale * canvasRect.width;\n    displayedHeight = scale * canvasRect.height;\n  } else if (scale < minScale) {\n    scale = minScale;\n    displayedWidth = scale * canvasRect.width;\n    displayedHeight = scale * canvasRect.height;\n  }\n\n  left = (dims.width - displayedWidth) / 2;\n  top = (dims.height - displayedHeight) / 2;\n\n  canvas.style.left = `${left}px`;\n  canvas.style.top = `${top}px`;\n  canvas.style.width = `${displayedWidth}px`;\n  canvas.style.height = `${displayedHeight}px`;\n\n  let visibleCanvasWidth;\n  let visibleCanvasHeight;\n  let visibleCanvasOffsetX;\n  let visibleCanvasOffsetY;\n  if (left < 0) {\n    visibleCanvasOffsetX = -left / scale;\n    visibleCanvasWidth = dims.width / scale;\n  } else {\n    visibleCanvasOffsetX = 0;\n    visibleCanvasWidth = canvasRect.width;\n  }\n  if (top < 0) {\n    visibleCanvasOffsetY = -top / scale;\n    visibleCanvasHeight = dims.height / scale;\n  } else {\n    visibleCanvasOffsetY = 0;\n    visibleCanvasHeight = canvasRect.height;\n  }\n\n  visibleCanvasRect = new Rectangle(\n    visibleCanvasOffsetX,\n    visibleCanvasOffsetY,\n    visibleCanvasWidth,\n    visibleCanvasHeight\n  );\n  LOG.debug(`Scale: ${scale}`);\n  LOG.debug(`Window: width: ${dims.width}, height: ${dims.height}`);\n  LOG.debug(\n    `Display: left: ${left}, top: ${top}, width: ${displayedWidth}, height: ${displayedHeight}`\n  );\n  LOG.debug(\n    `Visible canvas: left: ${visibleCanvasOffsetX}, top: ${visibleCanvasOffsetY}, width: ${visibleCanvasWidth}, height: ${visibleCanvasHeight}`\n  );\n}\n\n/**\n * Adjust the font sizes to ensure glass in sync with canvas.\n */\nfunction syncDomFonts() {\n  const rootFontSize = fonts.getRootFontSize() * scale;\n  document.documentElement.style.fontSize = `${rootFontSize}px`;\n}\n\n/**\n * Set the vh variable in the CSS. This allows for browsers that include the address bar\n * in the vh calculation.\n */\nfunction setVhCssVariable() {\n  const vh = window.innerHeight * 0.01;\n  document.documentElement.style.setProperty('--vh', `${vh}px`);\n}\n\n/**\n * Resize the screen.\n */\nfunction resize() {\n  sizeScreen();\n  syncDomFonts();\n}\n/**\n * @typedef {Object} screenDetails\n * @property {HTMLCanvasElement} canvas\n * @property {number} width - design width\n * @property {number} height - design height\n */\n\n/**\n * Clear the canvas.\n */\nfunction clearCanvas() {\n  getContext2D().clearRect(0, 0, canvasRect.width, canvasRect.height);\n}\n\n/**\n * Get the bounds of the world that are plotted in the canvas.\n * @returns {Rectangle}\n */\nfunction getWorldInCanvasBounds() {\n  return new Rectangle(\n    cameraPosition.x,\n    cameraPosition.y,\n    canvasRect.width,\n    canvasRect.height\n  );\n}\n\n/**\n * Get canvas dimensions.\n * @returns {Dims2D}\n */\nfunction getCanvasDimensions() {\n  return { width: canvasRect.width, height: canvasRect.height };\n}\n\n/**\n * Get the canvas context.\n * @returns {CanvasRenderingContext2D}\n */\nfunction getContext2D() {\n  return canvas.getContext('2d', { alpha: canvasAlpha });\n}\n\n/**\n * @typedef {Object} Closers\n * @property {Element} element - when clicked, this should close a display.\n * @property {number} response - the response returned if this element closed a display.\n */\n/**\n * Set the content of the glass layer. OnClick events are added automatically to the\n * closers.\n * @param {HTMLElement} element\n * @param {Object} options\n * @param {Closers[]} options.closers - array of Closers. If not provided then the entire display\n * is used.\n * @param {string} options.className\n * @param {boolean} options.replace - replace current glass\n * @returns {Promise} fulfils to closers.closes value\n */\nfunction displayOnGlass(element, options) {\n  let glass;\n  if (options.replace) {\n    glass = document.getElementsByClassName('glass')[0];\n    glass?.replaceChildren();\n  }\n  if (!glass) {\n    glass = document.createElement('div');\n    document.body.appendChild(glass);\n    glass.className = 'glass';\n  }\n  const glassContent = document.createElement('div');\n  glass.appendChild(glassContent);\n  glassContent.className = 'glass-content';\n  glassContent.appendChild(element);\n  if (options.className) {\n    glass.classList.add(options.className);\n  }\n  glass.style.display = 'block';\n  glass.style.opacity = 1;\n  // calculate if content overflows. This is used because of lack of CSS support\n  // for safe in Safari.\n  const contentHeight = glassContent.getBoundingClientRect().height;\n  if (glassContent.scrollHeight > contentHeight) {\n    glassContent.classList.add('overflow');\n  }\n  const promises = [];\n  if (options.closers && options.closers.length > 0) {\n    options.closers.forEach((closer) => {\n      const promise = new Promise((resolve) => {\n        closer.element.addEventListener('click', async () => {\n          resolve(closer.closes);\n        });\n      });\n      promises.push(promise);\n    });\n  } else {\n    const promise = new Promise((resolve) =>\n      glassContent.addEventListener('click', () => resolve())\n    );\n    promises.push(promise);\n  }\n  let closingResponse;\n  return Promise.race(promises)\n    .then((response) => {\n      closingResponse = response;\n      return wipeGlass(glass);\n    })\n    .then(() => closingResponse);\n}\n\n/**\n * Clear and close the glass layer. The layer is hidden and it's content removed.\n * @param {Element} glass\n * @returns {Promise} fulfils to undefined. This is to allow opacity transition.\n */\nfunction wipeGlass(glass) {\n  glass.style.opacity = 0;\n  window.setTimeout(() => {\n    glass.remove();\n  }, 500);\n  return Promise.resolve();\n}\n\n/**\n * Pan the camera.\n * @param {number} dx - movement in world units\n * @param {number} dy - movement in world units\n */\nfunction panCamera(dx, dy) {\n  cameraPosition.x += dx;\n  cameraPosition.y += dy;\n}\n\n/**\n * Centre the canvas on a point\n * @param {Point} point\n */\nfunction centreCanvasOn(point) {\n  cameraPosition.x = point.x - canvasHalfWidth;\n  cameraPosition.y = point.y - canvasHalfHeight;\n}\n\n/**\n * Convert a distance from ui units to world units.\n * @param {number} dist\n * @returns {number}\n */\nfunction uiToWorld(dist) {\n  return dist / scale;\n}\n\n/**\n * Convert a distance from world units to ui units.\n * @param {number} dist\n * @returns {number}\n */\nfunction worldToUi(dist) {\n  return dist * scale;\n}\n\n/**\n * @typedef {Object} MappedPositions\n * @property {Position} canvas - position on the canvas\n * @property {Position} world - position in the world\n */\n/**\n * Convert ui Coordinates to world Position\n * @param {number} x  -position in the ui\n * @param {number} y  -position in the ui\n * @returns {MappedPositions} position on the canvas\n */\nfunction uiCoordsToMappedPositions(x, y) {\n  x = uiToWorld(x);\n  y = uiToWorld(y);\n  const canvasPosition = new Position(Math.round(x), Math.round(y));\n  const worldPosition = new Position(\n    Math.round(x + cameraPosition.x),\n    Math.round(y + cameraPosition.y),\n    -cameraPosition.rotation\n  );\n  return { canvas: canvasPosition, world: worldPosition };\n}\n\n/**\n * Convert world Position to canvas Position\n * @param {Position} position  -position in the world\n * @returns {Position} position on the canvas\n */\nfunction worldPositionToCanvas(position) {\n  return new Position(\n    position.x - cameraPosition.x,\n    position.y - cameraPosition.y,\n    position.rotation\n  );\n}\n\n/**\n * Convert canvas Position to world Position\n * @param {Position} position  -position on the canvas\n * @returns {Position} position in the world\n */\nfunction canvasPositionToWorld(position) {\n  return new Position(\n    position.x + cameraPosition.x,\n    position.y + cameraPosition.y,\n    position.rotation\n  );\n}\n\n/**\n * Convert glass position to world position. Negative positions are calculated as\n * offsets from the right and bottom of the glass dimensions. Otherwise they are\n * calculated as offsets from the left and top.\n * @returns {Position}\n */\nfunction glassPositionToWorld(position) {\n  const xOrigin =\n    position.x < 0\n      ? visibleCanvasRect.x + visibleCanvasRect.width\n      : visibleCanvasRect.x;\n  const yOrigin =\n    position.y < 0\n      ? visibleCanvasRect.y + visibleCanvasRect.height\n      : visibleCanvasRect.y;\n\n  let x = xOrigin + position.x;\n  let y = yOrigin + position.y;\n\n  return canvasPositionToWorld(new Position(x, y, position.rotation));\n}\n\n/**\n * Test if rectangle on screen.\n * @param {Rectangle} rect\n * @return {boolean} true if on screen\n */\nfunction isOnScreen(rect) {\n  return rect.overlaps(canvasRect);\n}\n\n/**\n * Test if rectangle is visible on the canvas.\n * @param {Rectangle} rect - this should have been converted to canvas coordinates\n * @return {boolean} true if on screen\n */\nfunction isOnCanvas(rect) {\n  return rect.overlaps(canvasRect);\n}\n\n/**\n * Get the dimensions of the visible canvas.\n * @returns {Rectangle}\n */\nfunction getVisibleCanvasRect() {\n  return visibleCanvasRect;\n}\n\n/**\n * Set the global opacity.\n * @param {number} opacity\n */\nfunction setOpacity(opacity) {\n  getContext2D().globalAlpha = opacity;\n}\n/**\n * Screen object\n */\nconst SCREEN = {\n  canvasPositionToWorld: canvasPositionToWorld,\n  centreCanvasOn: centreCanvasOn,\n  clearCanvas: clearCanvas,\n  displayOnGlass: displayOnGlass,\n  getCanvas: () => canvas,\n  getContext2D: getContext2D,\n  getCanvasDimensions: getCanvasDimensions,\n  getWorldInCanvasBounds: getWorldInCanvasBounds,\n  getVisibleCanvasRect: getVisibleCanvasRect,\n  glassPositionToWorld: glassPositionToWorld,\n  isOnCanvas: isOnCanvas,\n  isOnScreen: isOnScreen,\n  panCamera: panCamera,\n  resize: resize,\n  setOpacity: setOpacity,\n  setOptions: setOptions,\n  wipeGlass: wipeGlass,\n  worldPositionToCanvas: worldPositionToCanvas,\n  worldToUi: worldToUi,\n  uiCoordsToMappedPositions: uiCoordsToMappedPositions,\n  uiToWorld: uiToWorld,\n};\n\nexport default SCREEN;\n","/**\n * @file Font data\n *\n * @module utils/text/fonts\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst baseSize = 15; // minimum pixel size\n\n/*\n * These should be replicated in the CSS.\n */\nconst H1_FONT_SCALE = 2.0;\nconst H2_FONT_SCALE = 1.5;\nconst H3_FONT_SCALE = 1.2;\n\nconst NORMAL_FONT = \"'UnifrakturCook', cursive\"; // cspell:disable-line\nconst HEADING_FONT = \"'UnifrakturCook', cursive\"; // cspell:disable-line\nconst EMOJI_SPRITE_FONT = \"'UnifrakturCook', cursive\"; // cspell:disable-line\n\n/**\n * @typedef {Object} TextInfo\n * @property {number} size\n * @property {string} fontName\n */\n/**\n * Named styles.\n * @type {Object.<String, TextInfo>}\n */\nconst textInfo = {\n  normal: { size: 15, fontName: NORMAL_FONT },\n  h1: { size: 30, fontName: HEADING_FONT },\n  h2: { size: 22, fontName: HEADING_FONT },\n  h3: { size: 18, fontName: HEADING_FONT },\n  emojiSprite: { size: 18, fontName: EMOJI_SPRITE_FONT },\n};\n\n/**\n * Sets up font sizes based on the design display width.\n * The actual normal font size is worked out using the CSS formula normally\n * based on the display width.\n * @param {number} designWidth\n */\nexport function initialise(designWidth) {\n  textInfo.normal.size = baseSize + 0.390625 * (designWidth / 100);\n  textInfo.h1.size = textInfo.normal.size * H1_FONT_SCALE;\n  textInfo.h2.size = textInfo.normal.size * H2_FONT_SCALE;\n  textInfo.h3.size = textInfo.normal.size * H3_FONT_SCALE;\n  textInfo.emojiSprite.size = designWidth / 10;\n}\n\n/**\n * Get font CSS for styleName.\n * @param {string} styleName - default, h1, h2, or h3. Defaults to default.\n * @returns {string}\n */\nexport function getCss(styleName) {\n  const info = textInfo[styleName] ?? textInfo['normal'];\n  return `${info.size}px ${info.fontName}`;\n}\n\n/**\n * Get the root font size. This is the size base on the design dimensions and is\n * the size as written to the canvas. It does not allow for any scaling of the\n * canvas by CSS.\n */\nexport function getRootFontSize() {\n  return textInfo.normal.size;\n}\n","/**\n * @file Functions for dealing with geometry\n *\n * @module utils/geometry\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as maths from './maths.js';\n\n/**\n * Simple 2D dimension\n * @typedef {Object} Dims2D\n * @property {number} width\n * @property {number} height\n */\n\n/**\n * Simple encapsulation of a Point\n */\nexport class Point {\n  /** @type {number}*/\n  x;\n  /** @type {number}*/\n  y;\n\n  /**\n   * Create point\n   * @param {number} x\n   * @param {number} y\n   */\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  /**\n   * Create a copy of a point.\n   * @param {Point} point\n   * @returns {Point}\n   */\n  static copy(point) {\n    return new Point(point.x, point.y);\n  }\n\n  /**\n   * Check if points are coincident.\n   * @returns {boolean}\n   */\n  coincident(point) {\n    return this.x === point.x && this.y === point.y;\n  }\n\n  /**\n   * Get angle to target using normal cartesian coordinates; i.e up is +ve y.\n   * @param {Point} targetPos\n   * @returns {number} angle in radians.\n   */\n  getCartesianAngleTo(targetPos) {\n    return Math.atan2(targetPos.y - this.y, targetPos.x - this.x);\n  }\n\n  /**\n   * Get angle to target using normal screen coordinates; i.e down is +ve y.\n   * @param {Point} targetPos\n   * @returns {number} angle in radians.\n   */\n  getScreenAngleTo(targetPos) {\n    return Math.atan2(this.y - targetPos.y, targetPos.x - this.x);\n  }\n\n  /**\n   * String representation which can be used as key in maps.\n   * @returns {string}\n   */\n  toString() {\n    return `(${this.x},${this.y})`;\n  }\n\n  /**\n   * Test if the position is at the same point, rounded to integer as this.\n   * Rotation is ignored.\n   * @param {Position} position\n   * @returns {boolean}\n   */\n  isCoincident(position) {\n    return (\n      Math.round(this.x) === Math.round(position.x) &&\n      Math.round(this.y) === Math.round(position.y)\n    );\n  }\n\n  /**\n   * Test if points are adjacent, i.e within one\n   * @param {Point} other\n   * @param {number} distance\n   * @returns {boolean}\n   */\n  isOtherClose(other, distance) {\n    const dx = this.x - other.x;\n    const dy = this.y - other.y;\n    return Math.pow(dx, 2) + Math.pow(dy, 2) <= Math.pow(distance, 2);\n  }\n  /**\n   * Get the absolute orthogonal separation between this and the other point.\n   * The separation is calculated by move in the x direction followed by the\n   * y direction. I.e. no diagonal movement.\n   * @param {Point} other\n   * @returns {number}\n   */\n  getOrthoSeparation(other) {\n    return Math.abs(this.x - other.x) + Math.abs(this.y - other.y);\n  }\n}\n/**\n * Velocity class\n */\nexport class Velocity {\n  /** x velocity @type {number} */\n  x;\n  /** y velocity @type {number} */\n  y;\n  /** rotational velocity @type {number} */\n  rotation;\n\n  /**\n   *\n   * @param {number} velX\n   * @param {number} velY\n   * @param {number} velRot\n   */\n  constructor(velX, velY, velRot) {\n    this.x = velX;\n    this.y = velY;\n    this.rotation = velRot;\n  }\n\n  /**\n   * Get the angle in radians counterclockwise from x axis. This uses cartesian\n   * coordinates where the y axis is positive upwards.\n   * @returns {number}\n   */\n  getCartesianDirection() {\n    return Math.atan2(this.y, this.x);\n  }\n  /**\n   * Get the angle in radians counterclockwise from x axis. This uses screen\n   * coordinates where the y axis is positive downwards..\n   * @returns {number}\n   */\n  getScreenDirection() {\n    return Math.atan2(-this.y, this.x);\n  }\n\n  /**\n   * Test if velocity effectively zero.\n   * @param {number} tolerance\n   * @returns {boolean}\n   */\n  isZero(tolerance) {\n    return (\n      maths.floatIsZero(this.x, tolerance) &&\n      maths.floatIsZero(this.y, tolerance)\n    );\n  }\n}\n\n/**\n * Acceleration class\n */\nexport class Acceleration {\n  /** x velocity @type {number} */\n  x;\n  /** y velocity @type {number} */\n  y;\n  /** rotational velocity @type {number} */\n  rotation;\n\n  /**\n   *\n   * @param {number} velX\n   * @param {number} velY\n   * @param {number} velRot\n   */\n  constructor(velX, velY, velRot) {\n    this.x = velX;\n    this.y = velY;\n    this.rotation = velRot;\n  }\n}\n\n/**\n * Simple 2D position. Similar to point but including rotation.\n * @implements {Point}\n */\nexport class Position extends Point {\n  /** type {number} */\n  rotation;\n\n  /**\n   *\n   * @param {number} x\n   * @param {number} y\n   * @param {number} rotation\n   */\n  constructor(x, y, rotation) {\n    super(x, y);\n    this.y = y;\n    this.rotation = rotation;\n  }\n\n  /**\n   * Create a Position from a Point.\n   * @param {Point} point\n   * @returns {Position}\n   */\n  static fromPoint(point) {\n    return new Position(point.x, point.y, 0);\n  }\n\n  /**\n   * Create copy\n   * @param {Position} position\n   */\n  static copy(position) {\n    return new Position(position.x, position.y, position.rotation);\n  }\n\n  /** Get a new position representing this position relative to a new origin.\n   * @param {Position} origin\n   * @returns {Position}\n   */\n  getRelativeTo(origin) {\n    return new Position(\n      this.x - origin.x,\n      this.y - origin.y,\n      this.rotation - origin.rotation\n    );\n  }\n\n  /**\n   * Test that both x and y coordinates are within the length.\n   * @param {Position} targetPos\n   * @param {number} length\n   * @returns {boolean}\n   */\n  withinSquare(targetPos, length) {\n    return (\n      Math.abs(targetPos.x - this.x) < length &&\n      Math.abs(targetPos.y - this.y) < length\n    );\n  }\n}\n\n/**\n * @typedef {Object} RectangleBounds\n * @property {number} x;\n * @property {number} y;\n * @property {number} right;\n * @property {number} bottom;\n * @property {number} width;\n * @property {number} height;\n */\n\n/**\n * Simple rectangle.\n */\nexport class Rectangle {\n  /** @type {number} */\n  x;\n  /** @type {number} */\n  y;\n  /** @type {number} */\n  width;\n  /** @type {number} */\n  height;\n\n  /**\n   *\n   * @param {number} x\n   * @param {number} y\n   * @param {number} width\n   * @param {number} height\n   */\n  constructor(x, y, width, height) {\n    this.x = x;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n  }\n\n  /** Get the bottom right\n   * @returns {Point}\n   */\n  getBottomRight() {\n    return new Point(this.x + this.width, this.y + this.height);\n  }\n\n  /** Get the top left\n   * @returns {Point}\n   */\n  getTopLeft() {\n    return new Point(this.x, this.y);\n  }\n  /**\n   * Test if this overlaps another rectangle\n   * @param {Rectangle} otherRect\n   * @returns {boolean} true if overlapping.\n   */\n  overlaps(otherRect) {\n    const myBR = this.getBottomRight();\n    const otherRectBR = otherRect.getBottomRight();\n    const noOverlap =\n      otherRect.x > myBR.x ||\n      otherRect.y > myBR.y ||\n      otherRectBR.x < this.x ||\n      otherRectBR.y < this.y;\n    return !noOverlap;\n  }\n\n  /**\n   * Test if this rectangle contains a point\n   * @param {Point | Position} point\n   * @returns {boolean} - true if point contained\n   */\n  containsPoint(point) {\n    return (\n      point.x >= this.x &&\n      point.x <= this.x + this.width &&\n      point.y >= this.y &&\n      point.y <= this.y + this.height\n    );\n  }\n  /**\n   * Test if this rectangle contains a coordinate\n   * @param {number} x\n   * @param {number} y\n   * @returns {boolean} - true if point contained\n   */\n  containsCoordinate(x, y) {\n    return (\n      x >= this.x &&\n      x <= this.x + this.width &&\n      y >= this.y &&\n      y <= this.y + this.height\n    );\n  }\n  /**\n   * Test if this rectangle equals another.\n   * @param {Rectangle} otherRect\n   * @returns {boolean}\n   */\n  equals(other) {\n    return (\n      this.x === other.x &&\n      this.y === other.y &&\n      this.width === other.width &&\n      this.height === other.height\n    );\n  }\n}\n\n/** Min point */\nexport const MIN_POINT = new Point(Number.MIN_VALUE, Number.MIN_VALUE);\n/** Max point */\nexport const MAX_POINT = new Point(Number.MAX_VALUE, Number.MAX_VALUE);\n","/**\n * @file Maths utilities\n *\n * @module utils/maths\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * Common angles\n */\nexport const Radians = {\n  DEG_22_5: (1 / 8) * Math.PI,\n  DEG_45: (2 / 8) * Math.PI,\n  DEG_67_5: (3 / 8) * Math.PI,\n  DEG_90: (4 / 8) * Math.PI,\n  DEG_112_5: (5 / 8) * Math.PI,\n  DEG_135: (6 / 8) * Math.PI,\n  DEG_157_7: (7 / 8) * Math.PI,\n  DEG_180: Math.PI,\n};\n\n/**\n * Clip a value between min and max inclusive.\n * @param {number} value\n * @param {number} min\n * @param {number} max\n * @returns {number}\n */\nexport function clip(value, min, max) {\n  if (value < min) {\n    return min;\n  } else if (value > max) {\n    return max;\n  }\n  return value;\n}\n\n/** Enumeration of travel directions\n * @enum {number}\n */\nexport const CompassEightPoint = {\n  NONE: -1,\n  N: 0,\n  NE: 1,\n  E: 2,\n  SE: 3,\n  S: 4,\n  SW: 5,\n  W: 6,\n  NW: 7,\n};\n\n/**\n * Convert an angle to an eight point compass direction.\n * Converts the angle to a compass direction.\n * @param {number} angle - -PI/2 to +PI/2. This is the same range as values returned\n * from the standard Math trigonometric functions. Note that this expects the\n * angle to be based on cartesian coordinates, +y upwards. For angles calculated\n * using screen coordinates, +y downwards, you should negate the angle before\n * calling.\n * @param {number} angle - -PI/2 to +PI/2\n * @returns {number} compass point. From CompassEightPoint enum.\n */\nexport function angleToFourPointCompass(angle) {\n  const absAngle = Math.abs(angle);\n  if (absAngle <= Radians.DEG_45) {\n    return CompassEightPoint.E;\n  }\n  if (absAngle <= Radians.DEG_135) {\n    return Math.sign(angle) > 0 ? CompassEightPoint.N : CompassEightPoint.S;\n  }\n  return CompassEightPoint.W;\n}\n/**\n * Convert an angle to an eight point compass direction.\n * Converts the angle to a compass direction.\n * @param {number} angle - -PI/2 to +PI/2. This is the same range as values returned\n * from the standard Math trigonometric functions. Note that this expects the\n * angle to be based on cartesian coordinates, +y upwards. For angles calculated\n * using screen coordinates, +y downwards, you should negate the angle before\n * calling.\n * @param {number} angle - -PI/2 to +PI/2\n * @returns {number} compass point. From CompassEightPoint enum.\n */\nexport function angleToEightPointCompass(angle) {\n  const absAngle = Math.abs(angle);\n  if (absAngle <= Radians.DEG_22_5) {\n    return CompassEightPoint.E;\n  }\n  if (absAngle <= Radians.DEG_67_5) {\n    return Math.sign(angle) > 0 ? CompassEightPoint.NE : CompassEightPoint.SE;\n  }\n  if (absAngle <= Radians.DEG_112_5) {\n    return Math.sign(angle) > 0 ? CompassEightPoint.N : CompassEightPoint.S;\n  }\n  if (absAngle <= Radians.DEG_157_7) {\n    return Math.sign(angle) > 0 ? CompassEightPoint.NW : CompassEightPoint.SW;\n  }\n  return CompassEightPoint.W;\n}\n\n/**\n * Get random number between min and max, inclusive\n * @param {number} min - inclusive minimum\n * @param {number} max - exclusive maximum\n * @returns {number}\n */\nexport function getRandomInt(min, max) {\n  const minCeiled = Math.ceil(min);\n  const maxFloored = Math.floor(max);\n  return Math.floor(Math.random() * (maxFloored - minCeiled) + minCeiled);\n}\n\n/**\n * Get a random array entry.\n * @param {Array<*>} array\n * @returns {*}\n */\nexport function getRandomMember(array) {\n  const index = getRandomInt(0, array.length);\n  return array[index];\n}\n\n/**\n * Get random number between min and max, inclusive\n * @param {number} min - inclusive minimum\n * @param {number} max -inclusive maximum\n * @returns {number}\n */\nexport function getRandomIntInclusive(min, max) {\n  const minCeiled = Math.ceil(min);\n  const maxFloored = Math.floor(max);\n  return Math.floor(Math.random() * (maxFloored - minCeiled + 1) + minCeiled);\n}\n\n/**\n * Test if float equals another float.\n * @param {number} valueA\n * @param {number} valueB\n * @param {number} tolerance\n * @returns {boolean}\n */\nexport function floatsAreEqual(valueA, valueB, tolerance) {\n  return valueA - valueB < tolerance;\n}\n\n/**\n * Test if float is almost zero.\n * @param {number} value\n * @param {number} tolerance\n * @returns {boolean}\n */\nexport function floatIsZero(value, tolerance) {\n  return Math.abs(value) < tolerance;\n}\n\n/**\n * Safe version of parseInt which never returns NaN\n * @param {number} value\n * @param {number} [defValue = 0]\n * @param {number} [radix]\n * @returns {number} result of parseInt or defValue if NaN\n */\nexport function safeParseInt(value, defValue = 0, radix) {\n  const result = parseInt(value, radix);\n  return Number.isNaN(result) ? defValue : result;\n}\n\n/**\n * Safe version of parseIntFloat which never returns NaN\n * @param {number} value\n * @param {number} [defValue = 0]\n * @returns {number} result of parseFloat or defValue if NaN\n */\nexport function safeParseFloat(value, defValue = 0) {\n  const result = parseFloat(value);\n  return Number.isNaN(result) ? defValue : result;\n}\n","/**\n * @file World limitations\n *\n * @module game/world\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport SCREEN from './screen.js';\n\n/**\n * @type {TileMap}\n */\nlet worldTileMap;\n\n/**\n * @type {Map<string, Sprite>}\n */\nconst actors = new Map();\n\n/**\n * @type {Map<string, Sprite>}\n */\nconst artefacts = new Map();\n\n/**\n * Sprites that do not interact\n * @type {Map<string, Sprite>}\n */\nconst passiveSprites = new Map();\n\n/**\n * Sprites that grow or spawn. These are drawn first.\n * @type {Map<string, Sprite>}\n */\nconst organicActors = new Map();\n\n/**\n * Get the world dimensions. The dimensions are based on the worldTileMap size.\n * It defaults to the screen dimensions if no map has been set.\n * @returns {{number, number}} width and height\n */\nfunction getWorldDims() {\n  return worldTileMap\n    ? worldTileMap.getDimensions()\n    : SCREEN.getCanvasDimensions();\n}\n\n/**\n * Add a actor to the world.\n * @param {module:players/actors.Actor}\n */\nfunction addActor(target) {\n  if (target.isOrganic()) {\n    organicActors.set(target, target);\n  } else {\n    actors.set(target, target);\n  }\n  worldTileMap.moveTileOccupancyGridPoint(\n    target,\n    null,\n    worldTileMap.worldPointToGrid(target.position)\n  );\n}\n\n/**\n * Remove actor from the world.\n * @param {module:players/actors.Actor}\n */\nfunction removeActor(target) {\n  const gridPoint = worldTileMap.worldPointToGrid(target.position);\n  worldTileMap.deleteOccupancyOfGridPoint(target, gridPoint);\n  if (target.isOrganic()) {\n    organicActors.delete(target);\n  } else {\n    actors.delete(target);\n  }\n}\n\n/**\n * Add a artefact to the world.\n * @param {module:players/actors.Actor}\n */\nfunction addArtefact(target) {\n  artefacts.set(target, target);\n  worldTileMap.moveTileOccupancyGridPoint(\n    target,\n    null,\n    worldTileMap.worldPointToGrid(target.position)\n  );\n}\n/**\n * Remove artefact from the world.\n * @param {module:players/actors.Actor}\n */\nfunction removeArtefact(target) {\n  const gridPoint = worldTileMap.worldPointToGrid(target.position);\n  worldTileMap.deleteOccupancyOfGridPoint(target, gridPoint);\n  artefacts.delete(target);\n}\n\n/**\n * Add effect sprite\n * @param {module:utils/sprites/sprites.Sprite} sprite\n */\nfunction addPassiveSprite(sprite) {\n  passiveSprites.set(sprite, sprite);\n}\n\n/**\n * Add effect sprite\n * @param {module:utils/sprites/sprites.Sprite} sprite\n */\nfunction removePassiveSprite(sprite) {\n  passiveSprites.delete(sprite);\n}\n\n/**\n * Set the tile map for the world.\n * @param {TileMap}\n */\nfunction setTileMap(tileMap) {\n  worldTileMap = tileMap;\n}\n\n/**\n * Get the tile map for the world.\n * @returns {TileMap}\n */\nfunction getTileMap() {\n  return worldTileMap;\n}\n\n/**\n * Remove the tile map from the world.\n * @param {TileMap}\n */\nfunction removeTileMap() {\n  worldTileMap = null;\n}\n\n/**\n * Clear the map and all actors.\n */\nfunction clearAll() {\n  organicActors.forEach((actor) => removeActor(actor));\n  actors.forEach((actor) => removeActor(actor));\n  artefacts.forEach((actor) => removeArtefact(actor));\n  passiveSprites.forEach((sprite) => removePassiveSprite(sprite));\n  removeTileMap();\n}\n\n/**\n * Update the world. This calls the update methods of the tile map and all sprites/\n * @param {number} deltaSeconds\n */\nfunction update(deltaSeconds) {\n  worldTileMap?.update(deltaSeconds);\n  organicActors.forEach((actor) => {\n    const oldGridPoint = worldTileMap.worldPointToGrid(actor.position);\n    actor.visible = worldTileMap.canHeroSeeGridPoint(oldGridPoint);\n    actor.update(deltaSeconds);\n    const newGridPoint = worldTileMap.worldPointToGrid(actor.position);\n    worldTileMap.moveTileOccupancyGridPoint(actor, oldGridPoint, newGridPoint);\n  });\n  artefacts.forEach((artefact) => {\n    const oldGridPoint = worldTileMap.worldPointToGrid(artefact.position);\n    artefact.visible = worldTileMap.canHeroSeeGridPoint(oldGridPoint);\n    artefact.update(deltaSeconds);\n    const newGridPoint = worldTileMap.worldPointToGrid(artefact.position);\n    worldTileMap.moveTileOccupancyGridPoint(\n      artefact,\n      oldGridPoint,\n      newGridPoint\n    );\n  });\n  actors.forEach((actor) => {\n    const oldGridPoint = worldTileMap.worldPointToGrid(actor.position);\n    actor.visible = worldTileMap.canHeroSeeGridPoint(oldGridPoint);\n    actor.update(deltaSeconds);\n    const newGridPoint = worldTileMap.worldPointToGrid(actor.position);\n    worldTileMap.moveTileOccupancyGridPoint(actor, oldGridPoint, newGridPoint);\n  });\n\n  passiveSprites.forEach((sprite) => sprite.update(deltaSeconds));\n  worldTileMap?.updateHighlights(deltaSeconds);\n}\n\n/**\n * Resolve a ui click\n * @param {module:ui/interactions~MappedPositions} positions - click coordinates in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */\nfunction resolveClick(positions) {\n  const tile = worldTileMap?.getTileAtWorldPoint(positions.world);\n  if (tile) {\n    tile.actionClick(positions.world);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Resolve a context menu event\n * @param {module:ui/interactions~MappedPositions} positions - click coordinates in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */\nfunction resolveContextMenu(positions) {\n  const tile = worldTileMap.getTileAtWorldPoint(positions.world);\n  if (tile) {\n    tile.actionContextClick(positions.world);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Resolve a cancel event\n * @param {module:ui/interactions~MappedPositions} positions - click coordinates in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */\nfunction resolveCancel(positionsUnused) {\n  return false;\n}\n\n/**\n * Get the actors\n * @returns {Map<Actor, Actor>}\n */\nfunction getActors() {\n  return actors;\n}\n\n/**\n * Get the organic actors\n * @returns {Map<Actor, Actor>}\n */\nfunction getOrganicActors() {\n  return organicActors;\n}\n\n/**\n * Get the artefacts\n * @returns {Map<Actor, Actor>}\n */\nfunction getArtefacts() {\n  return actors;\n}\n\n/**\n * World object singleton.\n */\nconst WORLD = {\n  addActor: addActor,\n  addArtefact: addArtefact,\n  addPassiveSprite: addPassiveSprite,\n  clearAll: clearAll,\n  getActors: getActors,\n  getOrganicActors: getOrganicActors,\n  getArtefacts: getArtefacts,\n  getTileMap: getTileMap,\n  getWorldDims: getWorldDims,\n  removeTileMap: removeTileMap,\n  resolveCancel: resolveCancel,\n  resolveClick: resolveClick,\n  resolveContextMenu: resolveContextMenu,\n  removeActor: removeActor,\n  removeArtefact: removeArtefact,\n  removePassiveSprite: removePassiveSprite,\n  setTileMap: setTileMap,\n  update: update,\n};\n\nexport default WORLD;\n","/**\n * @file Heads-up display. Unlike the world, this never pans and so positions are\n * locked to the canvas coordinates.\n *\n * @module hud/hud\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { Actor } from '../players/actors.js';\nimport { ImageSpriteCanvasRenderer } from '../utils/sprites/spriteRenderers.js';\nimport SCREEN from '../utils/game/screen.js';\nimport { Sprite } from '../utils/sprites/sprite.js';\nimport { Position } from '../utils/geometry.js';\nimport { Rectangle } from '../utils/geometry.js';\n\n/**\n * @type {Map<string, Sprite>}\n */\nconst actors = new Map();\n\n/** @type {boolean} */\nlet visible = false;\n\n/**\n * Add a button to the hud. If two callbacks are provided, an AnimatedImage\n * is required with two frames.\n * @param {SpriteBitmap | AnimatedImage} image\n * @param {module:ui/interactions~UiClickCallback} callbackOn\n * @param {module:ui/interactions~UiClickCallback} callbackOff\n * @returns {module:players/actors.Actor}\n */\nfunction addButton(image, callbackOn, callbackOff) {\n  const actor = new Actor(\n    new Sprite({\n      renderer: new ImageSpriteCanvasRenderer(SCREEN.getContext2D(), image),\n    })\n  );\n\n  actors.set(actor, actor);\n  actor.setOnClick(() => {\n    if (!callbackOff) {\n      callbackOn();\n    } else if (image.getCurrentIndex() === 0) {\n      image.setCurrentIndex(1);\n      callbackOn();\n    } else {\n      image.setCurrentIndex(0);\n      callbackOff();\n    }\n  });\n  image.setCurrentIndex(0);\n  return actor;\n}\n\n/**\n * Add a momentary button to the hud. If two callbacks are provided, an AnimatedImage\n * is required with two frames.\n * @param {SpriteBitmap | AnimatedImage} image\n * @param {module:ui/interactions~UiClickCallback} callbackOn\n * @param {module:ui/interactions~UiClickCallback} callbackOff\n * @returns {module:players/actors.Actor}\n */\nfunction addMomentaryButton(image, callbackOn, callbackOff) {\n  const actor = new Actor(\n    new Sprite({\n      renderer: new ImageSpriteCanvasRenderer(SCREEN.getContext2D(), image),\n    })\n  );\n\n  actors.set(actor, actor);\n  actor.setOnPointerDown(() => {\n    image.setCurrentIndex(1);\n    callbackOn?.();\n  });\n  actor.setOnPointerUp(() => {\n    image.setCurrentIndex(0);\n    callbackOff?.();\n  });\n  return actor;\n}\n\n/**\n * Remove sprite from the hud.\n * @param {module:utils/sprites/sprite~Sprite}\n */\nfunction removeButton(target) {\n  actors.delete(target);\n}\n\n/**\n * Clear the HUD\n */\nfunction clear() {\n  actors.clear();\n}\n\n/**\n * Update the world. This calls the update methods of the tile map and all sprites/\n * @param {number} deltaSeconds\n */\nfunction update(deltaSeconds) {\n  if (!visible) {\n    return;\n  }\n  actors.forEach((sprite) => {\n    const uiPos = Position.copy(sprite.position);\n    sprite.position = SCREEN.glassPositionToWorld(sprite.position);\n    sprite.update(deltaSeconds);\n    sprite.position = uiPos;\n  });\n}\n\n/**\n * Check if the click is in a actor.\n * @param {module:ui/interactions~MappedPositions} positions - canvas and world positions\n * @param {module:players/actors.Actor} actor\n */\nfunction isHittingActor(positions, actor) {\n  const actorCanvasPos = SCREEN.glassPositionToWorld(actor.position);\n  let boundingBox = actor.sprite.getBoundingBox();\n  const canvasBox = new Rectangle(\n    actorCanvasPos.x - boundingBox.width / 2,\n    actorCanvasPos.y - boundingBox.height / 2,\n    boundingBox.width,\n    boundingBox.height\n  );\n\n  return canvasBox.containsCoordinate(positions.world.x, positions.world.y);\n}\n\n/**\n * Resolve a ui click\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */\nfunction resolveClick(positions) {\n  if (!visible) {\n    return false;\n  }\n  for (const [keyUnused, actor] of actors) {\n    if (isHittingActor(positions, actor)) {\n      actor.actionClick(actor, positions.canvas);\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Resolve a pointer down\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */\nfunction resolvePointerDown(positions) {\n  if (!visible) {\n    return false;\n  }\n  if (!visible) {\n    return false;\n  }\n  for (const [keyUnused, actor] of actors) {\n    if (isHittingActor(positions, actor)) {\n      actor.actionPointerDown(actor, positions.canvas);\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Resolve a ui pointer up event\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */\nfunction resolvePointerUp(positions) {\n  if (!visible) {\n    return false;\n  }\n  if (!visible) {\n    return false;\n  }\n  for (const [keyUnused, actor] of actors) {\n    if (isHittingActor(positions, actor)) {\n      actor.actionPointerUp(actor, positions.canvas);\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Resolve a context menu event.\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */\nfunction resolveContextMenu(positionsUnused) {\n  return false;\n}\n\n/**\n * Resolve a cancel event. For the HUD, a cancel event is treated the same as a pointer\n * up event.\n * @param {module:ui/interactions~MappedPositions} positions - click in canvas and world coordinates.\n * @returns {boolean} true if resolved.\n */\nfunction resolvePointerCancel(positions) {\n  return resolvePointerUp(positions);\n}\n\n/**\n * Set the visibility of the HUD.\n * @param {boolean} visibility - true to show.\n */\nfunction setVisible(visibility) {\n  visible = visibility;\n}\n\n/**\n * HUD object\n */\nconst HUD = {\n  addButton: addButton,\n  addMomentaryButton: addMomentaryButton,\n  clear: clear,\n  removeButton: removeButton,\n  update: update,\n  resolvePointerCancel: resolvePointerCancel,\n  resolveClick: resolveClick,\n  resolveContextMenu: resolveContextMenu,\n  resolvePointerDown: resolvePointerDown,\n  resolvePointerUp: resolvePointerUp,\n  setVisible: setVisible,\n};\n\nexport default HUD;\n","/**\n * @file Actor classes. Actors encapsulate a Sprite and represent moving objects\n * that can interact with the game.\n *\n * @module players/actors\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { AbstractInteraction, Toxify } from '../dnd/interact.js';\nimport { UiClickHandler } from '../utils/ui/interactions.js';\nimport {\n  ArtefactStoreManager,\n  ArtefactType,\n  artefactTypesEqual,\n} from './artefacts.js';\nimport * as dice from '../utils/dice.js';\nimport LOG from '../utils/logging.js';\n\n/**\n * @typedef {Map<string, *>} Traits\n */\n\n/**\n * @typedef {Object} TraitsHolder\n * @property {Traits} traits\n */\n\n/**\n * @typedef {number} ActorTypeValue\n */\n/** @enum{ActorTypeValue} */\nexport const ActorType = {\n  HERO: 0,\n  ENEMY: 1,\n  ARTEFACT: 2,\n  HIDDEN_ARTEFACT: 3,\n  TRADER: 4,\n  PROP: 5,\n  PORTAL: 6,\n};\n\n/**\n * @typedef {string} AttackModeValue\n */\n/** @enum{AttackModeValue} */\nexport const AttackMode = {\n  COMBAT: 'COMBAT',\n  COMBO: 'COMBO', // melee and poison.\n  POISON: 'POISON',\n  MAGIC: 'MAGIC',\n  RANGED: 'RANGED',\n};\n\n/**\n * @typedef {string} MoveTypeValue\n */\n/**\n * @enum {MoveTypeValue}\n */\nexport const MoveType = {\n  WANDER: 'WANDER',\n  HUNT: 'HUNT',\n  ORGANIC: 'ORGANIC',\n};\n\n/**\n * Convert a string to an ActorType\n * @param {string} str - actor type as string but excluding the ActorType.\n * E.g. HERO.\n * @returns {ActorType} null if invalid.\n */\nexport function strToActorType(str) {\n  const type = ActorType[str];\n  if (type === null || type === undefined) {\n    LOG.error(`Unrecognised actor type: ${str}`);\n  }\n  return type;\n}\n\n/**\n * Actor class. An actor is a sprite that exists in the world and can interact\n * with other actors.\n * @implements {TraitsHolder}\n */\nexport class Actor extends UiClickHandler {\n  /** @type {module:dnd/almanacs/almanacs~AlmanacEntry} */\n  almanacEntry;\n  /** @type {boolean} */\n  #frozen;\n  /** @type {module:utils/sprites/sprite~Sprite} */\n  sprite;\n  /** @type {Traits} */\n  traits;\n  /** @type {module:dnd/interact.AbstractInteraction} */\n  interaction;\n  /** @type {module:dnd/interact.Toxify} */\n  toxify;\n  /** @type {boolean} */\n  alive;\n  /** Flag used for actors that have a hidden artefact to be discovered. @type {boolean} */\n  discovered;\n  /** True if actor is disengaging from a fight. @type {boolean} */\n  disengaging;\n  /** @type {string} */\n  description;\n  /** @type {string} */\n  iconImageName;\n  /** @type {ArtefactStoreManager} */\n  storeManager;\n  /** @type {ActorType} */\n  type;\n  /** @type {number} */\n  adventureStartTime;\n\n  /**\n   * Create the actor.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} [type = ActorType.ENEMY] type of actor. See @link {ActorType}\n   */\n  constructor(sprite, type = ActorType.ENEMY) {\n    super();\n    this.interaction = new AbstractInteraction();\n    this.sprite = sprite;\n    this.sprite.obstacle = true;\n    this.#frozen = false;\n    this.alive = true;\n    this.discovered = false;\n    this.disengaging = false;\n    this.type = type;\n    this.storeManager = new ArtefactStoreManager(\n      type === ActorType.TRADER || type === ActorType.HIDDEN_ARTEFACT,\n      () => this.#updateTraitsFromStore()\n    );\n    if (type === ActorType.HERO) {\n      this.adventureStartTime = new Date().getTime();\n    }\n  }\n\n  /**\n   * Refresh DnD properties.\n   */\n  #updateTraitsFromStore() {\n    const items = this.storeManager.getAllEquippedArtefacts();\n    const weapons = items.filter(\n      (artefact) =>\n        artefactTypesEqual(artefact.artefactType, ArtefactType.WEAPON) ||\n        artefactTypesEqual(\n          artefact.artefactType,\n          ArtefactType.TWO_HANDED_WEAPON\n        )\n    );\n    const armour = items.filter(\n      (artefact) =>\n        artefactTypesEqual(artefact.artefactType, ArtefactType.ARMOUR) ||\n        artefactTypesEqual(artefact.artefactType, ArtefactType.HEAD_GEAR)\n    );\n    const shields = items.filter((artefact) =>\n      artefactTypesEqual(artefact.artefactType, ArtefactType.SHIELD)\n    );\n    const magic = items.filter(\n      (artefact) =>\n        artefactTypesEqual(artefact.artefactType, ArtefactType.RING) ||\n        artefactTypesEqual(artefact.artefactType, ArtefactType.BELT) ||\n        artefactTypesEqual(artefact.artefactType, ArtefactType.HEAD_GEAR)\n    );\n    this.traits.utiliseAdditionalTraits({\n      weapons: weapons.map((artefact) => artefact.traits),\n      armour: armour.map((artefact) => artefact.traits),\n      shields: shields.map((artefact) => artefact.traits),\n      magic: magic.map((artefact) => artefact.traits),\n    });\n  }\n\n  /**\n   * Freeze any movement.\n   */\n  freezeMovement() {\n    this.#frozen = true;\n  }\n  /**\n   * Get max tiles per move\n   */\n  getMaxTilesPerMove() {\n    return this.#frozen ? 0 : this.traits.getMaxTilesPerMove();\n  }\n  /**\n   * Test if this actor is the hero.\n   * @returns {boolean}\n   */\n  isHero() {\n    return this.type === ActorType.HERO;\n  }\n\n  /**\n   * Test if this actor is an enemy.\n   * @returns {boolean}\n   */\n  isEnemy() {\n    return this.type === ActorType.ENEMY;\n  }\n\n  /**\n   * Test if this actor is a trader.\n   * @returns {boolean}\n   */\n  isTrader() {\n    return this.type === ActorType.TRADER;\n  }\n\n  /**\n   * Test if this actor is a hidden artefact.\n   * @returns {boolean}\n   */\n  isHiddenArtefact() {\n    return this.type === ActorType.HIDDEN_ARTEFACT;\n  }\n\n  /** Set the underlying sprite visibility.\n   * @param {boolean}\n   */\n  set visible(value) {\n    this.sprite.visible = value;\n  }\n\n  /** Get the underlying sprite visibility.\n   * @returns {boolean}\n   */\n  get visible() {\n    return this.sprite.visible;\n  }\n  /**\n   * Get obstacle property. This comes from the underlying sprite.\n   * @param {boolean} value\n   */\n  get obstacle() {\n    return this.sprite.obstacle;\n  }\n\n  /**\n   * Set as obstacle. This sets the underlying sprite's property.\n   * @param {boolean} value\n   */\n  set obstacle(value) {\n    this.sprite.obstacle = value;\n  }\n\n  /**\n   * Get the actor's position.\n   * @returns {module:utils/geometry~Position}\n   */\n  get position() {\n    return this.sprite.position;\n  }\n\n  /**\n   * Set the actor's position.\n   * @param {module:utils/geometry~Position} value\n   */\n  set position(value) {\n    this.sprite.position = value;\n  }\n\n  /**\n   * Get the current motion.\n   * @returns {Velocity}\n   */\n\n  get velocity() {\n    return this.sprite.velocity;\n  }\n\n  /**\n   * Set the current Velocity. Invalid values become 0.\n   * @param {Velocity} nextVelocity\n   */\n  set velocity(nextVelocity) {\n    this.sprite.velocity = nextVelocity;\n  }\n\n  /**\n   * Get the sprite's image name.\n   * @returns {string} null if none.\n   */\n  getImageFilename() {\n    return this.sprite.getImageFilename();\n  }\n\n  /**\n   * Is this a wandering actor.\n   * @returns {boolean}\n   */\n  isWandering() {\n    return this.traits?.get('MOVE') === MoveType.WANDER;\n  }\n\n  /**\n   * Is this an organic actor.\n   * @returns {boolean}\n   */\n  isOrganic() {\n    return this.traits?.get('MOVE') === MoveType.ORGANIC;\n  }\n\n  /**\n   * Is this a prop.\n   * @returns {boolean}\n   */\n  isProp() {\n    return this?.type === ActorType.PROP;\n  }\n\n  /**\n   * Is this a portal\n   * @returns {boolean}\n   */\n  isPortal() {\n    return this?.type === ActorType.PORTAL;\n  }\n\n  /**\n   * Get the move type\n   * @returns {MoveTypeValue}\n   */\n  get moveType() {\n    return this?.traits.get('MOVE');\n  }\n\n  /**\n   * Get the attack mode\n   * @returns {AttackModeValue} defaults to combat\n   */\n  get attackMode() {\n    return this?.traits.get('ATTACK', AttackMode.COMBAT);\n  }\n\n  /**\n   * Test if the actor will interact.\n   * @returns {boolean}\n   */\n  willInteract() {\n    if (!this.interaction) {\n      return false;\n    }\n    if (this.isWandering()) {\n      return dice.rollDice(6) > 3;\n    }\n    return true;\n  }\n\n  /**\n   * Is the actor passable?\n   * @param {Actor} otherActor\n   * @returns {boolean}\n   */\n  isPassableByActor(otherActor) {\n    if (otherActor.isHero() && (this.isHiddenArtefact() || this.isPortal())) {\n      return true;\n    } else {\n      return (!this.alive && !this.isProp()) || !this.obstacle;\n    }\n  }\n\n  /**\n   * Can it share a tile location with another actor?\n   * @param {Actor} otherActor\n   * @returns {boolean}\n   */\n  canShareLocationWithActor(otherActor) {\n    if (this.isPortal()) {\n      return otherActor.isHero();\n    } else if (this.isOrganic()) {\n      return !otherActor.isOrganic() && !otherActor.isTrader(); // don't kill off traders.\n    } else if (this.isHiddenArtefact()) {\n      return otherActor.isHero();\n    } else if (!this.alive && otherActor.isHero()) {\n      return true;\n    } else {\n      return !this.obstacle;\n    }\n  }\n\n  /**\n   * Call update on the underlying sprite\n   * @param {number} deltaSeconds\n   */\n  update(deltaSeconds) {\n    this.sprite.update(deltaSeconds);\n  }\n\n  /**\n   * Handle the click but change the point to the sprite's position\n   */\n  actionClick(pointUnused) {\n    super.actionClick(this.sprite.position);\n  }\n  /**\n   * Handle the click but change the point to the sprite's position\n   */\n  actionContextClick(pointUnused) {\n    super.actionContextClick(this.sprite.position);\n  }\n\n  /**\n   * Handle the pointer up event but change the point to the sprite's position\n   */\n  actionPointerUp(pointUnused) {\n    super.actionPointerUp(this.sprite.position);\n  }\n  /**\n   * Handle the pointer down event but change the point to the sprite's position\n   */\n  actionPointerDown(pointUnused) {\n    super.actionPointerDown(this.sprite.position);\n  }\n\n  /**\n   * Convert to JSON.\n   * Note this only stores the actor.\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */\n  toJSON() {\n    const storageDetails = this.storeManager.getAllStorageDetails();\n    const inventory = [];\n    for (const detail of storageDetails) {\n      inventory.push({\n        storeTypeId: detail.store.storeTypeId,\n        artefact: detail.artefact,\n      });\n    }\n    return {\n      reviver: 'Actor',\n      data: {\n        adventureStartTime: this.adventureStartTime,\n        alive: this.alive,\n        discovered: this.discovered,\n        almanacEntry: this.almanacEntry,\n        traits: this.traits,\n        inventory: inventory,\n        toxin: this?.toxify.getToxin(),\n      },\n    };\n  }\n\n  /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   * @param {function(module:dnd/almanacs~AlmanacEntry,module:dnd/traits.Traits)} builder\n   * @returns {Actor}\n   */\n  static revive(data, builder) {\n    data.almanacEntry.equipmentIds = []; // remove so we don't reequip\n    const actor = builder(data.almanacEntry, data.traits);\n    actor.adventureStartTime = data.adventureStartTime;\n    actor.alive = data.alive;\n    actor.discovered = data.discovered;\n    actor.toxify = new Toxify(data.toxin);\n    for (const item of data.inventory) {\n      const store = actor.storeManager.getStoreByTypeId(item.storeTypeId);\n      if (!store) {\n        LOG.error(\n          `Unable to find store matching ${item.storeTypeId}. Game restore abandoned.`\n        );\n        return;\n      }\n      store.add(item.artefact);\n    }\n    return actor;\n  }\n}\n","/**\n * @file Handle fights and other interactions.\n *\n * @module dnd/interact\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../utils/logging.js';\nimport {\n  addFadingAnimatedImage,\n  addFadingImage,\n  displayRisingText,\n} from '../utils/effects/transient.js';\nimport { Velocity } from '../utils/geometry.js';\nimport IMAGE_MANAGER from '../utils/sprites/imageManager.js';\nimport { PathFollower, moveActorToPosition } from '../utils/sprites/movers.js';\nimport { Point } from '../utils/geometry.js';\nimport UI from '../utils/dom/ui.js';\nimport SOUND_MANAGER from '../utils/soundManager.js';\nimport * as actorDialogs from '../dialogs/actorDialogs.js';\nimport { i18n } from '../utils/messageManager.js';\nimport * as dndAction from './dndAction.js';\nimport { ActorType, AttackMode } from '../players/actors.js';\nimport {\n  ArtefactType,\n  StoreType,\n  artefactTypesEqual,\n} from '../players/artefacts.js';\nimport WORLD from '../utils/game/world.js';\nimport { Colours } from '../constants/canvasStyles.js';\nimport { Toxin } from './toxins.js';\nimport * as magic from './magic.js';\nimport * as traps from './trapCharacteristics.js';\nimport * as trapDialogs from '../dialogs/trapDialogs.js';\nimport {\n  buildArtefact,\n  buildArtefactFromId,\n} from './almanacs/artefactBuilder.js';\nimport * as maths from '../utils/maths.js';\nimport { showMoneyPortalDialog } from '../dialogs/moneyPortalDialog.js';\nimport { ALMANAC_LIBRARY } from './almanacs/almanacs.js';\nimport { pause } from '../utils/timers.js';\nimport { createElement } from '../utils/dom/components.js';\n\n/**\n * Apply poison damage to defender\n * @param {module:players/artefacts.Artefact | module:players/artefacts.Actor } poison\n * @param {module:players/actors.Actor} victim\n * @param {number} damage\n * @returns {number} resulting HP of defender\n */\nfunction applyPoisonDamage(poison, victim, damage) {\n  SOUND_MANAGER.playEffect('POISONED');\n  if (damage > 0) {\n    LOG.info('Poisoned');\n    addFadingImage(IMAGE_MANAGER.getSpriteBitmap('skull.png'), {\n      delaySecs: 0,\n      lifetimeSecs: 1,\n      position: victim.position,\n      velocity: new Velocity(0, 0, 0),\n    });\n\n    return applyDamage(poison, victim, damage);\n  } else {\n    addFadingImage(IMAGE_MANAGER.getSpriteBitmap('miss.png'), {\n      delaySecs: 0,\n      lifetimeSecs: 1,\n      position: victim.position,\n      velocity: new Velocity(0, 0, 0),\n    });\n    LOG.info(`Poison resisted.`);\n  }\n}\n/**\n * Apply damage to defender\n * @param {Artefact | Actor} attacker\n * @param {module:players/actors.Actor} defender\n * @param {number} damage\n * @returns {number} resulting HP of defender\n */\nfunction applyDamage(attacker, defender, damage) {\n  if (\n    !damage ||\n    !defender.alive ||\n    defender.isProp() ||\n    defender.isHiddenArtefact()\n  ) {\n    return 0;\n  }\n  const defenderName = defender.traits.get('NAME');\n  LOG.info(`Damage ${damage} on ${defenderName}`);\n  let defenderHP = defender.traits.get('HP', 0);\n  defenderHP = Math.max(0, defenderHP - damage);\n  defender.traits.set('HP', defenderHP);\n  if (defenderHP === 0) {\n    SOUND_MANAGER.playEffect(defender.traits.get('SOUND', 'DIE'));\n    LOG.info(`Killed ${defenderName}`);\n    defender.interaction = new InteractWithCorpse(defender);\n    defender.alive = false;\n    if (attacker?.isHero?.()) {\n      const change = attacker.traits.adjustForDefeatOfActor(defender.traits);\n      let text;\n      if (change.level.now > change.level.was) {\n        text = i18n`LEVEL UP ${change.level.now}`;\n      } else if (change.exp.now > change.exp.was) {\n        text = `+${change.exp.now - change.exp.was} EXP`;\n      }\n      if (text) {\n        LOG.info(text);\n        displayRisingText(\n          text,\n          attacker.position,\n          Colours.HP_TRANSIENT_TEXT_HERO\n        );\n      }\n    }\n  } else {\n    const textColor = defender.isHero()\n      ? Colours.HP_TRANSIENT_TEXT_HERO\n      : Colours.HP_TRANSIENT_TEXT_ENEMY;\n    displayRisingText(`-${damage} HP`, defender.position, textColor);\n  }\n  return defenderHP;\n}\n/** Dummy interaction that does nothing\n */\nexport class AbstractInteraction {\n  /** Actor owning the interaction @type {module:players/actors.Actor} */\n  owner;\n\n  /**\n   *\n   * @param {Actor|Artefact} owner\n   */\n  constructor(owner) {\n    this.owner = owner;\n  }\n  /**\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise} fulfils to value depending on interaction. Can be undefined\n   */\n  enact(reactorUnused) {\n    return Promise.resolve();\n  }\n\n  /**\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise} fulfils to value depending on interaction. Can be undefined\n   */\n  react(enactorUnused) {\n    return Promise.resolve();\n  }\n\n  /**\n   * Test to see if the interaction can react.\n   * This should be overridden.\n   * @returns {boolean}\n   */\n  canReact() {\n    return false;\n  }\n\n  /**\n   * Test to see if the interaction can enact.\n   * This should be overridden.\n   * @returns {boolean}\n   */\n  canEnact() {\n    return false;\n  }\n\n  /**\n   * Test to see if actor can disengage from an interaction. Actors can\n   * always move away from an interaction. Disengaging is different in that\n   * following actions can be affected. The interaction will not do anything\n   * about the disengaging. This flag merely indicates whether callers should\n   * respect an attempt to disengage.\n   * @param {module:players/actors.Actor} escaper\n   * @returns {boolean} true if can run\n   */\n  respectDisengage(escaperUnused) {\n    return false;\n  }\n}\n\n/**\n * Class to handle fights.\n * @implements {ActorInteraction}\n */\nexport class Fight extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */\n  constructor(owner) {\n    super(owner);\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return true;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return true;\n  }\n  /**\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */\n  enact(reactor) {\n    return this.#resolveAttackerDefender(this.owner, reactor);\n  }\n\n  /**\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */\n  react(enactor) {\n    return this.#resolveAttackerDefender(enactor, this.owner);\n  }\n\n  /**\n   * Test to see if actor can run away from an interaction. If the actor cannot,\n   * a failed message appears. The actual move is not undertaken\n   * @param {module:players/actors.Actor} escaper\n   * @returns {boolean} true if can run\n   */\n  respectDisengage(escaperUnused) {\n    return true;\n  }\n\n  /**\n   * Display an attack\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise}\n   */\n  #displayAttack(attacker, defender) {\n    const startPoint = Point.copy(attacker.position);\n    const attackPoint = new Point(\n      attacker.position.x + 0.2 * (defender.position.x - attacker.position.x),\n      attacker.position.y + 0.2 * (defender.position.y - attacker.position.y)\n    );\n    const pathModifier = new PathFollower({\n      path: [attackPoint, startPoint],\n      speed: 100,\n    });\n    return pathModifier.applyAsTransientToSprite(attacker.sprite);\n  }\n  /**\n   * Undertake attack. Note that the defender is not removed if its hit points\n   * hit zero.\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise} fulfils to the defender's HP.\n   */\n  #undertakeAllAttacks(attacker, defender) {\n    if (attacker.isHero()) {\n      return this.#undertakeAllMeleeAttacks(attacker, defender);\n    }\n    switch (attacker.attackMode) {\n      case AttackMode.COMBO:\n        return this.#undertakeComboAttacks(attacker, defender);\n      case AttackMode.POISON:\n        return new Poison(attacker).enact(defender);\n      case AttackMode.MAGIC:\n      case AttackMode.RANGED:\n        return new CastSpell(attacker).react(attacker);\n      case AttackMode.COMBAT:\n      default:\n        return this.#undertakeCombatAttack(attacker, defender);\n    }\n  }\n\n  /**\n   * Undertake comb0 attack\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise} fulfils to the defender's HP.\n   */\n  #undertakeComboAttacks(attacker, defender) {\n    const currentHp = defender.traits.getInt('HP');\n    return this.#undertakeAllMeleeAttacks(attacker, defender).then((hp) => {\n      if (hp <= 0) {\n        return hp;\n      }\n      if (attacker.traits.has('DMG_POISON')) {\n        // in combo, only poison if first attack hit.\n        if (hp < currentHp) {\n          return new Poison(attacker).enact(defender);\n        } else {\n          return Promise.resolve(hp);\n        }\n      } else {\n        return this.#undertakeAllMeleeAttacks(attacker, defender); // double attack\n      }\n    });\n  }\n  /**\n   * Undertake combat attack\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise} fulfils to the defender's HP.\n   */\n  #undertakeCombatAttack(attacker, defender) {\n    if (!attacker.isHero()) {\n      // Monsters use a spell or cantrip if available.\n      const storeManager = attacker.storeManager;\n      let spell = storeManager.getStore(StoreType.PREPARED_SPELLS).getFirst();\n      if (!spell) {\n        spell = storeManager.getStore(StoreType.CANTRIPS).getFirst();\n      }\n      if (spell) {\n        return spell.interaction.react(attacker);\n      }\n    }\n    return this.#undertakeAllMeleeAttacks(attacker, defender);\n  }\n  /**\n   * Undertake attack. Note that the defender is not removed if its hit points\n   * hit zero.\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise} fulfils to the defender's HP.\n   */\n  #undertakeAllMeleeAttacks(attacker, defender) {\n    let totalDamage = 0;\n    let successfulAttacks = 0;\n    attacker.traits.getAttacks().forEach((attack) => {\n      const damage = dndAction.getMeleeDamage(attack, defender.traits);\n      if (damage > 0) {\n        successfulAttacks++;\n        totalDamage += damage;\n      }\n    });\n    return new Promise((resolve) => {\n      if (totalDamage <= 0) {\n        SOUND_MANAGER.playEffect('MISS');\n        addFadingImage(IMAGE_MANAGER.getSpriteBitmap('miss.png'), {\n          delaySecs: 0,\n          lifetimeSecs: 1,\n          position: defender.position,\n          velocity: new Velocity(0, 0, 0),\n        });\n        resolve(defender.traits.getInt('HP', 0));\n        return;\n      }\n      let hitSound = successfulAttacks > 1 ? 'DOUBLE PUNCH' : 'PUNCH';\n      let hitImage =\n        successfulAttacks > 1 ? 'blood-splat-twice.png' : 'blood-splat.png';\n\n      SOUND_MANAGER.playEffect(hitSound);\n      addFadingImage(IMAGE_MANAGER.getSpriteBitmap(hitImage), {\n        delaySecs: 0,\n        lifetimeSecs: 1,\n        position: defender.position,\n        velocity: new Velocity(0, 0, 0),\n      });\n      const defenderHP = applyDamage(attacker, defender, totalDamage);\n      resolve(defenderHP);\n    });\n  }\n\n  /**\n   * Resolve a fight.\n   * @param {module:players/actors.Actor} attacker\n   * @param {module:players/actors.Actor} defender\n   * @returns {Promise}\n   */\n  #resolveAttackerDefender(attacker, defender) {\n    LOG.info(\n      `${attacker.traits?.get('NAME')} attacks ${defender.traits.get('NAME')}`\n    );\n    return this.#displayAttack(attacker, defender).then(() =>\n      this.#undertakeAllAttacks(attacker, defender)\n    );\n  }\n}\n\n/**\n * Class to handle searching a corpse.\n * @implements {ActorInteraction}\n */\nexport class InteractWithCorpse extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */\n  constructor(owner) {\n    super(owner);\n  }\n\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return false;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return true;\n  }\n  /**\n   * Respond to a search\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */\n  async react(enactor) {\n    return actorDialogs.showPillageDialog(enactor, this.owner);\n  }\n}\n\n/**\n * Class to handle trading.\n */\nexport class Trade extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */\n  constructor(owner) {\n    super(owner);\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return false;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return true;\n  }\n  /**\n   * Trades are passive. Only the hero can initiate a trade.\n   * Note there is possibility for traders to block the exit, so\n   * the option to barge past is provided.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */\n  react(enactor) {\n    if (this.owner.traits.get('NO_TRADE')) {\n      return UI.showOkDialog([\n        i18n`MESSAGE TRADER WILL NOT TRADE`,\n        i18n`MESSAGE TRADERS PROTECTED`,\n      ]);\n    }\n    return UI.showChoiceDialog(\n      i18n`DIALOG TITLE CHOICES`,\n      i18n`MESSAGE TRADE STEAL OR BARGE`,\n      [i18n`BUTTON TRADE`, i18n`BUTTON STEAL`, i18n`BUTTON BARGE`]\n    ).then((choice) => {\n      if (choice === 0) {\n        return actorDialogs.showTradeDialog(enactor, this.owner);\n      } else if (choice === 1) {\n        return this.#attemptTheftBy(enactor);\n      } else {\n        return this.#swapPositions(enactor);\n      }\n    });\n  }\n\n  /**\n   * Attempt by robber steal.\n   * @param {module:players/actors.Actor} robber\n   * @returns {Promise} fulfils to undefined when complete.\n   */\n  #attemptTheftBy(robber) {\n    if (dndAction.canSteal(robber.traits, this.owner.traits)) {\n      const maxGold = this.owner.traits.getInt('MAX_THEFT', 1);\n      const takenGold = maths.getRandomIntInclusive(1, maxGold);\n      robber.storeManager.addToPurse(takenGold);\n      return UI.showOkDialog(i18n`MESSAGE STOLE GOLD ${takenGold}`);\n    } else {\n      this.owner.traits.set('_NO_TRADE', true);\n      return UI.showOkDialog(i18n`MESSAGE TRADER ATTACKS BACK`).then(() => {\n        const fight = new Fight(this.owner);\n        return fight.enact(robber);\n      });\n    }\n  }\n  /**\n   * Swap position with another actor\n   * @param {module:players/actors.Actor} them\n   * @returns {Promise} fulfils to undefined when complete.\n   */\n  #swapPositions(them) {\n    const myPosition = Point.copy(this.owner.position);\n    const theirPosition = Point.copy(them.position);\n    return Promise.all([\n      moveActorToPosition(them, myPosition),\n      moveActorToPosition(this.owner, theirPosition),\n    ]);\n  }\n}\n\n/**\n * Class to handle finding artefact\n */\nexport class FindArtefact extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} actor - parent actor.\n   */\n  constructor(actor) {\n    super(actor);\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return false;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return true;\n  }\n  /**\n   * Finding an artefact is a passive action and can only be initiated by another\n   * actor.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */\n  async react(enactor) {\n    this.owner.discovered = true;\n    this.owner.alive = false;\n    const storageDetails = this.owner.storeManager.getFirstStorageDetails();\n\n    if (storageDetails) {\n      let artefact = storageDetails.artefact;\n      if (artefact.isTrap()) {\n        const trapResult = await artefact.interaction.react(enactor);\n        if (trapResult.outcome === TrapOutcome.LEAVE) {\n          this.owner.alive = true; // reset trap\n          return Promise.resolve();\n        }\n        this.owner.storeManager.discardStashed(artefact, true); // remove trap\n        if (!trapResult.artefact) {\n          return Promise.resolve(); // nothing to find\n        }\n\n        artefact = trapResult.artefact;\n        this.owner.storeManager.stash(artefact, { direct: true }); // trap now just found artefact.\n      } else if (\n        artefact.isMagic() &&\n        !magic.canActorLearnMagic(enactor.traits, artefact.traits)\n      ) {\n        return UI.showOkDialog(i18n`MESSAGE CANNOT UNDERSTAND MAGIC`);\n      }\n      return actorDialogs\n        .showArtefactDialog({\n          preamble: this.#createDiscoveryMessage(artefact),\n          currentOwner: this.owner,\n          prospectiveOwner: enactor,\n          storeType: storageDetails.store.storeType,\n          artefact: artefact,\n          actionType: actorDialogs.ArtefactActionType.FIND,\n          hideTraits: artefact.isMagic(),\n        })\n        .then(() => {\n          if (this.owner.storeManager.getFirstStorageDetails()) {\n            this.owner.alive = true; // still something to find.\n          }\n        });\n    } else {\n      return UI.showOkDialog(i18n`MESSAGE NOTHING MORE TO DISCOVER`);\n    }\n  }\n\n  /**\n   * Create a message describing the action of discovery rather\n   * than the artefact itself.\n   * @param {*} foundArtefact\n   * @returns {string}\n   */\n  #createDiscoveryMessage(foundArtefact) {\n    if (this.owner.type === ActorType.HIDDEN_ARTEFACT) {\n      return i18n`MESSAGE FOUND HIDDEN ARTEFACT`;\n    } else if (foundArtefact.isMagic()) {\n      // must be a prop and only engraved pillars currently supported.\n      return i18n`MESSAGE FOUND ENGRAVING`;\n    }\n    return i18n`MESSAGE FOUND GENERIC`;\n  }\n}\n\n/**\n * Class to handle poisoning\n */\nexport class Poison extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */\n  constructor(owner) {\n    super(owner);\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return true;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return false;\n  }\n  /**\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */\n  enact(reactor) {\n    if (this.#isImmune(reactor)) {\n      return Promise.resolve();\n    }\n    const damage = dndAction.getPoisonDamage(this.owner.traits, reactor.traits);\n    applyPoisonDamage(this.owner, reactor, damage);\n    if (damage) {\n      reactor.toxify?.addToxicEffect(this.owner.traits);\n    }\n    reactor.traits.addTransientFxTraits(this.owner.traits);\n    return Promise.resolve();\n  }\n\n  /** Check if the actor is immune.\n   * @return {boolean} true if immune.\n   */\n  #isImmune(reactor) {\n    if (this.owner.isOrganic?.() && reactor.traits.transientProperties?.hover) {\n      LOG.info(\n        `${reactor.traits.get('NAME')} hovering so immune from organic attack.`\n      );\n      return true;\n    }\n    return false;\n  }\n}\n\n/**\n * Class to handle ongoing toxic effects.\n */\nexport class Toxify extends AbstractInteraction {\n  /** @type {Toxin} */\n  #toxin;\n\n  /**\n   * Construct the interaction.\n   * @param {module:dnd/toxins.Toxin} toxin - if not supplies an inactive toxin\n   * is added.\n   */\n  constructor(toxin) {\n    super(null); // no owner\n    this.#toxin = toxin ?? new Toxin();\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return true;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return false;\n  }\n  /**\n   * Each call applies the toxic effect so it should only be called once per turn.\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */\n  enact(reactor) {\n    if (!this.#toxin.isActive) {\n      return;\n    }\n    const damage = -this.#toxin.getChangeInHpThisTurn();\n    applyPoisonDamage(null, reactor, damage);\n    return Promise.resolve();\n  }\n\n  /**\n   * Add toxic effects.\n   * @param {module:dnd/traits.Traits} toxinTraits\n   */\n  addToxicEffect(toxinTraits) {\n    const hpPerTurn = -toxinTraits.getFloat('DMG_PER_TURN', 0);\n    if (hpPerTurn) {\n      LOG.debug(`Add toxic effect of ${hpPerTurn} HP/turn`);\n      this.#toxin.addToxicEffect(hpPerTurn);\n    }\n  }\n\n  /**\n   * Cure the toxic effects.\n   */\n  cure() {\n    this.#toxin.cure();\n  }\n\n  /**\n   * Test if toxins active\n   */\n  get isActive() {\n    return this.#toxin.isActive;\n  }\n\n  /**\n   * Get the underlying toxin\n   * @returns {Toxin}\n   */\n  getToxin() {\n    return this.#toxin;\n  }\n}\n\n/**\n * Class to handle casting a spell. This is also used for ranged attacks.\n * @implements {ActorInteraction}\n */\nexport class CastSpell extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/artefacts.Artefact} owner - parent spell.\n   */\n  constructor(owner) {\n    super(owner);\n  }\n\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return false;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return true;\n  }\n\n  /**\n   * Respond to a spell cast. Note that the magic system does not require an\n   * attack role unless the attack mode is set to ATTACK\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */\n  async react(enactor) {\n    let retValue;\n    SOUND_MANAGER.playEffect('SPELL_CHANT');\n\n    switch (this.owner.traits.get('MODE')) {\n      case 'BLESS':\n        retValue = this.#enactBless(enactor);\n        break;\n      case 'CONJURE MEAL':\n        retValue = this.#enactConjureMeal(enactor);\n        break;\n      case 'DETECT POISON':\n        retValue = this.#enactDetectPoison(enactor);\n        break;\n      case 'FIND TRAPS':\n        retValue = this.#enactFindTraps(enactor);\n        break;\n      case 'HOVER':\n        retValue = this.#enactHover(enactor);\n        break;\n      case 'VAMPIRIC MELEE':\n        retValue = this.#enactVampiricTouch(enactor);\n        break;\n      default:\n        retValue = this.#enactMagic(enactor);\n        break;\n    }\n    if (artefactTypesEqual(this.owner.artefactType, ArtefactType.SPELL)) {\n      magic.useCastingPower(enactor.traits, this.owner.traits);\n    }\n    return retValue;\n  }\n\n  /**\n   * Cast a standard magic spell\n   * @param {module:players/actors.Actor} caster\n   * @returns {Promise<number>} total damage inflicted.\n   */\n  #enactMagic(enactor) {\n    const tileMap = WORLD.getTileMap();\n    const gridPoint = tileMap.worldPointToGrid(enactor.position);\n    const range = this.owner.traits.getValueInFeetInTiles('RANGE', 1);\n    const maxTargets = this.owner.traits.getInt('MAX_TARGETS', 999);\n    let totalDamage = 0;\n    let hitTargets = 0;\n    let validTargets = 0;\n    const radial = this.owner.traits.get('DIRECTION') === 'RADIAL';\n    const indiscriminate = this.owner.traits.get('INDISCRIMINATE');\n    const affectedTiles = radial\n      ? tileMap.getRadiatingVisibleTiles(range)\n      : tileMap.getRadiatingCross(gridPoint, range);\n    for (const tile of affectedTiles) {\n      if (hitTargets >= maxTargets) {\n        break;\n      }\n\n      let descendingHp = [...tile.getOccupants().values()].sort(\n        (a, b) => b.traits.getInt('HP') - a.traits.getInt('HP')\n      );\n      for (const occupant of descendingHp) {\n        if (this.#IsValidTarget(enactor, occupant, indiscriminate)) {\n          validTargets++;\n          const damage = dndAction.getSpellDamage(\n            enactor.traits,\n            occupant.traits,\n            this.owner.traits\n          );\n          if (damage > 0) {\n            totalDamage += damage;\n            this.#displaySpell(tile.worldPoint);\n            hitTargets++;\n            applyDamage(enactor, occupant, damage);\n            occupant.traits.addTransientFxTraits(this.owner.traits);\n          } else {\n            this.#displayFailedSpell(tile.worldPoint);\n          }\n        }\n      }\n    }\n    if (validTargets === 0) {\n      this.#displayFailedSpell(enactor.position);\n    }\n    return pause(1.5).then(() => {\n      return totalDamage;\n    }); // pause to allow visuals and spell chant.\n  }\n\n  /**\n   * Cast a spell to find traps. The exact location is not shown but a warning is placed.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise<undefined>}\n   */\n  #enactFindTraps(enactor) {\n    const tileMap = WORLD.getTileMap();\n    const gridPoint = tileMap.worldPointToGrid(enactor.position);\n    const range = this.owner.traits.getValueInFeetInTiles('RANGE', 1);\n    const radial = this.owner.traits.get('DIRECTION') === 'RADIAL';\n    const searchedTiles = radial\n      ? tileMap.getRadiatingVisibleTiles(range)\n      : tileMap.getRadiatingCross(gridPoint, range);\n    let foundTrap = false;\n    for (const tile of searchedTiles) {\n      if (foundTrap) {\n        break;\n      }\n      const occupants = tile.getOccupants().values();\n      for (const occupant of occupants) {\n        if (occupant.isHiddenArtefact?.()) {\n          const storageDetails = occupant.storeManager.getFirstStorageDetails();\n          let artefact = storageDetails?.artefact;\n          if (artefact?.isTrap()) {\n            foundTrap = true;\n            break;\n          }\n        }\n      }\n    }\n    for (const tile of searchedTiles) {\n      if (foundTrap) {\n        this.#displaySpell(tile.worldPoint);\n      } else {\n        this.#displayFailedSpell(tile.worldPoint);\n      }\n    }\n  }\n\n  /**\n   * Cast a spell on oneself. These are only for spells that have\n   *  a benefit and only for heroes.\n   * @param {module:players/actors.Actor} caster\n   * @returns {Promise<undefined>}\n   */\n  #enactBless(caster) {\n    if (!caster.isHero()) {\n      return;\n    }\n    if (!magic.canBless(caster.traits, caster.traits, this.owner.traits)) {\n      this.#displayFailedSpell(caster.position);\n      return;\n    }\n    const hpGain = dndAction.getSpellHpGain(\n      caster.traits,\n      caster.traits,\n      this.owner.traits\n    );\n    this.#displaySpell(caster.position);\n    this.#applyAndShowHpGain(caster, hpGain);\n    caster.traits.addTransientFxTraits(this.owner.traits);\n    return Promise.resolve();\n  }\n\n  /** Apply and show gain for caster.\n   * @param {module:players/actors.Actor} caster\n   * @param {number} hpGain\n   */\n  #applyAndShowHpGain(caster, hpGain) {\n    if (hpGain > 0) {\n      caster.traits.addInt('HP', hpGain);\n      displayRisingText(\n        `+${hpGain}HP`,\n        caster.position,\n        Colours.HP_TRANSIENT_TEXT_HERO\n      );\n    }\n  }\n\n  /**\n   * Cast a standard magic spell\n   * @param {module:players/actors.Actor} caster\n   * @returns {Promise<undefined>}\n   */\n  #enactConjureMeal(enactor) {\n    const almanac = ALMANAC_LIBRARY.getAlmanac('ARTEFACTS');\n    const foodEntry = almanac.find((entry) => entry.id === 'iron_rations');\n    const waterEntry = almanac.find((entry) => entry.id === 'waterskin');\n    let itemsStashed = 0;\n    const maxMeals = 3;\n    for (let meals = 0; meals < maxMeals; meals++) {\n      const food = buildArtefact(foodEntry);\n      if (!enactor.storeManager.stash(food, { direct: true })) {\n        break;\n      }\n      itemsStashed++;\n      const water = buildArtefact(waterEntry);\n      if (!enactor.storeManager.stash(water, { direct: true })) {\n        break;\n      }\n      itemsStashed++;\n    }\n    if (itemsStashed === 0) {\n      return UI.showOkDialog(\n        i18n`MESSAGE NO SPACE FOR CONJURED FOOD AND WATER`\n      );\n    } else if (itemsStashed < maxMeals * 2) {\n      return UI.showOkDialog(\n        i18n`MESSAGE NO SPACE FOR ALL CONJURED FOOD AND WATER`\n      );\n    } else {\n      return UI.showOkDialog(i18n`MESSAGE CONJURED FOOD AND WATER`);\n    }\n  }\n\n  /**\n   * Detect poison of any items in the users backpack.\n   * @param {module:players/actors.Actor} caster\n   * @returns {Promise<undefined>}\n   */\n  #enactDetectPoison(enactor) {\n    const backpackContents = enactor.storeManager\n      .getStore(StoreType.BACKPACK)\n      .values();\n    let identifiedItem = false;\n    backpackContents.forEach((artefact) => {\n      if (artefact.unknown) {\n        identifiedItem = true;\n        artefact.unknown = false;\n      }\n    });\n    if (identifiedItem) {\n      return UI.showOkDialog(i18n`MESSAGE DETECT POISON SUCCESS`);\n    } else {\n      return UI.showOkDialog(i18n`MESSAGE DETECT POISON FAILURE`);\n    }\n  }\n\n  /**\n   * Enact a vampiric touch.\n   * This is a melee attack followed by a self-cure.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise<undefined>}\n   */\n  #enactVampiricTouch(enactor) {\n    this.#enactMagic(enactor).then((damage) => {\n      if (damage > 0) {\n        const hpGain = Math.round(damage / 2);\n        const currentHp = enactor.traits.getInt('HP');\n        const hpMax = enactor.traits.getInt('HP_MAX');\n        const appliedGain = Math.min(hpMax - currentHp, hpGain);\n        LOG.info(\n          `Vampiric touch convert ${damage} damage to ${appliedGain} HP.`\n        );\n        this.#applyAndShowHpGain(enactor, appliedGain);\n      }\n    });\n  }\n\n  /**\n   * Apply transient hover\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise<undefined>}\n   */\n  #enactHover(enactor) {\n    if (enactor.traits.transientProperties) {\n      enactor.traits.transientProperties.hover = true;\n      this.#displaySpell(enactor.position);\n    }\n  }\n\n  /**\n   * Test if this is a valid target.\n   * @param {module:dnd/players.Actor} caster\n   * @param {module:dnd/players.Actor} target\n   * @param {boolean} includeTrader\n   * @returns {boolean}\n   */\n  #IsValidTarget(caster, target, includeTrader) {\n    if (caster.isHero()) {\n      const possibleTarget = includeTrader\n        ? target.isEnemy() || target.isTrader()\n        : target.isEnemy();\n      return possibleTarget && target.alive;\n    } else {\n      return target.isHero() && target.alive;\n    }\n  }\n\n  /**\n   * Display a spell attack at a point.\n   * @param {Point} worldPoint\n   */\n  #displaySpell(worldPoint) {\n    const spellType = this.owner.traits.get('EFFECT');\n    addFadingAnimatedImage(spellType.toLowerCase(), {\n      position: worldPoint,\n      delaySecs: 0,\n      lifetimeSecs: 2,\n    });\n  }\n\n  /**\n   * Display a spell attack at a point.\n   * @param {Point} worldPoint\n   */\n  #displayFailedSpell(worldPoint) {\n    addFadingImage(IMAGE_MANAGER.getSpriteBitmap('failed-spell.png'), {\n      position: worldPoint,\n      delaySecs: 0,\n      lifetimeSecs: 2,\n    });\n  }\n}\n\n/**\n * Class to handle consuming food, which in this context includes drinks.\n * @implements {ActorInteraction}\n */\nexport class ConsumeFood extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/artefacts.Artefact} owner - parent actor.\n   */\n  constructor(owner) {\n    super(owner);\n  }\n\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return false;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return true;\n  }\n  /**\n   * Respond to a consume instruction\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise}\n   */\n  async react(enactor) {\n    const traits = this.owner.traits;\n    const foodType = traits.get('TYPE');\n    if (foodType === 'POTION') {\n      enactor.traits.addTransientFxTraits(this.owner.traits);\n      this.#addTransientActions(enactor);\n      return UI.showOkDialog(i18n`MESSAGE FX TRAITS APPLIED`);\n    }\n    if (foodType === 'POISON') {\n      const damage = dndAction.getPoisonDamage(\n        this.owner.traits,\n        enactor.traits\n      );\n      if (damage === 0) {\n        return UI.showOkDialog(i18n`MESSAGE RESISTED POISON`);\n      } else if (applyPoisonDamage(this.owner, enactor, damage) <= 0) {\n        return UI.showOkDialog(i18n`MESSAGE KILLED BY POISON`);\n      } else {\n        return UI.showOkDialog(i18n`MESSAGE IT'S POISON ${damage}`);\n      }\n    } else {\n      const gainDetail = dndAction.getConsumptionBenefit(\n        this.owner.traits,\n        enactor.traits\n      );\n\n      const gainHp = gainDetail.newHp - gainDetail.oldHp;\n      let hpMessage;\n      if (gainDetail.shortFall <= 0) {\n        hpMessage = i18n`MESSAGE CONSUME BUT ALREADY FULL HP`;\n      } else if (gainHp === 0) {\n        hpMessage = i18n`MESSAGE CONSUME BUT NO HP GAIN`;\n      } else {\n        hpMessage =\n          foodType === 'MEDICINE'\n            ? i18n`MESSAGE IT'S A HEALTHY DRINK ${gainHp}`\n            : i18n`MESSAGE IT'S HEALTHY ${gainHp}`;\n      }\n      const container = createElement('div');\n      container.appendChild(createElement('p', { text: hpMessage }));\n      if (gainDetail.detoxify) {\n        enactor.toxify?.cure();\n        container.appendChild(\n          createElement('p', { text: i18n`MESSAGE CURED OF TOXINS` })\n        );\n      }\n\n      return UI.showControlsDialog(container).then(() =>\n        enactor.traits.set('HP', gainDetail.newHp)\n      );\n    }\n  }\n  /**\n   * Add transient actions to the enactor.\n   * @param {module:players/actors.Actor} enactor\n   */\n  #addTransientActions(enactor) {\n    const action = this.owner.traits.get('ACTION');\n    if (!action) {\n      return;\n    }\n    if (!enactor.traits.transientProperties) {\n      LOG.error(\n        `Actor ${enactor.traits.get('NAME')} has no transientProperties.`\n      );\n      return;\n    }\n    switch (action) {\n      case 'HOVER':\n        enactor.traits.transientProperties.hover = true;\n        break;\n      default:\n        LOG.error(`Did not recognise action: ${action}.`);\n    }\n  }\n}\n\n/**\n * @typedef {string} TrapOutcomeValue\n */\n/**\n * @enum {TrapOutcomeValue}\n */\nexport const TrapOutcome = {\n  ATTEMPT_DISABLE: 'attempt disable',\n  LEAVE: 'leave',\n  DISABLED: 'disabled',\n  TRIGGERED: 'triggered',\n};\n\n/**\n * Class to handle triggering a trap\n * @implements {ActorInteraction}\n */\nexport class TriggerTrap extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/artefacts.Artefact} owner - parent actor.\n   */\n  constructor(owner) {\n    super(owner);\n  }\n\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return false;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return true;\n  }\n  /**\n   * Respond to a trap being triggered.\n   * @param {module:players/actors.Actor} enactor\n   * @returns {Promise<{outcome:TrapOutcome, artefact:module:players/artefacts.Artefact}>} fulfils to artefact that is found if successfully disabled.\n   */\n  async react(enactor) {\n    let foundArtefact = null;\n    const trapDetails = traps.getCharacteristics(\n      enactor.traits.getCharacterLevel(),\n      this.owner.traits\n    );\n    const action = await this.#attemptToDisable(enactor.traits, trapDetails);\n    let damage;\n    switch (action) {\n      case TrapOutcome.TRIGGERED: {\n        LOG.info('Trigger the trap.');\n        damage = dndAction.getMeleeDamage(trapDetails.attack, enactor.traits);\n        const dialog =\n          damage === 0\n            ? trapDialogs.showSurvivedTrap\n            : trapDialogs.showInjuredByTrap;\n        return dialog(enactor, trapDetails, this.owner.description)\n          .then(() => this.#applyAndShowDamage(enactor, damage))\n          .then(() => ({ outcome: action, artefact: foundArtefact }));\n      }\n      case TrapOutcome.DISABLED:\n        LOG.info('Disabled the trap.');\n        foundArtefact = buildArtefactFromId(trapDetails.reward);\n        return trapDialogs\n          .showDisableSuccess(enactor, trapDetails, this.owner.description)\n          .then(() => ({ outcome: action, artefact: foundArtefact }));\n      case TrapOutcome.LEAVE:\n        LOG.info('Left the trap.');\n        return Promise.resolve({ outcome: action, artefact: foundArtefact });\n    }\n  }\n\n  /**\n   * Apply and show damage.\n   * @param {module:players/actors.Actor} enactor\n   * @param {number} damage\n   */\n  #applyAndShowDamage(enactor, damage) {\n    return new Promise((resolve) => {\n      SOUND_MANAGER.playEffect('TRIGGER TRAP');\n      if (damage <= 0) {\n        addFadingImage(IMAGE_MANAGER.getSpriteBitmap('miss.png'), {\n          delaySecs: 0,\n          lifetimeSecs: 1,\n          position: enactor.position,\n          velocity: new Velocity(0, 0, 0),\n        });\n      } else {\n        addFadingImage(IMAGE_MANAGER.getSpriteBitmap('blood-splat.png'), {\n          delaySecs: 0,\n          lifetimeSecs: 1,\n          position: enactor.position,\n          velocity: new Velocity(0, 0, 0),\n        });\n        applyDamage(this.owner, enactor, damage);\n      }\n      resolve();\n    });\n  }\n\n  /**\n   * Attempt to disable a trap if possible\n   * @param {module:dnd/traits.Traits} enactorTraits\n   * @param {module:dnd/trapCharacteristics~TrapDetails} trapDetails\n   * @returns {Promise<string>} fulfils to 'leave', 'disable' or 'trigger'\n   */\n  #attemptToDisable(enactorTraits, trapDetails) {\n    if (dndAction.canDetectTrap(enactorTraits, trapDetails)) {\n      return trapDialogs\n        .showDisableTrap(enactorTraits, trapDetails, this.owner.description)\n        .then((outcome) => {\n          if (outcome === TrapOutcome.LEAVE) {\n            return outcome;\n          }\n          if (dndAction.canDisableTrap(enactorTraits, trapDetails)) {\n            return TrapOutcome.DISABLED;\n          } else {\n            return TrapOutcome.TRIGGERED;\n          }\n        });\n    } else {\n      return Promise.resolve(TrapOutcome.TRIGGERED);\n    }\n  }\n}\n\n/**\n * Class to handle searching a portal.\n * @implements {ActorInteraction}\n */\nexport class FindPortal extends AbstractInteraction {\n  /**\n   * Construct the interaction.\n   * @param {module:players/actors.Actor} owner - parent actor.\n   */\n  constructor(owner) {\n    super(owner);\n  }\n\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canEnact() {\n    return false;\n  }\n  /**\n   * @override\n   * @returns {boolean}\n   */\n  canReact() {\n    return true;\n  }\n  /**\n   * Respond to a interaction\n   * @param {module:players/actors.Actor} reactor\n   * @returns {Promise}\n   */\n  async react(enactor) {\n    return showMoneyPortalDialog(enactor).then((sentGold) => {\n      if (sentGold) {\n        SOUND_MANAGER.playEffect('PORTAL');\n        if (this.owner.alive) {\n          this.owner.velocity = new Velocity(0, 0, 3);\n          this.owner.alive = false; // dead in this context means the portal is open\n        }\n      }\n    });\n  }\n}\n","/**\n * @file Create transient effects.\n *\n * @module utils/effects/transient\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { Sprite } from '../sprites/sprite.js';\nimport {\n  ImageSpriteCanvasRenderer,\n  TextSpriteCanvasRenderer,\n} from '../sprites/spriteRenderers.js';\nimport SCREEN from '../game/screen.js';\nimport { TimeFader } from '../sprites/faders.js';\nimport WORLD from '../game/world.js';\nimport { VelocityMover } from '../sprites/movers.js';\nimport { AnimatedImage } from '../sprites/animation.js';\nimport { LoopMethod } from '../arrays/indexer.js';\nimport { Acceleration, Velocity, Point } from '../geometry.js';\n\n/**\n * Create a transient sprite\n * @param {module:utils/sprites/spriteRenderers~SpriteCanvasRenderer} renderer\n * @param {Object} options\n * @param {Point} options.position\n * @param {Velocity} options.velocity\n * @param {number} options.delaySecs\n * @param {number} options.lifetimeSecs\n */\nfunction createFadingSprite(renderer, options) {\n  const sprite = new Sprite({\n    renderer: renderer,\n  });\n  sprite.position = options.position;\n  sprite.velocity = options.velocity ?? new Velocity(0, 0, 0);\n  sprite.acceleration = options.acceleration ?? new Acceleration(0, 0, 0);\n  WORLD.addPassiveSprite(sprite);\n  new TimeFader(options.delaySecs, options.lifetimeSecs, new VelocityMover())\n    .applyAsTransientToSprite(sprite, 20)\n    .then(() => WORLD.removePassiveSprite(sprite));\n}\n\n/**\n * Create a transient image\n * @param {module:utils/sprites/imageManager~SpriteBitmap} imageName\n * @param {Object} options\n * @param {Point} options.position\n * @param {Velocity} options.velocity\n * @param {Acceleration} options.acceleration\n * @param {number} options.delaySecs\n * @param {number} options.lifetimeSecs\n */\nexport function addFadingImage(image, options) {\n  createFadingSprite(\n    new ImageSpriteCanvasRenderer(SCREEN.getContext2D(), image),\n    options\n  );\n}\n\n/**\n * Create a transient Animated image. Images are assumed to be of the form\n * imageRootName00.png, imageRootName01.png etc.\n * @param {module:utils/sprites/imageManager~SpriteBitmap} imageRootName - no extension. png will be used.\n * @param {Object} options\n * @param {Point} options.position\n * @param {Velocity} options.velocity\n * @param {Acceleration} options.acceleration\n * @param {number} options.delaySecs\n * @param {number} options.lifetimeSecs\n */\nexport function addFadingAnimatedImage(imageRootName, options) {\n  const image = new AnimatedImage(\n    {\n      prefix: imageRootName,\n      suffix: '.png',\n      startIndex: 0,\n      padding: 2,\n    },\n    { framePeriodMs: 300, loopMethod: LoopMethod.REVERSE }\n  );\n  createFadingSprite(\n    new ImageSpriteCanvasRenderer(SCREEN.getContext2D(), image),\n    options\n  );\n}\n\n/**\n * Create transient text\n * @param {string} text\n * @param {Object} options\n * @param {string} options.color\n * @param {Point} options.position\n * @param {Velocity} options.velocity\n * @param {Acceleration} options.acceleration\n * @param {number} options.delaySecs\n * @param {number} options.lifetimeSecs\n */\nexport function addFadingText(text, options) {\n  createFadingSprite(\n    new TextSpriteCanvasRenderer(SCREEN.getContext2D(), text, {\n      color: options.color,\n    }),\n    options\n  );\n}\n\n/**\n * Display rising text that fades.\n * @param {string} text\n * @param {module:utils/geometry~Position} position\n * @param {string} [color = 'white']\n */\nexport function displayRisingText(text, position, color = 'white') {\n  addFadingText(text, {\n    color: color,\n    delaySecs: 2,\n    lifetimeSecs: 3,\n    position: new Point(position.x, position.y),\n    velocity: new Velocity(0, -48, 0),\n    acceleration: new Acceleration(0, -96, 0),\n  });\n}\n","/**\n * @file Basic sprite control\n *\n * @module utils/sprites/sprite\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport { Position, Rectangle, Velocity, Acceleration } from '../geometry.js';\nimport { SpriteCanvasRenderer } from './spriteRenderers.js'; //eslint-disable-line no-unused-vars\n\n/**\n * @typedef {function} SpriteClickHandler\n * @param {Sprite} target - the sprite that was clicked. This prevents the need\n * to use 'this' which may not be correct in the context.\n * @param {Point} relativePoint - the position in the Sprite relative to its top left corner\n * @param {Object} detail - extended event information.\n */\n\n/**\n * Encapsulated sprite.\n */\nexport class Sprite {\n  /** @type {Position}*/\n  #position = new Position(0, 0, 0);\n  /** @type {Velocity} */\n  #velocity = new Velocity(0, 0, 0);\n  /** @type {Acceleration} */\n  #acceleration = new Acceleration(0, 0, 0);\n  /** @type {SpriteCanvasRenderer[]} */\n  #renderer;\n  /** @type {module:utils/sprite.AbstractModifier} */\n  #baseModifier;\n  /** @type {module:utils/sprite.AbstractModifier} */\n  #transientModifier;\n  /** @type {boolean} */\n  visible;\n  /** @type {number} */\n  opacity;\n\n  /**\n   * @param {Object} options\n   * @param {SpriteCanvasRenderer } options.renderer - the renderer or renderers that render the sprite\n   * rather than the world.\n   */\n  constructor(options) {\n    this.#renderer = options?.renderer;\n    this.visible = true;\n    this.opacity = 1;\n  }\n  /**\n   * Get the current position.\n   * @returns {Position}\n   */\n  get position() {\n    return this.#position;\n  }\n\n  /**\n   * Set the current position. Invalid values become 0.\n   * @param {Position} nextPosition\n   */\n  set position(nextPosition) {\n    this.#position.x = this.valueOrZero(nextPosition.x);\n    this.#position.y = this.valueOrZero(nextPosition.y);\n    this.#position.rotation = this.valueOrZero(nextPosition.rotation);\n  }\n\n  /**\n   * Get the current motion.\n   * @returns {Velocity}\n   */\n\n  get velocity() {\n    return this.#velocity;\n  }\n\n  /**\n   * Get the current motion.\n   * @returns {Acceleration}\n   */\n\n  get acceleration() {\n    return this.#acceleration;\n  }\n\n  /**\n   * Set the current motion.\n   * @param {Acceleration} acceleration\n   */\n\n  set acceleration(acceleration) {\n    this.#acceleration = acceleration;\n  }\n\n  /**\n   * Set the current Velocity. Invalid values become 0.\n   * @param {Velocity} nextVelocity\n   */\n  set velocity(nextVelocity) {\n    this.#velocity.x = this.valueOrZero(nextVelocity.x);\n    this.#velocity.y = this.valueOrZero(nextVelocity.y);\n    this.#velocity.rotation = this.valueOrZero(nextVelocity.rotation);\n  }\n\n  /**\n   * Add a new modifier. If there is already a modifier running,\n   * it's kill function is called to make sure any pending promises\n   * are resolved.\n   * @param {module:utils/sprite.AbstractModifier} modifier\n   */\n  replaceTransientModifier(modifier) {\n    if (this.#transientModifier) {\n      this.#transientModifier.kill();\n    }\n    this.#transientModifier = modifier;\n  }\n\n  /**\n   * Set the base modifier. If there is already a modifier running,\n   * it's kill function is called to make sure any pending promises\n   * are resolved.\n   * @param {module:utils/sprite.AbstractModifier} modifier\n   */\n  replaceBaseModifier(modifier) {\n    if (this.#baseModifier) {\n      this.#baseModifier.kill();\n    }\n    this.#baseModifier = modifier;\n  }\n\n  /**\n   * Returns the value but converts non-numeric values to 0.\n   * @param {number} value\n   * @returns {number}\n   */\n  valueOrZero(value) {\n    return typeof value === 'number' ? value : 0;\n  }\n\n  /**\n   * Update the sprite. Calls the sprite's modifier and then renderer.\n   * @param {number} deltaSeconds - elapsed time.\n   */\n  update(deltaSeconds) {\n    if (this.#baseModifier) {\n      this.#baseModifier = this.#baseModifier.update(this, deltaSeconds);\n    }\n    if (this.#transientModifier) {\n      this.#transientModifier = this.#transientModifier.update(\n        this,\n        deltaSeconds\n      );\n    }\n    if (this.visible) {\n      this.#render();\n    }\n  }\n  /**\n   * Render the sprite by calling the sprite's renderer\n   */\n  #render() {\n    if (!this.#renderer) {\n      return;\n    }\n    if (!this.#renderer.forEach) {\n      this.#renderer.render(this.#position, this.opacity);\n    } else {\n      this.#renderer.forEach((renderer) =>\n        renderer.render(this.#position, this.opacity)\n      );\n    }\n  }\n\n  /** Get the bounding box for the sprite.\n   * @returns {geometry.Rectangle}\n   */\n  getBoundingBox() {\n    const boundsCanvas = this.#renderer.getBoundingBoxCanvas();\n    return new Rectangle(\n      this.position.x - boundsCanvas.width / 2,\n      this.position.y - boundsCanvas.height / 2,\n      boundsCanvas.width,\n      boundsCanvas.height\n    );\n  }\n\n  /**\n   * Get image file name used for passive renderers. If this is a multi-renderer,\n   * the first one with a bitmap is returned.\n   * @returns {module:utils/sprites/imageManager~SpriteBitmap}\n   */\n  getImageFilename() {\n    if (!this.#renderer.forEach) {\n      return this.#renderer.getImageFilename();\n    } else {\n      for (const renderer of this.#renderer) {\n        const bitmap = renderer.getImageFilename();\n        if (bitmap) {\n          return bitmap;\n        }\n      }\n    }\n    return null;\n  }\n}\n","/**\n * @file Handle sprite rendering on the canvas\n *\n * @module utils/sprites/spriteRenderers\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../logging.js';\nimport * as canvasText from '../text/text.js';\nimport * as fonts from '../text/fonts.js';\nimport * as debug from '../debug.js';\nimport SCREEN from '../game/screen.js';\nimport { MIN_POINT, MAX_POINT, Rectangle } from '../geometry.js';\nimport * as animation from './animation.js'; //eslint-disable-line no-unused-vars\n\n/**\n * @typedef {Object} RenderGeometry\n * @property {number} width\n * @property {number} height\n * @property {module:utils/geometry~Point} origin - origin relative to the centre\n */\n\n/**\n * Convert RenderGeometry to Rectangle\n * @param {module:utils/geometry~Position} position\n * @param {RenderGeometry} renderGeom\n * @returns {module:utils/geometry~Rectangle}\n */\nfunction renderGeometryToRect(position, renderGeom) {\n  return new Rectangle(\n    position.x - renderGeom.width / 2,\n    position.y - renderGeom.height / 2,\n    renderGeom.width,\n    renderGeom.height\n  );\n}\n\n/**\n * Base class for all sprite renderers.\n * @abstract\n */\nexport class SpriteCanvasRenderer {\n  /** @type {CanvasRenderingContext2D} */\n  _context;\n\n  /** @type {module:utils/geometry~Rectangle} */\n  _boundingBoxCanvas;\n\n  /**\n   * Construct base renderer\n   * @param {CanvasRenderingContext2D} context\n   */\n  constructor(context) {\n    this._context = context;\n    this._boundingBoxCanvas = new Rectangle(0, 0, 0, 0);\n  }\n\n  /**\n   * Return the name of image use to represent the sprite in passive situations\n   * such as dialogs. If there is no image, it returns null;\n   * @returns {string}\n   */\n  getImageFilename() {\n    return null;\n  }\n\n  /**\n   * Get the context. This is just provided to allow classes other than children\n   * to read the context. _context could be used but that is not the intent.\n   */\n  getContext() {\n    return this._context;\n  }\n\n  /**\n   * Get the axis aligned bounding box\n   * @returns {module:utils/geometry~Rectangle}\n   */\n  getBoundingBoxCanvas() {\n    return this._boundingBoxCanvas;\n  }\n  /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position in the world\n   * @param {number} opacity\n   */\n  render(position, opacity) {\n    position = SCREEN.worldPositionToCanvas(position);\n    if (!this.isOnCanvas(position)) {\n      return;\n    }\n    const currentAlpha = this._context.globalAlpha;\n    this._context.globalAlpha = currentAlpha * opacity;\n    const rotated = position.rotation;\n    if (rotated) {\n      this._context.save();\n      this._context.translate(position.x, position.y);\n      this._context.rotate(-position.rotation);\n      this._context.translate(-position.x, -position.y);\n    }\n    this._doRender(position);\n    if (rotated) {\n      this._context.restore();\n    }\n    if (debug.OPTIONS.spriteBoxes) {\n      this._context.strokeStyle = 'green';\n      this._context.strokeRect(\n        this._boundingBoxCanvas.x,\n        this._boundingBoxCanvas.y,\n        this._boundingBoxCanvas.width,\n        this._boundingBoxCanvas.height\n      );\n    }\n    this._context.globalAlpha = currentAlpha;\n  }\n  /**\n   * Render the sprite\n   * @param {module:utils/geometry~Position} position\n   */\n  _doRender(positionUnused) {\n    LOG.error('_doRender method should be overridden.');\n  }\n\n  /**\n   * Check if it will be on screen\n   * @param {module:utils/geometry~Position} position\n   * @returns {boolean} true if on screen.\n   */\n  isOnScreen(position) {\n    const rect = new Rectangle(\n      position.x - this._boundingBoxCanvas.width / 2,\n      position.y - this._boundingBoxCanvas.height / 2,\n      this._boundingBoxCanvas.width,\n      this._boundingBoxCanvas.height\n    );\n    return SCREEN.isOnScreen(rect);\n  }\n\n  /**\n   * Check if it will be on screen\n   * @param {module:utils/geometry~Position} position - this should be in canvas coordinates.\n   * @returns {boolean} true if on screen.\n   */\n  isOnCanvas(position) {\n    const rect = new Rectangle(\n      position.x - this._boundingBoxCanvas.width / 2,\n      position.y - this._boundingBoxCanvas.height / 2,\n      this._boundingBoxCanvas.width,\n      this._boundingBoxCanvas.height\n    );\n    return SCREEN.isOnCanvas(rect);\n  }\n}\n\n/**\n * Renderer for TextSprites.\n */\nexport class TextSpriteCanvasRenderer extends SpriteCanvasRenderer {\n  /** Name used to access font styles from the fonts.\n   * @type {string}\n   */\n  #styleName;\n\n  /** @type {string} */\n  #lastCalculatedText;\n  /** @type {RenderGeometry} */\n  #renderGeometry;\n\n  /** @type {string} */\n  text;\n  /** @type {string} */\n  color;\n\n  /**\n   * @param {CanvasRenderingContext2D} context\n   * @param {string} text\n   * @param {Object} options\n   * @param {string} [options.styleName = 'normal']\n   * @param {string} [options.color = 'white']\n   */\n  constructor(\n    context,\n    text,\n    options = { styleName: 'normal', color: 'white' }\n  ) {\n    super(context);\n    this.text = text;\n    this.color = options.color;\n    this.#styleName = options.styleName;\n  }\n\n  /**\n   * Calculate the renderGeometry of the text.\n   * @param {string} text\n   */\n  #calculateRenderGeometry(text) {\n    this._context.font = fonts.getCss(this.#styleName);\n    const metrics = this._context.measureText(text);\n    this.#renderGeometry = {\n      width: metrics.width,\n      height: metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent,\n      origin: {\n        x: -0.5 * metrics.width,\n        y:\n          0.5 *\n          (metrics.fontBoundingBoxAscent - metrics.fontBoundingBoxDescent),\n      },\n    };\n    this.#lastCalculatedText = text;\n  }\n\n  /**\n   * Render the sprite\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */\n  _doRender(position) {\n    if (this.text !== this.#lastCalculatedText) {\n      this.#calculateRenderGeometry(this.text);\n    }\n    const renderPosition = {\n      x: position.x + this.#renderGeometry.origin.x,\n      y: position.y + this.#renderGeometry.origin.y,\n      rotation: position.rotation,\n    };\n\n    canvasText.writeText(\n      this._context,\n      this.#lastCalculatedText,\n      renderPosition,\n      { color: this.color, styleName: this.#styleName }\n    );\n\n    this._boundingBoxCanvas = renderGeometryToRect(\n      position,\n      this.#renderGeometry\n    );\n  }\n}\n\n/**\n * Renderer for rectangle sprites\n */\nexport class RectSpriteCanvasRenderer extends SpriteCanvasRenderer {\n  #width;\n  #height;\n  #halfWidth;\n  #halfHeight;\n  #fillStyle;\n  #strokeStyle;\n  #lineWidth;\n  /**\n   *\n   * @param {CanvasRenderingContext2D} context\n   * @param {Object} options\n   * @param {number} options.width\n   * @param {number} options.height\n   * @param {string} options.fillStyle\n   * @param {string} options.strokeStyle\n   */\n  constructor(context, options) {\n    super(context);\n    this.#width = options.width ?? 10;\n    this.#height = options.height ?? 10;\n    this.#halfWidth = this.#width / 2;\n    this.#halfHeight = this.#height / 2;\n    this.#fillStyle = options.fillStyle;\n    this.#strokeStyle = options.strokeStyle;\n    this.#lineWidth = options.lineWidth ?? 2;\n  }\n\n  /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */\n  _doRender(position) {\n    this._context.lineWidth = this.#lineWidth;\n    const x = position.x - this.#halfWidth;\n    const y = position.y - this.#halfHeight;\n    if (this.#fillStyle) {\n      this._context.fillStyle = this.#fillStyle;\n      this._context.fillRect(x, y, this.#width, this.#height);\n    }\n    if (this.#strokeStyle) {\n      this._context.strokeStyle = this.#strokeStyle;\n      this._context.strokeRect(x, y, this.#width, this.#height);\n    }\n\n    this._boundingBoxCanvas = new Rectangle(x, y, this.#width, this.#height);\n  }\n}\n\n/**\n * Renderer for percentage properties.\n */\nexport class GaugeSpriteCanvasRenderer extends SpriteCanvasRenderer {\n  #height;\n  #halfHeight;\n  #width;\n  #halfWidth;\n  #fillStyle;\n  #strokeStyle;\n  #offsetX;\n  #offsetY;\n  #fillHeight;\n  #halfFillHeight;\n\n  /**\n   *\n   * @param {CanvasRenderingContext2D} context\n   * @param {Object} options\n   * @param {number} options.width\n   * @param {number} options.height\n   * @param {string} options.fillStyle\n   * @param {string} options.strokeStyle\n   * @param {number} options.offsetX - sprite is offset from the normal sprite position.\n   * @param {number} options.offsetY - sprite is offset from the normal sprite position.\n   */\n  constructor(context, options) {\n    super(context);\n    this.#height = options.height;\n    this.#halfHeight = this.#height / 2;\n    this.#width = options.width;\n    this.#halfWidth = this.#width / 2;\n    this.#fillStyle = options.fillStyle;\n    this.#strokeStyle = options.strokeStyle;\n    this.#offsetX = options.offsetX ?? 0;\n    this.#offsetY = options.offsetY ?? 0;\n    this.setLevel(0);\n  }\n\n  /** Set the level of the gauge.\n   * @param {number} proportion - 0 to 1\n   */\n  setLevel(proportion) {\n    this.#fillHeight = Math.min(proportion, 1) * this.#height;\n    this.#halfFillHeight = 0.5 * this.#fillHeight;\n  }\n\n  /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */\n  _doRender(position) {\n    const topStroke = position.y - this.#halfHeight + this.#offsetY;\n    const topFill =\n      position.y + this.#halfHeight - this.#fillHeight + this.#offsetY;\n\n    const x = position.x - this.#halfWidth + this.#offsetX;\n    if (this.#fillStyle) {\n      this._context.fillStyle = this.#fillStyle;\n      this._context.fillRect(x, topFill, this.#width, this.#fillHeight);\n    }\n    if (this.#strokeStyle) {\n      this._context.strokeStyle = this.#strokeStyle;\n      this._context.strokeRect(x, topStroke, this.#width, this.#height);\n    }\n\n    this._boundingBoxCanvas = new Rectangle(\n      x,\n      topStroke,\n      this.#width,\n      this.#height\n    );\n  }\n}\n\n/** Special renderer for multiple gauges applied over a square tile */\nexport class MultiGaugeTileRenderer extends SpriteCanvasRenderer {\n  #gaugeRenderers;\n\n  /**\n   * The number of gauges is determined by the maximum length of the fill styles and\n   * stroke styles\n   * @param {CanvasRenderingContext2D} context\n   * @param {Object} options\n   * @param {number} options.tileSize\n   * @param {string[]} options.fillStyles\n   * @param {string[]} options.strokeStyles\n   */\n  constructor(context, options) {\n    super(context);\n    const nGauges = Math.max(\n      options.fillStyles.length ?? 0,\n      options.strokeStyles.length ?? 0\n    );\n    if (nGauges === 0) {\n      LOG.error('Attempt to create MultiGaugeTileRenderer with no gauges.');\n      return;\n    }\n    this.#gaugeRenderers = [];\n    const gaugeWidth = options.tileSize / nGauges;\n    let gaugePosX = -options.tileSize / 2 + gaugeWidth / 2;\n\n    for (let index = 0; index < nGauges; index++) {\n      this.#gaugeRenderers.push(\n        new GaugeSpriteCanvasRenderer(context, {\n          width: gaugeWidth,\n          height: options.tileSize,\n          fillStyle: options.fillStyles?.[index],\n          strokeStyle: options.strokeStyles?.[index],\n          offsetX: gaugePosX + gaugeWidth * index,\n          offsetY: 0,\n        })\n      );\n    }\n  }\n\n  /**\n   * Set the level of a gauge.\n   * @param {number} gaugeIndex\n   * @param {number} proportion - 0 to 1\n   */\n  setLevel(gaugeIndex, proportion) {\n    this.#gaugeRenderers[gaugeIndex]?.setLevel(proportion);\n  }\n\n  /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */\n  render(position) {\n    this.#gaugeRenderers?.forEach((renderer) => renderer.render(position));\n  }\n}\n\n/**\n * Renderer for Path Sprites.\n */\nexport class PathSpriteCanvasRenderer extends SpriteCanvasRenderer {\n  /** @type {RenderGeometry} */\n  #renderGeometry;\n\n  /** @type {Point[]} */\n  path;\n\n  /**\n   * Create a path renderer.\n   * @param {CanvasRenderingContext2D} context\n   * @param {Point[]} path\n   */\n  constructor(context, path) {\n    super(context);\n    this.path = path;\n  }\n\n  /** Calculate the rendering geometry.\n   * @param {Point[]} path\n   * @param {module:utils/geometry~Position} position\n   */\n  #calculateGeometry(path, positionUnused) {\n    let minPoint = MAX_POINT;\n    let maxPoint = MIN_POINT;\n    path.forEach((point) => {\n      minPoint.x = Math.min(minPoint.x, point.x);\n      minPoint.y = Math.min(minPoint.y, point.y);\n      maxPoint.x = Math.max(maxPoint.x, point.x);\n      maxPoint.y = Math.max(maxPoint.y, point.y);\n    });\n\n    this.#renderGeometry = {\n      width: maxPoint.x - minPoint.x,\n      height: maxPoint.y - minPoint.y,\n      origin: {\n        x: 0.5 * (minPoint.x + maxPoint.x),\n        y: 0.5 * (minPoint.y + maxPoint.y),\n      },\n    };\n  }\n  /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */\n  _doRender(position) {\n    if (this.path.length < 2) {\n      LOG.error('Path sprite needs at least 2 points.');\n      return;\n    }\n    if (!this.#renderGeometry) {\n      this.#calculateGeometry(this.path, position);\n    }\n\n    this._context.beginPath();\n    this._context.strokeStyle = 'blue';\n    this._context.moveTo(\n      this.path[0].x + position.x,\n      this.path[0].y + position.y\n    );\n    for (let n = 1; n < this.path.length; n++) {\n      this._context.lineTo(\n        this.path[n].x + position.x,\n        this.path[n].y + position.y\n      );\n    }\n    this._context.closePath();\n    this._context.stroke();\n\n    this._boundingBoxCanvas = renderGeometryToRect(\n      position,\n      this.#renderGeometry\n    );\n  }\n}\n\n/**\n * Renderer for Image Sprites.\n */\nexport class ImageSpriteCanvasRenderer extends SpriteCanvasRenderer {\n  /** @type {module:utils/sprites/imageManager~SpriteBitmap} */\n  #spriteFrame;\n  /** @type {animation.KeyedAnimatedImages} */\n  #animation;\n\n  /**\n   * Create an image renderer.\n   * @param {CanvasRenderingContext2D} context\n   * @param {SpriteBitmap | animation.AnimatedImage | animation.KeyAnimatedImages} imageDefinition\n   */\n  constructor(context, imageDefinition) {\n    super(context);\n    if (imageDefinition?.getCurrentFrame) {\n      this.#animation = imageDefinition;\n      this.#spriteFrame = this.#animation.getCurrentFrame();\n    } else {\n      this.#spriteFrame = {\n        bitmap: imageDefinition,\n        rotation: 0,\n        flip: animation.FlipDirection.NONE,\n      };\n    }\n    if (this.#spriteFrame?.bitmap) {\n      this._boundingBoxCanvas.width = this.#spriteFrame.bitmap.width ?? 0;\n      this._boundingBoxCanvas.height = this.#spriteFrame.bitmap.height ?? 0;\n    } else {\n      LOG.error(`No image frame available for sprite.`, imageDefinition);\n    }\n  }\n\n  /**\n   * @override\n   */\n  getImageFilename() {\n    return this.#spriteFrame?.bitmap.filename;\n  }\n\n  /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */\n  _doRender(position) {\n    if (!this.#spriteFrame) {\n      return;\n    }\n    const frame = this.#animation\n      ? this.#animation.getCurrentFrame()\n      : this.#spriteFrame;\n\n    this._boundingBoxCanvas.x = position.x - this._boundingBoxCanvas.width / 2;\n    this._boundingBoxCanvas.y = position.y - this._boundingBoxCanvas.height / 2;\n\n    position.rotation = frame.rotation;\n    this._context.drawImage(\n      frame.bitmap.image,\n      position.x - frame.bitmap.centreX,\n      position.y - frame.bitmap.centreY\n    );\n  }\n}\n","/**\n * @file Canvas functions for handling text.\n *\n * @module utils/text/text\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as fonts from './fonts.js';\n\n/**\n * @typedef {Object} TextBounds\n * @property {number} width - width of text\n * @property {number} width - height of text\n * @property {number} offsetTop - offset from text y position to top. This is negative.\n * @property {number} offsetCentreY - offset from text y position to centre. This is negative.\n */\n\n/**\n * Calculate the text bounds. Note that the box surrounds the entire text including\n * descenders.\n * @param {CanvasRenderingContext2D} context\n * @param {string} text\n * @returns {TextBounds}\n */\nexport function getTextBounds(context, text) {\n  const metrics = context.measureText(text);\n  return {\n    width: metrics.width,\n    height: metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent,\n    offsetTop: -metrics.fontBoundingBoxAscent,\n    offsetCentreY:\n      0.5 * (metrics.fontBoundingBoxDescent - metrics.fontBoundingBoxAscent),\n  };\n}\n\n/**\n * Wrap text based on https://codepen.io/nishiohirokazu/pen/jjNyye\n * @param {CanvasRenderingContext2D} context\n * @param {string} paragraph\n * @param {module:utils/geometry~Position} position\n * @param {Object} options\n * @param {number} options.xWrapPosition - position to wrap text.\n * @param {number} [options.lineSpacing = 1] - multiplier for line height. 1 shifts lines by the total font height.\n * @returns {number} the next line y position.\n */\nfunction wrapParagraph(context, paragraph, position, options) {\n  const words = paragraph.split(' ');\n  let x = position.x ?? 0;\n  let y = position.y ?? 0;\n  let maxLineLength = options.xWrapPosition - x;\n  let lineSpacing = options.lineSpacing ?? 1;\n  let line = '';\n  let lineHeight;\n\n  for (let n = 0; n < words.length; n++) {\n    let testLine = line + words[n] + ' ';\n    const bounds = getTextBounds(context);\n    if (!lineHeight) {\n      lineHeight = lineSpacing * bounds.height;\n    }\n    if (bounds.width > maxLineLength && n > 0) {\n      context.fillText(line, x, y);\n      line = words[n] + ' ';\n      y += lineHeight;\n    } else {\n      line = testLine;\n    }\n  }\n  context.fillText(line, x, y);\n  return y + lineHeight;\n}\n/**\n * Write text to the canvas. Text can be wrapped if required.\n * @param {CanvasRenderingContext2D} context\n * @param {*} text\n * @param {module:utils/geometry~Position} position\n * @param {Object} options\n * @param {number} [options.wrapAtX] - if null, undefined or zero, no wrapping occurs.\n * @param {number} [options.lineSpacing = 1] - multiplier for line height. 1 shifts lines by the total font height.\n * @param {string} [options.styleName] - named style. Picks up settings from module:utils/fonts\n * @param {string} [options.color] - color\n */\nexport function writeText(context, text, position, options) {\n  context.font = fonts.getCss(options?.styleName);\n  context.fillStyle = options?.color ?? 'white';\n  if (!options?.wrapAtX) {\n    context.fillText(text, position.x ?? 0, position.y ?? 0);\n  } else {\n    var paragraphs = text.split('\\n');\n    for (let n = 0; n < paragraphs.length; n++) {\n      options.y = wrapParagraph(context, paragraphs[n], position, options);\n    }\n  }\n}\n","/**\n * @file Debug utilities\n *\n * @module utils/debug\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nexport const OPTIONS = {\n  /**\n   * Should sprite boxes be drawn.@type {boolean}\n   */\n  spriteBoxes: false,\n  /**\n   * Show framerate\n   */\n  showFps: false,\n};\n","/**\n * @file Animation support\n *\n * @module utils/sprites/animation\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport IMAGE_MANAGER from './imageManager.js';\nimport GAME_CLOCK from '../time/clock.js';\nimport { Indexer } from '../arrays/indexer.js';\nimport LOG from '../logging.js';\nimport * as maths from '../maths.js';\n\n/**\n * @typedef {number} FlipDirectionValue\n */\n/**\n * @enum {FlipDirectionValue}\n */\nexport const FlipDirection = {\n  NONE: 0,\n  HORIZONTAL: 1,\n  VERTICAL: 2,\n};\n\n/**\n * @typedef {Object} Frame\n * @property {module:utils/sprites/imageManager~SpriteBitmap}\n * @property {number} rotation\n * @property {FlipDirectionValue} flip\n */\n/**\n * Collection of SpriteBitmap objects\n */\nexport class AnimatedImage {\n  /** @type {boolean} */\n  playing;\n  /** @type {module:utils/sprites/imageManager~SpriteBitmap[]} */\n  #frameBitmaps;\n  /** @type {Indexer} */\n  #indexer;\n  /** @type {number} */\n  #lastFrameCount;\n  /** offset used to randomise animations. @type {number} */\n  #timeOffset;\n\n  /** Period in ms for frame animations @type {number}*/\n  #framePeriodMs;\n\n  /**\n   * Construct animation.\n   * @param {Object | string} filenamePattern - if a string is parsed then the image is a single frame.\n   * @param {string} filenamePattern.prefix\n   * @param {number} filenamePattern.startIndex - starting index.\n   * @param {number} filePattern.padding - index is padded with leading zeros to padding length\n   * @param {string} filenamePattern.suffix\n   * @param {Object} options\n   * @param {number} options.framePeriodMs - period in ms for frame animations.\n   * @param {LoopMethod} options.loopMethod - method of looping animation.\n   */\n  constructor(filenamePattern, options) {\n    this.#frameBitmaps = [];\n    this.#lastFrameCount = 0;\n    this.#timeOffset = maths.getRandomInt(0, 1000);\n\n    if (typeof filenamePattern === 'string') {\n      this.#frameBitmaps.push(IMAGE_MANAGER.getSpriteBitmap(filenamePattern));\n      return;\n    }\n\n    this.#framePeriodMs = Math.max(1, options.framePeriodMs);\n\n    let index = filenamePattern.startIndex ?? 0;\n    let padding = filenamePattern.padding ?? 0;\n    let textureFrame;\n    do {\n      const fileName = `${filenamePattern.prefix}${index\n        .toString()\n        .padStart(padding, '0')}${filenamePattern.suffix}`;\n      let quiet;\n      if (\n        index === 0 &&\n        (filenamePattern.prefix.endsWith('idle') ||\n          filenamePattern.prefix.endsWith('dead'))\n      ) {\n        quiet = false;\n      } else {\n        quiet = true;\n      }\n      textureFrame = IMAGE_MANAGER.getSpriteBitmap(fileName, { quiet: quiet });\n\n      if (textureFrame) {\n        this.#frameBitmaps.push(textureFrame);\n      }\n      index++;\n    } while (textureFrame);\n    this.#indexer = new Indexer(this.#frameBitmaps.length, options.loopMethod);\n    this.playing = true;\n  }\n\n  /**\n   * Get first frame\n   * @returns {Frame}\n   */\n  getFirstFrame() {\n    return {\n      bitmap: this.#frameBitmaps[0],\n      rotation: 0,\n      flip: FlipDirection.NONE,\n    };\n  }\n  /**\n   * Get current frame\n   * @returns {Frame}\n   */\n  getCurrentFrame() {\n    const frame = {\n      bitmap: undefined,\n      rotation: 0,\n      flip: FlipDirection.NONE,\n    };\n\n    if (this.#frameBitmaps.length > 1) {\n      if (this.playing) {\n        const frameCount = GAME_CLOCK.getFrameCount(\n          this.#framePeriodMs,\n          this.#timeOffset\n        );\n        if (frameCount !== this.#lastFrameCount) {\n          this.#indexer.advanceBy(frameCount - this.#lastFrameCount);\n          this.#lastFrameCount = frameCount;\n        }\n      }\n      frame.bitmap = this.#frameBitmaps[this.#indexer.index];\n    } else {\n      frame.bitmap = this.#frameBitmaps[0];\n    }\n    return frame.bitmap ? frame : undefined;\n  }\n\n  /**\n   * Manual movement of frames. Note this automatically switches off playing.\n   * @param {number} index - frame index. This will be clipped to the ends of the\n   * array.\n   */\n\n  setCurrentIndex(index) {\n    if (this.#frameBitmaps.length > 1) {\n      this.playing = false;\n      this.#indexer.index = index;\n    }\n  }\n\n  /**\n   * Get the current index.\n   * @returns {number}\n   */\n  getCurrentIndex() {\n    if (this.#frameBitmaps.length > 1) {\n      return this.#indexer.index;\n    } else {\n      return 0;\n    }\n  }\n}\n\n/**\n * Create keyed animated images.\n */\nexport class KeyedAnimatedImages {\n  /** @type {Object.<string, AnimatedImage>} */\n  #animatedImages;\n  /** @type {string} */\n  #currentImage;\n\n  /**\n   * Create the keyed animated image\n   * @param {string} key\n   * @param {AnimatedImage} animatedImage\n   */\n  constructor(key, animatedImage) {\n    this.#animatedImages = {};\n    if (key) {\n      this.#animatedImages[key] = animatedImage;\n      this.#currentImage = animatedImage;\n    }\n  }\n\n  /**\n   * Get the current image.\n   */\n  get image() {\n    return this.#currentImage;\n  }\n  /**\n   * Add image to available images.\n   * @param {string} key\n   * @param {AnimatedImage} animatedImage\n   */\n\n  addAnimatedImage(key, animatedImage) {\n    this.#animatedImages[key] = animatedImage;\n  }\n\n  /**\n   * Set the current animation key. Ignored if it does not exist.\n   * @param {string} key\n   */\n  setCurrentKey(key) {\n    //eslint-disable-next-line no-prototype-builtins\n    if (this.#animatedImages.hasOwnProperty(key)) {\n      this.#currentImage = this.#animatedImages[key];\n    } else {\n      LOG.error(`Attempt to set current key to nonexistent value of ${key}`);\n    }\n  }\n\n  /**\n   * Get current frame\n   * @returns {Frame}\n   */\n  getCurrentFrame() {\n    return this.#currentImage.getCurrentFrame();\n  }\n\n  /**\n   * Get specific frame.\n   * @param {string} key\n   * @returns {AnimatedImage}\n   */\n  getAnimatedImage(key) {\n    return this.#animatedImages[key];\n  }\n}\n","/**\n * @file Load and manage images. The image manager is implemented as a singleton.\n *\n * @module utils/sprites/imageManager\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport LOG from '../logging.js';\n\n/**\n * @typedef {Object} SpriteBitmap\n * @property {string} filename\n * @property {Image} image\n * @property {number} width\n * @property {number} height\n * @property {number} centreX\n * @property {number} centreY\n */\n\n/** @type {Map<string, SpriteBitmap>} */\nlet spriteMap = new Map();\n\n/**\n * Load an image\n * @param {URL} srcUrl - source URL\n * @returns {Promise} fulfils to @type {Image}.\n */\nfunction loadImage(srcUrl) {\n  LOG.debug(`Loading image ${srcUrl}`);\n  let resolved = false;\n  return new Promise((resolve) => {\n    const image = new Image();\n    image.addEventListener('load', () => {\n      LOG.debug(`Image ${srcUrl} loaded.`);\n      if (!resolved) {\n        resolve(image);\n      }\n    });\n    image.src = srcUrl;\n    if (image.complete) {\n      LOG.debug(`Image ${srcUrl} already loaded; possibly cached.`);\n      resolved = true; // event handler shouldn't fire but just in case :)\n      resolve(image);\n    }\n  });\n}\n\n/**\n * Load a number of images\n * @param {URL[]} srcUrls - array of source URLs\n * @returns {Promise} fulfils to @type {Image[]}.\n */\nfunction loadImages(srcUrls) {\n  const promises = [];\n  srcUrls.forEach((url) => promises.push(loadImage(url)));\n  return Promise.all(promises);\n}\n\n/**\n * Load sprite map.\n * @param {Object} spriteMapDef Sprite map definition from TexturePacker Array JSON file without multipack\n * @param {URL} textureUrl\n * @returns {Promise} fulfils to array of sprite map keys\n */\nfunction loadSpriteMap(spriteMapDef, textureUrl) {\n  LOG.debug(`Loading sprite map.`);\n  return loadImage(textureUrl).then((image) =>\n    buildSpriteMap(spriteMapDef, image)\n  );\n}\n\n/**\n * Build the sprite map\n * @param {Object} spriteMapDef - map definition from texture mapper. Array JSON no multi pack.\n * @param {Image} texture - images providing texture for sprite map.\n * @returns {Promise} fulfils to array of sprite map keys.\n */\nfunction buildSpriteMap(spriteMapDef, texture) {\n  const promises = [];\n  spriteMapDef.frames.forEach((frame) => {\n    promises.push(\n      createImageBitmap(\n        texture,\n        frame.frame.x,\n        frame.frame.y,\n        frame.frame.w,\n        frame.frame.h\n      ).then((spriteImage) => {\n        const spriteBitmap = {\n          filename: frame.filename,\n          image: spriteImage,\n          width: frame.frame.w,\n          height: frame.frame.h,\n          centreX: frame.sourceSize.w / 2 - frame.spriteSourceSize.x,\n          centreY: frame.sourceSize.h / 2 - frame.spriteSourceSize.y,\n        };\n        spriteMap.set(frame.filename, spriteBitmap);\n        return frame.filename;\n      })\n    );\n  });\n\n  return Promise.all(promises);\n}\n\n/**\n * @param {string} filename\n * @param {Object} options\n * @param {string} options.fallback - image name to use if not found.\n * @param {boolean} options.quiet - if true, no message is logged if image not found.\n * @returns {SpriteBitmap} null if filename not found.\n */\nfunction getSpriteBitmap(filename, options) {\n  let result = spriteMap.get(filename);\n  if (!result && !options?.quiet) {\n    LOG.debug(`Failed to find image ${filename}.`);\n  }\n  if (!result && options?.fallback) {\n    result = spriteMap.get(options.fallback);\n    if (!result) {\n      LOG.debug(`Failed to find fallback image ${options.fallback}.`);\n    }\n  }\n  return result;\n}\n\n/**\n * Get image for an undefined bitmap\n * @returns {SpriteBitmap} null if filename not found.\n */\nfunction getUndefinedBitmap() {\n  return spriteMap.get('undefined.png');\n}\n\n/**\n * Singleton image manager.\n */\nconst IMAGE_MANAGER = {\n  getSpriteBitmap: getSpriteBitmap,\n  getUndefinedBitmap: getUndefinedBitmap,\n  loadImage: loadImage,\n  loadImages: loadImages,\n  loadSpriteMap: loadSpriteMap,\n};\n\nexport default IMAGE_MANAGER;\n","/**\n * @file Time utilities. Two clocks exist in the games: real and turn based.\n *\n * @module utils/time/clock\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * @type {DOMHighResTimeStamp}\n */\nlet currentTimeMs = 0;\n\n/**\n * @param {DOMHighResTimeStamp} timeNowMs\n */\nfunction updateTimeNow(timeNowMs) {\n  currentTimeMs = timeNowMs;\n}\n\n/**\n * Get a frame counter.\n * @param {number} framePeriodMs - time between frames\n * @param {number} [timeOffsetMs = 0] - offset to allow some randomisation\n * @returns {number}\n */\nfunction getFrameCount(framePeriodMs, timeOffsetMs = 0) {\n  return Math.floor((currentTimeMs + timeOffsetMs) / framePeriodMs);\n}\n\n/**\n *  Game clock as singleton.\n */\nconst GAME_CLOCK = {\n  updateTimeNow: updateTimeNow,\n  getFrameCount: getFrameCount,\n};\n\nexport default GAME_CLOCK;\n","/**\n * @file Simple indexer for arrays.\n *\n * @module utils/arrays/indexer\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as maths from '../maths.js';\n\n/**\n * Looping methods\n * @enum {number}\n */\nexport const LoopMethod = {\n  WRAP: 0,\n  REVERSE: 1,\n  STOP: 2,\n};\n\n/**\n * Class to handle indexing through arrays. This allows an index to be incremented\n * so that it wraps at the end for a circular buffer, reverses for an oscillating\n * index or just stops at the end.\n */\nexport class Indexer {\n  /** @type {number} */\n  #length;\n  /** @type {number} */\n  #maxIndex;\n  /** @type {number} */\n  #loopMethod;\n  /** @type {number} */\n  #direction;\n  /** @type {number} */\n  #index;\n\n  /**\n   * @param {number} length\n   * @param {LoopMethod} loopMethod\n   */\n  constructor(length, loopMethod) {\n    this.#length = length;\n    this.#maxIndex = length - 1;\n    this.#loopMethod = loopMethod;\n    this.#direction = 1;\n    this.#index = 0;\n  }\n\n  /**\n   * Get current index.\n   */\n  get index() {\n    return this.#index;\n  }\n\n  /**\n   * Set current index. This will be clipped to a valid value.\n   */\n  set index(value) {\n    this.#index = maths.clip(value, 0, this.#length - 1);\n  }\n\n  /** Advance to the index.\n   * @param {number} distance - amount to move. This should be positive.\n   * @returns {number} the new index\n   */\n  advanceBy(distance) {\n    if (this.#length < 1) {\n      return this.#index;\n    }\n    switch (this.#loopMethod) {\n      case LoopMethod.WRAP:\n        return this.#advanceByWrap(distance);\n      case LoopMethod.REVERSE:\n        return this.#advanceByReverse(distance);\n      case LoopMethod.NONE:\n      default:\n        return this.#advanceByStop(distance);\n    }\n  }\n\n  /** Advance the index by distance. The direction is maintained by the indexer\n   * itself. Wrap at ends.\n   * @param {number} distance - amount to move. This should be positive.\n   * @returns {number} the new index\n   */\n  #advanceByWrap(distance) {\n    distance = distance % this.#length;\n    this.#index += distance % this.#length;\n    if (this.#index >= this.#length) {\n      this.#index = this.#index - this.#length;\n    }\n    return this.#index;\n  }\n\n  /** Advance the index by distance. The direction is maintained by the indexer\n   * itself. Reverse at ends.\n   * @param {number} distance - amount to move. This should be positive.\n   * @returns {number} the new index\n   */\n  #advanceByReverse(distance) {\n    const nFullTraversals = Math.floor(distance / this.#length);\n    if (nFullTraversals % 2) {\n      this.#direction = -this.#direction; // odd so reversing\n    }\n    distance = distance % this.#length;\n    if (this.#direction > 0) {\n      this.#index += distance;\n      const overshoot = this.#index - this.#maxIndex;\n      if (overshoot > 0) {\n        this.#index = this.#maxIndex - overshoot;\n        this.#direction = -1;\n      }\n    } else if (this.#direction < 0) {\n      this.#index -= distance;\n      if (this.#index < 0) {\n        this.#index = -this.#index;\n        this.#direction = 1;\n      }\n    }\n    return this.#index;\n  }\n\n  /** Advance the index by distance. The direction is maintained by the indexer\n   * itself. Stop at ends.\n   * @param {number} distance - amount to move. This should be positive.\n   * @returns {number} the new index\n   */\n  #advanceByStop(distance) {\n    if (this.#direction > 0) {\n      this.#index = Math.min(this.#maxIndex, this.#index + distance);\n    } else if (this.#direction < 0) {\n      this.#index = Math.max(0, this.#index - distance);\n    }\n    return this.#index;\n  }\n}\n","/**\n * @file Faders which adjust opacity\n *\n * @module utils/sprites/faders\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { AbstractModifier } from './modifiers.js';\n\n/**\n * Sprite fader\n */\nexport class TimeFader extends AbstractModifier {\n  /** @type {number} */\n  #deltaOpacityPerSec;\n  /** @type {number} */\n  #delaySecs;\n  /** @type {number} */\n  #elapsedSecs;\n  /** @type {number} */\n  #easeInDuration;\n\n  /**\n   * Create fader.\n   * @param {number} delaySecs - default alignment.\n   * @param {number} lifetimeSecs - default alignment.\n   * @param {AbstractModifier} decoratedModifier\n   */\n  constructor(delaySecs, lifetimeSecs, decoratedModifier) {\n    super(decoratedModifier);\n    this.#delaySecs = delaySecs;\n    this.#easeInDuration = 0.3 * lifetimeSecs;\n    const fadeOutDuration = lifetimeSecs - this.#easeInDuration;\n    this.#deltaOpacityPerSec = 1 / Math.max(fadeOutDuration, 0.5);\n    this.#elapsedSecs = -1; // only start counting after first update.\n  }\n\n  /**\n   * Adjust sprite opacity depending on time. When the time is complete, this\n   * modify returns null to indicate completion.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time\n   * @returns {AbstractModifier}\n   */\n  doUpdate(sprite, deltaSeconds) {\n    if (this.#elapsedSecs < 0) {\n      this.#elapsedSecs = 0; // only start on first update.\n    } else {\n      this.#elapsedSecs += deltaSeconds;\n    }\n\n    if (this.#elapsedSecs > this.#delaySecs + this.#easeInDuration) {\n      sprite.opacity = Math.max(\n        0,\n        1 -\n          (this.#elapsedSecs - this.#delaySecs - this.#easeInDuration) *\n            this.#deltaOpacityPerSec\n      );\n    } else {\n      sprite.opacity = 1;\n    }\n    return sprite.opacity > 0 ? this : null;\n  }\n}\n","/**\n * @file Modifiers for updates\n *\n * @module utils/sprites/modifiers\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport LOG from '../logging.js';\n\n/** Default timeout for transient modifiers. @type {number} */\nconst DEFAULT_TIMEOUT_SECS = 10;\n\n/**\n * Base for all modifiers\n */\nexport class AbstractModifier {\n  /** @type {AbstractModifier} */\n  decoratedModifier;\n  /** The resolve function for transient modifiers @type {function(*)} */\n  #resolveFunc;\n  /** Total active time in seconds */\n  #activeSeconds;\n  /** Timeout duration */\n  #timeoutSeconds;\n\n  /**\n   *\n   * @param {AbstractModifier} [decoratedModifier]\n   */\n  constructor(decoratedModifier) {\n    this.#activeSeconds = 0;\n    this.#timeoutSeconds = 0;\n    this.decoratedModifier = decoratedModifier;\n  }\n\n  /**\n   * Resolve any pending promise.\n   * @param {*} fulfilValue\n   */\n  #resolve(fulfilValue) {\n    if (this.#resolveFunc) {\n      this.#resolveFunc(fulfilValue);\n      this.#resolveFunc = null;\n    }\n  }\n\n  /**\n   * Kill this modifier. Resolves any pending promises.\n   */\n  kill() {\n    this.#resolve();\n  }\n\n  /**\n   * Perform any cleanup if timeout occurs.\n   * Should be overridden if cleanup necessary. Default does nothing.\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   */\n  cleanUpOnTimeout(spriteUnused) {}\n\n  /**\n   * Apply the modifier as transient to a sprite.\n   * @param {AbstractModifier} modifier\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   * @param {number} [timeoutSeconds = DEFAULT_TIMEOUT_SECS]\n   * @returns {Promise} fulfils to null on completion;\n   */\n  applyAsTransientToSprite(sprite, timeoutSeconds = DEFAULT_TIMEOUT_SECS) {\n    this.#timeoutSeconds = timeoutSeconds;\n    return new Promise((resolve) => {\n      this.#resolveFunc = resolve;\n      sprite.replaceTransientModifier(this);\n    });\n  }\n\n  /**\n   * Apply the modifier as continuous to a sprite.\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   */\n  applyAsContinuousToSprite(sprite) {\n    sprite.replaceBaseModifier(this);\n  }\n\n  /** Do the update modification. If a decoratedModifier has been set, this is then\n   * called. If after calling update, the modifier is removed, it is removed from\n   * the owning decoratedModifier. Its children are retained.\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time since last update.\n   * @returns {AbstractModifier} - the modifier required for the next update. This\n   * normally returns itself. If null is return, this indicates that the modifier\n   * has completed its action and can be removed from the chain of decorated\n   * modifiers. This method handles removal of its own decoratedModifier, but removal\n   * of the root, if appropriate, is the responsibility of the Sprite.\n   */\n  update(sprite, deltaSeconds) {\n    if (this.#resolveFunc) {\n      this.#activeSeconds += deltaSeconds;\n    }\n    if (this.decoratedModifier) {\n      this.decoratedModifier = this.decoratedModifier?.update(\n        sprite,\n        deltaSeconds\n      );\n    }\n\n    let nextModifier = this.doUpdate(sprite, deltaSeconds);\n    if (this.#activeSeconds > this.#timeoutSeconds) {\n      this.cleanUpOnTimeout(sprite);\n      nextModifier = null; // end this\n    }\n    if (!nextModifier) {\n      this.#resolve(null);\n      return null;\n    }\n    return nextModifier;\n  }\n\n  /** Do the update modification for this modifier.\n   * @param {module:utils/sprites/sprites.Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time since last update.\n   * @returns {AbstractModifier} - the modifier for the next update.\n   */\n  doUpdate(spriteUnused, deltaSecondsUnused) {\n    LOG.error('doUpdate should be overridden.');\n    return this;\n  }\n}\n","/**\n * @file Movers for sprites\n *\n * @module utils/sprites/movers\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { AbstractModifier } from './modifiers.js';\nimport LOG from '../logging.js';\n\nclass VariableSpeed {\n  /** @type {number} */\n  #speed;\n  /** @type {boolean} */\n  #linear;\n\n  /** Create variable speed.\n   * @param {number} speed - base speed.\n   * @param {boolean} linear - true if speed constant, otherwise speed faster if\n   * further away.\n   */\n  constructor(speed, linear) {\n    this.#speed = speed;\n    this.#linear = linear;\n  }\n\n  /**\n   * Get speed to move between points.\n   * @param {Point} pointA\n   * @param {Point} pointB\n   * @returns {number}\n   */\n  getSpeedBetweenPoints(pointA, pointB) {\n    if (this.#linear) {\n      return this.#speed;\n    } else {\n      const separation =\n        Math.abs(pointA.x - pointB.x) + Math.abs(pointA.y - pointB.y);\n      return (1 + 0.1 * separation) * this.#speed;\n    }\n  }\n}\n/**\n * Simple unbounded velocity mover\n */\nexport class VelocityMover extends AbstractModifier {\n  /** @type {module:utils/geometry~Point} */\n  #topLeft;\n  /** @type {module:utils/geometry~Point} */\n  #bottomRight;\n\n  /**\n   * @param {AbstractModifier} decoratedModifier\n   */\n  constructor(decoratedModifier) {\n    super(decoratedModifier);\n  }\n\n  /**\n   * Move sprite using its velocity and acceleration\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time\n   * @returns {AbstractModifier}\n   */\n  doUpdate(sprite, deltaSeconds) {\n    sprite.position.x += sprite.velocity.x * deltaSeconds;\n    sprite.position.y += sprite.velocity.y * deltaSeconds;\n    sprite.position.rotation += sprite.velocity.rotation * deltaSeconds;\n    if (sprite.acceleration) {\n      sprite.velocity.x += sprite.acceleration.x * deltaSeconds;\n      sprite.velocity.y += sprite.acceleration.y * deltaSeconds;\n      sprite.velocity.rotation += sprite.acceleration.rotation * deltaSeconds;\n    }\n    return this;\n  }\n}\n\n/**\n * Velocity aligner\n */\nexport class VelocityAligner extends AbstractModifier {\n  /** @type {number} */\n  #baseDirection;\n\n  /**\n   * Construct aligner. Rotations are worked out counter clockwise from the positive\n   * x axis direction. However, sprites are normally drawn vertically as you look at them;\n   * i.e they are pointing downwards or at -90 degrees from the horizontal axis. You can\n   * set this using the baseDirection parameter.\n   * @param {number} baseDirection - default alignment.\n   * @param {AbstractModifier} decoratedModifier\n   */\n  constructor(baseDirection = -Math.PI / 2, decoratedModifier) {\n    super(decoratedModifier);\n    this.#baseDirection = baseDirection;\n  }\n\n  /**\n   * Create a VelocityAligner. This is a convenience factory method that automatically\n   * sets the base direction to -90 degrees which is how sprites are normally drawn; i.e. upright\n   * instead of horizontally.\n   * @param {AbstractModifier} decoratedModifier\n   * @returns {VelocityAligner}\n   */\n  static createUprightAligner(decoratedModifier) {\n    return new VelocityAligner(-Math.PI / 2, decoratedModifier);\n  }\n\n  /**\n   * Align sprite using its velocity.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time\n   * @returns {AbstractModifier}\n   */\n  doUpdate(sprite, deltaSecondsIgnored) {\n    sprite.position.rotation = sprite.velocity.isZero(0.1)\n      ? 0\n      : sprite.velocity.getScreenDirection() - this.#baseDirection;\n\n    return this;\n  }\n}\n/**\n * Bouncer mover\n */\nexport class Bouncer extends AbstractModifier {\n  /** @type {module:utils/geometry~Point} */\n  #topLeft;\n  /** @type {module:utils/geometry~Point} */\n  #bottomRight;\n\n  /**\n   * @param {module:utils/geometry~Rectangle} bounds\n   * @param {AbstractModifier} decoratedModifier\n   */\n  constructor(bounds, decoratedModifier) {\n    super(decoratedModifier);\n    this.#topLeft = bounds.getTopLeft();\n    this.#bottomRight = bounds.getBottomRight();\n  }\n\n  /**\n   * Move sprite using its velocity and bouncing on screen.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @param {number} deltaSeconds - elapsed time\n   * @returns {AbstractModifier}\n   */\n  doUpdate(sprite, deltaSeconds) {\n    const position = sprite.position;\n    const velocity = sprite.velocity;\n\n    position.x += velocity.x * deltaSeconds;\n    position.y += velocity.y * deltaSeconds;\n    position.rotation += velocity.rotation * deltaSeconds;\n    if (position.x < this.#topLeft.x || position.x > this.#bottomRight.x) {\n      velocity.x *= -1;\n    }\n    if (position.y < this.#topLeft.y || position.y > this.#bottomRight.y) {\n      velocity.y *= -1;\n    }\n\n    sprite.position = position;\n    sprite.velocity = velocity;\n    return this;\n  }\n}\n\n/**\n * Tracker mover.\n */\nexport class Tracker extends AbstractModifier {\n  /** @type {module:utils/sprites/sprite~Sprite} */\n  #prey;\n  /** @type {number} */\n  #maxSeparation;\n  /** @type {number} */\n  #variableSpeed;\n\n  /**\n   *\n   * @param {Object} options\n   * @param {module:utils/sprites/sprite~Sprite} options.prey\n   * @param {number} options.maxSeparation - allowable distance between hunter and prey\n   * @param {number} options.speed - pixels / second\n   * @param {boolean} options.linear - if linear the speed is constant, otherwise it speeds up if further away\n   * @param {AbstractModifier} decoratedModifier\n   */\n  constructor(options, decoratedModifier) {\n    super(decoratedModifier);\n    this.#prey = options.prey;\n    this.#maxSeparation = options.maxSeparation;\n    this.#variableSpeed = new VariableSpeed(options.speed, options.linear);\n  }\n\n  /**\n   * Update the sprite to track the hunter.\n   * @param {module:utils/sprites/sprite~Sprite} hunter\n   * @param {*} deltaSeconds\n   * @returns {AbstractModifier}\n   */\n  doUpdate(hunter, deltaSeconds) {\n    const preyPos = this.#prey.position;\n    const hunterPos = hunter.position;\n    const approachSpeed = this.#variableSpeed.getSpeedBetweenPoints(\n      preyPos,\n      hunterPos\n    );\n\n    if (!hunterPos.withinSquare(preyPos, this.#maxSeparation)) {\n      const angle = hunterPos.getCartesianAngleTo(preyPos);\n      hunter.velocity.x = approachSpeed * Math.cos(angle);\n      hunter.velocity.y = approachSpeed * Math.sin(angle);\n      const dx = hunter.velocity.x * deltaSeconds;\n      const dy = hunter.velocity.y * deltaSeconds;\n      hunter.position.x += this.getMinMove(dx, preyPos.x, hunterPos.x);\n      hunter.position.y += this.getMinMove(dy, preyPos.y, hunterPos.y);\n    }\n    return this;\n  }\n\n  /**\n   * Get the minimum movement to go from targetValue to currentValue.\n   * @param {number} maxMovement - maximum movement. NB. In this context, max ignores sign.\n   * @param {number} targetValue\n   * @param {number} currentValue\n   */\n  getMinMove(maxMovement, targetValue, currentValue) {\n    const requiredMovement = targetValue - currentValue;\n    if (Math.sign(maxMovement) < 0) {\n      return Math.max(maxMovement, requiredMovement);\n    } else {\n      return Math.min(maxMovement, requiredMovement);\n    }\n  }\n}\n\n/**\n * PathFollower. Provides a one-off movement.\n * Once it hits its target, it removes itself from the chain.\n */\nexport class PathFollower extends AbstractModifier {\n  /** @type {Point[]} */\n  #path;\n  /** @type {number} */\n  #index;\n  /** @type {module:utils/geometry~Point} */\n  #targetPoint;\n  /** @type {VariableSpeed} */\n  #variableSpeed;\n  /**\n   *\n   * @param {Object} options\n   * @param {Point[]} options.path\n   * @param {number} options.speed - pixels / second\n   * @param {boolean} options.linear - if linear the speed is constant, otherwise it speeds up if further away\n   * @param {AbstractModifier} decoratedModifier\n   */\n  constructor(options, decoratedModifier) {\n    super(decoratedModifier);\n    this.#path = options.path;\n    this.#index = 0;\n    this.#targetPoint = options.path[0];\n    this.#variableSpeed = new VariableSpeed(options.speed, options.linear);\n  }\n\n  /**\n   * Perform any cleanup if timeout occurs.\n   * Should be overridden if cleanup necessary. Default does nothing.\n   * @param {module:utils/sprites/sprite~Sprite} sprite\n   * @override\n   */\n  cleanUpOnTimeout(sprite) {\n    // move to the end of the path.\n    LOG.debug(`Transient path follower timed out. Moving to end of path.`);\n    const lastPoint = this.#path[this.#path.length - 1];\n    sprite.position.x = lastPoint.x;\n    sprite.position.y = lastPoint.y;\n    sprite.velocity.x = 0;\n    sprite.velocity.y = 0;\n  }\n\n  /**\n   * Update the sprite to track the hunter.\n   * @param {module:utils/sprites/sprite~Sprite} subject\n   * @param {*} deltaSeconds\n   * @returns {AbstractModifier}\n   */\n  doUpdate(subject, deltaSeconds) {\n    const subjectPos = subject.position;\n    const approachSpeed = this.#variableSpeed.getSpeedBetweenPoints(\n      this.#targetPoint,\n      subjectPos\n    );\n    const angle = subjectPos.getCartesianAngleTo(this.#targetPoint);\n    subject.velocity.x = approachSpeed * Math.cos(angle);\n    subject.velocity.y = approachSpeed * Math.sin(angle);\n    const dx = subject.velocity.x * deltaSeconds;\n    const dy = subject.velocity.y * deltaSeconds;\n    subjectPos.x += this.getMinMove(dx, this.#targetPoint.x, subjectPos.x);\n    subjectPos.y += this.getMinMove(dy, this.#targetPoint.y, subjectPos.y);\n    if (subjectPos.isCoincident(this.#targetPoint)) {\n      if (++this.#index >= this.#path.length) {\n        subject.velocity.x = 0;\n        subject.velocity.y = 0;\n        return this.decoratedModifier; // Remove itself from chain\n      } else {\n        this.#targetPoint = this.#path[this.#index];\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Get the minimum movement to go from targetValue to currentValue.\n   * @param {number} maxMovement - maximum movement. NB. In this context, max ignores sign.\n   * @param {number} targetValue\n   * @param {number} currentValue\n   */\n  getMinMove(maxMovement, targetValue, currentValue) {\n    const requiredMovement = targetValue - currentValue;\n    if (Math.sign(maxMovement) < 0) {\n      return Math.max(maxMovement, requiredMovement);\n    } else {\n      return Math.min(maxMovement, requiredMovement);\n    }\n  }\n}\n\n/**\n * Move the actor to the position. This ignores any restriction and moves in\n * a straight line.\n * @param {module:players/actors.Actor} actor\n * @param {module:utils/geometry~Position} position\n * @returns {Promise} fulfils to undefined on completion of move.\n */\nexport function moveActorToPosition(actor, position) {\n  const pathModifier = new PathFollower(\n    {\n      path: [position],\n      speed: 100,\n    },\n    actor.sprite.modifier\n  );\n  return pathModifier.applyAsTransientToSprite(actor.sprite);\n}\n","/**\n * @file Dialogs for use in the game\n *\n * @module utils/dom/ui\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport SCREEN from '../game/screen.js';\nimport * as components from './components.js';\nimport { i18n } from '../messageManager.js';\nimport ANIMATION_STATE_MANAGER from '../../gameManagement/animationState.js';\n\n/**\n * Dialog response codes.\n */\nexport const DialogResponse = {\n  OK: 0,\n  CANCEL: 1,\n  YES: 2,\n  NO: 3,\n};\n\n/**\n * Called when a dialog is opened.\n */\nfunction prepareDialog() {\n  ANIMATION_STATE_MANAGER.setAnimationState(false);\n}\n\n/**\n * Called when a dialog is closed.\n */\nfunction tearDownDialog() {\n  ANIMATION_STATE_MANAGER.setAnimationState(true);\n}\n\n/**\n * Wrapper for SCREEN.displayOnGlass but calling tearDownDialog at end.\n * @param {HTMLElement} element\n * @param {Object} options\n * @param {Closers[]} options.closers - array of Closers. If not provided then the entire display\n * is used.\n * @param {string} options.className\n * @param {boolean} options.replace - replace current glass\n * @returns {Promise} fulfils to closers.closes value\n */\nfunction displayOnGlass(element, options) {\n  return SCREEN.displayOnGlass(element, options).then((response) => {\n    tearDownDialog();\n    return response;\n  });\n}\n/**\n * Get a message element. This returns a div which contains the message text.\n * @param {string | string[]} message\n * @param {string} title\n */\nfunction createMessageElement(message, title) {\n  const element = components.createElement('div', {\n    className: 'dialog-scroll-content',\n  });\n  if (title) {\n    element.appendChild(\n      components.createElement('p', { className: 'dialog-title', text: title })\n    );\n  }\n  if (Array.isArray(message)) {\n    for (const paragraph of message) {\n      element.appendChild(createMessageElement(paragraph));\n    }\n  } else {\n    element.appendChild(components.createElement('p', { text: message }));\n  }\n  element.classList.add(['scrollable']);\n  return element;\n}\n\n/** Create a message that is removed on any click. This sits above everything\n * as a self contained popup.\n * @param {string} message - message for the message manager.\n */\nfunction showMessage(message) {\n  const popup = document.createElement('div');\n  popup.appendChild(document.createTextNode(message));\n  popup.className = 'popup';\n  popup.style.opacity = 1;\n  document.body.appendChild(popup);\n  popup.addEventListener('click', () => popup.remove());\n}\n\n/**\n * Displays a popup element. A background glass layer is shown behind the popup\n * This is displayed in a similar way to showMessage but with the difference that\n * no event listener is added to close the popup. This is the responsibility of\n * the caller who should use the returned element to close it.\n * @param {Element} element\n * @returns {Element} the popup element.\n */\nfunction popupElement(element) {\n  const popup = document.createElement('div');\n  popup.className = 'popup';\n  const popupInner = document.createElement('div');\n  popup.appendChild(popupInner);\n  popupInner.appendChild(element);\n  popup.style.opacity = 1;\n  document.body.appendChild(popup);\n  return popup;\n}\n\n/** Create an okDialog.\n * @param {string | string[]} message\n * @param {Object} [options = {}]\n * @param {string} [options.okButtonLabel = i18n`BUTTON OK`]\n * @param {string} options.className\n * @param {string} options.title\n * @returns {Promise} fulfils to DialogResponse.OK\n */\nfunction showOkDialog(message, options = {}) {\n  prepareDialog();\n  const container = document.createElement('div');\n  container.appendChild(createMessageElement(message, options.title));\n  const buttonEl = document.createElement('button');\n  buttonEl.appendChild(\n    document.createTextNode(options.okButtonLabel ?? i18n`BUTTON OK`)\n  );\n  container.appendChild(buttonEl);\n  return displayOnGlass(container, {\n    className: options?.className,\n    closers: [\n      {\n        element: buttonEl,\n        closes: DialogResponse.OK,\n      },\n    ],\n  });\n}\n\n/**\n * Create a choice dialog.\n * @param {string} title\n * @param {string | Element} message\n * @param {string[]} choices - labels for buttons.\n * @param {string} className - class name for the dialog.\n * @returns {number} index of selected button.\n */\nfunction showChoiceDialog(title, message, choices, className) {\n  const container = document.createElement('div');\n  container.appendChild(createMessageElement(message, title));\n  const actionButtons = [];\n  choices?.forEach((choice, index) => {\n    const button = new components.TextButtonControl({\n      label: choice,\n      closes: index,\n    });\n    actionButtons.push(button);\n  });\n  return showControlsDialog(message, {\n    preamble: title,\n    actionButtons: actionButtons,\n    row: true,\n    className: className,\n  });\n}\n\n/** Create an ok Dialog but just showing a precreate element.\n * @param {string} title\n * @param {Element} element\n * @param {string} [okButtonLabel = 'BUTTON OK']\n * @param {string} className\n * @returns {Promise} fulfils to DialogResponse.OK\n */\nfunction showElementOkDialog(\n  title,\n  element,\n  okButtonLabel = i18n`BUTTON OK`,\n  className\n) {\n  prepareDialog();\n  const container = document.createElement('div');\n  const scrollContainer = components.createElement('div', {\n    className: 'dialog-scroll-content',\n  });\n  container.appendChild(scrollContainer);\n  if (title) {\n    scrollContainer.appendChild(\n      components.createElement('p', { className: 'dialog-title', text: title })\n    );\n  }\n  scrollContainer.appendChild(element);\n  const buttonEl = document.createElement('button');\n  buttonEl.appendChild(document.createTextNode(okButtonLabel));\n  container.appendChild(buttonEl);\n\n  return displayOnGlass(container, {\n    closers: [\n      {\n        element: buttonEl,\n        closes: DialogResponse.OK,\n      },\n    ],\n    className: className,\n  });\n}\n\n/** Create a controls dialog.\n * @param {string | Element} mainContent -message or element to show..\n * @param {Object} options\n * @param {Object} options.title - title\n * @param {string | Element} options.preamble - text placed before content..\n * @param {BaseControl[]} options.actionButtons\n * @param {boolean} options.row - if true, controls are in a row rather than the\n * default column.\n * @param {string} options.className\n * @param {string} options.okButtonLabel\n * @returns {Promise} fulfils to closures response value or DialogResponse.OK if\n * no closers.\n */\nfunction showControlsDialog(mainContent, options = {}) {\n  prepareDialog();\n  const container = document.createElement('div');\n  const scrollContainer = components.createElement('div', {\n    className: 'dialog-scroll-content',\n  });\n  container.appendChild(scrollContainer);\n  if (options.title) {\n    scrollContainer.appendChild(\n      components.createElement('p', {\n        className: 'dialog-title',\n        text: options.title,\n      })\n    );\n  }\n  if (options.preamble) {\n    if (options.preamble instanceof Element) {\n      scrollContainer.appendChild(options.preamble);\n    } else {\n      scrollContainer.appendChild(\n        components.createElement('p', { text: options.preamble })\n      );\n    }\n  }\n  if (mainContent instanceof Element) {\n    scrollContainer.appendChild(mainContent);\n  } else {\n    scrollContainer.appendChild(createMessageElement(mainContent));\n  }\n  const actionButtons = components.createElement('div', {\n    className: options.row ? 'action-buttons-row' : 'action-buttons-col',\n  });\n  container.appendChild(actionButtons);\n  const closers = [];\n  options?.actionButtons?.forEach((button) => {\n    if (!button.element.parentElement) {\n      actionButtons.appendChild(button.element);\n    }\n    if (button.closes !== null && button.closes !== undefined) {\n      closers.push({\n        element: button.element,\n        closes: button.closes,\n      });\n    }\n  });\n  if (closers.length === 0) {\n    const okButton = new components.TextButtonControl({\n      id: DialogResponse.OK,\n      label: options.okButtonLabel ?? i18n`BUTTON OK`,\n    });\n    actionButtons.appendChild(okButton.element);\n    closers.push(okButton);\n  }\n  return displayOnGlass(container, {\n    closers: closers,\n    className: options?.className,\n  });\n}\n\n/**\n * The UI singleton.\n */\nconst UI = {\n  popupElement: popupElement,\n  showChoiceDialog: showChoiceDialog,\n  showMessage: showMessage,\n  showOkDialog: showOkDialog,\n  showElementOkDialog: showElementOkDialog,\n  showControlsDialog: showControlsDialog,\n};\n\nexport default UI;\n","/**\n * @file Classes for managing menus.\n *\n * @module utils/dom/menu\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport IMAGE_MANAGER from '../sprites/imageManager.js';\nimport GameConstants from '../game/gameConstants.js';\nimport PERSISTENT_DATA from '../persistentData.js';\n\n/**\n * Base control\n */\nclass BaseControl {\n  /**\n   * @type {string}\n   */\n  #id;\n  /**\n   * @type {Element}\n   */\n  _element;\n\n  /** @type {*} */\n  #value;\n\n  /** @type {boolean} */\n  #persistent;\n\n  /** @type {boolean} */\n  closes;\n\n  /**\n   * Create base control\n   * @param {Object} options\n   * @param {boolean} options.persistent - is data stored in persistent storage.\n   * @param {*} options.defValue - default value\n   * @param {boolean} options.closes - flag to indicate whether this control should be used\n   * to close a dialog or form when clicked.\n   */\n  constructor(options) {\n    if (options.closes && options.action) {\n      throw new Error(\n        `Attempt made to create control that is set to close forms and perform and action. These are mutually exclusive.`\n      );\n    }\n    if (options.persistent && !options.id) {\n      throw new Error(\n        'Persistent controls must have an ID set in the options.'\n      );\n    }\n    this.#id = options.id;\n    this.#persistent = options.persistent;\n    if (options.persistent) {\n      this.#value = PERSISTENT_DATA.get(this.#id, options.defValue);\n    } else {\n      this.#value = options.defValue;\n    }\n    this.closes = options.closes;\n    this.listeners = 0;\n  }\n\n  /**\n   * Get the underlying element\n   * @returns {Element}\n   */\n  get element() {\n    return this._element;\n  }\n\n  /**\n   *\n   * @returns {*}\n   */\n  get value() {\n    return this.#value;\n  }\n\n  /**\n   * Set the value.\n   * @param {*} value\n   */\n  set value(value) {\n    if (value === this.#value) {\n      return;\n    }\n    if (this.#persistent) {\n      PERSISTENT_DATA.set(this.#id, value);\n    }\n    this.#value = value;\n  }\n}\n\n/**\n * Text button\n */\nexport class TextButtonControl extends BaseControl {\n  /** Create the button.\n   * @param {Object} options - see BaseControl plus\n   * @param {string} options.label\n   * @param {function():Promise} options.action - function called on click.\n   */\n  constructor(options) {\n    super(options);\n    this._element = this.buildElement(options);\n    if (options.action) {\n      this._element.addEventListener('click', () => options.action());\n    }\n  }\n\n  /**\n   * @param {Object} options - see Constructor.\n   * @returns {Element}\n   */\n  buildElement(options) {\n    const element = document.createElement('button');\n    element.appendChild(document.createTextNode(options.label));\n    element.className = 'text-button';\n    return element;\n  }\n}\n\n/**\n * Text button\n */\nexport class BitmapButtonControl extends BaseControl {\n  /** Create the button.\n   * @param {Object} options - see BaseControl. Plus\n   * @param {string} options.leftLabel\n   * @param {string} options.rightLabel\n   * @param {function():Promise} options.action - function called on click.\n   * @param {string} imageName\n   */\n  constructor(options) {\n    super(options);\n    this._element = this.buildElement(options);\n    if (options.action) {\n      this._element.addEventListener('click', () => options.action());\n    }\n  }\n\n  /**\n   * @param {Object} options - see Constructor.\n   * @returns {Element}\n   */\n  buildElement(options) {\n    const element = document.createElement('button');\n    if (options.leftLabel) {\n      element.appendChild(document.createTextNode(options.leftLabel));\n    }\n    element.appendChild(createBitmapElement(options.imageName, 'button-icon'));\n    if (options.rightLabel) {\n      element.appendChild(document.createTextNode(options.rightLabel));\n    }\n    element.className = 'icon-button';\n    return element;\n  }\n}\n\n/**\n * Create a bitmap element\n * @param {string} imageName\n * @param {string} className\n * @returns {Element}\n */\n\nexport function createBitmapElement(imageName, className) {\n  const bitmapImage = IMAGE_MANAGER.getSpriteBitmap(\n    imageName ?? 'undefined.png',\n    { fallback: 'undefined.png' }\n  );\n  const canvas = document.createElement('canvas');\n  canvas.setAttribute('width', GameConstants.TILE_SIZE);\n  canvas.setAttribute('height', GameConstants.TILE_SIZE);\n  const context = canvas.getContext('2d');\n  context.clearRect(0, 0, GameConstants.TILE_SIZE, GameConstants.TILE_SIZE);\n  context.drawImage(\n    bitmapImage.image,\n    0.5 * (GameConstants.TILE_SIZE - bitmapImage.width),\n    0.5 * (GameConstants.TILE_SIZE - bitmapImage.height)\n  );\n  canvas.className = className;\n  return canvas;\n}\n\n/**\n * Create a checkbox control\n */\nclass CheckboxControl extends BaseControl {\n  /** @type {Element} */\n  #checkbox;\n\n  /**\n   * Create the CheckboxControl\n   * @param {ControlDefinition} options - see Base control plus\n   * @param {string} options.label\n   */\n  constructor(options) {\n    super(options);\n    this._element = this.buildElement(options.label);\n    this.#checkbox.checked = this.value;\n    this._element.addEventListener('change', (eventUnused) => {\n      this.value = this.#checkbox.checked;\n      if (options.onChange) {\n        options.onChange(this.value);\n      }\n    });\n  }\n\n  /**\n   * Build the element\n   * @param {string} label\n   * @returns {Element}\n   */\n  buildElement(label) {\n    const checkboxContainer = document.createElement('span');\n    checkboxContainer.className = 'styled-checkbox';\n    this.#checkbox = document.createElement('input');\n    this.#checkbox.setAttribute('type', 'checkbox');\n    checkboxContainer.appendChild(this.#checkbox);\n    checkboxContainer.appendChild(\n      createBitmapElement('ui-checkbox00.png', 'unchecked')\n    );\n    checkboxContainer.appendChild(\n      createBitmapElement('ui-checkbox01.png', 'checked')\n    );\n    const element = document.createElement('label');\n    element.appendChild(document.createTextNode(label));\n    element.appendChild(checkboxContainer);\n    return element;\n  }\n}\n\n/**\n * Range control\n */\nexport class RangeControl extends BaseControl {\n  /** @type {Element} */\n  #rangeInput;\n\n  /**\n   * Create the RangeControl\n   * @param {ControlDefinition} options - see BaseControl plus\n   * @param {string} options.label\n   */\n  constructor(options) {\n    super(options);\n    this._element = this.buildElement(options.label);\n    this.#rangeInput.value = this.value;\n    this._element.addEventListener('change', (eventUnused) => {\n      this.value = this.#rangeInput.value;\n      if (options.onChange) {\n        options.onChange(this.value);\n      }\n    });\n  }\n\n  /**\n   * Build the element\n   * @param {string} label\n   * @returns {Element}\n   */\n  buildElement(label) {\n    const rangeContainer = document.createElement('span');\n    rangeContainer.className = 'styled-range';\n    this.#rangeInput = document.createElement('input');\n    this.#rangeInput.setAttribute('type', 'range');\n    rangeContainer.appendChild(this.#rangeInput);\n    const element = document.createElement('label');\n    element.appendChild(document.createTextNode(label));\n    element.appendChild(rangeContainer);\n    return element;\n  }\n}\n/**\n * Control UI types.\n * @enum {string}\n */\nexport const ControlType = {\n  TEXT_BUTTON: 'text button',\n  CHECKBOX: 'checkbox',\n  RANGE: 'range',\n};\n\n/**\n * @typedef {Object} ControlDefinition\n * @param {string} key - identification for the control. Used as a key for storage.\n * @param {string} label - text displayed on control\n * @param {*}   defValue - default value,\n * @param {ControlType} controlType - type of control required,\n * @param {boolean} persistent - whether the value is stored in persistent data.\n * @param {function(): Promise} action - action to perform when clicked.\n * @param {function()} onChange - action to perform when value changes.\n */\n\n/**\n * Create a control type.\n * @param {ControlDefinition} definition\n * @returns {BaseControl}\n */\nexport function createControl(definition) {\n  let control;\n  switch (definition.controlType) {\n    case ControlType.CHECKBOX:\n      control = new CheckboxControl(definition);\n      break;\n    case ControlType.RANGE:\n      control = new RangeControl(definition);\n      break;\n    case ControlType.TEXT_BUTTON:\n      control = new TextButtonControl(definition);\n      break;\n    default:\n      throw new Error(\n        `Attempt to create unrecognised control type ${definition.controlType}`\n      );\n  }\n  return control;\n}\n\n/**\n * Create an element.\n * @param {string} tagName\n * @param {Object} options\n * @param {string} options.className\n * @param {string} options.text\n * @param {string} options.html - has precedence over options.text.\n * @param {Element} options.child - appended after text or html.\n * @returns {Element}\n */\nexport function createElement(tagName, options = {}) {\n  const element = document.createElement(tagName);\n  if (options.className) {\n    element.className = options.className;\n  }\n  if (options.html) {\n    element.innerHTML = options.html;\n  } else if (options.text) {\n    element.innerText = options.text;\n  }\n  if (options.child) {\n    element.appendChild(options.child);\n  }\n  return element;\n}\n","/**\n * @file Game constants\n *\n * @module gameutils/gameConstants\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst GameConstants = {\n  TILE_SIZE: 48,\n};\n\nexport default GameConstants;\n","/**\n * @file Settings\n *\n * @module utils/persistenData\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from './logging.js';\nimport { simple32 } from './hashes.js';\n\n/**\n * @typedef {Object} ObjectJSON\n * @property {string} reviver - name of the reviver to be called.\n * @property {*} value - value to be passed to the reviver\n */\n\n/** Encapsulate storage. */\nclass PersistentData {\n  /** @type {Storage}   */\n  #storage;\n  /**\n   * Cached objects so they don't need to be reparsed.\n   * @type {Map<string, *>}\n   */\n  #cache;\n\n  /**\n   * Create persistent data object.\n   */\n  constructor() {\n    this.#storage = localStorage;\n    this.#cache = new Map();\n  }\n  /**\n   * Set value\n   * @param {string} key\n   * @param {*} value\n   */\n  set(key, value) {\n    this.#cache.set(key, value);\n    try {\n      this.#storage.setItem(key, this.toChecksummed(JSON.stringify(value)));\n    } catch (error) {\n      LOG.error(`Cannot save setting. ${error.message}`);\n    }\n  }\n\n  /**\n   * Get a value. Uses the cache if already set.\n   * @param {string} key\n   * @param {*} defaultValue\n   * @param {function(key,value)} reviver - reviver function for JSON.parse\n   * @returns {*} stored data or default value if not present or unparsable.\n   */\n  get(key, defaultValue, reviver) {\n    if (this.#cache.has(key)) {\n      return this.#cache.get(key);\n    }\n    let value = defaultValue;\n    try {\n      const encodedValue = this.#storage.getItem(key);\n      if (encodedValue !== null) {\n        value = JSON.parse(this.fromChecksummed(encodedValue), reviver);\n      }\n    } catch (error) {\n      LOG.error(`Cannot parse value from local storage. ${error.message}`);\n    }\n    this.#cache.set(key, value);\n    return value;\n  }\n\n  /**\n   * Clear everything\n   */\n  clearAll() {\n    this.#storage.clear();\n    this.#cache.clear();\n    LOG.info('All local storage cleared.');\n  }\n\n  /**\n   * Set the storage object. This is normally only used for test purposes.\n   * @param {Storage} storage\n   */\n  setStorage(storage) {\n    this.#storage = storage;\n  }\n\n  /**\n   * Convert data to JSON and then add a checksum prefix.\n   * @param {string} str\n   * @returns {string}\n   */\n  toChecksummed(str) {\n    const hash = simple32(str);\n    return `${hash}*${str}`;\n  }\n\n  /**\n   * Get the original string from a checksummed version.\n   * @param {*} checksummedStr\n   * @returns {string} data without the checksum\n   * @throws {Error}\n   */\n  fromChecksummed(checksummedStr) {\n    const matches = checksummedStr.match(/^([a-z0-9]{8})\\*(.*)$/);\n\n    if (matches) {\n      const checksum = matches[1];\n      const data = matches[2];\n      if (checksum === simple32(data)) {\n        return matches[2];\n      } else {\n        throw new Error('Invalid checksum');\n      }\n    }\n    throw new Error('Invalid format');\n  }\n}\n\nconst PERSISTENT_DATA = new PersistentData();\n\nexport default PERSISTENT_DATA;\n","/**\n * @file Simple hashes\n *\n * @module utils/hashes\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * Simple 32 bit hash code. Only for simple hashing.\n * Based on {@link https://stackoverflow.com/questions/18803505/javascript-hashing-algorithm}\n * Note the last line hash | 0 forces 32 bit result. See {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_OR}\n */\nexport function simple32(str) {\n  var hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const chr = str.charCodeAt(i);\n    hash = (hash << 5) - hash + chr;\n    hash = hash | 0;\n  }\n  return Math.abs(hash).toString(16).toLowerCase().padStart(8, '0');\n}\n","/**\n * @file Message manager. Wrapper for all ui messages.\n *\n * @module utils/messageManager\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as maths from './maths.js';\n/**\n * @type{Map<string, string}\n */\nlet messages;\n\n/**\n * Add text to the messages.\n * @param {Map<string, string>} messageMap\n */\nfunction setMap(messageMap) {\n  messages = messageMap;\n}\n\n/**\n * Get a message based on the key.\n * If the value is an array, a random element from the array is chosen.\n * This is to allow variable messages.\n * @param {string} key\n */\nfunction getText(key) {\n  const value = messages?.get(key);\n  if (value === undefined || value === null) {\n    return key;\n  }\n  if (Array.isArray(value)) {\n    return value[maths.getRandomInt(0, value.length)];\n  }\n  return value;\n}\n\n/**\n * Template function for string literals. If there are embedded expressions,\n * the first non empty string is used as a replacement. Other strings\n * are ignored. This is primarily to allow keys to appear\n * before or after the replacement expressions.\n * Then placeholders of ${n} are replaced by the\n * replacement values at the appropriate index.\n * Spaces around the key are replaced.\n * Placeholders can have text (a-z, A-Z, _, or -) after the digits to help translators identify\n * what parameter is being passed. So these placeholders are equivalent.\n *\n * - ${2}\n * - ${2name_here}\n * @param {string[]} strings\n * @param  {...string} values - replacement values\n */\nexport function i18n(strings, ...values) {\n  let result = '';\n  let key;\n  for (const str of strings) {\n    const trimmed = str.trim();\n    if (trimmed !== '') {\n      key = trimmed;\n      break;\n    }\n  }\n  if (!key) {\n    return values ? values.join(' ') : '';\n  }\n\n  result = getText(key);\n  values.forEach((value, index) => {\n    const placeHolder = new RegExp(`\\\\$\\\\{${index}[a-zA-Z_-]*\\\\}`);\n    result = result.replace(placeHolder, value);\n  });\n  return result;\n}\n/**\n * Object to access messages.\n */\nexport const MESSAGES = {\n  setMap: setMap,\n  getText: getText,\n};\n","/**\n * @file CLass to handle routines to improve power management\n *\n * @module gameManagement/powerManager\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport LOG from '../utils/logging.js';\n\n/** Class to manage the main animation state. */\nclass AnimationState {\n  /** Function to call when starting animation @type{function} */\n  onStartAnimation;\n  /** @type {boolean} */\n  #animationState;\n\n  /** Used by blur and focus events to restore state @type {boolean} */\n  #savedAnimationState;\n\n  /** Construct the animation state. */\n  constructor() {\n    this.#animationState = false;\n    this.#savedAnimationState = undefined;\n\n    window.addEventListener('blur', () => {\n      LOG.debug(`Blur: current animation state ${this.#animationState}`);\n      this.#savedAnimationState = this.#animationState;\n      this.setAnimationState(false);\n    });\n    window.addEventListener('focus', () => {\n      LOG.debug(`Focus: saved animation state ${this.#savedAnimationState}`);\n      this.setAnimationState(this.#savedAnimationState ?? true);\n      this.#savedAnimationState = undefined; // This is to allow for debugger issue where focus can fire without preceding blur.\n    });\n  }\n\n  /**\n   * Set the animation state.\n   * @param {boolean} state\n   */\n  setAnimationState(state) {\n    if (state !== this.#animationState) {\n      this.#animationState = state;\n      if (this.#animationState && this.onStartAnimation) {\n        this.onStartAnimation();\n      }\n    }\n  }\n\n  /**\n   * @returns {boolean}\n   */\n  isAnimationOn() {\n    return this.#animationState;\n  }\n}\n\n/** Singleton animation state */\nconst ANIMATION_STATE_MANAGER = new AnimationState();\n\nexport default ANIMATION_STATE_MANAGER;\n","/**\n * @file Sound manager\n *\n * @module utils/soundManager\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from './logging.js';\n/**\n * Sound manager\n */\nclass SoundManager {\n  /** @type {Map<string, Audio>} */\n  #effects;\n  /** @type {Audio} */\n  #music;\n  /** @type {number} */\n  #musicVolume;\n  /** @type {number} */\n  #effectsVolume;\n\n  /**\n   * Construct.\n   */\n  constructor() {\n    this.#musicVolume = 0.5;\n    this.#effectsVolume = 0.5;\n    this.#effects = new Map();\n  }\n\n  /**\n   * Load and play music.\n   * @param {string} path - path to music\n   */\n  loadAndPlayMusic(path) {\n    LOG.debug(`Loading music ${path}`);\n    if (this.#music) {\n      throw new Error('Only one music track currently supported.');\n    }\n    this.#music = this.#createAudioIfNotNull(path);\n    if (this.#music) {\n      this.#music.addEventListener('canplay', (eventUnused) => {\n        this.#music.volume = this.#musicVolume;\n        this.#music.loop = true;\n        this.#playMusic();\n        window.addEventListener('blur', () => {\n          this.#music.pause();\n        });\n        window.addEventListener('focus', () => {\n          this.#playMusic();\n        });\n      });\n    }\n  }\n  /**\n   * Load the audio sounds.\n   * @param {Map<string, string>} audioPaths\n   * @returns {Promise} fulfils to undefined\n   */\n  loadEffects(audioPaths) {\n    LOG.debug(`Loading sound effects.`);\n    audioPaths.forEach((path, key) => {\n      const audio = this.#createAudioIfNotNull(path);\n      if (audio) {\n        this.#effects.set(key, audio);\n      }\n    });\n    return Promise.resolve();\n  }\n\n  /**\n   * Load the audio if not null\n   * @param {string} url\n   * @returns {Audio} new audio object or null if url is null.\n   */\n  #createAudioIfNotNull(url) {\n    return url ? new Audio(url) : null;\n  }\n\n  /**\n   * Play an effect.\n   */\n  playEffect(key) {\n    if (this.#effectsVolume <= 0.001) {\n      return;\n    }\n    const effect = this.#effects.get(key);\n    if (effect && effect.readyState >= 3) {\n      effect.volume = this.#effectsVolume;\n      effect.play();\n    }\n  }\n\n  /**\n   * Set the music volume.\n   * @param {number} percent\n   */\n  setMusicVolumePercent(percent) {\n    const currentVolume = this.#musicVolume;\n    this.#musicVolume = percent / 100;\n    if (this.#music) {\n      this.#music.volume = this.#musicVolume;\n      if (currentVolume < 0.001 && this.#musicVolume >= 0.001) {\n        LOG.info('Restarted playing music because of volume change.');\n        this.#music.play();\n      } else if (this.#musicVolume < 0.001) {\n        LOG.info('Paused playing music because of low volume.');\n        this.#music.pause();\n      }\n    }\n  }\n\n  /**\n   * Play music if volume high enough\n   */\n  #playMusic() {\n    if (!this.#music) {\n      return;\n    }\n    if (this.#musicVolume >= 0.001) {\n      LOG.info('Restarted playing music.');\n      this.#music.play();\n    } else {\n      LOG.info('Volume too low to start playing music.');\n    }\n  }\n\n  /**\n   * Set the music volume.\n   * @param {number} percent\n   */\n  setEffectsVolumePercent(percent) {\n    this.#effectsVolume = percent / 100;\n  }\n}\n\nconst SOUND_MANAGER = new SoundManager();\n\nexport default SOUND_MANAGER;\n","/**\n * @file Dialogs to show details of actors.\n *\n * @module dialogs/actorDialogs\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport UI, { DialogResponse } from '../utils/dom/ui.js';\nimport * as components from '../utils/dom/components.js';\nimport * as maths from '../utils/maths.js';\nimport { i18n, MESSAGES } from '../utils/messageManager.js';\nimport {\n  ArtefactType,\n  StoreType,\n  artefactTypesEqual,\n} from '../players/artefacts.js';\nimport SCENE_MANAGER from '../gameManagement/sceneManager.js';\nimport { gpAsString } from '../utils/game/coins.js';\nimport * as dndAction from '../dnd/dndAction.js';\nimport LOG from '../utils/logging.js';\nimport { sceneToFloor } from '../dnd/floorNumbering.js';\nimport { canCastSpell } from '../dnd/magic.js';\nimport { useIdCheck } from '../gameManagement/identifyLimiter.js';\n\n/**\n * @typedef {number} ArtefactActionTypeValue\n */\n/**\n * @enum {ArtefactActionTypeValue}\n */\nexport const ArtefactActionType = {\n  VIEW: 0,\n  SELL: 1,\n  PILLAGE: 2,\n  FIND: 3,\n};\n\n/**\n * ArtefactActions\n * @enum {string}\n */\nconst ArtefactAction = {\n  CONTINUE: 'continue',\n  CONSUME: 'consume',\n  LEAVE: 'leave',\n  LEARN_SPELL: 'learn',\n  DISCARD: 'discard',\n  EQUIP: 'equip',\n  PREPARE_SPELL: 'prepare',\n  STASH: 'stash',\n  TAKE: 'take',\n  SELL: 'sell',\n  PILLAGE: 'pillage',\n  USE: 'use',\n};\n\n/**\n * @typedef {Object} ArtefactDialogOptions\n * @property {module:players/actors.Actor} currentOwner - who currently owns the artefact.\n * @property {module:players/actors.Actor} prospectiveOwner - who currently owns the artefact.\n * @property {boolean} allowMagicUse - allow an item to be used.\n * @property {boolean} allowConsumption - allow an item to be consumed.\n * @property {boolean} allowSpellPrep - allow a spell to be prepared.\n * @property {module:players/artefacts.Artefact} artefact - the item .\n * @property {StoreType} storeType\n * @property {ArtefactActionTypeValue} actionType\n * @param {function(noChain:boolean):Promise} refresh - function to call if storage changed.\n * if noChain is set, linkedInventories are not called. This is used to prevent\n * circular loops.\n * @param {boolean} showPrice\n * @param {boolean} showDamage - add damage detail to button labels.\n * @param {string} delayedReaction - If true, clicking on the\n * artefact will close the dialog and it will return a DelayedAction response.\n */\n\n/**\n * @typedef {Object} DelayedAction\n * @property {function():Promise} invoke - function that can be called to instigate the\n * delayed action.\n */\n\n/**\n * @typedef {string} InventoryLimitationValue\n */\n\n/**\n * @enum {InventoryLimitationValue}\n */\nconst InventoryLimitation = {\n  STANDARD: 'standard', // stash and equipment\n  STASH_ONLY: 'stash', // just the stash\n  SPELLS: 'spells', // all spells.\n  MAGIC: 'magic', // all magic. Cantrips and spells, prepared or not.\n  READY_MAGIC: 'ready magic',\n  CANTRIPS: 'cantrips',\n};\n/**\n * @typedef {Object} InventoryOptions\n * @property {InventoryLimitationValue} limitation\n * @property {InventoryOptions} linkedInventory - this will be refreshed at the same\n * time as the inventory.\n * @property {function()} onRefresh - function to call on an inventory refresh.\n **/\n\n/**\n * Container for an inventory.\n */\nclass InventoryContainerElement {\n  /** @type {ArtefactDialogOptions} */\n  #options;\n  /** @type {InventoryOptions} */\n  #inventoryOptions;\n  /** @type {Element} */\n  #content;\n  /** This will be refresh when this is refreshed. @type {InventoryContainerElement} */\n  linkedInventory;\n  /** Action buttons @type {BaseControl[]} */\n  #actionButtons;\n\n  /**\n   * Construct\n   * @param {ArtefactDialogOptions} options;\n   * @param {InventoryOptions} inventoryOptions\n   */\n  constructor(options, inventoryOptions = {}) {\n    this.#options = options;\n    this.#inventoryOptions = inventoryOptions;\n    this.#content = components.createElement('div', { className: 'stores' });\n\n    this.refresh();\n  }\n\n  /**\n   * Get the container element\n   * @returns {Element}\n   */\n  get element() {\n    return this.#content;\n  }\n\n  /**\n   * Get the container action buttons.\n   * @returns {BaseControl[]}\n   */\n  get actionButtons() {\n    return this.#actionButtons;\n  }\n\n  /**\n   * Rebuild the list.\n   * @param {boolean} noChain - prevent calls to linkedInventories.\n   */\n  refresh(noChain) {\n    let empty = true;\n    this.#actionButtons = [];\n    if (!noChain && this.linkedInventory) {\n      this.linkedInventory.refresh(true); // suppress linking\n    }\n    this.#content.replaceChildren();\n\n    if (\n      !this.#options.currentOwner.isHero() ||\n      this.#options.currentOwner.alive\n    ) {\n      let storesToShow = this.#getStoresToShow();\n\n      storesToShow.forEach((storeInfo) => {\n        const contents =\n          this.#options.currentOwner.storeManager.getStoreContents(\n            storeInfo.storeType\n          );\n        if (contents) {\n          empty = false;\n          const storeContentsElement = this.#createStoreContents(\n            storeInfo.label,\n            storeInfo.storeType,\n            contents\n          );\n          this.#content.appendChild(storeContentsElement);\n        }\n      });\n    }\n    if (empty) {\n      let emptyMessage;\n      if (\n        this.#options.currentOwner.isHero() &&\n        !this.#options.currentOwner.alive\n      ) {\n        emptyMessage = i18n`MESSAGE DEAD HERO HAS NO INVENTORY`;\n      } else {\n        emptyMessage = i18n`MESSAGE NOTHING HERE`;\n      }\n      this.#content.appendChild(\n        components.createElement('p', {\n          text: emptyMessage,\n        })\n      );\n    }\n    if (this.#inventoryOptions.onRefresh) {\n      this.#inventoryOptions.onRefresh();\n    }\n  }\n\n  /**\n   * Get array of stores to show.\n   * @return {{label: string, storeType: StoreType}}\n   */\n  #getStoresToShow() {\n    let storesToShow;\n    switch (this.#inventoryOptions.limitation) {\n      case InventoryLimitation.SPELLS:\n        storesToShow = [\n          {\n            label: i18n`Prepared spells`,\n            storeType: StoreType.PREPARED_SPELLS,\n          },\n          { label: i18n`Known spells`, storeType: StoreType.SPELLS },\n        ];\n        break;\n      case InventoryLimitation.MAGIC:\n        storesToShow = [\n          { label: i18n`Cantrips`, storeType: StoreType.CANTRIPS },\n          {\n            label: i18n`Prepared spells`,\n            storeType: StoreType.PREPARED_SPELLS,\n          },\n          { label: i18n`Known spells`, storeType: StoreType.SPELLS },\n        ];\n        break;\n      case InventoryLimitation.READY_MAGIC:\n        storesToShow = [\n          { label: i18n`Ready magic`, storeType: StoreType.PREPARED_SPELLS },\n          { label: i18n`Cantrips`, storeType: StoreType.CANTRIPS },\n        ];\n        break;\n      case InventoryLimitation.CANTRIPS:\n        [{ label: i18n`Cantrips`, storeType: StoreType.CANTRIPS }];\n        break;\n      case InventoryLimitation.STASH_ONLY:\n        storesToShow = [this.#getStashStoreInfo()];\n        break;\n      case InventoryLimitation.STANDARD:\n      default:\n        storesToShow = [\n          { label: i18n`Purse`, storeType: StoreType.PURSE },\n          { label: i18n`Head`, storeType: StoreType.HEAD },\n          { label: i18n`Body`, storeType: StoreType.BODY },\n          { label: i18n`Waist`, storeType: StoreType.WAIST },\n          { label: i18n`Hands`, storeType: StoreType.HANDS },\n          { label: i18n`Ring fingers`, storeType: StoreType.RING_FINGERS },\n          { label: i18n`Feet`, storeType: StoreType.FEET },\n          this.#getStashStoreInfo(),\n        ];\n        break;\n    }\n    return storesToShow;\n  }\n\n  /** Get the stash store for the actor.\n   * This gets the WAGON for a trader\n   * @returns {{label:string,storeType:StoreType}}\n   */\n  #getStashStoreInfo() {\n    if (this.#options.currentOwner.isTrader()) {\n      return { label: i18n`Wagon`, storeType: StoreType.WAGON };\n    } else {\n      return {\n        label: i18n`Backpack`,\n        storeType: StoreType.BACKPACK,\n      };\n    }\n  }\n  /**\n   * Create element showing store contents. Buttons created are pushed to\n   * this.#actionButtons.\n   * @param {string} label\n   * @param {StoreTypeValue} storeType\n   * @param {Iterator<Artefact>} contents\n   * @returns {Element}\n   */\n  #createStoreContents(label, storeType, contents) {\n    const container = components.createElement('div', {\n      className: 'store',\n    });\n\n    container.appendChild(\n      components.createElement('span', {\n        className: 'store-label',\n        text: label,\n      })\n    );\n\n    const contentsElement = components.createElement('div', {\n      className: 'store-contents',\n    });\n    container.appendChild(contentsElement);\n\n    [...contents]\n      .sort((a, b) => (a.id < b.id ? -1 : 1))\n      .forEach((artefact) => {\n        const options = { ...this.#options };\n        options.refresh = this.refresh.bind(this);\n        options.storeType = storeType;\n        options.artefact = artefact;\n        let button;\n        if (\n          artefactTypesEqual(artefact.artefactType, ArtefactType.SPELL) &&\n          options.allowMagicUse &&\n          !canCastSpell(options.currentOwner.traits, artefact.traits)\n        ) {\n          button = this.#createUncastableSpellButtonControl(options);\n        } else {\n          button = this.#createArtefactButtonControl(options);\n        }\n        if (button.closes !== null && button.closes !== undefined) {\n          this.#actionButtons.push(button);\n        }\n        contentsElement.appendChild(button.element);\n      });\n    return container;\n  }\n\n  /**\n   * Create an artefact button. If a custom action is set, the button is a closer.\n   * Otherwise it just pops up a dialog giving details about the artefact.\n   * @param {ArtefactDialogOptions} options\n   * @returns {components.BitmapButtonControl}\n   */\n  #createUncastableSpellButtonControl(options) {\n    const label = createArtefactButtonLabel(options);\n    let action;\n    action = async () => {\n      await UI.showOkDialog(i18n`MESSAGE NO CASTING POWER LEFT`);\n    };\n\n    const control = new components.BitmapButtonControl({\n      rightLabel: label,\n      imageName: options.artefact.iconImageName,\n      action: action,\n    });\n    control.element.classList.add('uncastable');\n    return control;\n  }\n  /**\n   * Create an artefact button. If a custom action is set, the button is a closer.\n   * Otherwise it just pops up a dialog giving details about the artefact.\n   * @param {ArtefactDialogOptions} options\n   * @returns {components.BitmapButtonControl}\n   */\n  #createArtefactButtonControl(options) {\n    const label = createArtefactButtonLabel(options);\n    let action;\n    let closes;\n    if (options.delayedReaction) {\n      closes = {\n        invoke: () => options.artefact.interaction.react(options.currentOwner),\n      };\n    } else {\n      action = async () => {\n        await showArtefactDialog(options).then(() => options.refresh?.());\n      };\n    }\n    return new components.BitmapButtonControl({\n      rightLabel: label,\n      imageName: options.artefact.iconImageName,\n      action: action,\n      closes: closes,\n    });\n  }\n}\n\n/**\n * Show the actor's traits.\n * @param {module:players/actors.Actor} actor\n * @returns {Promise}\n */\nfunction showTraits(actor) {\n  const container = document.createElement('div');\n  container.appendChild(createActorElement(actor, { hideDescription: true }));\n  return UI.showControlsDialog(container);\n}\n\n/**\n * Show a rest action dialog.\n * @param {module:players/actors.Actor} actor\n * @returns {Promise} fulfils to undefined.\n */\nfunction showRestActionDialog(actor) {\n  const store = actor.storeManager.getStore(StoreType.BACKPACK);\n\n  const meals = [];\n  const drinks = [];\n  store.values().forEach((item) => {\n    if (artefactTypesEqual(item.artefactType, ArtefactType.CONSUMABLE)) {\n      const type = item.traits.get('TYPE');\n      if (type === 'MEAL') {\n        meals.push(item);\n      } else if (type === 'DRINK') {\n        drinks.push(item);\n      }\n    }\n  });\n\n  const messageContainer = document.createElement('div');\n  messageContainer.appendChild(createIdCard(actor));\n\n  messageContainer.appendChild(\n    components.createElement('p', { text: i18n`MESSAGE EXPLAIN REST` })\n  );\n  const choices = [];\n  let shortIndex = -1;\n  let longIndex = -1;\n\n  const restDetails = dndAction.canRest(\n    meals.length,\n    drinks.length,\n    actor.traits\n  );\n\n  let message = '';\n  if (!restDetails.shortRest.possible) {\n    if (\n      restDetails.shortRest.failure === dndAction.RestFailure.NEED_LONG_REST\n    ) {\n      message = i18n`MESSAGE CANNOT REST SHORT NEED LONG REST`;\n    } else {\n      message = i18n`MESSAGE CANNOT REST SHORT NEED RATIONS`;\n    }\n    messageContainer.appendChild(\n      components.createElement('p', { text: message })\n    );\n  }\n  if (!restDetails.longRest.possible) {\n    message = i18n`MESSAGE CANNOT REST LONG NEED RATIONS`;\n\n    messageContainer.appendChild(\n      components.createElement('p', { text: message })\n    );\n  }\n\n  if (restDetails.shortRest.possible) {\n    shortIndex = choices.length;\n    choices.push(i18n`BUTTON REST SHORT`);\n  }\n  if (restDetails.longRest.possible) {\n    longIndex = choices.length;\n    choices.push(i18n`BUTTON REST LONG`);\n  }\n  choices.push(i18n`BUTTON CONTINUE`);\n\n  return UI.showChoiceDialog(\n    i18n`DIALOG TITLE CHOICES`,\n    messageContainer,\n    choices\n  ).then((choice) => {\n    if (choice === shortIndex) {\n      discardItemsFromStore(store, meals, dndAction.MEALS_FOR_SHORT_REST);\n      discardItemsFromStore(store, drinks, dndAction.DRINKS_FOR_SHORT_REST);\n      const result = dndAction.takeRest(actor, 'SHORT');\n      return UI.showOkDialog(\n        i18n`MESSAGE REST SHORT HP GAIN ${result.newHp - result.oldHp}`\n      );\n    } else if (choice === longIndex) {\n      discardItemsFromStore(store, meals, dndAction.MEALS_FOR_LONG_REST);\n      discardItemsFromStore(store, drinks, dndAction.DRINKS_FOR_LONG_REST);\n      const result = dndAction.takeRest(actor, 'LONG');\n      return showPrepareSpellsDialog(actor).then(() =>\n        UI.showOkDialog(\n          i18n`MESSAGE REST LONG HP GAIN ${result.newHp - result.oldHp}`\n        )\n      );\n    }\n    return;\n  });\n}\n\n/**\n * Show dialog allowing the player to prepare their spells.\n * @param {module:players/actors.Actor} actor\n */\nfunction showPrepareSpellsDialog(actor) {\n  const container = components.createElement('div', { className: 'inventory' });\n\n  container.appendChild(\n    createActorElement(actor, { hideDescription: true, hideTraits: true })\n  );\n  const inventoryContainer = new InventoryContainerElement(\n    {\n      currentOwner: actor,\n      prospectiveOwner: actor,\n      allowSpellPrep: true,\n    },\n    {\n      limitation: InventoryLimitation.SPELLS,\n    }\n  );\n  container.appendChild(inventoryContainer.element);\n  return UI.showControlsDialog(container, {\n    title: i18n`DIALOG TITLE PREPARE SPELLS`,\n    preamble: i18n`MESSAGE EXPLAIN SPELL PREP`,\n  });\n}\n\n/**\n * @param {module:players/artefacts~StoreInterface}\n * @param {module:players/artefacts~Artefact[]} items\n * @param {number} qty\n */\nfunction discardItemsFromStore(store, items, qty) {\n  if (qty > items.length) {\n    LOG.error(\n      'Attempt being made to discard more items than provided in array.'\n    );\n  }\n  for (let index = 0; index < qty && index < items.length; index++) {\n    const taken = store.take(items[index]);\n    if (!taken) {\n      LOG.error(`Trying to take artefact ${items[index]}, but none found.`);\n    }\n  }\n}\n\n/**\n * Show actor's inventory.\n * @param {module:players/actors.Actor} actor\n * @param {{allowConsumption: boolean, allowMagicUse: boolean, limitation:InventoryLimitation}} [options = {}]\n */\nfunction showInventory(actor, options = {}) {\n  const container = components.createElement('div', { className: 'inventory' });\n  const actorContainer = components.createElement('div', {\n    className: 'actor-container',\n  });\n  container.appendChild(actorContainer);\n  actorContainer.appendChild(\n    createActorElement(actor, { hideDescription: true, hideTraits: true })\n  );\n  const inventoryContainer = new InventoryContainerElement(\n    {\n      currentOwner: actor,\n      prospectiveOwner: actor,\n      allowMagicUse: options.allowMagicUse,\n      allowConsumption: options.allowConsumption,\n    },\n    {\n      limitation: options.limitation,\n      onRefresh: () =>\n        actorContainer.replaceChildren(\n          createActorElement(actor, { hideDescription: true, hideTraits: true })\n        ),\n    }\n  );\n  container.appendChild(inventoryContainer.element);\n  return UI.showControlsDialog(container);\n}\n\n/**\n * Show actor's inventory and allow casting of spells.\n * @param {module:players/actors.Actor} actor\n * @param {{allowMagicUse: boolean, limitation:InventoryLimitation}} [options = {}]\n * @returns {Promise<DelayedAction>}\n */\nfunction showCastSpells(actor) {\n  const container = components.createElement('div', { className: 'inventory' });\n\n  const inventoryContainer = new InventoryContainerElement(\n    {\n      currentOwner: actor,\n      prospectiveOwner: actor,\n      allowMagicUse: true,\n      showDamage: true,\n      delayedReaction: true,\n    },\n    {\n      limitation: InventoryLimitation.READY_MAGIC,\n    }\n  );\n  container.appendChild(inventoryContainer.element);\n  const cancelButton = new components.TextButtonControl({\n    label: i18n`BUTTON CONTINUE`,\n    closes: DialogResponse.CANCEL,\n  });\n\n  return UI.showControlsDialog(container, {\n    title: i18n`DIALOG TITLE PICK SPELL TO CAST`,\n    actionButtons: [...inventoryContainer.actionButtons, cancelButton],\n  });\n}\n\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement}\n */\nfunction createArtefactDialogButtons(container, options) {\n  const selfAction =\n    options.currentOwner === options.prospectiveOwner ||\n    !options.prospectiveOwner;\n  if (selfAction) {\n    return createSelfActionArtefactDialogButtons(container, options);\n  }\n  switch (options.actionType) {\n    case ArtefactActionType.FIND:\n      return createFindArtefactDialogButtons(container, options);\n    case ArtefactActionType.SELL:\n      return createSellArtefactDialogButtons(container, options);\n    case ArtefactActionType.PILLAGE:\n      return createPillageArtefactDialogButtons(container, options);\n    case ArtefactActionType.VIEW:\n    default:\n      return [];\n  }\n}\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */\nfunction createFindArtefactDialogButtons(container, options) {\n  const actionButtons = [];\n  const possibleStore = options.prospectiveOwner.storeManager.findSuitableStore(\n    options.artefact\n  );\n  let button;\n  if (!possibleStore) {\n    container.appendChild(createFailedStorageGuidance(options));\n  } else {\n    let label;\n    let action;\n    if (\n      possibleStore.storeType === StoreType.CANTRIPS ||\n      possibleStore.storeType === StoreType.SPELLS ||\n      possibleStore.storeType === StoreType.READY_SPELLS\n    ) {\n      label = i18n`BUTTON LEARN SPELL`;\n      action = ArtefactAction.LEARN_SPELL;\n    } else {\n      label = i18n`BUTTON TAKE ARTEFACT`;\n      action = ArtefactAction.TAKE;\n    }\n    button = new components.TextButtonControl({\n      label: label,\n      closes: action,\n    });\n    actionButtons.push(button);\n  }\n\n  button = new components.TextButtonControl({\n    label: i18n`BUTTON LEAVE ARTEFACT`,\n    closes: ArtefactAction.LEAVE,\n  });\n  actionButtons.push(button);\n\n  return actionButtons;\n}\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement}\n */\nfunction createSelfActionArtefactDialogButtons(container, options) {\n  if (artefactTypesEqual(options.artefact.artefactType, ArtefactType.COINS)) {\n    return;\n  }\n  let actionButtons = [];\n\n  switch (options.artefact.artefactType?.id) {\n    case ArtefactType.SPELL.id:\n      actionButtons = createSpellButtons(options);\n      break;\n    case ArtefactType.CANTRIP.id:\n      actionButtons = createCantripButtons(options);\n      break;\n    case ArtefactType.CONSUMABLE.id:\n      actionButtons = createConsumeButtons(options);\n      break;\n    case ArtefactType.KEY.id:\n      actionButtons = createKeyButtons(options);\n      break;\n    default:\n      actionButtons = createStandardArtefactButtons(options);\n      break;\n  }\n\n  //actionButtons.forEach((button) => container.appendChild(button.element));\n  actionButtons.push(\n    new components.TextButtonControl({\n      label: i18n`BUTTON CONTINUE`,\n      closes: ArtefactAction.CONTINUE,\n    })\n  );\n  return actionButtons;\n}\n\n/**\n * Create KEY artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */\nfunction createKeyButtons(optionsUnused) {\n  const buttons = [];\n  // nothing you can do with keys. If you discard or sell it you could get stuck.\n  return buttons;\n}\n\n/**\n * Create cantrip artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */\nfunction createCantripButtons(options) {\n  const buttons = [];\n  if (options.allowMagicUse) {\n    LOG.error(\n      'Unexpected creation of Cantrip buttons with magic allowed. Use of Cantrips is handled by custom actions.'\n    );\n  }\n\n  buttons.push(\n    new components.TextButtonControl({\n      label: i18n`Forget`,\n      closes: ArtefactAction.DISCARD,\n    })\n  );\n  return buttons;\n}\n\n/**\n * Create spell artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */\nfunction createSpellButtons(options) {\n  const buttons = [];\n  const artefact = options.artefact;\n  if (options.allowMagicUse) {\n    LOG.error(\n      'Unexpected creation of Spell buttons with magic allowed. Use of Spells is handled by custom actions.'\n    );\n  } else if (\n    options.storeType === artefact.stashStoreType &&\n    options.allowSpellPrep\n  ) {\n    buttons.push(\n      new components.TextButtonControl({\n        label: i18n`BUTTON PREPARE SPELL`,\n        closes: ArtefactAction.PREPARE_SPELL,\n      })\n    );\n  }\n\n  if (options.allowSpellPrep) {\n    buttons.push(\n      new components.TextButtonControl({\n        label: i18n`BUTTON FORGET`,\n        closes: ArtefactAction.DISCARD,\n      })\n    );\n  }\n\n  return buttons;\n}\n\n/**\n * Create consume artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */\nfunction createConsumeButtons(options) {\n  const buttons = [];\n\n  if (isArtefactUsable(options)) {\n    buttons.push(\n      new components.TextButtonControl({\n        label: getLabelForUse(options.artefact),\n        closes: ArtefactAction.CONSUME,\n      })\n    );\n  }\n  buttons.push(\n    new components.TextButtonControl({\n      label: i18n`BUTTON DISCARD`,\n      closes: ArtefactAction.DISCARD,\n    })\n  );\n  return buttons;\n}\n/**\n * Check to see if the artefact is allowed to be used.\n * @param {ArtefactDialogOptions} options\n * @returns {boolean}\n */\nfunction isArtefactUsable(options) {\n  const artefact = options.artefact;\n  if (!artefact.isUsable()) {\n    return false;\n  }\n  if (artefact.isMagic()) {\n    return options.allowMagicUse;\n  }\n  if (artefact.isConsumable()) {\n    return options.allowConsumption;\n  }\n}\n/**\n * Create standard artefact buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement[]}\n */\nfunction createStandardArtefactButtons(options) {\n  const buttons = [];\n\n  if (isArtefactUsable(options)) {\n    buttons.push(\n      new components.TextButtonControl({\n        label: getLabelForUse(options.artefact),\n        closes: ArtefactAction.USE,\n      })\n    );\n  } else if (\n    options.storeType === options.artefact.stashStoreType &&\n    options.artefact.equipStoreType\n  ) {\n    buttons.push(\n      new components.TextButtonControl({\n        label: i18n`BUTTON EQUIP`,\n        closes: ArtefactAction.EQUIP,\n      })\n    );\n  } else if (\n    options.storeType === options.artefact.equipStoreType &&\n    (!options.artefact.stashInWagon ||\n      options.currentOwner.storeManager.hasWagon)\n  ) {\n    buttons.push(\n      new components.TextButtonControl({\n        label: i18n`BUTTON STASH`,\n        closes: ArtefactAction.STASH,\n      })\n    );\n  }\n\n  buttons.push(\n    new components.TextButtonControl({\n      label: options.artefact.isMagic() ? i18n`Forget` : i18n`BUTTON DISCARD`,\n      closes: ArtefactAction.DISCARD,\n    })\n  );\n  return buttons;\n}\n\n/**\n * Get a suitable label for a button to use an artefact.\n * @param {module:players/artefacts.Artefact} artefact\n * @returns {string}\n */\nfunction getLabelForUse(artefact) {\n  switch (artefact.artefactType.id) {\n    case ArtefactType.CONSUMABLE.id:\n      return i18n`BUTTON CONSUME`;\n    case ArtefactType.SPELL.id:\n    case ArtefactType.CANTRIP.id:\n      return i18n`BUTTON CAST SPELL`;\n    default:\n      return i18n`BUTTON USE`;\n  }\n}\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement}\n */\nfunction createSellArtefactDialogButtons(container, options) {\n  if (artefactTypesEqual(options.artefact.artefactType, ArtefactType.COINS)) {\n    return;\n  }\n  const actionButtons = [];\n  const artefactCostInGp = options.artefact.costInGp;\n  let buyersFundsInGp;\n  if (options.prospectiveOwner.isTrader()) {\n    buyersFundsInGp = Number.MAX_SAFE_INTEGER; // traders have unlimited funds.\n  } else {\n    buyersFundsInGp = options.prospectiveOwner.storeManager.getPurseValue();\n  }\n  if (buyersFundsInGp < options.artefact.costInGp) {\n    container.appendChild(\n      createNoFundsGuidance(buyersFundsInGp, artefactCostInGp)\n    );\n    if (!options.currentOwner.isTrader()) {\n      createSelfActionArtefactDialogButtons(container, options);\n    }\n    return;\n  }\n\n  // button labels shows action relative to the hero.\n  // i.e. although the action may be the trader selling\n  // an item, to the player this is viewed as buying.\n  const prospectiveStore =\n    options.prospectiveOwner.storeManager.findSuitableStore(options.artefact);\n  if (!prospectiveStore) {\n    container.appendChild(createFailedStorageGuidance(options));\n    if (!options.currentOwner.isTrader()) {\n      createSelfActionArtefactDialogButtons(container, options);\n    }\n    return;\n  }\n  let button = new components.TextButtonControl({\n    label: options.currentOwner.isTrader()\n      ? i18n`BUTTON BUY FOR GP ${options.artefact.costInGp.toFixed(2)}`\n      : i18n`BUTTON SELL FOR GP ${options.artefact.sellBackPriceInGp.toFixed(\n          2\n        )}`,\n    closes: ArtefactAction.SELL,\n  });\n  actionButtons.push(button);\n\n  button = new components.TextButtonControl({\n    label: i18n`BUTTON CONTINUE`,\n    closes: ArtefactAction.CONTINUE,\n  });\n  actionButtons.push(button);\n  return actionButtons;\n}\n\n/**\n * Create buttons for dialog. The buttons are added to the container.\n * @param {Element} container - container for the action buttons.\n * @param {ArtefactDialogOptions} options\n * @returns {module:utils/dom/components~BaseControlElement}\n */\nfunction createPillageArtefactDialogButtons(container, options) {\n  if (options.currentOwner.alive) {\n    return createSelfActionArtefactDialogButtons(container, options);\n  }\n  const actionButtons = [];\n\n  const prospectiveStore =\n    options.prospectiveOwner.storeManager.findSuitableStore(options.artefact);\n  if (!prospectiveStore) {\n    container.appendChild(createFailedStorageGuidance(options));\n    if (options.currentOwner.alive) {\n      createSelfActionArtefactDialogButtons(container, options);\n    }\n    return;\n  }\n\n  let button = new components.TextButtonControl({\n    label: i18n`BUTTON PILLAGE`,\n    closes: ArtefactAction.PILLAGE,\n  });\n  actionButtons.push(button);\n\n  button = new components.TextButtonControl({\n    label: i18n`BUTTON LEAVE ARTEFACT`,\n    closes: ArtefactAction.CONTINUE,\n  });\n  actionButtons.push(button);\n\n  return actionButtons;\n}\n\n/**\n * Create an element advising that insufficient funds are available.\n * @param {number} availableGp\n * @param {number} requiredGp\n * @returns {Element}\n */\nfunction createNoFundsGuidance(availableGp, requiredGp) {\n  let text;\n  text = i18n`MESSAGE INSUFFICIENT FUNDS ${requiredGp.toFixed(\n    2\n  )} ${availableGp.toFixed(2)}`;\n\n  return components.createElement('p', { className: 'guidance', text: text });\n}\n/**\n * Create an element that provides guidance about why something cannot be stored.\n * @param {ArtefactDialogOptions} options\n * @returns {Element}\n */\nfunction createFailedStorageGuidance(options) {\n  let text;\n  if (options.prospectiveOwner.isTrader()) {\n    text = i18n`MESSAGE TRADER CANNOT STASH`;\n  } else if (options.artefact.stashInWagon) {\n    text = i18n`MESSAGE MAKE SPACE IN EQUIP`;\n  } else {\n    text = i18n`MESSAGE MAKE SPACE IN BACKPACK`;\n  }\n  return components.createElement('p', { className: 'guidance', text: text });\n}\n\n/**\n * Show equipment dialog.\n * @param {ArtefactDialogOptions} options\n * @return {Promise} fulfils to response from the dialog.\n */\nfunction showEquipDialog(options) {\n  const artefact = options.artefact;\n  const container = components.createElement('div', {\n    className: 'use-weapon-dialog',\n  });\n  container.appendChild(createActorElement(artefact, options));\n\n  const actionButtons = createArtefactDialogButtons(container, options);\n\n  return UI.showControlsDialog(container, {\n    preamble: options.preamble,\n    actionButtons: actionButtons,\n    row: true,\n  });\n}\n\n/**\n * Create an id card element for an actor.\n * @param {module:players/actors~Actor|module:game/artefact~Artefacts} actor\n * @returns {Element}\n */\nfunction createIdCard(actor) {\n  const idCard = components.createElement('div', {\n    className: 'actor-id-card',\n  });\n  idCard.appendChild(components.createBitmapElement(actor.iconImageName));\n  idCard.appendChild(\n    components.createElement('span', {\n      text: actor.traits?.get('NAME') ?? i18n`Unknown`,\n    })\n  );\n\n  const hp = actor.traits.getInt('HP');\n  if (!actor.artefactType && hp && !actor.traits.get('_HP')) {\n    const hpMax = actor.traits.getInt('HP_MAX');\n    let hpText;\n    if (hp === 0) {\n      hpText = i18n`(DEAD)`;\n    } else if (hpMax) {\n      hpText = i18n`(HP OUT OF VALUE) ${hp} ${hpMax}`;\n    } else {\n      hpText = i18n`(HP VALUE) ${hp}`;\n    }\n    idCard.appendChild(\n      components.createElement('span', {\n        text: hpText,\n      })\n    );\n  }\n\n  const characterClass = actor.traits.get('CLASS', '').toLowerCase();\n  if (actor.traits.getCharacterLevel && characterClass) {\n    idCard.appendChild(\n      components.createElement('span', {\n        text: i18n`CHARACTER LEVEL: ${actor.traits.getCharacterLevel()} ${characterClass}`,\n      })\n    );\n  }\n  return idCard;\n}\n/**\n * Create an element describing an actor.\n * @param {module:players/actors.Actor} actor\n * @param {Object} options\n * @param {boolean} options.hideDescription\n * @param {boolean} options.hideTraits\n * @param {string | Element} options.description - override the normal\n * description of the actor.\n * @returns {Element}\n */\nfunction createActorElement(actor, options = {}) {\n  const container = components.createElement('div', {\n    className: 'actor-detail',\n  });\n  const idCard = createIdCard(actor);\n  container.appendChild(idCard);\n\n  let descriptionElement;\n  if (!options.hideDescription) {\n    if (!actor.artefactType && !actor.alive) {\n      descriptionElement = createCorpseDescriptionElement(actor);\n    } else if (options.description) {\n      descriptionElement =\n        options.description instanceof Element\n          ? options.description\n          : components.createElement('p', { text: options.description });\n    } else if (actor.description) {\n      descriptionElement = components.createElement('p', {\n        text:\n          actor.unknown && actor.unknownDescription\n            ? actor.unknownDescription\n            : actor.description,\n      });\n    }\n  }\n  if (descriptionElement) {\n    container.appendChild(descriptionElement);\n  }\n  if (!options.hideTraits) {\n    container.appendChild(createTraitsList(actor, ['NAME'], true));\n  }\n  return container;\n}\n\n/**\n * Create an element describing a corpse.\n * @param {module:players/actors~Actor}\n * @returns {Element}\n */\nfunction createCorpseDescriptionElement(actor) {\n  let text;\n  if (actor.isHero()) {\n    const name = actor.traits.get('NAME');\n    text = i18n`MESSAGE HERO EPITAPH FOR ${name}`;\n  } else {\n    text = i18n`MESSAGE GENERIC EPITAPH`;\n  }\n  return components.createElement('p', {\n    text: text,\n  });\n}\n\n/**\n * Create an element showing an actor's traits. Gold coins contained in the actor's\n * purse are included as a trait if includeGold flag is set.\n * @param {module:players/actors~Actor|module:players/artefacts~Artefact} actor\n * @param {string[]} excludedKeys - Keys to ignore. Elements starting with an\n * underscore are automatically hidden.\n * @param {boolean} includeGold - flag to determine if gold pieces are included.\n * @returns {Element}\n */\nfunction createTraitsList(actor, excludedKeys, includeGold) {\n  if (!actor.artefactType && !actor.alive) {\n    return createCorpseDescriptionElement(actor);\n  }\n  const traitsList = document.createElement('ul');\n\n  if (includeGold) {\n    const goldPieces = actor.storeManager?.getPurseValue();\n    if (goldPieces) {\n      traitsList.appendChild(\n        components.createElement('li', {\n          text: gpAsString(goldPieces),\n        })\n      );\n    }\n  }\n\n  const readableArray = [];\n  const remainingRestsTrait = createRemainingShortRestTrait(actor);\n  if (remainingRestsTrait) {\n    readableArray.push(remainingRestsTrait);\n  }\n  const transientPropertiesTrait = getTransientPropertiesTrait(actor);\n  if (transientPropertiesTrait) {\n    readableArray.push(transientPropertiesTrait);\n  }\n  actor.traits?.getAllTraits().forEach((value, key) => {\n    if (!excludedKeys.includes(key) && !key.startsWith('_')) {\n      if (actor.traits.hasEffective?.(key)) {\n        const effectiveValue = actor.traits.getEffectiveInt(key);\n        const baseValue = maths.safeParseInt(value);\n        if (effectiveValue !== baseValue) {\n          const diff = effectiveValue - baseValue;\n          value = `${effectiveValue} [${baseValue}${\n            diff < 0 ? '-' : '+'\n          }${diff}]`;\n        }\n      }\n      readableArray.push([createReadableKey(key), createReadableValue(value)]);\n    }\n  });\n  readableArray.sort((a, b) => (a[0] < b[0] ? -1 : 1));\n  for (const traitEntry of readableArray) {\n    const key = traitEntry[0];\n    let value = traitEntry[1];\n\n    if (value && value !== '0') {\n      const displayedValue = Array.isArray(value) ? value.join(', ') : value;\n      const item = document.createElement('li');\n      const label = components.createElement('span', {\n        text: `${key}: `,\n      });\n      const content = components.createElement('span', {\n        text: displayedValue,\n      });\n      traitsList.appendChild(item);\n      item.appendChild(label);\n      item.appendChild(content);\n    }\n  }\n  return traitsList;\n}\n\n/**\n * Create a trait representing any transient properties.\n * @param {module:players/actors~Actor|module:players/artefacts~Artefact} actor\n * @returns {<key:string, value: number>} null if not applicable.\n */\nfunction getTransientPropertiesTrait(actor) {\n  if (!actor.traits.transientProperties) {\n    return null;\n  }\n  const readableProps = [];\n  for (const prop in actor.traits.transientProperties) {\n    readableProps.push(MESSAGES.getText(prop).toLowerCase());\n  }\n  return [createReadableKey('TRANSIENT'), readableProps.sort().join(', ')];\n}\n/**\n * Create a remaining short rest trait for adding to the traits list. This is\n * just a more user friendly version of the SPENT_HIT_DICE value;\n * @param {module:players/actors~Actor|module:players/artefacts~Artefact} actor\n * @returns {<key:string, value: number>} null if not applicable.\n */\nfunction createRemainingShortRestTrait(actor) {\n  if (!actor.isHero?.()) {\n    return null;\n  }\n  const remainingDice = dndAction.getNumberOfRemainingHitDice(actor.traits);\n  return [\n    createReadableKey('SHORT_RESTS_REMAINING'),\n    remainingDice === 0 ? i18n`zero` : remainingDice,\n  ];\n}\n/**\n * Convert a traits key into a more human readable version.\n * @param {string} key\n * @returns {string}\n */\nfunction createReadableKey(key) {\n  let revised = MESSAGES.getText(key);\n  if (revised === key) {\n    revised = key?.replace(/_/g, ' ');\n  }\n  return revised.charAt(0).toUpperCase() + revised.substring(1).toLowerCase();\n}\n\n/**\n * Convert a traits value into a more human readable version.\n * @param {string} key\n * @returns {string}\n */\nfunction createReadableValue(value) {\n  // money as is\n  if (/\\d*\\.?\\d* *[CSGP]P/.test(value)) {\n    return value; // money\n  }\n  // dice roll\n  if (/\\d+D\\d+(?: *[+-]? *\\d+)?/.test(value)) {\n    return value;\n  }\n  if (Array.isArray(value)) {\n    return value.map((entry) => MESSAGES.getText(entry).toLowerCase());\n  }\n  return typeof value === 'string'\n    ? MESSAGES.getText(value).toLowerCase()\n    : value;\n}\n\n/**\n * Create a label for an artefact button.\n * @param {ArtefactDialogOptions} options\n * @return {string}\n */\nfunction createArtefactButtonLabel(options) {\n  const traits = options.artefact.traits;\n  let label = traits.get('NAME');\n  if (options.showDamage) {\n    let dice;\n    let diceLabel;\n    if (traits.has('HP_GAIN')) {\n      diceLabel = 'HP: +';\n      dice = traits.getHpGainDiceWhenCastBy\n        ? traits.getHpGainDiceWhenCastBy(options.currentOwner.traits)\n        : traits.get('HP_GAIN');\n    } else if (traits.has('DMG')) {\n      diceLabel = 'DMG: ';\n      dice = traits.getDamageDiceWhenCastBy\n        ? traits.getDamageDiceWhenCastBy(options.currentOwner.traits)\n        : traits.get('DMG');\n    }\n\n    if (dice) {\n      label = `${label}; ${diceLabel}${dice}`;\n    }\n    let rangeText;\n    const range = traits.get('RANGE', '0');\n    if (maths.safeParseInt(range, 0) === 0) {\n      rangeText = i18n`ACTS ON CASTER`;\n    } else if (range) {\n      rangeText = i18n`Range: ${range}`;\n    }\n\n    label = `${label}; ${rangeText}`;\n  }\n  if (\n    options.showPrice ||\n    artefactTypesEqual(options.artefact.artefactType, ArtefactType.COINS)\n  ) {\n    const price = options.currentOwner.isTrader()\n      ? options.artefact.costInGp\n      : options.artefact.sellBackPriceInGp;\n    label = `${label} ${price.toFixed(2)} GP`;\n  }\n  return label;\n}\n\n/**\n * Show a dialog where one actor can take artefacts from another.\n * @param {module:players/actors.Actor} buyer\n * @param {module:players/actors.Actor} seller\n * @param {boolean} pillage\n * @returns {Promise} fulfils to undefined on completion.\n */\nexport function showTradeOrPillageDialog(buyer, seller, pillage) {\n  const container = components.createElement('div', {\n    className: 'trade',\n  });\n  const sideBySide = components.createElement('div', {\n    className: 'side-by-side',\n  });\n  container.appendChild(sideBySide);\n  const buyerSide = components.createElement('div', {});\n  const sellerSide = components.createElement('div', {});\n  sideBySide.appendChild(buyerSide);\n  sideBySide.appendChild(sellerSide);\n  buyerSide.appendChild(createIdCard(buyer));\n  sellerSide.appendChild(createIdCard(seller));\n\n  const actionType = pillage\n    ? ArtefactActionType.PILLAGE\n    : ArtefactActionType.SELL;\n  const buyerInventory = new InventoryContainerElement({\n    currentOwner: buyer,\n    prospectiveOwner: seller,\n    actionType: actionType,\n    showPrice: true,\n  });\n  const sellerInventory = new InventoryContainerElement(\n    {\n      currentOwner: seller,\n      prospectiveOwner: buyer,\n      actionType: actionType,\n      showPrice: true,\n    },\n    {\n      limitation: pillage\n        ? InventoryLimitation.STANDARD\n        : InventoryLimitation.STASH_ONLY,\n    }\n  );\n  buyerInventory.linkedInventory = sellerInventory;\n  sellerInventory.linkedInventory = buyerInventory;\n\n  buyerSide.appendChild(buyerInventory.element);\n  sellerSide.appendChild(sellerInventory.element);\n  const button = new components.TextButtonControl({\n    label: i18n`BUTTON CONTINUE`,\n  });\n  button.closes = DialogResponse.CANCEL;\n  const actionButtons = [];\n  actionButtons.push(button);\n  return UI.showControlsDialog(container, {\n    preamble: pillage ? i18n`DIALOG TITLE PILLAGE` : i18n`DIALOG TITLE TRADE`,\n    actionButtons: actionButtons,\n  });\n}\n\n/**\n * Show a dialog where one actor can take artefacts from another.\n * @param {module:players/actors.Actor} buyer\n * @param {module:players/actors.Actor} seller\n * @returns {Promise} fulfils to undefined on completion.\n */\nexport function showTradeDialog(buyer, seller) {\n  return showTradeOrPillageDialog(buyer, seller, false);\n}\n\n/**\n * Show a dialog where one actor can take artefacts from another.\n * @param {module:players/actors.Actor} pillager\n * @param {module:players/actors.Actor} victim\n * @returns {Promise} fulfils to undefined on completion.\n */\nexport function showPillageDialog(pillager, victim) {\n  return showTradeOrPillageDialog(pillager, victim, true);\n}\n\n// Export dialogs\n/**\n * Display details about the actor.\n * @param {module:players/actors.Actor} actor\n * @param {Object} [options = {}]\n * @param {boolean} options.allowRest\n * @param {boolean} options.allowMagicUse - can magic artefacts be used.\n * @param {boolean} options.allowConsumption - can artefacts be consumed.\n * @param {string} options.description - override the actor description\n * @param {string} options.okButtonLabel\n * @param {BaseControl[]} options.additionalControls\n * @returns {Promise<DelayedAction| *>}\n */\nexport function showActorDetailsDialog(actor, options = {}) {\n  const container = document.createElement('div');\n  let buttonRestElement;\n  container.appendChild(\n    components.createElement('span', {\n      text: i18n`Dungeon floor: ${sceneToFloor(\n        SCENE_MANAGER.getCurrentSceneLevel()\n      )}`,\n    })\n  );\n  const actorContainer = components.createElement('div', {\n    className: 'actor-container',\n  });\n  container.appendChild(actorContainer);\n  const actorElement = createActorElement(actor, {\n    hideTraits: true,\n    description: options.description,\n  });\n  actorContainer.appendChild(actorElement);\n  let button;\n  let actionButtons;\n  if (!actor.isProp()) {\n    button = new components.TextButtonControl({\n      label: i18n`BUTTON INVENTORY`,\n      action: () =>\n        showInventory(actor, {\n          allowConsumption: options.allowConsumption,\n          allowMagicUse: options.allowMagicUse,\n        }).then(() => {\n          actorContainer.replaceChildren(\n            createActorElement(actor, {\n              hideTraits: true,\n              description: options.description,\n            })\n          );\n          if (buttonRestElement && !actor.alive) {\n            container.removeChild(buttonRestElement);\n            buttonRestElement = undefined;\n          }\n        }),\n    });\n    container.appendChild(button.element);\n    button = new components.TextButtonControl({\n      label: i18n`BUTTON TRAITS`,\n      action: () => showTraits(actor),\n    });\n    container.appendChild(button.element);\n\n    button = new components.TextButtonControl({\n      label: i18n`BUTTON MAGIC`,\n      action: () =>\n        showInventory(actor, {\n          allowMagicUse: false,\n          limitation: InventoryLimitation.MAGIC,\n        }),\n    });\n    container.appendChild(button.element);\n\n    if (options.allowRest) {\n      button = new components.TextButtonControl({\n        label: i18n`BUTTON REST`,\n        action: () => {\n          return showRestActionDialog(actor).then(() =>\n            actorContainer.replaceChildren(\n              createActorElement(actor, {\n                hideTraits: true,\n                description: options.description,\n              })\n            )\n          );\n        },\n      });\n      buttonRestElement = button.element;\n      container.appendChild(button.element);\n    }\n\n    if (options.allowMagicUse) {\n      actionButtons = actionButtons ?? [];\n      button = new components.TextButtonControl({\n        label: i18n`BUTTON CAST SPELL`,\n      });\n      button.closes = 'CAST SPELL';\n      actionButtons.push(button);\n    }\n  }\n  if (actionButtons) {\n    button = new components.TextButtonControl({\n      label: i18n`BUTTON CONTINUE`,\n    });\n    button.closes = DialogResponse.CANCEL;\n    actionButtons.push(button);\n  }\n  if (options.additionalControls) {\n    actionButtons = actionButtons || [];\n    for (const control of options.additionalControls) {\n      actionButtons.push(control);\n    }\n  }\n\n  return UI.showControlsDialog(container, {\n    okButtonLabel: options.okButtonLabel,\n    actionButtons: actionButtons,\n  }).then((closes) => {\n    switch (closes) {\n      case 'CAST SPELL':\n        return showCastSpells(actor);\n      default:\n        return Promise.resolve(closes);\n    }\n  });\n}\n\n/**\n * Show artefact dialog.\n * @param {ArtefactDialogOptions} options\n * @return {Promise} fulfils to undefined on completion.\n */\nexport function showArtefactDialog(options) {\n  if (!options.prospectiveOwner) {\n    options.prospectiveOwner = options.currentOwner; // self action\n  }\n  const sourceStoreManager = options.currentOwner?.storeManager;\n  const destStoreManager = options.prospectiveOwner.storeManager;\n  const artefact = options.artefact;\n\n  const originalHideTraits = options.hideTraits;\n  return identifyArtefact(options)\n    .then((known) => {\n      if (!known) {\n        options.hideTraits = true; // hide traits if item not known\n      }\n      return showEquipDialog(options);\n    })\n    .then((response) => {\n      options.hideTraits = originalHideTraits; // restore\n      switch (response) {\n        case ArtefactAction.CONSUME:\n          sourceStoreManager.discard(artefact);\n          return artefact.interaction.react(options.currentOwner);\n        case ArtefactAction.DISCARD:\n          sourceStoreManager.discard(artefact);\n          break;\n        case ArtefactAction.PREPARE_SPELL:\n        case ArtefactAction.EQUIP:\n          destStoreManager.equip(artefact);\n          break;\n        case ArtefactAction.LEARN_SPELL:\n          if (\n            artefact.isMagic() &&\n            destStoreManager.hasArtefactWithSameId(artefact)\n          ) {\n            return UI.showOkDialog(i18n`MESSAGE SPELL ALREADY KNOWN`);\n          } else {\n            sourceStoreManager.discard(artefact);\n            const store = destStoreManager.findSuitableStore(artefact);\n            store.add(artefact);\n          }\n          if (artefactTypesEqual(artefact.artefactType, ArtefactType.SPELL)) {\n            return UI.showOkDialog(i18n`MESSAGE EXPLAIN SPELL NEEDS REST`);\n          }\n          break;\n        case ArtefactAction.PILLAGE:\n          {\n            sourceStoreManager.discard(artefact);\n            const store = destStoreManager.findSuitableStore(artefact);\n            store.add(artefact);\n          }\n          break;\n        case ArtefactAction.SELL:\n          {\n            const money = options.currentOwner.isTrader()\n              ? artefact.costInGp\n              : artefact.sellBackPriceInGp;\n            sourceStoreManager.addToPurse(money);\n            if (!options.prospectiveOwner.isTrader()) {\n              destStoreManager.takeFromPurse(money); // traders have unlimited funds\n            }\n            sourceStoreManager.discard(artefact);\n            if (artefact.stashInWagon && !destStoreManager.hasWagon) {\n              destStoreManager.equip(artefact, { direct: true });\n            } else {\n              destStoreManager.stash(artefact, { direct: true });\n            }\n          }\n          break;\n        case ArtefactAction.STASH:\n          if (!destStoreManager.stash(artefact)) {\n            UI.showOkDialog(\n              options.prospectiveOwner.isTrader()\n                ? i18n`MESSAGE TRADER CANNOT STASH`\n                : i18n`MESSAGE CANNOT STASH`\n            );\n          }\n          break;\n        case ArtefactAction.TAKE:\n          sourceStoreManager?.discard(artefact); // store manager could be null for programmatically created artefact.\n          if (artefact.stashInWagon && !destStoreManager.hasWagon) {\n            destStoreManager.equip(artefact, { direct: true });\n          } else {\n            destStoreManager.stash(artefact, { direct: true });\n          }\n\n          break;\n        case ArtefactAction.USE:\n          return artefact.interaction.react(options.currentOwner);\n      }\n      return Promise.resolve();\n    });\n}\n\n/**\n * Show dialog allowing the identification of an artefact if necessary.\n * @param {ArtefactDialogOptions} options\n * @returns {Promise<boolean>} true if known.\n */\nfunction identifyArtefact(options) {\n  if (!options.artefact?.unknown) {\n    return Promise.resolve(true);\n  } else if (!useIdCheck()) {\n    return Promise.resolve(false); // need to wait till next turn\n  }\n\n  const tester = options.prospectiveOwner ?? options.currentOwner;\n  const recognised = dndAction.canIdentify(\n    tester.traits,\n    options.artefact.traits\n  );\n  if (recognised) {\n    options.artefact.unknown = false;\n    return UI.showOkDialog(i18n`MESSAGE IDENTIFIED ITEM`).then(() => true);\n  } else {\n    return UI.showOkDialog(i18n`MESSAGE FAILED TO IDENTIFY`).then(() => false);\n  }\n}\n/**\n * Show the rest dialog for the hero\n * @param {module:players/actors.Actor} actor} heroActor\n * @param {boolean} allowMainMenu - add another button to go to main menu.\n * @returns {Promise<string>} fulfils to 'MAIN MENU' if return to main menu selected;\n */\nexport function showRestDialog(heroActor, allowMainMenu = false) {\n  const messageContainer = components.createElement('div');\n  const nextFloor = sceneToFloor(SCENE_MANAGER.getCurrentSceneLevel() + 1);\n  messageContainer.appendChild(\n    components.createElement('p', {\n      text: i18n`MESSAGE REST DIALOG ${nextFloor}`,\n    })\n  );\n  let additionalControls;\n  if (allowMainMenu) {\n    const mainMenuButton = new components.TextButtonControl({\n      label: i18n`BUTTON MAIN MENU`,\n    });\n    mainMenuButton.closes = 'MAIN MENU';\n    const continueButton = new components.TextButtonControl({\n      label: i18n`BUTTON CONTINUE`,\n    });\n    continueButton.closes = 'CONTINUE';\n    additionalControls = [mainMenuButton, continueButton];\n  }\n\n  return showActorDetailsDialog(heroActor, {\n    allowConsumption: true,\n    allowRest: true,\n    description: messageContainer,\n    okButtonLabel: i18n`BUTTON CONTINUE`,\n    additionalControls: additionalControls,\n  });\n}\n\n/**\n * Show epitaph\n * @param {module:player/actors.Actor} hero\n * @param {number} leaderboardIndex\n * @param {Object} options\n * @param {string} options.description - override the actor description\n * @param {string} options.okButtonLabel\n * @returns {Promise}\n */\nexport function showEpitaph(hero, leaderboardIndex, options) {\n  const container = document.createElement('div');\n\n  const heroContainer = components.createElement('div', {\n    className: 'actor-container',\n  });\n  container.appendChild(heroContainer);\n  heroContainer.appendChild(\n    createActorElement(hero, {\n      hideTraits: true,\n      description: options.description,\n    })\n  );\n\n  const floor = sceneToFloor(SCENE_MANAGER.getCurrentSceneLevel());\n\n  const goldSent = hero.traits.getInt('GOLD_SENT', 0);\n  container.appendChild(\n    components.createElement('p', {\n      text: i18n`MESSAGE ACHIEVEMENTS ${floor} ${goldSent}`,\n    })\n  );\n  const messageDefeat =\n    leaderboardIndex < 0 ? i18n`MESSAGE DEFEAT UNPLACED` : i18n`MESSAGE DEFEAT`;\n  container.appendChild(\n    components.createElement('p', {\n      text: messageDefeat,\n    })\n  );\n  return UI.showControlsDialog(container, options);\n}\n","/**\n * @file Artefacts\n * Artefacts are items that exist in the game but are never rendered in the\n * tile map. They can be stored, or worn. Examples are money and weapons. They can\n * be held by actors, typically a trader or hiddenArtefact.\n * @module players/artefacts\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport LOG from '../utils/logging.js';\nimport * as coins from '../utils/game/coins.js';\nimport { buildArtefact } from '../dnd/almanacs/artefactBuilder.js';\nimport { parseAlmanacLine } from '../dnd/almanacs/almanacs.js';\n\n/**\n * @typedef {Object} StoreTypeValue\n * @property {number} space - amount of space in store.\n * @property {boolean} money - if true, a MoneyStore is used.\n * @property {boolean} spacesExpand - if true every artefact takes one space.\n */\n\n/** @type {number} */\nconst UNKNOWN_ARTEFACT_COST_GP = 0.08;\n/**\n * Enumeration of store types.\n * @enum {StoreTypeValue}\n */\nexport const StoreType = {\n  HEAD: { id: 'HEAD', space: 1, money: false, spacesExpand: false },\n  BODY: { id: 'BODY', space: 1, money: false, spacesExpand: false },\n  WAIST: { id: 'WAIST', space: 1, money: false, spacesExpand: false },\n  HANDS: { id: 'HANDS', space: 2, money: false, spacesExpand: false },\n  FEET: { id: 'FEET', space: 2, money: false, spacesExpand: false },\n  BACKPACK: { id: 'BACKPACK', space: 8, money: false, spacesExpand: true },\n  WAGON: { id: 'WAGON', space: 8, money: false, spacesExpand: true },\n  CANTRIPS: { id: 'CANTRIPS', space: 999, money: false, spacesExpand: true },\n  RING_FINGERS: {\n    id: 'RING_FINGERS',\n    space: 2,\n    money: false,\n    spacesExpand: false,\n  },\n  SPELLS: {\n    id: 'SPELLS',\n    space: 9,\n    money: false,\n    spacesExpand: true,\n  },\n  PREPARED_SPELLS: {\n    id: 'PREPARED SPELLS',\n    space: 9,\n    money: false,\n    spacesExpand: true,\n  },\n  PURSE: {\n    id: 'PURSE',\n    space: Number.MAX_SAFE_INTEGER,\n    money: true,\n    spacesExpand: false,\n  },\n};\n\n/**\n * @typedef {Object} ArtefactTypeValue\n * @property {number} storageSpace - how much storage is used.\n * @property {{stash: StoreTypeValue, equip: StoreTypeValue}} storeType - storage locations\n */\n/**\n * Enumeration of artefact types\n * @enum {ArtefactTypeValue}\n */\nexport const ArtefactType = {\n  ARMOUR: {\n    id: 'armour',\n    storageSpace: 1,\n    storeType: { stash: StoreType.WAGON, equip: StoreType.BODY },\n  },\n  BELT: {\n    id: 'belt',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK, equip: StoreType.WAIST },\n  },\n  CANTRIP: {\n    id: 'cantrip',\n    storageSpace: 1,\n    storeType: { stash: null, equip: StoreType.CANTRIPS },\n  },\n  COINS: {\n    id: 'coins',\n    storageSpace: 0,\n    storeType: { stash: StoreType.PURSE },\n  },\n  CONSUMABLE: {\n    id: 'consumable',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK },\n  },\n  GENERIC: {\n    id: 'generic',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK },\n  },\n  HEAD_GEAR: {\n    id: 'head_gear',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK, equip: StoreType.HEAD },\n  },\n  KEY: {\n    id: 'key',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK },\n  },\n  RING: {\n    id: 'ring',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK, equip: StoreType.RING_FINGERS },\n  },\n  SHIELD: {\n    id: 'shield',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK, equip: StoreType.HANDS },\n  },\n  SPELL: {\n    id: 'spell',\n    storageSpace: 1,\n    storeType: { stash: StoreType.SPELLS, equip: StoreType.PREPARED_SPELLS },\n  },\n  TRAP: {\n    id: 'trap',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK },\n  },\n  TWO_HANDED_WEAPON: {\n    id: 'two_handed_weapon',\n    storageSpace: 2,\n    storeType: { stash: StoreType.BACKPACK, equip: StoreType.HANDS },\n  },\n  WEAPON: {\n    id: 'weapon',\n    storageSpace: 1,\n    storeType: { stash: StoreType.BACKPACK, equip: StoreType.HANDS },\n  },\n};\n\n/**\n * Create artefactType from id.\n * @param {string} id\n * @returns {ArtefactType}\n */\nexport function createArtefactType(id) {\n  return ArtefactType[id.toUpperCase()];\n}\n/**\n * Compare two artefact types\n * @param {ArtefactType} itemA\n * @param {ArtefactType} itemB\n * @returns {boolean}\n */\nexport function artefactTypesEqual(itemA, itemB) {\n  return itemA?.id === itemB?.id;\n}\n\n/**\n * Convert a string to an ArtefactType\n * @param {string} str - artefact type as string but excluding the ArtefactType.\n * E.g. COIN.\n * @returns {ArtefactType} null if invalid.\n */\nexport function strToArtefactType(str) {\n  const type = ArtefactType[str];\n  if (type === null || type === undefined) {\n    LOG.error(`Unrecognised artefact type: ${str}`);\n  }\n  return type;\n}\n\n/**\n * @interface StoreInterface\n */\n/**\n * @function StoreInterface.store\n * @param {Artefact} artefact\n * @returns {boolean} true if stored, else false.\n */\n/**\n * @function StoreInterface.retrieve\n * @param {Artefact} artefact\n * @returns {Artefact} the retrieved artefact which is removed from the store.\n */\n/**\n * @function StoreInterface.canAdd\n * @param {Artefact} artefact\n * @returns {boolean} true if it can be added.\n */\n/**\n * @function StoreInterface.has\n * @param {Artefact} artefact\n * @returns {boolean} true if it has the artefact.\n */\n/**\n * @property {StoreType} StoreInterface.storeType\n */\n/**\n * @property {string} StoreInterface.storeTypeId\n */\n\n/**\n * Store for artefacts\n * @implements {StoreInterface}\n */\nclass ArtefactStore {\n  /** @type {number} */\n  #maxSize;\n  /** @type {Map<Artefact, Artefact>} */\n  #artefacts;\n  /** @type {number} */\n  #usedSpace;\n  /** @type {boolean} */\n  #spacesExpand;\n  /** @type {StoreType} */\n  #storeType;\n\n  /** Create store.\n   * @param {number} maxSize;\n   * @param {boolean} spacesExpand - if true, each space can take an artefact of\n   * any size.\n   */\n  constructor(maxSize, spacesExpand, storeType) {\n    this.#maxSize = maxSize;\n    this.#usedSpace = 0;\n    this.#artefacts = new Map();\n    this.#spacesExpand = spacesExpand;\n    this.#storeType = storeType;\n  }\n\n  /**\n   * Get store type ID\n   * @returns {string}\n   */\n  get storeTypeId() {\n    return this.#storeType.id;\n  }\n  /**\n   * Get the store type\n   * @returns {StoreType}\n   */\n  get storeType() {\n    return this.#storeType;\n  }\n  /**\n   * Get free space\n   * @returns {number}\n   */\n  get freeSpace() {\n    return this.#maxSize - this.#usedSpace;\n  }\n\n  /**\n   * Get maximum space\n   * @returns {number}\n   */\n  get maxSpace() {\n    return this.#maxSize;\n  }\n\n  /**\n   * Adjust capacity. Note it cannot be reduced below the number of items already\n   * contained.\n   * @param {number} capacity\n   * @returns {number} resulting capacity\n   */\n  adjustCapacity(capacity) {\n    this.#maxSize = Math.max(capacity, this.#usedSpace);\n    return this.#maxSize;\n  }\n\n  /**\n   * Test if empty\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return this.#usedSpace === 0;\n  }\n\n  /** Get the space required by an artefact. If #spacesExpand\n   * this is always 1.\n   * @param {Artefact}\n   * @returns {number}\n   */\n  getRequiredSpace(artefact) {\n    return this.#spacesExpand ? 1 : artefact.storageSpace;\n  }\n\n  /**\n   * Test if store has artefact.\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */\n  has(artefact) {\n    return this.#artefacts.has(artefact);\n  }\n\n  /**\n   *\n   * @param {Artefact} artefact\n   * @returns {boolean} true if stored; false if no room.\n   */\n  add(artefact) {\n    const space = this.#maxSize - this.#usedSpace;\n    const requiredSpace = this.getRequiredSpace(artefact);\n    if (space >= requiredSpace) {\n      this.#artefacts.set(artefact, artefact);\n      this.#usedSpace += requiredSpace;\n      return true;\n    }\n    return false;\n  }\n  /**\n   * Retrieve artefact. This removes it from the store.\n   * @param {Artefact} artefact - to retrieve.\n   * @returns {Artefact} null if not found.\n   */\n  take(artefact) {\n    const storedArtefact = this.#artefacts.get(artefact);\n    const requiredSpace = this.getRequiredSpace(artefact);\n    if (storedArtefact) {\n      this.#usedSpace -= requiredSpace;\n      this.#artefacts.delete(storedArtefact);\n    }\n    return storedArtefact;\n  }\n\n  /**\n   * Get the first element. It isn't removed from storage\n   * @returns {Artefact} null if empty.\n   */\n  getFirst() {\n    if (this.isEmpty()) {\n      return null;\n    }\n    return this.#artefacts.values().next().value;\n  }\n\n  /**\n   * Take the first element.\n   * @returns {Artefact} null if empty.\n   */\n  takeFirst() {\n    if (this.isEmpty()) {\n      return null;\n    }\n    const firstArtefact = this.#artefacts.values().next().value;\n    return this.take(firstArtefact);\n  }\n\n  /**\n   * Iterable values in the store.\n   * @returns {Iterable<Artefacts>}\n   */\n  values() {\n    return this.#artefacts.values();\n  }\n\n  /**\n   * Test if an artefact can be stored.\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */\n  canAdd(artefact) {\n    const requiredSpace = this.getRequiredSpace(artefact);\n    return this.#maxSize - this.#usedSpace >= requiredSpace;\n  }\n}\n\n/**\n * Gold storage. This effectively merges artifacts into one combining the VALUE trait.\n * Note that if only one artefact is added, it is returned. Once more than one has been\n * added a composite money artefact is returned.\n * @implements {StoreInterface}\n */\nclass MoneyStore {\n  /** @type {Artefact} */\n  #artefact;\n  /** @type {boolean} */\n  #multipleArtefacts;\n\n  /** Create store.\n   * @param {number} maxSize;\n   */\n  constructor() {\n    this.#multipleArtefacts = false;\n  }\n\n  /**\n   * Get store type\n   * @returns {StoreType}\n   */\n  get storeType() {\n    return StoreType.PURSE;\n  }\n\n  /**\n   * Get store type Id\n   * @returns {StoreType}\n   */\n  get storeTypeId() {\n    return StoreType.PURSE.id;\n  }\n  /**\n   * Test if empty\n   * @override\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return !this.#artefact || this.#artefact.costInGp === 0;\n  }\n\n  /**\n   * Test if store has any money.\n   * @override\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */\n  has(artefactUnused) {\n    return this.#artefact.costInGp > 0;\n  }\n  /**\n   * The artefact is just used as a carrier for the cost.\n   * @override\n   */\n  add(artefact) {\n    const costDetails = artefact.costDetails;\n    if (!this.#artefact) {\n      this.#artefact = artefact.clone();\n      return true;\n    }\n    const currentCostDetails = this.#artefact.costDetails;\n    if (!this.#multipleArtefacts) {\n      this.#artefact = MoneyStore.createGoldCoinArtefact(\n        currentCostDetails.valueGp\n      );\n      this.#multipleArtefacts = true;\n    }\n\n    this.#artefact.costInGp = currentCostDetails.valueGp + costDetails.valueGp;\n    return true;\n  }\n\n  /**\n   * Retrieve an artefact.\n   * @param {Artefact} artefact\n   * @returns {Artefact} value set to value of gold taken which may be less\n   * than the requested amount..\n   */\n  take(artefact) {\n    const taken = Math.min(this.#artefact.costInGp, artefact.costInGp);\n    this.#artefact.costInGp = this.#artefact.costInGp - taken;\n    artefact.costInGp = taken; //may be less than requested.\n    return artefact;\n  }\n\n  /**\n   * Test if artefact can be added.\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */\n  canAdd(artefactUnused) {\n    return true;\n  }\n\n  /**\n   * Get iterable of values. For the gold store there is only one.\n   * @returns {Iterable<Artefacts>}\n   */\n  values() {\n    if (!this.#artefact || this.#artefact.costInGp === 0) {\n      return [].values();\n    } else {\n      return [this.#artefact.clone()].values();\n    }\n  }\n\n  /**\n   * Create a gold coin artefact.\n   * @param {number} gp\n   * @returns {Artefact}\n   */\n  static createGoldCoinArtefact(gp) {\n    const almanacEntry = parseAlmanacLine(\n      `0,COMMON,COINS,gold_coins * VALUE:${gp}GP`\n    );\n    const artefact = buildArtefact(almanacEntry);\n    artefact.costInGp = gp;\n    return artefact;\n  }\n}\n\n/**\n * Basic artefact.\n * @implements {module:players/actors~TraitsHolder}\n */\nexport class Artefact {\n  /** @type {string} */\n  id;\n  /** @type {string} */\n  iconImageName;\n  /** @type {string} */\n  description;\n  /** @type {ArtefactTypeValue} */\n  artefactType;\n  /** @type {module:dnd/traits~ArtefactTraits} */\n  traits;\n  /** @type {AbstractInteraction} */\n  interaction;\n  /** @type {module:dnd/almanacs/almanacs~AlmanacEntry} */\n  almanacEntry;\n  /** @type {boolean} */\n  unknown;\n\n  /**\n   * Create artefact.\n   * @param {AlmanacEntry} almanacEntry\n   * @param {string} description\n   * @param {string} iconImageName\n   * @param {number} artefactType - artefact enumeration\n   * @param {string} unknownDescription - description if not identified. If null\n   * or undefined or '' the artefact is regarded as identified.\n   */\n  constructor(almanacEntry, description, iconImageName, unknownDescription) {\n    this.id = almanacEntry.id;\n    this.description = description;\n    this.iconImageName = iconImageName;\n    this.artefactType = almanacEntry.type;\n    this.almanacEntry = almanacEntry;\n    this.unknownDescription = unknownDescription;\n    this.unknown = !!unknownDescription;\n  }\n\n  /** Get the cost details.\n   * @returns {module:game/coins~CoinDetails}\n   */\n  get costDetails() {\n    const coinDefn = this.traits?.get('VALUE');\n    return coins.getCoinDetails(coinDefn);\n  }\n  /**\n   * Get the artefact cost in GP;\n   * @returns {number}\n   */\n  get costInGp() {\n    if (this.unknown) {\n      return UNKNOWN_ARTEFACT_COST_GP;\n    }\n    const coinDefn = this.traits?.get('VALUE');\n    return coins.getValueInGp(coinDefn);\n  }\n\n  /**\n   * Get the artefact sell back price in GP. Coins are sold back at normal cost.\n   * @returns {number}\n   */\n  get sellBackPriceInGp() {\n    if (artefactTypesEqual(this.artefactType, ArtefactType.COINS)) {\n      return this.costInGp;\n    } else {\n      const cost = this.unknown ? UNKNOWN_ARTEFACT_COST_GP : this.costInGp;\n      return Math.round(50 * cost) / 100; // 50% from p62 SRD 5.1\n    }\n  }\n\n  /**\n   * Set the artefact cost in GP;\n   * @param {number} gp\n   */\n  set costInGp(gp) {\n    if (!this.traits) {\n      throw new Error('Artefact has no traits so cannot set cost.');\n    }\n    this.traits.set('VALUE', coins.getCoinDefinition(gp));\n  }\n\n  /** Get the storage space used by this artefact.\n   * @returns {number}\n   */\n  get storageSpace() {\n    return this.artefactType.storageSpace;\n  }\n\n  /**\n   * Get stash store type\n   * @returns {StoreTypeValue}\n   */\n  get stashStoreType() {\n    return this.artefactType.storeType.stash;\n  }\n\n  /**\n   * Get equip store type\n   * @returns {StoreTypeValue}\n   */\n  get equipStoreType() {\n    return this.artefactType.storeType.equip;\n  }\n\n  /** Convenience method to test if the stash store is a wagon.\n   * @returns {boolean}\n   */\n  get stashInWagon() {\n    return this.stashStoreType === StoreType.WAGON;\n  }\n\n  /**\n   * @returns {StoreTypeValue}\n   */\n  getDefaultStoreType() {\n    return (\n      this.artefactType.storeType.stash ?? this.artefactType.storeType.equip\n    );\n  }\n\n  /**\n   * Get all store types\n   * @returns {StoreTypeValue[]}\n   */\n  getStoreTypes() {\n    const storeTypes = [];\n    if (this.artefactType.storeType.stash) {\n      storeTypes.push(this.artefactType.storeType.stash);\n    }\n    if (this.artefactType.storeType.equip) {\n      storeTypes.push(this.artefactType.storeType.equip);\n    }\n    return storeTypes;\n  }\n\n  /**\n   * Clone the artefact\n   */\n  clone() {\n    const clone = new Artefact(\n      this.almanacEntry,\n      this.description,\n      this.iconImageName,\n      this.unknownDescription\n    );\n    clone.traits = this.traits.clone();\n    clone.value = this.value;\n    clone.unknown = this.unknown;\n    return clone;\n  }\n\n  /**\n   * Test if this is a magical item.\n   * @returns {boolean}\n   */\n  isMagic() {\n    return (\n      artefactTypesEqual(this.artefactType, ArtefactType.SPELL) ||\n      artefactTypesEqual(this.artefactType, ArtefactType.CANTRIP)\n    );\n  }\n\n  /**\n   * Test if this is a trap item.\n   * @returns {boolean}\n   */\n  isTrap() {\n    return artefactTypesEqual(this.artefactType, ArtefactType.TRAP);\n  }\n\n  /**\n   * Test if this is a useable item.\n   * @returns {boolean}\n   */\n  isUsable() {\n    return !!this.interaction?.canReact();\n  }\n\n  /** Test if this is consumable.\n   * @returns {boolean}\n   */\n  isConsumable() {\n    return artefactTypesEqual(this.artefactType, ArtefactType.CONSUMABLE);\n  }\n\n  /**\n   * Convert to JSON.\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */\n  toJSON() {\n    return {\n      reviver: 'Artefact',\n      data: {\n        almanacEntry: this.almanacEntry,\n        traits: this.traits,\n        unknown: this.unknown,\n      },\n    };\n  }\n\n  /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   * @param {function(module:dnd/almanacs~AlmanacEntry,module:dnd/traits.Traits)} builder\n   * @returns {Artefact}\n   */\n  static revive(data, builder) {\n    data.almanacEntry.type = createArtefactType(data.almanacEntry.type.id);\n    const artefact = builder(data.almanacEntry, data.traits);\n    artefact.unknown = data.unknown;\n    return artefact;\n  }\n}\n\n/**\n * Storage for artefacts.\n */\nexport class ArtefactStoreManager {\n  /** @type {Map<StoreLocation, Artefact[]>} */\n  #stores;\n\n  /** @type {boolean} */\n  #hasWagon;\n\n  /** @type {function} */\n  #onChange;\n\n  /**\n   * Construct artefact storage.\n   * @param {boolean} hasWagon\n   * @param {function()} onChange - called when there is an inventory change.\n   */\n  constructor(hasWagon, onChange) {\n    this.#stores = new Map();\n    this.#hasWagon = hasWagon;\n    for (const storeTypeName in StoreType) {\n      const storeType = StoreType[storeTypeName];\n      this.#addStore(storeType);\n    }\n    this.#onChange = onChange;\n  }\n\n  /**\n   * Test if this has a wagon\n   */\n  get hasWagon() {\n    return this.#hasWagon;\n  }\n\n  /**\n   * Notify change.\n   */\n  #notifyChange() {\n    if (this.#onChange) {\n      this.#onChange();\n    }\n  }\n  /**\n   *\n   * @param {StoreType} storeType\n   */\n  #addStore(storeType) {\n    if (storeType.money) {\n      return this.#stores.set(\n        storeType,\n        new MoneyStore(storeType.space, storeType.spacesExpand)\n      );\n    }\n    let storeValid = true;\n    if (this.#hasWagon && storeType === StoreType.BACKPACK) {\n      storeValid = false;\n    } else if (!this.#hasWagon && storeType === StoreType.WAGON) {\n      storeValid = false;\n    }\n    if (storeValid) {\n      this.#stores.set(\n        storeType,\n        new ArtefactStore(storeType.space, storeType.spacesExpand, storeType)\n      );\n    }\n  }\n\n  /** Get a store from the store type. Note that a trader's wagon serves\n   * both as a backpack and a wagon.\n   * @param {StoreTypeValue} storeType\n   * @returns {ArtefactStore}\n   */\n  getStore(storeType) {\n    if (this.#hasWagon && storeType === StoreType.BACKPACK) {\n      storeType = StoreType.WAGON;\n    }\n    return this.#stores.get(storeType);\n  }\n\n  /** Get a store from the store type. Note that a trader's wagon serves\n   * both as a backpack and a wagon.\n   * @param {string} storeId\n   * @returns {ArtefactStore} null if not found\n   */\n  getStoreByTypeId(storeTypeId) {\n    for (const store of this.#stores.values()) {\n      if (store.storeTypeId === storeTypeId) {\n        return store;\n      }\n    }\n    return null;\n  }\n  /**\n   * Get the store where an item should be stored. This is normally\n   * the stash store. If a suitable stash store is not available, the equip store is\n   * returned. This is because armour cannot be carried, just worn. The exception is\n   * traders, who can store anything in their packs.\n   * @param {Artefact}\n   * @returns {ArtefactStore} null if it cannot be stored\n   */\n  findSuitableStore(artefact) {\n    let storeType = artefact.stashStoreType;\n    let store = this.getStore(storeType);\n    if (!store) {\n      storeType = artefact.equipStoreType;\n      store = this.getStore(storeType);\n    }\n    if (store?.canAdd(artefact)) {\n      return store;\n    }\n    return null;\n  }\n\n  /**\n   * @param {Artefact} artefact\n   * @returns {boolean} true if successful; false if no space.\n   */\n  addArtefact(artefact) {\n    const store = this.getStore(artefact.getDefaultStoreType());\n    const result = store?.add(artefact);\n    this.#notifyChange();\n    return result;\n  }\n\n  /**\n   * @typedef {Object} StorageDetails\n   * @property {ArtefactStore} store\n   * @property {Artefact} artefact\n   */\n\n  /**\n   * Get the first stored artefact.\n   * @returns {StorageDetails} null if nothing found\n   */\n  getFirstStorageDetails() {\n    for (const store of this.#stores.values()) {\n      const artefacts = store.values();\n      const value = artefacts.next()?.value;\n      if (value) {\n        return { store: store, artefact: value };\n      }\n    }\n    return null;\n  }\n\n  /** Test whether a similar artefact is stored. This is done by\n   * testing the id.\n   * @param {Artefact | string} artefactOrId\n   * @returns {boolean}\n   */\n  hasArtefactWithSameId(artefactOrId) {\n    const id =\n      typeof artefactOrId === 'string' ? artefactOrId : artefactOrId.id;\n    const storageDetails = this.getAllStorageDetails();\n    for (const details of storageDetails) {\n      if (details.artefact.id === id) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /** Test whether a specific artefact is stored.\n   * @param {Artefact} artefact\n   * @returns {boolean}\n   */\n  hasArtefact(artefact) {\n    const storageDetails = this.getAllStorageDetails();\n    for (const details of storageDetails) {\n      if (details.artefact === artefact) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Get all equipped artefacts.\n   * @returns {Artefact[]}\n   */\n  getAllEquippedArtefacts() {\n    const result = [];\n    const stores = [\n      this.#stores.get(StoreType.HEAD),\n      this.#stores.get(StoreType.BODY),\n      this.#stores.get(StoreType.WAIST),\n      this.#stores.get(StoreType.HANDS),\n      this.#stores.get(StoreType.RING_FINGERS),\n      this.#stores.get(StoreType.FEET),\n      this.#stores.get(StoreType.CANTRIPS),\n      this.#stores.get(StoreType.PREPARED_SPELLS),\n    ];\n    for (const store of stores) {\n      for (const item of store.values()) {\n        result.push(item);\n      }\n    }\n    return result;\n  }\n  /**\n   * Get all stored artefacts.\n   * @returns {StorageDetails[]}\n   */\n  getAllStorageDetails() {\n    const storageDetails = [];\n    this.#stores.forEach((store) => {\n      for (const artefact of store.values()) {\n        storageDetails.push({ store: store, artefact: artefact });\n      }\n    });\n    return storageDetails;\n  }\n\n  /**\n   * Get current gold. A convenience method to access the PURSE\n   * @returns {number}\n   */\n  getPurseValue() {\n    const content = this.getStore(StoreType.PURSE).values();\n    const artefact = content.next()?.value;\n    return artefact ? artefact.costInGp : 0;\n  }\n\n  /** Add gold to purse.\n   * @param {number} gp\n   */\n  addToPurse(gp) {\n    const artefact = MoneyStore.createGoldCoinArtefact(gp);\n    this.#stores.get(StoreType.PURSE).add(artefact);\n    this.#notifyChange();\n  }\n\n  /**\n   * Take gold from purse.\n   * @param {number} gp - amount to take.\n   * @returns {number} amount taken.\n   */\n  takeFromPurse(gp) {\n    const artefact = MoneyStore.createGoldCoinArtefact(gp);\n    const taken = this.#stores.get(StoreType.PURSE).take(artefact);\n    this.#notifyChange();\n    return taken.costInGp;\n  }\n\n  /**\n   * Convenience method to get contents of a store.\n   *\n   * @param {StoreTypeValue} storeType\n   * @returns {Iterable<Artefact>} null if empty\n   */\n  getStoreContents(storeType) {\n    const store = this.getStore(storeType);\n    return !store || store.isEmpty() ? null : store.values();\n  }\n\n  /**\n   * Discard an artefact that has been equipped or stashed.\n   * @param {Artefact} artefact\n   * @returns {boolean} true on success.\n   */\n  discard(artefact) {\n    if (this.discardStashed(artefact, true)) {\n      return true;\n    } else {\n      return this.discardEquipped(artefact);\n    }\n  }\n  /**\n   * Discard an artefact that has been equipped.\n   * @param {Artefact} artefact\n   * @param {boolean} quiet\n   * @returns {boolean} true on success.\n   */\n  discardEquipped(artefact, quiet) {\n    const equipStore = this.getStore(artefact.equipStoreType);\n    if (!equipStore) {\n      if (!quiet) {\n        LOG.error(\"Cannot discard artefact as there isn't an equip store.\");\n      }\n      return false;\n    }\n    if (!equipStore.take(artefact)) {\n      if (!quiet) {\n        LOG.error('Artefact could not be found so not discarded.');\n      }\n      return false;\n    }\n    this.#notifyChange();\n    return true;\n  }\n  /**\n   * Discard an artefact that has been stashed.\n   * @param {Artefact} artefact\n   * @param {boolean} quiet\n   * @returns {boolean} true on success.\n   */\n  discardStashed(artefact, quiet) {\n    const stashStore = this.getStore(artefact.stashStoreType);\n    if (!stashStore) {\n      if (!quiet) {\n        LOG.error(\"Cannot discard artefact as there isn't a stash store.\");\n      }\n      return false;\n    }\n    if (!stashStore.take(artefact)) {\n      if (!quiet) {\n        LOG.error('Artefact could not be found so not discarded.');\n      }\n      return false;\n    }\n    this.#notifyChange();\n    return true;\n  }\n\n  /**\n   * Equip artefact. The artefact should normally exist in the stash unless\n   * the options.direct flag is set.\n   * If space is required, artefacts will be unequipped to make space.\n   * @param {Artefact} artefact\n   * @param {Object} options\n   * @param {boolean} direct - if true, this can be a new object that does not\n   * exist in the stash.\n   * @returns {boolean} true on success.\n   */\n  equip(artefact, options = {}) {\n    const stashStore = this.getStore(artefact.stashStoreType);\n    const equipStore = this.getStore(artefact.equipStoreType);\n    if (!stashStore && !options.direct) {\n      LOG.error(\n        'Cannot equip artefact as there isn`t a stash store to take it from.'\n      );\n      return false;\n    }\n    if (!equipStore) {\n      LOG.error(\"Cannot equip artefact as there isn't an equip store.\");\n      return false;\n    }\n    const spaceRequired = artefact.storageSpace;\n    if (spaceRequired > equipStore.maxSpace) {\n      LOG.error('The equip store cannot hold this item.');\n      return false;\n    }\n\n    const takenArtefact = stashStore?.take(artefact);\n    if (!takenArtefact && !options.direct) {\n      LOG.error('Could not find artefact in the stash.');\n      return false;\n    }\n\n    while (equipStore.freeSpace < spaceRequired) {\n      const unequiped = equipStore.takeFirst();\n      stashStore?.add(unequiped);\n    }\n\n    const result = equipStore.add(artefact);\n    this.#notifyChange();\n    return result;\n  }\n\n  /**\n   * Unequip and stash artefact. The artefact should normally exist in the equip store unless\n   * the options.direct flag is set.\n   * If space is required in the stash, the attempt fails.\n   * @param {Artefact} artefact\n   * @param {Object} options\n   * @param {boolean} direct - if true, this can be a new object that does not\n   * exist in the stash.\n   * @returns {boolean} true on success.\n   */\n  stash(artefact, options = {}) {\n    const stashStore = this.getStore(artefact.stashStoreType);\n    const equipStore = this.getStore(artefact.equipStoreType);\n    if (!stashStore) {\n      LOG.debug(\n        'Cannot stash artefact as there isn`t a suitable stash store to put it in.'\n      );\n      return false;\n    }\n    if (!equipStore && !options.direct) {\n      LOG.error(\n        'No suitable equip store found. If stashing a new artefact, the direct option should be set.'\n      );\n      return false;\n    }\n    const spaceRequired = artefact.storageSpace;\n    if (spaceRequired > stashStore.freeSpace) {\n      LOG.error('The stash store cannot hold this item.');\n      return false;\n    }\n    const takenArtefact = equipStore?.take(artefact);\n    if (!takenArtefact && !options.direct) {\n      LOG.error(\"The artefact hasn't been equipped so can't unequip it.\");\n      return false;\n    }\n    const result = stashStore.add(artefact);\n    this.#notifyChange();\n    return result;\n  }\n}\n","/**\n * @file Coins\n *\n * @module game/coins\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../logging.js';\nconst COIN_REGEX = /^ *(\\d+(?:\\.\\d*)?) *([a-zA-Z]+) *$/;\n\nconst EXCHANGE_RATE_TO_GOLD = new Map([\n  ['PP', 10],\n  ['GP', 1],\n  ['SP', 0.1],\n  ['CP', 0.01],\n]);\n\n/**\n * @typedef {Object} CoinDetails\n * @property {number} valueFace - face value of coin\n * @property {number} valueGp - value in gold coins.\n * @property {string} type - type of coin\n */\n\n/**\n * Get coin detail.\n * @param {string} coinDefn - e,g 1GP or 10SP. Spaces allowed between number\n * and type.\n * @returns {CoinDetails} value and type.\n */\nexport function getCoinDetails(coinDefn) {\n  let valueFace = 0;\n  let valueGp = 0;\n  const parts = coinDefn.match(COIN_REGEX);\n  if (!parts) {\n    LOG.error(`Unrecognised coin \"${coinDefn}\". Value set to zero.`);\n    return { valueFace: 0, valueGp: 0, type: 'GP' };\n  } else {\n    valueFace = parts[1];\n    const exchangeRate = EXCHANGE_RATE_TO_GOLD.get(parts[2]) ?? 0;\n    valueGp = parseFloat(parts[1]) * exchangeRate;\n  }\n  return { valueFace: valueFace, valueGp: valueGp, type: parts[2] };\n}\n/** Get the value of a coin in GP.\n * @param {string} coinDefn - e.g. 1GP or 10SP. Spaces allowed between number and type.\n * @returns {number} 0 if unrecognised.\n */\nexport function getValueInGp(coinDefn) {\n  return getCoinDetails(coinDefn).valueGp;\n}\n\n/**\n * Get value as a coin definition. I.e. with it's suffix.\n * @param {string} coinDefn - current definition.\n * @param {string} [coinType = 'GP'] Get value as a type.\n * @returns {string} if coinType is unrecognised, the value is zero.\n */\nexport function convertToType(coinDefn, coinType) {\n  const gp = getValueInGp(coinDefn);\n  const exchangeRate = EXCHANGE_RATE_TO_GOLD.get(coinType);\n  if (exchangeRate) {\n    const value = gp / exchangeRate;\n    return `${value.toFixed(2)} ${coinType}`;\n  }\n  return `0 ${coinType}`; // worthless in this currency\n}\n\n/**\n * Convert a number of gold pieces to its definition\n * @param {number} gp\n * @return {string} coin definition\n */\nexport function getCoinDefinition(gp) {\n  return `${gp.toFixed(2)} GP`;\n}\n\n/** Convert gold pieces value to string.\n * Note this is similar to the coin definition but\n * includes a non breaking space.\n * @param {number} gp\n * @returns {string}\n */\nexport function gpAsString(gp) {\n  return `${gp.toFixed(2)}\\u{00A0}GP`;\n}\n","/**\n * @file Build artefact\n *\n * @module dnd/almanacs/artefactBuilder\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport {\n  Artefact,\n  ArtefactType,\n  artefactTypesEqual,\n} from '../../players/artefacts.js';\nimport { CastSpell, ConsumeFood, TriggerTrap } from '../interact.js';\nimport { Traits, MagicTraits } from '../traits.js';\nimport LOG from '../../utils/logging.js';\nimport { ALMANAC_LIBRARY } from './almanacs.js';\n\n/**\n * Create an artefact.\n * @param {module:dnd/almanacs/almanacActors~AlmanacEntry} almanacEntry\n * @param {Object} detail\n * @param {string} detail.imageName\n * @param {module:dnd/traits~Traits} detail.traits\n * @param {string} detail.description\n * @param {string} detail.unknownDescription\n *\n */\nfunction createArtefact(almanacEntry, detail) {\n  const artefact = new Artefact(\n    almanacEntry,\n    detail.description,\n    `${detail.imageName}.png`,\n    detail.unknownDescription\n  );\n  artefact.traits = detail.traits;\n  return artefact;\n}\n\n/**\n * Create an artefact from an almanac entry.\n * @param {module:dnd/almanacs/almanacActors~AlmanacEntry} almanacEntry\n * @param {module:dnd/traits.Traits} [initialTraits] - initial traits\n * almanac entry. Normally only required if restoring an artefact from saved values.\n * @returns {module:players/artefacts.Artefact}\n */\nexport function buildArtefact(almanacEntry, initialTraits) {\n  let traits;\n  let imageName;\n  if (artefactTypesEqual(almanacEntry.type, ArtefactType.SPELL)) {\n    traits = initialTraits ?? new MagicTraits(almanacEntry.traitsString);\n    imageName = 'spell';\n  } else if (artefactTypesEqual(almanacEntry.type, ArtefactType.CANTRIP)) {\n    traits = initialTraits ?? new MagicTraits(almanacEntry.traitsString);\n    imageName = 'cantrip';\n  } else {\n    traits = initialTraits ?? new Traits(almanacEntry.traitsString);\n    imageName = almanacEntry.imageName;\n  }\n\n  traits.set('NAME', almanacEntry.name);\n  const artefact = createArtefact(almanacEntry, {\n    description: almanacEntry.description,\n    unknownDescription: almanacEntry.unknownDescription,\n    imageName: imageName,\n    traits: traits,\n  });\n\n  if (artefact.isTrap()) {\n    artefact.interaction = new TriggerTrap(artefact);\n  } else if (artefact.isMagic()) {\n    artefact.interaction = new CastSpell(artefact);\n  } else if (artefact.isConsumable()) {\n    artefact.interaction = new ConsumeFood(artefact);\n  }\n  return artefact;\n}\n\n/**\n * Build an artefact from its id.\n * @param {string} id\n * @param {string[]} [keys = 'MONEY] - the almanacs to search.\n * @returns {module:players/artefacts.Artefact} null if not found\n */\nexport function buildArtefactFromId(id, keys = ['MONEY']) {\n  const artefactEntry = ALMANAC_LIBRARY.findById(id, keys);\n  if (!artefactEntry) {\n    LOG.error(`Could not find artefact ${id} in ${keys} almanacs.`);\n    return null;\n  }\n  return buildArtefact(artefactEntry);\n}\n","/**\n * @file Dungeon and dragons properties\n *\n * @module dnd/traits\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as maths from '../utils/maths.js';\nimport * as dice from '../utils/dice.js';\nimport * as tables from './tables.js';\nimport {\n  getTraitAdjustmentDetails,\n  getClassAbilities,\n  getAttackModifiers,\n} from './abilityGenerator.js';\nimport { Difficulty } from './dndAction.js';\nimport * as magic from './magic.js';\n\nimport LOG from '../utils/logging.js';\n\n/**  Main character stats. Note that armour class is included. */\nconst CHAR_STATS_KEYS = ['STR', 'DEX', 'CON', 'INT', 'WIS', 'CHA', 'AC'];\n\nconst FEET_PER_TILE = 7.5;\n/**\n * Convert a value to a modifier.\n * @param {number} value\n * @returns {number}\n */\nexport function characteristicToModifier(value) {\n  return Math.floor((value - 10) / 2);\n}\n\n/**\n * Class that represents attack characteristics.\n */\nexport class AttackDetail {\n  /** @type {string} */\n  damageDice;\n  /** @type {number} */\n  proficiencyBonus;\n  /** @type {number} */\n  abilityModifier;\n  /** @type {boolean} */\n  #twoWeaponFighting;\n  /** @type {boolean} */\n  unarmed;\n\n  /**\n   *\n   * @param {module:players/artefacts.Artefact} weapon\n   * @param {Object} options\n   * @param {string} options.damageDice\n   * @param {string} options.weaponType - UNARMED makes this an unarmed strike.\n   * @param {number} options.proficiencyBonus\n   * @param {number} options.abilityModifier\n   */\n  constructor(options) {\n    this.damageDice = options.damageDice ?? '1D1';\n    const subType = options.weaponType ?? '';\n    if (subType === 'UNARMED') {\n      this.unarmed = true;\n      this.#twoWeaponFighting = false;\n    } else if (subType.includes('SIMPLE') && subType.includes('LIGHT')) {\n      this.unarmed = false;\n      this.#twoWeaponFighting = true;\n    } else {\n      this.unarmed = false;\n      this.#twoWeaponFighting = false;\n    }\n    this.proficiencyBonus = options?.proficiencyBonus ?? 0;\n    this.abilityModifier = options?.abilityModifier ?? 0;\n  }\n\n  /**\n   * Get unarmed damage.\n   * @returns {number}\n   */\n  #getUnarmedDamage() {\n    return 1 + this.abilityModifier; // ability modifier is the same as strength for melee\n  }\n  /**\n   * Get maximum possible damage from this weapon ignoring the ability modifier\n   * which applies to all weapons equally.\n   * @returns {number}\n   */\n  getMaxDamage() {\n    if (this.unarmed) {\n      return this.#getUnarmedDamage();\n    } else {\n      return dice.maxRoll(this.damageDice) + this.abilityModifier;\n    }\n  }\n\n  /**\n   * Is two weapon fighting allowed.\n   * @returns {boolean}\n   */\n  canUseTwoWeapons() {\n    return this.#twoWeaponFighting;\n  }\n\n  /**\n   * Roll for attack.\n   * @returns {{roll:number, value: number}}\n   */\n  rollForAttack() {\n    const roll = dice.rollDice(20);\n    LOG.info(\n      `Attack roll ${roll} + ability(${this.abilityModifier})+ proficiency(${this.proficiencyBonus})`\n    );\n    return {\n      roll: roll,\n      value: roll + this.abilityModifier + this.proficiencyBonus,\n    };\n  }\n\n  /**\n   * Roll for damage.\n   * @returns {number}\n   */\n  rollForDamage() {\n    if (this.unarmed) {\n      return this.#getUnarmedDamage();\n    }\n\n    const damage = Math.max(\n      dice.rollMultiDice(this.damageDice) + this.abilityModifier\n    );\n    LOG.debug(\n      `Damage: ${this.damageDice} + ability(${this.abilityModifier}) = ${damage}`\n    );\n    return damage;\n  }\n\n  /**\n   * Clone\n   * @returns {AttackDetail}\n   */\n  clone() {\n    const attackDetail = new AttackDetail({});\n    attackDetail.abilityModifier = this.abilityModifier;\n    attackDetail.damageDice = this.damageDice;\n    attackDetail.proficiencyBonus = this.proficiencyBonus;\n    attackDetail.#twoWeaponFighting = this.#twoWeaponFighting;\n    attackDetail.unarmed = this.unarmed;\n    return attackDetail;\n  }\n}\n\n/**\n * This is basically a Map with some special derived characteristics.\n */\nexport class Traits {\n  /** Characteristics @type {Map<string, *>} */\n  _traits;\n\n  /**\n   * Initialise the traits.\n   * @param {Map<string, *> | string} initialValues\n   */\n  constructor(initialValues) {\n    if (typeof initialValues === 'string') {\n      this._traits = new Map();\n      this.#setFromString(initialValues);\n    } else {\n      this._traits = new Map(initialValues);\n    }\n  }\n\n  /**\n   * Populate the traits from a string definition. The definition comprises a\n   * comma separated list of characteristics with each characteristic comprising\n   * a keyword followed by a space or equals sign and then its value.\n   * Keywords are converted to uppercase.\n   * @param {string} definition\n   * @returns {Traits} returns this to allow chaining.\n   * @throws {Error} if definition invalid.\n   */\n  #setFromString(definition) {\n    definition.split(',').forEach((item) => {\n      const match = item.match(/^\\s*(\\w+)\\s*[=: ]\\s*(.+?)\\s*$/);\n      if (!match) {\n        return;\n      }\n      const [key, value] = this.#imposeCase(match[1], match[2]);\n      if (match) {\n        this.#setValueFromString(key, value.trim());\n      } else {\n        throw new Error(`Invalid property definition'${item}'`);\n      }\n    });\n    return this;\n  }\n\n  /**\n   * Does traits have key.\n   * @param {string} key\n   * @returns {boolean}\n   */\n  has(key) {\n    return this._traits.has(key) || this._traits.has('_' + key);\n  }\n\n  /**\n   * @param {string} key\n   * @param {*} value\n   */\n  set(key, value) {\n    this._traits.set(key, value);\n    this._refreshDerivedValues(key);\n  }\n\n  /**\n   * Get the trait value. This will look first for the key and then the key\n   * preceded by an underscore.\n   * @param {string} key\n   * @param {*} defValue - default value;\n   * @returns {*}\n   */\n  get(key, defValue) {\n    return this._traits.get(key) ?? this._traits.get('_' + key) ?? defValue;\n  }\n\n  /**\n   * Delete the trait value.\n   * @param {string} key\n   * @returns {boolean} true if deleted; false if didn't  exist\n   */\n  delete(key) {\n    return this._traits.delete(key);\n  }\n\n  /**\n   * Refresh derived values.\n   * This is expected to be overridden.\n   * @param {string} key - key that was updated and triggered refresh.\n   */\n  _refreshDerivedValues(updatedKeyUnused) {}\n\n  /**\n   * Get the trait value as an int. This will look first for the key and then the key\n   * preceded by an underscore.\n   * @param {string} key\n   * @param {*} defValue - default value;\n   * @returns {number}\n   */\n  getInt(key, defValue) {\n    const result = this.get(key, defValue);\n    return maths.safeParseInt(result, defValue);\n  }\n\n  /**\n   * Add an integer value. Derived values are not recalculated.\n   * @param {string} key\n   * @param {number} value\n   * @param {boolean} clipToZero\n   */\n  addInt(key, value, clipToZero = false) {\n    const currentValue = this.getInt(key);\n    let newValue = maths.safeParseInt(value) + currentValue;\n    if (clipToZero && newValue < 0) {\n      newValue = 0;\n    }\n    this._traits.set(key, newValue);\n  }\n\n  /**\n   * Take a value normally entered in feet and convert to tiles.\n   * @param {string} key\n   * @param {number} defValue - default if not found.\n   * @returns {number} results rounded to nearest int.\n   */\n  getValueInFeetInTiles(key, defValue) {\n    const valueInFeet = this.getInt(key);\n    if (valueInFeet === null || valueInFeet === undefined) {\n      return defValue;\n    }\n    return Traits.feetToTiles(valueInFeet);\n  }\n\n  /**\n   * Convert a value in feet to whole number of tiles.\n   * @param {*} valueInFeet\n   * @returns {number}\n   */\n  static feetToTiles(valueInFeet) {\n    return Math.round(valueInFeet / FEET_PER_TILE);\n  }\n\n  /**\n   * Get the trait value as an float. This will look first for the key and then the key\n   * preceded by an underscore.\n   * @param {string} key\n   * @param {*} defValue - default value;\n   * @returns {number}\n   */\n  getFloat(key, defValue) {\n    const result = this.get(key, defValue);\n    return maths.safeParseFloat(result, defValue);\n  }\n  /**\n   * Get the trait value as a modifier int. This will look first for the key and then the key\n   * preceded by an underscore.\n   * @param {string} key\n   * @param {*} defValue - default value;\n   * @returns {number}\n   */\n  getAsModifier(key, defValue) {\n    const value = this.getInt(key);\n    if (value === null || value === undefined) {\n      return defValue;\n    }\n    return characteristicToModifier(value);\n  }\n\n  /**\n   * Adjust case to uppercase unless an excluded characteristic. Most values are\n   * converted to uppercase with a few exceptions.\n   * @param {string} key\n   * @param {string} value\n   * @returns {string[]} first element has the adjusted key and the second the value.\n   */\n  #imposeCase(key, value) {\n    key = key.toUpperCase();\n    if (key !== 'NAME' && key !== 'REWARD') {\n      value = value.toUpperCase();\n    }\n    return [key, value];\n  }\n\n  /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method.\n   * + If the value comprises two numbers separated by\n   * a /, the value for the key is set to the numerator and a new key key_MAX is created,\n   * set to the denominator.\n   * + If the value comprises two numbers separated by a >, the value for the key\n   * is set to a random value between (inclusive) the two values, and a new key key_MAX is created,set to the second number.\n   * @param {string} key\n   * @param {string} value\n   */\n  #setValueFromString(key, value) {\n    switch (key) {\n      case 'PROF':\n      case '_PROF':\n        return this.#setProficienciesFromString(key, value);\n      case 'VALUE':\n      case '_VALUE':\n        return this.#setCostValueFromString(key, value);\n      case 'DMG':\n      case '_DMG':\n      case 'DMG_MELEE':\n      case '_DMG_MELEE':\n      case 'DMG_POISON':\n      case '_DMG_POISON':\n      case 'HP_GAIN':\n      case '_HP_GAIN':\n        return this.#setIntOrDiceValueFromString(key, value);\n      case 'HIT_DICE':\n      case '_HIT_DICE':\n        return this.#setDiceValueFromString(key, value);\n      case 'DC':\n      case '_DC':\n      case 'IDENTIFY_DC':\n      case '_IDENTIFY_DC':\n        return this.#setDCValueFromString(key, value);\n      default:\n        return this.#setGenericValueFromString(key, value);\n    }\n  }\n\n  /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method.\n   * + If the value comprises two numbers separated by\n   * a /, the value for the key is set to the numerator and a new key key_MAX is created,\n   * set to the denominator.\n   * + If the value comprises two numbers separated by a >, the value for the key\n   * is set to a random value between (inclusive) the two values, and a new key key_MAX is created,set to the second number.\n   * @param {string} key\n   * @param {string} value\n   */\n  #setCostValueFromString(key, value) {\n    const match = value.match(/^(.*)([a-zA-Z]{2})$/);\n    if (!match) {\n      LOG.error(`Invalid value for VALUE trait: ${value}`);\n      value = '0 GP';\n    } else {\n      const diceDefn = match[1].trim();\n      let faceValue;\n      if (dice.isMultiDice(diceDefn)) {\n        faceValue = dice.rollMultiDice(diceDefn);\n      } else {\n        faceValue = maths.safeParseInt(match[1], 0);\n      }\n      value = `${faceValue} ${match[2]}`;\n    }\n    this.set(key, value);\n  }\n\n  /**\n   * Set the trait for key to value.\n   * The DC value is normally an int but a dndAction difficulty can be\n   * used.\n   * @param {string} key\n   * @param {string} value\n   */\n  #setDCValueFromString(key, value) {\n    let difficulty;\n    if (isNaN(value)) {\n      difficulty = Difficulty[value] ?? 1;\n    } else {\n      difficulty = maths.safeParseInt(value);\n    }\n    this.set(key, difficulty);\n  }\n  /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method. The dice is not rolled but stored as is.\n   * @param {string} key\n   * @param {string} value\n   */\n  #setDiceValueFromString(key, value) {\n    if (!dice.isMultiDice(value)) {\n      LOG.error(\n        `Invalid trait value ${value} for ${key}. Dice definition required.`\n      );\n      value = '1D6';\n    }\n    this.set(key, value);\n  }\n  /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method.\n   * If the value is a multidice, it is rolled and the resulting value used.\n   * @param {string} key\n   * @param {string} value\n   */\n  #setIntOrDiceValueFromString(key, value) {\n    let result;\n    if (dice.isMultiDice(value)) {\n      result = value;\n    } else {\n      result = parseInt(value);\n      if (isNaN(result)) {\n        LOG.error(\n          `Invalid trait value ${value} for ${key}. Integer or dice definition required.`\n        );\n        result = 0;\n      }\n    }\n    this.set(key, result);\n  }\n  /**\n   * Set the trait for key to value. This is for a value passed in by the\n   * #setValueFromString method.\n   * If the value is a multidice, it is rolled and the resulting value used.\n   * @param {string} key\n   * @param {string} value\n   */\n  #setGenericValueFromString(key, value) {\n    if (value === 'YES' || value === 'TRUE') {\n      value = true;\n    } else if (value === 'NO' || value === 'FALSE') {\n      value = false;\n    } else if (dice.isMultiDice(value) && key !== 'DMG') {\n      value = dice.rollMultiDice(value); // Note DMG is stored as dice definition as it is rolled on demand.\n    }\n    this.set(key, value);\n  }\n\n  /**\n   * Set proficiencies.\n   * @param {string} key\n   * @param {string} value - ids of items in which the user is proficient. Items\n   * are separated by &.\n   */\n  #setProficienciesFromString(key, value) {\n    const items = value.split(/\\s*&\\s*/);\n    const proficiencies = [];\n    items.forEach((item) => proficiencies.push(item.toUpperCase()));\n    this._traits.set(key, proficiencies);\n  }\n\n  /**\n   * Clone traits.\n   * @return {Traits}\n   */\n  clone() {\n    return new Traits(this._traits);\n  }\n  /**\n   * Get all traits. This is a copy of the underlying traits.\n   * @returns {Map<string, *>}\n   */\n  getAllTraits() {\n    return new Map([...this._traits.entries()]);\n  }\n\n  /**\n   * Get all traits. This is a copy of the underlying traits sorted by key name.\n   * @returns {Map<string, *>}\n   */\n  getAllTraitsSorted() {\n    return new Map([...this._traits.entries()].sort());\n  }\n\n  /**\n   * Get all trait values as a string\n   */\n  valuesToString() {\n    let result = '';\n    this._traits.forEach((value, key) => {\n      if (result !== '') {\n        result += ',';\n      }\n      result += `${key}:${value}`;\n    });\n    return result;\n  }\n  /**\n   * Stringify traits.\n   * @return {module:utils/persistentData~ObjectJSON}\n   */\n  toJSON() {\n    return {\n      reviver: 'Traits',\n      data: [...this._traits],\n    };\n  }\n\n  /**\n   * Revive object created using toJSON\n   * @param {Array.Array<key,value>} data - array of map initialisation values\n   * @returns {Traits}\n   */\n  static revive(data) {\n    return new Traits(new Map(data));\n  }\n}\n\n/**\n * DnD magic traits\n */\nexport class MagicTraits extends Traits {\n  /**\n   *\n   * @param {Map<string, *>} initialTraits\n   */\n  constructor(initialTraits) {\n    super(initialTraits ?? new Map());\n  }\n\n  /**\n   * Get the damage dice when cast by an actor.\n   * @param {Traits} actorTraits\n   * @returns {string}\n   */\n  getDamageDiceWhenCastBy(actorTraits) {\n    const damageDice = this.get('DMG');\n    return this.#getAdjustedDiceWhenCastBy(damageDice, actorTraits);\n  }\n\n  /**\n   * Get the damage dice when cast by an actor.\n   * @param {Traits} actorTraits\n   * @returns {string}\n   */\n  getHpGainDiceWhenCastBy(actorTraits) {\n    const hpDice = this.get('HP_GAIN');\n    return this.#getAdjustedDiceWhenCastBy(hpDice, actorTraits);\n  }\n  /**\n   * Get the health or damage dice when cast by an actor.\n   * @param {string} baseDice\n   * @param {Traits} actorTraits\n   * @returns {string}\n   */\n  #getAdjustedDiceWhenCastBy(baseDice, actorTraits) {\n    const extraDicePerLevel = this.getFloat('DICE_PER_LEVEL', 0);\n    const baseLevel = this.getInt('LEVEL', 0);\n    const characterLevel = actorTraits.getCharacterLevel();\n    let currentLevel;\n    if (baseLevel === 0) {\n      currentLevel = Math.min(17, characterLevel);\n    } else {\n      currentLevel = magic.characterLevelToSpellLevel(characterLevel);\n    }\n\n    const levelChange = Math.max(currentLevel - baseLevel, 0);\n    const extraDice = Math.floor(levelChange * extraDicePerLevel);\n    let adjustedDice = dice.changeQtyOfDice(baseDice, extraDice);\n    LOG.info(\n      `Spell cast: base dice = ${baseDice} raised to ${adjustedDice} for level.`\n    );\n    return adjustedDice;\n  }\n\n  /**\n   * Convert to JSON\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */\n  toJSON() {\n    const json = super.toJSON();\n    json.reviver = 'MagicTraits';\n    return json;\n  }\n  /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   */\n  static revive(data) {\n    return new MagicTraits(new Map(data));\n  }\n}\n\n/**\n * @typedef {Object} ArtefactTraitsCollection\n * @property {Traits[]} weapons\n * @property {Traits[]} armour\n * @property {Traits[]} shields\n * @property {Traits[]} magic\n */\n/**\n * DnD character traits\n */\nexport class CharacterTraits extends Traits {\n  /** @type {number} */\n  _proficiencyBonus;\n  /** @type {number} */\n  _level;\n\n  /** @type {AttackDetail[]} */\n  _attacks;\n\n  /** @type {ArtefactTraitsCollection} */\n  _availableArtefactTraits;\n\n  /** @type {Traits[]} */\n  _transientFxTraits;\n\n  /** @type {Traits} */\n  _effectiveTraits;\n\n  /** @type {Object} */\n  transientProperties;\n\n  /** Amount movement is reduced in tiles */\n  _maxTileMovePerTurn;\n\n  /** Flag to allow calculation of derived parameters. @type{boolean} */\n  _allowRefreshDerived = false;\n  /**\n   *\n   * @param {Map<string, *>} initialTraits\n   */\n  constructor(initialTraits) {\n    super(initialTraits ?? new Map([['NAME', 'mystery']]));\n    this._proficiencyBonus = 0;\n    this.#setInitialAbilityScores();\n    this._transientFxTraits = [];\n    this.transientProperties = {};\n    this._allowRefreshDerived = true;\n    this._refreshDerivedValues();\n  }\n\n  /**\n   * Get the movement per turn.\n   * This takes into account any impediments to motion.\n   */\n  getMaxTilesPerMove() {\n    return this._maxTileMovePerTurn;\n  }\n  /**\n   * Clone traits.\n   * @return {Traits}\n   */\n  clone() {\n    /** @type {CharacterTraits} */\n    const actorTraits = new CharacterTraits(this._traits);\n    actorTraits._proficiencyBonus = this._proficiencyBonus;\n    actorTraits._level = this._level;\n    actorTraits._attacks = this._attacks.map((attack) => attack.clone());\n    actorTraits._availableArtefactTraits = this._availableArtefactTraits; //reference okay\n    actorTraits._effectiveTraits = this._effectiveTraits.clone();\n    actorTraits._transientFxTraits = [];\n    this._transientFxTraits.forEach((traits) =>\n      actorTraits._transientFxTraits.push(traits.clone())\n    );\n    actorTraits._maxTileMovePerTurn = this._maxTileMovePerTurn;\n    return actorTraits;\n  }\n\n  /**\n   * Exceed abilities of another character. The character's key stats, excluding AC,\n   * and EXP are set the other's + extra if they exceed the current values.\n   * @param {Traits} other\n   * @param {number} [extra = 0]\n   */\n  exceedAbilitiesAndExp(other, extra = 0) {\n    ['STR', 'DEX', 'INT', 'WIS', 'CON', 'CHA', 'EXP'].forEach((key) => {\n      const otherValue = other.getInt(key) + extra;\n      const myValue = this.getInt(key);\n      if (otherValue > myValue) {\n        this.set(key, otherValue);\n      }\n    });\n  }\n\n  /** Add transient traits. Note only values which affect CHAR_STATS_KEYS are\n   * used. To be used, the trait should begin with FX_. This is to distinguish\n   * traits which affect a victim from traits which are characteristics of the\n   * owner.\n   * @param {Traits}\n   */\n  addTransientFxTraits(traits) {\n    const traitsSubset = new Traits();\n    let hasEffect = false;\n    CHAR_STATS_KEYS.forEach((key) => {\n      const fxKey = CharacterTraits.toFxKey(key);\n      const value = traits.getInt(fxKey);\n      if (value) {\n        hasEffect = true;\n        traitsSubset.set(fxKey, value);\n      }\n    });\n    if (hasEffect) {\n      this._transientFxTraits.push(traitsSubset);\n      this._refreshDerivedValues();\n    }\n  }\n\n  /**\n   * Clear transient traits.\n   */\n  clearTransientFxTraitsAndProperties() {\n    this._transientFxTraits = [];\n    this.transientProperties = {};\n    this._refreshDerivedValues();\n  }\n\n  /**\n   * Set initial ability scores and EXP unless already set.\n   */\n  #setInitialAbilityScores() {\n    const baseAbilities = getClassAbilities(this.get('CLASS'));\n    baseAbilities.forEach((value, key) => {\n      if (!this.get(key)) {\n        this.set(key, value ?? 8);\n      }\n    });\n    if (!this.has('EXP')) {\n      this.set('EXP', 0);\n    }\n  }\n  /**\n   * Initialise the hit points unless already set.\n   * This is calculated as the maximum hit dice roll + the constitution modifier.\n   */\n  _updateHitPoints() {\n    const alreadyHasHp = this.has('HP');\n    const alreadyHasHpMax = this.has('HP_MAX');\n    const hitDice = this.get('HIT_DICE');\n    if (alreadyHasHp && alreadyHasHpMax && !hitDice) {\n      return;\n    }\n\n    if (hitDice) {\n      if (!this.has('SPENT_HIT_DICE')) {\n        this._traits.set('SPENT_HIT_DICE', 0); // act directly on traits or refresh derived can be called again.\n      }\n      const con = this.getInt('CON', 0); // use standard constitution and do not include transients.\n      const conMod = characteristicToModifier(con);\n      const maxRoll = dice.maxRoll(hitDice);\n      const averageDiceRoll = Math.ceil((maxRoll + 1) / 2);\n      const hpMax =\n        maxRoll + conMod + (this._level - 1) * (averageDiceRoll + conMod);\n      this._traits.set('HP_MAX', hpMax);\n\n      if (!alreadyHasHp) {\n        this._traits.set('HP', dice.maxRoll(hitDice) + conMod);\n      }\n    } else if (alreadyHasHp) {\n      this._traits.set('HP_MAX', this.get('HP'));\n    }\n  }\n\n  /** Traits that affect victims rather than the owner are preceded by 'FX'.\n   * This function converts a key to an FX key; i.e. 'FX_key'.\n   * @param {string} key\n   * @returns {string}\n   */\n  static toFxKey(key) {\n    return `FX_${key}`;\n  }\n\n  /**\n   * Test if there is an effective trait overriding the base trait.\n   * @param {key}\n   * @returns {boolean}\n   */\n  hasEffective(key) {\n    return this._effectiveTraits ? this._effectiveTraits.has(key) : false;\n  }\n  /**\n   * Get the effective traits value. This differs from the underlying traits\n   * value as it can include armour, weapons, transient effects, and magical\n   * items. If the value is not in the _effectiveTraits, the underlying value is\n   * returned.\n   * @param {key}\n   * @param {*} defaultValue\n   * @returns {*}\n   */\n  getEffective(key, defaultValue) {\n    return this._effectiveTraits.get(key) ?? this.get(key, defaultValue);\n  }\n\n  /**\n   * Get the effective traits value. This differs from the underlying traits\n   * value as it can include armour, weapons, transient effects, and magical\n   * items. If the value is not in the _effectiveTraits, the underlying value is\n   * returned.\n   * @param {key}\n   * @param {number} defaultValue\n   * @returns {number}\n   */\n  getEffectiveInt(key, defaultValue) {\n    return maths.safeParseInt(this.getEffective(key), defaultValue);\n  }\n\n  /**\n   * Get the effective character level;\n   * @returns {number}\n   */\n  getCharacterLevel() {\n    return this._level;\n  }\n\n  /** Get the save ability modifier for an attack by the attacker.\n   * This is not applicable to melee attacks.\n   *\n   */\n  getNonMeleeSaveAbilityModifier(attackerTraits) {\n    const saveAbility = attackerTraits.get('SAVE_BY');\n    if (!saveAbility) {\n      LOG.error(`Non-melee ${attackerTraits.get('NAME')} has no SAVE_BY set.`);\n      return 0;\n    }\n    const ability = this.getInt(saveAbility);\n    return characteristicToModifier(ability ?? 0);\n  }\n\n  /**\n   * Get the proficiency bonus;\n   * @param {Traits| string} artefactTraitsOrType - traits or the artefact TYPE trait\n   * @returns {number}\n   */\n  getCharacterPb(artefactTraitsOrType) {\n    return this.isProficient(artefactTraitsOrType) ? this._proficiencyBonus : 0;\n  }\n\n  /**\n   * Get attacks.\n   * @returns {AttackDetail[]}\n   */\n  getAttacks() {\n    return this._attacks;\n  }\n\n  /**\n   * Update derived values for new artefacts.\n   * @param {ArtefactTraitsCollection} availableTraits\n   */\n  utiliseAdditionalTraits(availableTraits) {\n    this._availableArtefactTraits = availableTraits;\n    this._refreshDerivedValues();\n  }\n\n  /**\n   * Refresh all derived values. Note that if the traits has a damage property\n   * set, the values are taken directly from the traits, rather than looking\n   * at equipped weapons and armour. This is because monsters have their properties\n   * set including the weapons they carry. This also means it is possible to\n   * equip a monster without it affecting its fighting characteristics.\n   * @override\n   * @param {string} updatedKey\n   */\n  _refreshDerivedValues(updatedKey) {\n    if (!this._allowRefreshDerived) {\n      return;\n    }\n    if (!updatedKey || CHAR_STATS_KEYS.includes(updatedKey)) {\n      this._adjustForExperience();\n      this._updateHitPoints();\n      this._initialiseEffectiveTraits();\n      if (this.get('TYPE_ID') === 'ENEMY') {\n        this._deriveValuesFromTraits();\n      } else {\n        this._utiliseTransientTraits();\n        this._utiliseMagicTraits();\n        this._utiliseWeaponsTraits();\n        this._utiliseArmourAndShieldTraits();\n        this._adjustMovementForArmour();\n      }\n    }\n  }\n\n  /**\n   * Calculate derived values directly from the traits. I.e. ignore any equipped\n   * armour or weapons.\n   */\n  _deriveValuesFromTraits() {\n    this._maxTileMovePerTurn = this.getValueInFeetInTiles('SPEED', 1);\n    this._attacks = [];\n\n    const attack = new AttackDetail({\n      damageDice: this._traits.get('DMG'),\n      weaponType: 'ALMANAC',\n      proficiencyBonus: this.getInt('PB', 0),\n      abilityModifier: 0,\n      secondAttack: false,\n    });\n\n    this._attacks.push(attack);\n  }\n\n  /**\n   * Initialise the effective traits to the base values.\n   */\n  _initialiseEffectiveTraits() {\n    this._effectiveTraits = new Traits();\n    CHAR_STATS_KEYS.forEach((key) => {\n      this._effectiveTraits.set(key, this.getInt(key, 0));\n    });\n  }\n  /**\n   * Utilise transient traits. Only character stat keys are used.\n   * These are added to the effect traits and should be called before\n   * utilising magic, armour or weapons.\n\n   */\n  _utiliseTransientTraits() {\n    this._transientFxTraits?.forEach((traits) => {\n      LOG.debug(`Transient traits: ${traits.valuesToString()}`);\n      this._addFxTraitsToEffectiveTraits(traits);\n    });\n  }\n\n  /**\n   * Add FX traits to effective traits.\n   * Any traits for a CHAR_STATS_KEY preceded by 'FX_' is added to the effective\n   * traits. Note the value is **added** to the existing value;\n   * @param {Traits} traits\n   */\n  _addFxTraitsToEffectiveTraits(traits) {\n    CHAR_STATS_KEYS.forEach((key) => {\n      const value = traits.getInt(CharacterTraits.toFxKey(key));\n      if (value) {\n        this._effectiveTraits.addInt(key, value, true); // clipped to zero\n      }\n    });\n  }\n  /**\n   * Utilise magic traits. Only character stat keys are used.\n   * Note that magic items should only affect the 6 key abilities and not the\n   * armour class. An item that directly affects the AC value should be treated\n   * as an ARMOUR or SHIELD item rather than a magical item.\n   */\n  _utiliseMagicTraits() {\n    if (!this?._availableArtefactTraits?.magic) {\n      return;\n    }\n    for (const traits of this._availableArtefactTraits.magic) {\n      LOG.debug(`Magic traits: ${traits.valuesToString()}`);\n      this._addFxTraitsToEffectiveTraits(traits);\n    }\n  }\n\n  /**\n   * Utilise armour and shields. The armour classes are combined.\n   * Note that magical items must be utilised first as these might affect\n   * the actor's dexterity.\n   */\n  _utiliseArmourAndShieldTraits() {\n    let armourClass = this.getEffectiveInt('AC', 0); // character's base AC\n    const armourTraits = this?._availableArtefactTraits?.armour;\n    const shieldTraits = this?._availableArtefactTraits?.shields;\n    let additionalArmourClass = 0;\n    let shieldArmourClass = 0;\n    armourTraits?.forEach((traits) => {\n      const acInfo = this._getAcFromTraits(traits);\n      if (acInfo.additional) {\n        additionalArmourClass += acInfo.value;\n      } else if (acInfo.value > armourClass) {\n        armourClass = acInfo.value;\n      }\n    });\n\n    shieldTraits?.forEach((traits) => {\n      shieldArmourClass = Math.max(shieldArmourClass, traits.getInt('AC', 0));\n    });\n\n    const compositeAc = armourClass + additionalArmourClass + shieldArmourClass;\n    this._effectiveTraits.set('AC', compositeAc);\n  }\n\n  /**\n   * Armour can impede an actor's movement. This sets any movement inhibition\n   * based on the armour.\n   */\n  _adjustMovementForArmour() {\n    const baseSpeedInFeet = this.getFloat('SPEED', 1);\n    this._maxTileMovePerTurn = Math.max(1, Traits.feetToTiles(baseSpeedInFeet)); // default base movement\n\n    if (!this._availableArtefactTraits?.armour) {\n      return;\n    }\n\n    for (const traits of this._availableArtefactTraits.armour) {\n      if (\n        traits.get('TYPE', '').toUpperCase().includes('HEAVY') &&\n        traits.getInt('STR', 0) > this.getEffectiveInt('STR')\n      ) {\n        this._maxTileMovePerTurn = Math.max(\n          0,\n          Traits.feetToTiles(baseSpeedInFeet - 10)\n        );\n        return;\n      }\n    }\n  }\n  /**\n   * Utilise weapons traits. The best option for equipped weapons is automatically selected\n   * to give the maximum chance of damage. Up to two weapons are supported.\n   * Note that magical items must be utilised first as these might affect the\n   * character's strength.\n   */\n  _utiliseWeaponsTraits() {\n    this._attacks = [];\n    const weaponsTraits = this?._availableArtefactTraits?.weapons ?? [];\n\n    const strength = this.getEffectiveInt('STR', 1);\n    const abilityModifier = characteristicToModifier(strength);\n    const attackModifiers = getAttackModifiers(this.get('CLASS'));\n    const effectivePb = this._proficiencyBonus * attackModifiers.pbMultiplier;\n    if (weaponsTraits.length > 2) {\n      LOG.error(\n        `Unexpected number of equipped weapons. Expected 2; received ${weaponsTraits.length}`\n      );\n    }\n    let firstAttack;\n    let weaponType;\n    let damageDice;\n    let proficient;\n    let attackBonus;\n    if (weaponsTraits.length === 0) {\n      damageDice = '';\n      weaponType = 'UNARMED';\n      proficient = true;\n      attackBonus = 0;\n    } else {\n      damageDice = weaponsTraits[0].get('DMG', '1D1') ?? '1D1';\n      weaponType = weaponsTraits[0].get('TYPE') ?? '';\n      proficient = this.isProficient(weaponsTraits[0]);\n      attackBonus = weaponsTraits[0].getInt('ATTACK_BONUS', 0);\n    }\n\n    firstAttack = new AttackDetail({\n      damageDice: damageDice,\n      weaponType: weaponType,\n      proficiencyBonus: proficient ? effectivePb : 0,\n      abilityModifier: abilityModifier + attackBonus,\n    });\n\n    let secondAttack;\n    if (weaponsTraits.length > 1) {\n      attackBonus = weaponsTraits[1].getInt('ATTACK_BONUS', 0);\n      secondAttack = new AttackDetail({\n        damageDice: weaponsTraits[1].get('DMG', '1D1') ?? '1D1',\n        weaponType: weaponsTraits[1].get('TYPE') ?? '',\n        proficiencyBonus: this.isProficient(weaponsTraits[1]) ? effectivePb : 0,\n        abilityModifier: abilityModifier + attackBonus,\n      });\n    }\n    if (secondAttack?.canUseTwoWeapons() && firstAttack.canUseTwoWeapons()) {\n      this._attacks.push(firstAttack);\n      if (abilityModifier > 0) {\n        secondAttack.abilityModifier -= abilityModifier; // still leave in place attackBonus\n      }\n      this._attacks.push(secondAttack);\n    } else if (\n      secondAttack &&\n      secondAttack.getMaxDamage() > firstAttack.getMaxDamage()\n    ) {\n      this._attacks.push(secondAttack);\n    } else {\n      this._attacks.push(firstAttack);\n    }\n  }\n\n  /**\n   * Apply dexterity modifier to an item to get its AC value.\n   * @param {Traits} traits\n   * @returns {{additional:boolean, value:number}} additional is true if this should\n   * be added to current value rather than as a replacement.\n   */\n  _getAcFromTraits(traits) {\n    const dexterity = this.getEffectiveInt('DEX', 1);\n    const modifier = characteristicToModifier(dexterity);\n    const armourType = traits.get('TYPE', '').toUpperCase();\n    const acTrait = traits.get('AC', 1);\n    let armourClass = maths.safeParseInt(acTrait);\n    if (armourType.includes('MEDIUM')) {\n      armourClass += Math.min(2, modifier);\n    } else if (!armourType.includes('HEAVY')) {\n      armourClass += modifier;\n    }\n    return {\n      additional: /^[+-]/.test(acTrait),\n      value: armourClass,\n    };\n  }\n\n  /**\n   * Set the level and prof bonus. These are calculated from the experience.\n   */\n  _adjustForExperience() {\n    const currentLevel = this._level ?? 1;\n    const values = tables.getLevelAndProfBonusFromExp(this._traits.get('EXP'));\n    this._level = values.level;\n    this._proficiencyBonus = values.profBonus;\n    this._adjustTraitsForLevelChange(currentLevel, this._level);\n  }\n\n  /**\n   * Adjust traits for a level change.\n   * @param {number} oldLevel\n   * @param {number} newLevel\n   */\n  _adjustTraitsForLevelChange(oldLevel, nextLevel) {\n    const details = getTraitAdjustmentDetails(this.get('CLASS'));\n    if (details.levels.length === 0) {\n      return;\n    }\n    let availableGain = 0;\n    for (const level of details.levels) {\n      if (level > nextLevel) {\n        break;\n      }\n      if (level > oldLevel) {\n        availableGain += details.gainPerAdjustment;\n      }\n    }\n    let traitIndex = 0;\n    while (availableGain > 0 && traitIndex < details.traits.length) {\n      const key = details.traits[traitIndex];\n      let value = this.get(key);\n      if (value < details.maxAbility) {\n        this.set(key, value + 1);\n        availableGain--;\n      } else {\n        traitIndex++;\n      }\n    }\n  }\n\n  /**\n   * @typedef {Object} ValueChangeInfo\n   * @property {*} was\n   * @property {*} now\n   */\n  /**\n   * Increase experience, level and proficiency bonus\n   *  based on challenge rating.\n   * @param {Traits} defeatedTraits\n   * @returns {{exp: ValueChangeInfo, level: ValueChangeInfo}}\n   */\n  adjustForDefeatOfActor(defeatedTraits) {\n    const challengeRating = defeatedTraits.get('CR');\n    const gainedExp = tables.getXpFromCr(challengeRating);\n    const currentExp = this.getInt('EXP', 0);\n    const newExp = currentExp + gainedExp;\n    LOG.info(`Experience increased from ${currentExp} to ${newExp}.`);\n    this.set('EXP', newExp);\n    const currentLevel = this._level;\n    this._adjustForExperience();\n    const newLevel = this._level;\n    return {\n      exp: { was: currentExp, now: newExp },\n      level: { was: currentLevel, now: newLevel },\n    };\n  }\n\n  /**\n   * Test if proficient with an item.\n   * The test looks at the artefact's TYPE trait. If it includes one of this trait's\n   * PROF entries, the result is true. This means that a PROF entry of 'melee' would\n   * match 'simple melee' and 'martial melee'. You can pass in a string which will be\n   * taken as the TYPE trait.\n   * @param {Traits | string} artefactTraitsOrType\n   * @returns {boolean}\n   */\n  isProficient(artefactTraitsOrType) {\n    const proficiencies = this.get('PROF');\n    const artefactSubtype =\n      typeof artefactTraitsOrType === 'string'\n        ? artefactTraitsOrType\n        : artefactTraitsOrType.get('TYPE');\n    if (!proficiencies || !artefactSubtype) {\n      return false;\n    }\n    for (const prof of proficiencies) {\n      const words = prof.split(' ');\n      let allWordsIncluded = true;\n      for (const word of words) {\n        if (!artefactSubtype.includes(word)) {\n          allWordsIncluded = false;\n          break;\n        }\n      }\n      if (allWordsIncluded) {\n        return true;\n      }\n    }\n    return false;\n  }\n  /**\n   * Convert to JSON. Note transient FXs are not saved as these are\n   * not persistent. Also additional traits from equipment are not\n   * included as equipment, etc. are utilised when a character is revived.\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */\n  toJSON() {\n    const json = super.toJSON();\n    json.reviver = 'CharacterTraits';\n    return json;\n  }\n  /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   */\n  static revive(data) {\n    return new CharacterTraits(new Map(data));\n  }\n}\n","/**\n * @file Simulation of dice\n *\n * @module utils/dice\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport LOG from './logging.js';\nimport * as maths from './maths.js';\n\nconst MULTIDICE_REGEX = /(\\d+)[dD](\\d+)(?: *([+-]) *(\\d+))?/;\n/**\n * Roll a dice\n * @param {number} [sides = 6] - number of sides on the dice\n * @returns {number}\n */\nexport function rollDice(sides = 6) {\n  return maths.getRandomIntInclusive(1, sides);\n}\n\n/** Test to see if string is a multidice.\n * @param {string} str\n * @returns {boolean}\n */\nexport function isMultiDice(str) {\n  return MULTIDICE_REGEX.test(str);\n}\n/**\n * Roll multiple dice.\n * @param {string} dice - in format nDs. E.g. 1D6. If dice is falsy or incorrectly\n * formatted the dice is taken as a 1D1. If it is an integer it is just taken as\n * that many sided dice.\n * @returns {number} result\n */\nexport function rollMultiDice(dice) {\n  if (!dice) {\n    return 1;\n  }\n  if (Number.isInteger(dice)) {\n    return rollDice(dice);\n  }\n  const details = getDiceDetails(dice);\n  if (!details) {\n    LOG.error(\n      `String ${dice} not recognised as a dice roll. Defaulting to 1D1.`\n    );\n    return 1;\n  }\n  let result = 0;\n  for (let roll = 0; roll < details.qty; roll++) {\n    result += rollDice(parseInt(details.sides));\n  }\n  result += details.offset;\n  return result;\n}\n\n/**\n * Get the maximum throw possible from a multidice.\n * @param {string} dice - dice in format nDs. If dice is falsy,\n * the dice is taken as a 1D1. The dice specifier can be followed by an positive\n * offset. E.g. 2d6 + 8\n * @returns {number}\n */\nexport function maxRoll(dice) {\n  const details = getDiceDetails(dice);\n  if (!details) {\n    return 1;\n  }\n  return details.qty * (details.sides + details.offset);\n}\n\n/**\n * Compare two multidice definitions and return the largest.\n * @param {string} diceA\n * @param {string} diceB\n * @returns {string}\n */\nexport function biggestMultiDice(diceA, diceB) {\n  return maxRoll(diceA) > maxRoll(diceB) ? diceA : diceB;\n}\n\n/**\n * Take a multidice definition of the form nDS + offset and change\n * the n part.\n * @param {string} multidice - multidice definition\n * @param {number} delta - can be negative\n * @returns {string} multidice definition.\n */\nexport function changeQtyOfDice(dice, delta) {\n  const details = getDiceDetails(dice);\n  if (!details) {\n    return dice;\n  }\n  details.qty = Math.max(details.qty + delta, 0);\n  return getDiceDetailsAsString(details);\n}\n\n/**\n * @typedef {Object} DiceDetails\n * @property {number} qty\n * @property {sides} sides\n * @property {offset} offset\n */\n/**\n * Take a multidice definition of the form nDS + offset get the number of dice.\n * @param {string} multidice - multidice definition\n * @returns {DiceDetails}\n */\nexport function getDiceDetails(dice) {\n  const match = dice?.match(MULTIDICE_REGEX);\n  if (!match) {\n    LOG.error(`Invalid dice format: ${dice}`);\n    return {\n      qty: 0,\n      sides: 0,\n      offset: 0,\n    };\n  }\n  const qty = parseInt(match[1]);\n  const sides = parseInt(match[2]);\n  const offsetSign = match[3];\n  let offset = match[4] ? parseInt(match[4]) : 0;\n  if (offsetSign === '-') {\n    offset = -offset;\n  }\n\n  return {\n    qty: qty,\n    sides: sides,\n    offset: offset,\n  };\n}\n\n/**\n * Convert dice details to a string.\n * @param {DiceDetails} details\n * @returns {string}\n */\nexport function getDiceDetailsAsString(details) {\n  if (!details) {\n    return '';\n  } else if (details.offset) {\n    return `${details.qty}D${details.sides}+${details.offset}`;\n  } else {\n    return `${details.qty}D${details.sides}`;\n  }\n}\n","/**\n * @file Tables for DND\n *\n * @module dnd/tables\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport * as maths from '../utils/maths.js';\n\nconst CHALLENGE_XP_TABLE = [\n  10, 200, 450, 700, 1100, 1800, 2300, 2900, 3900, 5000, 5900, 7200, 8400,\n  10000, 11500, 13000, 15000, 18000, 20000, 22000, 25000, 33000, 41000, 50000,\n  62000, 75000, 90000, 105000, 120000, 135000, 155000,\n];\n\n/** advancement table. NB. this is zero based whereas level is 1 based.\n * Refer to Beyond 1st Level, p56 in https://media.wizards.com/2023/downloads/dnd/SRD_CC_v5.1.pdf\n */\nconst ADVANCEMENT_TABLE = [\n  { exp: 0, profBonus: 2 }, // level 1\n  { exp: 300, profBonus: 2 }, // level 2\n  { exp: 900, profBonus: 2 }, // level 3\n  { exp: 2700, profBonus: 2 }, // level 4\n\n  { exp: 6500, profBonus: 3 }, // level 5\n  { exp: 14000, profBonus: 3 }, // level 6\n  { exp: 23000, profBonus: 3 }, // level 7\n  { exp: 34000, profBonus: 3 }, // level 8\n\n  { exp: 48000, profBonus: 4 }, // level 9\n  { exp: 64000, profBonus: 4 }, // level 10\n  { exp: 85000, profBonus: 4 }, // level 11\n  { exp: 100000, profBonus: 4 }, // level 12\n\n  { exp: 120000, profBonus: 5 }, // level 13\n  { exp: 140000, profBonus: 5 }, // level 14\n  { exp: 165000, profBonus: 5 }, // level 15\n  { exp: 195000, profBonus: 5 }, // level 16\n\n  { exp: 225000, profBonus: 6 }, // level 17\n  { exp: 265000, profBonus: 6 }, // level 18\n  { exp: 305000, profBonus: 6 }, // level 18\n  { exp: 355000, profBonus: 6 }, // level 20\n];\n\n/**\n * Get experience points based on challenge rating\n * @param {number|string} crValue - challenge rating.\n * @returns {number}\n */\nexport function getXpFromCr(cr) {\n  let crValue = maths.safeParseFloat(cr);\n\n  if (crValue < 0.124) {\n    return 10;\n  } else if (crValue < 0.249) {\n    return 25;\n  } else if (crValue < 0.499) {\n    return 50;\n  } else if (crValue < 0.999) {\n    return 100;\n  }\n\n  crValue = Math.min(CHALLENGE_XP_TABLE.length - 1, parseInt(crValue));\n  return CHALLENGE_XP_TABLE[crValue];\n}\n\n/**\n * Get level and proficiency bonus from experience.\n * @param {string|number} exp - experience points.\n * @returns {{level:number, profBonus: number}}\n */\nexport function getLevelAndProfBonusFromExp(exp) {\n  const expValue = maths.safeParseInt(exp, 0);\n  let level = 0;\n  let index = 0;\n  do {\n    const next = ADVANCEMENT_TABLE[index++];\n    if (expValue >= next.exp) {\n      level = index;\n    } else {\n      break;\n    }\n  } while (index < ADVANCEMENT_TABLE.length);\n\n  return { level: level, profBonus: ADVANCEMENT_TABLE[level - 1].profBonus };\n}\n\n/**\n * Get min experience points for level.\n * @param {number} level\n */\nexport function getMinExpPointsForLevel(level) {\n  level = Math.min(level, ADVANCEMENT_TABLE.length);\n  level--; // array is zero based.\n  if (level < 0) {\n    return ADVANCEMENT_TABLE[0].exp;\n  }\n  return ADVANCEMENT_TABLE[level].exp;\n}\n","/**\n * @file Generator for standard characters\n *\n * @module dnd/abilityGenerator\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as maths from '../utils/maths.js';\n\n/**\n * Array of ability value ranges. The first element is used for the first ability\n * @type {Array.Array<min:number, max:number>}\n */\nconst TRAIT_RANGE = [\n  [13, 15],\n  [12, 14],\n  [11, 13],\n  [8, 13],\n  [8, 13],\n  [8, 13],\n];\n\n/**\n * @type {Array.Array<min:number, max:number>}\n */\nconst DEFAULT_RANGE = [8, 15];\n\n/**\n * Order of abilities for character classes.\n * @type {Map<string, Array.<string>>}\n */\nconst CLASS_TRAIT_ORDER = new Map([\n  ['BARBARIAN', ['STR', 'CON', 'DEX', 'INT', 'WIS', 'CHA']],\n  ['CLERIC', ['WIS', 'CON', 'STR', 'CHA', 'INT', 'DEX']],\n  ['FIGHTER', ['STR', 'CON', 'DEX', 'INT', 'WIS', 'CHA']],\n  ['RANGER', ['STR', 'DEX', 'CON', 'INT', 'WIS', 'CHA']],\n  ['ROGUE', ['DEX', 'INT', 'CHA', 'STR', 'CON', 'WIS']],\n  ['WIZARD', ['INT', 'WIS', 'STR', 'CON', 'DEX', 'CHA']],\n  ['DEFAULT', ['STR', 'CON', 'DEX', 'INT', 'WIS', 'CHA']],\n]);\n\n/**\n * @typedef {Object} AttackModifiers\n * @property {number} pbMultiplier - multiplication factor for proficiency bonuses\n */\n/**\n * Attack modifiers\n * @type {Map<string, AttackModifiers>}\n */\nconst CLASS_ATTACK_MODIFIERS = new Map([\n  ['ROGUE', { pbMultiplier: 2 }],\n  ['DEFAULT', { pbMultiplier: 1 }],\n]);\n\n/**\n * Trait adjustments for level changes.\n * The array holds the levels at which a trait adjustment takes place. These\n * are indexes into the classes CLASS_TRAIT_ORDER\n * @type {Map<string, number[]}\n */\nconst CLASS_TRAIT_ADJUSTMENT_LEVELS = new Map([\n  ['BARBARIAN', [4, 8, 12, 16, 19]],\n  ['CLERIC', [4, 8, 12, 16, 19]],\n  ['FIGHTER', [4, 6, 8, 12, 14, 16, 19]],\n  ['RANGER', [4, 8, 12, 16, 19]],\n  ['ROGUE', [4, 8, 10, 12, 16, 19]],\n  ['WIZARD', [4, 8, 12, 16, 19]],\n]);\n\n/**\n * Get set of abilities for a character class.\n * @param {string} characterClass\n * @returns {Map<string, number>}\n */\nexport function getClassAbilities(characterClass) {\n  const result = new Map();\n  const keys =\n    CLASS_TRAIT_ORDER.get(characterClass) ?? CLASS_TRAIT_ORDER.get('DEFAULT');\n  for (let index = 0; index < keys.length; index++) {\n    const range =\n      index < TRAIT_RANGE.length ? TRAIT_RANGE[index] : DEFAULT_RANGE;\n    const value = maths.getRandomIntInclusive(range[0], range[1]);\n    result.set(keys[index], value);\n  }\n  return result;\n}\n\n/**\n * Get attack modifiers.\n * @param {string} characterClass\n * @returns {AttackModifiers}\n */\nexport function getAttackModifiers(characterClass) {\n  return (\n    CLASS_ATTACK_MODIFIERS.get(characterClass) ??\n    CLASS_ATTACK_MODIFIERS.get('DEFAULT')\n  );\n}\n\n/**\n * @typedef {Object} LevelAdjustmentDetails\n * @property {number[]} levels - array of levels at which an adjustment should be made.\n * @property {string[]} traits - array of traits in the order at which adjustments should be made\n * @property {number} gainPerAdjustment - total amount abilities can be changed.\n * @property {number} maxAbility - maximum an ability can rise to.\n */\n/**\n * Get the trait adjustments for a level change.\n * Normally only one level change is expected.\n * @param {string} characterClass\n * @returns {number[]} array of levels at which characteristics should be adjusted. Undefined if none.\n */\nexport function getTraitAdjustmentDetails(characterClass) {\n  return {\n    levels: CLASS_TRAIT_ADJUSTMENT_LEVELS.get(characterClass) ?? [],\n    traits:\n      CLASS_TRAIT_ORDER.get(characterClass) ?? CLASS_TRAIT_ORDER.get('DEFAULT'),\n    gainPerAdjustment: 2,\n    maxAbility: 20,\n  };\n}\n","/**\n * @file DnD dice rolls.\n *\n * @module dnd/dndAction\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as dice from '../utils/dice.js';\nimport LOG from '../utils/logging.js';\nimport { characteristicToModifier, AttackDetail } from './traits.js';\nimport * as magic from './magic.js';\nimport { AttackMode } from '../players/actors.js';\n\n/** @type number */\nexport const MEALS_FOR_LONG_REST = 3;\nexport const DRINKS_FOR_LONG_REST = 3;\n\nexport const MEALS_FOR_SHORT_REST = 1;\nexport const DRINKS_FOR_SHORT_REST = 1;\n\n/**\n * @typedef {number} DifficultyValue\n */\n/**\n * @enum {DifficultyValue}\n */\nexport const Difficulty = {\n  VERY_EASY: 5,\n  EASY: 10,\n  MEDIUM: 15,\n  HARD: 20,\n  VERY_HARD: 25,\n  NEARLY_IMPOSSIBLE: 30,\n  IMPOSSIBLE: 999,\n};\n\n/**\n * Roll an attack and damage dice.\n * @param {module:dnd/traits~AttackDetail} attack\n * @param {module:dnd/traits.CharacterTraits} targetTraits\n * @returns {number} amount of damage\n */\nexport function getMeleeDamage(attack, targetTraits) {\n  const attackRoll = attack.rollForAttack();\n  // handle fate and curses.\n  if (attackRoll.roll === 1) {\n    LOG.info('Attack dice rolled 0: cursed.');\n    return 0; // cursed.\n  } else if (attackRoll.roll === 20) {\n    LOG.info('Attack dice rolled 20: critical hit. Damage will be doubled.');\n    return 2 * attack.rollForDamage(); // critical hit\n  }\n\n  const targetAc = targetTraits.getEffectiveInt('AC');\n  LOG.info(`Melee: attack roll ${attackRoll.value} vs target AC ${targetAc}`);\n  if (attackRoll.value >= targetAc) {\n    return attack.rollForDamage();\n  }\n  return 0;\n}\n\n/**\n * Poison with saving throw.\n * @param {module:dnd/traits.Traits} attackerTraits\n * @param {module:dnd/traits.CharacterTraits} targetTraits\n * @returns {number}\n */\nexport function getPoisonDamage(attackerTraits, targetTraits) {\n  const damageDice =\n    attackerTraits.get('DMG_POISON') ?? attackerTraits.get('DMG', '1D4');\n  const damage = dice.rollMultiDice(damageDice);\n  const saveModifier =\n    targetTraits.getNonMeleeSaveAbilityModifier(attackerTraits);\n  const difficulty = attackerTraits.getInt('DC');\n  if (!difficulty) {\n    LOG.error(`Poisoner ${attackerTraits.get('NAME')} has no DC set.`);\n    return damage;\n  }\n  const saveRoll = dice.rollDice(20);\n  LOG.info(\n    `Poison: save roll ${saveRoll} + modifier ${saveModifier} vs target DC ${difficulty}`\n  );\n  if (saveRoll + saveModifier >= difficulty) {\n    const factor = attackerTraits.getFloat('DMG_SAVED', 0);\n    return Math.round(factor * damage);\n  } else {\n    return damage;\n  }\n}\n\n/**\n * Get consumption benefit in HP, clipped to HP max.\n * @param {module:dnd/traits.Traits} consumableTraits\n * @param {module:dnd/traits.Traits} consumerTraits\n * @returns {{shortFall:number, oldHp:number, newHp:number, detoxified: boolean}}\n */\nexport function getConsumptionBenefit(consumableTraits, consumerTraits) {\n  const gain = consumableTraits.getInt('HP', 0);\n  const currentHp = consumerTraits.getInt('HP', 0);\n  const maxHp = consumerTraits.getInt('HP_MAX', currentHp);\n  const shortFall = maxHp - currentHp;\n  const appliedGain = shortFall < 0 ? 0 : Math.min(shortFall, gain);\n\n  return {\n    shortFall: shortFall,\n    oldHp: currentHp,\n    newHp: currentHp + appliedGain,\n    detoxify: consumableTraits.get('DETOXIFY', false),\n  };\n}\n\n/**\n * Get the spell damage. Uses the ATTACK to determine the mechanics used.\n * @param {module:dnd/traits.CharacterTraits} attackerTraits\n * @param {module:dnd/traits.CharacterTraits} targetTraits\n * @param {module:dnd/traits.MagicTraits} spellTraits\n * @returns {number}\n */\nexport function getSpellDamage(attackerTraits, targetTraits, spellTraits) {\n  if (targetTraits.get('UNDEAD') && spellTraits.get('UNDEAD_IMMUNE')) {\n    LOG.info(`Spell does not work on the undead.`);\n    return 0;\n  }\n  switch (spellTraits.get('MODE')) {\n    case 'MELEE':\n    case 'VAMPIRIC MELEE':\n      return getSpellMeleeDamage(attackerTraits, targetTraits, spellTraits);\n    default:\n      return getSpellNormalDamage(attackerTraits, targetTraits, spellTraits);\n  }\n}\n\n/**\n * Magic with using melee attack mechanics.\n * @param {module:dnd/traits.CharacterTraits} attackerTraits\n * @param {module:dnd/traits.CharacterTraits} targetTraits\n * @param {module:dnd/traits.MagicTraits} spellTraits\n * @returns {number}\n */\nfunction getSpellMeleeDamage(attackerTraits, targetTraits, spellTraits) {\n  const spellCastAbility = attackerTraits.get('SPELL_CAST', 'INT');\n  const spellCastAbilityValue = attackerTraits.getEffectiveInt(\n    spellCastAbility,\n    1\n  );\n  let damageDice;\n  if (spellTraits.getDamageDiceWhenCastBy) {\n    damageDice = spellTraits.getDamageDiceWhenCastBy(attackerTraits);\n  } else {\n    damageDice = spellTraits.get('DMG', '1D4');\n  }\n  const attack = new AttackDetail({\n    damageDice: damageDice,\n    weaponType: 'UNARMED',\n    proficiencyBonus: attackerTraits.getCharacterPb(spellTraits),\n    abilityModifier: characteristicToModifier(spellCastAbilityValue),\n  });\n  return getMeleeDamage(attack, targetTraits);\n}\n\n/**\n * Magic with saving throw.\n * @param {module:dnd/traits.CharacterTraits} attackerTraits\n * @param {module:dnd/traits.CharacterTraits} targetTraits\n * @param {module:dnd/traits.MagicTraits} spellTraits\n * @returns {number}\n */\nexport function getSpellNormalDamage(\n  attackerTraits,\n  targetTraits,\n  spellTraits\n) {\n  const saveModifier = targetTraits.getNonMeleeSaveAbilityModifier(spellTraits);\n  let spellModifier = 0;\n  let attackLabel;\n  if (attackerTraits.get('ATTACK') === AttackMode.RANGED) {\n    attackLabel = 'Ranged attack';\n  } else {\n    attackLabel = 'Magic';\n    const spellCastAbility = attackerTraits.get('SPELL_CAST', 'INT');\n    const spellCastAbilityValue = attackerTraits.getInt(spellCastAbility, 1);\n    spellModifier =\n      attackerTraits.getCharacterPb(spellTraits) +\n      characteristicToModifier(spellCastAbilityValue);\n  }\n\n  let difficulty = spellTraits.getInt('DC');\n  if (difficulty === null || difficulty === undefined) {\n    LOG.error(`${attackLabel} ${attackerTraits.get('NAME')} has no DC set.`);\n    difficulty = 0;\n  }\n\n  const fullDifficulty = difficulty + spellModifier;\n  let savingThrow = dice.rollDice(20) + saveModifier;\n  let damageDice;\n  if (spellTraits.getDamageDiceWhenCastBy) {\n    damageDice = spellTraits.getDamageDiceWhenCastBy(attackerTraits);\n  } else {\n    damageDice = spellTraits.get('DMG', '1D4');\n  }\n  const damage = dice.rollMultiDice(damageDice);\n  LOG.info(\n    `${attackLabel}: saving throw ${savingThrow} vs target DC ${fullDifficulty}`\n  );\n  if (savingThrow >= fullDifficulty) {\n    const factor = spellTraits.getFloat('DMG_SAVED', 0);\n    return Math.round(factor * damage);\n  } else {\n    return damage;\n  }\n}\n\n/**\n * Get HP gain from spell.\n * @param {module:dnd/traits.CharacterTraits} casterTraits\n * @param {module:dnd/traits.CharacterTraits} targetTraits\n * @param {module:dnd/traits.MagicTraits} spellTraits\n * @returns {number}\n */\nexport function getSpellHpGain(casterTraits, targetTraits, spellTraits) {\n  if (!spellTraits.has('HP_GAIN')) {\n    return 0;\n  }\n  let hpGainDice;\n  if (spellTraits.getHpGainDiceWhenCastBy) {\n    hpGainDice = spellTraits.getHpGainDiceWhenCastBy(casterTraits);\n  } else {\n    hpGainDice = spellTraits.get('HP_GAIN', 0);\n  }\n  const result = dice.rollMultiDice(hpGainDice);\n  const currentHp = targetTraits.getInt('HP');\n  const hpMax = targetTraits.getInt('HP_MAX');\n  return Math.min(result, hpMax - currentHp);\n}\n\n/**\n * @typedef {string} RestFailureValue\n */\n/**\n * @enum {RestFailureValue}\n */\nexport const RestFailure = {\n  NONE: '',\n  NEED_LONG_REST: 'need long rest',\n  NEED_MORE_RATIONS: 'need more rations',\n};\n\n/**\n * Get the number of hit dice remaining.\n * @param {Traits} traits - actor's traits.\n * @returns {number}\n */\nexport function getNumberOfRemainingHitDice(traits) {\n  const hitDice = traits.get('HIT_DICE', '0D6');\n  return dice.getDiceDetails(hitDice).qty - traits.getInt('SPENT_HIT_DICE');\n}\n/**\n * @typedef {Object} RestDetails\n * @property {boolean} possible\n * @property {RestFailureValue} failure\n */\n/**\n * Test if a rest can be taken.\n * A long rest takes 8 hours and cannot occur more than once.\n * So in this game we require three meals and a drink to mimic a full day.\n * For a short rest, we require 1 meal and a drink is all the rations that are required.\n * However, a short rest requires a hit dice and if these have run out, a long rest\n * is necessary.\n * @param {number} nMeals - number of meals available\n * @param {number} nDrinks - number of drinks available\n * @param {Traits} traits = actor's traits.\n * @returns {{shortRest: RestDetails, longRest: RestDetail}}\n */\nexport function canRest(nMeals, nDrinks, traits) {\n  const shortRest = { possible: true, failure: RestFailure.NONE };\n  const longRest = { possible: true, failure: RestFailure.NONE };\n  const availableDice = getNumberOfRemainingHitDice(traits);\n  if (availableDice < 1) {\n    shortRest.possible = false;\n    shortRest.failure = RestFailure.NEED_LONG_REST;\n  } else if (nMeals < MEALS_FOR_SHORT_REST || nDrinks < DRINKS_FOR_SHORT_REST) {\n    shortRest.possible = false;\n    shortRest.failure = RestFailure.NEED_MORE_RATIONS;\n  }\n  if (nMeals < MEALS_FOR_LONG_REST || nDrinks < DRINKS_FOR_LONG_REST) {\n    longRest.possible = false;\n    longRest.failure = RestFailure.NEED_MORE_RATIONS;\n  }\n\n  return {\n    shortRest: shortRest,\n    longRest: longRest,\n  };\n}\n\n/**\n * Take a rest.\n * @param {module:players/actors.Actor} actor\n * @param {string} length - LONG or SHORT\n * @returns {{oldHp: number, newHp: number}}\n */\nexport function takeRest(actor, length) {\n  const currentHp = actor.traits.getInt('HP', 0);\n  let newHp = currentHp;\n  switch (length) {\n    case 'SHORT':\n      {\n        const hitDice = actor.traits.get('HIT_DICE');\n        const spentHitDice = actor.traits.getInt('SPENT_HIT_DICE', 0);\n        const hpMax = actor.traits.getInt('HP_MAX', currentHp);\n        const constitutionModifier = actor.traits.getAsModifier('CON');\n        const diceDetails = dice.getDiceDetails(hitDice);\n        const availableHitDice = diceDetails.qty - spentHitDice;\n        if (availableHitDice > 0) {\n          newHp =\n            currentHp + dice.rollDice(diceDetails.sides) + constitutionModifier; // just roll one.\n          newHp = Math.min(newHp, hpMax);\n          actor.traits.set('HP', newHp);\n          actor.traits.set('SPENT_HIT_DICE', spentHitDice + 1);\n        }\n        actor.toxify?.cure();\n      }\n      break;\n    case 'LONG':\n      {\n        const hitDice = actor.traits.get('HIT_DICE');\n        const diceDetails = dice.getDiceDetails(hitDice);\n        const recoveredHitDice = Math.max(1, Math.ceil(0.5 * diceDetails.qty));\n        let spentDice =\n          actor.traits.getInt('SPENT_HIT_DICE', 0) - recoveredHitDice;\n        spentDice = Math.max(0, spentDice);\n        actor.traits.set('SPENT_HIT_DICE', spentDice);\n\n        newHp = actor.traits.getInt('HP_MAX', currentHp);\n        actor.traits.set('HP', newHp);\n        magic.restoreCastingPower(actor.traits);\n        actor.toxify?.cure();\n      }\n      break;\n    default:\n      LOG.error(`Attempt to rest for unknown length of ${length}`);\n  }\n  return {\n    oldHp: currentHp,\n    newHp: newHp,\n  };\n}\n\n/**\n * Detect a trap. Uses wisdom unless DETECT_BY is set.\n * @param {module:dnd/traits.Traits} detectorTraits\n * @param {module:dnd/trapCharacteristics.TrapDetails} trapDetails\n */\nexport function canDetectTrap(detectorTraits, trapDetails) {\n  return canPerformTask(detectorTraits, {\n    ability: trapDetails.detectBy,\n    difficulty: trapDetails.difficulty,\n    proficiency: 'TRAPS',\n  });\n}\n\n/**\n * Can disable trap. Uses intelligence unless DISABLE_BY is set.\n * @param {module:dnd/traits.Traits} detectorTraits\n * @param {module:dnd/trapCharacteristics.TrapDetails} trapDetails\n */\nexport function canDisableTrap(detectorTraits, trapDetails) {\n  return canPerformTask(detectorTraits, {\n    ability: trapDetails.disableBy,\n    difficulty: trapDetails.difficulty,\n    proficiency: 'TRAPS',\n  });\n}\n\n/**\n * Can steal from trader.\n * @param {module:dnd/traits.Traits} robberTraits\n * @param {module:dnd/traits.Traits} traderTraits\n */\nexport function canSteal(robberTraits, traderTraits) {\n  return canPerformTask(robberTraits, {\n    ability: 'DEX',\n    difficulty: traderTraits.getInt('DC', Difficulty.HARD),\n    proficiency: 'STEALING',\n  });\n}\n\n/**\n * Can pick a lock. The difficulty of the task comes from\n * the keyTraits.\n * @param {module:dnd/traits.CharacterTraits} robberTraits\n * @param {module:dnd/traits.Traits} keyTraits\n */\nexport function canPickLock(robberTraits, keyTraits) {\n  return canPerformTask(robberTraits, {\n    ability: 'DEX',\n    difficulty: keyTraits.get('DC', Difficulty.EASY),\n    proficiency: 'PICK LOCK',\n  });\n}\n\n/**\n * Can identify an object. The difficulty of the task comes from\n * the keyTraits. The wisdom ability is used.\n * @param {module:dnd/traits.CharacterTraits} identifierTraits\n * @param {module:dnd/traits.Traits} objectTraits\n */\nexport function canIdentify(identifierTraits, objectTraits) {\n  return canPerformTask(identifierTraits, {\n    ability: 'WIS',\n    difficulty: objectTraits.get('IDENTIFY_DC', Difficulty.EASY),\n    proficiency: objectTraits.get('SUBTYPE'),\n  });\n}\n\n/**\n * Can perform task.\n * @param {module:dnd/traits.CharacterTraits} pickerTraits\n * @param {Object} task\n * @param {string} task.ability -e.g. DEX\n * @param {string} task.proficiency - e.g. 'PICK LOCK'\n * @param {number} task.difficulty - e.g. Difficulty.HARD\n * @returns {boolean}\n */\nexport function canPerformTask(pickerTraits, task) {\n  const abilityValue = pickerTraits.getEffectiveInt(task.ability, 1);\n  const modifier = characteristicToModifier(abilityValue);\n  const profBonus = task.proficiency\n    ? pickerTraits.getCharacterPb(task.proficiency)\n    : 0;\n  const pickRoll = dice.rollDice(20) + modifier + profBonus;\n  return pickRoll >= task.difficulty;\n}\n","/**\n * @file Functions for handling magic\n *\n * @module dnd/magic\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport LOG from '../utils/logging.js';\n\n/**\n * The 5e edition spell system uses 9 spell slots.\n * This system has been simplified. In the 5e a 20th level wizard has slots\n * for two level 9 spells and 12 level 1 spells (if using other higher level slots).\n * So, we will take a level 9 spell as\n * equivalent to six level 1 spells. Applying this to any spell level\n * and using a level one spell as the base spell power unit, we get:\n * spellPower = 1 + 5 * (level - 1) / 8. This gives the following\n * powers:\n *\n * - level 1: 1\n * - level 2: 2\n * - level 3: 2\n * - level 4: 3\n * - level 5: 4\n * - level 6: 4\n * - level 7: 5\n * - level 8: 5\n * - level 9: 6\n *\n * From 5e, a wizard at level 20 has 22 slots and two at level 1.\n * So the available slots can be approximated as\n *\n * > slots = 2 + 20 * (characterLevel - 1) / 19\n *\n * Then taking the average spell power as four, we can assign\n * a total power availability of\n *\n * > total power = 4 * (2 + 20 * (characterLevel - 1) / 19)\n *\n * This results in the following values as examples.\n *\n * Level 1 character: power = 4; equivalent to 4 level 1 spells.\n * Level 20 character: power = 22; equivalent to 22 level 1 spell.\n */\n\n/**\n * Get the power of a spell in equivalent level 1 spells.\n * @param {Traits} spellTraits\n * @returns {number} equivalent number of level one spells.\n */\nexport function getSpellPower(spellTraits) {\n  const level = spellTraits.getInt('LEVEL', 1);\n  return Math.round(1 + (5 * (level - 1)) / 8);\n}\n\n/**\n * Convert a character level to its equivalent spell level.\n * This is a simplified magic system. From 5e, magic users hit spell level 9\n * by character level 17. Available spell levels are interpolated from 1 to 9\n * across character levels 1 to 17.\n * @param {number} characterLevel 1 to 20\n * @returns {number} spell level 1 to 9\n */\nexport function characterLevelToSpellLevel(characterLevel) {\n  return Math.min(Math.round(1 + (8 * (characterLevel - 1)) / 16), 9);\n}\n/**\n * This is a simplified magic system. From 5e, magic users hit spell level 9\n * by character level 17. Available spell levels are interpolated from 1 to 9\n * across character levels 1 to 17.\n * @param {module:dnd/traits.CharacterTraits} actorTraits\n * @param {module:dnd/traits.Traits} magicTraits\n * @returns {boolean}\n */\nexport function canActorLearnMagic(actorTraits, magicTraits) {\n  // check level\n  const actorLevel = actorTraits.getCharacterLevel();\n  const spellLevel = magicTraits.getInt('LEVEL', 0);\n  const maxSpellLevel = characterLevelToSpellLevel(actorLevel);\n\n  if (spellLevel > maxSpellLevel) {\n    LOG.info(\n      `${actorTraits.get(\n        'NAME'\n      )} cannot learn level ${spellLevel} ${magicTraits.get(\n        'NAME'\n      )} as too high.`\n    );\n    return false;\n  }\n\n  //check casters\n  const casters = magicTraits.get('CASTERS');\n  if (!casters) {\n    LOG.info(\n      `No casters set for ${magicTraits.get('NAME')} so can be learned.`\n    );\n    return true; // no limitations\n  }\n  const actorClass = actorTraits.get('CLASS');\n  if (!casters.includes(actorClass)) {\n    LOG.info(\n      `${actorTraits.get('NAME')} cannot learn ${magicTraits.get(\n        'NAME'\n      )} as not in casters.`\n    );\n    return false;\n  }\n  return true;\n}\n\n/**\n * Get the actor's available casting power.\n * If the trait does not exist, it is recreated at the max level.\n * @param {module:dnd/Traits.CharacterTraits} casterTraits\n * @return {number}\n */\nexport function getCastingPower(casterTraits) {\n  const availablePower = casterTraits.getInt('CASTING_POWER');\n  if (casterTraits.has('CASTING_POWER')) {\n    return availablePower;\n  } else {\n    return restoreCastingPower(casterTraits);\n  }\n}\n/**\n * Use some of the actor's casting power.\n * @param {module:dnd/Traits.CharacterTraits} casterTraits\n * @param {module:dnd/Traits.Traits} spellTraits\n */\nexport function useCastingPower(casterTraits, spellTraits) {\n  const spellPower = getSpellPower(spellTraits);\n  const availablePower = getCastingPower(casterTraits);\n  const remaining = Math.max(0, availablePower - spellPower);\n  casterTraits.set('CASTING_POWER', remaining);\n}\n\n/**\n * Test if actor has enough power to cast a spell.\n * @param {module:dnd/Traits.Traits} casterTraits\n * @param {module:dnd/Traits.Traits} spellTraits\n * @returns {boolean}\n */\nexport function canCastSpell(casterTraits, spellTraits) {\n  const spellPower = getSpellPower(spellTraits);\n  const availablePower = getCastingPower(casterTraits);\n  return availablePower >= spellPower;\n}\n\n/**\n * Restore casting power to max.\n * @param {module:dnd/Traits.CharacterTraits} casterTraits\n * @returns {number}\n */\nexport function restoreCastingPower(casterTraits) {\n  const characterLevel = casterTraits.getCharacterLevel();\n  const maxPower = Math.round(4 * (2 + (20 * (characterLevel - 1)) / 19));\n  casterTraits.set('CASTING_POWER', maxPower);\n  return maxPower;\n}\n\n/**\n * Test if bless spell can be used. Bless spells can only be used\n * when the target's HP are <= spellTraits MAX_TARGET_HP value.\n * If MAX_TARGET_HP is not set, a value of 999 is used.\n * @param {module:dnd/traits.CharacterTraits} casterTraitsUnused\n * @param {module:dnd/traits.CharacterTraits} targetTraits\n * @param {module:dnd/traits.MagicTraits} spellTraits\n * @returns {boolean}\n */\nexport function canBless(casterTraitsUnused, targetTraits, spellTraits) {\n  const maxTargetHp = spellTraits.getInt('MAX_TARGET_HP', 999);\n  const targetHp = targetTraits.getInt('HP');\n  if (targetHp > maxTargetHp) {\n    LOG.info(\n      `Targets's HP (${targetHp}) is above max target hp of ${maxTargetHp}. Spell failed.`\n    );\n    return false;\n  }\n  return true;\n}\n","/**\n * @file Almanacs\n *\n * @module dnd/almanacs/almanacs\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../../utils/logging.js';\nimport * as almanacUtils from './almanacUtils.js';\nimport * as assetLoaders from '../../utils/assetLoaders.js';\nimport { strToActorType } from '../../players/actors.js';\nimport { strToArtefactType } from '../../players/artefacts.js';\nimport * as maths from '../../utils/maths.js';\n\n/** Cutoff points according to rarity. Scale is 0 to 1 so these given the proportion */\nconst COMMON_CUTOFF = 0.8;\nconst UNCOMMON_CUTOFF = 0.95;\nconst RARE_CUTOFF = 0.99;\n//const VERY_RARE_CUTOFF = 1;\n\n/** @typedef {string} AlmanacRarityValue */\n/**\n * @enum {AlmanacRarityValue}\n */\nexport const AlmanacRarity = {\n  COMMON: 'COMMON',\n  UNCOMMON: 'UNCOMMON',\n  RARE: 'RARE',\n  VERY_RARE: 'VERY_RARE',\n};\n\n/**\n * @typedef {Object} AlmanacEntry\n * @property {number} minLevel\n * @property {string} id\n * @property {string} rarity - COMMON, UNCOMMON, RARE, VERY_RARE\n * @property {string} imageName\n * @property {string} description\n * @property {string} identification\n * @property {string} typeId\n * @property {ArtefactType | ActorType} type\n * @property {string} equipmentIds - comma separated equipment list\n * @property {string} traitsString\n * @property {number} challengeRating - just used for searching the almanac\n */\n\n/**\n * Encapsulation of an almanac\n */\nexport class Almanac {\n  /** @type {AlmanacEntry[]} */\n  common;\n  /** @type {AlmanacEntry[]} */\n  uncommon;\n  /** @type {AlmanacEntry[]} */\n  rare;\n  /** @type {AlmanacEntry[]} */\n  veryRare;\n\n  /**\n   * Create the almanac\n   */\n  constructor() {\n    this.common = [];\n    this.uncommon = [];\n    this.rare = [];\n    this.veryRare = [];\n  }\n\n  /**\n   * Merge almanac with this.\n   * @param {Almanac} almanac\n   */\n  mergeAlmanac(almanac) {\n    this.common.push(...almanac.common);\n    this.uncommon.push(...almanac.uncommon);\n    this.rare.push(...almanac.rare);\n    this.veryRare.push(...almanac.veryRare);\n  }\n\n  /** Find first element matching the callback. The search starts with common entries and moves on to\n   * rare.\n   * @param {function(element:AlmanacEntry, index:number, AlmanacEntry[]):truthy} callback\n   * @returns {AlmanacEntry} undefined if not found.\n   */\n  find(callback) {\n    let result = this.common.find(callback);\n    if (result) {\n      return result;\n    }\n    result = this.uncommon.find(callback);\n    if (result) {\n      return result;\n    }\n    result = this.rare.find(callback);\n    if (result) {\n      return result;\n    }\n    return this.veryRare.find(callback);\n  }\n\n  /** Create a new almanac filtering the values.\n   * @param {function(element:AlmanacEntry, index:number, AlmanacEntry[]):truthy} filterFn\n   * @returns {Almanac} undefined if not found.\n   */\n  filter(filterFn) {\n    const almanac = new Almanac();\n    almanac.common = filterFn ? this.common.filter(filterFn) : [...this.common];\n    almanac.uncommon = filterFn\n      ? this.uncommon.filter(filterFn)\n      : [...this.uncommon];\n    almanac.rare = filterFn ? this.rare.filter(filterFn) : [...this.rare];\n    almanac.veryRare = filterFn\n      ? this.veryRare.filter(filterFn)\n      : [...this.veryRare];\n    return almanac;\n  }\n\n  /**\n   * Get a random entry from the almanac.\n   * @returns {AlmanacEntry}\n   */\n  getRandomEntry() {\n    const cutoff = Math.random();\n    if (cutoff < COMMON_CUTOFF) {\n      return this.getRandomCommonEntry();\n    } else if (cutoff < UNCOMMON_CUTOFF) {\n      return this.getRandomUncommonEntry();\n    } else if (cutoff < RARE_CUTOFF) {\n      return this.getRandomRareEntry();\n    } else {\n      return this.getRandomVeryRareEntry();\n    }\n  }\n\n  /**\n   * Get a random entry from the almanac's common elements.\n   * @returns {AlmanacEntry}\n   */\n  getRandomCommonEntry() {\n    return maths.getRandomMember(this.common);\n  }\n  /**\n   * Get a random entry from the almanac's uncommon elements. If there are no\n   * uncommon entries, it falls back to common.\n   * @returns {AlmanacEntry}\n   */\n  getRandomUncommonEntry() {\n    if (this.uncommon.length === 0) {\n      return this.getRandomCommonEntry();\n    } else {\n      return maths.getRandomMember(this.uncommon);\n    }\n  }\n\n  /**\n   * Get a random entry from the almanac's rare elements. If there are no\n   * rare entries, it falls back to uncommon.\n   * @returns {AlmanacEntry}\n   */\n  getRandomRareEntry() {\n    if (this.rare.length === 0) {\n      return this.getRandomUncommonEntry();\n    } else {\n      return maths.getRandomMember(this.rare);\n    }\n  }\n  /**\n   * Get a random entry from the almanac's very rare elements. If there are no\n   * very rare entries, it falls back to rare.\n   * @returns {AlmanacEntry}\n   */\n  getRandomVeryRareEntry() {\n    if (this.veryRare.length === 0) {\n      return this.getRandomRareEntry();\n    } else {\n      return maths.getRandomMember(this.veryRare);\n    }\n  }\n}\n\nclass AlmanacLibrary {\n  /** @type {Map<string, Almanac>} */\n  #almanacs;\n\n  constructor() {\n    this.#almanacs = new Map();\n  }\n\n  /**\n   * Add Almanac\n   * @param {string} key\n   * @param {Almanac} almanac\n   */\n  addAlmanac(key, almanac) {\n    this.#almanacs.set(key, almanac);\n  }\n\n  /**\n   * Get Almanac\n   * @param {string} key\n   * @returns {Almanac}\n   */\n  getAlmanac(key) {\n    const result = this.#almanacs.get(key);\n    if (!result) {\n      LOG.error(`Attempt to get non-existent almanac ${key}`);\n    }\n    return result;\n  }\n  /**\n   * Get a random entry from the key\n   * @param {string | string[]} keyOrKeys - almanac\n   * @param {function(entry:AlmanacEntry):boolean} filterFn\n   * @returns {AlmanacEntry} null if none found.\n   */\n  getRandomEntry(keyOrKeys, filterFn) {\n    let key;\n    if (Array.isArray(keyOrKeys)) {\n      key = maths.getRandomMember(keyOrKeys);\n    } else {\n      key = keyOrKeys;\n    }\n    let almanac = this.getAlmanac(key).filter(filterFn);\n    if (almanac) {\n      return almanac.getRandomEntry();\n    }\n    LOG.error(`Failed to find almanac with key ${key}`);\n    return;\n  }\n\n  /** Find an entry by its id.\n   * @param {string} id\n   * @param {string[]} keys - the almanacs to search\n   * @returns {AlmanacEntry}\n   */\n  findById(id, keys) {\n    if (!keys) {\n      keys = this.#almanacs.keys();\n    }\n    for (const key of keys) {\n      const result = this.#almanacs.get(key)?.find((entry) => entry.id === id);\n      if (result) {\n        return result;\n      }\n    }\n    LOG.error(`Failed to find almanac entry for '${id}' in ${keys.join(', ')}`);\n    return;\n  }\n\n  /** Create a pool of almanacs as one new almanac.\n   * Only entries who pass the filterFn test, if provided, are returned.\n   * @param {string[]} keys - almanacs to search\n   * @param {function(entry:AlmanacEntry):boolean} filterFn\n   * @returns {Almanac}\n   */\n  getPooledAlmanac(almanacKeys, filterFn) {\n    const pooledAlmanac = new Almanac();\n    almanacKeys.forEach((key) => {\n      const almanac = this.getAlmanac(key).filter(filterFn);\n      pooledAlmanac.mergeAlmanac(almanac);\n    });\n    return pooledAlmanac;\n  }\n\n  /**\n   *\n   * @param {string} key - almanac key\n   * @param {*} type - entry type\n   * @returns {module:players/artefacts~ArtefactTypeValue | module:players/actors~ActorTypeValue }\n   */\n  getItemType(key, type) {\n    switch (key) {\n      case 'HEROES':\n      case 'ENEMIES':\n      case 'PORTALS':\n      case 'TRADERS':\n        return strToActorType(type);\n      default:\n        return strToArtefactType(type);\n    }\n  }\n}\n\n/**\n * Parse almanac line almanac entry\n * @param {string} line\n * @param {string} almanacKey\n * @returns {AlmanacEntry}\n */\nexport function parseAlmanacLine(line, almanacKey) {\n  const parts = line.match(\n    /^ *(\\d+) *, *(\\w+ ?\\w+) *, *(\\w+) *, *([\\w+?/]*) *(?:\\[ *([\\w, ]*?)])? *\\*(.*)$/\n  );\n  if (!parts) {\n    LOG.error(`Invalid almanac entry ${line}`);\n    return null;\n  }\n  const entry = {};\n  const traitsString = parts[6] ?? '';\n  entry.minLevel = parseInt(parts[1]);\n  entry.rarity = parts[2].toUpperCase();\n  entry.typeId = parts[3];\n  entry.type = ALMANAC_LIBRARY.getItemType(almanacKey, entry.typeId);\n  entry.id = parts[4];\n  const derivedParts = almanacUtils.derivePartsFromId(entry.id);\n  entry.name = derivedParts.name;\n  entry.imageName = derivedParts.imageName;\n  entry.description = derivedParts.description;\n  entry.unknownDescription = derivedParts.unknownDescription;\n  entry.equipmentIds = csvToArray(parts[5]);\n  entry.traitsString = `_TYPE_ID:${entry.typeId},${traitsString}`;\n  entry.challengeRating = extractCrValue(entry.traitsString);\n  return entry;\n}\n\n/**\n * Extract the CR rating as this is used as a filter.\n * @param {string} traits\n */\nfunction extractCrValue(traits) {\n  const match = traits?.match(/CR *[:=] *([\\d.]+)/);\n  return match ? maths.safeParseFloat(match[1], 0) : 0;\n}\n\n/**\n * Parse comma separated list of equipment ids into array.\n * @param {string} list\n * @returns {string[]}\n */\nfunction csvToArray(list) {\n  return list ? list.trim().split(/\\s*,\\s*/) : list;\n}\n\n/**\n * Parse text file into almanac\n * @param {string} text\n * @param {string} key - Almanac key\n * @returns {Almanac}\n */\nfunction parseAlmanacText(text, key) {\n  const almanac = new Almanac();\n  const lines = text.split(/[\\r\\n]+/);\n  lines.forEach((line) => {\n    line = line.trim();\n    if (line !== '' && !line.startsWith('#')) {\n      const entry = parseAlmanacLine(line, key);\n      if (entry) {\n        switch (entry.rarity) {\n          case AlmanacRarity.VERY_RARE:\n            almanac.veryRare.push(entry);\n            break;\n          case AlmanacRarity.RARE:\n            almanac.rare.push(entry);\n            break;\n          case AlmanacRarity.UNCOMMON:\n            almanac.uncommon.push(entry);\n            break;\n          case AlmanacRarity.COMMON:\n          default:\n            almanac.common.push(entry);\n            break;\n        }\n      }\n    }\n  });\n  return almanac;\n}\n\n/**\n * Create the actor almanac\n * @param {Map<string, URL>} urls\n * @returns {Promise} fulfils to undefined when complete\n */\nexport function loadAlmanacs(urlMap) {\n  LOG.debug(`Loading almanacs.`);\n  const promises = [];\n  urlMap.forEach((url, key) => {\n    const promise = assetLoaders.loadTextFromUrl(url).then((text) => {\n      const almanac = parseAlmanacText(text, key);\n      ALMANAC_LIBRARY.addAlmanac(key, almanac);\n    });\n    promises.push(promise);\n  });\n  return Promise.all(promises);\n}\n\n/**\n * @type {Map<string, Almanac>}\n */\nexport const ALMANAC_LIBRARY = new AlmanacLibrary();\n","/**\n * @file Utilities for working with almanacs\n *\n * @module dnd/almanacs/almanacUtils\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { MESSAGES } from '../../utils/messageManager.js';\nimport LOG from '../../utils/logging.js';\n\n/**\n * Takes an ID and creates name.\n * @param {string} [idMain = '?'] - id stripped of its suffix\n * @returns {string}\n */\nexport function createNameFromId(idMain = '?') {\n  if (idMain.len < 2) {\n    return idMain;\n  }\n  const name = idMain.replace(/_pv$/i, '').replace(/_/g, ' ');\n  const capitalisedName = name.charAt(0).toUpperCase() + name.substring(1);\n  return MESSAGES.getText(capitalisedName);\n}\n\n/**\n * Takes an ID and creates a description.\n * If no description an empty string is returned.\n * @param {string} id  - id stripped of its suffix\n * @returns {string}\n */\nexport function createDescriptionFromId(id) {\n  const messageKey = `DESCRIPTION ${id.toUpperCase()}`;\n  const result = MESSAGES.getText(messageKey);\n  if (messageKey === result) {\n    LOG.error(`No description set for ${messageKey}.`);\n    return '';\n  }\n  return result;\n}\n\n/**\n * Takes an ID including its extension and creates name, imageName, description.\n * If needsIdentification is true the identification is also added.\n * @param {string} [id = '?']\n * @returns {{name:string, imageName:string, description:string, unknownDescription: string}}\n */\nexport function derivePartsFromId(id = '?') {\n  const parts = id.match(/^(\\w+)([+?/])?(\\w*)?$/);\n  if (!parts) {\n    return {};\n  }\n  let nameId;\n  let imageId = parts[1];\n  let descriptionId;\n  let unknownDescriptionId;\n  switch (parts[2]) {\n    case '?':\n      nameId = imageId;\n      descriptionId = id;\n      unknownDescriptionId = imageId;\n      break;\n    case '+':\n      nameId = imageId;\n      descriptionId = imageId;\n      unknownDescriptionId = undefined;\n      break;\n    case '/':\n      nameId = parts[3];\n      descriptionId = parts[3];\n      unknownDescriptionId = undefined;\n      break;\n    default:\n      nameId = id;\n      descriptionId = id;\n      unknownDescriptionId = undefined;\n  }\n  return {\n    name: createNameFromId(nameId),\n    imageName: imageId.toLowerCase(),\n    description: createDescriptionFromId(descriptionId),\n    unknownDescription: unknownDescriptionId\n      ? createDescriptionFromId(unknownDescriptionId)\n      : undefined,\n  };\n}\n","/**\n * @file Load assets. This module is placed in the assets folder to simplify\n * dynamic imports using Parcel's import.meta.url property.\n *\n * @module utils/assetLoaders.js\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from './logging.js';\n\n/**\n * Load text file from URL.\n * @param {URL} url\n * @return {Promise} fulfils to text or null.\n */\nexport function loadTextFromUrl(url) {\n  return fetch(url)\n    .then((response) => response.text())\n    .then((text) => text)\n    .catch((reason) => {\n      LOG.error(`Error fetching ${url}: ${reason}`);\n      return null;\n    });\n}\n\n/**\n * Load json from URL.\n * @param {URL} url\n * @return {Promise} fulfils to json object or null.\n */\nexport function loadJsonFromUrl(url) {\n  return fetch(url)\n    .then((response) => response.text())\n    .then((text) => text)\n    .catch((reason) => {\n      LOG.error(`Error fetching ${url}: ${reason}`);\n      return null;\n    });\n}\n","/**\n * @file Scene manager\n *\n * @module gameManagement/sceneManager\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { parseSceneDefinition } from '../scriptReaders/sceneDefinitionParser.js';\nimport HUD from '../hud/hud.js';\nimport { NavigationButtons, NavigationLocation } from '../hud/hudNavSet.js';\nimport WORLD from '../utils/game/world.js';\nimport { CameraDolly, CameraTracking } from '../utils/game/camera.js';\nimport LOG from '../utils/logging.js';\n\n/**\n * @interface SceneList\n */\n/**\n * Get the next scene.\n * @function SceneList.getNext\n * @param{number} index\n * @returns {SceneDefinition}\n *\n */\n/**\n * Has another scene.\n * @function SceneList.hasNext\n * @returns {boolean}\n *\n */\n/**\n * Reset to the first scene.\n * @function SceneList.reset\n */\n\n/**\n * Get the scene index. This will be the index of the last scene retrieved by\n * a call to getNext.\n * @function SceneList.getIndex\n * @returns {number}\n */\n\n/**\n * Restore a saved game\n * @function SceneList.restore\n * @param {number} index\n * @param {module:players/actors.Actor} hero\n */\n\n/** @type {module:utils/sprites/sprite~Sprite}  */\nlet cameraDolly;\n\n/** @type {SceneList} */\nlet sceneDefnList;\n\nlet currentScene;\n\nlet navigationButtons;\n\n/**\n * Definition of a scene\n */\nexport class SceneDefinition {\n  /** @type {string} */\n  intro;\n  /** @type {Actor | ActorDefn} */\n  hero;\n  /** @type {ActorDefn[]} */\n  enemies;\n  /** @type {ActorDefn[]} */\n  artefacts;\n  /** @type {string[]} */\n  mapDesign;\n  /** @type {ActorDefn[]} */\n  portal;\n  /**\n   * Construct an empty scene\n   */\n  constructor() {\n    this.hero = null;\n    this.enemies = [];\n    this.artefacts = [];\n    this.mapDesign = [];\n  }\n}\n\n/**\n * Set camera dolly\n * @param {module:utils/sprites/sprite~Sprite} sprite\n * @param {number} speed - See {@link module:game/camera.createCameraDolly}\n * @param {number} proportionSeparated - See {@link module:game/camera.createCameraDolly}\n */\nfunction setCameraToTrack(sprite, speed, proportionSeparated) {\n  cameraDolly = new CameraDolly(sprite, speed, proportionSeparated);\n}\n\n/**\n * Create the HUD\n */\nfunction createHud() {\n  navigationButtons = new NavigationButtons(\n    cameraDolly,\n    48,\n    NavigationLocation.BR,\n    NavigationLocation.BL\n  );\n  HUD.setVisible(true);\n}\n\n/**\n * Clear the HUD.\n */\nfunction clearHud() {\n  navigationButtons = null;\n  HUD.clear();\n  HUD.setVisible(false);\n}\n/** Set the current scene, unloading any existing scene\n * @param {module:game/scene~Scene} scene\n * @returns {Promise} fulfils to undefined.\n * Rejects if scene is undefined or null.\n */\nfunction setScene(scene) {\n  if (!scene) {\n    LOG.error(\n      'Attempt made to switch to the next scene when there are no more.'\n    );\n    return Promise.reject();\n  }\n  return unloadScene(currentScene)\n    .then(() => loadScene(scene))\n    .then(() => scene);\n}\n\n/**\n * Load scene\n * @param {module:game/scene~Scene} scene\n * @returns {Promise} fulfills to null\n */\nfunction loadScene(scene) {\n  return scene\n    .load()\n    .then(() => scene.initialise())\n    .then(() => {\n      createHud();\n      currentScene = scene;\n    });\n}\n\n/**\n * Unload scene. This can be safely called even if the\n * current scene has already been unloaded.\n * @param {module:game/scene~Scene} scene\n * @returns {Promise} fulfills to null\n */\nfunction unloadScene(scene) {\n  if (scene) {\n    return scene.unload().then(() => {\n      WORLD.clearAll();\n      currentScene = null;\n      clearHud();\n      return Promise.resolve();\n    });\n  } else {\n    return Promise.resolve(null);\n  }\n}\n\n/**\n * Unload current scene\n * @returns {Promise} fulfills to null\n */\nfunction unloadCurrentScene() {\n  return unloadScene(currentScene);\n}\n/**\n * Configure the scenes from the script.\n * @param {module:gameManagement/sceneManager~SceneDefinition} listOfScenes\n */\nfunction setSceneList(listOfScenes) {\n  sceneDefnList = listOfScenes;\n  sceneDefnList.reset();\n}\n\n/**\n * Test to see if there are more scenes.\n * @returns {boolean}\n */\nfunction areThereMoreScenes() {\n  return sceneDefnList.hasNext();\n}\n\n/**\n * Continue from a saved scene.\n * @param {number} savedSceneLevel\n * @param {module:players/actors.Actor} savedHero\n * @returns {Promise} fulfils to the loaded scene.\n * Rejects if no scenes.\n */\nfunction continueFromSavedScene(savedSceneLevel, savedHero) {\n  sceneDefnList.restore(savedSceneLevel, savedHero);\n  return setScene(getNextSceneFromList());\n}\n/**\n * Switch to the first scene.\n * @returns {Promise} fulfils to the loaded scene.\n * Rejects if no scenes.\n */\nfunction switchToFirstScene() {\n  sceneDefnList.reset();\n  return setScene(getNextSceneFromList());\n}\n\n/**\n * Switch to the next scene.\n * @returns {Promise} fulfils to the loaded scene.\n * Rejects if there are no more.\n */\nfunction switchToNextScene() {\n  return setScene(getNextSceneFromList());\n}\n\n/**\n * Gets the next scene from the scene definition list.\n * @returns {Scene}\n */\nfunction getNextSceneFromList() {\n  return parseSceneDefinition(sceneDefnList.getNext());\n}\n\n/**\n * UPdate the scene\n * @param {number} deltaSeconds\n */\nfunction update(deltaSeconds) {\n  currentScene?.update(deltaSeconds);\n  cameraDolly?.update(deltaSeconds);\n}\n\n/**\n * Pan the camera.\n * @param {number} dx\n * @param {number} dy\n */\nfunction panCameraBy(dx, dy) {\n  if (cameraDolly && navigationButtons) {\n    cameraDolly.panBy(dx, dy);\n    cameraDolly.setTrackingMethod(CameraTracking.OFF);\n    navigationButtons.setTrackingState(false);\n  }\n}\n\n/**\n * Get the current scene level.\n * @returns {number}\n */\nfunction getCurrentSceneLevel() {\n  return sceneDefnList.getIndex();\n}\n\n/**\n * Get the current scene intro.\n * @returns {string} undefined if not set\n */\nfunction getCurrentSceneIntro() {\n  return sceneDefnList.intro;\n}\n\n/**\n * Set the dungeon challenge.\n * @param {module:scriptReaders/autoSceneList~DungeonChallengeValue} challenge\n */\nfunction setDungeonChallenge(challenge) {\n  if (sceneDefnList.setChallenge) {\n    sceneDefnList.setChallenge(challenge);\n  } else {\n    LOG.error(\n      'Attempt to setDungeonChallenge on list that does not support it.'\n    );\n  }\n}\n\n/**\n * SCENE_MANAGER Singleton.\n */\nconst SCENE_MANAGER = {\n  areThereMoreScenes: areThereMoreScenes,\n  continueFromSavedScene: continueFromSavedScene,\n  getCurrentSceneLevel: getCurrentSceneLevel,\n  getCurrentSceneIntro: getCurrentSceneIntro,\n  panCameraBy: panCameraBy,\n  setCameraToTrack: setCameraToTrack,\n  setDungeonChallenge: setDungeonChallenge,\n  setSceneList: setSceneList,\n  switchToFirstScene: switchToFirstScene,\n  switchToNextScene: switchToNextScene,\n  unloadCurrentScene: unloadCurrentScene,\n  update: update,\n};\n\nexport default SCENE_MANAGER;\n","/**\n * @file Convert a screen definition into a scene.\n *\n * @module scriptReaders/sceneDefinitionParser\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { TilePlan } from '../utils/tileMaps/tilePlan.js';\nimport { TileMap } from '../utils/tileMaps/tileMap.js';\nimport TURN_MANAGER from '../gameManagement/turnManager.js';\nimport WORLD from '../utils/game/world.js';\nimport SCREEN from '../utils/game/screen.js';\nimport { TILE_MAP_KEYS } from './symbolMapping.js';\nimport { AbstractScene } from '../utils/game/scene.js';\nimport SCENE_MANAGER from '../gameManagement/sceneManager.js';\nimport GameConstants from '../utils/game/gameConstants.js';\nimport { Actor, ActorType } from '../players/actors.js';\n\nimport { buildActor } from '../dnd/almanacs/actorBuilder.js';\nimport { buildArtefact } from '../dnd/almanacs/artefactBuilder.js';\nimport { ALMANAC_LIBRARY } from '../dnd/almanacs/almanacs.js';\nimport { rollDice } from '../utils/dice.js';\nimport { ArtefactType, artefactTypesEqual } from '../players/artefacts.js';\nimport * as almanacUtils from '../dnd/almanacs/almanacUtils.js';\nimport LOG from '../utils/logging.js';\n\nconst GRID_SIZE = GameConstants.TILE_SIZE;\n\n/** @type {module:players/actors.Actor} */\nlet lastHero;\n\n/**\n * @typedef {Object} ActorDefn\n * @property {string} id\n * @property {module:dnd/traits~CharacterTraits} traits\n * @property {string} description\n */\n\n/**\n * Create the hero. If the scene definition doesn't have a hero definition, the\n * lastHero is used.\n * @param {SceneDefinition} sceneDefn\n * @returns {module:players/actors.Actor}\n */\nfunction createHero(sceneDefn) {\n  if (sceneDefn.hero instanceof Actor) {\n    lastHero = sceneDefn.hero;\n  } else if (sceneDefn.hero) {\n    const actor = buildActor(sceneDefn.hero);\n    lastHero = actor;\n  } else if (!lastHero) {\n    throw new Error('No hero has been defined.');\n  }\n\n  return lastHero;\n}\n/**\n * Create the enemies.\n * @param {SceneDefinition} sceneDefn\n * @returns {Actor[]}\n */\nfunction createEnemies(sceneDefn) {\n  const enemies = [];\n  sceneDefn.enemies.forEach((almanacEntry) => {\n    const actor = buildActor(almanacEntry);\n    enemies.push(actor);\n  });\n  return enemies;\n}\n\n/**\n * Create the portal.\n * @param {SceneDefinition} sceneDefn\n * @returns {module:players/actors.Actor} null if not created.\n */\nfunction createPortal(sceneDefn) {\n  return sceneDefn.portal ? buildActor(sceneDefn.portal) : null;\n}\n\n/** Create an artefact that is located in the dungeon.\n * The artefact is placed in a suitable actor such as a\n * pillar or as a hidden artefact.\n * @param {AlmanacEntry} almanacEntry\n * @param {module:players/artefacts.Artefact} [preBuiltArtefact] if not provided, the artefact is built from the\n * almanac entry.\n * @returns {module:players/actors.Actor} actor containing the artefact\n */\nfunction createFindableArtefact(almanacEntry, preBuiltArtefact) {\n  let id;\n  let type;\n  if (\n    artefactTypesEqual(almanacEntry.type, ArtefactType.CONSUMABLE) &&\n    /SUBTYPE *: *VEGETATION/i.test(almanacEntry.traitsString)\n  ) {\n    id = 'vegetation';\n    type = ActorType.HIDDEN_ARTEFACT;\n  } else {\n    switch (almanacEntry.type.id) {\n      case ArtefactType.SPELL.id:\n      case ArtefactType.CANTRIP.id:\n        id = 'engraved_pillar';\n        type = ActorType.PROP;\n        break;\n      default:\n        {\n          const roll = rollDice(6);\n          if (roll < 3) {\n            id = 'hidden_artefact';\n          } else if (roll < 5) {\n            id = 'trapdoor';\n          } else {\n            id = 'manhole_cover';\n          }\n        }\n        type = ActorType.HIDDEN_ARTEFACT;\n        break;\n    }\n  }\n\n  const actor = buildActor({\n    id: id,\n    name: almanacUtils.createNameFromId(id),\n    description: almanacUtils.createDescriptionFromId(id),\n    imageName: id,\n    type: type,\n    traitsString: '',\n  });\n  const artefact = preBuiltArtefact ?? buildArtefact(almanacEntry);\n  actor.storeManager.addArtefact(artefact);\n  return actor;\n}\n\n/**\n * Create the artefacts.\n * @param {SceneDefinition} sceneDefn\n * @returns {Actor[]}\n */\nfunction createArtefacts(sceneDefn) {\n  const artefacts = [];\n  sceneDefn.artefacts.forEach((almanacEntry) => {\n    const holdingActor = createFindableArtefact(almanacEntry);\n    artefacts.push(holdingActor);\n  });\n  return artefacts;\n}\n\n/**\n * Add an artefact from the almanac.\n * @param {Actor[]} actors\n * @param {AlmanacEntry} almanacEntry\n * @param {Object} options\n * @param {boolean} options.equip - if true, try to equip rather than stash.\n */\nfunction addArtefactToActor(actor, almanacEntry, options) {\n  if (almanacEntry) {\n    const artefact = buildArtefact(almanacEntry);\n    if (options.equip && artefact.equipStoreType) {\n      actor.storeManager?.equip(artefact, { direct: true });\n    } else {\n      actor.storeManager?.stash(artefact, { direct: true });\n    }\n  }\n}\n\n/**\n * Add an artefact from the almanac.\n * @param {Actor[]} actors\n * @param {Almanac} almanac\n * @param {Object} options\n * @param {number} options.qty - number to add.\n * @param {boolean} options.equip - if true, try to equip rather than stash.\n */\nfunction addRandomArtefactsToActor(actor, almanac, options) {\n  while (options.qty-- > 0) {\n    const almanacEntry = almanac.getRandomEntry();\n    addArtefactToActor(actor, almanacEntry, options);\n  }\n}\n\n/**\n * Scene created from a scene definition.\n */\nclass ParsedScene extends AbstractScene {\n  /** @type {SceneDefinition} */\n  #sceneDefn;\n\n  /** Construct the scene from a definition. */\n  constructor(sceneDefn) {\n    super();\n    this.#sceneDefn = sceneDefn;\n    this.intro = sceneDefn.intro;\n  }\n\n  /** @override */\n  doLoad() {\n    return Promise.resolve();\n  }\n\n  doInitialise() {\n    const tilePlan = TilePlan.generateTileMapPlan(\n      this.#sceneDefn.mapDesign,\n      TILE_MAP_KEYS\n    );\n    this.heroActor = createHero(this.#sceneDefn);\n    const tileMap = new TileMap(\n      SCREEN.getContext2D(),\n      tilePlan,\n      GRID_SIZE,\n      this.heroActor\n    );\n    WORLD.setTileMap(tileMap);\n\n    let portal = createPortal(this.#sceneDefn);\n    if (portal) {\n      const freeTile = tileMap.getRandomFreeGroundTile();\n      if (freeTile) {\n        portal.position = freeTile.worldPoint;\n        WORLD.addArtefact(portal);\n      } else {\n        LOG.debug('No free tiles for portal.');\n        portal = null;\n      }\n    }\n\n    const exitKeyAlmanacEntry = ALMANAC_LIBRARY.getRandomEntry('KEYS');\n    const exitKeyArtefact =\n      rollDice(6) > 3 ? buildArtefact(exitKeyAlmanacEntry) : null;\n    let keysToAdd = exitKeyArtefact ? 1 : 0;\n\n    const pooledArtefactAlmanac = ALMANAC_LIBRARY.getPooledAlmanac(\n      ['ARTEFACTS', 'ARMOUR', 'WEAPONS'],\n      (entry) => entry.minLevel <= SCENE_MANAGER.getCurrentSceneLevel()\n    );\n\n    const water = pooledArtefactAlmanac.find(\n      (entry) => entry.id === 'waterskin'\n    );\n    const rations = pooledArtefactAlmanac.find(\n      (entry) => entry.id === 'iron_rations'\n    );\n\n    for (const enemy of createEnemies(this.#sceneDefn)) {\n      const freeTile = tileMap.getRandomFreeGroundTile();\n      if (!freeTile) {\n        LOG.debug('No free tiles for enemy.');\n        break;\n      }\n      enemy.position = freeTile.worldPoint;\n      WORLD.addActor(enemy);\n      if (enemy.isTrader()) {\n        enemy.traits.exceedAbilitiesAndExp?.(this.heroActor.traits, 1);\n        let qtyOfItems = 7;\n        if (rollDice(6) > 3) {\n          addArtefactToActor(enemy, water, { equip: false });\n          qtyOfItems--;\n        }\n        if (rollDice(6) > 3) {\n          addArtefactToActor(enemy, rations, { equip: false });\n          qtyOfItems--;\n        }\n        addRandomArtefactsToActor(enemy, pooledArtefactAlmanac, {\n          qty: qtyOfItems,\n          equip: false,\n        });\n      } else if (\n        keysToAdd &&\n        !enemy.isOrganic() &&\n        enemy.traits.get('HAS_KEYS')\n      ) {\n        enemy.storeManager.stash(exitKeyArtefact, {\n          direct: true,\n        });\n        keysToAdd = 0;\n        LOG.debug('Added key to actor.');\n      }\n    }\n    if (keysToAdd) {\n      const holdingActor = createFindableArtefact(\n        exitKeyAlmanacEntry,\n        exitKeyArtefact\n      );\n      const freeTile = tileMap.getRandomFreeGroundTile();\n      if (freeTile) {\n        holdingActor.position = freeTile.worldPoint;\n        WORLD.addArtefact(holdingActor);\n        keysToAdd = 0;\n        LOG.debug('Added key as hidden object.');\n      }\n    }\n\n    for (const artefact of createArtefacts(this.#sceneDefn)) {\n      const freeTile = tileMap.getRandomFreeGroundTile();\n      if (!freeTile) {\n        LOG.debug('No free tile to add artefact.');\n        break;\n      }\n      artefact.position = freeTile.worldPoint;\n      WORLD.addArtefact(artefact);\n    }\n    SCENE_MANAGER.setCameraToTrack(this.heroActor.sprite, 200, 0);\n    WORLD.addActor(this.heroActor);\n    TURN_MANAGER.setHero(this.heroActor);\n    // if keysToAdd > 0 we couldn't find a free tile for it, son don't use.\n    if (keysToAdd > 0) {\n      TURN_MANAGER.setExitKeyArtefact(null);\n    } else {\n      TURN_MANAGER.setExitKeyArtefact(exitKeyArtefact);\n    }\n\n    return Promise.resolve();\n  }\n\n  /**\n   * @override\n   */\n  doUpdate(deltaSecondsUnused) {\n    return;\n  }\n\n  /**\n   * @override\n   */\n  doUnload() {\n    return Promise.resolve(null);\n  }\n}\n\n/**\n * Parse the scene definition to create a Scene\n * @param {SceneDefinition} sceneDefn\n * @returns {Scene}\n */\nexport function parseSceneDefinition(sceneDefn) {\n  return new ParsedScene(sceneDefn);\n}\n","/**\n * @file Tile map support\n *\n * @module utils/tileMaps/tilePlan\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../logging.js';\nimport { getSurrounds } from '../arrays/arrayManip.js';\nimport { Point } from '../geometry.js';\n\n/** Symbol used to mark void tiles @type {string} */\nconst VOID_SYMBOL = ' ';\n\n/** Special symbols for constructing the dungeon.\n * The first character in each array is used as the default, so there should be\n * an image for that. Note that the symbols in the arrays must be single characters.\n * @type {Object<string, string[]>}\n */\nexport const SpecialSymbols = {\n  WALL: ['#', '*', '|'],\n  DOOR_IN: ['-', '~'],\n  DOOR_OUT: ['=', '>'],\n  GROUND: ['.', ':', ',', ';'],\n  VOID: [' '],\n};\n\n/**\n * Clarifiers appended to ambiguous design symbols.\n */\nconst Clarifiers = {\n  TOP_LEFT: '-TL',\n  TOP_LEFT_INTERNAL: '-TLI',\n  TOP: '-T',\n  TOP_RIGHT: '-TR',\n  TOP_RIGHT_INTERNAL: '-TRI',\n  RIGHT: '-R',\n  BOTTOM_RIGHT: '-BR',\n  BOTTOM_RIGHT_INTERNAL: '-BRI',\n  BOTTOM: '-B',\n  BOTTOM_LEFT: '-BL',\n  BOTTOM_LEFT_INTERNAL: '-BLI',\n  LEFT: '-L',\n  TOP_TEE: '-TTEE',\n  RIGHT_TEE: '-RTEE',\n  BOTTOM_TEE: '-BTEE',\n  LEFT_TEE: '-LTEE', // cspell:disable-line\n  INTERNAL_CROSS: '-XI',\n  INTERNAL_VERTICAL: '-VI',\n  INTERNAL_HORIZONTAL: '-HI',\n};\n\n/**\n * Shadow clarifiers. Added to some symbols to mark it as being below a top wall.\n */\nconst ShadowClarifier = {\n  BELOW_WALL: '-SBW',\n  BELOW_END_WALL: '-SBE',\n};\n\n/**\n * Design created by users for a tile map.\n * The design comprises an array of strings. Each string is row in the tile map.\n * A single character is used for each tile. Users can use any character they want\n * except for the {@link SpecialSymbols} characters which have predefined meanings.\n * These predefined symbols can be ambiguous. E.g. the CORNER could be any of four possible\n * corners. These are clarified automatically and have a suffix added to clarify\n * its position.\n *  @typedef {string[]}TileMapDesign\n */\n\n/**\n * Two dimensional array of tile design information. This is different from the\n * design information as the design now exists as a two dimensional array of\n * TileDefinition.\n *\n * @typedef {Array.TileDefinition[]} TilePlan\n */\n\n/**\n * Tile Design Information.\n * @typedef {Object} TileDefinition\n * @property {string} name\n * @property {string} image\n */\n\n/**\n * Map of symbols to names and image names. The name just allows different tile\n * types to use the same image.\n * @typedef {Map<string, TileDesignInfo>} SymbolMap\n */\n\n/**\n * Encapsulated tile plan.\n */\nexport class TilePlan {\n  /** @type {Array.<Array.<*>>} */\n  matrix;\n  /** @type {Point} */\n  entryPointByDoor;\n  /** @type {Point} */\n  exitPointByDoor;\n\n  constructor() {\n    this.entryPointByDoor = new Point(0, 0);\n    this.exitPointByDoor = new Point(0, 0);\n  }\n\n  /**\n   * Converts a tile map design into a tile map plan\n   * @param {TileMapDesign} design\n   * @param {SymbolMap}} symbolMap\n   * @returns {TilePlan}\n   */\n  static generateTileMapPlan(design, symbolMap) {\n    const tilePlan = new TilePlan();\n    let matrix = tilePlan.convertToMatrix(design);\n    matrix = tilePlan.clarifyMatrix(matrix);\n    tilePlan.createPlan(matrix, symbolMap);\n    return tilePlan;\n  }\n  /**\n   * Convert the user's design from array of strings into a 2D array.\n   * @returns {Array.string[]}\n   */\n  convertToMatrix(design) {\n    const matrix = [];\n    let nColumns = 0;\n    design.forEach((row) => {\n      nColumns = Math.max(nColumns, row.length);\n    });\n    design.forEach((row) => {\n      if (row.length < nColumns) {\n        row = row + ' '.repeat(nColumns - length);\n      }\n      matrix.push(row.split(''));\n    });\n    return matrix;\n  }\n\n  /**\n   * Go through the design matrix and convert any ambiguous symbols to more specific\n   * ones. Note the tilePlan matrix is not adjusted. The entry and exit tiles are discovered though.\n   * @param {Array.string[]} matrix\n   */\n  clarifyMatrix(matrix) {\n    const unambiguousMatrix = [];\n    matrix.forEach((rowValue, rowIndex) => {\n      const correctedRow = [];\n      unambiguousMatrix.push(correctedRow);\n      rowValue.forEach((colValue, colIndex) => {\n        const surrounds = getSurrounds(matrix, rowIndex, colIndex);\n        if (isVoid(colValue)) {\n          colValue = VOID_SYMBOL;\n        } else if (isGround(colValue)) {\n          colValue = clarifyGround(colValue, surrounds);\n          if (isEntryTile(colValue, surrounds)) {\n            this.entryPointByDoor = new Point(colIndex, rowIndex);\n          } else if (isExitTile(colValue, surrounds)) {\n            this.exitPointByDoor = new Point(colIndex, rowIndex);\n          }\n        } else if (isPartOfWall(colValue)) {\n          colValue = clarifyWallPart(colValue, surrounds);\n        }\n        correctedRow.push(colValue);\n      });\n    });\n    return unambiguousMatrix;\n  }\n  /**\n   * Convert a clarified design plan matrix into a tile plan.\n   * @param {string[][]} matrix\n   * @param {Map<string, *>} symbolMap\n   * @returns {Array.<Array.<*>>}\n   */\n  createPlan(matrix, symbolMap) {\n    const planMatrix = [];\n    matrix.forEach((rowValue) => {\n      const planRow = [];\n      planMatrix.push(planRow);\n      rowValue.forEach((columnValue) => {\n        planRow.push(getDesignInfo(columnValue, symbolMap));\n      });\n    });\n    this.matrix = planMatrix;\n  }\n}\n\n/**\n * Test if symbol is a void.\n * @returns {boolean}\n */\nfunction isVoid(symbol) {\n  return SpecialSymbols.VOID.includes(symbol);\n}\n\n/**\n * Test if symbol is an entrance.\n * @returns {boolean}\n */\nfunction isEntrance(symbol) {\n  return SpecialSymbols.DOOR_IN.includes(symbol);\n}\n\n/**\n * Test if symbol is an exit.\n * @returns {boolean}\n */\nfunction isExit(symbol) {\n  return SpecialSymbols.DOOR_OUT.includes(symbol);\n}\n\n/**\n * Test if symbol is a door.\n * @returns {boolean}\n */\nfunction isDoor(symbol) {\n  return isEntrance(symbol) || isExit(symbol);\n}\n\n/**\n * Test if symbol is a wall.\n * @returns {boolean}\n */\nfunction isWall(symbol) {\n  return SpecialSymbols.WALL.includes(symbol);\n}\n\n/**\n * Test if symbol is ground.\n * @returns {boolean}\n */\nfunction isGround(symbol) {\n  return SpecialSymbols.GROUND.includes(symbol);\n}\n/**\n * Test if the symbol, unclarified, is part of a wall.\n * @param {string} symbol\n * @returns {boolean}\n */\nfunction isPartOfWall(symbol) {\n  return isWall(symbol) || isDoor(symbol);\n}\n\n/**\n * Clarify the ground.\n * @param {string} value\n * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n * @return {string}\n */\nfunction clarifyGround(value, surrounds) {\n  if (isPartOfWall(surrounds.above)) {\n    if (isPartOfWall(surrounds.tl)) {\n      value += ShadowClarifier.BELOW_WALL;\n    } else {\n      value += ShadowClarifier.BELOW_END_WALL;\n    }\n  }\n  return value;\n}\n\n/**\n * Check if this floor tile is the entry tile. This is the tile the hero will\n * appear on when entering the map. The tests are made in the order of where\n * the doors is most likely to be placed assuming a left to right, top to bottom\n * design.\n * @param {string} value\n * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n * @returns {boolean}\n */\nfunction isEntryTile(value, surrounds) {\n  return (\n    isEntrance(surrounds.left) ||\n    isEntrance(surrounds.above) ||\n    isEntrance(surrounds.right) ||\n    isEntrance(surrounds.below)\n  );\n}\n\n/**\n * Check if this floor tile is the exit tile. This is the tile the hero will\n * be on when trying to exit the map. The tests are made in the order of where\n * the doors is most likely to be placed assuming a left to right, top to bottom\n * design.\n * @param {string} value\n * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n * @returns {boolean}\n */\nfunction isExitTile(value, surrounds) {\n  return (\n    isExit(surrounds.right) ||\n    isExit(surrounds.below) ||\n    isExit(surrounds.left) ||\n    isExit(surrounds.above)\n  );\n}\n/**\n * Distinguish the type of tile based on its surroundings.\n * This function does not handle corners.\n * @param {string} value\n * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n * @return {string}\n */\nfunction clarifyWallPart(value, surrounds) {\n  let result = value;\n  // internals centre cross\n  if (\n    isPartOfWall(surrounds.above) &&\n    isPartOfWall(surrounds.right) &&\n    isPartOfWall(surrounds.below) &&\n    isPartOfWall(surrounds.left)\n  ) {\n    result += Clarifiers.INTERNAL_CROSS;\n  } else if (isGround(surrounds.left) && isGround(surrounds.right)) {\n    result += Clarifiers.INTERNAL_VERTICAL;\n  } else if (isGround(surrounds.above) && isGround(surrounds.below)) {\n    result += Clarifiers.INTERNAL_HORIZONTAL;\n  }\n\n  // Tees\n  else if (\n    isPartOfWall(surrounds.left) &&\n    isPartOfWall(surrounds.right) &&\n    isPartOfWall(surrounds.below)\n  ) {\n    result += Clarifiers.TOP_TEE;\n  } else if (\n    isPartOfWall(surrounds.above) &&\n    isPartOfWall(surrounds.below) &&\n    isPartOfWall(surrounds.left)\n  ) {\n    result += Clarifiers.RIGHT_TEE;\n  } else if (\n    isPartOfWall(surrounds.left) &&\n    isPartOfWall(surrounds.right) &&\n    isPartOfWall(surrounds.above)\n  ) {\n    result += Clarifiers.BOTTOM_TEE;\n  } else if (\n    isPartOfWall(surrounds.above) &&\n    isPartOfWall(surrounds.below) &&\n    isPartOfWall(surrounds.right)\n  ) {\n    result += Clarifiers.LEFT_TEE;\n  }\n  // corners\n  else if (isPartOfWall(surrounds.right) && isPartOfWall(surrounds.below)) {\n    result += isGround(surrounds.br)\n      ? Clarifiers.TOP_LEFT\n      : Clarifiers.TOP_LEFT_INTERNAL;\n  } else if (isPartOfWall(surrounds.left) && isPartOfWall(surrounds.below)) {\n    result += isGround(surrounds.bl)\n      ? Clarifiers.TOP_RIGHT\n      : Clarifiers.TOP_RIGHT_INTERNAL;\n  } else if (isPartOfWall(surrounds.left) && isPartOfWall(surrounds.above)) {\n    result += isGround(surrounds.tl)\n      ? Clarifiers.BOTTOM_RIGHT\n      : Clarifiers.BOTTOM_RIGHT_INTERNAL;\n  } else if (isPartOfWall(surrounds.right) && isPartOfWall(surrounds.above)) {\n    result += isGround(surrounds.tr)\n      ? Clarifiers.BOTTOM_LEFT\n      : Clarifiers.BOTTOM_LEFT_INTERNAL;\n  }\n  // straights\n  else if (isPartOfWall(surrounds.above) && isPartOfWall(surrounds.below)) {\n    // vertical\n    result += isGround(surrounds.right) ? Clarifiers.LEFT : Clarifiers.RIGHT;\n  } else if (isPartOfWall(surrounds.right) && isPartOfWall(surrounds.left)) {\n    // horizontal\n    result += isGround(surrounds.below) ? Clarifiers.TOP : Clarifiers.BOTTOM;\n  }\n\n  if (isPartOfWall(surrounds.above)) {\n    return (result += ShadowClarifier.BELOW_WALL);\n  }\n  return result;\n}\n\n/** Get the design info from the symbol map. The function reduces the specialism\n * of the symbol if it cannot find it. I.e it removes any shadow clarifiers and\n * then all other clarifiers when hunting for the symbol in the symbol map.\n * @param {string} symbol - clarified symbol.\n * @param {Map<string, *>} symbolMap\n * @returns {TileDesignInfo}\n */\nfunction getDesignInfo(symbol, symbolMap) {\n  if (symbol === VOID_SYMBOL) {\n    return null;\n  }\n  const match = symbol.match(/(.)(-[^-]*)?(-[^-]*)?/);\n  let info = symbolMap.get(symbol);\n  if (!info && match[2] && match[3]) {\n    info = symbolMap.get(`${match[1]}${match[2]}`); // no shadow clarifier\n  }\n  if (!info && match[2]) {\n    info = symbolMap.get(match[1]); // no clarifiers at all\n  }\n\n  if (!info) {\n    const fallbackSymbol = getFirstOfCohort(match[1]);\n    if (fallbackSymbol && fallbackSymbol !== match[1]) {\n      return getDesignInfo(\n        formClarifiedSymbol(fallbackSymbol, match[2], match[3]),\n        symbolMap\n      );\n    } else {\n      LOG.error(`Failed to find symbol for ${symbol}`);\n    }\n  }\n  return info;\n}\n\n/**\n * Searches the SpecialSymbols and finds the first entry in the array that matches\n * the unclarified symbol.\n * @param {string} unclarifiedSymbol\n * @returns {string} null if not found\n */\nfunction getFirstOfCohort(unclarifiedSymbol) {\n  for (const prop in SpecialSymbols) {\n    if (SpecialSymbols[prop].includes(unclarifiedSymbol)) {\n      return SpecialSymbols[prop][0];\n    }\n  }\n  return null;\n}\n\n/**\n * Add clarifiers onto symbol.\n * @param {string} unclarifiedSymbol\n * @param {string} clarifier\n * @param {string} shadowClarifier\n */\nfunction formClarifiedSymbol(unclarifiedSymbol, clarifier, shadowClarifier) {\n  let result = unclarifiedSymbol;\n  if (clarifier) {\n    result += clarifier;\n  }\n  if (shadowClarifier) {\n    result += shadowClarifier;\n  }\n  return result;\n}\n","/**\n * @file Various utilities for handling arrays\n *\n * @module utils/arrays/arrayManip\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * @typedef Surrounds\n * @property {*} centre - value at centre\n * @property {*} tl - value to top left\n * @property {*} above - value above\n * @property {*} tr - value to top right\n * @property {*} right - value to right\n * @property {*} br - value to bottom right\n * @property {*} below - value below\n * @property {*} bl - value to bottom\n * @property {*} left - value to left\n */\n\n/**\n * Get the surround values from a 2D matrix\n * @param {Array.<Array.<*>>} matrix\n * @param {number} rowIndex\n * @param {number} columnIndex\n * @returns {Surrounds}\n */\nexport function getSurrounds(matrix, rowIndex, columnIndex) {\n  return {\n    centre: matrix[rowIndex]?.[columnIndex],\n    tl: matrix[rowIndex - 1]?.[columnIndex - 1],\n    above: matrix[rowIndex - 1]?.[columnIndex],\n    tr: matrix[rowIndex - 1]?.[columnIndex + 1],\n    right: matrix[rowIndex]?.[columnIndex + 1],\n    br: matrix[rowIndex + 1]?.[columnIndex + 1],\n    below: matrix[rowIndex + 1]?.[columnIndex],\n    bl: matrix[rowIndex + 1]?.[columnIndex - 1],\n    left: matrix[rowIndex]?.[columnIndex - 1],\n  };\n}\n\n/**\n * Get radiating cross from centre. Takes a 2D matrix and finds all cells\n * that radiate horizontally and vertically from a point.\n * @param {Array.<Array.<*>>} matrix\n * @param {Object} options\n * @param {number} options.rowIndex\n * @param {number} options.columnIndex\n * @param {number} [options.distance = 1] - distance from centre\n * @param {function(member):boolean} options.filter - if provided, must be true otherwise\n * radiation stops.\n * @returns {Array.<*>}\n */\nexport function radiateCross(matrix, options) {\n  const centreX = options.columnIndex;\n  const centreY = options.rowIndex;\n  const result = [];\n  let lookNorth = true;\n  let lookEast = true;\n  let lookSouth = true;\n  let lookWest = true;\n  let offset = 1;\n  let member;\n  let distance = options.distance ?? 1;\n  while (distance-- > 0) {\n    if (lookWest) {\n      member = matrix[centreY][centreX - offset];\n      if (options.filter && !options.filter(member)) {\n        lookWest = false;\n      } else {\n        result.push(member);\n      }\n    }\n    if (lookEast) {\n      member = matrix[centreY][centreX + offset];\n      if (options.filter && !options.filter(member)) {\n        lookEast = false;\n      } else {\n        result.push(member);\n      }\n    }\n    if (lookNorth) {\n      member = matrix[centreY - offset][centreX];\n      if (options.filter && !options.filter(member)) {\n        lookNorth = false;\n      } else {\n        result.push(member);\n      }\n    }\n    if (lookSouth) {\n      member = matrix[centreY + offset][centreX];\n      if (options.filter && !options.filter(member)) {\n        lookSouth = false;\n      } else {\n        result.push(member);\n      }\n    }\n    offset++;\n  }\n  return result;\n}\n\n/**\n * Get radiating cross from centre. Takes a 2D matrix and finds all cells\n * that radiate horizontally and vertically from a point.\n * @param {Array.<Array.<*>>} matrix\n * @param {Object} options\n * @param {number} options.rowIndex\n * @param {number} options.columnIndex\n * @param {number} [options.distance = 1] - distance from centre\n * @param {function(member):boolean} options.filter - if provided, must be true otherwise\n * radiation stops.\n * @returns {Array.<*>}\n */\nfunction radiateUpAndDown(matrix, options) {\n  const centreX = options.columnIndex;\n  const centreY = options.rowIndex;\n  const result = [];\n  let lookNorth = true;\n  let lookSouth = true;\n  let offset = 1;\n  let member;\n  let distance = options.distance ?? 1;\n  while (distance-- > 0) {\n    if (lookNorth) {\n      member = matrix[centreY - offset][centreX];\n      if (options.filter && !options.filter(member)) {\n        lookNorth = false;\n      } else {\n        result.push(member);\n      }\n    }\n    if (lookSouth) {\n      member = matrix[centreY + offset][centreX];\n      if (options.filter && !options.filter(member)) {\n        lookSouth = false;\n      } else {\n        result.push(member);\n      }\n    }\n    offset++;\n  }\n  return result;\n}\n\n/**\n * Get radiating circle from centre. Takes a 2D matrix and finds all cells\n * that radiate from a point.\n * @param {Array.<Array.<*>>} matrix\n * @param {Object} options\n * @param {number} options.rowIndex\n * @param {number} options.columnIndex\n * @param {number} [options.distance = 1] - distance from centre\n * @param {function(member):boolean} options.filter - if provided, must be true otherwise\n * radiation stops.\n * @returns {Array.<*>}\n */\nexport function radiate(matrix, options) {\n  const centreX = options.columnIndex;\n  const centreY = options.rowIndex;\n  const radius = options.distance ?? 1;\n  let result = [];\n\n  let lookEast = true;\n  let lookWest = true;\n  let member;\n  const radiusSquared = radius * radius;\n  const upDownOptions = {\n    rowIndex: centreY,\n    columnIndex: centreX,\n    distance: radius,\n    filter: options.filter,\n  };\n  result = result.concat(radiateUpAndDown(matrix, upDownOptions));\n  for (let offset = 1; offset <= radius; offset++) {\n    if (!lookWest && !lookEast) {\n      break;\n    }\n    if (lookWest) {\n      member = matrix[centreY][centreX - offset];\n      if (options.filter && !options.filter(member)) {\n        lookWest = false;\n      } else {\n        result.push(member);\n        const upDownOptions = {\n          rowIndex: centreY,\n          columnIndex: centreX - offset,\n          distance: Math.round(\n            Math.sqrt(radiusSquared - (offset - 0.5) * (offset - 0.5))\n          ),\n          filter: options.filter,\n        };\n        result = result.concat(radiateUpAndDown(matrix, upDownOptions));\n      }\n    }\n    if (lookEast) {\n      member = matrix[centreY][centreX + offset];\n      if (options.filter && !options.filter(member)) {\n        lookEast = false;\n      } else {\n        result.push(member);\n        const upDownOptions = {\n          rowIndex: centreY,\n          columnIndex: centreX + offset,\n          distance: Math.round(\n            Math.sqrt(radiusSquared - (offset - 0.5) * (offset - 0.5))\n          ),\n          filter: options.filter,\n        };\n        result = result.concat(radiateUpAndDown(matrix, upDownOptions));\n      }\n    }\n  }\n  return result;\n}\n/**\n * Randomise an array.\n * @param {Object[]} source - array to randomise. The original will be modified.\n * @returns {Object[]} The source array which will have been randomised.\n */\nexport function randomise(source) {\n  let currentIndex = source.length;\n  let randomIndex;\n\n  // While there remain elements to shuffle.\n  while (currentIndex > 0) {\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex--;\n    // swap\n    [source[currentIndex], source[randomIndex]] = [\n      source[randomIndex],\n      source[currentIndex],\n    ];\n  }\n\n  return source;\n}\n","/**\n * @file Tile map\n *\n * @module utils/tileMaps/tileMap\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../logging.js';\nimport { Sprite } from '../sprites/sprite.js';\nimport IMAGE_MANAGER from '../sprites/imageManager.js';\nimport {\n  ImageSpriteCanvasRenderer,\n  RectSpriteCanvasRenderer,\n} from '../sprites/spriteRenderers.js';\nimport { Point, Rectangle } from '../geometry.js';\nimport { UiClickHandler } from '../ui/interactions.js';\nimport { randomise } from '../arrays/arrayManip.js';\nimport { getSurrounds, radiateCross, radiate } from '../arrays/arrayManip.js';\nimport SCREEN from '../game/screen.js';\nimport { RayTracer } from './pathFinder.js';\nimport { Colours } from '../../constants/canvasStyles.js';\n\n/**\n * Detail for click events.\n * @enum {number}\n */\nexport const ClickEventFilter = {\n  MOVEMENT_TILE: 0,\n  INTERACT_TILE: 1,\n  OCCUPIED_TILE: 2,\n  HERO_TILE: 3,\n  MOVE_OR_INTERACT_TILE: 4,\n};\n\n/**\n * Roles that tiles adopt.\n * @enum {number}\n */\nexport const TileRole = {\n  OBSTACLE: -1,\n  GROUND: 0,\n  ENTRANCE: 1,\n  EXIT: 2,\n  STAIRS_UP: 3,\n  STAIRS_DOWN: 4,\n};\n/**\n * @typedef {Object} TileDefinition\n * @property {TileRole} role\n * @property {module:utils/sprites/sprite~SpriteClickHandler} onClick\n * @property {module:utils/sprites/sprite~SpriteClickHandler} onContextClick\n * @property {string} image - used to create the sprite.\n */\n\n/**\n * Tile class\n */\nexport class Tile extends UiClickHandler {\n  /** @type {module:utils/sprites/sprites.Sprite} */\n  sprite;\n  /** @type {boolean} */\n  obstacle;\n  /** @type {module:players/actors~Actor} */\n  #occupants;\n  /** @type {Point} */\n  #gridPoint;\n  /** @type {Point} */\n  #worldPoint;\n  /** @type {TileRole} */\n  #role;\n\n  /** Construct tile\n   * @param {module:utils/sprites/sprites.Sprite} tileSprite;\n   * @param {Object} options;\n   * @param {boolean} options.obstacle;\n   * @param {!Point} options.gridPoint;\n   * @param {!Point} options.worldPoint;\n   * @param {TileRole} options.role;\n   */\n  constructor(tileSprite, options) {\n    super();\n    this.sprite = tileSprite;\n    this.#occupants = new Map();\n    this.obstacle = options.obstacle;\n    this.#gridPoint = options.gridPoint;\n    this.#worldPoint = options.worldPoint;\n    this.#role = options.role;\n  }\n\n  /**\n   * Get the role.\n   */\n  get role() {\n    return this.#role;\n  }\n\n  /**\n   * Get the grid point.\n   * @returns {Point}\n   */\n  get gridPoint() {\n    return this.#gridPoint;\n  }\n  /**\n   * Get the world point.\n   * @returns {Point}\n   */\n  get worldPoint() {\n    return this.#worldPoint;\n  }\n\n  /** Add occupant.\n   * @param {import('..utils/game/actors.js').Actor\n   */\n  addOccupant(occupant) {\n    this.#occupants.set(occupant, occupant);\n  }\n\n  /** Remove occupant.\n   * @param {module:players/actors.Actor}\n   */\n  deleteOccupant(occupant) {\n    this.#occupants.delete(occupant);\n  }\n\n  /** get occupants.\n   * @returns {module:players/actors~Actor[]}\n   */\n  getOccupants() {\n    return this.#occupants;\n  }\n\n  /**\n   * Handle the click but change the point to the sprites' position\n   */\n  actionClick(pointUnused) {\n    super.actionClick(this.sprite.position);\n  }\n  /**\n   * Handle the click but change the point to the sprites' position\n   */\n  actionContextClick(pointUnused) {\n    super.actionClick(this.sprite.position);\n  }\n\n  /**\n   * Test if occupied\n   * @returns {boolean}\n   */\n  isOccupied() {\n    return this.#occupants.size > 0;\n  }\n\n  /**\n   * Test if tile can be passed by the actor\n   * @param {Object} actor\n   * @returns {boolean}\n   */\n  isPassableByActor(actor) {\n    if (this.#role === TileRole.ENTRANCE || this.#role === TileRole.EXIT) {\n      return false;\n    }\n    if (this.obstacle) {\n      return false;\n    }\n    for (const occupant of this.#occupants.values()) {\n      if (occupant !== actor && !occupant.isPassableByActor(actor)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Test if tile can be occupied by the actor\n   * @param {Object} actor\n   * @returns {boolean}\n   */\n  canBeOccupiedByActor(actor) {\n    if (\n      (this.#role === TileRole.ENTRANCE || this.#role === TileRole.EXIT) &&\n      !actor.isHero()\n    ) {\n      return false;\n    }\n    if (this.obstacle) {\n      return false;\n    }\n    for (const occupant of this.#occupants.values()) {\n      if (occupant !== actor && !occupant.canShareLocationWithActor(actor)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Test if tile can be seen through by the actor\n   * @param {Object} actor\n   * @returns {boolean}\n   */\n  isSeeThrough(actorUnused) {\n    if (\n      this.obstacle ||\n      this.#role === TileRole.ENTRANCE ||\n      this.#role === TileRole.EXIT\n    ) {\n      return false;\n    }\n    return true;\n  }\n}\n\n/**\n * Tile map\n */\nexport class TileMap {\n  /** @type {CanvasRenderingContext2D} */\n  #context;\n  /** @type {Tile[]} */\n  #tiles;\n  #tilesX;\n  #tilesY;\n  #gridSize;\n  #width;\n  #height;\n  /** @type {module:utils/tileMaps/pathFinder~Routes} */\n  #movementRoutes;\n  /** @type {Point[]} */\n  #movementGridPoints;\n  /** @type {module:utils/sprites/sprites.Sprite} */\n  #movementTileHighlighter;\n  /** @type {module:utils/sprites/sprites.Sprite} */\n  #reachableDoorTileHighlighter;\n  /** @type {Tile[]} */\n  #reachableDoorTileGridPoints;\n  /** @type {Tile} */\n  #entranceTile;\n  /** @type {Tile} */\n  #exitTile;\n  /** @type {Point} */\n  #entryGridPointByDoor;\n  /** @type {Point} */\n  #exitGridPointByDoor;\n  /** @type {Tile[]} */\n  #randomGround;\n  /** @type {RayTracer} */\n  #heroRayTracer;\n  /** @type {Point[]} */\n  #interactTileGridPoints;\n  /** @type {module:utils/sprites/sprites.Sprite} */\n  #interactTileHighlighter;\n  /** @type {module:players/actors.Actor} */\n  #heroActor;\n\n  /**\n   * Create tile map from 2D matrix\n   * @param {CanvasRenderingContext2D} context\n   * @param {TilePlan} plan\n   * @param {number} gridSize - in world coordinates\n   */\n  constructor(context, plan, gridSize, heroActor) {\n    this.#heroActor = heroActor;\n    const matrix = plan.matrix;\n    this.#entryGridPointByDoor = plan.entryPointByDoor;\n    this.#exitGridPointByDoor = plan.exitPointByDoor;\n    this.#context = context;\n    this.#movementTileHighlighter = new Sprite({\n      renderer: new RectSpriteCanvasRenderer(context, {\n        width: gridSize,\n        height: gridSize,\n        fillStyle: Colours.MOVE_HIGHLIGHT_FILL,\n        strokeStyle: Colours.MOVE_HIGHLIGHT_STROKE,\n      }),\n    });\n    this.#reachableDoorTileHighlighter = new Sprite({\n      renderer: new RectSpriteCanvasRenderer(context, {\n        width: gridSize,\n        height: gridSize,\n        fillStyle: Colours.DOOR_HIGHLIGHT_FILL,\n        strokeStyle: 'green',\n      }),\n    });\n    this.#interactTileHighlighter = new Sprite({\n      renderer: new RectSpriteCanvasRenderer(context, {\n        width: gridSize,\n        height: gridSize,\n        fillStyle: Colours.INTERACT_HIGHLIGHT_FILL,\n        strokeStyle: Colours.INTERACT_HIGHLIGHT_STROKE,\n      }),\n    });\n    this.#gridSize = gridSize;\n    this.#tiles = [];\n    this.#tilesY = matrix.length;\n    this.#tilesX = matrix[0].length;\n    this.#width = gridSize * this.tilesX;\n    this.#height = gridSize * this.tilesY;\n    this.#randomGround = [];\n    matrix.forEach((row, rowIndex) => {\n      const tileRow = [];\n      this.#tiles.push(tileRow);\n      row.forEach((tileDefn, columnIndex) => {\n        if (tileDefn) {\n          const sprite = new Sprite({\n            renderer: new ImageSpriteCanvasRenderer(\n              context,\n              IMAGE_MANAGER.getSpriteBitmap(tileDefn.image)\n            ),\n          });\n          const gridPoint = new Point(columnIndex, rowIndex);\n          const worldPoint = this.gridPointToWorldPoint(gridPoint);\n          let tile = new Tile(sprite, {\n            obstacle: tileDefn.role === TileRole.OBSTACLE,\n            gridPoint: gridPoint,\n            worldPoint: worldPoint,\n            role: tileDefn.role,\n          });\n          if (tileDefn.onClick) {\n            tile.setOnClick((target, point) =>\n              this.#filterClick(target, point, tileDefn.onClick)\n            );\n          }\n          this.processTileRole(tile);\n          tileRow.push(tile);\n          sprite.position.x = columnIndex * this.#gridSize + this.#gridSize / 2;\n          sprite.position.y = rowIndex * this.#gridSize + this.#gridSize / 2;\n        } else {\n          tileRow.push(null);\n        }\n      });\n    });\n    if (!this.#entranceTile) {\n      LOG.error('No entrance has been set. Setting to the first ground tile');\n      this.#entranceTile = this.#randomGround[0];\n    }\n    if (!this.#exitTile) {\n      throw new Error('No exit tile.');\n    }\n  }\n\n  /**\n   * Get tile map dimensions in terms of number of tiles.\n   * @returns {module:utils/geometry~Dims2D}\n   */\n  getDimsInTiles() {\n    return { width: this.#tilesX, height: this.#tilesY };\n  }\n  /**\n   * Process a tile's specific role.\n   * @param {Tile} tile\n   */\n  processTileRole(tile) {\n    switch (tile.role) {\n      case TileRole.ENTRANCE:\n        if (this.#entranceTile) {\n          const gp = tile.gridPoint;\n          LOG.error(`Duplicate entrance found at (${gp.x}, ${gp.y}). Ignored.`);\n        } else {\n          this.#entranceTile = tile;\n        }\n        break;\n      case TileRole.EXIT:\n        if (this.#exitTile) {\n          const gp = tile.gridPoint;\n          LOG.error(`Duplicate exit found at (${gp.x}, ${gp.y}). Ignored.`);\n        } else {\n          this.#exitTile = tile;\n        }\n        break;\n      case TileRole.GROUND:\n        if (!tile.gridPoint.coincident(this.#entryGridPointByDoor)) {\n          this.#randomGround.push(tile);\n        }\n        break;\n    }\n  }\n\n  /**\n   * Update method to render tiles.\n   * @param {number} deltaSeconds - elapsed time.\n   */\n  update(deltaSeconds) {\n    this.#setRayTracer();\n    const visibleGridPoints = this.getVisibleGridPointRect();\n    for (\n      let row = visibleGridPoints.y;\n      row <= visibleGridPoints.y + visibleGridPoints.height;\n      row++\n    ) {\n      for (\n        let col = visibleGridPoints.x;\n        col <= visibleGridPoints.x + visibleGridPoints.width;\n        col++\n      ) {\n        if (this.#heroRayTracer?.isGridPointInRays(new Point(col, row))) {\n          const tile = this.#tiles[row][col];\n          tile?.sprite.update(deltaSeconds);\n        }\n      }\n    }\n  }\n\n  /**\n   * Post update. This is used to highlight tiles which should be done after\n   * actors have been drawn.\n   * @param {number} deltaSeconds - elapsed time.\n   */\n  updateHighlights(deltaSeconds) {\n    this.#highlightTiles(deltaSeconds);\n  }\n  /**\n   * Set up the ray tracer if not already set.\n   */\n  #setRayTracer() {\n    if (this.#heroActor) {\n      if (!this.#heroRayTracer) {\n        this.#heroRayTracer = new RayTracer(this, this.#heroActor);\n      }\n      const heroTile = this.getTileAtWorldPoint(this.#heroActor.position);\n      if (heroTile) {\n        const heroTileRole = heroTile.role;\n        if (\n          heroTileRole != TileRole.ENTRANCE &&\n          heroTileRole != TileRole.EXIT\n        ) {\n          this.#heroRayTracer.findReachedTiles();\n        }\n      }\n    }\n  }\n\n  /**\n   * Get the tile map bounds as a rectangle in grid points.\n   * @returns {Rectangle}\n   */\n  getMapGridPointRect() {\n    return new Rectangle(0, 0, this.#tilesX, this.#tilesY);\n  }\n\n  /**\n   * Get the visible bounds as a rectangle in grid points.\n   * @returns {Rectangle}\n   */\n  getVisibleGridPointRect() {\n    const visibleBounds = SCREEN.getWorldInCanvasBounds();\n    const gridPointTL = this.worldPointToGrid(\n      new Point(visibleBounds.x, visibleBounds.y)\n    );\n    const gridPointBR = this.worldPointToGrid(\n      new Point(\n        visibleBounds.x + visibleBounds.width,\n        visibleBounds.y + visibleBounds.height\n      )\n    );\n    const minCol = Math.max(0, gridPointTL.x);\n    const maxCol = Math.min(this.#tilesX - 1, gridPointBR.x);\n    const minRow = Math.max(0, gridPointTL.y);\n    const maxRow = Math.min(this.#tilesY - 1, gridPointBR.y);\n    return new Rectangle(minCol, minRow, maxCol - minCol, maxRow - minRow);\n  }\n\n  /**\n   * Get the grid size\n   * @returns {number}\n   */\n  getGridSize() {\n    return this.#gridSize;\n  }\n\n  /** Get world dimensions.\n   * @returns {module:utils/geometry~Dims2D}\n   */\n  getDimensions() {\n    return { width: this.#width, height: this.#height };\n  }\n\n  /**\n   * Get sprite at position.\n   * @param {Point} point - in world coordinates.\n   * @returns {Tile} null if no tile.\n   */\n  getTileAtWorldPoint(point) {\n    const gridPoint = this.worldPointToGrid(point);\n    return this.getTileAtGridPoint(gridPoint);\n  }\n\n  /**\n   * Get sprite at position.\n   * @param {Point} point - in grid coordinates.\n   * @returns {Tile} null if no tile.\n   */\n  getTileAtGridPoint(gridPoint) {\n    if (!gridPoint) {\n      return null;\n    }\n    const row = gridPoint.y;\n    const col = gridPoint.x;\n    if (col >= 0 && row >= 0 && col < this.#tilesX && row < this.#tilesY) {\n      return this.#tiles[row][col];\n    }\n    return null;\n  }\n\n  /**\n   * Convert world coordinate to mad grid reference.\n   * @param {Point} point\n   * @returns {Point}\n   */\n  worldPointToGrid(point) {\n    return new Point(\n      Math.floor(point.x / this.#gridSize),\n      Math.floor(point.y / this.#gridSize)\n    );\n  }\n\n  /**\n   * Get a world point aligned to the centre of a tile\n   * @param {Point} point\n   */\n  gridAlignedWorldPoint(point) {\n    const gridPoint = this.worldPointToGrid(point);\n    return this.gridPointToWorldPoint(gridPoint);\n  }\n\n  /** Convert a point in tile coordinates to world coordinates.\n   * @param {Point}\n   * @returns {Point}\n   */\n  gridPointToWorldPoint(point) {\n    const halfGrid = 0.5 * this.#gridSize;\n    return new Point(\n      point.x * this.#gridSize + halfGrid,\n      point.y * this.#gridSize + halfGrid\n    );\n  }\n\n  /** Get the world position of the entrance. The default is the first tile if there\n   * is no door\n   * @returns {Point}\n   */\n  getWorldPositionOfTileByEntry() {\n    return this.gridPointToWorldPoint(this.#entryGridPointByDoor);\n  }\n  /** Get the grid position of the door at index. If there are no doors, then\n   * the entrance is the first ground tile\n   * @returns {Point}\n   */\n  getGridPositionOfEntrance() {\n    return this.#entranceTile.gridPoint;\n  }\n\n  /**\n   * Set the highlighted routes.\n   * @param {*} routes\n   */\n  setMovementRoutes(routes) {\n    this.#movementRoutes = routes;\n    if (routes) {\n      this.#movementGridPoints = new Map();\n      this.#movementRoutes.forEach((gridPoints) =>\n        gridPoints.forEach((gridPoint) => {\n          this.#movementGridPoints.set(gridPoint, gridPoint);\n        })\n      );\n    } else {\n      this.#movementGridPoints = null;\n    }\n  }\n\n  /**\n   * Set interaction tiles\n   * @param {Actor[]} actors - actors where a reaction can take place.\n   */\n  setInteractActors(actors) {\n    this.#interactTileGridPoints = [];\n    actors?.forEach((actor) => {\n      if (actor.interaction.canReact()) {\n        this.#interactTileGridPoints.push(\n          this.worldPointToGrid(actor.position)\n        );\n      }\n    });\n  }\n\n  /**\n   * Recalculate the reachable doors.\n   */\n  calcReachableDoors(heroPosition) {\n    this.#reachableDoorTileGridPoints = [];\n    const surrounds = this.getSurroundingTiles(\n      this.worldPointToGrid(heroPosition)\n    );\n    [surrounds.above, surrounds.right, surrounds.below, surrounds.left].forEach(\n      (tile) => {\n        if (tile.gridPoint.coincident(this.#exitTile.gridPoint)) {\n          this.#reachableDoorTileGridPoints.push(tile.gridPoint);\n        } else if (tile.gridPoint.coincident(this.#entranceTile.gridPoint)) {\n          this.#reachableDoorTileGridPoints.push(tile.gridPoint);\n        }\n      }\n    );\n  }\n\n  /**\n   * Highlight routes marked by the highlighters. There are three possible highlights:\n   * movement, interaction and event tiles.\n   * @param {number} deltaSeconds\n   */\n  #highlightTiles(deltaSeconds) {\n    this.#highlightMovementTiles(deltaSeconds);\n    this.#highlightInteractTiles(deltaSeconds);\n    this.#highlightReachableDoorTiles(deltaSeconds);\n  }\n\n  /**\n   * Highlight movement routes.\n   * @param {number} deltaSeconds\n   */\n  #highlightMovementTiles(deltaSeconds) {\n    this.#movementGridPoints?.forEach((gridPoint) => {\n      this.#movementTileHighlighter.position =\n        this.gridPointToWorldPoint(gridPoint);\n      this.#movementTileHighlighter.update(deltaSeconds);\n    });\n  }\n\n  /**\n   * Highlight movement routes.\n   * @param {number} deltaSeconds\n   */\n  #highlightInteractTiles(deltaSeconds) {\n    this.#interactTileGridPoints?.forEach((gp) => {\n      this.#interactTileHighlighter.position = this.gridPointToWorldPoint(gp);\n      this.#interactTileHighlighter.update(deltaSeconds);\n    });\n  }\n\n  /**\n   * Highlight reachable door tiles.\n   * @param {number} deltaSeconds\n   */\n  #highlightReachableDoorTiles(deltaSeconds) {\n    this.#reachableDoorTileGridPoints?.forEach((gp) => {\n      this.#reachableDoorTileHighlighter.position =\n        this.gridPointToWorldPoint(gp);\n      this.#reachableDoorTileHighlighter.update(deltaSeconds);\n    });\n  }\n\n  /**\n   * Handle a tile click.\n   * To be actioned a tile must be in the highlightedRoutes\n   * @param {module:utils/sprites/sprites.Sprite} target - the sprite that was clicked. This prevents the need\n   * to use 'this' which may not be correct in the context.\n   * @param {Point} point - the position in the world that was clicked\n   * @param {module:utils/sprites/sprite~SpriteClickHandler} clickHandler\n   */\n  #filterClick(target, point, clickHandler) {\n    const gridPoint = this.worldPointToGrid(point);\n    let occupant;\n    const occupants = target.getOccupants();\n    if (occupants.size > 0) {\n      occupant = occupants.values().next().value;\n    }\n\n    const movement = this.#movementRoutes?.containsGridPoint(gridPoint);\n    let interaction = false;\n    if (this.#interactTileGridPoints) {\n      for (const point of this.#interactTileGridPoints) {\n        if (point.isCoincident(gridPoint)) {\n          interaction = true;\n          break;\n        }\n      }\n    }\n    const isDeadProp = !occupant?.alive && occupant?.isProp();\n    if ((movement && interaction) || (interaction && isDeadProp)) {\n      clickHandler(target, point, {\n        filter: ClickEventFilter.MOVE_OR_INTERACT_TILE,\n        occupant: occupant,\n      });\n      return;\n    } else if (movement) {\n      clickHandler(target, point, {\n        filter: ClickEventFilter.MOVEMENT_TILE,\n        occupant: occupant,\n      });\n      return;\n    } else if (interaction) {\n      clickHandler(target, point, {\n        filter: ClickEventFilter.INTERACT_TILE,\n        occupant: occupant,\n      });\n      return;\n    }\n\n    if (this.#reachableDoorTileGridPoints) {\n      for (const gp of this.#reachableDoorTileGridPoints) {\n        if (gp.isCoincident(gridPoint)) {\n          clickHandler(target, point, {\n            filter: ClickEventFilter.INTERACT_TILE,\n          });\n          return;\n        }\n      }\n    }\n\n    const heroGridPoint = this.worldPointToGrid(this.#heroActor.position);\n    if (gridPoint.coincident(heroGridPoint)) {\n      clickHandler(target, point, {\n        occupant: this.#heroActor,\n        filter: ClickEventFilter.OCCUPIED_TILE,\n      });\n      return;\n    }\n\n    if (occupant) {\n      clickHandler(target, point, {\n        occupant: occupant,\n        filter: ClickEventFilter.OCCUPIED_TILE,\n      });\n    }\n    LOG.debug('Ignore click outside of highlighted area');\n  }\n\n  /**\n   * Get waypoints to reach destination grid point\n   * @param {Point} worldPoint - destination\n   * @returns {Point[]} null if no route currently found.\n   */\n  getWaypointsToWorldPoint(worldPoint) {\n    const destination = this.worldPointToGrid(worldPoint);\n    return this.#movementRoutes?.getWaypointsAsWorldPoints(destination);\n  }\n\n  /**\n   * Get a random unoccupied ground tile.\n   * @returns {Tile} null if no free ground tile.\n   */\n  getRandomFreeGroundTile() {\n    randomise(this.#randomGround);\n    for (const tile of this.#randomGround) {\n      if (!tile.isOccupied()) {\n        return tile;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Test if point is passable.\n   * @param {Point} gridPoint - row and col coordinates.\n   * @param {module:players/actors.Actor} actor - actor trying to pass\n   * @returns {boolean}\n   */\n  isGridPointPassableByActor(gridPoint, actor) {\n    const tile = this.getTileAtGridPoint(gridPoint);\n    if (!tile) {\n      return false;\n    }\n\n    return tile.isPassableByActor(actor);\n  }\n\n  /**\n   * Test if tile can be occupied by the actor\n   * @param {Point} gridPoint - row and col coordinates.\n   * @param {module:players/actors.Actor} actor - actor trying to occupy location\n   * @returns {boolean}\n   */\n  canGridPointBeOccupiedByActor(gridPoint, actor) {\n    const tile = this.getTileAtGridPoint(gridPoint);\n    if (!tile) {\n      return false;\n    }\n    return tile.canBeOccupiedByActor(actor);\n  }\n\n  /**\n   * Is the grid point visible by the hero.\n   * @param {Point} gridPoint\n   * @returns {boolean}\n   */\n  canHeroSeeGridPoint(gridPoint) {\n    return this.#heroRayTracer?.isGridPointInRays(gridPoint) ?? true;\n  }\n\n  /**\n   * Test if point can be seen through.\n   * @param {Point} gridPoint - row and col coordinates.\n   * @param {module:players/actors.Actor} actor - actor trying to see\n   * @returns {boolean}\n   */\n  isSeeThrough(gridPoint, actor) {\n    const tile = this.getTileAtGridPoint(gridPoint);\n    if (!tile) {\n      return true;\n    }\n\n    return tile.isSeeThrough(actor);\n  }\n\n  /**\n   * Get the tiles surrounding a reference.\n   * @param {Point} gridPoint\n   * @returns {module:utils/arrays/arrayManip~Surrounds}\n   */\n  getSurroundingTiles(gridPoint) {\n    return getSurrounds(this.#tiles, gridPoint.y, gridPoint.x);\n  }\n\n  /**\n   * Get tiles radiating up and down.\n   * @param {Point} gridPoint\n   * @param {number} [distance = 1] - in tiles.\n   * @returns {Tiles[]}\n   */\n  getRadiatingCross(gridPoint, distance = 1) {\n    return radiateCross(this.#tiles, {\n      rowIndex: gridPoint.y,\n      columnIndex: gridPoint.x,\n      distance: distance,\n      filter: (tile) => tile.role === TileRole.GROUND,\n    });\n  }\n\n  /**\n   * Get tiles radiating from a point.\n   * @param {Point} gridPoint\n   * @param {number} [distance = 1] - in tiles.\n   * @returns {Tiles[]}\n   */\n  getRadiating(gridPoint, distance = 1) {\n    return radiate(this.#tiles, {\n      rowIndex: gridPoint.y,\n      columnIndex: gridPoint.x,\n      distance: distance,\n      filter: (tile) => tile.role === TileRole.GROUND,\n    });\n  }\n\n  /** Get radial visible tiles around the hero\n   * @param {number} rangeInTiles\n   * @returns {Tile[]}\n   */\n  getRadiatingVisibleTiles(rangeInTiles) {\n    const tiles = [];\n    const centrePoint = this.worldPointToGrid(this.#heroActor.position);\n    const minX = Math.max(0, centrePoint.x - rangeInTiles);\n    const minY = Math.max(0, centrePoint.y - rangeInTiles);\n    const maxX = centrePoint.x + rangeInTiles;\n    const maxY = centrePoint.y + rangeInTiles;\n    for (let x = minX; x <= maxX; x++) {\n      for (let y = minY; y <= maxY; y++) {\n        const gridPoint = new Point(x, y);\n        if (!gridPoint.coincident(centrePoint)) {\n          const tile = this.getTileAtGridPoint(gridPoint);\n          if (this.canHeroSeeGridPoint(gridPoint) && tile.isSeeThrough()) {\n            tiles.push(tile);\n          }\n        }\n      }\n    }\n    return tiles;\n  }\n\n  /**\n   * Removed occupant from the list of occupants\n   * of the tile at the grid point.\n   * @param {Object} occupant\n   * @param {Point} gridPoint\n   */\n  deleteOccupancyOfGridPoint(occupant, gridPoint) {\n    this.getTileAtGridPoint(gridPoint)?.deleteOccupant(occupant);\n  }\n\n  /**\n   * Set the object's tile occupancy. It is removed from the list of occupants\n   * of the tile at the previous point and added to those of the next.\n   * @param {Object} occupant\n   * @param {Point} oldGridPoint\n   * @param {Point} newGridPoint\n   */\n  moveTileOccupancyGridPoint(occupant, oldGridPoint, newGridPoint) {\n    if (newGridPoint !== oldGridPoint) {\n      this.getTileAtGridPoint(oldGridPoint)?.deleteOccupant(occupant);\n      this.getTileAtGridPoint(newGridPoint)?.addOccupant(occupant);\n    }\n  }\n\n  /**\n   * Get coincident actors.\n   * @param {module:players/actors.Actor} actor\n   * @returns {Actor[]}\n   */\n  getCoincidentActors(actor) {\n    const tile = this.getTileAtWorldPoint(actor.position);\n    return tile.getOccupants();\n  }\n  /**\n   * Get all the participants around an actor. Diagonals are not included in\n   * potential participants.\n   * @param {module:players/actors.Actor} actor\n   * @returns {Actor[]}\n   */\n  getParticipants(actor) {\n    const participants = [];\n    const surrounds = this.getSurroundingTiles(\n      this.worldPointToGrid(actor.position)\n    );\n    const tiles = [\n      surrounds.above,\n      surrounds.right,\n      surrounds.below,\n      surrounds.left,\n    ];\n    tiles.forEach((tile) => {\n      let tileOccupants = tile?.getOccupants();\n      tileOccupants?.forEach((occupant) => {\n        participants.push(occupant);\n      });\n    });\n    return participants;\n  }\n}\n","/**\n * @file Interactions with the ui\n *\n * @module utils/ui/interactions\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * @typedef {function} UiClickCallback\n * @param {Object} target - initial object that triggered the handler\n * @param {module:utils/geometry.Point} point - the position that was clicked in world coordinates\n */\n\n/**\n * BAse for all UiClickHandlers\n */\nexport class UiClickHandler {\n  /** @type {UiClickCallback} */\n  #onClick;\n  /** @type {UiClickCallback} */\n  #onContextClick;\n  /** @type {UiClickCallback} */\n  #onPointerDown;\n  /** @type {UiClickCallback} */\n  #onPointerUp;\n\n  /** Set click handler. Note that this does not add a listener for the event.\n   * @param {UiClickCallback} handler\n   */\n  setOnClick(handler) {\n    this.#onClick = handler;\n  }\n\n  /** Set on context Click handler.\n   * @param {UiClickCallback} handler\n   */\n  setOnContextClick(handler) {\n    this.#onContextClick = handler;\n  }\n\n  /** Set pointer down handler. Note that this does not add a listener for the event.\n   * @param {UiClickCallback} handler\n   */\n  setOnPointerDown(handler) {\n    this.#onPointerDown = handler;\n  }\n\n  /** Set pointer up handler. Note that this does not add a listener for the event.\n   * @param {UiClickCallback} handler\n   */\n  setOnPointerUp(handler) {\n    this.#onPointerUp = handler;\n  }\n  /**\n   * Handle click\n   * @param {module:utils/geometry.Point} point\n   */\n  actionClick(point) {\n    this.#onClick?.(this, point);\n  }\n\n  /**\n   * Handle context click\n   * @param {module:utils/geometry.Point} point\n   */\n  actionContextClick(point) {\n    this.#onContextClick?.(this, point);\n  }\n\n  /**\n   * Handle pointer down\n   * @param {module:utils/geometry.Point} point\n   */\n  actionPointerDown(point) {\n    this.#onPointerDown?.(this, point);\n  }\n\n  /**\n   * Handle pointer up\n   * @param {module:utils/geometry.Point} point\n   */\n  actionPointerUp(point) {\n    this.#onPointerUp?.(this, point);\n  }\n}\n","/**\n * @file Path finders within a tile map\n *\n * @module utils/tileMaps/pathFinder\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { Point } from '../geometry.js';\nimport * as maths from '../maths.js';\n\n/**\n * Map of located routes.\n * Note that all points are grid references NOT WORLD POINTS.\n */\nexport class Routes {\n  /** @type {Map<string, Point[]>} */\n  #routes;\n  /** @type {module:utils/tileMaps/tileMap~TileMap} */\n  #tileMap;\n\n  /**\n   * Create routes.\n   * @param {module:utils/tileMaps/tileMap~TileMap} tileMap\n   */\n  constructor(tileMap) {\n    this.#tileMap = tileMap;\n    this.#routes = new Map();\n  }\n\n  /**\n   * Set route to reach coordinates\n   * @param {Point[]} route\n   * @param {*} x\n   * @param {*} y\n   */\n  setRouteToCoords(route, x, y) {\n    this.#routes.set(this.coordsToKey(x, y), route);\n  }\n\n  /**\n   * Get route to reach coordinates\n   * @param {*} x\n   * @param {*} y\n   * @returns {Point[]} route}\n   */\n  getRouteToCoords(x, y) {\n    return this.#routes.get(this.coordsToKey(x, y));\n  }\n\n  /** Test if routes has route to coords.\n   * @param {number} x - grid position\n   * @param {number} y - grid position\n   * @returns {boolean}\n   */\n  hasRouteToCoords(x, y) {\n    return this.#routes.has(this.coordsToKey(x, y));\n  }\n  /**\n   * Create a key for the routes map from a row and column.\n   * @param {number} x\n   * @param {number} y\n   * @returns {string}\n   */\n  coordsToKey(x, y) {\n    return `${x}|${y}`;\n  }\n\n  /**\n   * Convert a map key to a grid reference.\n   * @param {string} key\n   * @returns {Point} Point giving the tile map grid reference.\n   */\n  keyToGridPoint(key) {\n    const reference = key.split('|');\n    return new Point(parseInt(reference[0]), parseInt(reference[1]));\n  }\n\n  /**\n   * Get the entries\n   * @returns {Iterator}\n   */\n  forEach(callback) {\n    this.#routes.forEach((value, key, map) => callback(value, key, map));\n  }\n\n  /**\n   * Check if any routes contains the coordinates\n   * @param {Point} point\n   * @returns {boolean}\n   */\n  containsGridPoint(point) {\n    return this.#routes.has(this.coordsToKey(point.x, point.y));\n  }\n\n  /**\n   * Get wayPoints to get to destination of x, y. The starting point is stripped\n   * off. Points are returned as grid references\n   * @param {Point} destination\n   * @returns {Point[]} array of points to reach grid reference x, y. Null if no route.\n   */\n  getWaypointsAsGridPoints(destination) {\n    const points = this.getRouteToCoords(destination.x, destination.y);\n    if (points && points.length > 1) {\n      return points.slice(1);\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Get wayPoints to get to destination of x, y. The starting point is stripped\n   * off.\n   * @param {Point} destination\n   * @returns {Point[]} array of points to reach grid reference x, y\n   */\n  getWaypointsAsWorldPoints(destination) {\n    const waypoints = this.getWaypointsAsGridPoints(destination);\n    if (waypoints) {\n      return waypoints.map((gridPoint) =>\n        this.#tileMap.gridPointToWorldPoint(gridPoint)\n      );\n    } else {\n      return waypoints;\n    }\n  }\n}\n/**\n * Encapsulation of route finder for finding paths through routes.\n */\nexport class RouteFinder {\n  /** Actor trying to find routes. @type {module:players/actors~Actor} */\n  actor;\n  /** @type {Route[]} */\n  #routes;\n  /** @type {module:utils/tileMaps/tileMap~TileMap} */\n  #tileMap;\n  /** @type {Point} */\n  #startPoint;\n\n  /** Create the route finder.\n   * @param {module:utils/tileMaps/tileMap~TileMap} tileMap\n   * @param {module:players/actors.Actor} actor\n   */\n  constructor(tileMap, actor) {\n    this.#tileMap = tileMap;\n    this.actor = actor;\n  }\n  /**\n   * Find a route to the destination gridPoint. Note that it tries to find a route\n   * adjacent to the target grid point, not actually on the grid point. The resulting\n   * route is dumb, in that it does not try all options to maximise movement.\n   * @param {Point} startingGridPoint - starting point\n   * @param {Point} targetGridPoint - starting point\n   * @param {*} maxMove - maximum number of moves allowed.\n   * @returns {Map<string, Point[]>} null if no path available or necessary.\n   */\n  getDumbRouteNextTo(startingGridPoint, targetGridPoint, maxMove) {\n    let destination = this.#getAdjacentTarget(\n      startingGridPoint,\n      targetGridPoint\n    );\n    if (destination.coincident(startingGridPoint)) {\n      return [];\n    }\n    if (!this.#tileMap.canGridPointBeOccupiedByActor(destination, this.actor)) {\n      destination = this.#rotateGridPointAbout(destination, targetGridPoint);\n    }\n    let path = [];\n    let dX = Math.sign(destination.x - startingGridPoint.x);\n    let dY = Math.sign(destination.y - startingGridPoint.y);\n    let waypoint = Point.copy(startingGridPoint);\n    let movingX = Math.random() < 0.5;\n    let consecutiveFails = 0;\n    while (maxMove > 0) {\n      let nextPoint = Point.copy(waypoint);\n      let moved = false;\n      if (movingX && dX !== 0 && waypoint.x != destination.x) {\n        nextPoint.x += dX;\n        moved = true;\n      } else if (!movingX && dY !== 0 && waypoint.y != destination.y) {\n        nextPoint.y += dY;\n        moved = true;\n      }\n      moved =\n        moved &&\n        this.#tileMap.canGridPointBeOccupiedByActor(nextPoint, this.actor);\n\n      if (moved) {\n        consecutiveFails = 0;\n        waypoint = nextPoint;\n        maxMove--;\n      } else {\n        if (++consecutiveFails >= 2) {\n          break;\n        }\n        if (!waypoint.coincident(startingGridPoint)) {\n          path.push(this.#tileMap.gridPointToWorldPoint(waypoint));\n        }\n        startingGridPoint = waypoint;\n        movingX = !movingX; //flip axi\n      }\n    }\n    if (!waypoint.coincident(startingGridPoint)) {\n      path.push(this.#tileMap.gridPointToWorldPoint(waypoint));\n    }\n\n    return path;\n  }\n\n  /**\n   * Get all available routes as a Map of paths.\n   * @param {Point} startingGridPoint - starting point\n   * @param {*} maxMove - maximum number of moves allowed.\n   * @returns {Map<string, Point[]>}\n   */\n  getAllRoutesFrom(startingGridPoint, maxMove) {\n    this.#routes = new Routes(this.#tileMap);\n    this.#startPoint = startingGridPoint;\n    this.#findRoutes(startingGridPoint.x, startingGridPoint.y, maxMove, null);\n    return this.#routes;\n  }\n\n  /**\n   * @param {number} x - tile x index of current tile\n   * @param {number} y - tile y index of current tile\n   * @param {number} maxTiles - the maximum number of tiles that can be moved.\n   * @param {Point[]} [routePoints] - array of points that\n   * represent current path taken to get here. If null, this is the start of the\n   * route.\n   */\n  #findRoutes(x, y, movesLeft, routePoints) {\n    if (!routePoints) {\n      /* Initialise route. Don't check if it's clear as it may well be occupied\n       * by the sprite seeking a route.\n       */\n      routePoints = [new Point(x, y)];\n    } else {\n      if (x === this.#startPoint.x && y === this.#startPoint.y) {\n        return;\n      } else if (!this.#isTilePassable(x, y)) {\n        return;\n      }\n      const existingRoute = this.#routes.getRouteToCoords(x, y);\n      if (!existingRoute || routePoints.length < existingRoute.length - 1) {\n        routePoints.push(new Point(x, y)); // we have a route to this point\n        if (this.#canTileBeOccupied(x, y)) {\n          // only save route if we are actually allowed to occupy its end point.\n          this.#routes.setRouteToCoords(routePoints, x, y);\n        }\n        movesLeft--;\n      } else {\n        return;\n      }\n    }\n\n    if (movesLeft > 0) {\n      // try all 4 directions\n      this.#findRoutes(x, y - 1, movesLeft, [...routePoints]); // up\n      this.#findRoutes(x + 1, y, movesLeft, [...routePoints]); // right\n      this.#findRoutes(x, y + 1, movesLeft, [...routePoints]); // down\n      this.#findRoutes(x - 1, y, movesLeft, [...routePoints]); // left\n    }\n  }\n\n  /** Check if tile is passable.\n   * @param {number} x\n   * @param {number} y\n   * @returns {boolean}\n   *\n   */\n  #isTilePassable(x, y) {\n    return this.#tileMap.isGridPointPassableByActor(\n      new Point(x, y),\n      this.actor\n    );\n  }\n\n  /** Check if tile can be occupied.\n   * @param {number} x\n   * @param {number} y\n   * @returns {boolean}\n   *\n   */\n  #canTileBeOccupied(x, y) {\n    return this.#tileMap.canGridPointBeOccupiedByActor(\n      new Point(x, y),\n      this.actor\n    );\n  }\n\n  #getAdjacentTarget(current, target) {\n    const deltaX = target.x - current.x;\n    const deltaY = target.y - current.y;\n    let adjX = target.x;\n    let adjY = target.y;\n    if (Math.abs(deltaX) > Math.abs(deltaY)) {\n      adjX -= Math.sign(deltaX);\n    } else {\n      adjY -= Math.sign(deltaY);\n    }\n    return new Point(adjX, adjY);\n  }\n\n  /**\n   * Rotate a grid point about a target grid point. This does not rotate to\n   * diagonals.\n   */\n  #rotateGridPointAbout(gridPoint, originPoint) {\n    if (gridPoint.x === originPoint.x && gridPoint.y < originPoint.y) {\n      return new Point(gridPoint.x + 1, gridPoint.y + 1);\n    } else if (gridPoint.x > originPoint.x && gridPoint.y === originPoint.y) {\n      return new Point(gridPoint.x - 1, gridPoint.y + 1);\n    }\n    if (gridPoint.x === originPoint.x && gridPoint.y > originPoint.y) {\n      return new Point(gridPoint.x - 1, gridPoint.y - 1);\n    }\n    if (gridPoint.x < originPoint.x && gridPoint.y === originPoint.y) {\n      return new Point(gridPoint.x + 1, gridPoint.y - 1);\n    }\n    return gridPoint;\n  }\n}\n\n/**\n * Ray tracer from a starting point\n */\nexport class RayTracer {\n  /** Actor tracing rays. @type {module:players/actors~Actor} */\n  #actor;\n  /** Start point of the ray. @type {Point} */\n  #rayStartPoint;\n  /** @type {module:utils/tileMaps/tileMap~TileMap} */\n  #tileMap;\n  /** @type {Map<string, Point>} */\n  #reachedPoints;\n  /** @type {Point}   */\n  #lastStartPoint;\n  /** @type {Rectangle} */\n  #bounds;\n  /** @type {Rectangle} */\n  #lastBounds;\n\n  /** Create the ray tracer.\n   * @param {module:utils/tileMaps/tileMap~TileMap} tileMap\n   * @param {module:players/actors.Actor} actor\n   */\n  constructor(tileMap, actor) {\n    this.#tileMap = tileMap;\n    this.#actor = actor;\n  }\n\n  /**\n   * Find all the tiles that are reached from the actor.\n   * @returns {Map<Point>} grid points of reached tiles.\n   */\n  findReachedTiles() {\n    this.#rayStartPoint = this.#tileMap.worldPointToGrid(this.#actor.position);\n    // this.#bounds = this.#tileMap.getVisibleGridPointRect();\n    this.#bounds = this.#tileMap.getMapGridPointRect();\n    if (\n      this.#lastStartPoint &&\n      this.#lastStartPoint.coincident(this.#rayStartPoint) &&\n      this.#bounds &&\n      this.#bounds.equals(this.#lastBounds)\n    ) {\n      return this.#reachedPoints;\n    }\n\n    this.#reachedPoints = new Map();\n    this.#reachedPoints.set(\n      this.#rayStartPoint.toString(),\n      this.#rayStartPoint\n    );\n    this.#getRayEnds().forEach((endPoint) => {\n      this.#traceRayToEnd(endPoint);\n    });\n    this.#lastStartPoint = this.#rayStartPoint;\n    this.#lastBounds = this.#bounds;\n    return this.#reachedPoints;\n  }\n\n  /**\n   * Test if grid point in rays.\n   * @param {Point} gridPoint\n   * @returns {boolean}\n   */\n  isGridPointInRays(gridPoint) {\n    return this.#reachedPoints\n      ? this.#reachedPoints.has(gridPoint.toString())\n      : false;\n  }\n\n  /**\n   * Get the end point of the rays.\n   * @returns {Point[]} array of the end grid points for each ray.\n   */\n  #getRayEnds() {\n    const rayEnds = [];\n    for (\n      let col = this.#bounds.x;\n      col <= this.#bounds.x + this.#bounds.width;\n      col++\n    ) {\n      rayEnds.push(new Point(col, this.#bounds.y));\n      rayEnds.push(new Point(col, this.#bounds.y + this.#bounds.height));\n    }\n\n    for (\n      let row = this.#bounds.y + 1;\n      row <= this.#bounds.y + this.#bounds.height - 1;\n      row++\n    ) {\n      rayEnds.push(new Point(this.#bounds.x, row));\n      rayEnds.push(new Point(this.#bounds.x + this.#bounds.width, row));\n    }\n    return rayEnds;\n  }\n\n  /**\n   * Trace the ray to its end. Note that calculations are done in cartesian coordinates\n   * and so Y values need to be negated during calculations.\n   * @param {Point} endPoint\n   */\n  #traceRayToEnd(endPoint) {\n    let dx;\n    let dy;\n    let steps;\n    const angle = this.#rayStartPoint.getScreenAngleTo(endPoint);\n    const compassDirection = maths.angleToEightPointCompass(angle);\n    if (\n      Math.abs(endPoint.x - this.#rayStartPoint.x) >=\n      Math.abs(endPoint.y - this.#rayStartPoint.y)\n    ) {\n      dx = Math.sign(endPoint.x - this.#rayStartPoint.x);\n      steps = Math.abs(endPoint.x - this.#rayStartPoint.x);\n      dy = steps < 1 ? 0 : (endPoint.y - this.#rayStartPoint.y) / steps;\n    } else {\n      dy = Math.sign(endPoint.y - this.#rayStartPoint.y);\n      steps = Math.abs(endPoint.y - this.#rayStartPoint.y);\n      dx = steps < 1 ? 0 : (endPoint.x - this.#rayStartPoint.x) / steps;\n    }\n    let x = this.#rayStartPoint.x;\n    let y = this.#rayStartPoint.y;\n\n    let firstPoint = true;\n    while (steps >= 0) {\n      const gridPoint = new Point(Math.round(x), Math.round(y));\n      if (firstPoint || this.#tileMap.isSeeThrough(gridPoint, this.#actor)) {\n        this.#markReachedPoint(gridPoint, compassDirection);\n      } else {\n        break; // ray ends.\n      }\n      firstPoint = false;\n      x += dx;\n      y += dy;\n      steps--;\n    }\n  }\n\n  /**\n   * Mark the point as reached. Note that surrounding obstacle tiles need to be\n   * shown as well otherwise wall will not appear.\n   * @param {Point} point\n   * @param {number} compassDir - eight point compass direction of ray\n   */\n  #markReachedPoint(point, compassDir) {\n    this.#reachedPoints.set(point.toString(), point);\n    switch (compassDir) {\n      case maths.CompassEightPoint.N:\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y - 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x, point.y - 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y - 1));\n        break;\n      case maths.CompassEightPoint.NE:\n        this.#markReachedIfNotSeeThrough(new Point(point.x, point.y - 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y - 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y));\n        break;\n      case maths.CompassEightPoint.E:\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y - 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y));\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y + 1));\n        break;\n      case maths.CompassEightPoint.SE:\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y));\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y + 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x, point.y + 1));\n        break;\n      case maths.CompassEightPoint.S:\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y + 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x, point.y + 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x + 1, point.y + 1));\n        break;\n      case maths.CompassEightPoint.SW:\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y));\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y + 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x, point.y + 1));\n        break;\n      case maths.CompassEightPoint.W:\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y - 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y));\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y + 1));\n        break;\n      case maths.CompassEightPoint.NW:\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y));\n        this.#markReachedIfNotSeeThrough(new Point(point.x - 1, point.y - 1));\n        this.#markReachedIfNotSeeThrough(new Point(point.x, point.y - 1));\n        break;\n    }\n  }\n  /**\n   * Mark a tile as Reached if not see through\n   * @param {Point} point\n   */\n  #markReachedIfNotSeeThrough(point) {\n    if (!this.#tileMap.isSeeThrough(point)) {\n      this.#reachedPoints.set(point.toString(), point);\n    }\n  }\n}\n","/**\n * @file Colours used in the game.\n *\n * @module constants/colours\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * Colours used in the game.\n * @enum {string}\n */\nexport const Colours = {\n  DOOR_HIGHLIGHT_FILL: 'rgba(0, 255, 0, 0.2)',\n  DOOR_HIGHLIGHT_STROKE: 'green',\n  HP_GAUGE: 'rgba(204, 51, 0, 0.4)',\n  HP_TRANSIENT_TEXT_HERO: 'white',\n  HP_TRANSIENT_TEXT_ENEMY: 'black',\n  INTERACT_HIGHLIGHT_FILL: undefined,\n  INTERACT_HIGHLIGHT_STROKE: 'red',\n  MORALE_GAUGE: 'rgba(0, 0, 255, 0.4)',\n\n  MOVE_HIGHLIGHT_FILL: undefined,\n  MOVE_HIGHLIGHT_STROKE: 'white',\n};\n","/**\n * @file Manage the game turns. The turnManager is a state machine and implemented\n * as a singleton.\n *\n * @module gameManagement/turnManager\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport { RouteFinder } from '../utils/tileMaps/pathFinder.js';\nimport { PathFollower } from '../utils/sprites/movers.js';\nimport { ClickEventFilter } from '../utils/tileMaps/tileMap.js';\n\nimport WORLD from '../utils/game/world.js';\n\nimport UI from '../utils/dom/ui.js';\n\nimport SCENE_MANAGER from './sceneManager.js';\n\nimport { addFadingText } from '../utils/effects/transient.js';\nimport { pause } from '../utils/timers.js';\nimport { Point, Position, Velocity } from '../utils/geometry.js';\nimport LOG from '../utils/logging.js';\nimport * as maths from '../utils/maths.js';\nimport { showMainMenu } from '../dialogs/mainMenu.js';\nimport { MoveType } from '../players/actors.js';\nimport * as actorDialogs from '../dialogs/actorDialogs.js';\nimport { i18n } from '../utils/messageManager.js';\nimport * as dice from '../utils/dice.js';\nimport { buildActor } from '../dnd/almanacs/actorBuilder.js';\nimport { restoreGameState, saveGameState } from './gameSaver.js';\nimport { showMarkdownDialog } from '../dialogs/guideDialogs.js';\nimport { AssetUrls } from '../../assets/assets.js';\nimport PERSISTENT_DATA from '../utils/persistentData.js';\nimport { TextButtonControl } from '../utils/dom/components.js';\nimport { showUnpickExitDialog } from '../dialogs/openExitDialogs.js';\nimport { showRunePuzzle } from '../dialogs/runeQuestionDialog.js';\nimport { DungeonChallenge } from '../scriptReaders/autoSceneList.js';\nimport SOUND_MANAGER from '../utils/soundManager.js';\nimport * as idLimiter from './identifyLimiter.js';\n\n/**\n * Factor that is multiplied by the maxMovesPerTurn property of an actor to determine\n * if it will bother trying to reach the hero.\n */\nconst TOO_MANY_TURNS_TO_REACH = 1.5;\n/**\n * Max number of tiles that the hero can move for it to be allowed as disengagement.\n */\nconst MAX_TILES_FOR_DISENGAGEMENT = 2;\n/**\n * Enumeration of supported events\n * @enum {number}\n */\nconst EventId = {\n  MAIN_MENU: 0,\n  CLICKED_FREE_GROUND: 1,\n  CLICKED_ENTRANCE: 2,\n  CLICKED_EXIT: 3,\n};\n\n/** Should the game be saved and restored @type {boolean} */\nlet persistentGame = true;\n\n/**\n * Class that allows a simulated movement of an actor. The movement using\n * the route finder takes place immediately, so that the effect of the actor's\n * final position can be used to affect other actors without waiting for the normal\n * duration of the move. The actual motion can then be actioned by a subsequent call to reenact.\n *\n */\nclass ReplayableActorMover {\n  /** @type {module:players/actors.Actor} */\n  #actor;\n  /** @type {AbstractModifier} */\n  #modifier;\n  /** @type {Position} */\n  #originalPosition;\n  /** @type {TileMap} */\n  #tileMap;\n  /** @type {RouteFinder} */\n  #routeFinder;\n  /** @type {boolean} */\n  #heroDisengaging;\n\n  /**\n   *\n   * @param {module:players/actors.Actor} actor\n   * @param {TileMap} tileMap\n   * @param {RouteFinder} routeFinder\n   * @param {boolean} heroDisengaging\n   */\n  constructor(actor, tileMap, routeFinder, heroDisengaging) {\n    this.#actor = actor;\n    this.#tileMap = tileMap;\n    this.#routeFinder = routeFinder;\n    this.#heroDisengaging = heroDisengaging;\n  }\n\n  /**\n   * Get a target grid position based on actor type\n   * @param {Point} actorGridPos\n   * @returns {Point}\n   */\n  #getTargetGridPoint(actorGridPos) {\n    if (this.#actor.moveType === MoveType.HUNT) {\n      if (this.#heroDisengaging) {\n        return actorGridPos; // frozen\n      } else {\n        const heroGridPos = this.#tileMap.worldPointToGrid(heroActor.position);\n        const orthoSeparation =\n          actorGridPos.getOrthoSeparation(heroGridPos) - 1;\n        const maxHuntSeparation =\n          this.#actor.getMaxTilesPerMove() * TOO_MANY_TURNS_TO_REACH;\n        if (orthoSeparation <= maxHuntSeparation) {\n          return this.#tileMap.worldPointToGrid(heroActor.position);\n        }\n      }\n    }\n    // everything else falls back to random walk.\n    return this.#getRandomGridPosition(\n      actorGridPos,\n      this.#actor.getMaxTilesPerMove()\n    );\n  }\n  /**\n   * Move actor to new position using the route finder. The move takes place instantly\n   * but can be replayed using the replay method.\n   */\n  moveInstantly() {\n    this.#originalPosition = Position.copy(this.#actor.position);\n    const tilesToMove = this.#actor.getMaxTilesPerMove();\n    if (tilesToMove === 0) {\n      return;\n    }\n    const actorGridPos = this.#tileMap.worldPointToGrid(this.#actor.position);\n    const targetGridPos = this.#getTargetGridPoint(actorGridPos);\n\n    if (\n      !targetGridPos.coincident(actorGridPos) // && this.#tileMap.canHeroSeeGridPoint(actorGridPos)\n    ) {\n      this.#routeFinder.actor = this.#actor;\n      let waypoints = this.#routeFinder.getDumbRouteNextTo(\n        actorGridPos,\n        targetGridPos,\n        tilesToMove\n      );\n      if (waypoints.length > 0) {\n        this.#modifier = new PathFollower(\n          { path: waypoints, speed: 100 },\n          this.#actor.sprite.modifier\n        );\n        this.#setActorsPosition(waypoints[waypoints.length - 1]);\n      }\n    }\n  }\n\n  /**\n   * Get a random target point.\n   * @param {Point} currentGrid\n   * @param {number} maxDistance - max movement in any direction\n   * @returns {Point}\n   */\n  #getRandomGridPosition(currentGrid, maxDistance) {\n    const x = maths.getRandomIntInclusive(\n      currentGrid.x - maxDistance,\n      currentGrid.x + maxDistance\n    );\n    const y = maths.getRandomIntInclusive(\n      currentGrid.y - maxDistance,\n      currentGrid.y + maxDistance\n    );\n    const dims = this.#tileMap.getDimsInTiles();\n    return new Point(\n      maths.clip(x, 0, dims.width - 1),\n      maths.clip(y, 0, dims.height - 1)\n    );\n  }\n\n  /**\n   * Set the actors position, updating the tile map occupancy as required.\n   * @param {Position} position\n   */\n  #setActorsPosition(position) {\n    const oldGridPoint = this.#tileMap.worldPointToGrid(this.#actor.position);\n    this.#actor.position = position;\n    const newGridPoint = this.#tileMap.worldPointToGrid(this.#actor.position);\n    this.#tileMap.moveTileOccupancyGridPoint(\n      this.#actor,\n      oldGridPoint,\n      newGridPoint\n    );\n  }\n  /**\n   * Restore the actor's original position.\n   */\n  #restorePosition() {\n    this.#setActorsPosition(this.#originalPosition);\n  }\n\n  /**\n   * Undertake the move defined by the modifier.\n   * @returns {Promise} fulfils to undefined.\n   */\n  replay() {\n    this.#restorePosition();\n    if (this.#modifier) {\n      this.#cloneIfOrganic();\n      return this.#modifier.applyAsTransientToSprite(this.#actor.sprite);\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * Clone the actor if currently spawning.\n   */\n  #cloneIfOrganic() {\n    if (this.#actor.isOrganic()) {\n      const clonedActor = buildActor(this.#actor.almanacEntry);\n      clonedActor.position = this.#originalPosition;\n      clonedActor.freezeMovement();\n      WORLD.addActor(clonedActor);\n    }\n  }\n}\n\n/**\n * Class used to handle multiple ReplayableActorMovers.\n */\nclass MovementReplayer {\n  /** @type {TileMap} */\n  #tileMap;\n  /** @type {RouteFinder} */\n  #routeFinder;\n  /** @type {ReplayableActorMover[]} */\n  #movers;\n  /** @type {boolean} */\n  #heroDisengaging;\n  /**\n   *\n   * @param {TileMap} tileMap\n   * @param {RouteFinder} routeFinder\n   * @param {boolean} heroDisengaging\n   */\n  constructor(tileMap, routeFinder, heroDisengaging) {\n    this.#movers = [];\n    this.#tileMap = tileMap;\n    this.#routeFinder = routeFinder;\n    this.#heroDisengaging = heroDisengaging;\n  }\n\n  /**\n   * Add the actor and move immediately to hero. Note if the actor's movement\n   * is zero, the function does nothing.\n   * @param {module:players/actors.Actor} actor\n   */\n  addAndMoveActor(actor) {\n    if (actor.getMaxTilesPerMove() === 0) {\n      return;\n    }\n    const replayableMover = new ReplayableActorMover(\n      actor,\n      this.#tileMap,\n      this.#routeFinder,\n      this.#heroDisengaging\n    );\n    replayableMover.moveInstantly();\n    this.#movers.push(replayableMover);\n  }\n\n  /**\n   * Replay all movements in parallel.\n   * @returns {Promise} fulfils to undefined when all movements complete.\n   */\n  replay() {\n    const promises = [];\n    this.#movers.forEach((mover) => promises.push(mover.replay()));\n    return Promise.all(promises);\n  }\n}\n\n/**\n * Basic State class\n */\nclass State {\n  constructor() {}\n\n  /**\n   * Transition to a new state\n   * @returns {Promise} fulfills to null\n   */\n  async transitionTo(state) {\n    await this.onExit().then(() => {\n      currentState = state;\n      return state.onEntry();\n    });\n  }\n\n  /**\n   * Perform actions on entering the state.\n   * @returns {Promise} fulfills to null\n   */\n  onEntry() {\n    return Promise.resolve();\n  }\n  /**\n   * Handle event.\n   * @param {number} eventId\n   * @param  {module:utils/sprites/sprite~Sprite} sprite - the sprite initiating the event\n   * @param {Object} detail - object will depend on the eventId\n   * @returns {Promise} fulfills to null\n   */\n  onEvent(eventIdUnused) {\n    return Promise.resolve(null);\n  }\n  /**\n   * Actions when the state exits\n   * @returns {Promise} fulfills to null\n   */\n  onExit() {\n    return Promise.resolve(null);\n  }\n}\n\n/**\n * At WaitingToStart\n */\nclass WaitingToStart extends State {\n  onEntry() {\n    LOG.debug('WaitingToStart state');\n  }\n  /**\n   * @override\n   * @param {number} eventId\n   * @param  {module:utils/sprites/sprite~Sprite} point - the point initiating the event\n   * @param {Object} detail - object will depend on the eventId\n   */\n  async onEvent(eventId, pointUnused, detailUnused) {\n    if (eventId === EventId.MAIN_MENU) {\n      await this.transitionTo(new AtMainMenu());\n    } else {\n      return Promise.resolve();\n    }\n  }\n}\n\n/**\n * At main Menu\n */\nclass AtMainMenu extends State {\n  onEntry() {\n    const continuation = !!restoreGameState();\n    return showMainMenu(continuation).then(async (response) => {\n      persistentGame = response !== 'PLAY CASUAL';\n      await this.transitionTo(new AtStart());\n      return;\n    });\n  }\n}\n/**\n * At start state\n */\nclass AtStart extends State {\n  onEntry() {\n    LOG.debug('Enter AtStart');\n\n    return this.#showQuickTips()\n      .then(() => this.#loadFirstOrContinuationScene())\n      .then((continuation) => {\n        const name = heroActor.traits.get('NAME');\n        if (continuation) {\n          return UI.showOkDialog(i18n`MESSAGE DUNGEON INTRO CONTINUE ${name}`, {\n            okButtonLabel: i18n`BUTTON ENTER DUNGEON`,\n            className: 'wall',\n          })\n            .then(() => actorDialogs.showRestDialog(heroActor))\n            .then((response) => {\n              if (response === 'MAIN MENU') {\n                return Promise.reject('MAIN_MENU');\n              }\n              if (!heroActor.alive) {\n                return Promise.reject('DEAD');\n              }\n            });\n        } else {\n          const mdUrl = persistentGame\n            ? AssetUrls.DUNGEON_WELCOME\n            : AssetUrls.DUNGEON_WELCOME_CASUAL;\n          return showMarkdownDialog(mdUrl, {\n            okButtonLabel: i18n`BUTTON ENTER DUNGEON`,\n          });\n        }\n      })\n      .then(() => {\n        heroActor.sprite.position =\n          WORLD.getTileMap().getWorldPositionOfTileByEntry();\n        return;\n      })\n      .then(() => {\n        const intro = SCENE_MANAGER.getCurrentSceneIntro();\n        if (intro) {\n          return UI.showOkDialog(intro, { className: 'mask' });\n        } else {\n          return;\n        }\n      })\n      .then(() => SOUND_MANAGER.playEffect('DOOR_ENTER'))\n      .then(() => currentState.transitionTo(new HeroTurnIdle()))\n      .catch((rejection) => {\n        if (rejection === 'DEAD') {\n          LOG.info('Hero died during rest.');\n          currentState.transitionTo(new AtGameOver());\n        } else {\n          currentState.transitionTo(new AtMainMenu());\n        }\n      });\n  }\n\n  /**\n   * Load the first scene or if using saved games and there\n   * is one in progress, load that.\n   * @returns {Promise<boolean>} fulfils to true if continuation\n   */\n  #loadFirstOrContinuationScene() {\n    const savedGame = persistentGame ? restoreGameState() : null;\n    if (savedGame) {\n      return SCENE_MANAGER.continueFromSavedScene(\n        savedGame.sceneLevel,\n        savedGame.hero\n      ).then(() => true);\n    } else {\n      return SCENE_MANAGER.switchToFirstScene().then(() => false);\n    }\n  }\n\n  /** Show quick tips if required.\n   * @returns {Promise}\n   */\n  #showQuickTips() {\n    if (!PERSISTENT_DATA.get('SHOW_QUICK_TIPS_AT_START', true)) {\n      return Promise.resolve();\n    }\n    const okButton = new TextButtonControl({\n      label: i18n`BUTTON OK`,\n      closes: 'OK',\n    });\n    const notAgainButton = new TextButtonControl({\n      label: i18n`BUTTON DO NOT SHOW AGAIN`,\n      closes: 'NOT AGAIN',\n    });\n    return showMarkdownDialog(AssetUrls.STARTUP_TIPS_MD, {\n      actionButtons: [okButton, notAgainButton],\n    }).then((choice) => {\n      if (choice === 'NOT AGAIN') {\n        PERSISTENT_DATA.set('SHOW_QUICK_TIPS_AT_START', false);\n      }\n      return;\n    });\n  }\n}\n\n/**\n * At Game Over\n */\nclass AtGameOver extends State {\n  async onEntry() {\n    LOG.debug('Enter AtGameOver');\n    let leaderboardIndex = -1;\n    if (persistentGame) {\n      leaderboardIndex = saveGameState(heroActor);\n    }\n\n    addFadingText(i18n`YOU DIED!`, {\n      delaySecs: 1,\n      lifetimeSecs: 3,\n      position: heroActor.position,\n      velocity: new Velocity(0, -100, 0),\n    });\n    await pause(2)\n      .then(() =>\n        actorDialogs.showEpitaph(heroActor, leaderboardIndex, {\n          okButtonLabel: i18n`BUTTON TRY AGAIN`,\n        })\n      )\n      .then(() => SCENE_MANAGER.unloadCurrentScene())\n      .then(() => this.transitionTo(new AtMainMenu()));\n  }\n}\n\n/**\n * At Game Completed\n */\nclass AtGameCompleted extends State {\n  async onEntry() {\n    LOG.debug('Enter AtGameCompleted');\n    await showMarkdownDialog(AssetUrls.DUNGEON_COMPLETE, {\n      okButtonLabel: i18n`BUTTON TRY AGAIN`,\n    })\n      .then(() => SCENE_MANAGER.unloadCurrentScene())\n      .then(() => this.transitionTo(new AtMainMenu()));\n  }\n}\n\n/**\n * State where the hero is in the map.\n */\nclass HeroTurnIdle extends State {\n  constructor() {\n    super();\n  }\n\n  /**\n   * @override\n   */\n  async onEntry() {\n    await super.onEntry();\n    LOG.debug('Enter HeroTurnIdle');\n    await prepareHeroTurn();\n    const dead = await doToxicEffectsKillHero();\n    if (dead) {\n      await this.transitionTo(new AtGameOver());\n    }\n  }\n  /**\n   * @override\n   * @param {number} eventId\n   * @param  {module:utils/sprites/sprite~Sprite} point - the point initiating the event\n   * @param {Object} [detail = {}] - object will depend on the eventId\n   */\n  async onEvent(eventId, point, detail = {}) {\n    switch (eventId) {\n      case EventId.CLICKED_FREE_GROUND:\n        {\n          const filter = await disambiguateFilter(\n            detail.filter,\n            detail.occupant\n          );\n          if (filter === ClickEventFilter.INTERACT_TILE) {\n            await interact(point);\n          } else if (filter === ClickEventFilter.OCCUPIED_TILE) {\n            await showOccupantDetails(detail.occupant);\n          } else {\n            await moveHeroToPoint(point, {\n              usePathFinder:\n                detail.filter !== ClickEventFilter.MOVE_OR_INTERACT_TILE,\n            });\n          }\n          if (heroActor.traits.get('HP', 0) === 0) {\n            await this.transitionTo(new AtGameOver());\n          } else {\n            await this.transitionTo(new ComputerTurnIdle());\n          }\n        }\n\n        break;\n      case EventId.CLICKED_ENTRANCE:\n        await UI.showOkDialog(i18n`MESSAGE ENTRANCE STUCK`);\n        await this.transitionTo(new ComputerTurnIdle());\n        break;\n      case EventId.CLICKED_EXIT: {\n        LOG.debug('Escaping');\n        const unlocked = await tryToUnlockExit();\n        if (unlocked) {\n          await moveHeroToPoint(point, { usePathFinder: false }).then(() =>\n            startNextScene(this)\n          );\n        } else {\n          await this.transitionTo(new ComputerTurnIdle());\n        }\n        break;\n      }\n    }\n    return Promise.resolve(null);\n  }\n}\n\n/**\n * State where the hero is in the map.\n */\nclass HeroTurnInteracting extends State {\n  constructor() {\n    super();\n  }\n\n  /**\n   * @override\n   */\n  async onEntry() {\n    await super.onEntry();\n    LOG.debug('Enter HeroTurnInteracting');\n    await prepareHeroTurn();\n    const dead = await doToxicEffectsKillHero();\n    if (dead) {\n      await this.transitionTo(new AtGameOver());\n    }\n  }\n  /**\n   * @override\n   * @param {number} eventId\n   * @param  {module:utils/sprites/sprite~Sprite} point - the point initiating the event\n   * @param {Object} [detail = {}] - object will depend on the eventId\n   */\n  async onEvent(eventId, point, detail = {}) {\n    switch (eventId) {\n      case EventId.CLICKED_FREE_GROUND:\n        {\n          const filter = await disambiguateFilter(\n            detail.filter,\n            detail.occupant\n          );\n          if (filter === ClickEventFilter.INTERACT_TILE) {\n            await interact(point);\n          } else if (filter === ClickEventFilter.OCCUPIED_TILE) {\n            await showOccupantDetails(detail.occupant);\n          } else {\n            await this.#tryToDisengage(point, {\n              usePathFinder:\n                detail.filter !== ClickEventFilter.MOVE_OR_INTERACT_TILE,\n            });\n          }\n\n          if (heroActor.traits.get('HP', 0) === 0) {\n            await this.transitionTo(new AtGameOver());\n          } else {\n            await this.#transitionToComputerTurn();\n          }\n        }\n\n        break;\n      case EventId.CLICKED_ENTRANCE:\n        await UI.showOkDialog(i18n`MESSAGE ENTRANCE STUCK`);\n        await this.#transitionToComputerTurn();\n        break;\n      case EventId.CLICKED_EXIT: {\n        const unlocked = await tryToUnlockExit();\n        if (unlocked) {\n          await this.#tryToDisengage(point, { usePathFinder: false }).then(() =>\n            startNextScene(this)\n          );\n        } else {\n          await this.#transitionToComputerTurn();\n        }\n        break;\n      }\n    }\n    return Promise.resolve(null);\n  }\n\n  /**\n   * Transition to the appropriate computer turn\n   */\n  async #transitionToComputerTurn() {\n    if (WORLD.getTileMap().getParticipants(heroActor).length === 0) {\n      await this.transitionTo(new ComputerTurnIdle());\n    } else {\n      await this.transitionTo(new ComputerTurnInteracting());\n    }\n  }\n\n  /**\n   * Try to run. Note the hero always moves. Disengaging means the enemies won't\n   * follow.\n   * @param {Point} point - position in world.\n   * @param {Object} [options = {usePathFinder: true}]\n   * @param {boolean} options.usePathFinder - should path finder be used.\n   * @returns {Promise} fulfils to undefined\n   */\n  #tryToDisengage(point, options = { usePathFinder: true }) {\n    const tileMap = WORLD.getTileMap();\n    const opponents = tileMap.getParticipants(heroActor);\n    let respectDisengage = false;\n    for (const opponent of opponents) {\n      if (opponent.alive && opponent.interaction.respectDisengage(heroActor)) {\n        respectDisengage = true;\n        break;\n      }\n    }\n    const currentGridPoint = tileMap.worldPointToGrid(heroActor.position);\n    const targetGridPoint = tileMap.worldPointToGrid(point);\n    const movement = currentGridPoint.getOrthoSeparation(targetGridPoint);\n    if (respectDisengage && movement <= MAX_TILES_FOR_DISENGAGEMENT) {\n      heroActor.disengaging = true;\n    }\n    return moveHeroToPoint(point, options).then(() => true);\n  }\n}\n\nclass ComputerTurnIdle extends State {\n  constructor() {\n    super();\n  }\n  async onEntry() {\n    await super.onEntry();\n    LOG.debug('Enter ComputerTurnIdle');\n    await applyOrganicToActors();\n    const tileMap = WORLD.getTileMap();\n\n    const routeFinder = new RouteFinder(tileMap);\n    const replayer = new MovementReplayer(\n      tileMap,\n      routeFinder,\n      heroActor.disengaging\n    );\n    for (const actor of WORLD.getActors().values()) {\n      if (actor !== heroActor && actor.alive) {\n        if (!actor.isWandering() || dice.rollDice(6) > 3) {\n          replayer.addAndMoveActor(actor);\n        }\n      }\n    }\n    for (const actor of WORLD.getOrganicActors().values()) {\n      if (actor.alive) {\n        replayer.addAndMoveActor(actor);\n      }\n    }\n    await replayer.replay();\n\n    const participants = tileMap.getParticipants(heroActor);\n    for (const actor of participants) {\n      if (actor.isEnemy()) {\n        await this.transitionTo(new HeroTurnInteracting());\n        return Promise.resolve(null);\n      }\n    }\n\n    await this.transitionTo(new HeroTurnIdle());\n  }\n}\n\nclass ComputerTurnInteracting extends State {\n  constructor() {\n    super();\n  }\n  async onEntry() {\n    await super.onEntry();\n    await applyOrganicToActors();\n    const tileMap = WORLD.getTileMap();\n\n    const routeFinder = new RouteFinder(tileMap);\n    const replayer = new MovementReplayer(\n      tileMap,\n      routeFinder,\n      heroActor.disengaging\n    );\n    const participants = tileMap.getParticipants(heroActor);\n    for (const actor of WORLD.getActors().values()) {\n      if (actor !== heroActor && actor.alive && actor.interaction) {\n        if (participants.includes(actor) && actor.willInteract()) {\n          await actor.interaction.enact(heroActor);\n        } else {\n          replayer.addAndMoveActor(actor);\n        }\n      }\n    }\n    for (const actor of WORLD.getOrganicActors().values()) {\n      if (actor.alive) {\n        replayer.addAndMoveActor(actor);\n      }\n    }\n    await replayer.replay();\n\n    if (heroActor.traits.get('HP', 0) === 0) {\n      await this.transitionTo(new AtGameOver());\n    } else if (participants.length === 0) {\n      await this.transitionTo(new HeroTurnIdle());\n    } else {\n      await this.transitionTo(new HeroTurnInteracting());\n    }\n\n    return Promise.resolve(null);\n  }\n}\n\n/**\n * Prepare hero turn\n * @returns {Promise}\n */\nfunction prepareHeroTurn() {\n  idLimiter.allowIdCheck();\n  heroActor.disengaging = false;\n  const tileMap = WORLD.getTileMap();\n  const routes = new RouteFinder(tileMap, heroActor).getAllRoutesFrom(\n    tileMap.worldPointToGrid(heroActor.sprite.position),\n    heroActor.getMaxTilesPerMove()\n  );\n  tileMap.setMovementRoutes(routes);\n  tileMap.setInteractActors(tileMap.getParticipants(heroActor));\n  tileMap.calcReachableDoors(heroActor.position);\n  return Promise.resolve(null);\n}\n\n/**\n * Apply any toxic effects to the hero.\n * @returns {boolean} true if dead.\n */\nfunction doToxicEffectsKillHero() {\n  if (heroActor.toxify?.isActive) {\n    heroActor.toxify.enact(heroActor);\n    return heroActor.traits.getInt('HP', 0) <= 0;\n  }\n  return false;\n}\n\n/**\n * Move to point\n * @param {Point} point\n * @param {Object} [options = {usePathFinder:true}]\n * @param {boolean} options.usePathFinder\n * @returns {Promise}\n */\nfunction moveHeroToPoint(point, options = { usePathFinder: true }) {\n  const tileMap = WORLD.getTileMap();\n  let waypoints;\n  if (options.usePathFinder) {\n    waypoints = tileMap.getWaypointsToWorldPoint(point);\n  } else {\n    waypoints = [heroActor.position, point];\n  }\n  tileMap.setMovementRoutes(null);\n  tileMap.setInteractActors(null);\n  if (waypoints) {\n    const modifier = new PathFollower(\n      { path: waypoints, speed: 100 },\n      heroActor.sprite.modifier\n    );\n    return modifier.applyAsTransientToSprite(heroActor.sprite);\n  } else {\n    return Promise.resolve();\n  }\n}\n\n/**\n * Apply organic actions to all actors.\n * @returns {Promise} fulfils to undefined on completion.\n */\nfunction applyOrganicToActors() {\n  const tileMap = WORLD.getTileMap();\n  const promises = [];\n  WORLD.getOrganicActors().forEach((organic) => {\n    const participants = tileMap.getCoincidentActors(organic);\n    participants.forEach((actor) => {\n      if (actor.alive && !actor.isOrganic() && organic.interaction) {\n        promises.push(organic.interaction.enact(actor));\n      }\n    });\n  });\n\n  return Promise.all(promises);\n}\n/**\n * Interact with point\n * @param {Point} point - position in world.\n * @returns {Promise}\n */\nfunction interact(point) {\n  /** @type {module:utils/tileMaps/tileMap~TileMap} */\n  const tileMap = WORLD.getTileMap();\n  const tile = tileMap.getTileAtWorldPoint(point);\n  const targets = tile.getOccupants();\n  const promises = [];\n  for (const target of targets.values()) {\n    if (target.interaction) {\n      promises.push(target.interaction.react(heroActor));\n    }\n  }\n  return Promise.all(promises);\n}\n\n/**\n * Start next scene.\n * @param {State} currentState\n * @returns {Promise} fulfils to undefined.\n */\nfunction startNextScene(currentState) {\n  heroActor.traits.clearTransientFxTraitsAndProperties();\n  if (persistentGame) {\n    saveGameState(heroActor);\n  }\n  if (!SCENE_MANAGER.areThereMoreScenes()) {\n    return currentState.transitionTo(new AtGameCompleted());\n  }\n  return SCENE_MANAGER.unloadCurrentScene()\n    .then(() => actorDialogs.showRestDialog(heroActor))\n    .then((response) => {\n      if (response === 'MAIN MENU') {\n        return Promise.reject('MAIN_MENU');\n      }\n      if (!heroActor.alive) {\n        return Promise.reject('DEAD');\n      }\n    })\n    .then(() => randomlySelectDifficulty())\n    .then(() => SCENE_MANAGER.switchToNextScene())\n    .then((scene) => {\n      heroActor.sprite.position =\n        WORLD.getTileMap().getWorldPositionOfTileByEntry();\n      return scene;\n    })\n    .then((scene) => {\n      if (scene.intro) {\n        return UI.showOkDialog(scene.intro, { className: 'wall' });\n      } else {\n        return;\n      }\n    })\n    .then(() => SOUND_MANAGER.playEffect('DOOR_ENTER'))\n    .then(() => currentState.transitionTo(new HeroTurnIdle()))\n    .catch((rejection) => {\n      if (rejection === 'DEAD') {\n        LOG.info('Hero died during rest.');\n        currentState.transitionTo(new AtGameOver());\n      } else {\n        currentState.transitionTo(new AtMainMenu());\n      }\n    });\n}\n\n/**\n * Occasionally show a rune puzzle to set the next scene's difficulty.\n * @returns {Promise} fulfils to undefined.\n */\nfunction randomlySelectDifficulty() {\n  if (dice.rollDice(6) > 3) {\n    return Promise.resolve();\n  }\n  return showRunePuzzle(SCENE_MANAGER.getCurrentSceneLevel()).then((solved) => {\n    let message;\n    if (solved) {\n      SCENE_MANAGER.setDungeonChallenge(DungeonChallenge.EASY);\n      message = i18n`MESSAGE ROUTE CHOICE - EASY`;\n    } else {\n      SCENE_MANAGER.setDungeonChallenge(DungeonChallenge.MEDIUM);\n      message = i18n`MESSAGE ROUTE CHOICE - MEDIUM`;\n    }\n    return UI.showOkDialog(message);\n  });\n}\n/**\n * Show occupant details.\n * @param {module:players/actors.Actor} occupant\n * @returns {Promise} fulfils to undefined.\n */\nfunction showOccupantDetails(occupant) {\n  if (!occupant) {\n    LOG.error('Clicked on tile but no occupant to view.');\n    return Promise.resolve();\n  }\n  if (occupant.isHiddenArtefact()) {\n    return UI.showOkDialog(occupant.description);\n  }\n\n  return actorDialogs\n    .showActorDetailsDialog(occupant, {\n      allowConsumption: occupant.isHero(),\n      allowMagicUse: occupant.isHero(),\n    })\n    .then((delayedAction) => {\n      if (delayedAction?.invoke) {\n        LOG.info('Invoke action.');\n        return delayedAction.invoke();\n      }\n    });\n}\n\n/**\n * Trigger an event. This will then be passed to the current State to handle.\n * @param {number} eventId\n * @param  {module:utils/sprites/sprite~Sprite} sprite - the sprite initiating the event\n * @param {Object} detail - object will depend on the eventId\n */\nfunction triggerEvent(eventId, sprite, detail) {\n  if (ignoreEvents) {\n    LOG.debug(`Ignoring event ${eventId} as still processing earlier event.`);\n    return;\n  }\n  ignoreEvents = true;\n  currentState.onEvent(eventId, sprite, detail).then(() => {\n    ignoreEvents = false;\n  });\n}\n\n/**\n * @param {ClickEventFilter} filter\n * @param {module:players/actors.Actor} occupant\n * @returns {Promise<ClickEventFilter>}\n */\nfunction disambiguateFilter(filter, occupant) {\n  if (filter === ClickEventFilter.MOVE_OR_INTERACT_TILE) {\n    if (occupant?.isHiddenArtefact()) {\n      const storageDetails = occupant.storeManager.getFirstStorageDetails();\n      const artefact = storageDetails?.artefact;\n      if (occupant.alive && artefact && !occupant.discovered) {\n        return Promise.resolve(ClickEventFilter.INTERACT_TILE);\n      } else if (!occupant.alive && !artefact) {\n        return Promise.resolve(ClickEventFilter.MOVEMENT_TILE);\n      }\n    }\n\n    let message;\n    let moveLabel;\n    let interactLabel;\n    if (occupant.isPortal()) {\n      message = i18n`MESSAGE USE PORTAL OR MOVE`;\n      moveLabel = i18n`BUTTON MOVE`;\n      interactLabel = i18n`BUTTON USE`;\n    } else {\n      message = i18n`MESSAGE SEARCH OR MOVE`;\n      moveLabel = i18n`BUTTON MOVE`;\n      interactLabel = i18n`BUTTON SEARCH`;\n    }\n\n    return UI.showChoiceDialog(i18n`DIALOG TITLE CHOICES`, message, [\n      moveLabel,\n      interactLabel,\n    ]).then((choice) => {\n      if (choice === 0) {\n        return ClickEventFilter.MOVEMENT_TILE;\n      } else {\n        return ClickEventFilter.INTERACT_TILE;\n      }\n    });\n  }\n  return filter;\n}\n/**\n * Set the current hero sprite.\n * @returns {module:players/actors~Actor}\n */\nfunction getHeroActor() {\n  return heroActor;\n}\n\n/** Unlock the exit if necessary.\n * @returns {Promise} fulfils to true if exit can be unlocked.\n */\nfunction tryToUnlockExit() {\n  if (exitKeyArtefact) {\n    if (heroActor.storeManager.hasArtefact(exitKeyArtefact)) {\n      heroActor.storeManager.discard(exitKeyArtefact);\n      return UI.showOkDialog(i18n`MESSAGE KEY UNLOCKS EXIT`).then(() => {\n        SOUND_MANAGER.playEffect('DOOR_EXIT');\n        return true;\n      });\n    } else {\n      return showUnpickExitDialog(heroActor, exitKeyArtefact).then(\n        (success) => {\n          if (success) {\n            SOUND_MANAGER.playEffect('DOOR_EXIT');\n          }\n          return success;\n        }\n      );\n    }\n  } else {\n    SOUND_MANAGER.playEffect('DOOR_EXIT');\n    return Promise.resolve(true);\n  }\n}\n\n/**\n * Start\n * @param {module:players/actors.Actor} actor - the hero actor\n */\nfunction setHero(actor) {\n  heroActor = actor;\n}\n\n/** Lock the exit. The actor will need to possess the artefact unlock it.\n * @param {module:players/ArtefactStoreManager.Artefact}\n */\nfunction setExitKeyArtefact(artefact) {\n  exitKeyArtefact = artefact;\n}\n\n/**\n * @type {module:players/actors~Actor}\n */\nlet heroActor;\n\n/**\n * @type {State}\n */\nlet currentState = new WaitingToStart();\n\n/**\n * Flag to determine whether events are accepted.\n */\nlet ignoreEvents = false;\n\n/** Key required to unlock the exit. @type {module:players/artefacts.Artefact} */\nlet exitKeyArtefact;\n\n/**\n * Single instance of the turn manager.\n */\nconst TURN_MANAGER = {\n  EventId: EventId,\n  getHeroActor: getHeroActor,\n  setHero: setHero,\n  triggerEvent: triggerEvent,\n  setExitKeyArtefact: setExitKeyArtefact,\n};\n\nexport default TURN_MANAGER;\n","/**\n * @file Timers\n *\n * @module utils/timers\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n *\n * @param {number} secs\n * @returns {Promise} fulfils to null\n */\nexport function pause(secs) {\n  return new Promise((resolve) => {\n    setTimeout(() => resolve(), secs * 1000);\n  });\n}\n","/**\n * @file Main menu\n *\n * @module menus/mainMenu\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport UI from '../utils/dom/ui.js';\nimport { BitmapButtonControl } from '../utils/dom/components.js';\nimport { showSettingsDialog } from './settingsDialog.js';\nimport { i18n } from '../utils/messageManager.js';\nimport { showHallOfFameDialog } from './hallOfFameDialogs.js';\nimport { showGuideDialog } from './guideDialogs.js';\n\n/**\n * Display the main menu. All actions are controlled by the main menu except play\n * which results in the menu resolving.\n * @param {boolean} continuation - continue an adventure\n * @returns {Promise} fulfils to undefined if play selected.\n */\nexport function showMainMenu(continuation) {\n  const playAdventure = new BitmapButtonControl({\n    leftLabel: continuation\n      ? i18n`BUTTON CONTINUE ADVENTURE`\n      : i18n`BUTTON PLAY ADVENTURE`,\n    imageName: 'ui-play00.png',\n    internalLabel: true,\n    closes: 'PLAY ADVENTURE',\n  });\n  const playCasual = new BitmapButtonControl({\n    leftLabel: i18n`BUTTON PLAY CASUAL`,\n    imageName: 'ui-play00.png',\n    internalLabel: true,\n    closes: 'PLAY CASUAL',\n  });\n  const settings = new BitmapButtonControl({\n    leftLabel: i18n`BUTTON SETTINGS`,\n    imageName: 'ui-settings00.png',\n    internalLabel: true,\n    action: () => showSettingsDialog(),\n  });\n  const bestAdventure = new BitmapButtonControl({\n    leftLabel: i18n`BUTTON HALL OF FAME`,\n    imageName: 'ui-hall-of-fame00.png',\n    internalLabel: true,\n    action: () => showHallOfFameDialog(),\n  });\n  const guides = new BitmapButtonControl({\n    leftLabel: i18n`BUTTON GUIDES`,\n    imageName: 'ui-guides00.png',\n    internalLabel: true,\n    action: () => showGuideDialog(),\n  });\n  return UI.showControlsDialog(i18n`MENU TITLE MAIN`, {\n    actionButtons: [guides, settings, bestAdventure, playAdventure, playCasual],\n    className: 'door',\n  });\n}\n","/**\n * @file Settings dialog\n *\n * @module dialogs/settingsDialog\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { createControl, ControlType } from '../utils/dom/components.js';\nimport UI from '../utils/dom/ui.js';\nimport PERSISTENT_DATA from '../utils/persistentData.js';\nimport SOUND_MANAGER from '../utils/soundManager.js';\nimport { i18n, MESSAGES } from '../utils/messageManager.js';\nimport { showLogDialog } from './logDialog.js';\nimport { setFullscreenState } from '../utils/fullscreen.js';\n\n/** Settings */\nconst SETTINGS = [\n  {\n    id: 'MUSIC_VOLUME',\n    labelKey: 'CONTROL MUSIC VOLUME',\n    defValue: 50,\n    controlType: ControlType.RANGE,\n    persistent: true,\n    action: null,\n    onChange: (value) => SOUND_MANAGER.setMusicVolumePercent(value),\n  },\n  {\n    id: 'EFFECTS_VOLUME',\n    labelKey: 'CONTROL EFFECTS VOLUME',\n    defValue: 50,\n    controlType: ControlType.RANGE,\n    persistent: true,\n    action: null,\n    onChange: (value) => {\n      SOUND_MANAGER.setEffectsVolumePercent(value);\n      SOUND_MANAGER.playEffect('PUNCH');\n    },\n  },\n  {\n    id: 'SHOW_QUICK_TIPS_AT_START',\n    labelKey: 'CONTROL SHOW QUICK TIPS',\n    defValue: true,\n    controlType: ControlType.CHECKBOX,\n    persistent: true,\n    action: null,\n    onChange: null,\n  },\n  {\n    id: 'START_IN_FULLSCREEN',\n    labelKey: 'CONTROL RUN FULLSCREEN',\n    defValue: false,\n    controlType: ControlType.CHECKBOX,\n    persistent: true,\n    action: null,\n    onChange: null,\n  },\n  {\n    id: 'DO_NOT_SCALE',\n    labelKey: 'CONTROL DO NOT SCALE',\n    defValue: false,\n    controlType: ControlType.CHECKBOX,\n    persistent: true,\n    action: null,\n    onChange: () => UI.showOkDialog(i18n`MESSAGE REQUIRES RESTART`),\n    doNotInitialise: true,\n  },\n  {\n    id: 'SHOW_DEBUG_LOG',\n    labelKey: 'BUTTON SHOW DEBUG LOG',\n    defValue: true,\n    controlType: ControlType.TEXT_BUTTON,\n    persistent: false,\n    action: () => showLogDialog(),\n    onChange: null,\n  },\n  {\n    id: 'CLEAR_MEMORY',\n    labelKey: 'BUTTON DELETE MEMORY',\n    defValue: true,\n    controlType: ControlType.TEXT_BUTTON,\n    persistent: false,\n    action: () => deleteMemory(),\n    onChange: null,\n  },\n];\n\n/**\n * Delete memory. Confirmation is required.\n */\nfunction deleteMemory() {\n  return UI.showChoiceDialog(\n    i18n`DIALOG TITLE DELETE MEMORY`,\n    i18n`MESSAGE CONFIRM DELETE MEMORY`,\n    [i18n`BUTTON DELETE`, i18n`BUTTON CANCEL`]\n  ).then((choice) => {\n    if (choice === 0) {\n      PERSISTENT_DATA.clearAll();\n      return UI.showOkDialog(i18n`MESSAGE MEMORY DELETED`);\n    }\n  });\n}\n/**\n * Display the settings dialog. This retrieves the current settings from local\n * storage and allows modifications. Changes are saved immediately.\n */\nexport function showSettingsDialog() {\n  const controls = [];\n  SETTINGS.forEach((setting) => {\n    controls.push(createControl(setting));\n  });\n  return UI.showControlsDialog(i18n`DIALOG TITLE SETTINGS`, {\n    actionButtons: controls,\n    className: 'door',\n  }).then(() => setFullscreenState(PERSISTENT_DATA.get('START_IN_FULLSCREEN')));\n}\n\n/**\n * Loads persistent settings from stored memory and calls their onChange method.\n */\nexport function initialiseSettings() {\n  SETTINGS.forEach((setting) => {\n    setting.label = MESSAGES.getText(setting.labelKey);\n    if (setting.persistent && setting.onChange && !setting.doNotInitialise) {\n      const value = PERSISTENT_DATA.get(setting.id, setting.defValue);\n      setting.onChange(value);\n    }\n  });\n}\n","/**\n * @file Simple log dialog\n *\n * @module dialogs/logDialog\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../utils/logging.js';\nimport UI from '../utils/dom/ui.js';\nimport { i18n } from '../utils/messageManager.js';\n/**\n * Show log dialog.\n * @returns {Promise}\n */\nexport function showLogDialog() {\n  LOG.getMessages();\n  let text = '';\n  for (const msg of LOG.getMessages()) {\n    text += msg + '\\n';\n  }\n  return UI.showOkDialog(text, {\n    title: i18n`DIALOG TITLE DEBUG LOG`,\n    className: 'wall',\n  });\n}\n","/**\n * @file Fullscreen functions\n *\n * @module utils/fullscreen\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * Set fullscreen state\n * @param {boolean} fullscreen - true for fullscreen.\n */\nexport function setFullscreenState(fullscreen) {\n  if (fullscreen) {\n    if (!document.fullscreenElement) {\n      document.body.requestFullscreen?.();\n    }\n  } else if (document.fullscreenElement) {\n    document.exitFullscreen?.();\n  }\n}\n","/**\n * @file Dialog to show the hall of fame\n *\n * @module dialogs/hallOfFameDialog\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport UI from '../utils/dom/ui.js';\nimport { i18n } from '../utils/messageManager.js';\nimport * as components from '../utils/dom/components.js';\n\nimport { getLeaderboard } from '../gameManagement/gameSaver.js';\n\n/**\n *\n * @param {module:gameManagement/gameSaver~AdventureResult} adventure\n * @returns {string}\n */\nfunction formHallOfFameEntry(adventure) {\n  let startDate = new Date(adventure.adventureStartTime)\n    .toISOString()\n    .split('T')[0];\n  const chrClass = adventure.class?.toLowerCase() ?? '';\n  return i18n`MESSAGE HALL OF FAME ENTRY ${adventure.name} ${adventure.characterLevel} ${chrClass} ${startDate} ${adventure.goldSent} ${adventure.dungeonFloor}`;\n}\n/**\n * Show a dialog with the best adventure results which are picked\n * up from persistent storage.\n * @returns {Promise}\n */\nexport function showHallOfFameDialog() {\n  const container = components.createElement('div', {\n    className: 'best-adventure',\n  });\n  const leaderboardData = getLeaderboard().getCurrentData();\n  if (leaderboardData.length === 0) {\n    container.appendChild(\n      components.createElement('p', {\n        text: i18n`MESSAGE NO SAVED ADVENTURE`,\n      })\n    );\n  } else {\n    const list = document.createElement('ul');\n    container.appendChild(list);\n    for (const adventure of leaderboardData) {\n      list.appendChild(\n        components.createElement('li', {\n          text: formHallOfFameEntry(adventure),\n        })\n      );\n    }\n  }\n  return UI.showElementOkDialog(i18n`DIALOG TITLE HALL OF FAME`, container);\n}\n","/**\n * @file Saver for games\n *\n * @module gameManagement/gameSaver\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport SCENE_MANAGER from './sceneManager.js';\nimport PERSISTENT_DATA from '../utils/persistentData.js';\nimport LOG from '../utils/logging.js';\nimport { buildActor } from '../dnd/almanacs/actorBuilder.js';\nimport { buildArtefact } from '../dnd/almanacs/artefactBuilder.js';\nimport { Actor } from '../players/actors.js';\nimport { Artefact } from '../players/artefacts.js';\nimport { Traits, CharacterTraits, MagicTraits } from '../dnd/traits.js';\nimport { Toxin } from '../dnd/toxins.js';\nimport { sceneToFloor } from '../dnd/floorNumbering.js';\nimport { Leaderboard } from '../utils/leaderBoard.js';\n\n/** @type {number} */\nconst DEFAULT_LEADERBOARD_LEN = 10;\n\n/** @type {string} */\nconst LEADERBOARD_DATA_KEY = 'LEADERBOARD_DATA';\n\n/** @typedef {Object} AdventureResult\n * @property {number} adventureStartTime\n * @property {string} name\n * @property {number} gold\n * @property {number} goldSent\n * @property {number} exp\n * @property {number} characterLevel\n * @property {number} dungeonFloor\n */\n\n/**\n * Create an adventure result\n * @param {module:players/actors.Actor} hero\n * @param {boolean} completed\n * @returns {AdventureResult}\n */\nfunction createAdventureResult(hero, completed) {\n  const result = {\n    adventureStartTime: 0,\n    name: 'unknown',\n    class: 'unknown',\n    gold: 0,\n    goldSent: 0,\n    exp: 0,\n    characterLevel: 0,\n    dungeonFloor: 0,\n    completed: false,\n  };\n  if (hero) {\n    result.adventureStartTime = hero.adventureStartTime;\n    result.name = hero.traits.get('NAME');\n    result.class = hero.traits.get('CLASS');\n    result.gold = hero.storeManager.getPurseValue();\n    result.goldSent = hero.traits.getInt('GOLD_SENT', 0);\n    result.exp = hero.traits.getInt('EXP', 0);\n    result.characterLevel = hero.traits.getCharacterLevel();\n    result.dungeonFloor = sceneToFloor(SCENE_MANAGER.getCurrentSceneLevel());\n    result.completed = completed;\n  }\n  return result;\n}\n\n/**\n * Get the leaderboard.\n * @returns {module:utils/Leaderboard.LeaderBoard}\n */\nexport function getLeaderboard() {\n  const data = PERSISTENT_DATA.get(LEADERBOARD_DATA_KEY);\n  return new Leaderboard(data, {\n    maxLength: DEFAULT_LEADERBOARD_LEN,\n    sortFn: (a, b) => (a.goldSent > b.goldSent ? -1 : 1),\n    equalFn: (a, b) =>\n      a.adventureStartTime === b.adventureStartTime && a.name === b.name,\n  });\n}\n\n/**\n * Get the best stored adventure result.\n * @param {AdventureResult} adventureResult\n * @returns {number} index of the new entry 0 is first. -1 is unplaced.\n */\nfunction saveToLeaderboard(adventureResult) {\n  const leaderboard = getLeaderboard();\n  const index = leaderboard.add(adventureResult);\n  if (index >= 0) {\n    PERSISTENT_DATA.set(LEADERBOARD_DATA_KEY, leaderboard.getCurrentData());\n  }\n  return index;\n}\n\n/**\n * Save the current game. The adventure is also added to the leaderboard if good\n * enough.\n * @param {module:players/actors.Actor} hero\n * @param {boolean} [completed = false]\n * @returns {number} position in leaderboard. 0 is top. -1 is unplaced.\n */\nexport function saveGameState(hero, completed = false) {\n  const adventureResult = createAdventureResult(hero, completed);\n  const leaderboardIndex = saveToLeaderboard(adventureResult);\n  const gameState = {\n    sceneLevel: SCENE_MANAGER.getCurrentSceneLevel(),\n    hero: hero,\n    completed: completed,\n  };\n  PERSISTENT_DATA.set('GAME_STATE', gameState);\n  return leaderboardIndex;\n}\n\n/** Restore the game state.\n * The state is only restored if the hero is alive.\n *\n * @returns {{hero: Actor, sceneLevel: number}} - undefined if failure\n */\nexport function restoreGameState() {\n  const gameState = PERSISTENT_DATA.get('GAME_STATE', null, revive);\n\n  if (!gameState) {\n    LOG.debug('No saved game state to restore.');\n    return;\n  }\n  if (!gameState.hero.alive) {\n    LOG.debug('Last hero state was dead, so not restoring.');\n    return;\n  }\n  if (gameState.completed) {\n    LOG.debug('Last game was completed, so not restoring.');\n    return;\n  }\n  return { hero: gameState.hero, sceneLevel: gameState.sceneLevel };\n}\n\n/**\n * Reviver function called by JSON.parse\n * @param {string} keyUnused\n * @param {*} value\n */\nfunction revive(keyUnused, value) {\n  switch (value?.reviver) {\n    case 'Actor':\n      return Actor.revive(value.data, buildActor);\n    case 'Toxin':\n      return Toxin.revive(value.data);\n    case 'Artefact':\n      return Artefact.revive(value.data, buildArtefact);\n    case 'Traits':\n      return Traits.revive(value.data);\n    case 'CharacterTraits':\n      return CharacterTraits.revive(value.data);\n    case 'MagicTraits':\n      return MagicTraits.revive(value.data);\n    default:\n      return value;\n  }\n}\n","/**\n * @file Actor and artefact builder\n *\n * @module dnd/almanacs/actorBuilder\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { Sprite } from '../../utils/sprites/sprite.js';\nimport { Actor, ActorType, MoveType } from '../../players/actors.js';\nimport * as spriteRenderers from '../../utils/sprites/spriteRenderers.js';\nimport * as animation from '../../utils/sprites/animation.js';\nimport { Position } from '../../utils/geometry.js';\nimport SCREEN from '../../utils/game/screen.js';\nimport { Colours } from '../../constants/canvasStyles.js';\nimport {\n  Fight,\n  Trade,\n  FindArtefact,\n  FindPortal,\n  Poison,\n  Toxify,\n} from '../interact.js';\nimport StdAnimations from '../../scriptReaders/actorAnimationKeys.js';\nimport * as maths from '../../utils/maths.js';\nimport GameConstants from '../../utils/game/gameConstants.js';\nimport { CharacterTraits } from '../traits.js';\nimport { ALMANAC_LIBRARY } from './almanacs.js';\nimport { buildArtefact } from './artefactBuilder.js';\nimport LOG from '../../utils/logging.js';\nimport IMAGE_MANAGER from '../../utils/sprites/imageManager.js';\nimport { getRandomFullName } from '../../utils/nameGenerator.js';\nimport * as magic from '../magic.js';\nimport { VelocityAligner, VelocityMover } from '../../utils/sprites/movers.js';\n/**\n * Specialist traits renderer\n */\nclass TraitsRenderer extends spriteRenderers.MultiGaugeTileRenderer {\n  /** @type {module:players/actors.Actor} */\n  actor;\n  /**\n   * The number of gauges is determined by the maximum length of the fill styles and\n   * stroke styles\n   * @param {CanvasRenderingContext2D} context\n   * @param {Object} options\n   * @param {number} options.tileSize\n   * @param {string[]} options.fillStyles\n   * @param {string[]} options.strokeStyles\n   */\n  constructor(context, options) {\n    super(context, options);\n  }\n  /**\n   * Render the sprite.\n   * @param {module:utils/geometry~Position} position - this will have been adjusted to the screen.\n   */\n  render(position) {\n    if (this.actor && this.actor.traits) {\n      const hp = this.actor.traits.getInt('HP', 0);\n      const hpMax = this.actor.traits.getInt('HP_MAX', 1);\n      this.setLevel(0, hp / hpMax);\n    }\n    super.render(position);\n  }\n}\n\n/**\n * Animation that automatically adjusts the animation based on the actor's velocity\n * and alive property.\n */\nclass ActorStateAnimator extends animation.KeyedAnimatedImages {\n  /** @type {module:players/actors.Actor} */\n  #actor;\n\n  /** Number from eight point compass. */\n  #compassDir;\n\n  /** @type{boolean}*/\n  #aliveStatus;\n\n  /** @type {animation.AnimatedImage} */\n  #fallbackImage;\n\n  /** @type {number} */\n  #rotation;\n\n  /**\n   * Create the empty keyed animated image\n   * @param {string} [key]\n   * @param {AnimatedImage} [animatedImage]\n   */\n  constructor(key, animatedImage) {\n    super(key, animatedImage);\n    this.#compassDir = maths.CompassEightPoint.NONE;\n    this.#fallbackImage = animatedImage;\n    this.#rotation = 0;\n  }\n\n  /**\n   * Set the actor who's velocity will be monitored.\n   * @param {module:players/actors.Actor} actor\n   */\n  setActor(actor) {\n    this.#actor = actor;\n    this.#aliveStatus = this.#actor.alive;\n  }\n\n  /**\n   * Set fallback key\n   * @param {string} key\n   */\n  setFallbackKey(key) {\n    this.#fallbackImage = this.getAnimatedImage(key);\n    if (!this.#fallbackImage?.getCurrentFrame()) {\n      LOG.error(`Fallback key ${key} has no image.`);\n    }\n  }\n\n  /** override */\n  getCurrentFrame() {\n    const dir = this.#getCurrentDirection();\n    if (dir !== this.#compassDir || this.#aliveStatus != this.#actor?.alive) {\n      this.#compassDir = dir;\n      this.#aliveStatus = this.#actor?.alive;\n      this.#setAnimationForState();\n    }\n    const frame = super.getCurrentFrame() ??\n      this.#fallbackImage?.getCurrentFrame() ?? {\n        bitmap: IMAGE_MANAGER.getUndefinedBitmap(),\n        rotation: 0,\n        flip: animation.FlipDirection.NONE,\n      };\n    frame.rotation = this.#rotation;\n    return frame;\n  }\n\n  #getCurrentDirection() {\n    if (!this.#actor || this.#actor.velocity.isZero(0.1)) {\n      return maths.CompassEightPoint.NONE;\n    } else {\n      const dir = this.#actor.velocity.getScreenDirection();\n      return maths.angleToFourPointCompass(dir);\n    }\n  }\n\n  /**\n   * Set the appropriate animation based on the the current compass direction.\n   * Only four points supported.\n   */\n  #setAnimationForState() {\n    if (!this.#actor.alive) {\n      return this.setCurrentKey(StdAnimations.peripatetic.getKeyName('DEAD'));\n    } else if (this.#compassDir === maths.CompassEightPoint.NONE) {\n      return this.setCurrentKey(StdAnimations.peripatetic.getKeyName('IDLE'));\n    }\n\n    return this.#setAnimationForStateByFrame();\n  }\n  /**\n   * Set the appropriate animation based on the the current compass direction.\n   * Only four points supported.\n   */\n  #setAnimationForStateByFrame() {\n    const reverse = this.#actor.disengaging;\n    switch (this.#compassDir) {\n      case maths.CompassEightPoint.NONE:\n        this.setCurrentKey(StdAnimations.peripatetic.getKeyName('IDLE'));\n        break;\n      case maths.CompassEightPoint.E:\n        this.setCurrentKey(\n          StdAnimations.peripatetic.getKeyName(\n            reverse ? 'WALK_WEST' : 'WALK_EAST'\n          )\n        );\n        break;\n      case maths.CompassEightPoint.N:\n      case maths.CompassEightPoint.NW:\n      case maths.CompassEightPoint.NE:\n        this.setCurrentKey(\n          StdAnimations.peripatetic.getKeyName(\n            reverse ? 'WALK_SOUTH' : 'WALK_NORTH'\n          )\n        );\n        break;\n      case maths.CompassEightPoint.W:\n        this.setCurrentKey(\n          StdAnimations.peripatetic.getKeyName(\n            reverse ? 'WALK_EAST' : 'WALK_WEST'\n          )\n        );\n        break;\n      default:\n        this.setCurrentKey(\n          StdAnimations.peripatetic.getKeyName(\n            reverse ? 'WALK_NORTH' : 'WALK_SOUTH'\n          )\n        );\n        break;\n    }\n  }\n}\n\n/**\n * Create set of standard animations.\n * @param {string} imageName - root name for images.\n * @returns {animation.KeyedAnimatedImages}\n */\nfunction createStandardKeyFrames(imageName) {\n  const keyedAnimations = new ActorStateAnimator();\n  StdAnimations.peripatetic.addAllToKeyedAnimation(keyedAnimations, imageName);\n  keyedAnimations.setFallbackKey(StdAnimations.peripatetic.getFallbackKey());\n  return keyedAnimations;\n}\n\n/**\n * Create set of standard artefact animations.\n * @returns {animation.KeyedAnimatedImages}\n */\nfunction createArtefactHolderKeyFrames(imageName) {\n  const keyedAnimations = new ActorStateAnimator();\n  StdAnimations.artefact.addAllToKeyedAnimation(keyedAnimations, imageName);\n  keyedAnimations.setFallbackKey(StdAnimations.artefact.getFallbackKey());\n  return keyedAnimations;\n}\n\n/**\n * Create the actor.\n * @param {string} imageName - no extension\n * @param {string} iconImageName - alternative image used for dialogs. Falls back to imageName. png extension automatically added.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */\nfunction createActor(imageName, iconImageName, traits, almanacEntry) {\n  const keyedAnimation = createStandardKeyFrames(imageName);\n  const imageRenderer = new spriteRenderers.ImageSpriteCanvasRenderer(\n    SCREEN.getContext2D(),\n    keyedAnimation\n  );\n  let renderers;\n  let traitsRenderer;\n  if (\n    almanacEntry.typeId !== 'PORTAL' &&\n    traits.get('MOVE') !== MoveType.ORGANIC\n  ) {\n    traitsRenderer = new TraitsRenderer(SCREEN.getContext2D(), {\n      tileSize: GameConstants.TILE_SIZE - 2,\n      fillStyles: [Colours.HP_GAUGE],\n      strokeStyles: [],\n    });\n    renderers = [traitsRenderer, imageRenderer];\n  } else {\n    renderers = [imageRenderer];\n  }\n\n  const actor = new Actor(\n    new Sprite({\n      renderer: renderers,\n    }),\n    almanacEntry.type\n  );\n  keyedAnimation.setActor(actor);\n\n  if (traitsRenderer) {\n    traitsRenderer.actor = actor;\n  }\n  actor.position = new Position(\n    GameConstants.TILE_SIZE,\n    GameConstants.TILE_SIZE,\n    0\n  );\n  actor.almanacEntry = almanacEntry;\n  actor.traits = traits;\n  actor.velocity = { x: 0, y: 0, rotation: 0 };\n\n  actor.iconImageName = iconImageName\n    ? `${iconImageName}.png`\n    : StdAnimations.peripatetic.getDefaultImageName(imageName);\n\n  const planView = /\\w+_pv/.test(imageName);\n  if (planView) {\n    actor.sprite.replaceBaseModifier(VelocityAligner.createUprightAligner());\n  } else if (almanacEntry.typeId === 'PORTAL') {\n    actor.sprite.replaceBaseModifier(new VelocityMover());\n  }\n  return actor;\n}\n\n/**\n * Create the artefact holder.\n * @param {string} imageName - no extension\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */\nfunction createArtefactHolder(imageName, traits, almanacEntry) {\n  const keyedAnimation = createArtefactHolderKeyFrames(imageName);\n  const imageRenderer = new spriteRenderers.ImageSpriteCanvasRenderer(\n    SCREEN.getContext2D(),\n    keyedAnimation\n  );\n\n  const actor = new Actor(\n    new Sprite({\n      renderer: [imageRenderer],\n    }),\n    almanacEntry.type === 'SPELL' ? ActorType.PROP : ActorType.HIDDEN_ARTEFACT\n  );\n  keyedAnimation.setActor(actor);\n  actor.position = new Position(\n    GameConstants.TILE_SIZE,\n    GameConstants.TILE_SIZE,\n    0\n  );\n  actor.velocity = { x: 0, y: 0, rotation: 0 };\n  actor.interaction = new FindArtefact(actor);\n  actor.iconImageName = `${imageName}.png`;\n  actor.traits = traits ?? new CharacterTraits();\n  return actor;\n}\n\n/**\n * Create animated enemy\n * @param {string} imageName - without extension\n * @param {string} iconImageName - without extension. Name of icon for dialogs.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */\nfunction createEnemy(imageName, iconImageName, traits, almanacEntry) {\n  const actor = createActor(imageName, iconImageName, traits, almanacEntry);\n  if (actor.isOrganic()) {\n    actor.interaction = new Poison(actor);\n    actor.obstacle = false;\n  } else {\n    actor.interaction = new Fight(actor);\n  }\n  return actor;\n}\n\n/**\n * Create animated prop\n * @param {string} imageName - without extension\n * @param {string} iconImageName - without extension. Name of icon for dialogs.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */\nfunction createProp(imageName, iconImageName, traits, almanacEntry) {\n  const actor = createActor(imageName, iconImageName, traits, almanacEntry);\n  actor.interaction = new FindArtefact(actor);\n  return actor;\n}\n\n/**\n * Create animated trader\n * @param {string} imageName - without extension\n * @param {string} iconImageName - alternative image used for dialogs. Falls back to imageName. png extension automatically added.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */\nfunction createTrader(imageName, iconImageName, traits, actorType) {\n  const actor = createActor(imageName, iconImageName, traits, actorType);\n  actor.interaction = new Trade(actor);\n  return actor;\n}\n\n/**\n * Create portal\n * @param {string} imageName - without extension\n * @param {string} iconImageName - alternative image used for dialogs. Falls back to imageName. png extension automatically added.\n * @param {module:dnd/traits~Traits} traits\n * @param {module:dnd/almanacs/almanacs~AlmanacEntry} almanacEntry\n * @returns {module:players/actors.Actor}\n */\nfunction createPortal(imageName, iconImageName, traits, actorType) {\n  const actor = createActor(imageName, iconImageName, traits, actorType);\n  actor.interaction = new FindPortal(actor);\n  return actor;\n}\n\n/**\n * Equip the actor. Note only MONEY, WEAPONS and ARMOUR are equipped. Anything else\n * is ignored.\n * @param {module:players/actors.Actor} actor\n * @param {string[]} equipmentIds - ids of artefacts in the artefacts almanac.\n */\nfunction equipActor(actor, equipmentIds) {\n  if (!equipmentIds || equipmentIds.length === 0) {\n    return;\n  }\n\n  for (const id of equipmentIds) {\n    const artefactEntry = ALMANAC_LIBRARY.findById(id, [\n      'MONEY',\n      'WEAPONS',\n      'ARMOUR',\n      'MAGIC',\n      'ARTEFACTS',\n    ]);\n    if (artefactEntry) {\n      const artefact = buildArtefact(artefactEntry);\n      if (artefact.equipStoreType) {\n        actor.storeManager.equip(artefact, { direct: true });\n      } else {\n        actor.storeManager.stash(artefact, { direct: true });\n      }\n    } else {\n      LOG.error(`Cannot find ${id} artefact in almanac to equip actor.`);\n    }\n  }\n}\n/**\n * Create an actor from an almanac entry.\n * @param {module:dnd/almanacs/almanacActors~AlmanacEntry} almanacEntry\n * @param {module:dnd/traits.CharacterTraits} [initialTraits]\n * almanacEntry. This is normally only used if rebuilding from saved values.\n */\nexport function buildActor(almanacEntry, initialTraits) {\n  const traits =\n    initialTraits ?? new CharacterTraits(almanacEntry.traitsString);\n  if (!traits.get('NAME')) {\n    traits.set('NAME', almanacEntry.name);\n  }\n  let actor;\n  switch (almanacEntry.type) {\n    case ActorType.HERO:\n      actor = createActor(almanacEntry.imageName, null, traits, almanacEntry);\n      actor.type = ActorType.HERO;\n      if (!initialTraits) {\n        traits.set('NAME', getRandomFullName());\n        magic.restoreCastingPower(traits);\n      }\n      actor.toxify = new Toxify();\n      break;\n    case ActorType.PORTAL:\n      actor = createPortal(almanacEntry.imageName, null, traits, almanacEntry);\n      break;\n    case ActorType.TRADER:\n      actor = createTrader(almanacEntry.imageName, null, traits, almanacEntry);\n      break;\n    case ActorType.HIDDEN_ARTEFACT:\n      actor = createArtefactHolder(\n        almanacEntry.imageName,\n        null,\n        traits,\n        almanacEntry\n      );\n      break;\n    case ActorType.PROP:\n      actor = createProp(almanacEntry.imageName, null, traits, almanacEntry);\n      break;\n    default:\n      actor = createEnemy(almanacEntry.imageName, null, traits, almanacEntry);\n      break;\n  }\n\n  actor.description = almanacEntry.description;\n  if (!initialTraits && almanacEntry.equipmentIds) {\n    equipActor(actor, almanacEntry.equipmentIds);\n  }\n  return actor;\n}\n","/**\n * @file Standard animation keys.\n *\n * @module scriptReaders/actorAnimationKeys\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { LoopMethod } from '../utils/arrays/indexer.js';\nimport { AnimatedImage } from '../utils/sprites/animation.js';\n\n/**\n * @typedef {Object} AnimationDefinition\n * @property {string} keyName - animation key name.\n * @property {string} suffix - appended to the image name for this animation\n * @property {Object} options - passed to AnimatedImage constructor\n */\n/**\n * @typedef {Object<string, AnimationDefinition>} AnimationDefinitions\n */\n/**\n * Standard animation definitions for an actor.\n * It is assumed that animation images are formed from a root name.\n * @type {AnimationDefinitions}\n */\nconst PeripateticAnimationDefns = {\n  DEAD: {\n    keyName: 'DEAD',\n    suffix: 'dead',\n    options: {\n      framePeriodMs: 100,\n      loopMethod: LoopMethod.STOP,\n    },\n  },\n  IDLE: {\n    keyName: 'IDLE',\n    suffix: 'idle',\n    options: {\n      framePeriodMs: 300,\n      loopMethod: LoopMethod.REVERSE,\n    },\n  },\n  WALK_NORTH: {\n    keyName: 'WALK_N',\n    suffix: 'walk-n',\n    options: {\n      framePeriodMs: 100,\n      loopMethod: LoopMethod.REVERSE,\n    },\n  },\n  WALK_EAST: {\n    keyName: 'WALK_E',\n    suffix: 'walk-e',\n    options: {\n      framePeriodMs: 100,\n      loopMethod: LoopMethod.REVERSE,\n    },\n  },\n  WALK_SOUTH: {\n    keyName: 'WALK_S',\n    suffix: 'walk-s',\n    options: {\n      framePeriodMs: 100,\n      loopMethod: LoopMethod.REVERSE,\n    },\n  },\n  WALK_WEST: {\n    keyName: 'WALK_W',\n    suffix: 'walk-w',\n    options: {\n      framePeriodMs: 100,\n      loopMethod: LoopMethod.REVERSE,\n    },\n  },\n};\n\n/**\n * Standard animation definitions for an actor holding an artefact.\n * It is assumed that animation images are formed from a root name\n */\nconst ArtefactHolderAnimationDefns = {\n  DEAD: {\n    keyName: 'DEAD',\n    suffix: 'dead',\n    options: {\n      framePeriodMs: 100,\n      loopMethod: LoopMethod.STOP,\n    },\n  },\n  IDLE: {\n    keyName: 'IDLE',\n    suffix: 'idle',\n    options: {\n      framePeriodMs: 300,\n      loopMethod: LoopMethod.REVERSE,\n    },\n  },\n};\n\n/**\n *\n */\nclass AnimationKeys {\n  /** @type {AnimationDefinitions} */\n  #definitions;\n  /**\n   * @param {AnimationDefinitions[]} definitions\n   */\n  constructor(definitions) {\n    this.#definitions = definitions;\n  }\n  /**\n   * Form the frame name for an image\n   * @param {string} key - the key name for the animation.\n   * @param {string} imageName\n   */\n  #formFrameNameRoot(key, imageName) {\n    const suffix = this.#definitions[key]?.suffix;\n    if (!suffix) {\n      throw new Error(\n        `Attempt made to use invalid standard animation key of '${key}'`\n      );\n    }\n    return `${imageName}-${suffix}`;\n  }\n\n  /**\n   * Get the key name.\n   * @param {string} key\n   * @return {string}\n   */\n  getKeyName(key) {\n    return this.#definitions[key].keyName;\n  }\n\n  /**\n   * Get default image name. This is the first frame of IDLE.\n   * @returns {string} root\n   */\n  getDefaultImageName(root) {\n    return `${this.#formFrameNameRoot('IDLE', root)}00.png`;\n  }\n\n  /**\n   * Get the fallback key\n   * @returns {string}\n   */\n  getFallbackKey() {\n    return this.getKeyName('IDLE');\n  }\n  /**\n   * Add all animations to the keyed animation.\n   * @param {KeyedAnimatedImages} keyedAnimations\n   * @param {string} imageName - root name for the animation image.\n   */\n  addAllToKeyedAnimation(keyedAnimations, imageName) {\n    for (const key in this.#definitions) {\n      const anim = this.#definitions[key];\n      keyedAnimations.addAnimatedImage(\n        this.#definitions[key].keyName,\n        new AnimatedImage(\n          {\n            prefix: this.#formFrameNameRoot(key, imageName),\n            suffix: '.png',\n            startIndex: 0,\n            padding: 2,\n          },\n          anim.options\n        )\n      );\n    }\n    keyedAnimations.setCurrentKey(this.#definitions.IDLE.keyName);\n  }\n}\n\n/** Object to access standard animations. */\nconst StdAnimations = {\n  peripatetic: new AnimationKeys(PeripateticAnimationDefns),\n  artefact: new AnimationKeys(ArtefactHolderAnimationDefns),\n};\n\nexport default StdAnimations;\n","/**\n * @file Name generator\n *\n * @module utils/nameGenerator\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport * as maths from './maths.js';\n\n// cspell:disable\nconst VOWEL_SOUNDS = ['a', 'e', 'i', 'o', 'u', 'ee', 'oo'];\nconst START_SOUNDS = [\n  'b',\n  'br',\n  'ch',\n  'chr',\n  'cl',\n  'cr',\n  'd',\n  'dr',\n  'fl',\n  'fr',\n  'g',\n  'gl',\n  'gr',\n  'h',\n  'j',\n  'k',\n  'kr',\n  'kl',\n  'l',\n  'm',\n  'n',\n  'p',\n  'pl',\n  'pr',\n  'qu',\n  'r',\n  's',\n  'sch',\n  'sh',\n  'st',\n  't',\n  'th',\n  'tr',\n  'v',\n  'w',\n  'y',\n  'z',\n];\n\nconst END_SOUNDS = [\n  'b',\n  'bbey',\n  'bble',\n  'bboy',\n  'bby',\n  'c',\n  'ch',\n  'ck',\n  'cky',\n  'ct',\n  'd',\n  'f',\n  'ff',\n  'ffle',\n  'ffy',\n  'ffey',\n  'g',\n  'ge',\n  'gey',\n  'gle',\n  'k',\n  'l',\n  'll',\n  'lly',\n  'lley',\n  'm',\n  'n',\n  'ngle',\n  'nny',\n  'p',\n  'r',\n  's',\n  'sk',\n  'ss',\n  'ssy',\n  'st',\n  'sty',\n  't',\n  'th',\n  'thy',\n  'v',\n  'w',\n  'y',\n  'z',\n  'zzle',\n  'zzy',\n];\n// cspell:enable\n\n/**\n * Get a random single word name.\n * @returns {string}\n */\nexport function getRandomName() {\n  let name;\n  if (Math.random() < 0.5) {\n    name =\n      maths.getRandomMember(START_SOUNDS) +\n      maths.getRandomMember(VOWEL_SOUNDS) +\n      maths.getRandomMember(END_SOUNDS);\n  } else {\n    name =\n      maths.getRandomMember(START_SOUNDS) +\n      maths.getRandomMember(VOWEL_SOUNDS) +\n      maths.getRandomMember(START_SOUNDS) +\n      maths.getRandomMember(VOWEL_SOUNDS) +\n      maths.getRandomMember(END_SOUNDS);\n  }\n  return name.charAt(0).toUpperCase() + name.substring(1);\n}\n\n/**\n * Get a random single word name.\n * @returns {string}\n */\nexport function getRandomFullName() {\n  return `${getRandomName()} ${getRandomName()}`;\n}\n","/**\n * @file Long term effect of toxins; this is broad and can be used for poisons\n * or diseases\n *\n * @module dnd/toxins\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nexport class Toxin {\n  /** @type {number} */\n  #pendingHpChange;\n  /** @type {number} */\n  #hpPerTurn;\n\n  /**\n   * Construct toxin\n   * @param {number} [hpPerTurn = 0] - HP change per turn. Can be fractional\n   * @param {number} [pendingHpChange = 0] - initial amount already pending\n   */\n  constructor(hpPerTurn = 0, pendingHpChange = 0) {\n    this.#hpPerTurn = hpPerTurn;\n    this.#pendingHpChange = pendingHpChange;\n  }\n\n  /**\n   * Apply toxin effect. This should be called once per turn.\n   * @returns {number} change in HP for this turn. This is an integer so\n   * there may not be a change on every call.\n   */\n  getChangeInHpThisTurn() {\n    const deltaHp = this.#hpPerTurn + this.#pendingHpChange;\n    const reportedChange = Math.floor(deltaHp);\n    this.#pendingHpChange = deltaHp - reportedChange;\n    return reportedChange;\n  }\n\n  /**\n   * Apply another toxin\n   * @param {number} hpPerTurn - HP per change. Can be fractional.\n   */\n  addToxicEffect(hpPerTurn) {\n    this.#hpPerTurn += hpPerTurn;\n  }\n\n  /**\n   * Clear effects.\n   */\n  cure() {\n    this.#hpPerTurn = 0;\n    this.#pendingHpChange = 0;\n  }\n\n  /**\n   * Test if this is active.\n   * @returns {boolean}\n   */\n  get isActive() {\n    return this.#hpPerTurn !== 0 || this.#pendingHpChange !== 0;\n  }\n\n  /**\n   * Convert to JSON.\n   * Note this only stores the actor. It does not store\n   * @returns {module:utils/persistentData~ObjectJSON}\n   */\n  toJSON() {\n    return {\n      reviver: 'Toxin',\n      data: {\n        pendingHpChange: this.#pendingHpChange,\n        hpPerTurn: this.#hpPerTurn,\n      },\n    };\n  }\n\n  /**\n   * Revive from previous call to toJSON\n   * @param {Array.Array<key,value>} data - array of map values\n   * @returns {Toxin}\n   */\n  static revive(data) {\n    return new Toxin(data.hpPerTurn, data.pendingHpChange);\n  }\n}\n","/**\n * @file Floor numbering utils\n *\n * @module dnd/floorNumbering\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * Convert a scene number to a floor.\n * Scene levels go 0, 1, 2 ... etc.\n * Floors adopt US numbering and go 1, B1, B2, B3 ... etc. for basement.\n * @param {number} scene\n * @returns {string}\n */\nexport function sceneToFloor(scene) {\n  return scene === 0 ? '1' : `B${scene}`;\n}\n","/**\n * @file Simple management of a leaderboard\n *\n * @module utils/leaderBoard\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nexport class Leaderboard {\n  /** @type {number} */\n  #maxLength;\n  /** @type {Array.<*>} */\n  #values;\n  /** @type {function(a:Object, b:Object):number} */\n  #sortFn;\n  /** @type {function(a:Object, b:Object):boolean} */\n  #equalFn;\n\n  /**\n   * Create a leaderboard. If no initialValues or maxLength are\n   * provided, the max length is set to 1.\n   * @param {number|Array.<*>} initialValues\n   * @param {Object} options\n   * @param {number} [options.maxLength = 10]\n   * @param {function(a:Object, b:Object):number} sortFn - function used for sorting. Returns -1 if a comes\n   * before b, 0 if they are the same position, and 1 if b comes after a.\n   * @param {function(a:Object, b:Object):boolean} equalFn - function used for testing if objects are the same..\n   *\n   */\n  constructor(initialValues, options = {}) {\n    this.#values = initialValues ?? [];\n    this.#maxLength = options?.maxLength ?? 10;\n    this.#sortFn = options.sortFn;\n    this.#equalFn = options.equalFn ?? ((a, b) => a == b);\n  }\n\n  /** Add item to leader board.\n   * @param {Object} item - item to add.\n   * @returns {number} position on board. 0 is top, -1 is unplaced.\n   */\n  add(item) {\n    const existingIndex = this.indexOfEqual(item);\n    if (existingIndex >= 0) {\n      const existingValue = this.#values[existingIndex];\n      if (this.#sortFn(item, existingValue) < 0) {\n        this.#values[existingIndex] = item;\n      } else {\n        return existingIndex; // This object already exists and the new version is not better.\n      }\n    } else {\n      this.#values.push(item); // it's a new item.\n    }\n\n    this.#values.sort(this.#sortFn);\n    if (this.#values.length > this.#maxLength) {\n      this.#values.pop();\n    }\n    return this.#values.indexOf(item);\n  }\n\n  /**\n   * Find object. Uses the this.#equalFn.\n   * @param {Object} value\n   * @returns {number} the index of the found object. -1 if not found.\n   */\n  indexOfEqual(value) {\n    for (let index = 0; index < this.#values.length; index++) {\n      if (this.#equalFn(value, this.#values[index])) {\n        return index;\n      }\n    }\n    return -1;\n  }\n\n  /**\n   * Get the current leaderboard.\n   * @returns {Array.<*>} copy of leaderboard\n   */\n  getCurrentData() {\n    return [...this.#values];\n  }\n\n  /**\n   * Get the max length\n   * @returns {number}\n   */\n  getMaxLength() {\n    return this.#maxLength;\n  }\n}\n","/**\n * @file Dialogs showing guides which are in Markdown.\n *\n * @module dialogs/guideDialogs\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { loadTextFromUrl } from '../utils/assetLoaders.js';\nimport { parseMarkdown } from '../utils/text/markdown/markdown.js';\nimport { createElement, TextButtonControl } from '../utils/dom/components.js';\nimport { i18n } from '../utils/messageManager.js';\nimport UI from '../utils/dom/ui.js';\nimport { AssetUrls } from '../../assets/assets.js';\nimport { VERSION } from '../constants/autoVersion.js';\n\n/**\n * Show the guide dialog. This is the portal to all help information.\n * It starts by showing the quick start.\n */\nexport function showGuideDialog() {\n  const about = new TextButtonControl({\n    label: i18n`BUTTON ABOUT`,\n    action: () => showMarkdownDialog(AssetUrls.ABOUT_MD),\n  });\n\n  const help = new TextButtonControl({\n    label: i18n`BUTTON HELP`,\n    action: () => showMarkdownDialog(AssetUrls.HELP_MD),\n  });\n\n  const privacy = new TextButtonControl({\n    label: i18n`BUTTON PRIVACY`,\n    action: () => showMarkdownDialog(AssetUrls.PRIVACY_MD),\n  });\n\n  return showMarkdownDialog(AssetUrls.QUICK_START_MD, {\n    actionButtons: [help, about, privacy],\n  });\n}\n\n/**\n * Load markdown, parse and display in dialog.\n * @param {URL} url\n * @param {Object} [options = {}]\n * @param {BaseControl[]} options.actionButtons\n * @param {Object} options.okButtonLabel\n * @returns {Promise}\n */\nexport function showMarkdownDialog(url, options = {}) {\n  return loadTextFromUrl(url).then((markdown) => {\n    let html;\n    let text;\n    if (markdown) {\n      html = parseMarkdown(markdown);\n    } else {\n      text = i18n`MESSAGE CANNOT LOAD URL ${url.toString()}`;\n    }\n\n    html = html\n      .replace(/\\$\\{VERSION\\}/g, `${VERSION.build} ${VERSION.date}`)\n      .replace(/\\$\\{COPYRIGHT\\}/g, `${VERSION.copyright}`);\n\n    const container = createElement('div', {\n      className: 'parsed-markdown',\n      text: text,\n      html: html,\n    });\n\n    return UI.showControlsDialog(container, {\n      actionButtons: options.actionButtons,\n      row: true,\n      okButtonLabel: options.okButtonLabel,\n    });\n  });\n}\n","/**\n * @file Light markdown parser\n *\n * @module utils/text/markdown/markdown\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { ParsingWarden } from './parsingWarden.js';\n\n/**\n * @typedef {Object} Replacement\n * @property {RegExp} re - the expression to match.\n * @property {string | function(match, ...captures): string} rep - replacement. If a function is\n * passed, it is provided with the string that matched followed by the captured\n * groups.\n */\n\n/**\n * @type {ParsingWarden}\n */\nconst parsingWarden = new ParsingWarden();\n\n/**\n * Get a printable link. This is a span with the classes printable-link and\n * for-print-only. CSS should hide it from screens.\n * @param {string} href\n * @param {boolean} parentheses - if true the result is wrapped in parentheses.\n */\nexport function getPrintableLink(href, parentheses) {\n  return `<span class=\"printable-link for-print-only\">${\n    parentheses ? '(' : ''\n  }${href}${parentheses ? ')' : ''}</span>`;\n}\n\n/**\n * Applies an appropriate icon to the label text of a link. Applies none if no icon.\n * @param {string} href\n * @param {string} label\n * @returns {string}\n */\nfunction addIconToLink(href, label) {\n  let iconHtml = '';\n  if (/^https:\\/\\/vimeo.com\\//.test(href)) {\n    iconHtml = '<i class=\"fa-brands fa-vimeo\"></i>';\n  } else if (/^https:\\/\\/(www\\.)?youtube.com\\//.test(href)) {\n    iconHtml = '<i class=\"fa-brands fa-youtube\"></i>';\n  }\n  if (iconHtml) {\n    iconHtml = `<span class='link-icon'>${iconHtml}</span>`;\n  }\n  return `${label}${iconHtml}`;\n}\n\n/**\n * Block replacements (flow) {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Content_categories}\n * When processing the Markdown, blocks are created. These are defined as blocks\n * of text separated by at least one blank line. The following replacements\n * are used for code which should be treated as independent blocks. To ensure\n * post processing is correct, they should insert two newlines at the end to\n * create an independent block.\n * @type {Replacement[]}\n */\nconst blockReps = [\n  /** Setext heading 1 */\n  {\n    re: /(?:(.+)\\n=+\\n)/g,\n    rep: '\\n\\n<h1>$1</h1>\\n\\n',\n  },\n  /** Setext heading 2 */\n  {\n    re: /(?:(.+)\\n-+\\n)/g,\n    rep: '\\n\\n<h2>$1</h2>\\n\\n',\n  },\n  /** ATX heading. Any level. */\n  {\n    re: /^(#+)(?: *)(.+?)(?:#*)[ \\t]*$/gm,\n    rep: (matched, hashes, txt) => {\n      const level = Math.min(hashes.length, 6);\n      return `\\n\\n<h${level}>${txt.trim()}</h${level}>\\n`;\n    },\n  },\n  /** block quote */\n  reAllLinesStartWith('>[ \\t]*', {\n    blockPrefix: '<blockquote>',\n    blockSuffix: '</blockquote>',\n  }),\n  /** code block */\n  reAllLinesStartWith('(?: {4}|\\t)', {\n    blockPrefix: '<pre><code>',\n    blockSuffix: '</code></pre>',\n    trimContents: true,\n    useWarden: true,\n  }),\n  /** horizontal rule. This must come before unordered lists to prevent interpretation of - as bullet */\n  {\n    re: /^(?:[*_-] *){3,}\\s*$/gm,\n    rep: '\\n\\n<hr>\\n\\n',\n  },\n  /** unordered list */\n  reAllLinesStartWith(' {0,3}[*+-][ \\t]+', {\n    blockPrefix: '<ul>',\n    blockSuffix: '</ul>',\n    linePrefix: '<li>',\n    lineSuffix: '</li>',\n  }),\n  /** ordered list */\n  reAllLinesStartWith(' {0,3}\\\\d+\\\\.[ \\t]+', {\n    blockPrefix: '<ol>',\n    blockSuffix: '</ol>',\n    linePrefix: '<li>',\n    lineSuffix: '</li>',\n  }),\n];\n\n/**\n * Block replacements used for creating paragraphs.\n * @type {Replacement[]}\n */\nconst paragraphReps = [\n  /** paragraphs of elements not in blocks */\n  {\n    re: /(?:(?:^|\\n{2,})(?!<\\w+>))((?:.(?:\\n(?!\\n))?)+)/g,\n    rep: '\\n\\n<p>$1</p>\\n\\n',\n  },\n  /** tidy up */\n  {\n    re: /\\n{2,}/g,\n    rep: '\\n\\n',\n  },\n];\n\n/**\n * Span replacements used for Markdown.\n * @type {Replacement[]}\n */\nconst spanReps = [\n  /** image */\n  {\n    re: /!(&lt;)?\\[(.*?)\\]\\((https?:\\/\\/[-\\w@:%.+~#=/]+?)(?: +\"(.*?)\")?\\)/gm,\n    rep: (match, floatLeft, altText, src, title) => {\n      const additionalClass = floatLeft ? 'floatable' : '';\n      const html = `<img alt=\"${\n        altText ?? ''\n      }\" class=\"${additionalClass}\" src=\"${src}\" title=\"${title ?? ''}\"/>`;\n      return parsingWarden.protect(html);\n    },\n  },\n  /** link */\n  {\n    re: /\\[(.*?)\\]\\((https?:\\/\\/[-\\w@:%.+~#=/]+?)(?: +\"(.*?)\")?\\)/gm,\n    rep: (match, label, href, title) => {\n      label = addIconToLink(href, label);\n      const html = `<a target=\"_blank\" href=\"${href}\" title=\"${title ?? ''}\">${\n        label ?? ''\n      }</a>${getPrintableLink(href, true)}`;\n      return parsingWarden.protect(html);\n    },\n  },\n  /** automatic link */\n  {\n    re: /(?:&lt;|<)(https?:\\/\\/[-\\w@:%.+~#=/]+?)>/gm,\n    rep: (match, href) => {\n      const html = `<a target=\"_blank\" href=\"${href}\">${href}</a>${getPrintableLink(\n        href,\n        true\n      )}`;\n      return parsingWarden.protect(html);\n    },\n  },\n  /** automatic email */\n  {\n    re: /(?:&lt;|<)([\\w.-]+@(?:[\\w-]+\\.)+[\\w-]+)/gm,\n    rep: (match, address) => {\n      const encoded = encodeToEntities(address);\n      const html = `<a href=\"${encoded}\">${encoded}</a>`;\n      return parsingWarden.protect(html);\n    },\n  },\n  /** code */\n  {\n    re: /(?:`{2,}(.*?)`{2,}|`(.*?)`)/gm,\n    rep: (match, codeA, codeB) => {\n      const html = `<code>${codeA ?? codeB}</code>`;\n      return parsingWarden.protect(html);\n    },\n  },\n  /** emphasis single letters*/\n  {\n    re: /\\*\\*([^\\s])\\*\\*/gm,\n    rep: '<strong>$1</strong>',\n  },\n  {\n    re: /__([^\\s])__/gm,\n    rep: '<strong>$1</strong>',\n  },\n  {\n    re: /\\*([^\\s])\\*/gm,\n    rep: '<em>$1</em>',\n  },\n  {\n    re: /_([^\\s])_/gm,\n    rep: '<em>$1</em>',\n  },\n  /** emphasis words */\n  {\n    re: /\\*\\*([^\\s])(.*?)([^\\s])\\*\\*/gm,\n    rep: '<strong>$1$2$3</strong>',\n  },\n  {\n    re: /__([^\\s])(.*?)([^\\s])__/gm,\n    rep: '<strong>$1$2$3</strong>',\n  },\n  {\n    re: /\\*([^\\s])(.*?)([^\\s])\\*/gm,\n    rep: '<em>$1$2$3</em>',\n  },\n  {\n    re: /_([^\\s])(.*?)([^\\s])_/gm,\n    rep: '<em>$1$2$3</em>',\n  },\n];\n\n/**\n * Escape replacements used for Markdown\n * @type {Replacement[]}\n */\nconst markdownEscReps = [\n  {\n    re: /\\\\([\\\\`*_{}[\\]()#+.!-])/g,\n    rep: (match, chr) => encodeCharToEntity(chr),\n  },\n];\n\n/**\n * Replacements for security reasons.\n */\nconst securityReps = [\n  {\n    re: '\\0',\n    rep: '\\ufffd',\n  },\n];\n\n/**\n * Escape HTML\n * @type {Replacement}\n */\nconst htmlEscIgnoringBrReps = [\n  {\n    re: /&(?![\\w#]+?;)/gm,\n    rep: '&amp;',\n  },\n  {\n    re: /<(?!\\/?(?:br|sub|sup)>)/gim,\n    rep: '&lt;',\n  },\n];\n\n/**\n * Escape HTML\n * @type {Replacement}\n */\nconst htmlEscAllReps = [\n  {\n    re: /&(?![\\w#]+?;)/gm,\n    rep: '&amp;',\n  },\n  {\n    re: /</gim,\n    rep: '&lt;',\n  },\n];\n\n/**\n * Clean up HTML\n */\nconst htmlCleanUpReps = [\n  {\n    re: /^\\s*$/gm,\n    rep: '',\n  },\n  {\n    re: /<(?:p|div)>\\s*?<\\/(?:p|div)>/gim,\n    rep: '',\n  },\n];\n\n/**\n * Parse data using replacements.\n * @param {string} data - text to be parsed.\n * @param {Replacement} replacements - replacements to apply.\n * @returns {string}\n */\nfunction processReplacements(data, replacements) {\n  if (!data) {\n    return data;\n  }\n  replacements.forEach((sub) => {\n    data = data.replaceAll(sub.re, sub.rep);\n  });\n  return data;\n}\n\n/**\n * Create Replacement for consecutive block of lines that all begin with the\n * specified character. This will form part of a regular expression so should be\n * escaped if special characters are to be matched.\n * @param {string} reStart - expression to match at start of each line. NB. if this\n * is a group, it must be non-capturing.\n * @param {Object} [options] - options for the block formation.\n * @param {string} options.blockPrefix - characters placed at the beginning of the resulting block.\n * @param {string} options.blockSuffix - characters placed at the end of the resulting block.\n * @param {string} options.linePrefix - characters placed at the beginning of each resulting line.\n * @param {string} options.lineSuffix - characters placed at the end of each resulting line.\n * @param {boolean} options.trimContents - if true, leading and trailing newlines and carriage returns are stripped\n * @param {boolean} options.useWarden - if true, the result is protected from further parsing.\n * from the block's contents\n * @returns {Replacement}\n */\nfunction reAllLinesStartWith(reStart, options) {\n  const reBlockSearchRe = new RegExp(\n    `(?:^|\\\\n)${reStart}(?:.|\\\\n)*?(?:(\\\\n(?!${reStart}))|$)`,\n    'g'\n  );\n  const lineReplacementRe = new RegExp(`^${reStart}([ \\\\t]*.*)$`, 'gm');\n  const lineReplacement = `${options?.linePrefix ?? ''}$1${\n    options?.lineSuffix ?? ''\n  }`;\n  return {\n    re: reBlockSearchRe,\n    rep: (match) => {\n      let blockContents = match.replaceAll(lineReplacementRe, lineReplacement);\n      if (options.trimContents) {\n        blockContents = blockContents.replace(/^[\\n\\r]*/, '').trimEnd();\n      }\n      if (options.useWarden) {\n        blockContents = parsingWarden.protect(blockContents);\n      }\n      let html = `\\n\\n${options?.blockPrefix ?? ''}${blockContents}${\n        options?.blockSuffix ?? ''\n      }\\n\\n`;\n      return html;\n    },\n  };\n}\n\n/**\n * Encode character to HTML entity\n * @param {string} chr - character to encode. Although accepting a string, only the first\n * character is encoded.\n * @returns{string} HTML entity for first character.\n */\nfunction encodeCharToEntity(chr) {\n  return `&#${chr.charCodeAt(0).toString()};`;\n}\n/**\n * Encode a string to html entities.\n * @param {string} data\n * @returns {string}\n */\nexport function encodeToEntities(data) {\n  let result = '';\n  for (const chr of data) {\n    result += encodeCharToEntity(chr);\n  }\n  return result;\n}\n\n/**\n * Decode html hex entities to string. Note the entity is followed by a soft hyphen\n * character to prevent a character such as a < disrupting any html.\n * @param {string} data\n * @returns {string}\n */\nexport function decodeFromEntities(data) {\n  let decoded = data.replaceAll(\n    /&#([0-9]{1,4});/g,\n    (match, value) => String.fromCharCode(parseInt(value)) + '\\xAD'\n  );\n\n  decoded = decoded.replace(/&lt;/gi, '<');\n  decoded = decoded.replace(/&gt;/gi, '>');\n  decoded = decoded.replace(/&nbsp;/gi, ' ');\n  decoded = decoded.replace(/&amp;/gi, '&');\n  decoded = decoded.replace(/</gi, '<\\xAD');\n  decoded = decoded.replace(/&/gi, '&\\xAD');\n\n  return decoded;\n}\n\n/**\n * Convert the Markdown data into HTML.\n * Before parsing the Markdown, any HTML special characters are escaped.\n * Note that note all Markdown is supported and there are some limitations.\n *\n * + Blockquotes: Lazy blockquotes are not supported. Each line must be preceded\n * by >. Also nested blockquotes are not supported.\n * + lists: only simple lists are supported. Blockquotes, code blocks and other\n * block elements cannot be included.\n * + Html: Inline HTML is not supported. This is not safe when merging HTML\n * generated from Markdown into existing elements and so, with the exception of\n * HTML entities and <br>, all HTML is escaped.\n * Entities such as &amp;copy; and line breaks <br> will not be escaped.\n * + Reference links: These are not supported.\n * + Automatic links: Markdown uses less than and greater than characters to\n * surround automatic links. However, the greater than character is converted to\n * an HTML entity before parsing the Markdown. This means that <...> or &lt;...>\n * will be interpreted as automatic links. If you want to prevent the contents\n * being interpreted as an automatic link, use the &gt; entity for the closing\n * tag.\n *\n *\n * @param {string} data\n * @param {Object} options - additional processing options.\n * @param {Replacement[]} options.pre - an array of Replacement objects which\n * are applied before any other processing is applied\n * @param {Replacement[]} options.post - an array of Replacement objects\n * which are applied after the markdown replacements have been made.\n * @returns Resulting html.\n */\nexport function parseMarkdown(data, options) {\n  parsingWarden.clear(); // this shouldn't be necessary as the warden automatically clears on retrieval.\n  var result = data.replaceAll(/\\r/g, ''); // normalise line endings\n\n  result = processReplacements(result, securityReps);\n  if (options?.pre) {\n    result = processReplacements(result, options.pre);\n  }\n\n  result = processReplacements(result, htmlEscIgnoringBrReps);\n  result = processReplacements(result, markdownEscReps);\n  result = processReplacements(result, blockReps);\n  result = processReplacements(result, paragraphReps);\n  result = processReplacements(result, spanReps);\n  result = processReplacements(result, htmlCleanUpReps);\n\n  if (options?.post) {\n    result = processReplacements(result, options.post);\n  }\n  return parsingWarden.reinstate(result);\n}\n\n/**\n * Convert the Markdown data into HTML.\n * This is a stripped down version of parseMarkdown.\n *\n * Escaping takes place, but then only span replacements are processed.\n * @param {string} data\n */\nexport function parseMarkdownSpanOnly(data) {\n  parsingWarden.clear(); // this shouldn't be necessary as the warden automatically clears on retrieval.\n  var result = data.replaceAll(/\\r/g, ''); // normalise line endings\n  result = processReplacements(result, securityReps);\n  result = processReplacements(result, htmlEscIgnoringBrReps);\n  result = processReplacements(result, markdownEscReps);\n  result = processReplacements(result, spanReps);\n  result = processReplacements(result, htmlCleanUpReps);\n  return parsingWarden.reinstate(result);\n}\n\n/**\n * Escapes html. No markdown is processed.\n * @param {string} data\n * @returns {string}\n */\nexport function escapeHtml(data) {\n  data = processReplacements(data, securityReps);\n  return processReplacements(data, htmlEscAllReps);\n}\n\n/**\n * Convert html into plain text.\n * This is not used for sanitizing purposes. It is just used\n * @param {string} html\n * @returns {string} the plain text\n */\nexport function getPlainTextFromHtml(html) {\n  let plain = html.replace(/<[^>]*>/g, '').replace(/\\s+/g, ' ');\n  return decodeFromEntities(plain);\n}\n","/**\n * @file Simple protection from future parsing.\n *\n * @module utils/text/markdown/parsingWarden\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport { stringToBase64 } from './base64.js';\n\n/**\n * Class to protect values from future parsing.\n */\nexport class ParsingWarden {\n  #wards = new Map();\n  constructor() {}\n\n  /** Clear all the entries */\n  clear() {\n    this.#wards.clear();\n  }\n\n  /**\n   * Create a key code from the data.\n   * @param {string} data\n   * @returns {string} a unique key.\n   */\n  #createKeyCode(data) {\n    return stringToBase64(data).replace(/=/g, ':'); // == is markdown\n  }\n  /**\n   *\n   * @param {string} data - the data to guard\n   * @returns {string} the key. This can be used as the protected data. If data\n   * is empty, it is returned untouched.\n   */\n  protect(data) {\n    if (!data) {\n      return data; // nothing to protect\n    }\n    const key = `???${this.#wards.size}${this.#createKeyCode(data)}???`;\n    this.#wards.set(key, data);\n    return key;\n  }\n\n  /**\n   * Get the originally protected string. The protected value is removed.\n   * @returns {string} the originally protected value. If not found, the key is returned.\n   */\n  retrieve(key) {\n    const value = this.#wards.get(key);\n    this.#wards.delete(key);\n    if (!value) {\n      console.error(`Could not find ${key} in protected data.`);\n      return key;\n    } else {\n      return value;\n    }\n  }\n\n  /**\n   * Search for keys in the data and reinstate. Any retrieved values are removed.\n   * @param {string} data\n   * @returns {string}\n   */\n  reinstate(data) {\n    return data.replace(/[?]{3}\\d+[a-zA-Z0-9+/]+:{0,2}[?]{3}/g, (match) =>\n      this.retrieve(match)\n    );\n  }\n}\n","/**\n * @file Base64 routines\n *\n * @module utils/text/markdown/base64\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport { safeEncodeURIComponent } from '../safeEncoder.js';\n\n/**\n * Converts string to base64 representation. Note that the string is first encoded\n * so the base64 result represents the encoded version and not the original string.\n * @param {string} str - string to encode.\n * @returns {string}\n */\nexport function stringToBase64(str) {\n  return window.btoa(safeEncodeURIComponent(str));\n}\n\n/**\n * converts base64 string to a string.\n * It is assumed that the original string used to create the base64 version\n * was first encoded using safeEncodeURIComponent.\n * As such the resulting base64 conversion is decoded using\n * decodeURIComponent before returning.\n * @param {string} base64\n * @returns {string}\n */\nexport function base64ToString(base64) {\n  return decodeURIComponent(window.atob(base64));\n}\n","/**\n * @file Safe version of encode functions.\n *\n * @module utils/text/safeEncoder\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * Encode the uri. This just calls encodeURIComponent. If it fails, the string\n * will be converted using `toWellFormed()` to remove any lone surrogates.\n * The function `toWellFormed` is not called by default as it is expensive and\n * lone surrogates are unlikely to be encountered.\n * @param {string} uri\n * @returns {string}\n * @throws {URIError}\n */\nexport function safeEncodeURIComponent(uri) {\n  try {\n    return encodeURIComponent(uri);\n  } catch (error) {\n    console.error(error);\n    return encodeURIComponent(uri.toWellFormed());\n  }\n}\n","/**\n * @file Urls\n *\n * @module src/assets/urls.js\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport textureMap from './images/dungeon.json';\n\n/**\n * Urls for dynamically loading resources @type {Object<string, URL>}\n */\nexport const AssetUrls = {\n  ABOUT_MD: new URL('./guides/about.md', import.meta.url),\n  ALMANAC_MAP: new Map([\n    ['ARMOUR', new URL('./almanacs/armour.txt', import.meta.url)],\n    ['ARTEFACTS', new URL('./almanacs/artefacts.txt', import.meta.url)],\n    ['MAGIC', new URL('./almanacs/magic.txt', import.meta.url)],\n    ['ENEMIES', new URL('./almanacs/monsters.txt', import.meta.url)],\n    ['HEROES', new URL('./almanacs/heroes.txt', import.meta.url)],\n    ['MONEY', new URL('./almanacs/money.txt', import.meta.url)],\n    ['TRADERS', new URL('./almanacs/traders.txt', import.meta.url)],\n    ['WEAPONS', new URL('./almanacs/weapons.txt', import.meta.url)],\n    ['KEYS', new URL('./almanacs/keys.txt', import.meta.url)],\n    ['TRAPS', new URL('./almanacs/traps.txt', import.meta.url)],\n    ['PLANTS', new URL('./almanacs/plants.txt', import.meta.url)],\n    ['PORTALS', new URL('./almanacs/portals.txt', import.meta.url)],\n  ]),\n  DUNGEON_COMPLETE: new URL('./stories/dungeon-completed.md', import.meta.url),\n  DUNGEON_SCRIPT: new URL('./stories/dungeon_script.txt', import.meta.url),\n  DUNGEON_WELCOME: new URL('./stories/dungeon-welcome.md', import.meta.url),\n  DUNGEON_WELCOME_CASUAL: new URL(\n    './stories/dungeon-welcome-casual.md',\n    import.meta.url\n  ),\n  HELP_MD: new URL('./guides/help.md', import.meta.url),\n  MUSIC: new URL(\n    './audio/do-alto-do-trono-da-desolacao-trimmed.mp3', // cspell:disable-line\n    import.meta.url\n  ),\n  PRIVACY_MD: new URL('./guides/privacy.md', import.meta.url),\n  STARTUP_TIPS_MD: new URL('./guides/startupTips.md', import.meta.url),\n  QUICK_START_MD: new URL('./guides/quickStart.md', import.meta.url),\n  SOUND_EFFECTS_MAP: new Map([\n    ['PUNCH', new URL('./audio/punch-trimmed.mp3', import.meta.url)],\n    [\n      'DOUBLE PUNCH',\n      new URL('./audio/punch-trimmed-double.mp3', import.meta.url),\n    ],\n    ['MISS', new URL('./audio/long-medium-swish-trimmed.mp3', import.meta.url)],\n    ['POISONED', new URL('./audio/bubbling-trimmed.mp3', import.meta.url)],\n    ['DIE', new URL('./audio/male-hurt-sound-trimmed.mp3', import.meta.url)],\n    ['DIE_MONSTER', new URL('./audio/pig-oink-47167.mp3', import.meta.url)],\n    [\n      'DIE_MONSTER_SMALL',\n      new URL('./audio/squeal-thing-103111.mp3', import.meta.url),\n    ],\n    [\n      'DIE_MONSTER_UNDEAD',\n      new URL('./audio/zombie-6851_derived.mp3', import.meta.url),\n    ],\n    [\n      'TRIGGER TRAP',\n      new URL('./audio/metal-blade-slice-32-195321.mp3', import.meta.url),\n    ],\n    ['SPELL_CHANT', new URL('./audio/spell_chant.mp3', import.meta.url)],\n    [\n      'DOOR_EXIT',\n      new URL('./audio/door-43633_trimmed_exit.mp3', import.meta.url),\n    ],\n    [\n      'DOOR_ENTER',\n      new URL('./audio/door-43633_trimmed_enter.mp3', import.meta.url),\n    ],\n    [\n      'PORTAL',\n      new URL('./audio/sci-fi-portal-83746-trimmed.mp3', import.meta.url),\n    ],\n  ]),\n  SPLASH_IMAGE: new URL('./images/click-and-crawl.png', import.meta.url),\n};\n\n/**\n * @type {{data: Object, textureUrl: URL}}\n */\nexport const SpriteSheet = {\n  data: textureMap,\n  textureUrl: new URL('./images/dungeon.png', import.meta.url),\n};\n","{\"frames\": [\r\n\r\n{\r\n\t\"filename\": \"acid00.png\",\r\n\t\"frame\": {\"x\":1,\"y\":293,\"w\":49,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":49,\"h\":48},\r\n\t\"sourceSize\": {\"w\":49,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"amber.png\",\r\n\t\"frame\": {\"x\":197,\"y\":150,\"w\":47,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":47,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"aquamarine.png\",\r\n\t\"frame\": {\"x\":250,\"y\":52,\"w\":42,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":1,\"w\":42,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"arcane_orb.png\",\r\n\t\"frame\": {\"x\":544,\"y\":51,\"w\":47,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":2,\"w\":47,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"axe.png\",\r\n\t\"frame\": {\"x\":52,\"y\":191,\"w\":42,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":0,\"w\":42,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-dead00.png\",\r\n\t\"frame\": {\"x\":658,\"y\":287,\"w\":47,\"h\":33},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":11,\"w\":47,\"h\":33},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-idle00.png\",\r\n\t\"frame\": {\"x\":337,\"y\":301,\"w\":44,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":1,\"w\":44,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-idle01.png\",\r\n\t\"frame\": {\"x\":52,\"y\":293,\"w\":45,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":0,\"w\":45,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-e00.png\",\r\n\t\"frame\": {\"x\":246,\"y\":305,\"w\":41,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":0,\"w\":41,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-e01.png\",\r\n\t\"frame\": {\"x\":52,\"y\":343,\"w\":46,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":46,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-e02.png\",\r\n\t\"frame\": {\"x\":307,\"y\":448,\"w\":40,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":0,\"w\":40,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-e03.png\",\r\n\t\"frame\": {\"x\":349,\"y\":447,\"w\":36,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":0,\"w\":36,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-n00.png\",\r\n\t\"frame\": {\"x\":200,\"y\":52,\"w\":48,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":48,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-n01.png\",\r\n\t\"frame\": {\"x\":303,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-n02.png\",\r\n\t\"frame\": {\"x\":196,\"y\":101,\"w\":48,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":48,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-n03.png\",\r\n\t\"frame\": {\"x\":99,\"y\":292,\"w\":45,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":45,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-s00.png\",\r\n\t\"frame\": {\"x\":430,\"y\":301,\"w\":44,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":1,\"w\":44,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-s01.png\",\r\n\t\"frame\": {\"x\":100,\"y\":342,\"w\":44,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":0,\"w\":44,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-s02.png\",\r\n\t\"frame\": {\"x\":337,\"y\":350,\"w\":44,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":1,\"w\":44,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-s03.png\",\r\n\t\"frame\": {\"x\":100,\"y\":392,\"w\":46,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":46,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-w00.png\",\r\n\t\"frame\": {\"x\":525,\"y\":101,\"w\":38,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":38,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-w01.png\",\r\n\t\"frame\": {\"x\":246,\"y\":355,\"w\":42,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":42,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-w02.png\",\r\n\t\"frame\": {\"x\":473,\"y\":201,\"w\":38,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":38,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"barbarian1-walk-w03.png\",\r\n\t\"frame\": {\"x\":852,\"y\":243,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"battleaxe.png\",\r\n\t\"frame\": {\"x\":666,\"y\":196,\"w\":46,\"h\":42},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":6,\"w\":46,\"h\":42},\r\n\t\"sourceSize\": {\"w\":49,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"belt_of_strength.png\",\r\n\t\"frame\": {\"x\":1088,\"y\":194,\"w\":47,\"h\":41},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":8,\"w\":47,\"h\":41},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"berserker-dead00.png\",\r\n\t\"frame\": {\"x\":97,\"y\":150,\"w\":48,\"h\":40},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":2,\"w\":48,\"h\":40},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"berserker-idle00.png\",\r\n\t\"frame\": {\"x\":1088,\"y\":51,\"w\":47,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":47,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"berserker-idle01.png\",\r\n\t\"frame\": {\"x\":100,\"y\":442,\"w\":46,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":46,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"black_flask.png\",\r\n\t\"frame\": {\"x\":246,\"y\":101,\"w\":28,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":10,\"y\":0,\"w\":28,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"blank.png\",\r\n\t\"frame\": {\"x\":561,\"y\":201,\"w\":3,\"h\":3},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":3,\"h\":3},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"block.png\",\r\n\t\"frame\": {\"x\":353,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"blood-splat-twice.png\",\r\n\t\"frame\": {\"x\":1,\"y\":1,\"w\":96,\"h\":94},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":96,\"h\":94},\r\n\t\"sourceSize\": {\"w\":96,\"h\":96}\r\n},\r\n{\r\n\t\"filename\": \"blood-splat.png\",\r\n\t\"frame\": {\"x\":1,\"y\":97,\"w\":94,\"h\":92},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":4,\"w\":94,\"h\":92},\r\n\t\"sourceSize\": {\"w\":96,\"h\":96}\r\n},\r\n{\r\n\t\"filename\": \"blue_flask.png\",\r\n\t\"frame\": {\"x\":246,\"y\":152,\"w\":28,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":10,\"y\":0,\"w\":28,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"bugbear-dead00.png\",\r\n\t\"frame\": {\"x\":566,\"y\":196,\"w\":48,\"h\":38},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":8,\"w\":48,\"h\":38},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"bugbear-idle00.png\",\r\n\t\"frame\": {\"x\":148,\"y\":392,\"w\":46,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":46,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"bugbear-idle01.png\",\r\n\t\"frame\": {\"x\":791,\"y\":51,\"w\":47,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":2,\"w\":47,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"bull00.png\",\r\n\t\"frame\": {\"x\":147,\"y\":150,\"w\":48,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cantrip.png\",\r\n\t\"frame\": {\"x\":430,\"y\":350,\"w\":44,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":44,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"chain_mail_armour.png\",\r\n\t\"frame\": {\"x\":476,\"y\":449,\"w\":42,\"h\":43},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":42,\"h\":43},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-dead00.png\",\r\n\t\"frame\": {\"x\":697,\"y\":393,\"w\":47,\"h\":31},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":12,\"w\":47,\"h\":31},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-idle00.png\",\r\n\t\"frame\": {\"x\":840,\"y\":51,\"w\":47,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":2,\"w\":47,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-idle01.png\",\r\n\t\"frame\": {\"x\":51,\"y\":393,\"w\":47,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":47,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-e00.png\",\r\n\t\"frame\": {\"x\":902,\"y\":196,\"w\":42,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":42,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-e01.png\",\r\n\t\"frame\": {\"x\":889,\"y\":51,\"w\":47,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":2,\"w\":47,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-e02.png\",\r\n\t\"frame\": {\"x\":859,\"y\":195,\"w\":41,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":3,\"w\":41,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-e03.png\",\r\n\t\"frame\": {\"x\":870,\"y\":458,\"w\":38,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":4,\"w\":38,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-n00.png\",\r\n\t\"frame\": {\"x\":382,\"y\":251,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-n01.png\",\r\n\t\"frame\": {\"x\":51,\"y\":443,\"w\":47,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":47,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-n02.png\",\r\n\t\"frame\": {\"x\":289,\"y\":301,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-n03.png\",\r\n\t\"frame\": {\"x\":383,\"y\":299,\"w\":45,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":45,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-s00.png\",\r\n\t\"frame\": {\"x\":383,\"y\":348,\"w\":45,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":45,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-s01.png\",\r\n\t\"frame\": {\"x\":1137,\"y\":51,\"w\":47,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":47,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-s02.png\",\r\n\t\"frame\": {\"x\":336,\"y\":399,\"w\":45,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":45,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-s03.png\",\r\n\t\"frame\": {\"x\":403,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-w00.png\",\r\n\t\"frame\": {\"x\":1009,\"y\":420,\"w\":40,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":40,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-w01.png\",\r\n\t\"frame\": {\"x\":246,\"y\":405,\"w\":43,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":43,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-w02.png\",\r\n\t\"frame\": {\"x\":1051,\"y\":420,\"w\":40,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":40,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"cleric1-walk-w03.png\",\r\n\t\"frame\": {\"x\":1268,\"y\":144,\"w\":38,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":4,\"w\":38,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"club.png\",\r\n\t\"frame\": {\"x\":252,\"y\":1,\"w\":49,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":49,\"h\":48},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"coins.png\",\r\n\t\"frame\": {\"x\":99,\"y\":1,\"w\":49,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":49,\"h\":49},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"copper_coins.png\",\r\n\t\"frame\": {\"x\":1041,\"y\":194,\"w\":45,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":4,\"w\":45,\"h\":44},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"copper_dragon_wyrmling-dead00.png\",\r\n\t\"frame\": {\"x\":802,\"y\":243,\"w\":48,\"h\":37},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":6,\"w\":48,\"h\":37},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"copper_dragon_wyrmling-idle00.png\",\r\n\t\"frame\": {\"x\":1186,\"y\":51,\"w\":48,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":48,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"copper_dragon_wyrmling-idle01.png\",\r\n\t\"frame\": {\"x\":1236,\"y\":51,\"w\":48,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":48,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"dagger.png\",\r\n\t\"frame\": {\"x\":951,\"y\":293,\"w\":40,\"h\":35},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":8,\"w\":40,\"h\":35},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"diamond.png\",\r\n\t\"frame\": {\"x\":432,\"y\":445,\"w\":42,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":1,\"w\":42,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"door-B.png\",\r\n\t\"frame\": {\"x\":453,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"door-L.png\",\r\n\t\"frame\": {\"x\":928,\"y\":243,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":15,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"door-R.png\",\r\n\t\"frame\": {\"x\":963,\"y\":242,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"door-T.png\",\r\n\t\"frame\": {\"x\":503,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"door2-B.png\",\r\n\t\"frame\": {\"x\":553,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"door2-T.png\",\r\n\t\"frame\": {\"x\":603,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"dretch-dead00.png\",\r\n\t\"frame\": {\"x\":938,\"y\":51,\"w\":48,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"dretch-idle00.png\",\r\n\t\"frame\": {\"x\":653,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"dretch-idle01.png\",\r\n\t\"frame\": {\"x\":703,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"enchanted_battleaxe.png\",\r\n\t\"frame\": {\"x\":1,\"y\":343,\"w\":49,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":49,\"h\":48},\r\n\t\"sourceSize\": {\"w\":49,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"enchanted_greataxe.png\",\r\n\t\"frame\": {\"x\":753,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"enchanted_greatsword.png\",\r\n\t\"frame\": {\"x\":1,\"y\":393,\"w\":48,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"enchanted_handaxe.png\",\r\n\t\"frame\": {\"x\":803,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"enchanted_shortsword.png\",\r\n\t\"frame\": {\"x\":1,\"y\":191,\"w\":49,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":49,\"h\":49},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"engraved_pillar-idle00.png\",\r\n\t\"frame\": {\"x\":1184,\"y\":98,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":10,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"failed-spell.png\",\r\n\t\"frame\": {\"x\":921,\"y\":420,\"w\":42,\"h\":42},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":3,\"w\":42,\"h\":42},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fetid_water-idle00.png\",\r\n\t\"frame\": {\"x\":853,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-dead00.png\",\r\n\t\"frame\": {\"x\":791,\"y\":423,\"w\":46,\"h\":29},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":12,\"w\":46,\"h\":29},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-idle00.png\",\r\n\t\"frame\": {\"x\":1187,\"y\":244,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-idle01.png\",\r\n\t\"frame\": {\"x\":1268,\"y\":237,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-e00.png\",\r\n\t\"frame\": {\"x\":1434,\"y\":328,\"w\":30,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":3,\"w\":30,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-e01.png\",\r\n\t\"frame\": {\"x\":1352,\"y\":284,\"w\":35,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":4,\"w\":35,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-e02.png\",\r\n\t\"frame\": {\"x\":1128,\"y\":420,\"w\":29,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":3,\"w\":29,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-e03.png\",\r\n\t\"frame\": {\"x\":1373,\"y\":408,\"w\":28,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":4,\"w\":28,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-n00.png\",\r\n\t\"frame\": {\"x\":1149,\"y\":370,\"w\":35,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":35,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-n01.png\",\r\n\t\"frame\": {\"x\":825,\"y\":327,\"w\":41,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":4,\"w\":41,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-n02.png\",\r\n\t\"frame\": {\"x\":1159,\"y\":417,\"w\":35,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":35,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-n03.png\",\r\n\t\"frame\": {\"x\":1308,\"y\":247,\"w\":37,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":4,\"w\":37,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-s00.png\",\r\n\t\"frame\": {\"x\":1346,\"y\":96,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-s01.png\",\r\n\t\"frame\": {\"x\":1506,\"y\":192,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-s02.png\",\r\n\t\"frame\": {\"x\":1346,\"y\":143,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-s03.png\",\r\n\t\"frame\": {\"x\":1347,\"y\":237,\"w\":37,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":3,\"w\":37,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-w00.png\",\r\n\t\"frame\": {\"x\":1202,\"y\":321,\"w\":29,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":3,\"w\":29,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-w01.png\",\r\n\t\"frame\": {\"x\":1271,\"y\":327,\"w\":35,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":4,\"w\":35,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-w02.png\",\r\n\t\"frame\": {\"x\":1196,\"y\":415,\"w\":29,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":3,\"w\":29,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fighter1-walk-w03.png\",\r\n\t\"frame\": {\"x\":1494,\"y\":411,\"w\":28,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":4,\"w\":28,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fire00.png\",\r\n\t\"frame\": {\"x\":903,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fire01.png\",\r\n\t\"frame\": {\"x\":1,\"y\":444,\"w\":48,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"fire_beetle_pv-dead00.png\",\r\n\t\"frame\": {\"x\":707,\"y\":283,\"w\":47,\"h\":38},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":5,\"w\":47,\"h\":38},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fire_beetle_pv-idle00.png\",\r\n\t\"frame\": {\"x\":953,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fire_beetle_pv-idle01.png\",\r\n\t\"frame\": {\"x\":1003,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"flail.png\",\r\n\t\"frame\": {\"x\":99,\"y\":52,\"w\":49,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":4,\"w\":49,\"h\":45},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"floor-SBE.png\",\r\n\t\"frame\": {\"x\":1053,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"floor-SBW.png\",\r\n\t\"frame\": {\"x\":1103,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"floor.png\",\r\n\t\"frame\": {\"x\":1153,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"floor2-SBE.png\",\r\n\t\"frame\": {\"x\":1203,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"floor2-SBW.png\",\r\n\t\"frame\": {\"x\":1253,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"floor2.png\",\r\n\t\"frame\": {\"x\":1303,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fungal_film-idle00.png\",\r\n\t\"frame\": {\"x\":1353,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fungal_film-idle01.png\",\r\n\t\"frame\": {\"x\":1403,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"fungus.png\",\r\n\t\"frame\": {\"x\":746,\"y\":393,\"w\":43,\"h\":31},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":9,\"w\":43,\"h\":31},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"gargoyle-dead00.png\",\r\n\t\"frame\": {\"x\":852,\"y\":293,\"w\":48,\"h\":32},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":9,\"w\":48,\"h\":32},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"gargoyle-idle00.png\",\r\n\t\"frame\": {\"x\":1386,\"y\":51,\"w\":48,\"h\":42},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":6,\"w\":48,\"h\":42},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"gargoyle-idle01.png\",\r\n\t\"frame\": {\"x\":1436,\"y\":51,\"w\":48,\"h\":42},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":6,\"w\":48,\"h\":42},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"gas00.png\",\r\n\t\"frame\": {\"x\":1453,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ghoul-dead00.png\",\r\n\t\"frame\": {\"x\":1545,\"y\":162,\"w\":43,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":11,\"w\":43,\"h\":30},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ghoul-idle00.png\",\r\n\t\"frame\": {\"x\":1469,\"y\":98,\"w\":37,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":3,\"w\":37,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ghoul-idle01.png\",\r\n\t\"frame\": {\"x\":1346,\"y\":190,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"giant_wasp_pv-dead00.png\",\r\n\t\"frame\": {\"x\":148,\"y\":442,\"w\":47,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":47,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"giant_wasp_pv-idle00.png\",\r\n\t\"frame\": {\"x\":197,\"y\":442,\"w\":47,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":47,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"giant_wasp_pv-idle01.png\",\r\n\t\"frame\": {\"x\":1503,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"goblin-dead00.png\",\r\n\t\"frame\": {\"x\":1227,\"y\":284,\"w\":43,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":12,\"w\":43,\"h\":30},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"goblin-idle00.png\",\r\n\t\"frame\": {\"x\":654,\"y\":322,\"w\":43,\"h\":42},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":6,\"w\":43,\"h\":42},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"goblin-idle01.png\",\r\n\t\"frame\": {\"x\":763,\"y\":195,\"w\":46,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":46,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"gold_coins.png\",\r\n\t\"frame\": {\"x\":150,\"y\":1,\"w\":49,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":49,\"h\":49},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"gold_portal-dead00.png\",\r\n\t\"frame\": {\"x\":428,\"y\":397,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"gold_portal-idle00.png\",\r\n\t\"frame\": {\"x\":993,\"y\":292,\"w\":31,\"h\":36},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":12,\"y\":8,\"w\":31,\"h\":36},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"greataxe.png\",\r\n\t\"frame\": {\"x\":425,\"y\":201,\"w\":46,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":1,\"w\":46,\"h\":48},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"greatsword.png\",\r\n\t\"frame\": {\"x\":97,\"y\":99,\"w\":47,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":47,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"green_flask.png\",\r\n\t\"frame\": {\"x\":246,\"y\":203,\"w\":28,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":10,\"y\":0,\"w\":28,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"half_plate_armour.png\",\r\n\t\"frame\": {\"x\":616,\"y\":196,\"w\":48,\"h\":39},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":5,\"w\":48,\"h\":39},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"handaxe.png\",\r\n\t\"frame\": {\"x\":52,\"y\":242,\"w\":42,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":0,\"w\":42,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"helmet.png\",\r\n\t\"frame\": {\"x\":1467,\"y\":145,\"w\":37,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":1,\"w\":37,\"h\":45},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"helmet_of_ogre_power.png\",\r\n\t\"frame\": {\"x\":1553,\"y\":1,\"w\":40,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":0,\"w\":40,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"hidden_artefact-dead00.png\",\r\n\t\"frame\": {\"x\":744,\"y\":426,\"w\":32,\"h\":32},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":5,\"w\":32,\"h\":32},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hidden_artefact-idle00.png\",\r\n\t\"frame\": {\"x\":1524,\"y\":427,\"w\":28,\"h\":27},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":5,\"w\":28,\"h\":27},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-arrow-down00.png\",\r\n\t\"frame\": {\"x\":565,\"y\":100,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-arrow-down01.png\",\r\n\t\"frame\": {\"x\":613,\"y\":100,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-arrow-left00.png\",\r\n\t\"frame\": {\"x\":566,\"y\":148,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-arrow-left01.png\",\r\n\t\"frame\": {\"x\":614,\"y\":148,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-arrow-right00.png\",\r\n\t\"frame\": {\"x\":661,\"y\":100,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-arrow-right01.png\",\r\n\t\"frame\": {\"x\":709,\"y\":99,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-arrow-up00.png\",\r\n\t\"frame\": {\"x\":757,\"y\":99,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-arrow-up01.png\",\r\n\t\"frame\": {\"x\":805,\"y\":99,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-auto-centre00.png\",\r\n\t\"frame\": {\"x\":853,\"y\":99,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-auto-centre01.png\",\r\n\t\"frame\": {\"x\":662,\"y\":148,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-fullscreen00.png\",\r\n\t\"frame\": {\"x\":146,\"y\":100,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hud-fullscreen01.png\",\r\n\t\"frame\": {\"x\":710,\"y\":147,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"hunting_trap.png\",\r\n\t\"frame\": {\"x\":999,\"y\":467,\"w\":46,\"h\":28},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":11,\"w\":46,\"h\":28},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ice00.png\",\r\n\t\"frame\": {\"x\":658,\"y\":240,\"w\":42,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":3,\"w\":42,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"iron_rations.png\",\r\n\t\"frame\": {\"x\":696,\"y\":426,\"w\":46,\"h\":32},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":10,\"w\":46,\"h\":32},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"kobold-dead00.png\",\r\n\t\"frame\": {\"x\":1076,\"y\":336,\"w\":42,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":12,\"w\":42,\"h\":30},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"kobold-idle00.png\",\r\n\t\"frame\": {\"x\":1272,\"y\":284,\"w\":34,\"h\":41},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":7,\"w\":34,\"h\":41},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"kobold-idle01.png\",\r\n\t\"frame\": {\"x\":1082,\"y\":375,\"w\":35,\"h\":43},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":5,\"w\":35,\"h\":43},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"leather_armour.png\",\r\n\t\"frame\": {\"x\":752,\"y\":242,\"w\":48,\"h\":38},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":5,\"w\":48,\"h\":38},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"lichen.png\",\r\n\t\"frame\": {\"x\":562,\"y\":236,\"w\":44,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":3,\"w\":44,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"lightning00.png\",\r\n\t\"frame\": {\"x\":376,\"y\":201,\"w\":47,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":47,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"lock_pick.png\",\r\n\t\"frame\": {\"x\":901,\"y\":99,\"w\":41,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":1,\"w\":41,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"lute.png\",\r\n\t\"frame\": {\"x\":949,\"y\":330,\"w\":40,\"h\":38},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":6,\"w\":40,\"h\":38},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"magic00.png\",\r\n\t\"frame\": {\"x\":965,\"y\":420,\"w\":42,\"h\":42},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":42,\"h\":42},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"manhole_cover-dead00.png\",\r\n\t\"frame\": {\"x\":887,\"y\":423,\"w\":32,\"h\":33},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":6,\"w\":32,\"h\":33},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"manhole_cover-idle00.png\",\r\n\t\"frame\": {\"x\":1166,\"y\":464,\"w\":30,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":9,\"w\":30,\"h\":30},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"meat.png\",\r\n\t\"frame\": {\"x\":1035,\"y\":328,\"w\":39,\"h\":40},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":6,\"w\":39,\"h\":40},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"miss.png\",\r\n\t\"frame\": {\"x\":562,\"y\":282,\"w\":44,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":44,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ogre-dead00.png\",\r\n\t\"frame\": {\"x\":756,\"y\":282,\"w\":48,\"h\":37},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":7,\"w\":48,\"h\":37},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ogre-idle00.png\",\r\n\t\"frame\": {\"x\":430,\"y\":251,\"w\":44,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":44,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ogre-idle01.png\",\r\n\t\"frame\": {\"x\":291,\"y\":398,\"w\":43,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":43,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"orc-dead00.png\",\r\n\t\"frame\": {\"x\":699,\"y\":323,\"w\":48,\"h\":36},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":8,\"w\":48,\"h\":36},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"orc-idle00.png\",\r\n\t\"frame\": {\"x\":383,\"y\":396,\"w\":43,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":43,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"orc-idle01.png\",\r\n\t\"frame\": {\"x\":387,\"y\":446,\"w\":43,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":43,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"orc-walk-w00.png\",\r\n\t\"frame\": {\"x\":524,\"y\":151,\"w\":40,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":40,\"h\":48},\r\n\t\"sourceSize\": {\"w\":49,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"orc_skull.png\",\r\n\t\"frame\": {\"x\":246,\"y\":254,\"w\":40,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":0,\"w\":40,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"padded_armour.png\",\r\n\t\"frame\": {\"x\":1286,\"y\":51,\"w\":48,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":48,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"plate_armour.png\",\r\n\t\"frame\": {\"x\":96,\"y\":192,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"platinum_coins.png\",\r\n\t\"frame\": {\"x\":1,\"y\":242,\"w\":49,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":49,\"h\":49},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"poisoners_kit.png\",\r\n\t\"frame\": {\"x\":806,\"y\":282,\"w\":44,\"h\":39},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":5,\"w\":44,\"h\":39},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"poleaxe.png\",\r\n\t\"frame\": {\"x\":201,\"y\":1,\"w\":49,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":49,\"h\":49},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"potion_of_healing.png\",\r\n\t\"frame\": {\"x\":246,\"y\":455,\"w\":29,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":10,\"y\":0,\"w\":29,\"h\":49},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"purple_plant.png\",\r\n\t\"frame\": {\"x\":702,\"y\":242,\"w\":48,\"h\":39},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":7,\"w\":48,\"h\":39},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"quarterstaff.png\",\r\n\t\"frame\": {\"x\":288,\"y\":251,\"w\":45,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":1,\"w\":45,\"h\":48},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"quartz.png\",\r\n\t\"frame\": {\"x\":902,\"y\":147,\"w\":42,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":1,\"w\":42,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-dead00.png\",\r\n\t\"frame\": {\"x\":839,\"y\":423,\"w\":46,\"h\":33},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":12,\"w\":46,\"h\":33},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-idle00.png\",\r\n\t\"frame\": {\"x\":1224,\"y\":368,\"w\":33,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":33,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-idle01.png\",\r\n\t\"frame\": {\"x\":1506,\"y\":239,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-e00.png\",\r\n\t\"frame\": {\"x\":1427,\"y\":141,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-e01.png\",\r\n\t\"frame\": {\"x\":1428,\"y\":95,\"w\":39,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":4,\"w\":39,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-e02.png\",\r\n\t\"frame\": {\"x\":1427,\"y\":188,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-e03.png\",\r\n\t\"frame\": {\"x\":1544,\"y\":241,\"w\":36,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":4,\"w\":36,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-n00.png\",\r\n\t\"frame\": {\"x\":1308,\"y\":329,\"w\":35,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":3,\"w\":35,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-n01.png\",\r\n\t\"frame\": {\"x\":1345,\"y\":330,\"w\":35,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":4,\"w\":35,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-n02.png\",\r\n\t\"frame\": {\"x\":1227,\"y\":415,\"w\":33,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":3,\"w\":33,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-n03.png\",\r\n\t\"frame\": {\"x\":1544,\"y\":287,\"w\":36,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":4,\"w\":36,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-s00.png\",\r\n\t\"frame\": {\"x\":1544,\"y\":194,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-s01.png\",\r\n\t\"frame\": {\"x\":1466,\"y\":332,\"w\":36,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":4,\"w\":36,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-s02.png\",\r\n\t\"frame\": {\"x\":1389,\"y\":281,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-s03.png\",\r\n\t\"frame\": {\"x\":1504,\"y\":332,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-w00.png\",\r\n\t\"frame\": {\"x\":1467,\"y\":192,\"w\":37,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":37,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-w01.png\",\r\n\t\"frame\": {\"x\":1226,\"y\":144,\"w\":40,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":4,\"w\":40,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-w02.png\",\r\n\t\"frame\": {\"x\":1467,\"y\":239,\"w\":37,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":37,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ranger1-walk-w03.png\",\r\n\t\"frame\": {\"x\":1508,\"y\":99,\"w\":37,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":4,\"w\":37,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat-dead00.png\",\r\n\t\"frame\": {\"x\":1026,\"y\":291,\"w\":45,\"h\":35},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":13,\"w\":45,\"h\":35},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat-idle00.png\",\r\n\t\"frame\": {\"x\":1137,\"y\":194,\"w\":48,\"h\":40},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":7,\"w\":48,\"h\":40},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat-idle01.png\",\r\n\t\"frame\": {\"x\":608,\"y\":237,\"w\":48,\"h\":40},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":6,\"w\":48,\"h\":40},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat-walk-e00.png\",\r\n\t\"frame\": {\"x\":146,\"y\":349,\"w\":48,\"h\":41},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":5,\"w\":48,\"h\":41},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat-walk-n00.png\",\r\n\t\"frame\": {\"x\":910,\"y\":464,\"w\":39,\"h\":40},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":6,\"w\":39,\"h\":40},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat-walk-s00.png\",\r\n\t\"frame\": {\"x\":654,\"y\":460,\"w\":42,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":42,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat-walk-w00.png\",\r\n\t\"frame\": {\"x\":196,\"y\":399,\"w\":48,\"h\":41},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":5,\"w\":48,\"h\":41},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat.png\",\r\n\t\"frame\": {\"x\":608,\"y\":279,\"w\":48,\"h\":40},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":7,\"w\":48,\"h\":40},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat_pv-dead00.png\",\r\n\t\"frame\": {\"x\":1308,\"y\":293,\"w\":42,\"h\":34},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":13,\"w\":42,\"h\":34},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat_pv-idle00.png\",\r\n\t\"frame\": {\"x\":476,\"y\":351,\"w\":41,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":41,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rat_pv-idle01.png\",\r\n\t\"frame\": {\"x\":476,\"y\":400,\"w\":42,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":42,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"red_flask.png\",\r\n\t\"frame\": {\"x\":277,\"y\":455,\"w\":28,\"h\":49},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":10,\"y\":0,\"w\":28,\"h\":49},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"restorative_ointment.png\",\r\n\t\"frame\": {\"x\":1093,\"y\":469,\"w\":39,\"h\":35},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":7,\"w\":39,\"h\":35},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ring_mail_armour.png\",\r\n\t\"frame\": {\"x\":826,\"y\":458,\"w\":42,\"h\":43},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":42,\"h\":43},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ring_of_charisma.png\",\r\n\t\"frame\": {\"x\":1198,\"y\":462,\"w\":40,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":10,\"w\":40,\"h\":30},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ring_of_constitution.png\",\r\n\t\"frame\": {\"x\":1259,\"y\":373,\"w\":40,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":10,\"w\":40,\"h\":30},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ring_of_dexterity.png\",\r\n\t\"frame\": {\"x\":1301,\"y\":376,\"w\":40,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":10,\"w\":40,\"h\":30},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ring_of_intelligence.png\",\r\n\t\"frame\": {\"x\":1343,\"y\":376,\"w\":40,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":10,\"w\":40,\"h\":30},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ring_of_strength.png\",\r\n\t\"frame\": {\"x\":1240,\"y\":462,\"w\":40,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":10,\"w\":40,\"h\":30},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"ring_of_wisdom.png\",\r\n\t\"frame\": {\"x\":1459,\"y\":378,\"w\":40,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":10,\"w\":40,\"h\":30},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"RIP.png\",\r\n\t\"frame\": {\"x\":150,\"y\":52,\"w\":48,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":2,\"w\":48,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-dead00.png\",\r\n\t\"frame\": {\"x\":951,\"y\":464,\"w\":46,\"h\":31},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":12,\"w\":46,\"h\":31},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-idle00.png\",\r\n\t\"frame\": {\"x\":1403,\"y\":403,\"w\":33,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":33,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-idle01.png\",\r\n\t\"frame\": {\"x\":1542,\"y\":333,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-e00.png\",\r\n\t\"frame\": {\"x\":1354,\"y\":454,\"w\":33,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":33,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-e01.png\",\r\n\t\"frame\": {\"x\":1282,\"y\":454,\"w\":34,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":4,\"w\":34,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-e02.png\",\r\n\t\"frame\": {\"x\":1389,\"y\":454,\"w\":33,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":33,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-e03.png\",\r\n\t\"frame\": {\"x\":868,\"y\":327,\"w\":31,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":4,\"w\":31,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-n00.png\",\r\n\t\"frame\": {\"x\":1262,\"y\":405,\"w\":35,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":3,\"w\":35,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-n01.png\",\r\n\t\"frame\": {\"x\":1299,\"y\":408,\"w\":35,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":4,\"w\":35,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-n02.png\",\r\n\t\"frame\": {\"x\":1424,\"y\":450,\"w\":33,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":3,\"w\":33,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-n03.png\",\r\n\t\"frame\": {\"x\":1336,\"y\":408,\"w\":35,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":4,\"w\":35,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-s00.png\",\r\n\t\"frame\": {\"x\":1109,\"y\":287,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-s01.png\",\r\n\t\"frame\": {\"x\":1385,\"y\":357,\"w\":35,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":4,\"w\":35,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-s02.png\",\r\n\t\"frame\": {\"x\":1164,\"y\":321,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-s03.png\",\r\n\t\"frame\": {\"x\":1186,\"y\":368,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-w00.png\",\r\n\t\"frame\": {\"x\":1537,\"y\":380,\"w\":33,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":33,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-w01.png\",\r\n\t\"frame\": {\"x\":1318,\"y\":454,\"w\":34,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":4,\"w\":34,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-w02.png\",\r\n\t\"frame\": {\"x\":1459,\"y\":442,\"w\":33,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":33,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rogue1-walk-w03.png\",\r\n\t\"frame\": {\"x\":1076,\"y\":290,\"w\":31,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":4,\"w\":31,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"rusty_key.png\",\r\n\t\"frame\": {\"x\":1093,\"y\":420,\"w\":33,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":2,\"w\":33,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"scale_mail_armour.png\",\r\n\t\"frame\": {\"x\":608,\"y\":321,\"w\":44,\"h\":43},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":3,\"w\":44,\"h\":43},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"shadow-dead00.png\",\r\n\t\"frame\": {\"x\":1120,\"y\":334,\"w\":42,\"h\":34},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":9,\"w\":42,\"h\":34},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"shadow-idle00.png\",\r\n\t\"frame\": {\"x\":96,\"y\":242,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"shadow-idle01.png\",\r\n\t\"frame\": {\"x\":146,\"y\":199,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"shield.png\",\r\n\t\"frame\": {\"x\":994,\"y\":194,\"w\":45,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":3,\"w\":45,\"h\":45},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"shortsword.png\",\r\n\t\"frame\": {\"x\":758,\"y\":147,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"silver_coins.png\",\r\n\t\"frame\": {\"x\":290,\"y\":349,\"w\":45,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":2,\"w\":45,\"h\":47},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"skeleton-dead00.png\",\r\n\t\"frame\": {\"x\":1047,\"y\":467,\"w\":44,\"h\":28},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":13,\"w\":44,\"h\":28},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"skeleton-idle00.png\",\r\n\t\"frame\": {\"x\":1427,\"y\":282,\"w\":37,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":4,\"w\":37,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"skeleton-idle01.png\",\r\n\t\"frame\": {\"x\":1186,\"y\":145,\"w\":38,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":1,\"w\":38,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"skull.png\",\r\n\t\"frame\": {\"x\":475,\"y\":151,\"w\":47,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":47,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"slime-idle00.png\",\r\n\t\"frame\": {\"x\":146,\"y\":249,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"slime-idle01.png\",\r\n\t\"frame\": {\"x\":146,\"y\":299,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"spell.png\",\r\n\t\"frame\": {\"x\":518,\"y\":249,\"w\":42,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":1,\"w\":42,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"spider_pv-dead00.png\",\r\n\t\"frame\": {\"x\":901,\"y\":330,\"w\":46,\"h\":38},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":5,\"w\":46,\"h\":38},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"spider_pv-idle00.png\",\r\n\t\"frame\": {\"x\":1494,\"y\":457,\"w\":32,\"h\":28},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":10,\"w\":32,\"h\":28},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"spider_pv-idle01.png\",\r\n\t\"frame\": {\"x\":1438,\"y\":410,\"w\":32,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":8,\"y\":10,\"w\":32,\"h\":30},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"stirge-dead00.png\",\r\n\t\"frame\": {\"x\":1389,\"y\":328,\"w\":43,\"h\":27},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":11,\"w\":43,\"h\":27},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"stirge-idle00.png\",\r\n\t\"frame\": {\"x\":1147,\"y\":286,\"w\":38,\"h\":28},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":10,\"w\":38,\"h\":28},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"stirge-idle01.png\",\r\n\t\"frame\": {\"x\":1187,\"y\":291,\"w\":38,\"h\":28},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":10,\"w\":38,\"h\":28},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"studded_leather_armour.png\",\r\n\t\"frame\": {\"x\":1336,\"y\":51,\"w\":48,\"h\":43},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":48,\"h\":43},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"tiger_eye.png\",\r\n\t\"frame\": {\"x\":593,\"y\":51,\"w\":47,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":47,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"trader1-dead00.png\",\r\n\t\"frame\": {\"x\":196,\"y\":199,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"trader1-idle00.png\",\r\n\t\"frame\": {\"x\":1486,\"y\":51,\"w\":47,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":3,\"w\":47,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"trader1-idle01.png\",\r\n\t\"frame\": {\"x\":426,\"y\":151,\"w\":47,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":47,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"trader2-dead00.png\",\r\n\t\"frame\": {\"x\":196,\"y\":249,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"trader2-idle00.png\",\r\n\t\"frame\": {\"x\":1535,\"y\":52,\"w\":47,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":3,\"w\":47,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"trader2-idle01.png\",\r\n\t\"frame\": {\"x\":476,\"y\":101,\"w\":47,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":47,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"trapdoor-dead00.png\",\r\n\t\"frame\": {\"x\":1501,\"y\":379,\"w\":34,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":9,\"w\":34,\"h\":30},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"trapdoor-idle00.png\",\r\n\t\"frame\": {\"x\":1134,\"y\":467,\"w\":30,\"h\":36},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":9,\"y\":9,\"w\":30,\"h\":36},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-checkbox00.png\",\r\n\t\"frame\": {\"x\":806,\"y\":147,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-checkbox01.png\",\r\n\t\"frame\": {\"x\":854,\"y\":147,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-guides00.png\",\r\n\t\"frame\": {\"x\":944,\"y\":98,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-guides01.png\",\r\n\t\"frame\": {\"x\":992,\"y\":98,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-hall-of-fame00.png\",\r\n\t\"frame\": {\"x\":1040,\"y\":98,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-hall-of-fame01.png\",\r\n\t\"frame\": {\"x\":1088,\"y\":98,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-play00.png\",\r\n\t\"frame\": {\"x\":1136,\"y\":98,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-play01.png\",\r\n\t\"frame\": {\"x\":946,\"y\":146,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-settings00.png\",\r\n\t\"frame\": {\"x\":994,\"y\":146,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-settings01.png\",\r\n\t\"frame\": {\"x\":1042,\"y\":146,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-spinner-down00.png\",\r\n\t\"frame\": {\"x\":1090,\"y\":146,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-spinner-down01.png\",\r\n\t\"frame\": {\"x\":1138,\"y\":146,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-spinner-left00.png\",\r\n\t\"frame\": {\"x\":513,\"y\":201,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-spinner-left01.png\",\r\n\t\"frame\": {\"x\":519,\"y\":347,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-spinner-right00.png\",\r\n\t\"frame\": {\"x\":520,\"y\":395,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-spinner-right01.png\",\r\n\t\"frame\": {\"x\":520,\"y\":443,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-spinner-up00.png\",\r\n\t\"frame\": {\"x\":811,\"y\":195,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"ui-spinner-up01.png\",\r\n\t\"frame\": {\"x\":946,\"y\":194,\"w\":46,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":1,\"w\":46,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"undead00.png\",\r\n\t\"frame\": {\"x\":196,\"y\":299,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"undefined.png\",\r\n\t\"frame\": {\"x\":1119,\"y\":375,\"w\":28,\"h\":43},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":11,\"y\":3,\"w\":28,\"h\":43},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"vegetation-dead00.png\",\r\n\t\"frame\": {\"x\":432,\"y\":494,\"w\":29,\"h\":10},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":10,\"y\":18,\"w\":29,\"h\":10},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"vegetation-idle00.png\",\r\n\t\"frame\": {\"x\":520,\"y\":491,\"w\":29,\"h\":13},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":10,\"y\":15,\"w\":29,\"h\":13},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"violet_fungus-dead00.png\",\r\n\t\"frame\": {\"x\":991,\"y\":330,\"w\":42,\"h\":38},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":3,\"w\":42,\"h\":38},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"violet_fungus-idle00.png\",\r\n\t\"frame\": {\"x\":988,\"y\":51,\"w\":48,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":48,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"violet_fungus-idle01.png\",\r\n\t\"frame\": {\"x\":1038,\"y\":51,\"w\":48,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":1,\"w\":48,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-B.png\",\r\n\t\"frame\": {\"x\":196,\"y\":349,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-BL.png\",\r\n\t\"frame\": {\"x\":749,\"y\":323,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":15,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-BLI.png\",\r\n\t\"frame\": {\"x\":294,\"y\":51,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-BR.png\",\r\n\t\"frame\": {\"x\":791,\"y\":373,\"w\":34,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":34,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-BRI.png\",\r\n\t\"frame\": {\"x\":276,\"y\":101,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-BTEE.png\",\r\n\t\"frame\": {\"x\":344,\"y\":51,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-HI.png\",\r\n\t\"frame\": {\"x\":276,\"y\":151,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-L.png\",\r\n\t\"frame\": {\"x\":867,\"y\":373,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":15,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-LTEE.png\",\r\n\t\"frame\": {\"x\":942,\"y\":370,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":15,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-R.png\",\r\n\t\"frame\": {\"x\":977,\"y\":370,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-RTEE.png\",\r\n\t\"frame\": {\"x\":1012,\"y\":370,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-T.png\",\r\n\t\"frame\": {\"x\":326,\"y\":101,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-TL.png\",\r\n\t\"frame\": {\"x\":1039,\"y\":241,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":15,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-TLI.png\",\r\n\t\"frame\": {\"x\":394,\"y\":51,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-TR.png\",\r\n\t\"frame\": {\"x\":1047,\"y\":370,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-TRI.png\",\r\n\t\"frame\": {\"x\":276,\"y\":201,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-TTEE.png\",\r\n\t\"frame\": {\"x\":326,\"y\":151,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-VI.png\",\r\n\t\"frame\": {\"x\":376,\"y\":101,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall-XI.png\",\r\n\t\"frame\": {\"x\":444,\"y\":51,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall2-B.png\",\r\n\t\"frame\": {\"x\":326,\"y\":201,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall2-HI.png\",\r\n\t\"frame\": {\"x\":376,\"y\":151,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wall2-T.png\",\r\n\t\"frame\": {\"x\":426,\"y\":101,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warhammer.png\",\r\n\t\"frame\": {\"x\":642,\"y\":51,\"w\":47,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":2,\"w\":47,\"h\":47},\r\n\t\"sourceSize\": {\"w\":49,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-dead00.png\",\r\n\t\"frame\": {\"x\":1547,\"y\":129,\"w\":44,\"h\":31},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":12,\"w\":44,\"h\":31},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-idle00.png\",\r\n\t\"frame\": {\"x\":1226,\"y\":190,\"w\":39,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":39,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-idle01.png\",\r\n\t\"frame\": {\"x\":609,\"y\":366,\"w\":42,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":42,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-e00.png\",\r\n\t\"frame\": {\"x\":1267,\"y\":190,\"w\":39,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":39,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-e01.png\",\r\n\t\"frame\": {\"x\":698,\"y\":460,\"w\":42,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":4,\"w\":42,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-e02.png\",\r\n\t\"frame\": {\"x\":1227,\"y\":237,\"w\":39,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":39,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-e03.png\",\r\n\t\"frame\": {\"x\":1466,\"y\":286,\"w\":37,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":4,\"w\":37,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-n00.png\",\r\n\t\"frame\": {\"x\":609,\"y\":413,\"w\":42,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":42,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-n01.png\",\r\n\t\"frame\": {\"x\":609,\"y\":460,\"w\":43,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":4,\"w\":43,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-n02.png\",\r\n\t\"frame\": {\"x\":653,\"y\":366,\"w\":42,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":3,\"w\":42,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-n03.png\",\r\n\t\"frame\": {\"x\":742,\"y\":460,\"w\":42,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":4,\"w\":42,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-s00.png\",\r\n\t\"frame\": {\"x\":1224,\"y\":97,\"w\":40,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":3,\"w\":40,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-s01.png\",\r\n\t\"frame\": {\"x\":1386,\"y\":95,\"w\":40,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":4,\"w\":40,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-s02.png\",\r\n\t\"frame\": {\"x\":1266,\"y\":97,\"w\":40,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":3,\"w\":40,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-s03.png\",\r\n\t\"frame\": {\"x\":653,\"y\":413,\"w\":41,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":41,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-w00.png\",\r\n\t\"frame\": {\"x\":1386,\"y\":141,\"w\":39,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":39,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-w01.png\",\r\n\t\"frame\": {\"x\":1386,\"y\":235,\"w\":39,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":4,\"w\":39,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-w02.png\",\r\n\t\"frame\": {\"x\":1386,\"y\":188,\"w\":39,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":3,\"w\":39,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warlock1-walk-w03.png\",\r\n\t\"frame\": {\"x\":1505,\"y\":286,\"w\":37,\"h\":44},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":4,\"w\":37,\"h\":44},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"warning00.png\",\r\n\t\"frame\": {\"x\":494,\"y\":51,\"w\":48,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": false,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":48,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"waterskin.png\",\r\n\t\"frame\": {\"x\":518,\"y\":298,\"w\":42,\"h\":47},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":2,\"w\":42,\"h\":47},\r\n\t\"sourceSize\": {\"w\":48,\"h\":49}\r\n},\r\n{\r\n\t\"filename\": \"wight-dead00.png\",\r\n\t\"frame\": {\"x\":699,\"y\":361,\"w\":48,\"h\":30},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":16,\"w\":48,\"h\":30},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wight-idle00.png\",\r\n\t\"frame\": {\"x\":1233,\"y\":316,\"w\":36,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":3,\"w\":36,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wight-idle01.png\",\r\n\t\"frame\": {\"x\":1074,\"y\":240,\"w\":33,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":0,\"w\":33,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-dead00.png\",\r\n\t\"frame\": {\"x\":902,\"y\":293,\"w\":47,\"h\":35},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":10,\"w\":47,\"h\":35},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-idle00.png\",\r\n\t\"frame\": {\"x\":476,\"y\":251,\"w\":40,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":0,\"w\":40,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-idle01.png\",\r\n\t\"frame\": {\"x\":567,\"y\":328,\"w\":39,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":0,\"w\":39,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-e00.png\",\r\n\t\"frame\": {\"x\":568,\"y\":378,\"w\":39,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":0,\"w\":39,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-e01.png\",\r\n\t\"frame\": {\"x\":335,\"y\":251,\"w\":45,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":0,\"w\":45,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-e02.png\",\r\n\t\"frame\": {\"x\":568,\"y\":428,\"w\":39,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":2,\"y\":0,\"w\":39,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-e03.png\",\r\n\t\"frame\": {\"x\":1109,\"y\":237,\"w\":36,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":0,\"w\":36,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-n00.png\",\r\n\t\"frame\": {\"x\":887,\"y\":243,\"w\":39,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":0,\"w\":39,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-n01.png\",\r\n\t\"frame\": {\"x\":476,\"y\":301,\"w\":40,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":0,\"w\":40,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-n02.png\",\r\n\t\"frame\": {\"x\":998,\"y\":241,\"w\":39,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":0,\"w\":39,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-n03.png\",\r\n\t\"frame\": {\"x\":1187,\"y\":194,\"w\":37,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":3,\"y\":0,\"w\":37,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-s00.png\",\r\n\t\"frame\": {\"x\":1308,\"y\":97,\"w\":36,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":0,\"w\":36,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-s01.png\",\r\n\t\"frame\": {\"x\":827,\"y\":373,\"w\":38,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":0,\"w\":38,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-s02.png\",\r\n\t\"frame\": {\"x\":1308,\"y\":147,\"w\":36,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":7,\"y\":0,\"w\":36,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-s03.png\",\r\n\t\"frame\": {\"x\":784,\"y\":323,\"w\":39,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":0,\"w\":39,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-w00.png\",\r\n\t\"frame\": {\"x\":902,\"y\":370,\"w\":38,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":0,\"w\":38,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-w01.png\",\r\n\t\"frame\": {\"x\":1147,\"y\":236,\"w\":38,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":0,\"w\":38,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-w02.png\",\r\n\t\"frame\": {\"x\":786,\"y\":454,\"w\":38,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":0,\"w\":38,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wizard1-walk-w03.png\",\r\n\t\"frame\": {\"x\":1308,\"y\":197,\"w\":36,\"h\":48},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":6,\"y\":0,\"w\":36,\"h\":48},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wraith-dead00.png\",\r\n\t\"frame\": {\"x\":714,\"y\":195,\"w\":47,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":0,\"w\":47,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wraith-idle00.png\",\r\n\t\"frame\": {\"x\":691,\"y\":51,\"w\":48,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":2,\"w\":48,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"wraith-idle01.png\",\r\n\t\"frame\": {\"x\":741,\"y\":51,\"w\":48,\"h\":46},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":0,\"y\":2,\"w\":48,\"h\":46},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"zombie-dead00.png\",\r\n\t\"frame\": {\"x\":1547,\"y\":99,\"w\":46,\"h\":28},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":1,\"y\":13,\"w\":46,\"h\":28},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"zombie-idle00.png\",\r\n\t\"frame\": {\"x\":1506,\"y\":145,\"w\":37,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":5,\"y\":3,\"w\":37,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n},\r\n{\r\n\t\"filename\": \"zombie-idle01.png\",\r\n\t\"frame\": {\"x\":1427,\"y\":235,\"w\":38,\"h\":45},\r\n\t\"rotated\": false,\r\n\t\"trimmed\": true,\r\n\t\"spriteSourceSize\": {\"x\":4,\"y\":3,\"w\":38,\"h\":45},\r\n\t\"sourceSize\": {\"w\":48,\"h\":48}\r\n}],\r\n\"meta\": {\r\n\t\"app\": \"https://www.codeandweb.com/texturepacker\",\r\n\t\"version\": \"1.0\",\r\n\t\"image\": \"dungeon.png\",\r\n\t\"format\": \"RGBA8888\",\r\n\t\"size\": {\"w\":1594,\"h\":505},\r\n\t\"scale\": \"1\",\r\n\t\"smartupdate\": \"$TexturePacker:SmartUpdate:306392f56936c372f3f3518ca39917bd:eeab59f6750eb69f8e287201aad70291:9c0fba27a8a0c106083a8713f6c67b32$\"\r\n}\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"about.9d8bcf91.md\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"armour.bfc2be64.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"artefacts.a11b197b.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"magic.33097e30.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"monsters.1161fbe8.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"heroes.57c67ffd.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"money.dc77b2a9.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"traders.1d8d82a4.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"weapons.e6080a43.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"keys.f3b71340.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"traps.57e309f4.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"plants.4dd5938e.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"portals.7bb576d2.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"dungeon-completed.6e49dc4f.md\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"dungeon_script.34f994bb.txt\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"dungeon-welcome.832f01e2.md\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"dungeon-welcome-casual.d4a9c126.md\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"help.87da7d72.md\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"do-alto-do-trono-da-desolacao-trimmed.18cbfbbb.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"privacy.7ffe5882.md\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"startupTips.1c63a486.md\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"quickStart.761d94a5.md\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"punch-trimmed.d5ee82fe.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"punch-trimmed-double.7756f095.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"long-medium-swish-trimmed.69cad07b.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"bubbling-trimmed.361718fa.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"male-hurt-sound-trimmed.76fa38ed.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"pig-oink-47167.4d796935.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"squeal-thing-103111.d7f21093.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"zombie-6851_derived.1619a046.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"metal-blade-slice-32-195321.f9effd4c.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"spell_chant.49e88815.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"door-43633_trimmed_exit.f51c6df4.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"door-43633_trimmed_enter.7b3b8ba7.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"sci-fi-portal-83746-trimmed.d1598f9a.mp3\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"click-and-crawl.10b21974.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('9veYn') + \"dungeon.f859c4d9.png\";","\n/**\n * Automatically created version file. Do not edit!\n */\nexport const VERSION = {\n  build: '1.0.0-beta+seo0ak',\n  date:'2024-06-06',\n  copyright: ' 2024 Steve Butler'\n}\n","/**\n * @file Dialogs for opening an exit.\n *\n * @module dialogs/openExitDialogs\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as dndAction from '../dnd/dndAction.js';\nimport UI from '../utils/dom/ui.js';\nimport { i18n } from '../utils/messageManager.js';\n\n/**\n * Attempt to open an exit.\n * @param {module:players/actors.Actor} actor\n * @param {module:players/artefacts.Artefact} key\n * @returns {Promise<boolean>} fulfils to true if picked.\n */\nexport function showUnpickExitDialog(actor, key) {\n  return UI.showChoiceDialog(\n    i18n`DIALOG TITLE LOCKED`,\n    i18n`MESSAGE EXIT LOCKED`,\n    [i18n`BUTTON TRY TO PICK`, i18n`BUTTON LEAVE IT`]\n  ).then((choice) => (choice === 0 ? tryToPickLock(actor, key) : false));\n}\n\n/**\n * Try to pick a lock\n * @param {module:players/actors.Actor} actor\n * @param {module:players/artefacts.Artefact} key\n * @returns {Promise<boolean>} fulfils to true if picked.\n */\nfunction tryToPickLock(actor, key) {\n  if (!actor.storeManager.hasArtefactWithSameId('lock_pick')) {\n    return UI.showOkDialog(i18n`MESSAGE NEED LOCK PICK`).then(() => false);\n  }\n  if (dndAction.canPickLock(actor.traits, key.traits)) {\n    return UI.showOkDialog(i18n`MESSAGE YOU PICK THE LOCK`).then(() => true);\n  } else {\n    return UI.showOkDialog(i18n`MESSAGE YOU FAIL TO PICK THE LOCK`).then(\n      () => false\n    );\n  }\n}\n","/**\n * @file Dialog with rune puzzle.\n *\n * @module dialogs/runeQuestionDialog\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport UI from '../utils/dom/ui.js';\nimport { createSequence } from '../dnd/sequenceGenerator.js';\nimport * as maths from '../utils/maths.js';\nimport { i18n } from '../utils/messageManager.js';\nimport { createElement } from '../utils/dom/components.js';\n\n/** @type {string} */\nconst RUNES =\n  '\\u{16a0}\\u{16a2}\\u{16a6}\\u{16a8}\\u{16b1}\\u{16b2}\\u{16b7}\\u{16b9}\\u{16ba}\\u{16be}\\u{16c1}\\u{16c3}\\u{16c7}\\u{16c8}\\u{16c9}\\u{16ca}\\u{16cf}\\u{16d2}\\u{16d6}\\u{16d7}\\u{16da}\\u{16dc}\\u{16de}\\u{16df}';\n\n/**\n * Show a rune puzzle. If the incorrect answer turns out to be the same as the\n * correct answer no dialog is shown and the response indicates a correct solution.\n * @param {number} currentSceneLevel\n * @returns {Promise<boolean>} fulfils to true if solved.\n */\nexport function showRunePuzzle(currentSceneLevel) {\n  const options = createSequenceOptions(currentSceneLevel);\n  const sequence = createSequence(options);\n  const correct = sequence.next;\n  const incorrect = createIncorrectSequence(correct, options.runes);\n  if (incorrect === correct) {\n    return Promise.resolve(true); // just assume successful answer.\n  }\n  const container = createElement('div');\n  container.appendChild(\n    createElement('p', {\n      text: i18n`MESSAGE RUNES ON WALL`,\n    })\n  );\n  container.appendChild(\n    createElement('p', {\n      className: 'runes',\n      text: `${options.runes} ${sequence.sequence}`, // include runes as key\n    })\n  );\n  container.appendChild(\n    createElement('p', {\n      text: i18n`MESSAGE RUNES OVER DOORS`,\n    })\n  );\n\n  const goodIndex = maths.getRandomInt(0, 1);\n  const badIndex = 1 - goodIndex;\n  const choices = ['', ''];\n  choices[goodIndex] = correct;\n  choices[badIndex] = incorrect;\n  return UI.showChoiceDialog(\n    i18n`DIALOG TITLE RUNE PUZZLE`,\n    container,\n    choices,\n    'rune-puzzle'\n  ).then((choice) => choice === goodIndex);\n}\n\n/**\n *\n * @param {number} currentSceneLevel\n * @returns {Object} options for createSequence.\n */\nfunction createSequenceOptions(currentSceneLevel) {\n  const minRunes = 4;\n  const maxRunes = 15;\n  const maxSequences = 4;\n  const sequences = maths.getRandomIntInclusive(\n    1,\n    Math.min(maxSequences, 1 + currentSceneLevel)\n  );\n  const nRunes = maths.getRandomIntInclusive(\n    minRunes,\n    Math.min(minRunes + currentSceneLevel, maxRunes)\n  );\n  const runesStart = maths.getRandomInt(0, RUNES.length - nRunes);\n  const runes = RUNES.substring(runesStart, runesStart + nRunes);\n\n  const offsets = [];\n  for (let seq = 0; seq < nRunes; seq++) {\n    offsets.push(maths.getRandomIntInclusive(1, nRunes));\n  }\n\n  return {\n    runes: runes,\n    repetitions: 4 + currentSceneLevel,\n    sequences: sequences,\n    sequenceOffsets: offsets,\n    startOffset: maths.getRandomIntInclusive(0, nRunes),\n    nextLength: maths.getRandomIntInclusive(2, 5),\n  };\n}\n\n/**\n * Create a wrong sequence based on the correct sequence\n * @param {string} correct\n * @param {string} runes\n * @returns {string} incorrect\n */\nfunction createIncorrectSequence(correct, runes) {\n  const letters = correct.split('');\n  const changedIndex = maths.getRandomInt(0, letters.length);\n  for (let index = 0; index < runes.length; index++) {\n    const substitute = runes.charAt(index);\n    if (substitute !== letters[changedIndex]) {\n      letters[changedIndex] = substitute;\n      break; // now incorrect\n    }\n  }\n  return letters.join('');\n}\n","/**\n * @file Sequence generator for puzzles involving pattern matching.\n *\n * @module dnd\\sequenceGenerator\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * Create a logical sequence of characters.\n * @param {Object} options\n * @param {string} [runes = 'ABCD'] - characters used for sequencing\n * @param {number} [repetitions] - number of repetitions. Min is 4.\n * @param {number} [sequences = 1] - number of interleaved sequences\n * @param {number[]} [sequenceOffsets = [1]] - offset per sequence. If array length is shorter\n * than the number of sequences, the last entry is used\n * @param {number} [startOffset = 0] - offset at start\n * @param {number} [nextLength = 1] - length of next characters in sequence\n * @returns {<sequence:string, next:string}\n */\nexport function createSequence(options = {}) {\n  const runes = options.runes ?? 'ABCD';\n  const sequences = options.sequences ?? 1;\n  const repetitions = Math.max(options.repetitions ?? 0, 4);\n  const sequenceOffsets = options.sequenceOffsets ?? [1];\n  const startOffset = options.startOffset ?? 0;\n  let nextLength = options.nextLength ?? 1;\n  nextLength = Math.min((repetitions - 3) * sequences, nextLength);\n\n  let result = '';\n  for (let rep = 0; rep < repetitions; rep++) {\n    for (let sequence = 0; sequence < sequences; sequence++) {\n      let sequenceOffset;\n      if (sequence < sequenceOffsets.length) {\n        sequenceOffset = sequenceOffsets[sequence];\n      } else {\n        sequenceOffset = sequenceOffsets[sequenceOffsets.length - 1];\n      }\n      const offset = startOffset + sequenceOffset * (1 + rep);\n      result += getRune(runes, offset);\n    }\n  }\n  return {\n    sequence: result.substring(0, result.length - nextLength),\n    next: result.substring(result.length - nextLength),\n  };\n}\n\n/**\n * Get the rune at the offset. The offset wraps if greater\n * than the length of runes.\n * @param {string} runes\n * @param {number} offset\n * @returns {string} the character\n */\nfunction getRune(runes, offset) {\n  return runes.charAt(offset % runes.length);\n}\n","/**\n * @file Automatic scene generator\n *\n * @module scriptReaders/autoSceneList\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { ALMANAC_LIBRARY } from '../dnd/almanacs/almanacs.js';\nimport { SceneDefinition } from '../gameManagement/sceneManager.js';\nimport * as maths from '../utils/maths.js';\nimport LOG from '../utils/logging.js';\nimport { RoomCreator } from '../utils/tileMaps/roomGenerator.js';\nimport { i18n } from '../utils/messageManager.js';\nimport { buildActor } from '../dnd/almanacs/actorBuilder.js';\nimport { sceneToFloor } from '../dnd/floorNumbering.js';\n\nimport * as dice from '../utils/dice.js';\nimport {\n  createDebugHero,\n  createDebugEnemyEntry,\n} from '../dnd/almanacs/debugBuilder.js';\n\n/** @type {module:players/actors~Actor} */\nlet heroActor;\n\n/**\n * Create a set of enemies based on the hero's level.\n * This is based on guide that 4 players should be able to\n * challenge a monster with a challenge rating equal to its\n * level as a worthy but not deadly challenge. As we have one\n * player, a challenge rating of 1/4 its level should be okay.\n * This is regarded as a medium challenge\n */\n/**\n * @typedef {number} DungeonChallengeValue\n */\n/**\n * @enum {DungeonChallengeValue}\n */\nexport const DungeonChallenge = {\n  INSIGNIFICANT: 1 / 64,\n  EASY: 3 / 16,\n  MEDIUM: 1 / 4,\n};\n\n/**\n * Get the maximum challenge rating for an enemy encountered in the scene\n * @param {DungeonChallengeValue} challenge\n */\nfunction getMaxEnemyCr(challenge) {\n  const level = heroActor?.traits.getCharacterLevel() ?? 1;\n  return challenge * level + 0.001; // prevent float issues.\n}\n/**\n * Create a pool of enemies based on the dungeon rating.\n * @param {DungeonChallengeValue} dungeonRating\n * @param {number} minLevel\n * @returns {module:almanacs/almanacs~Almanac}\n */\nfunction createEnemyPoolAlmanac(dungeonRating, minLevel) {\n  const maxMonsterChallenge = getMaxEnemyCr(dungeonRating);\n  return ALMANAC_LIBRARY.getAlmanac('ENEMIES').filter(\n    (entry) =>\n      entry.challengeRating <= maxMonsterChallenge && entry.minLevel <= minLevel\n  );\n}\n/**\n * @implements {module:gameManagement/sceneManager~SceneList}\n */\nclass AutoSceneList {\n  /** @type {number} */\n  #index;\n  /** @type {SceneDefinition} */\n  #sceneDefn;\n\n  /** @type {DungeonChallenge} */\n  #dungeonChallenge;\n\n  /**\n   */\n  constructor() {\n    this.reset();\n  }\n\n  /**\n   * @param {DungeonChallengeValue} dungeonChallenge\n   */\n  setChallenge(dungeonChallenge) {\n    this.#dungeonChallenge = dungeonChallenge;\n    LOG.info(`Dungeon challenge rating set to ${dungeonChallenge}`);\n  }\n  /**\n   * @returns {number}\n   */\n  getIndex() {\n    return this.#index;\n  }\n\n  /**\n   * Get the next scene.\n   * @returns {SceneDefinition}\n   */\n  getNext() {\n    this.#index++;\n    if (this.#index === 0) {\n      heroActor = null; // always a new actor at level 0\n    }\n    this.#buildScene();\n    return this.#sceneDefn;\n  }\n  /**\n   * Test to see if there is another scene.\n   * @returns {boolean}\n   */\n  hasNext() {\n    return true;\n  }\n\n  /**\n   * Reset\n   */\n  reset() {\n    this.#dungeonChallenge = DungeonChallenge.MEDIUM;\n    this.#index = -1;\n  }\n\n  /**\n   * Restore a saved game. Game are saved when a dungeon is exited so the call should\n   * be to the next scene.\n   * @param {number} index\n   * @param {module:players/actors.Actor} hero\n   */\n  restore(index, hero) {\n    heroActor = hero;\n    this.#index = index;\n  }\n\n  /** Build a scene */\n  #buildScene() {\n    this.#sceneDefn = new SceneDefinition();\n\n    this.#setHero();\n\n    this.#addIntro();\n    this.#addEnemies(this.#dungeonChallenge);\n    this.#addTraders();\n    this.#addArtefacts();\n    this.#addMap();\n    if (dice.rollDice(20) > 13) {\n      LOG.info('Adding a portal.');\n      this.#addPortal();\n    }\n  }\n\n  /**\n   * Add scene introduction.\n   */\n  #addIntro() {\n    this.#sceneDefn.intro = i18n`MESSAGE ENTER FLOOR ${sceneToFloor(\n      this.#index\n    )}`;\n  }\n  /**\n   * Add hero to scene.\n   */\n  #setHero() {\n    if (!heroActor) {\n      heroActor = createDebugHero();\n    }\n    if (!heroActor) {\n      const almanacEntry = ALMANAC_LIBRARY.getRandomEntry('HEROES');\n      if (!almanacEntry) {\n        LOG.fatal(new Error(`Could not find hero in almanacs.`));\n      }\n      heroActor = buildActor(almanacEntry);\n    }\n    this.#sceneDefn.hero = heroActor;\n  }\n\n  /**\n   * Add enemies to scene.\n   * @param {DungeonChallengeValue} [challenge = DungeonChallenge.MEDIUM]\n   */\n  #addEnemies(challenge = DungeonChallenge.MEDIUM) {\n    const debugEnemy = createDebugEnemyEntry();\n    if (debugEnemy) {\n      this.#sceneDefn.enemies.push(debugEnemy);\n      return;\n    }\n    const maxEnemyCr = getMaxEnemyCr(challenge);\n    let maxEnemies;\n    let maxTotalChallenge;\n    switch (challenge) {\n      case DungeonChallenge.EASY:\n        maxEnemies = 6;\n        maxTotalChallenge = maxEnemyCr;\n        break;\n      case DungeonChallenge.MEDIUM:\n      default:\n        maxEnemies = 8;\n        maxTotalChallenge = maxEnemyCr * 1.25;\n        break;\n    }\n\n    const enemyPoolAlmanac = createEnemyPoolAlmanac(challenge, this.#index);\n    let totalChallenge = 0;\n    let totalEnemies = 0;\n    while (totalChallenge < maxTotalChallenge && totalEnemies < maxEnemies) {\n      const enemy = enemyPoolAlmanac.getRandomEntry();\n      totalChallenge += Math.max(\n        enemy.challengeRating,\n        DungeonChallenge.INSIGNIFICANT\n      );\n      totalEnemies++;\n      this.#sceneDefn.enemies.push(enemy);\n    }\n    LOG.info(\n      `Scene challenge rating ${totalChallenge.toFixed(\n        3\n      )} from ${totalEnemies} enemies.`\n    );\n  }\n\n  /**\n   * Add enemies to scene.\n   */\n  #addTraders() {\n    const totalTraders = 1;\n    for (let traderIndex = 0; traderIndex < totalTraders; traderIndex++) {\n      const almanacEntry = ALMANAC_LIBRARY.getRandomEntry(\n        'TRADERS',\n        (entry) => entry.minLevel <= this.#index\n      );\n      this.#sceneDefn.enemies.push(almanacEntry);\n    }\n  }\n\n  /**\n   * Add artefacts to scene.\n   */\n  #addArtefacts() {\n    const pooledAlmanac = ALMANAC_LIBRARY.getPooledAlmanac(\n      ['ARTEFACTS', 'MAGIC', 'MONEY', 'WEAPONS', 'TRAPS', 'PLANTS'],\n      (entry) => entry.minLevel <= this.#index\n    );\n    let totalArtefacts = maths.getRandomIntInclusive(4, 12);\n    while (totalArtefacts-- > 0) {\n      const almanacEntry = pooledAlmanac.getRandomEntry();\n      if (almanacEntry) {\n        this.#sceneDefn.artefacts.push(almanacEntry);\n      }\n    }\n  }\n\n  /**\n   * Add an portal to the scene\n   */\n  #addPortal() {\n    const almanacEntry = ALMANAC_LIBRARY.getRandomEntry(\n      'PORTALS',\n      (entry) => entry.minLevel <= this.#index\n    );\n    if (almanacEntry) {\n      this.#sceneDefn.portal = almanacEntry;\n    }\n  }\n\n  /** Add a random map */\n  #addMap() {\n    const creator = new RoomCreator({\n      minCols: 12,\n      maxCols: 40,\n      maxRoomCols: 10,\n      minRows: 12,\n      maxRows: 40,\n      maxRoomRows: 6,\n    });\n    this.#sceneDefn.mapDesign = creator.generate();\n  }\n}\n\n/**\n * Create a new auto scene list\n * @param {string} script\n * @returns {module:gameManagement/sceneManager~SceneList}\n */\nexport function createAutoSceneList(scriptUnused) {\n  LOG.debug(`Creating automatic scene list.`);\n  return new AutoSceneList();\n}\n","/**\n * @file Random room generator\n *\n * @module utils/tileMaps/roomGenerator\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as maths from '../maths.js';\nimport * as arrayManip from '../arrays/arrayManip.js';\nimport { SpecialSymbols } from './tilePlan.js';\n\n/**\n * Class used to create rooms\n */\nexport class RoomCreator {\n  #maxCols;\n  #maxRows;\n  #maxRoomCols;\n  #maxRoomRows;\n  #dungeon;\n  /**\n   *\n   * @param {Object} options\n   * @param {number} options.minCols\n   * @param {number} options.minRows\n   * @param {number} options.maxCols\n   * @param {number} options.maxRows\n   * @param {number} options.maxRoomWidth\n   * @param {number} options.maxRoomHeight\n   */\n  constructor(options) {\n    this.#maxCols = maths.getRandomIntInclusive(\n      options.minCols,\n      options.maxCols\n    );\n    this.#maxRows = maths.getRandomIntInclusive(\n      options.minRows,\n      options.maxRows\n    );\n    this.#maxRoomCols = options.maxRoomCols;\n    this.#maxRoomRows = options.maxRoomRows;\n  }\n\n  /**\n   * Get a random wall char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */\n  #getWallChr(qty = 1) {\n    let result = '';\n    while (qty-- > 0) {\n      result += maths.getRandomMember(SpecialSymbols.WALL);\n    }\n    return result;\n  }\n\n  /**\n   * Get a random ground char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */\n  #getFloorChr(qty = 1) {\n    let result = '';\n    while (qty-- > 0) {\n      result += maths.getRandomMember(SpecialSymbols.GROUND);\n    }\n    return result;\n  }\n\n  /**\n   * Get a random void char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */\n  #getLandChr(qty = 1) {\n    let result = '';\n    while (qty-- > 0) {\n      result += maths.getRandomMember(SpecialSymbols.VOID);\n    }\n    return result;\n  }\n\n  /**\n   * Get a random door in char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */\n  #getDoorInChr(qty = 1) {\n    let result = '';\n    while (qty-- > 0) {\n      result += maths.getRandomMember(SpecialSymbols.DOOR_IN);\n    }\n    return result;\n  }\n\n  /**\n   * Get a random door out char.\n   * @param {number} [qty = 1]\n   * @returns {string}\n   */\n  #getDoorOutChr(qty = 1) {\n    let result = '';\n    while (qty-- > 0) {\n      result += maths.getRandomMember(SpecialSymbols.DOOR_OUT);\n    }\n    return result;\n  }\n\n  /** Test is a wall char.\n   * @param {string} char\n   * @returns {boolean}\n   */\n  #isWallChr(chr) {\n    return SpecialSymbols.WALL.includes(chr);\n  }\n\n  /** Test is a floor character.\n   * @param {string} char\n   * @returns {boolean}\n   */\n  #isFloorChr(chr) {\n    return SpecialSymbols.GROUND.includes(chr);\n  }\n\n  /** Test is a land character.\n   * @param {string} char\n   * @returns {boolean}\n   */\n  #isLandChr(chr) {\n    return SpecialSymbols.VOID.includes(chr);\n  }\n\n  /** Test is a entrance character.\n   * @param {string} char\n   * @returns {boolean}\n   */\n  #isDoorInChr(chr) {\n    return SpecialSymbols.DOOR_IN.includes(chr);\n  }\n\n  /** Test is a exit character.\n   * @param {string} char\n   * @returns {boolean}\n   */\n  #isDoorOutChr(chr) {\n    return SpecialSymbols.DOOR_OUT.includes(chr);\n  }\n  /**\n   * Generate a room.\n   * @returns {String[]}\n   */\n  generate() {\n    const minRoomCols = 4;\n    const minRoomRows = 4;\n    this.#dungeon = [];\n    let lastLeftLandCols = 0;\n    let lastRoomCols = this.#maxCols;\n    while (this.#dungeon.length < this.#maxRows - minRoomRows) {\n      const maxLeftLand = lastLeftLandCols + lastRoomCols - minRoomCols - 2;\n      const leftLandCols =\n        maxLeftLand > 0 ? maths.getRandomInt(0, maxLeftLand) : 0;\n      const reqdMinRoomWidth = Math.max(\n        lastLeftLandCols - leftLandCols + minRoomCols,\n        minRoomCols\n      );\n      let reqdMaxRoomWidth = Math.min(\n        this.#maxRoomCols,\n        this.#maxCols - leftLandCols\n      );\n\n      const roomCols =\n        reqdMaxRoomWidth > reqdMinRoomWidth\n          ? maths.getRandomInt(reqdMinRoomWidth, reqdMaxRoomWidth)\n          : reqdMinRoomWidth;\n      const rightLandCols = this.#maxCols - leftLandCols - roomCols;\n      const maxHeight = Math.min(\n        this.#maxRoomRows,\n        this.#maxRows - this.#dungeon.length\n      );\n      const roomRows = maths.getRandomInt(minRoomRows, maxHeight);\n      this.#createRoom(leftLandCols, roomCols, rightLandCols, roomRows);\n      lastLeftLandCols = leftLandCols;\n      lastRoomCols = roomCols;\n    }\n    this.#removeInternalWalls();\n    this.#locateDoors();\n    return this.getMatrixAsStrings();\n  }\n\n  /**\n   * Convert matrix to a plan design.\n   * @returns {string[]}\n   */\n  getMatrixAsStrings() {\n    return this.#dungeon.map((columns) => columns.join(''));\n  }\n\n  /**\n   *\n   * @param {number} leftLandCols\n   * @param {number} roomCols\n   * @param {number} rightLandCols\n   * @param {number} numberOfRows\n   */\n  #createRoom(leftLandCols, roomCols, rightLandCols, numberOfRows) {\n    let columns = '';\n    columns += this.#getLandChr(leftLandCols);\n    columns += this.#getWallChr(roomCols);\n    columns += this.#getLandChr(rightLandCols);\n    this.#dungeon.push(columns.split(''));\n    for (let internalRow = 0; internalRow < numberOfRows - 2; internalRow++) {\n      columns = '';\n      columns += this.#getLandChr(leftLandCols);\n      columns += this.#getWallChr(1);\n      columns += this.#getFloorChr(roomCols - 2);\n      columns += this.#getWallChr(1);\n      columns += this.#getLandChr(rightLandCols);\n      this.#dungeon.push(columns.split(''));\n    }\n    columns = '';\n    columns += this.#getLandChr(leftLandCols);\n    columns += this.#getWallChr(roomCols);\n    columns += this.#getLandChr(rightLandCols);\n    this.#dungeon.push(columns.split(''));\n  }\n\n  /** Go through the dungeon removing internal walls. */\n  #removeInternalWalls() {\n    for (let row = 1; row < this.#dungeon.length - 1; row++) {\n      for (let col = 1; col < this.#dungeon[0].length - 2; col++) {\n        if (\n          this.#isWallChr(this.#dungeon[row][col]) &&\n          this.#isWallChr(this.#dungeon[row + 1][col]) &&\n          this.#isFloorChr(this.#dungeon[row - 1][col]) &&\n          this.#isFloorChr(this.#dungeon[row + 2][col])\n        ) {\n          this.#dungeon[row][col] = this.#getFloorChr(1);\n          this.#dungeon[row + 1][col] = this.#getFloorChr(1);\n        }\n      }\n    }\n  }\n\n  /**\n   * Is this a vertical wall where a door could go.\n   * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n   * @returns {boolean}\n   */\n  #isVerticalWall(surrounds) {\n    return (\n      this.#isWallChr(surrounds.above) &&\n      this.#isWallChr(surrounds.centre) &&\n      this.#isWallChr(surrounds.below)\n    );\n  }\n  /**\n   * Is this a Horizontal wall where a door could go.\n   * @param {module:utils/arrays/arrayManip~Surrounds} surrounds\n   * @returns {boolean}\n   */\n  #isHorizontalWall(surrounds) {\n    return (\n      this.#isWallChr(surrounds.left) &&\n      this.#isWallChr(surrounds.centre) &&\n      this.#isWallChr(surrounds.right)\n    );\n  }\n\n  /**\n   * Position the doors.\n   */\n  #locateDoors() {\n    const possibleLocations = [];\n    this.#dungeon.forEach((rowValue, rowIndex) =>\n      rowValue.forEach((colValue, colIndex) => {\n        const surrounds = arrayManip.getSurrounds(\n          this.#dungeon,\n          rowIndex,\n          colIndex\n        );\n        if (\n          this.#isHorizontalWall(surrounds) ||\n          this.#isVerticalWall(surrounds)\n        ) {\n          possibleLocations.push({ row: rowIndex, col: colIndex });\n        }\n      })\n    );\n    const randomLocations = arrayManip.randomise(possibleLocations);\n    let location = randomLocations[0];\n    this.#dungeon[location.row][location.col] = this.#getDoorInChr();\n    location = randomLocations[1];\n    this.#dungeon[location.row][location.col] = this.#getDoorOutChr();\n  }\n}\n","/**\n * @file Class for building a debug actor\n *\n * @module dnd/almanacs/debugBuilder\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as almanacs from './almanacs.js';\nimport { buildActor } from './actorBuilder.js';\nimport { buildArtefact } from './artefactBuilder.js';\nimport LOG from '../../utils/logging.js';\nimport { Traits } from '../traits.js';\n\nconst GANDALPH =\n  '0,COMMON,HERO,wizard1 [chain_mail_armour,iron_rations, iron_rations, iron_rations, waterskin, waterskin, waterskin,copper_coins] * NAME:Gandalph,CLASS:WIZARD,HIT_DICE:1D8,EXP:0, AC:10,_SPEED:30 FEET';\n\n/**\n * Create a hero depending on what is passed on the URL.\n * @returns {module:dnd/almanacs~AlmanacEntry}\n */\nexport function createDebugEnemyEntry() {\n  if (window.location.hostname !== 'localhost') {\n    return;\n  }\n  const searchParams = new URLSearchParams(window.location.search);\n  const enemyId = searchParams.get('ENEMY');\n  if (enemyId) {\n    const actors = almanacs.ALMANAC_LIBRARY.getAlmanac('ENEMIES');\n    return actors?.find((entry) => entry.id === enemyId);\n  } else {\n    return;\n  }\n}\n/**\n * Create a hero depending on what is passed on the URL.\n * @returns {module:players/actors.Actor}\n */\nexport function createDebugHero() {\n  if (window.location.hostname !== 'localhost') {\n    return;\n  }\n  const searchParams = new URLSearchParams(window.location.search);\n  const heroId = searchParams.get('HERO');\n  if (!heroId) {\n    return;\n  }\n  let hero;\n  let hasAllMagic = false;\n  if (heroId.toUpperCase() === 'GANDALPH') {\n    const almanacEntry = almanacs.parseAlmanacLine(GANDALPH, 'HEROES');\n    hero = buildActor(almanacEntry);\n    hasAllMagic = true;\n  } else {\n    hero = buildActorFromAlmanac('HEROES', heroId);\n    if (!hero) {\n      return;\n    }\n  }\n  const equipSpells = searchParams.get('equipSpells') !== null;\n  const stashSpells = searchParams.get('stashSpells') !== null;\n  if (equipSpells || stashSpells) {\n    const magic = almanacs.ALMANAC_LIBRARY.getAlmanac('MAGIC');\n    addAllMagicToHero(hero, magic.common, equipSpells, hasAllMagic);\n    addAllMagicToHero(hero, magic.uncommon, equipSpells, hasAllMagic);\n    addAllMagicToHero(hero, magic.rare, equipSpells, hasAllMagic);\n    addAllMagicToHero(hero, magic.veryRare, equipSpells, hasAllMagic);\n  }\n\n  // Give hero an artefact defined in the search params..\n  for (const key of ['ARMOUR', 'ARTEFACTS', 'PLANTS', 'WEAPONS']) {\n    addToBackpack(hero, key, searchParams.get(key));\n  }\n\n  return hero;\n}\n\n/**\n * Build actor from almanac.\n * @param {string} almanacKey\n * @param {string} actorId\n * @returns {module:players/actors.Actor}\n */\nfunction buildActorFromAlmanac(almanacKey, actorId) {\n  const actors = almanacs.ALMANAC_LIBRARY.getAlmanac(almanacKey);\n  const almanacEntry = actors?.find((entry) => entry.id === actorId);\n  if (!almanacEntry) {\n    LOG.error(\n      `Cannot find actor ${actorId} in ${almanacKey} almanac, so ignoring.`\n    );\n    return;\n  }\n  const actor = buildActor(almanacEntry);\n  if (!actor) {\n    LOG.error(\n      `Cannot build actor ${actorId} in ${almanacKey} almanac, so ignoring.`\n    );\n    return;\n  }\n  return actor;\n}\n\n/**\n *\n * @param {module:players/actors.Actor} hero\n * @param {module:dnd/almanacs/almanacs.AlmanacEntry[]} entries\n * @param {boolean} equipSpells - if true, spells don't need to be prepared.\n * @param {boolean} allMagic - if true, the hero gets everything even if they are the wrong caster\n */\nfunction addAllMagicToHero(hero, entries, equipSpells, allMagic) {\n  for (const entry of entries) {\n    const traits = new Traits(entry.traitsString);\n    if (\n      allMagic ||\n      traits.get('CASTERS', '').indexOf(hero.traits.get('CLASS', '')) >= 0\n    ) {\n      const magic = buildArtefact(entry);\n      if (entry.typeId === 'CANTRIP' || equipSpells) {\n        hero.storeManager.equip(magic, { direct: true });\n      } else {\n        hero.storeManager.stash(magic, { direct: true });\n      }\n    }\n  }\n}\n\n/**\n * Add item to hero's backpack (i.e. stash)\n * @param {module:players/actors.Actor} hero\n * @param {string} key - almanac key\n * @param {string} itemId - id of the item\n */\nfunction addToBackpack(hero, key, itemId) {\n  if (!itemId) {\n    return;\n  }\n  const items = almanacs.ALMANAC_LIBRARY.getAlmanac(key);\n\n  const entry = items?.find((entry) => entry.id === itemId);\n  if (!entry) {\n    LOG.error(`Could not find ${itemId} in ${key} almanac. Ignoring.`);\n    return;\n  }\n  const item = buildArtefact(entry);\n  hero.storeManager.stash(item, { direct: true });\n}\n","/**\n * @file Prevent multiple identification attempts. This is to make identification\n * turn based.\n *\n * @module gameManagement\\identifyLimiter\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../utils/logging.js';\n\n/** @type {boolean} */\nlet idCheckAllowed = true;\n\n/**\n * Checks to see if an identification can be made. Uses the identification\n * so a subsequent call will fail.\n * @returns {boolean} if allowed.\n */\nexport function useIdCheck() {\n  const allowed = idCheckAllowed;\n  idCheckAllowed = false;\n  if (!allowed) {\n    LOG.info('Identification checks not allowed at present.');\n  }\n  return allowed;\n}\n\n/**\n * Allow id checks.\n */\nexport function allowIdCheck() {\n  idCheckAllowed = true;\n}\n","/**\n * @file Conversion of map plan keys to images and tile definitions.\n *\n * @module scriptReaders/symbolMapping\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport { TileRole } from '../utils/tileMaps/tileMap.js';\nimport TURN_MANAGER from '../gameManagement/turnManager.js';\n\n/**\n * @typedef {module:scriptReaders/sceneDefinitionParser~TileDefinition} TileDefinition\n */\n\n/**\n * @param {string} imageName\n * @returns {TileDefinition}\n */\nfunction createGroundDefn(imageName) {\n  return {\n    role: TileRole.GROUND,\n    onClick: (target, point, detail) =>\n      TURN_MANAGER.triggerEvent(\n        TURN_MANAGER.EventId.CLICKED_FREE_GROUND,\n        point,\n        detail\n      ),\n    image: imageName,\n  };\n}\n\n/**\n * @param {string} imageName\n * @returns {TileDefinition}\n */\nfunction createEntranceDefn(imageName) {\n  return {\n    role: TileRole.ENTRANCE,\n    onClick: (target, point, detail) =>\n      TURN_MANAGER.triggerEvent(\n        TURN_MANAGER.EventId.CLICKED_ENTRANCE,\n        point,\n        detail\n      ),\n    image: imageName,\n  };\n}\n\n/**\n * @param {string} imageName\n * @returns {TileDefinition}\n */\nfunction createExitDefn(imageName) {\n  return {\n    role: TileRole.EXIT,\n    onClick: (target, point, detail) =>\n      TURN_MANAGER.triggerEvent(\n        TURN_MANAGER.EventId.CLICKED_EXIT,\n        point,\n        detail\n      ),\n    image: imageName,\n  };\n}\n\nexport const TILE_MAP_KEYS = new Map([\n  ['x', { role: TileRole.OBSTACLE, image: 'block.png' }],\n  // wall parts\n  ['#-TL', { role: TileRole.OBSTACLE, image: 'wall-TL.png' }],\n  ['#-TLI', { role: TileRole.OBSTACLE, image: 'wall-TLI.png' }],\n  ['#-T', { role: TileRole.OBSTACLE, image: 'wall-T.png' }],\n  ['*-T', { role: TileRole.OBSTACLE, image: 'wall2-T.png' }],\n  ['#-TR', { role: TileRole.OBSTACLE, image: 'wall-TR.png' }],\n  ['#-TRI', { role: TileRole.OBSTACLE, image: 'wall-TRI.png' }],\n  ['#-R', { role: TileRole.OBSTACLE, image: 'wall-R.png' }],\n  ['#-BR', { role: TileRole.OBSTACLE, image: 'wall-BR.png' }],\n  ['#-BRI', { role: TileRole.OBSTACLE, image: 'wall-BRI.png' }],\n  ['#-B', { role: TileRole.OBSTACLE, image: 'wall-B.png' }],\n  ['*-B', { role: TileRole.OBSTACLE, image: 'wall2-B.png' }],\n  ['#-BL', { role: TileRole.OBSTACLE, image: 'wall-BL.png' }],\n  ['#-BLI', { role: TileRole.OBSTACLE, image: 'wall-BLI.png' }],\n  ['#-L', { role: TileRole.OBSTACLE, image: 'wall-L.png' }],\n  ['#-XI', { role: TileRole.OBSTACLE, image: 'wall-XI.png' }],\n  ['#-VI', { role: TileRole.OBSTACLE, image: 'wall-VI.png' }],\n  ['#-HI', { role: TileRole.OBSTACLE, image: 'wall-HI.png' }],\n  ['#-TTEE', { role: TileRole.OBSTACLE, image: 'wall-TTEE.png' }],\n  ['#-RTEE', { role: TileRole.OBSTACLE, image: 'wall-RTEE.png' }],\n  ['#-BTEE', { role: TileRole.OBSTACLE, image: 'wall-BTEE.png' }],\n  ['#-LTEE', { role: TileRole.OBSTACLE, image: 'wall-LTEE.png' }],\n  ['#', { role: TileRole.OBSTACLE, image: 'block.png' }],\n  // doors\n  ['=-T', createExitDefn('door-T.png')],\n  ['>-T', createExitDefn('door2-T.png')],\n  ['=-R', createExitDefn('door-R.png')],\n  ['=-B', createExitDefn('door-B.png')],\n  ['>-B', createExitDefn('door2-B.png')],\n  ['=-L', createExitDefn('door-L.png')],\n  ['--T', createEntranceDefn('door-T.png')],\n  ['~-T', createEntranceDefn('door2-T.png')],\n  ['--R', createEntranceDefn('door-R.png')],\n  ['--B', createEntranceDefn('door-B.png')],\n  ['~-B', createEntranceDefn('door2-B.png')],\n  ['--L', createEntranceDefn('door-L.png')],\n  ['=', { role: TileRole.OBSTACLE, image: 'block.png' }],\n  ['-', { role: TileRole.OBSTACLE, image: 'block.png' }],\n  // ground\n  ['.', createGroundDefn('floor.png')],\n  ['.-SBW', createGroundDefn('floor-SBW.png')],\n  ['.-SBE', createGroundDefn('floor-SBE.png')],\n\n  [',-SBE', createGroundDefn('floor2-SBE.png')],\n  [',-SBW', createGroundDefn('floor2-SBW.png')],\n  [',', createGroundDefn('floor2.png')],\n]);\n","/**\n * @file Encapsulation of a Scene. A scene equates normally to a level in a\n * dungeon.\n *\n * @module game/scene\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport WORLD from './world.js';\nimport SCREEN from './screen.js';\n\n/**\n * The base scene\n */\nexport class AbstractScene {\n  /** @type {number} */\n  #globalOpacity;\n  /** @type {number} */\n  #deltaOpacityPerSec;\n\n  /** @type {number} */\n  #fadeInSecs;\n  /** @type {number} */\n  #fadeOutSecs;\n\n  /** Fade out promise resolution @type {function}  */\n  #fadeOutResolve;\n\n  /** @type {module:players/actors~Actor} */\n  heroActor;\n\n  /** @type {string} */\n  intro;\n\n  /**\n   * Create the scene.\n   * @param {number} [fadeInSecs = 2]\n   * @param {number} [fadeOutSecs = 2]\n   */\n  constructor(fadeInSecs = 2, fadeOutSecs = 2) {\n    if (fadeInSecs > 0) {\n      this.#globalOpacity = 0;\n      this.#deltaOpacityPerSec = 1 / fadeInSecs;\n    } else {\n      this.#deltaOpacityPerSec = 1;\n    }\n    this.#fadeInSecs = fadeInSecs;\n    this.#fadeOutSecs = fadeOutSecs;\n  }\n\n  /**\n   * Get the global opacity.\n   * @returns {number}\n   */\n  getOpacity() {\n    return this.#globalOpacity;\n  }\n  /**\n   * Called at start. Game waits for preload before calling initialise.\n   * @function Scene#load\n   * @returns {Promise} fulfills to null\n   */\n  load() {\n    return this.doLoad();\n  }\n\n  /**\n   * Called after load. Game waits for initialise before starting the loop.\n   * @function Scene#initialise\n   * @returns {Promise} fulfills to null\n   */\n  initialise() {\n    return this.doInitialise();\n  }\n\n  /**\n   * Called in animation phase\n   * @function Scene#update\n   * @param {number} deltaSeconds\n   */\n  update(deltaSeconds) {\n    SCREEN.clearCanvas();\n    SCREEN.setOpacity(this.#globalOpacity);\n    WORLD.update(deltaSeconds);\n    this.doUpdate(deltaSeconds);\n    SCREEN.setOpacity(1);\n    if (this.#deltaOpacityPerSec !== 0) {\n      this.#globalOpacity += deltaSeconds * this.#deltaOpacityPerSec;\n      if (this.#globalOpacity > 1) {\n        this.#deltaOpacityPerSec = 0;\n        this.#globalOpacity = 1;\n      } else if (this.#globalOpacity < 0) {\n        this.#deltaOpacityPerSec = 0;\n        this.#globalOpacity = 0;\n      }\n    }\n    if (this.#fadeOutResolve && this.#globalOpacity === 0) {\n      this.#fadeOutResolve();\n      this.#fadeOutResolve = null;\n    }\n  }\n\n  /**\n   * Called when scene swapped out\n   * @function Scene#unload\n   * @returns {Promise} fulfills to null\n   */\n  unload() {\n    return this.#fadeOut().then(() => this.doUnload());\n  }\n\n  /**\n   * Fade out the scene\n   * @returns {Promise} fulfils to undefined when fade complete.\n   */\n  #fadeOut() {\n    if (this.#fadeOutSecs > 0) {\n      this.#deltaOpacityPerSec = -1 / this.#fadeOutSecs;\n      return new Promise((resolve) => {\n        this.#fadeOutResolve = resolve;\n      });\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  /**\n   * Called at start. Game waits for preload before calling initialise.\n   * This should be overridden.\n   * @returns {Promise} fulfills to null\n   */\n  doLoad() {\n    return Promise.resolve();\n  }\n\n  /**\n   * Called after load. Game waits for initialise before starting the loop.\n   * This should be overridden\n   * @returns {Promise} fulfills to null\n   */\n  doInitialise() {\n    return Promise.resolve();\n  }\n\n  /**\n   * Called in animation phase\n   * This should be overridden\n   * @param {number} deltaSeconds\n   */\n  doUpdate(deltaSecondsUnused) {\n    return Promise.resolve();\n  }\n\n  /**\n   * Called when scene swapped out\n   * This should be overridden\n   * @returns {Promise} fulfills to null\n   */\n  doUnload() {\n    return Promise.resolve();\n  }\n}\n","/**\n * @file Navigation button set for the HUD\n *\n * @module hud/hudNavSet\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport HUD from './hud.js';\nimport { AnimatedImage } from '../utils/sprites/animation.js';\nimport { LoopMethod } from '../utils/arrays/indexer.js';\nimport { CameraTracking } from '../utils/game/camera.js';\nimport { Point } from '../utils/geometry.js';\nimport { showSettingsDialog } from '../dialogs/settingsDialog.js';\nimport LOG from '../utils/logging.js';\n/**\n * @type {number}\n */\nconst SCROLL_TILES_PER_SEC = 3;\n\n/**\n * Location of the navigation buttons\n * @enum {number}\n */\nexport const NavigationLocation = {\n  TR: 0,\n  BR: 1,\n  BL: 2,\n  TL: 3,\n};\n\n/** Encapsulation of navigation buttons. */\nexport class NavigationButtons {\n  /** @type {CameraDolly} */\n  #cameraDolly;\n\n  /** @type {module:players/actors.Actor} */\n  #trackingButton;\n\n  /** @type {module:utils/sprites/imageManager~SpriteBitmap} */\n  #trackingButtonImage;\n\n  /**\n   *\n   * @param {CameraDolly} cameraDolly\n   * @param {number} gridSize\n   * @param {NavigationLocation} locationNav\n   * @param {NavigationLocation} locationFullscreen\n   */\n  constructor(cameraDolly, gridSize, locationNav, locationFullscreen) {\n    this.#cameraDolly = cameraDolly;\n    this.#createButtonSet(gridSize, locationNav, false);\n    this.#createSettingsButton(gridSize, locationFullscreen);\n    /* not required\n    this.#createFullscreenButton(gridSize, locationFullscreen, {\n      x: gridSize,\n      y: 0,\n    });\n    */\n  }\n\n  /**\n   * Create the button to handle showing settings.\n   */\n  #createSettingsButton(gridSize, location) {\n    const buttonImage = new AnimatedImage(\n      {\n        prefix: 'ui-settings',\n        startIndex: 0,\n        padding: 2,\n        suffix: '.png',\n      },\n      { framePeriodMs: 1, loopMethod: LoopMethod.STOP }\n    );\n\n    const settingsButton = HUD.addButton(buttonImage, () =>\n      showSettingsDialog()\n    );\n    const centre = this.#getLocationPoint(gridSize, location, 1);\n    settingsButton.position.x = centre.x;\n    settingsButton.position.y = centre.y;\n  }\n\n  /**\n   * Create the button to handle showing settings.\n   * @param {number} gridSize\n   * @param {NavigationLocation} location\n   * @param {Object} offset\n   * @param {number} offset.x\n   * @param {number} offset.y\n   *\n   */\n  #createFullscreenButton(gridSize, location, offset) {\n    const buttonImage = new AnimatedImage(\n      {\n        prefix: 'hud-fullscreen',\n        startIndex: 0,\n        padding: 2,\n        suffix: '.png',\n      },\n      { framePeriodMs: 1, loopMethod: LoopMethod.STOP }\n    );\n\n    const fullscreenButton = HUD.addButton(\n      buttonImage,\n      () => {\n        document.body.requestFullscreen?.({ navigationUI: 'hide' });\n      },\n      () => {\n        document.exitFullscreen?.();\n      }\n    );\n\n    const centre = this.#getLocationPoint(gridSize, location, 1);\n    fullscreenButton.position.x = centre.x + offset.x;\n    fullscreenButton.position.y = centre.y + offset.y;\n\n    window.addEventListener('fullscreenchange', () => {\n      if (document.fullscreenElement) {\n        LOG.debug('Switched to fullscreen mode.');\n        buttonImage.setCurrentIndex(1);\n      } else {\n        LOG.debug('Exited fullscreen mode.');\n        buttonImage.setCurrentIndex(0);\n      }\n    });\n  }\n\n  /** Get centre point information\n   * @param {number} gridSize - tile size\n   * @param {NavigationLocation} location\n   * @param {number} offset - offset applied to location.\n   * This grid units (i.e. tiles).\n   * @returns {Point}\n   */\n  #getLocationPoint(gridSize, location, offset) {\n    const point = new Point(0, 0);\n    switch (location) {\n      case NavigationLocation.TL:\n        point.x = offset * gridSize;\n        point.y = offset * gridSize;\n        break;\n      case NavigationLocation.TR:\n        point.x = -offset * gridSize;\n        point.y = offset * gridSize;\n        break;\n      case NavigationLocation.BR:\n        point.x = -offset * gridSize;\n        point.y = -offset * gridSize;\n        break;\n      case NavigationLocation.BL:\n        point.x = offset * gridSize;\n        point.y = -offset * gridSize;\n        break;\n    }\n    return point;\n  }\n  /**\n   * Create the buttons.\n   * @param {number} gridSize\n   * @param {NavigationLocation} location\n   * @param {boolean} showArrows\n   */\n  #createButtonSet(gridSize, location, showArrows) {\n    const offset = showArrows ? 2 : 1;\n    const centre = this.#getLocationPoint(gridSize, location, offset);\n\n    this.#createCentreButton(centre.x, centre.y);\n    if (showArrows) {\n      this.#createArrowButtons(centre.x, centre.y, gridSize);\n    }\n  }\n\n  /** Create the centre button.\n   * @param {number} centreX\n   * @param {number} centreY\n   */\n  #createCentreButton(centreX, centreY) {\n    this.#trackingButtonImage = new AnimatedImage(\n      {\n        prefix: 'hud-auto-centre',\n        startIndex: 0,\n        padding: 2,\n        suffix: '.png',\n      },\n      { framePeriodMs: 1, loopMethod: LoopMethod.STOP }\n    );\n    this.#trackingButton = HUD.addButton(\n      this.#trackingButtonImage,\n      () => {\n        this.setTrackingState(true);\n      },\n      () => {\n        this.setTrackingState(false);\n      }\n    );\n    this.#trackingButton.position.x = centreX;\n    this.#trackingButton.position.y = centreY;\n    this.#trackingButton.actionClick(null); // defaulting to selected.\n  }\n\n  /**\n   * Set the tracking state.\n   * @param {boolean} on\n   */\n  setTrackingState(on) {\n    if (on) {\n      this.#trackingButtonImage.setCurrentIndex(1);\n      this.#cameraDolly.setTrackingMethod(CameraTracking.HERO);\n    } else {\n      this.#trackingButtonImage.setCurrentIndex(0);\n      this.#cameraDolly.setTrackingMethod(CameraTracking.OFF);\n    }\n  }\n\n  /**\n   * Create the arrow buttons\n   * @param {number} centreX\n   * @param {number} centreY\n   * @param {number} gridSize\n   */\n  #createArrowButtons(centreX, centreY, gridSize) {\n    const scrollSpeed = SCROLL_TILES_PER_SEC * gridSize;\n    this.#createMomentaryButton(\n      'hud-arrow-up',\n      centreX,\n      centreY - gridSize,\n      () => {\n        this.setTrackingState(false);\n        this.#cameraDolly.setVelocity(0, -scrollSpeed);\n      },\n      () => this.#cameraDolly.setTrackingMethod(CameraTracking.OFF)\n    );\n\n    this.#createMomentaryButton(\n      'hud-arrow-right',\n      centreX + gridSize,\n      centreY,\n      () => {\n        this.setTrackingState(false);\n        this.#cameraDolly.setVelocity(scrollSpeed, 0);\n      },\n      () => this.#cameraDolly.setTrackingMethod(CameraTracking.OFF)\n    );\n\n    this.#createMomentaryButton(\n      'hud-arrow-down',\n      centreX,\n      centreY + gridSize,\n      () => {\n        this.setTrackingState(false);\n        this.#cameraDolly.setVelocity(0, scrollSpeed);\n      },\n      () => this.#cameraDolly.setTrackingMethod(CameraTracking.OFF)\n    );\n\n    this.#createMomentaryButton(\n      'hud-arrow-left',\n      centreX - gridSize,\n      centreY,\n      () => {\n        this.setTrackingState(false);\n        this.#cameraDolly.setVelocity(-scrollSpeed, 0);\n      },\n      () => this.#cameraDolly.setTrackingMethod(CameraTracking.OFF)\n    );\n  }\n\n  /**\n   * Create a momentary button.\n   * @param {string} imageNamePrefix - images are assumed to be imageNamePrefixNNN.png\n   * @param {number} x - x position\n   * @param {number} y - y position\n   * @param {function} callbackDown\n   * @param {function} callbackUp\n   */\n  #createMomentaryButton(imageNamePrefix, x, y, callbackDown, callbackUp) {\n    const animatedImage = new AnimatedImage(\n      {\n        prefix: imageNamePrefix,\n        startIndex: 0,\n        padding: 2,\n        suffix: '.png',\n      },\n      { framePeriodMs: 1, loopMethod: LoopMethod.STOP }\n    );\n    let button = HUD.addMomentaryButton(\n      animatedImage,\n      callbackDown,\n      callbackUp\n    );\n    button.position.x = x;\n    button.position.y = y;\n    animatedImage.setCurrentIndex(0);\n  }\n}\n","/**\n * @file Camera dolly class. This provides a mechanism to allow the canvas to\n * track a specified Sprite.\n *\n * @module game/camera\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport SCREEN from './screen.js';\nimport { Sprite } from '../sprites/sprite.js';\nimport { Tracker, VelocityMover } from '../sprites/movers.js';\nimport LOG from '../logging.js';\n\n/**\n * Set the methods of tracking\n * @enum {number}\n */\nexport const CameraTracking = {\n  OFF: 0,\n  HERO: 1,\n  VELOCITY: 2,\n};\n\n/**\n * Camera dolly class\n */\nexport class CameraDolly {\n  /** @type {module:utils/sprites/sprite~Sprite} */\n  #sprite;\n  /** @type {module:utils/sprites/modifiers~AbstractModifier} */\n  #heroTracker;\n  /** @type {module:utils/sprites/modifiers~AbstractModifier} */\n  #velocityTracker;\n  /** @type {number} */\n  #trackingMethod;\n\n  /**\n   * Create a camera dolly. This is a sprite that is designed to track a target.\n   * @param {module:utils/sprites/sprites.Sprite} target\n   * @param {number} speed\n   * @param {number} proportionSeparated - max space between camera and target as proportion of minimum screen dimension.\n   */\n  constructor(target, speed, proportionSeparated = 0) {\n    const canvasDims = SCREEN.getCanvasDimensions();\n    const separation =\n      proportionSeparated * Math.min(canvasDims.width, canvasDims.height);\n    this.#sprite = new Sprite();\n\n    this.#heroTracker = new Tracker({\n      prey: target,\n      speed: speed,\n      maxSeparation: separation,\n    });\n\n    this.#velocityTracker = new VelocityMover();\n    this.#heroTracker.applyAsContinuousToSprite(this.#sprite);\n  }\n\n  /**\n   * Update the camera position.\n   * @param {number} deltaSeconds - elapsed time since last update.\n   */\n  update(deltaSeconds) {\n    if (this.#trackingMethod !== CameraTracking.OFF) {\n      this.#sprite.update(deltaSeconds);\n      SCREEN.centreCanvasOn(this.#sprite.position);\n    }\n  }\n  /**\n   * Set the velocity to dX, dY. This will automatically set tracking to velocity.\n   * @param {number} dX\n   * @param {number} dY\n   */\n  setVelocity(vX, vY) {\n    this.setTrackingMethod(CameraTracking.VELOCITY);\n    this.#sprite.velocity.x = vX;\n    this.#sprite.velocity.y = vY;\n  }\n\n  /**\n   * Pan the camera by dx, dy. Automatic tracking is switched off.\n   * @param {number} dx\n   * @param {number} dy\n   */\n  panBy(dx, dy) {\n    this.#sprite.position.x += dx;\n    this.#sprite.position.y += dy;\n    SCREEN.centreCanvasOn(this.#sprite.position);\n  }\n\n  /**\n   * Set the trackingMethod\n   * @param {number} method - CameraTracking enum\n   */\n  setTrackingMethod(method) {\n    if (method === this.#trackingMethod) {\n      return;\n    }\n    this.#trackingMethod = method;\n    switch (method) {\n      case CameraTracking.HERO:\n        this.#heroTracker.applyAsContinuousToSprite(this.#sprite);\n        break;\n      case CameraTracking.VELOCITY:\n        this.#velocityTracker.applyAsContinuousToSprite(this.#sprite);\n        break;\n      case CameraTracking.OFF:\n        break;\n      default:\n        LOG.error(\n          `Attempt to set invalid tracking method of ${method} ignored.`\n        );\n    }\n  }\n}\n","/**\n * @file Trap characteristics. These are derived from the 5e Severity levels p196.\n *\n * @module dnd/trapCharacteristics\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport { AttackDetail } from './traits.js';\n/**\n * @typedef {Object} TrapDetails\n * @property {number} difficulty\n * @property {AttackDetail} attack\n * @property {string} detectBy\n * @property {string} disableBy\n * @property {number} goldCoins\n */\n\nconst CHARACTERISTICS = {\n  SETBACK: { dc: 11, bonus: 4, damage: ['1D10', '2D10', '4D10', '10D10'] },\n  DANGEROUS: { dc: 14, bonus: 7, damage: ['2D10', '4D10', '10D10', '18D10'] },\n  DEADLY: { dc: 18, bonus: 11, damage: ['4D10', '10D10', '18D10', '24D10'] },\n};\n\n/**\n * Get the trap characteristics based on its severity trait.\n * @param {number} characterLevel\n * @param {module:dnd/traits.Traits} trapTraits\n * @returns {TrapDetails}\n */\nexport function getCharacteristics(characterLevel, trapTraits) {\n  const severity = trapTraits.get('SEVERITY', 'SETBACK');\n  const details = CHARACTERISTICS[severity] ?? CHARACTERISTICS['SETBACK'];\n  let damage;\n  if (characterLevel < 5) {\n    damage = details.damage[0];\n  } else if (characterLevel < 11) {\n    damage = details.damage[1];\n  } else if (characterLevel < 17) {\n    damage = details.damage[2];\n  } else {\n    damage = details.damage[3];\n  }\n  return {\n    difficulty: details.dc,\n    attack: new AttackDetail({\n      damageDice: damage,\n      weaponType: 'TRAP',\n      proficiencyBonus: 0,\n      abilityModifier: details.bonus,\n    }),\n    detectBy: trapTraits.get('DETECT_BY', 'WIS'),\n    disableBy: trapTraits.get('DISABLE_BY', 'INT'),\n    reward: trapTraits.get('REWARD'),\n  };\n}\n","/**\n * @file Dialogs for handling traps\n *\n * @module dialogs/trapDialogs\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport UI from '../utils/dom/ui.js';\nimport { i18n } from '../utils/messageManager.js';\nimport { TrapOutcome } from '../dnd/interact.js';\n\n/**\n * Show offering disable options.\n * @param {module:dnd/traits.Traits} enactorTraitsUnused\n * @param {module:dnd/trapCharacteristics~TrapDetails} trapDetails\n * @param {string} trapDescription\n * @returns {Promise<TrapOutcome>} fulfils to TrapOutcome.ATTEMPT_DISABLE  or TrapOutcome.LEAVE\n */\nexport function showDisableTrap(\n  enactorTraitsUnused,\n  trapDetails,\n  trapDescriptionUnused\n) {\n  return UI.showChoiceDialog(\n    i18n`DIALOG TITLE TRAP DETECTED`,\n    i18n`MESSAGE TRAP ATTEMPT DISABLE`,\n    [i18n`BUTTON TRAP DISABLE`, i18n`BUTTON TRAP LEAVE`]\n  ).then((index) =>\n    index === 0 ? TrapOutcome.ATTEMPT_DISABLE : TrapOutcome.LEAVE\n  );\n}\n\n/**\n * Show dialog explaining trap trigger survival.\n * @param {module:dnd/traits.Traits} enactorTraitsUnused\n * @param {module:dnd/trapCharacteristics~TrapDetails} trapDetailsUnused\n * @param {string} trapDescription\n * @returns {Promise}\n */\nexport function showSurvivedTrap(\n  enactorTraitsUnused,\n  trapDetailsUnused,\n  trapDescription\n) {\n  return UI.showElementOkDialog(\n    i18n`DIALOG TITLE TRAP TRIGGERED SURVIVED`,\n    createTrapElement(trapDescription, i18n`MESSAGE TRAP TRIGGERED SURVIVED`)\n  );\n}\n\n/**\n * Show dialog explaining trap trigger injury.\n * @param {module:dnd/traits.Traits} enactorTraitsUnused\n * @param {module:dnd/trapCharacteristics~TrapDetails} trapDetailsUnused\n * @param {string} trapDescription\n */\nexport function showInjuredByTrap(\n  enactorTraitsUnused,\n  trapDetailsUnused,\n  trapDescription\n) {\n  return UI.showElementOkDialog(\n    i18n`DIALOG TITLE TRAP TRIGGERED INJURED`,\n    createTrapElement(trapDescription, i18n`MESSAGE TRAP TRIGGERED INJURED`)\n  );\n}\n\n/**\n * Show dialog explaining trap trigger injury.\n * @param {module:dnd/traits.Traits} enactorTraitsUnused\n * @param {module:dnd/trapCharacteristics~TrapDetails} trapDetailsUnused\n * @param {string} trapDescriptionUnused\n */\nexport function showDisableSuccess(\n  enactorTraitsUnused,\n  trapDetailsUnused,\n  trapDescriptionUnused\n) {\n  return UI.showOkDialog(\n    i18n`DIALOG TITLE TRAP DISABLED`,\n    createTrapElement(i18n`MESSAGE TRAP DISABLED`)\n  );\n}\n\n/**\n * Create an element to describe trap and action.\n * @param {string} trapDescription\n * @param {string} message\n * @returns {Element}\n */\nfunction createTrapElement(trapDescription, message) {\n  const container = document.createElement('div');\n  const description = document.createElement('p');\n  description.innerText = trapDescription;\n  container.appendChild(description);\n\n  const messageEl = document.createElement('p');\n  messageEl.innerText = message;\n  container.appendChild(messageEl);\n  return container;\n}\n","/**\n * @file Money portal dialog\n *\n * @module dialogs/moneyPortalDialog\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport UI from '../utils/dom/ui.js';\nimport LOG from '../utils/logging.js';\nimport { i18n } from '../utils/messageManager.js';\n\n/**\n * Allow actor to transfer money through portal\n * @param {module:players/actors.Actor} actor\n * @returns {Promise<number>} fulfils amount of gold transferred.\n */\nexport function showMoneyPortalDialog(actor) {\n  const storeManager = actor.storeManager;\n  if (!storeManager) {\n    LOG.error('Actor with no storeManager is trying to use a gold portal.');\n  }\n  const gold = Math.floor(storeManager.getPurseValue());\n  if (gold < 1) {\n    return UI.showOkDialog(i18n`MESSAGE GOLD_PORTAL - INSUFFICIENT GOLD`).then(\n      () => 0\n    );\n  }\n\n  const labels = ['0%'];\n  const transfers = [0];\n  for (const percent of [25, 50, 75, 100]) {\n    const transferValue = Math.round((gold * percent) / 100);\n    if (transferValue > 0) {\n      labels.push(`${percent}%`);\n      transfers.push(transferValue);\n    }\n  }\n\n  return UI.showChoiceDialog(\n    i18n`DIALOG TITLE GOLD_PORTAL`,\n    i18n`MESSAGE GOLD_PORTAL - EXPLAIN`,\n    labels\n  )\n    .then((choice) => {\n      const transferValue = transfers[choice];\n      if (transferValue) {\n        let transferredGold = actor.traits.getInt('GOLD_SENT', 0);\n        transferredGold += transferValue;\n        actor.traits.set('GOLD_SENT', transferredGold);\n      }\n      return transferValue;\n    })\n    .then((transferValue) => {\n      if (transferValue) {\n        storeManager.takeFromPurse(transferValue);\n        return UI.showOkDialog(\n          i18n`MESSAGE GOLD_PORTAL - EXPLAIN CLOSURE ${transferValue}`\n        ).then(() => transferValue);\n      } else {\n        return 0;\n      }\n    });\n}\n","/**\n * @file Support for emojis, especially as sprites.\n *\n * @module utils/text/emojis\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport LOG from '../logging.js';\n\nexport const Emojis = {\n  GRINNING: '',\n  SANTA: '',\n  SHAKING: '\\u{1FAE8}',\n};\n\n/**\n * Check to see if the emojis are supported. Any emoji which fails to render,\n * is replaced by a number in square brackets. Note that the function just checks the centre\n * pixel so it may fail in some situations and think that a valid emoji has not\n * rendered.\n * @param {CanvasRenderingContext2D} context\n */\nexport function checkEmojis(context) {\n  let fallbackIndex = 0;\n  for (const key in Emojis) {\n    const metrics = context.measureText(Emojis[key]);\n    const height =\n      metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent;\n    const centreToBaseLine = 0.5 * height - metrics.fontBoundingBoxDescent;\n    context.fillText(Emojis[key], -0.5 * metrics.width, centreToBaseLine);\n    const alphaAtCentre = context.getImageData(0, 0, 1, 1).data[3];\n    if (alphaAtCentre <= 0) {\n      LOG.debug(`Emoji ${key} not supported.`);\n      Emojis[key] = `[${fallbackIndex++}]`;\n    }\n    context.clearRect(0, 0, metrics.width, height);\n  }\n}\n","/**\n * @file Functions to allow touch and mouse handling.\n *\n * @module utils/dom/pointerActions\n */\n/**\n * License {@link https://opensource.org/license/mit/|MIT}\n *\n * Copyright 2024 Steve Butler\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nimport LOG from '../logging.js';\nimport { Point } from '../geometry.js';\n\n/**\n * Custom event names\n */\nexport const CUSTOM_POINTER_DOWN_EVENT_NAME = 'custom-pointer-down-event';\nexport const CUSTOM_POINTER_UP_EVENT_NAME = 'custom-pointer-up-event';\nexport const CUSTOM_POINTER_CANCEL_EVENT_NAME = 'custom-pointer-cancel-event';\nexport const CUSTOM_CLICK_EVENT_NAME = 'custom-click-event';\nexport const CUSTOM_CONTEXT_MENU_EVENT_NAME = 'custom-context-click-event';\nexport const CUSTOM_POINTER_DRAG_EVENT_NAME = 'custom-pointer-drag-event';\nexport const CUSTOM_POINTER_DRAG_END_EVENT_NAME =\n  'custom-pointer-drag-end-event';\n\n/** Minimum movement that constitutes a drag. */\nconst MIN_DRAG_MOVEMENT = 10;\n\n/** @enum {number} */\nconst EventSource = {\n  MOUSE: 0,\n  TOUCH: 1,\n};\n\n/**\n * @typedef {Object} CustomEventDetail\n * @property {number} x\n * @property {number} y\n * @property {number} dx\n * @property {number} dy\n */\n\n/**\n * @typedef {Object} DragData\n * @param {ELement} element\n * @property {boolean} actionStarted\n * @property {boolean} dragging\n * @property {number} lastX\n * @property {number} lastY\n * @property {number} startX\n * @property {number} startY\n * @property {number} x\n * @property {number} y\n * @property {Point} lastTouchStartPoint\n * @property {boolean} suppressClickEvent\n */\n\n/**\n * Dispatch an event. Detail is dispatched in the event detail.\n * @param {Element} element\n * @param {string} eventName\n * @param {Object} detail\n */\nfunction dispatchEvent(element, eventName, detail) {\n  const event = new CustomEvent(eventName, {\n    detail: detail,\n  });\n  element.dispatchEvent(event);\n}\n\n/**\n * Gets offsetX and offsetY equivalent to a MouseEvent\n * @param {TouchEvent} event\n * @returns {Object}\n */\nfunction getOffsetFromTouch(event) {\n  const rect = event.target.getBoundingClientRect();\n  return {\n    x: event.touches[0].pageX - rect.left,\n    y: event.touches[0].pageY - rect.top,\n  };\n}\n\n/**\n * Process the start of the action.\n * @param {number} eventSource\n * @param {number} x - x coordinate relative to target\n * @param {number} y - y coordinate relative to target\n * @param {DragData} data\n */\nfunction processStartAction(eventSource, x, y, data) {\n  data.actionStarted = true;\n  data.dragging = false;\n  data.distance = 0;\n  data.lastX = x;\n  data.lastY = y;\n  data.startX = x;\n  data.startY = y;\n  dispatchEvent(data.element, CUSTOM_POINTER_DOWN_EVENT_NAME, {\n    x: x,\n    y: y,\n  });\n}\n\n/**\n * Process the start of the action.\n * @param {number} eventSource\n * @param {number} x - x coordinate relative to target\n * @param {number} y - y coordinate relative to target\n * @param {DragData} data\n */\nfunction processEndAction(eventSource, x, y, data) {\n  const eventName = data.dragging\n    ? CUSTOM_POINTER_DRAG_END_EVENT_NAME\n    : CUSTOM_POINTER_UP_EVENT_NAME;\n\n  data.actionStarted = false;\n  data.dragging = false;\n  data.distance = 0;\n  data.lastX = x;\n  data.lastY = y;\n  data.startX = x;\n  data.startY = y;\n  dispatchEvent(data.element, eventName, {\n    x: x,\n    y: y,\n  });\n}\n\n/**\n * Process the start of the action.\n * @param {number} eventSource\n * @param {number} x - x coordinate relative to target\n * @param {number} y - y coordinate relative to target\n * @param {DragData} data\n */\nfunction processCancelAction(eventSource, x, y, data) {\n  const eventName = CUSTOM_POINTER_CANCEL_EVENT_NAME;\n\n  data.actionStarted = false;\n  data.dragging = false;\n  data.distance = 0;\n  data.lastX = x;\n  data.lastY = y;\n  data.startX = x;\n  data.startY = y;\n  dispatchEvent(data.element, eventName, {\n    x: x,\n    y: y,\n  });\n}\n\n/**\n * Process the start of the action.\n * @param {number} eventSource\n * @param {number} x - x coordinate relative to target\n * @param {number} y - y coordinate relative to target\n * @param {DragData} data\n * @return {CustomEvent} null if no event should be dispatched.\n */\nfunction processMoveAction(eventSource, x, y, data) {\n  const eventName = CUSTOM_POINTER_DRAG_EVENT_NAME;\n  let dx = x - data.lastX;\n  let dy = y - data.lastY;\n  data.lastX = x;\n  data.lastY = y;\n  if (data.dragging) {\n    const event = new CustomEvent(eventName, {\n      detail: {\n        x: x,\n        y: y,\n        dx: dx,\n        dy: dy,\n      },\n    });\n    data.element.dispatchEvent(event);\n  } else if (\n    Math.abs(x - data.startX) > MIN_DRAG_MOVEMENT ||\n    Math.abs(y - data.startY) > MIN_DRAG_MOVEMENT\n  ) {\n    data.dragging = true;\n    data.suppressClickEvent = true;\n  }\n}\n\n/**\n * Add custom listeners which allows an object to listen to touch and mouse events\n * in a consistent manner.\n * the element or clicks. Custom events are sent to differentiate.\n * @param {*} element\n */\nexport function addPointerListeners(element) {\n  let dragData = {\n    element: element,\n    actionStarted: false,\n    dragging: false,\n    x: 0,\n    y: 0,\n    lastTouchStartPoint: null,\n    suppressClickEvent: false,\n  };\n\n  element.addEventListener(\n    'mousedown',\n    (event) => {\n      return processStartAction(\n        EventSource.MOUSE,\n        event.offsetX,\n        event.offsetY,\n        dragData\n      );\n    },\n    { passive: true }\n  );\n\n  element.addEventListener(\n    'mouseup',\n    (event) => {\n      return processEndAction(\n        EventSource.MOUSE,\n        event.offsetX,\n        event.offsetY,\n        dragData\n      );\n    },\n    { passive: true }\n  );\n  element.addEventListener(\n    'mousemove',\n    (event) => {\n      if (event.buttons & 1) {\n        processMoveAction(\n          EventSource.MOUSE,\n          event.offsetX,\n          event.offsetY,\n          dragData\n        );\n      }\n    },\n    { passive: true }\n  );\n  element.addEventListener(\n    'touchstart',\n    (event) => {\n      if (event.changedTouches.length === 1) {\n        const offset = getOffsetFromTouch(event);\n        dragData.lastTouchStartPoint = new Point(offset.x, offset.y);\n        processStartAction(EventSource.TOUCH, offset.x, offset.y, dragData);\n      }\n    },\n    { passive: true }\n  );\n  element.addEventListener(\n    'touchend',\n    (event) => {\n      if (event.changedTouches.length === 1) {\n        processEndAction(\n          EventSource.TOUCH,\n          dragData.lastTouchStartPoint?.x,\n          dragData.lastTouchStartPoint?.y,\n          dragData\n        );\n      }\n      dragData.lastTouchStartPoint = null;\n      dragData.suppressClickEvent = false;\n    },\n    { passive: true }\n  );\n  element.addEventListener(\n    'touchmove',\n    (event) => {\n      if (event.changedTouches.length === 1) {\n        const offset = getOffsetFromTouch(event);\n        processMoveAction(EventSource.TOUCH, offset.x, offset.y, dragData);\n        dragData.suppressClickEvent = true;\n      }\n    },\n    { passive: true }\n  );\n  element.addEventListener(\n    'touchcancel',\n    (eventUnused) => {\n      processCancelAction(\n        EventSource.TOUCH,\n        dragData.lastTouchStartPoint?.x,\n        dragData.lastTouchStartPoint?.y,\n        dragData\n      );\n      dragData.lastTouchStartPoint = null;\n    },\n\n    { passive: true }\n  );\n  element.addEventListener('click', (event) => {\n    LOG.debug('click');\n    if (!dragData.suppressClickEvent) {\n      dispatchEvent(element, CUSTOM_CLICK_EVENT_NAME, {\n        x: event.offsetX,\n        y: event.offsetY,\n      });\n    }\n    dragData.suppressClickEvent = false;\n  });\n  element.addEventListener('contextmenu', (event) => {\n    event.preventDefault();\n    dispatchEvent(element, CUSTOM_CONTEXT_MENU_EVENT_NAME, {\n      x: event.offsetX,\n      y: event.offsetY,\n    });\n  });\n}\n","/**\n * @file Messages used in the application.\n *\n * @module constants/messages\n */\n/**\n * license {@link https://opensource.org/license/mit/|MIT}\n * Copyright 2024 Steve Butler (henspace.com).\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the Software), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\nconst MESSAGE_MAP = new Map([\n  ['BUTTON ABOUT', 'About'],\n  ['BUTTON BUY FOR GP', 'Buy for ${0}\\u{00A0}GP'],\n  ['BUTTON CANCEL', 'Cancel'],\n  ['BUTTON CAST SPELL', 'Cast spell'],\n  ['BUTTON DELETE MEMORY', 'Delete memory'],\n  ['BUTTON CONSUME', 'Consume'],\n  ['BUTTON CONTINUE', 'Continue'],\n  ['BUTTON CONTINUE ADVENTURE', 'Continue adventure'],\n  ['BUTTON CLIMB OVER', 'Climb over'],\n  ['BUTTON BARGE', 'Barge past'],\n  ['BUTTON HALL OF FAME', 'Hall of fame'],\n  ['BUTTON DELETE', 'DELETE!'],\n  ['BUTTON DISCARD', 'Discard'],\n  ['BUTTON DO NOT SHOW AGAIN', 'Do not show again'],\n  ['BUTTON ENTER DUNGEON', 'Enter if you dare'],\n  ['BUTTON EQUIP', 'Equip'],\n  ['BUTTON FORGET', 'Forget'],\n  ['BUTTON GUIDES', 'About and Help'],\n  ['BUTTON HELP', 'Help'],\n  ['BUTTON INVENTORY', 'Inventory'],\n  ['BUTTON LEARN SPELL', 'Learn spell'],\n  ['BUTTON LEAVE ARTEFACT', 'Leave'],\n  ['BUTTON LEAVE IT', 'Leave it'],\n  ['BUTTON MAGIC', 'Magic'],\n  ['BUTTON MAIN MENU', 'Main menu'],\n  ['BUTTON MOVE', 'Move'],\n  ['BUTTON OK', 'OK'],\n  ['BUTTON PILLAGE', 'Stash'],\n  ['BUTTON PLAY ADVENTURE', 'Start adventure'],\n  ['BUTTON PLAY CASUAL', 'Casual exploration'],\n  ['BUTTON PRIVACY', 'Privacy'],\n  ['BUTTON PREPARE SPELL', 'Prepare'],\n  ['BUTTON REST', 'Rest'],\n  ['BUTTON REST LONG', 'Long rest'],\n  ['BUTTON READY MAGIC', 'Ready Magic'],\n  ['BUTTON REST SHORT', 'Short rest'],\n  ['BUTTON SEARCH', 'Search'],\n  ['BUTTON SELL FOR GP', 'Sell for ${0}\\u{00A0}GP'],\n  ['BUTTON SETTINGS', 'Settings'],\n  ['BUTTON SHOW DEBUG LOG', 'The chronicles of DeBuggle Logitall'],\n  ['BUTTON START', \"Let's get started.\"],\n  ['BUTTON STASH', 'Stash'],\n  ['BUTTON STEAL', 'Steal'],\n  ['BUTTON TRAP DISABLE', 'Try to disable'],\n  ['BUTTON TRAP LEAVE', 'Leave it alone'],\n  ['BUTTON TAKE ARTEFACT', 'Stash'],\n  ['BUTTON TRADE', 'Trade'],\n  ['BUTTON TRAITS', 'Traits'],\n  ['BUTTON TRY AGAIN', 'Try again'],\n  ['BUTTON TRY TO PICK', 'Pick lock'],\n\n  ['BUTTON USE', 'Use'],\n\n  ['CONTROL DO NOT SCALE', 'Maximum scale 1:1'],\n  ['CONTROL EFFECTS VOLUME', 'Effects volume'],\n  ['CONTROL MUSIC VOLUME', 'Music volume'],\n  ['CONTROL SHOW QUICK TIPS', 'Show quick tips'],\n  ['CONTROL RUN FULLSCREEN', 'Run fullscreen'],\n  [\n    'DESCRIPTION ACID_SPLASH',\n    'You hurl a bubble of acid over up to two creatures within your touch.',\n  ],\n  [\n    'DESCRIPTION ACID_ARROW',\n    'You send out a shimmering green arrow that bursts into a spray of acid on impact.',\n  ],\n  [\n    'DESCRIPTION AMBER',\n    'Precious fossilized tree resin, which is much sought after in these realms.',\n  ],\n  [\n    'DESCRIPTION ARCANE_ORB',\n    'Orb used by some users of magic to focus their spells.',\n  ],\n  [\n    'DESCRIPTION ARCANE_SWORD',\n    'You create a sword-shaped plane of energy that hovers over your target and initiates a melee spell attack.',\n  ],\n  ['DESCRIPTION AQUAMARINE', 'A precious crystal of rare beauty.'],\n  [\n    'DESCRIPTION BARBARIAN1',\n    'You are a barbarian ready to battle to the end of this dungeon in search of wealth and glory.',\n  ],\n  ['DESCRIPTION BATTLEAXE', 'A mighty battleaxe.'],\n  [\n    'DESCRIPTION BELT_OF_STRENGTH',\n    'A rare belt, originally crafted by dwarves and significantly increasing the strength of the wearer.',\n  ],\n  ['DESCRIPTION BERSERKER', 'A hate crazed berserker.'],\n  [\n    'DESCRIPTION BLACK_FLASK',\n    'A black flask containing a clear, pungent liquid.',\n  ],\n  [\n    'DESCRIPTION BLACK_FLASK?POTION_OF_FLYING',\n    'A black flask containing a clear, pungent potion that allows the user to hover temporarily above the ground.',\n  ],\n  [\n    'DESCRIPTION BLACK_FLASK?SERPENT_VENOM',\n    'A black flask containing a clear, pungent poison.',\n  ],\n  [\n    'DESCRIPTION BLADE_BARRIER',\n    'You create a whirling ringed-wall of spinning blades.',\n  ],\n  [\n    'DESCRIPTION BLIGHT',\n    'You cause necromantic energy to flow over a creature, draining moisture and vitality from it. The spell does not work on the undead.',\n  ],\n  [\n    'DESCRIPTION BUGBEAR',\n    'A ferocious humanoid and evil creature bent on mayhem and carnage.',\n  ],\n  [\n    'DESCRIPTION BURNING_HANDS',\n    'Casting this spell with your thumbs touching and fingers spread creates a thin sheet of flames enveloping your enemies.',\n  ],\n  [\n    'DESCRIPTION CHAIN_MAIL_ARMOUR',\n    'Armour comprising interlocking steel rings over a soft cushioning fabric. The suit includes gauntlets.',\n  ],\n  [\n    'DESCRIPTION CHILL_TOUCH',\n    'You create a ghostly skeletal hand on a creature you can touch and assail it with the chill of the grave.',\n  ],\n  [\n    'DESCRIPTION CIRCLE_OF_DEATH',\n    'You create a sphere of negative energy that ripples out around you.',\n  ],\n  [\n    'DESCRIPTION CLERIC1',\n    'You are a powerful cleric who can act as a conduit between divine powers and the mortal world.',\n  ],\n  ['DESCRIPTION CLUB', \"A simple wooden club that's seen a lot of action.\"],\n  [\n    'DESCRIPTION COINS',\n    'Various coins stamped with the image of latter day kings and queens.',\n  ],\n  [\n    'DESCRIPTION CONE_OF_COLD',\n    'You create a blast of cold air that erupts from your hands.',\n  ],\n  ['DESCRIPTION COPPER_COINS', 'Old copper coins of low value.'],\n  [\n    'DESCRIPTION COPPER_DRAGON_WYRMLING',\n    'A very young copper dragon. Young, but capable of inflicting serious damage with its bite and claws.',\n  ],\n  [\n    'DESCRIPTION CREATE_FOOD_AND_WATER',\n    'You conjure some food and water to create up to three meals. You need space in your backpack to store the meals.',\n  ],\n  [\n    'DESCRIPTION CURE_MY_WOUNDS',\n    'You cast a spell allowing you to cure some of your wounds',\n  ],\n  ['DESCRIPTION DAGGER', 'A short and very sharp piercing weapon.'],\n  [\n    'DESCRIPTION DETECT_POISON',\n    'You perform a ritual to identify any poisons or unidentified items in your backpack.',\n  ],\n  ['DESCRIPTION DIAMOND', 'A valuable and rare crystal.'],\n  ['DESCRIPTION DRETCH', 'The lowest and least respected of all demons.'],\n  [\n    'DESCRIPTION EARTHQUAKE',\n    'You create a seismic disturbance causing an intense tremor to rip through the ground.',\n  ],\n  [\n    'DESCRIPTION ENCHANTED_BATTLEAXE',\n    'A mighty battleaxe. This magical weapon increases the likelihood and severity of damage.',\n  ],\n  [\n    'DESCRIPTION ENCHANTED_GREATAXE',\n    'A heavy two-handed axe capable of inflicting severe wounds when in the right hands. This magical weapon increases the likelihood and severity of damage.',\n  ],\n  [\n    'DESCRIPTION ENCHANTED_GREATSWORD',\n    'A two-handed massive sword inflicting serious slashing damage. This magical weapon increases the likelihood and severity of damage.',\n  ],\n  [\n    'DESCRIPTION ENCHANTED_HANDAXE',\n    'A small, light axe. This magical weapon increases the likelihood and severity of damage.',\n  ],\n  [\n    'DESCRIPTION ENCHANTED_SHORTSWORD',\n    'A light and highly versatile sword. This magical weapon increases the likelihood and severity of damage.',\n  ],\n  [\n    'DESCRIPTION ENGRAVED_PILLAR',\n    'A large stone pillar covered with mystical engravings.',\n  ],\n  [\n    'DESCRIPTION FETID_WATER',\n    'A fetid, murky film of liquid covering the dungeon flagstones.',\n  ],\n\n  [\n    'DESCRIPTION FIGHTER1',\n    \"You are a fighter whose family have fallen out of favour. This is your chance to restore your family's good name.\",\n  ],\n  [\n    'DESCRIPTION FIND_TRAPS',\n    'You sense the presence of traps around you. You cannot learn the location of the traps though.',\n  ],\n  [\n    'DESCRIPTION FINGER_OF_DEATH',\n    'You send negative energy coursing through a creature you can see within range, causing it searing pain.',\n  ],\n  [\n    'DESCRIPTION FIRE_BEETLE_PV',\n    'A giant fire beetle. Glowing gland radiate a fiery light across the dungeon.',\n  ],\n  ['DESCRIPTION FIRE_BOLT', 'You hurl fire at a creature.'],\n  ['DESCRIPTION FIRE_STORM', 'You create sheets of roaring flames.'],\n  ['DESCRIPTION FLAIL', 'A fear inducing bludgeoning weapon.'],\n  [\n    'DESCRIPTION FLAME_STRIKE',\n    'You create a column of divine fire almost forty feet high.',\n  ],\n  [\n    'DESCRIPTION FUNGAL_FILM',\n    'A sticky fungal film that coats the dungeon floor. Poisonous and strength sapping',\n  ],\n  ['DESCRIPTION FUNGUS', 'A brightly coloured red and white fungus.'],\n  [\n    'DESCRIPTION FUNGUS?BERSERKER_COURAGE',\n    'Berserker courage fungus. Consumption creates a feeling of unstoppable power and provides a temporary adrenalin-fueled increase in strength.',\n  ],\n  [\n    'DESCRIPTION FUNGUS?DEATH_FLY',\n    'Death fly fungus. A poisonous fungus often confused with Berserker Courage.',\n  ],\n  ['DESCRIPTION GARGOYLE', 'A chaotic evil gargoyle.'],\n  [\n    'DESCRIPTION GIANT_WASP_PV',\n    'A gigantic wasp making a deafening buzzing sound that echoes round the dungeon.',\n  ],\n  [\n    'DESCRIPTION GOBLIN',\n    \"Small humanoid creature.Treat with caution. They're small but vicious.\",\n  ],\n\n  [\n    'DESCRIPTION GOLD_COINS',\n    'Gold coins stamped with the image of latter day kings and queens.',\n  ],\n  [\n    'DESCRIPTION GHOUL',\n    'An undead creature, living amongst the dead and dying.',\n  ],\n  [\n    'DESCRIPTION GOLD_PORTAL',\n    'A magical dwarven portal used for transporting gold and platinum back to the surface.',\n  ],\n  [\n    'DESCRIPTION GREATAXE',\n    'A heavy two-handed axe capable of inflicting severe wounds when in the right hands.',\n  ],\n  [\n    'DESCRIPTION GREATSWORD',\n    'A two-handed massive sword inflicting serious slashing damage.',\n  ],\n\n  [\n    'DESCRIPTION HALF_PLATE_ARMOUR',\n    'Shaped metal plates covering most of the body. Simple greaves protect the legs.',\n  ],\n  [\n    'DESCRIPTION HANDAXE',\n    'A small, light axe. The blade is sharp and has been looked after with care.',\n  ],\n  ['DESCRIPTION HELMET', 'A simple steel helmet'],\n  [\n    'DESCRIPTION HELMET_OF_OGRE_POWER',\n    'A magical steel helmet offering the normal protection of a steel helmet along with a massive increase in strength.',\n  ],\n\n  ['DESCRIPTION HIDDEN_ARTEFACT', 'The ground appears to have been disturbed.'],\n  [\n    'DESCRIPTION HUNTING_TRAP',\n    'A old battered hunting trap designed for catching monsters and humans.',\n  ],\n  [\n    'DESCRIPTION ICE_STORM',\n    'You cause a hail of rock-hard ice to pound to the ground around you.',\n  ],\n  [\n    'DESCRIPTION INCENDIARY_CLOUD',\n    'You create a swirling cloud of smoke shot through with white hot embers.',\n  ],\n  [\n    'DESCRIPTION INFLICT_WOUNDS',\n    'You make a melee spell attack against a creature you can touch to inflict necrotic damage.',\n  ],\n  [\n    'DESCRIPTION IRON_RATIONS',\n    'Simple emergency rations. Crucial for resting between floors.',\n  ],\n  ['DESCRIPTION KOBOLD', 'A small reptilian humanoid.'],\n  [\n    'DESCRIPTION LEATHER_ARMOUR',\n    'Simple armour comprising stiffened leather boiled in oil along with some more flexible sections.',\n  ],\n\n  ['DESCRIPTION LICHEN', 'A type of lichen that grows between the flagstones.'],\n  [\n    'DESCRIPTION LICHEN?DRAGON_SCALE_LICHEN',\n    \"Dragon scale lichen. A green lichen, much sought after by explorers because of it's legendary health benefits.\",\n  ],\n  [\n    'DESCRIPTION LICHEN?LIZARD_SKIN_LICHEN',\n    'Lizard skin lichen. A green lichen, closely related to dragon scale lichen, but mildly poisonous.',\n  ],\n  [\n    'DESCRIPTION LIGHTNING_BOLT',\n    \"You create a stroke of lightning that shoots out from you hitting all creatures in it's path.\",\n  ],\n  ['DESCRIPTION LOCK_PICK', 'Set of lock picks.'],\n  ['DESCRIPTION LUTE', 'A beautiful lute in remarkable condition.'],\n  [\n    'DESCRIPTION MANHOLE_COVER',\n    'A small manhole cover set into the dungeon floor.',\n  ],\n  ['DESCRIPTION MEAT', 'A joint of some type of meat.'],\n  [\n    'DESCRIPTION MEAT?HAM',\n    'A joint of meat which can be used as a meal while you rest between floors.',\n  ],\n  [\n    'DESCRIPTION MEAT?POISON_LIZARD',\n    'A hunk of meat from a dungeon lizard. This is toxic to humans.',\n  ],\n  [\n    'DESCRIPTION MEAT?ROTTING',\n    \"A joint of meat, but it looks and smells like it is well past it's best.\",\n  ],\n\n  ['DESCRIPTION OGRE', 'A large and incredibly strong ogre.'],\n  ['DESCRIPTION ORC', 'A monstrous creature with an intense hatred of humans.'],\n  ['DESCRIPTION ORC_SKULL', 'An old and slightly cracked skull from a orc.'],\n  ['DESCRIPTION PADDED_ARMOUR', 'Simple quilted layers of cloth and batting.'],\n  [\n    'DESCRIPTION PLATE_ARMOUR',\n    'Full plate armour with interlocking steel plates covering the entire body. A visored helmet, gauntlets, boots, and padding are included.',\n  ],\n  ['DESCRIPTION PLATINUM_COINS', 'Highly valued large platinum coins.'],\n\n  [\n    'DESCRIPTION POISON_SPRAY',\n    'You extend your hand toward your enemy and project a puff of noxious gas.',\n  ],\n  [\n    'DESCRIPTION POISONERS_KIT',\n    'A kit of vials of poisons and other toxic materials.',\n  ],\n  [\n    'DESCRIPTION POWER_WORD_KILL',\n    'You utter a word of power that compels a creature to die instantly.',\n  ],\n  [\n    'DESCRIPTION POTION_OF_HEALING',\n    \"An aromatic potion, treasured for it's health restoration properties.\",\n  ],\n  ['DESCRIPTION PURPLE_PLANT', 'A small herb with a purple flower.'],\n  [\n    'DESCRIPTION PURPLE_PLANT?DRAGON_WORT',\n    \"Purple dragon wort. Renowned for it's health giving properties.\",\n  ],\n  [\n    'DESCRIPTION PURPLE_PLANT?FALSUS_DRAGON_WORT',\n    'Falsus dragon wort. Mimicking the medicinal dragon wort herb, this plant is highly toxic.',\n  ],\n  [\n    'DESCRIPTION QUARTERSTAFF',\n    'A large quarterstaff capable of causing significant damage in the right hands.',\n  ],\n  ['DESCRIPTION QUARTZ', 'A precious crystal.'],\n  ['DESCRIPTION RAT_PV', 'A giant rat, diseased and vicious.'],\n  [\n    'DESCRIPTION RANGER1',\n    'You are a ranger who is more at one with the forest. The dungeon is not your natural realm, but you are ready to take it on.',\n  ],\n  [\n    'DESCRIPTION RESTORATIVE_OINTMENT',\n    'An ointment that can be rubbed into the skin or eaten to improve health and neutralise any poisons.',\n  ],\n  [\n    'DESCRIPTION RING_MAIL_ARMOUR',\n    'Leather armour reinforced with heavy steel rings sown into the material.',\n  ],\n  [\n    'DESCRIPTION RING_OF_CHARISMA',\n    'A magical ring that increases the charisma of the wearer.',\n  ],\n\n  [\n    'DESCRIPTION RING_OF_CONSTITUTION',\n    'A magical ring that increases the constitution of the wearer.',\n  ],\n  [\n    'DESCRIPTION RING_OF_DEXTERITY',\n    'A magical ring that increases the dexterity of the wearer.',\n  ],\n  [\n    'DESCRIPTION RING_OF_INTELLIGENCE',\n    'A magical ring that increases the intelligence of the wearer.',\n  ],\n  [\n    'DESCRIPTION RING_OF_STRENGTH',\n    'A magical ring that increases the strength of the wearer.',\n  ],\n  [\n    'DESCRIPTION RING_OF_WISDOM',\n    'A magical ring that increases the wisdom of the wearer.',\n  ],\n  [\n    'DESCRIPTION ROGUE1',\n    'You are a rogue whose slippery character may help you creep your way through the depths of this dark and unforgiving dungeon.',\n  ],\n  [\n    'DESCRIPTION RUSTY_KEY',\n    \"A large iron key, covered in rust. It's been lost a long time.\",\n  ],\n  [\n    'DESCRIPTION SCALE_MAIL_ARMOUR',\n    'Leather coat and legging covered with overlapping steel scales.',\n  ],\n  ['DESCRIPTION SHADOW', 'An undead shadow creature, hiding in the darkness.'],\n  [\n    'DESCRIPTION SHATTER',\n    'You create a sudden loud ringing noise, painfully intense, that inflicts thunder damage on a creature.',\n  ],\n  [\n    'DESCRIPTION SHIELD',\n    'A wooden shield, carried in one hand and offering some protection.',\n  ],\n  [\n    'DESCRIPTION SHOCKING_GRASP',\n    'You create lightning which springs from your hands, delivering a massive shock to a creature within touching distance.',\n  ],\n  ['DESCRIPTION SHORTSWORD', 'A light and highly versatile sword.'],\n  [\n    'DESCRIPTION SILVER_COINS',\n    'Silver coins, worn and tarnished but still of value.',\n  ],\n  [\n    'DESCRIPTION SKELETON',\n    \"A skeleton of someone who died here many years ago. It's intent on revenge.\",\n  ],\n  ['DESCRIPTION SLIME', 'A green sticky substance that seems to be growing.'],\n  [\n    'DESCRIPTION SPARE_ME',\n    'You use your knowledge of necromancy to raise your health if you are nearly dying.',\n  ],\n  ['DESCRIPTION SPIDER_PV', 'A giant spider with fangs dripping green venom.'],\n  [\n    'DESCRIPTION SPIKES',\n    \"It's a trap. Sharp iron spikes shoot up from the ground.\",\n  ],\n  [\n    'DESCRIPTION STIRGE',\n    'A blood-sucking cross between a giant mosquito and a blood curdling bat.',\n  ],\n  [\n    'DESCRIPTION ENHANCE_ABILITY_AS_BULL',\n    'You bestow upon yourself a temporary increase in your strength.',\n  ],\n  [\n    'DESCRIPTION STUDDED_LEATHER_ARMOUR',\n    'Tough and flexible leather armour with the addition of steel spikes and rivets.',\n  ],\n  ['DESCRIPTION TIGER_EYE', 'A precious gemstone'],\n  [\n    'DESCRIPTION TOMB_OF_ELDER',\n    'A large ancient shrine. It appears to be stone but with a magical gold lustre.',\n  ],\n  [\n    'DESCRIPTION TRADER1',\n    'A wandering trader selling all manner of things gathered during many months in the dungeon.',\n  ],\n  [\n    'DESCRIPTION TRADER2',\n    'A wandering trader with a wagon stacked high with a variety of artefacts found in the dungeon.',\n  ],\n  [\n    'DESCRIPTION TRAPDOOR',\n    \"A small door in the floor. You can't tell what it hides.\",\n  ],\n  [\n    'DESCRIPTION VAMPIRIC_TOUCH',\n    'You touch a shadow-wreathed hand on a creature to inflict necrotic damage. You draw upon the damage inflicted to help heal your own wounds.',\n  ],\n  [\n    'DESCRIPTION VEGETATION',\n    'A patch of vegetation managing to grow between the cracks in the flagstones.',\n  ],\n  ['DESCRIPTION VIOLET_FUNGUS', 'A moving fungus inflicting severe damage.'],\n  [\n    'DESCRIPTION WATERSKIN',\n    'A leather drinking flask with fresh water. Crucial for resting between floors.',\n  ],\n  [\n    'DESCRIPTION WARHAMMER',\n    'A bludgeoning, versatile iron hammer favoured by many clerics.',\n  ],\n  [\n    'DESCRIPTION WARLOCK1',\n    'You are a warlock, known for you great knowledge of the supernatural forces that drive the multiverse.',\n  ],\n  [\n    'DESCRIPTION WATER_WALK',\n    'You perform a ritual to allow yourself to move across any liquid surface unharmed as your feet hover an inch or two above the ground.',\n  ],\n  [\n    'DESCRIPTION WIGHT',\n    'A wight, reanimated from the corpse of a rogue fighter whose rotting body was raised by evil necromancy.',\n  ],\n  [\n    'DESCRIPTION WIZARD1',\n    'You are a wizard determined to find your way to the final level of this dungeon using your control of magical chaos.',\n  ],\n  [\n    'DESCRIPTION WRAITH',\n    'An undead, neutral evil creature with a touch of death.',\n  ],\n  ['DESCRIPTION ZOMBIE', 'An undead creature roaming the dungeon floors.'],\n  ['DIALOG TITLE DEBUG LOG', 'Chronicles of Debug Loggerman'],\n  ['DIALOG TITLE DELETE MEMORY', 'DELETE MEMORY!'],\n  ['DIALOG TITLE HALL OF FAME', 'Hall of Fame'],\n  ['DIALOG TITLE CHOICES', 'Decisions, decisions'],\n  ['DIALOG TITLE LOCKED', 'Locked'],\n  ['DIALOG TITLE GOLD_PORTAL', 'Use the gold portal'],\n  ['DIALOG TITLE PICK SPELL TO CAST', 'Pick spell to cast'],\n  ['DIALOG TITLE PILLAGE', 'Pillage corpse'],\n  ['DIALOG TITLE PREPARE SPELLS', 'Prepare spells'],\n  ['DIALOG TITLE RUNE PUZZLE', 'Where next?'],\n  ['DIALOG TITLE SETTINGS', 'Adjust settings'],\n  ['DIALOG TITLE TRADE', 'Buy and sell with trader'],\n  ['DIALOG TITLE TRAP DETECTED', 'Trap detected!'],\n  ['DIALOG TITLE TRAP DISABLED', 'Trap disabled!'],\n  ['DIALOG TITLE TRAP TRIGGERED SURVIVED', 'Trap triggered!'],\n  ['DIALOG TITLE TRAP TRIGGERED INJURED', 'Trap triggered!'],\n  ['MENU TITLE MAIN', 'Click and Crawl'],\n  ['MENU TITLE GUIDES', 'Guides and information'],\n  [\n    'MESSAGE ACHIEVEMENTS',\n    'You managed to reach floor ${0-floor} and sent back ${1}\\u{00A0}GP to the struggling townsfolk beyond these dungeon walls.',\n  ],\n  ['MESSAGE CANNOT LOAD URL', 'Cannot load data from ${0}'],\n  [\n    'MESSAGE CANNOT REST SHORT NEED LONG REST',\n    \"You've had too many short rests. You need to take a long rest first.\",\n  ],\n  [\n    'MESSAGE CANNOT REST SHORT NEED RATIONS',\n    \"You don't have enough food or drink for a short rest. One meal and one drink are required to enjoy a short rest.\",\n  ],\n  [\n    'MESSAGE CANNOT REST LONG NEED RATIONS',\n    \"You don't have enough food or drink for a long rest. Three meals and three drinks are required to enjoy a long rest.\",\n  ],\n  [\n    'MESSAGE CANNOT STASH',\n    'You need to make space in your backpack to stash this.',\n  ],\n  [\n    'MESSAGE CANNOT STORE',\n    \"You're carrying too much stuff to pick up what you've found.\",\n  ],\n  [\n    'MESSAGE CANNOT UNDERSTAND MAGIC',\n    \"There is strange magic written here, but it's beyond your comprehension.\",\n  ],\n  [\n    'MESSAGE CONFIRM DELETE MEMORY',\n    \"Are you sure you want to delete the game's memory? The Hall of Fame will be lost along with all the game settings.\",\n  ],\n  [\n    'MESSAGE CONJURED FOOD AND WATER',\n    'You conjure some food and water and stash it in your backpack.',\n  ],\n  [\n    'MESSAGE CONSUME BUT ALREADY FULL HP',\n    \"It tastes good, but you're already in prime health. Perhaps you should've waited.\",\n  ],\n  [\n    'MESSAGE CONSUME BUT NO HP GAIN',\n    'It tastes nice, but your health doesn`t improve.',\n  ],\n  [\n    'MESSAGE CURED OF TOXINS',\n    'Any poisons that may have been affecting you are now neutralised and cease to have any further effect.',\n  ],\n  [\n    'MESSAGE DEAD HERO HAS NO INVENTORY',\n    'Dead heroes have no use for material belongings. Your inventory is lost in the dungeon, perhaps to be rediscovered by the next intrepid explorer.',\n  ],\n  [\n    'MESSAGE DEFEAT',\n    \"To honour your achievements, the grateful townsfolk will add your name to a plaque in the town's Hall of Fame. Tonight the inns will be filled with songs of your heroism.\",\n  ],\n  [\n    'MESSAGE DEFEAT UNPLACED',\n    'Despite your valiant efforts, your efforts will be forgotten and no bards will sing of your exploits.',\n  ],\n  [\n    'MESSAGE DETECT POISON FAILURE',\n    'You waste your spell. There were no unidentified items in your backpack.',\n  ],\n  [\n    'MESSAGE DETECT POISON SUCCESS',\n    'You identify everything in your backpack.',\n  ],\n  [\n    'MESSAGE DUNGEON INTRO CONTINUE',\n    'Welcome back, ${0}. The adventure continues. You recognise the familiar smell of death.',\n  ],\n  [\n    'MESSAGE DUNGEON INTRO CASUAL',\n    'You enter the dungeon for a quick exploration and to check on what dangers might exist before starting a full adventure. You progress will not be saved and any achievements will be lost.',\n  ],\n  [\n    'MESSAGE ENTER FLOOR',\n    \"You enter dungeon floor ${0}. The door slams shut behind you. There's no way back. Like it or not, your only path is to continue deeper into the depths of this stone hell.\",\n  ],\n  [\n    'MESSAGE ENTRANCE STUCK',\n    [\n      \"The entrance is locked or jammed. You can't tell which, but either way, you can't escape in that direction.\",\n      \"You can't open the entrance. It seems locked or jammed. There's no way back.\",\n    ],\n  ],\n  [\n    'MESSAGE EXPLAIN SPELL PREP',\n    'After a long rest, you can prepare spells ready for use.',\n  ],\n\n  ['MESSAGE EXIT LOCKED', 'The exit is locked. There must be a key somewhere.'],\n  [\n    'MESSAGE EXPLAIN REST',\n    'Trying to use the safety of the corridor to rest and eat?',\n  ],\n  [\n    'MESSAGE EXPLAIN SPELL NEEDS REST',\n    'To use a spell you need to prepare it. Preparation can only be done between dungeon floors after a long rest.',\n  ],\n  [\n    'MESSAGE FAILED TO IDENTIFY',\n    \"You try to identify this item, but you're not sure exactly what it is. You might remember later.\",\n  ],\n  [\n    'MESSAGE FOUND HIDDEN ARTEFACT',\n    [\n      'Good fortune smiles upon you. You find something.',\n      'You find something that has been hidden or lost.',\n      'Buried beneath the surface, you find something.',\n    ],\n  ],\n  [\n    'MESSAGE FOUND ENGRAVING',\n    'You find strange words engraved on the cold stone surface.',\n  ],\n  [\n    'MESSAGE FOUND GENERIC',\n    \"It 's your lucky day. You find something that appears to have been hidden for many years.\",\n  ],\n  ['MESSAGE FX TRAITS APPLIED', 'You feel a strange effect on your abilities.'],\n  [\n    'MESSAGE GENERIC EPITAPH',\n    'Here lies the corpse of one more defeated enemy.',\n  ],\n  [\n    'MESSAGE HALL OF FAME ENTRY',\n    '${3-startDate}: ${0-name}; level ${1-level} ${2-class}; ${4-gold} GP sent; floor ${5-floor}',\n  ],\n  ['MESSAGE HERO EPITAPH FOR', 'Here lies the body of ${0}. Rest in peace.'],\n  ['MESSAGE IDENTIFIED ITEM', \"You manage to identify an item you've found.\"],\n\n  [\n    'MESSAGE INSUFFICIENT FUNDS',\n    \"You don't have enough funds to purchase this item. The item costs ${0}\\u{00A0}GP but you only have ${1}\\u{00A0}GP.\",\n  ],\n  [\"MESSAGE IT'S A HEALTHY DRINK\", 'That tastes good. +${0}HP'],\n  [\"MESSAGE IT'S HEALTHY\", 'A bit chewy, but tastes good. +${0}HP'],\n  [\n    'MESSAGE KILLED BY POISON',\n    'Yuk! Poison! You start to burn up, cough and vomit, before falling to the floor and dying.',\n  ],\n  [\"MESSAGE IT'S POISON\", \"Yuk! It's poison. -${0}HP\"],\n  [\n    'MESSAGE KEY UNLOCKS EXIT',\n    'You use the key you found earlier to unlock the door.',\n  ],\n  [\n    'MESSAGE MAKE SPACE IN BACKPACK',\n    'You need to make space in your backpack by discarding or using something.',\n  ],\n  [\n    'MESSAGE MAKE SPACE IN EQUIP',\n    \"This is too big to store. Sell or discard what you're wearing so you can wear this.\",\n  ],\n  ['MESSAGE MEMORY DELETED', 'The memory has been deleted.'],\n  [\n    'MESSAGE NO SPACE FOR CONJURED FOOD AND WATER',\n    'You conjure food and water, but it all goes to waste as you have no room left in your backpack.',\n  ],\n  [\n    'MESSAGE NO SPACE FOR ALL CONJURED FOOD AND WATER',\n    'You conjure food and water, but some of it goes to waste as you have no room left in your backpack.',\n  ],\n  [\n    'MESSAGE GOLD_PORTAL - EXPLAIN',\n    'This old dwarven gold portal can be used to transfer gold to help the desperate townsfolk who are struggling above ground. Choose how much gold you want to send.',\n  ],\n  [\n    'MESSAGE GOLD_PORTAL - EXPLAIN CLOSURE',\n    'You add ${0-gold}\\u{00A0}GP to the portal. Dwarven portals remain open until they can no longer detect the presence of the opener. To prevent gold staying locked in the portal, you will need to exit the room or die to allow the portal to close.',\n  ],\n  [\n    'MESSAGE GOLD_PORTAL - INSUFFICIENT GOLD',\n    \"You don't have enough gold for the portal. Copper and silver cannot be sent via the portal.\",\n  ],\n  [\n    'MESSAGE NEED LOCK PICK',\n    \"You can't pick a lock without a set of lock picks.\",\n  ],\n  [\n    'MESSAGE NO CASTING POWER LEFT',\n    \"You don't have enough casting power left to cast this spell. You will need to take a long rest to recover your energy.\",\n  ],\n  ['MESSAGE NO SAVED ADVENTURE', 'No adventure has been saved yet.'],\n  ['MESSAGE NOTHING HERE', \"There's nothing here.\"],\n\n  [\n    'MESSAGE NOTHING MORE TO DISCOVER',\n    \"There's nothing more for you to learn or discover here.\",\n  ],\n  [\n    'MESSAGE REQUIRES RESTART',\n    'Change will take place when the game is next reloaded.',\n  ],\n  [\n    'MESSAGE RESISTED POISON',\n    \"Yuk! It's poisonous, but you resist its toxic effects.\",\n  ],\n  [\n    'MESSAGE REST DIALOG',\n    \"You're at the top of a dark staircase leading even deeper down to floor ${0-floor}. You're safe for now. If you have enough food and drink, you can rest to recuperate, but if you don't need to recover, save your rations.\",\n  ],\n  [\n    'MESSAGE REST LONG HP GAIN',\n    'Your long rest recovered ${0} HP. You are also now cured of the toxic effects of any poisons you may have encountered.',\n  ],\n\n  [\n    'MESSAGE REST SHORT HP GAIN',\n    'Your short rest recovered ${0} HP and gave you time to rid your body of any poisons.',\n  ],\n  ['MESSAGE ROUTE CHOICE - EASY', 'You choose the easier route.'],\n  ['MESSAGE ROUTE CHOICE - MEDIUM', 'You choose the harder route.'],\n  [\n    'MESSAGE RUNES ON WALL',\n    \"At the bottom of the stairs there are two doors. There's an ancient inscription on wall.\",\n  ],\n  [\n    'MESSAGE RUNES OVER DOORS',\n    'Above each door is a shorter inscription carved into the arch. You need to choose your path.',\n  ],\n  [\n    'MESSAGE SEARCH CORPSE OR MOVE',\n    [\n      'You have a choice. Do you want to search the body or climb on top?',\n      'You find a corpse, but what should you do? Search for weapons and treasure or climb on top of the body?',\n    ],\n  ],\n  [\n    'MESSAGE SEARCH HOLE OR MOVE',\n    [\n      'You have a choice. Do you want to search this hole or move into it?',\n      \"You've been here before. Do you want to search again or climb into the hole you dug?\",\n    ],\n  ],\n  [\n    'MESSAGE SEARCH OR MOVE',\n    'You have a choice. Do you want to search this tile or move onto it?',\n  ],\n\n  [\n    'MESSAGE SPELL ALREADY KNOWN',\n    'You find a spell, but you already know this incantation.',\n  ],\n  [\n    'MESSAGE STOLE GOLD',\n    \"Success. You pick the trader's pocket undetected and steal ${0} gold coins.\",\n  ],\n  [\n    'MESSAGE TRADE STEAL OR BARGE',\n    'Do you want to trade or barge past this guy?',\n  ],\n  [\n    'MESSAGE TRADER ATTACKS BACK',\n    'The angry trader detects your clumsy attempt at robbery and strikes back at you.',\n  ],\n  ['MESSAGE TRADER CANNOT STASH', 'The trader has no space for this.'],\n  [\n    'MESSAGE TRADER WILL NOT TRADE',\n    'The trader has had enough of your trickery and will not trade with you.',\n  ],\n  [\n    'MESSAGE TRADERS PROTECTED',\n    'Traders are protected from attack under the ancient law for the protection of travelling merchants.',\n  ],\n  [\n    'MESSAGE TRAP ATTEMPT DISABLE',\n    \"You find a trap. You can't tell what it is though. Do you want to try to disable it?\",\n  ],\n  [\n    'MESSAGE TRAP TRIGGERED SURVIVED',\n    'The trap triggers, but luckily you avoid any injury.',\n  ],\n  [\n    'MESSAGE TRAP TRIGGERED INJURED',\n    \"You're caught by surprise and sustain a number of injuries from the trap.\",\n  ],\n  [\n    'MESSAGE TRAP DISABLED',\n    'Taking great care you manage to disable the trap.',\n  ],\n  [\n    'MESSAGE USE PORTAL OR MOVE',\n    'You have a choice. Do you want to use this portal or move onto it?',\n  ],\n  [\n    'MESSAGE YOU FAIL TO PICK THE LOCK',\n    'This lock is tricky. Your attempt to pick it fails.',\n  ],\n  [\n    'MESSAGE YOU PICK THE LOCK',\n    'Using your skills, you manage to pick the lock.',\n  ],\n  [\n    'MESSAGE WELCOME',\n    'Welcome to the Click and Crawl old-school dungeon crawler. How far will you get?',\n  ],\n\n  // Traits keys\n  ['STR', 'Strength'],\n  ['DEX', 'Dexterity'],\n  ['CON', 'Constitution'],\n  ['INT', 'Intelligence'],\n  ['WIS', 'Wisdom'],\n  ['CHA', 'Charisma'],\n\n  ['FX_STR', 'Strength change'],\n  ['FX_DEX', 'Dexterity change'],\n  ['FX_CON', 'Constitution change'],\n  ['FX_INT', 'Intelligence change'],\n  ['FX_WIS', 'Wisdom change'],\n  ['FX_CHA', 'Charisma change'],\n\n  ['AC', 'Armour class'],\n  ['DMG', 'Damage'],\n  ['DMG_PER_TURN', 'Damage per turn'],\n  ['DC', 'Difficulty'],\n  ['HP', 'Hit points'],\n\n  [\n    'TRIGGERS',\n    'Content warning: this game is intended for ages 16 and up and contains violence towards fantasy characters, mild horror atmospherics, comic book blood effects, and death of characters.',\n  ],\n\n  // Miscellaneous words and phrases.\n  ['AC', 'armour class'],\n  ['AC (including armour)', 'AC (+armour): ${0}'],\n  ['ACTS ON CASTER', 'Acts on caster'],\n  ['Backpack', 'Backpack'],\n  ['Body', 'Body'],\n  ['Cantrips', 'Cantrips'],\n  ['Consumables', 'Consumables'],\n  ['CHARACTER LEVEL:', 'level: ${0-level} ${1-class}'],\n  ['CHA', 'charisma'],\n  ['CON', 'constitution'],\n  ['DC', 'difficulty challenge'],\n  ['(DEAD)', '(DEAD!)'],\n  ['DEX', 'dexterity'],\n  ['Dungeon floor:', 'Dungeon floor: ${0}'],\n  ['Experience:', 'Experience: ${0}'],\n  ['Feet', 'Feet'],\n  ['Score:', 'Score: ${0}'],\n  ['Gold:', 'Gold: ${0}\\u{00A0}GP'],\n  ['GOLD PIECES', ' gold pieces'],\n  ['Hands', 'Hands'],\n  ['Head', 'Head'],\n  ['hover', 'hover'],\n  ['(HP OUT OF VALUE)', '(HP:\\u{00A0}${0}/${1})'],\n  ['(HP VALUE)', '(HP:\\u{00A0}${0})'],\n  ['INT', 'intelligence'],\n  ['Known spells', 'Known spells'],\n  ['level', 'level'],\n  ['LEVEL UP', 'Level up to ${0}'],\n  ['Name:', 'Name: ${0}'],\n  ['NSEW', 'north-south-east-west'],\n  ['PB', 'proficiency bonus'],\n  ['Prepared spells', 'Prepared spells'],\n  ['Range:', 'Range: ${0-range}'],\n  ['Ready magic', 'Ready magic'],\n  ['Ring fingers', 'Ring fingers'],\n  ['SHORT_RESTS_REMAINING', 'Short rests remaining'],\n  ['STR', 'strength'],\n  ['TRANSIENT', 'TRANSIENT'],\n  ['Unknown', 'Unknown'],\n  ['Wagon', 'Wagon'],\n  ['Waist', 'Waist'],\n  ['WIS', 'wisdom'],\n  ['YOU DIED!', 'YOU DIED!'],\n  ['zero', 'zero'],\n]);\n\nexport default MESSAGE_MAP;\n"],"names":["$3f6edc4fdcc84f8a$var$worldTileMap","$e6f3aae57afc1cde$var$messages","$94049cc5d4f81fad$var$heroActor","$6e0aaad189039339$var$heroActor","$6e0aaad189039339$var$exitKeyArtefact","$b618d869f3b8e384$var$lastHero","$cd2e32752119e7f3$var$cameraDolly","$cd2e32752119e7f3$var$sceneDefnList","$cd2e32752119e7f3$var$currentScene","$cd2e32752119e7f3$var$navigationButtons","$3ddff52f0a89f4e7$var$lastTimeStamp","a","$parcel$global","globalThis","self","window","global","$parcel$modules","$parcel$inits","parcelRequire","id","exports","init","module","call","err","Error","code","register","String","prototype","replaceAll","pattern","replacement","RegExp","replace","flags","indexOf","TypeError","toWellFormed","result","chr","codePoint","codePointAt","$54fe67d8c7c00573$var$isLeadingSurrogate","$733fb161db426370$var$LogType","LOG","INFO","DEBUG","ERROR","$733fb161db426370$var$messages","indexIn","indexOut","size","data","constructor","clear","add","item","incIndex","getAll","out","push","index","$733fb161db426370$var$addDataToMessages","logType","prefix","addEventListener","event","alert","filename","lineno","message","error","stack","$733fb161db426370$export$2e2bcd8739ae039","log","console","info","debug","fatal","join","getMessages","$0aabe9055399f474$var$HEADING_FONT","$0aabe9055399f474$var$textInfo","normal","fontName","h1","h2","h3","emojiSprite","$0aabe9055399f474$export$955358618f994a11","styleName","$95fc563048a48bb6$export$ba4266c4aaf6740c","DEG_22_5","Math","PI","DEG_45","DEG_67_5","DEG_112_5","DEG_135","DEG_157_7","$95fc563048a48bb6$export$e0b576e7a74416cd","value","min","max","$95fc563048a48bb6$export$624e7ee3f0468367","NONE","N","NE","E","SE","S","SW","W","NW","$95fc563048a48bb6$export$b141de964f0a90c1","minCeiled","ceil","floor","random","maxFloored","$95fc563048a48bb6$export$a885de3766ef0b4c","array","length","$95fc563048a48bb6$export$75c671db1a13cf5f","$95fc563048a48bb6$export$d6c5c82e8e696750","defValue","radix","parseInt","Number","isNaN","$95fc563048a48bb6$export$437ba3be5ce2ff51","parseFloat","$9181799b149b64a5$export$baf26146a414f24a","x","y","copy","point","coincident","getCartesianAngleTo","targetPos","atan2","getScreenAngleTo","toString","isCoincident","position","round","isOtherClose","other","distance","pow","getOrthoSeparation","abs","$9181799b149b64a5$export$4a23b3811cef465","rotation","velX","velY","velRot","getCartesianDirection","getScreenDirection","isZero","tolerance","$9181799b149b64a5$export$5086e02bc6b47824","$9181799b149b64a5$export$13807d9ee5a34a42","fromPoint","getRelativeTo","origin","withinSquare","$9181799b149b64a5$export$4617fb02663045ef","width","height","getBottomRight","getTopLeft","overlaps","otherRect","myBR","otherRectBR","containsPoint","containsCoordinate","equals","MIN_VALUE","MAX_VALUE","$7aed85f370071bde$var$throttleTimer","$7aed85f370071bde$var$canvas","$7aed85f370071bde$var$canvasRect","$7aed85f370071bde$var$canvasHalfWidth","$7aed85f370071bde$var$canvasHalfHeight","$7aed85f370071bde$var$canvasAlpha","$7aed85f370071bde$var$visibleCanvasRect","$7aed85f370071bde$var$gameElement","$7aed85f370071bde$var$left","$7aed85f370071bde$var$top","$7aed85f370071bde$var$scale","$7aed85f370071bde$var$maxScale","$7aed85f370071bde$var$minScale","$7aed85f370071bde$var$sizingMethod","$7aed85f370071bde$var$cameraPosition","$7aed85f370071bde$var$sizeScreen","visibleCanvasWidth","visibleCanvasHeight","visibleCanvasOffsetX","visibleCanvasOffsetY","dims","innerWidth","innerHeight","aspectRatio","displayedHeight","displayedWidth","windowAspectRatio","sizingMethod","style","left","top","$7aed85f370071bde$var$syncDomFonts","rootFontSize","$0aabe9055399f474$export$ef86e9b1c847b692","document","documentElement","fontSize","$7aed85f370071bde$var$resize","$7aed85f370071bde$var$getContext2D","getContext","alpha","$7aed85f370071bde$var$wipeGlass","glass","opacity","setTimeout","remove","Promise","resolve","$7aed85f370071bde$var$canvasPositionToWorld","$7aed85f370071bde$export$2e2bcd8739ae039","canvasPositionToWorld","centreCanvasOn","clearCanvas","clearRect","displayOnGlass","element","options","closingResponse","getElementsByClassName","replaceChildren","createElement","body","appendChild","className","glassContent","classList","display","contentHeight","getBoundingClientRect","scrollHeight","promises","closers","forEach","closer","promise","closes","race","then","response","getCanvas","getContext2D","getCanvasDimensions","getWorldInCanvasBounds","getVisibleCanvasRect","glassPositionToWorld","xOrigin","yOrigin","isOnCanvas","rect","isOnScreen","panCamera","dx","dy","resize","setOpacity","globalAlpha","setOptions","designWidth","maxScale","getElementById","$0aabe9055399f474$var$baseSize","setAttribute","innerText","minScale","$7aed85f370071bde$var$setVhCssVariable","vh","setProperty","wipeGlass","worldPositionToCanvas","worldToUi","dist","uiCoordsToMappedPositions","canvas","world","uiToWorld","$3f6edc4fdcc84f8a$var$actors","Map","$3f6edc4fdcc84f8a$var$artefacts","$3f6edc4fdcc84f8a$var$passiveSprites","$3f6edc4fdcc84f8a$var$organicActors","$3f6edc4fdcc84f8a$var$removeActor","target","gridPoint","worldPointToGrid","deleteOccupancyOfGridPoint","isOrganic","delete","$3f6edc4fdcc84f8a$var$removeArtefact","$3f6edc4fdcc84f8a$var$removePassiveSprite","sprite","$3f6edc4fdcc84f8a$var$removeTileMap","$3f6edc4fdcc84f8a$export$2e2bcd8739ae039","addActor","set","moveTileOccupancyGridPoint","addArtefact","addPassiveSprite","clearAll","actor","getActors","getOrganicActors","getArtefacts","getTileMap","getWorldDims","getDimensions","removeTileMap","resolveCancel","positionsUnused","resolveClick","positions","tile","getTileAtWorldPoint","actionClick","resolveContextMenu","actionContextClick","removeActor","removeArtefact","removePassiveSprite","setTileMap","tileMap","update","deltaSeconds","oldGridPoint","visible","canHeroSeeGridPoint","newGridPoint","artefact","updateHighlights","$70f71c2a1614355b$export$bec150f75a9b8f11","context","text","font","fillStyle","color","wrapAtX","paragraphs","split","n","$70f71c2a1614355b$var$wrapParagraph","paragraph","lineHeight","words","maxLineLength","xWrapPosition","lineSpacing","line","testLine","bounds","$70f71c2a1614355b$export$85b404b88b79e37e","metrics","measureText","fontBoundingBoxAscent","fontBoundingBoxDescent","offsetTop","offsetCentreY","fillText","$594075967358f0cc$export$8eb3892b442747bd","spriteBoxes","showFps","$abd0af492c6c3f51$var$spriteMap","$abd0af492c6c3f51$var$loadImage","srcUrl","resolved","image","Image","src","complete","$abd0af492c6c3f51$export$2e2bcd8739ae039","getSpriteBitmap","get","quiet","fallback","getUndefinedBitmap","loadImage","loadImages","srcUrls","url","all","loadSpriteMap","spriteMapDef","textureUrl","$abd0af492c6c3f51$var$buildSpriteMap","texture","frames","frame","createImageBitmap","w","h","spriteImage","spriteBitmap","centreX","sourceSize","spriteSourceSize","centreY","$75e8647c58e323d8$var$currentTimeMs","$75e8647c58e323d8$export$2e2bcd8739ae039","updateTimeNow","timeNowMs","getFrameCount","framePeriodMs","timeOffsetMs","$53f7efcdef9156d3$export$cab6ba75b045ad71","WRAP","REVERSE","STOP","$53f7efcdef9156d3$export$7ed7e8a26b54b288","maxIndex","loopMethod","direction","advanceBy","advanceByWrap","advanceByReverse","advanceByStop","overshoot","$305a56b3d2c1570b$export$22f21f38505e8954","$305a56b3d2c1570b$export$9d5734c725768403","playing","frameBitmaps","indexer","lastFrameCount","timeOffset","filenamePattern","textureFrame","startIndex","padding","fileName","padStart","suffix","endsWith","getFirstFrame","bitmap","flip","getCurrentFrame","undefined","frameCount","setCurrentIndex","getCurrentIndex","$305a56b3d2c1570b$export$7ded0ab8d4b1a54f","animatedImages","currentImage","key","animatedImage","addAnimatedImage","setCurrentKey","hasOwnProperty","getAnimatedImage","$aa0468ffbc97dbfc$export$b1e2fc7f480e9342","_context","_boundingBoxCanvas","getImageFilename","getBoundingBoxCanvas","render","currentAlpha","rotated","save","translate","rotate","_doRender","restore","strokeStyle","strokeRect","positionUnused","$aa0468ffbc97dbfc$export$544ff2c168abc0f9","lastCalculatedText","renderGeometry","calculateRenderGeometry","renderGeom","renderPosition","$aa0468ffbc97dbfc$export$bea6a7ef06354cc","halfWidth","halfHeight","lineWidth","fillRect","$aa0468ffbc97dbfc$export$184b92f2ec28e2e2","offsetX","offsetY","fillHeight","halfFillHeight","setLevel","proportion","topStroke","topFill","$aa0468ffbc97dbfc$export$f1bb2dcf27836475","gaugeRenderers","nGauges","fillStyles","strokeStyles","gaugeWidth","tileSize","gaugePosX","gaugeIndex","renderer","$aa0468ffbc97dbfc$export$c1626e6e036a584","spriteFrame","animation","imageDefinition","drawImage","$f024f63ce1fb25eb$export$3075603db8e6204c","velocity","acceleration","baseModifier","transientModifier","nextPosition","valueOrZero","nextVelocity","replaceTransientModifier","modifier","kill","replaceBaseModifier","getBoundingBox","boundsCanvas","$a82a8a6a56fb083b$export$f929ba4d0b405b8b","decoratedModifier","resolveFunc","activeSeconds","timeoutSeconds","fulfilValue","cleanUpOnTimeout","spriteUnused","applyAsTransientToSprite","applyAsContinuousToSprite","nextModifier","doUpdate","deltaSecondsUnused","$a94d5993e44fff52$export$709baf898a5dceda","deltaOpacityPerSec","delaySecs","elapsedSecs","easeInDuration","lifetimeSecs","fadeOutDuration","$8e5c8f9d0e1a3528$var$VariableSpeed","speed","linear","getSpeedBetweenPoints","pointA","pointB","$8e5c8f9d0e1a3528$export$9600794ac1f85e81","topLeft","bottomRight","$8e5c8f9d0e1a3528$export$9a9871e8ef5d3528","baseDirection","createUprightAligner","deltaSecondsIgnored","$8e5c8f9d0e1a3528$export$254d9747e34ddc90","prey","maxSeparation","variableSpeed","hunter","preyPos","hunterPos","approachSpeed","angle","cos","sin","getMinMove","maxMovement","targetValue","currentValue","requiredMovement","sign","$8e5c8f9d0e1a3528$export$c14f425b03c3e261","path","targetPoint","lastPoint","subject","subjectPos","$8e5c8f9d0e1a3528$export$6ade622442e46b50","pathModifier","$8f3da527d9ba55fc$var$createFadingSprite","$8f3da527d9ba55fc$export$5b6dfdcdc3ef8663","$8f3da527d9ba55fc$export$dc0b517182376fca","$8f3da527d9ba55fc$export$a8de794734f9d855","$8da6ce05f7802627$export$2e2bcd8739ae039","TILE_SIZE","$fea791d11ccfd744$export$73876a7ce00cb028","str","hash","i","charCodeAt","toLowerCase","$f0a94f3b2f305120$var$PERSISTENT_DATA","storage","cache","localStorage","setItem","toChecksummed","JSON","stringify","defaultValue","reviver","has","encodedValue","getItem","parse","fromChecksummed","setStorage","checksummedStr","matches","match","checksum","$58ea3f4a4bcc116e$var$BaseControl","_element","persistent","action","listeners","$58ea3f4a4bcc116e$export$3e9165d18613c27e","buildElement","createTextNode","label","$58ea3f4a4bcc116e$export$5519a977876d156d","leftLabel","$58ea3f4a4bcc116e$export$f119f65a5d88757e","imageName","rightLabel","bitmapImage","$58ea3f4a4bcc116e$var$CheckboxControl","checkbox","checked","eventUnused","onChange","checkboxContainer","$58ea3f4a4bcc116e$export$432a14a187a97cae","rangeInput","rangeContainer","$58ea3f4a4bcc116e$export$82f9c7d14b0424b","TEXT_BUTTON","CHECKBOX","RANGE","$58ea3f4a4bcc116e$export$c8a8987d4410bf2d","tagName","html","innerHTML","child","$e6f3aae57afc1cde$var$getText","Array","isArray","$e6f3aae57afc1cde$export$a7357cdd1f0b0168","strings","values","trimmed","trim","placeHolder","$e6f3aae57afc1cde$export$af7faffe10421f14","setMap","messageMap","getText","$58e6413bb4f15583$var$ANIMATION_STATE_MANAGER","onStartAnimation","animationState","savedAnimationState","setAnimationState","state","isAnimationOn","$3a28f16acdd0ba47$export$c2043c90d147849d","OK","CANCEL","$3a28f16acdd0ba47$var$prepareDialog","$3a28f16acdd0ba47$var$displayOnGlass","$3a28f16acdd0ba47$var$createMessageElement","title","$3a28f16acdd0ba47$var$showControlsDialog","mainContent","container","scrollContainer","preamble","Element","actionButtons","row","button","parentElement","okButton","okButtonLabel","$3a28f16acdd0ba47$export$2e2bcd8739ae039","popupElement","popup","popupInner","showChoiceDialog","choices","choice","showMessage","showOkDialog","buttonEl","showElementOkDialog","showControlsDialog","$6f0e758381e3257c$var$SOUND_MANAGER","effects","music","musicVolume","effectsVolume","loadAndPlayMusic","createAudioIfNotNull","volume","loop","playMusic","pause","loadEffects","audioPaths","audio","Audio","playEffect","effect","readyState","play","setMusicVolumePercent","percent","currentVolume","setEffectsVolumePercent","$f4fc9532da3395ea$var$COIN_REGEX","$f4fc9532da3395ea$var$EXCHANGE_RATE_TO_GOLD","$f4fc9532da3395ea$export$b0d0adc40593e6c1","coinDefn","valueFace","valueGp","parts","type","exchangeRate","$a4035ea4d528e431$var$MULTIDICE_REGEX","$a4035ea4d528e431$export$b9d1fef74bbc4c0c","sides","$a4035ea4d528e431$export$1ca6b1641ccbf456","test","$a4035ea4d528e431$export$7fa777a3b7eeb6e3","dice","isInteger","details","$a4035ea4d528e431$export$39e91293370042d8","roll","qty","offset","$a4035ea4d528e431$export$9ceb90c5f924ec24","offsetSign","$1b84b6462a079121$var$CHALLENGE_XP_TABLE","$1b84b6462a079121$var$ADVANCEMENT_TABLE","exp","profBonus","$4119f2a8b1aa0207$var$TRAIT_RANGE","$4119f2a8b1aa0207$var$DEFAULT_RANGE","$4119f2a8b1aa0207$var$CLASS_TRAIT_ORDER","$4119f2a8b1aa0207$var$CLASS_ATTACK_MODIFIERS","pbMultiplier","$4119f2a8b1aa0207$var$CLASS_TRAIT_ADJUSTMENT_LEVELS","$a7679a1c33accf76$export$1d4b318710123c48","spellTraits","level","getInt","$a7679a1c33accf76$export$85717b0e700e5718","characterLevel","$a7679a1c33accf76$export$be0c720f8af25518","casterTraits","availablePower","$a7679a1c33accf76$export$a8635b55c366bbfd","maxPower","getCharacterLevel","$930b66d99210d21f$export$15ea8b6154dfaef","VERY_EASY","EASY","MEDIUM","HARD","VERY_HARD","NEARLY_IMPOSSIBLE","IMPOSSIBLE","$930b66d99210d21f$export$a00548f2d1dc9708","attack","targetTraits","attackRoll","rollForAttack","rollForDamage","targetAc","getEffectiveInt","$930b66d99210d21f$export$b066f38ab0e5b2dc","attackerTraits","damage","saveModifier","getNonMeleeSaveAbilityModifier","difficulty","saveRoll","factor","getFloat","$930b66d99210d21f$export$58d02c0b3958dc5","NEED_LONG_REST","NEED_MORE_RATIONS","$930b66d99210d21f$export$f7b7586b654373a2","traits","$930b66d99210d21f$export$1f1ba427ee30f22d","currentHp","newHp","hitDice","spentHitDice","hpMax","constitutionModifier","getAsModifier","diceDetails","toxify","cure","recoveredHitDice","spentDice","oldHp","$930b66d99210d21f$export$3b89c7789beca9d3","pickerTraits","task","$b7c201230645b878$export$1a1308ca8502831f","ability","proficiency","getCharacterPb","pickRoll","$b7c201230645b878$var$CHAR_STATS_KEYS","$b7c201230645b878$export$6aedcecc644e4b96","damageDice","proficiencyBonus","abilityModifier","twoWeaponFighting","unarmed","subType","weaponType","includes","getUnarmedDamage","getMaxDamage","canUseTwoWeapons","clone","attackDetail","$b7c201230645b878$export$f0f803f528a8d270","_traits","initialValues","setFromString","definition","imposeCase","setValueFromString","_refreshDerivedValues","updatedKeyUnused","addInt","clipToZero","newValue","getValueInFeetInTiles","valueInFeet","feetToTiles","toUpperCase","setProficienciesFromString","setCostValueFromString","setIntOrDiceValueFromString","setDiceValueFromString","setDCValueFromString","setGenericValueFromString","faceValue","diceDefn","items","proficiencies","getAllTraits","entries","getAllTraitsSorted","sort","valuesToString","toJSON","revive","$b7c201230645b878$export$57c6a82d5c690092","initialTraits","getDamageDiceWhenCastBy","actorTraits","getAdjustedDiceWhenCastBy","getHpGainDiceWhenCastBy","hpDice","baseDice","extraDicePerLevel","baseLevel","adjustedDice","$a4035ea4d528e431$export$4f1346faf378181a","delta","levelChange","currentLevel","json","$b7c201230645b878$export$939a756f171fd090","_proficiencyBonus","_level","_attacks","_availableArtefactTraits","_transientFxTraits","_effectiveTraits","transientProperties","_maxTileMovePerTurn","_allowRefreshDerived","setInitialAbilityScores","getMaxTilesPerMove","map","exceedAbilitiesAndExp","extra","otherValue","addTransientFxTraits","traitsSubset","hasEffect","fxKey","toFxKey","clearTransientFxTraitsAndProperties","baseAbilities","characterClass","keys","range","_updateHitPoints","alreadyHasHp","alreadyHasHpMax","conMod","maxRoll","averageDiceRoll","hasEffective","getEffective","saveAbility","artefactTraitsOrType","isProficient","getAttacks","utiliseAdditionalTraits","availableTraits","updatedKey","_adjustForExperience","_initialiseEffectiveTraits","_deriveValuesFromTraits","_utiliseTransientTraits","_utiliseMagicTraits","_utiliseWeaponsTraits","_utiliseArmourAndShieldTraits","_adjustMovementForArmour","secondAttack","_addFxTraitsToEffectiveTraits","magic","armourClass","armourTraits","armour","shieldTraits","shields","additionalArmourClass","shieldArmourClass","acInfo","_getAcFromTraits","additional","compositeAc","baseSpeedInFeet","firstAttack","proficient","attackBonus","weaponsTraits","weapons","attackModifiers","effectivePb","armourType","acTrait","$1b84b6462a079121$export$42351fd14ab8bd87","expValue","next","_adjustTraitsForLevelChange","oldLevel","nextLevel","levels","gainPerAdjustment","maxAbility","availableGain","traitIndex","adjustForDefeatOfActor","defeatedTraits","crValue","gainedExp","currentExp","newExp","was","now","artefactSubtype","prof","allWordsIncluded","word","$63e994f329905eac$export$9544647517c5db11","idMain","len","name","capitalisedName","charAt","substring","$63e994f329905eac$export$83737b3fc54f1416","messageKey","$4f6b2ca1724556cd$export$fa2f0f26e19d189b","fetch","catch","reason","$ecf189a3ccc267f7$export$a1da6658a8e18ee2","COMMON","UNCOMMON","RARE","VERY_RARE","$ecf189a3ccc267f7$export$291e94b80cdb6dd6","common","uncommon","rare","veryRare","mergeAlmanac","almanac","find","callback","filter","filterFn","getRandomEntry","cutoff","getRandomCommonEntry","getRandomUncommonEntry","getRandomRareEntry","getRandomVeryRareEntry","$ecf189a3ccc267f7$export$1943ae6675bfce8b","almanacKey","list","entry","traitsString","minLevel","rarity","typeId","$ecf189a3ccc267f7$export$62947dea9802b3b0","getItemType","derivedParts","$63e994f329905eac$export$7659ebb14ded9371","nameId","descriptionId","unknownDescriptionId","imageId","description","unknownDescription","equipmentIds","challengeRating","$ecf189a3ccc267f7$var$extractCrValue","almanacs","addAlmanac","getAlmanac","keyOrKeys","findById","getPooledAlmanac","almanacKeys","pooledAlmanac","$ce45fe1849aeb7ad$export$ec2f7d5cc9321319","$547c634f23f1bc62$export$e451727f06f039f2","$bc745e7d6b7258f3$export$f71b2f640dbd3eb","almanacEntry","$547c634f23f1bc62$export$e633b6e759dec9c9","SPELL","CANTRIP","$bc745e7d6b7258f3$var$createArtefact","detail","$547c634f23f1bc62$export$5612627710242fc2","isTrap","interaction","$018d326b648bc43d$export$7d71571167194fbd","isMagic","$018d326b648bc43d$export$eecad08565115e9c","isConsumable","$018d326b648bc43d$export$91e310df03ee2deb","$547c634f23f1bc62$export$39337ab5872e9457","HEAD","space","money","spacesExpand","BODY","WAIST","HANDS","FEET","BACKPACK","WAGON","CANTRIPS","RING_FINGERS","SPELLS","PREPARED_SPELLS","PURSE","MAX_SAFE_INTEGER","ARMOUR","storageSpace","storeType","stash","equip","BELT","COINS","CONSUMABLE","GENERIC","HEAD_GEAR","KEY","RING","SHIELD","TRAP","TWO_HANDED_WEAPON","WEAPON","itemA","itemB","$547c634f23f1bc62$var$ArtefactStore","maxSize","artefacts","usedSpace","storeTypeId","freeSpace","maxSpace","adjustCapacity","capacity","isEmpty","getRequiredSpace","requiredSpace","take","storedArtefact","getFirst","takeFirst","firstArtefact","canAdd","$547c634f23f1bc62$var$MoneyStore","multipleArtefacts","costInGp","artefactUnused","costDetails","currentCostDetails","createGoldCoinArtefact","taken","gp","iconImageName","artefactType","unknown","sellBackPriceInGp","toFixed","stashStoreType","equipStoreType","stashInWagon","getDefaultStoreType","getStoreTypes","storeTypes","isUsable","canReact","builder","$547c634f23f1bc62$export$39a477c01214ccc0","stores","hasWagon","storeTypeName","addStore","notifyChange","storeValid","getStore","getStoreByTypeId","store","findSuitableStore","getFirstStorageDetails","hasArtefactWithSameId","artefactOrId","getAllStorageDetails","hasArtefact","getAllEquippedArtefacts","storageDetails","getPurseValue","content","addToPurse","takeFromPurse","getStoreContents","discard","discardStashed","discardEquipped","equipStore","stashStore","direct","spaceRequired","unequiped","$d9c69096b805bafd$export$7c548b14ef6e7713","matrix","rowIndex","columnIndex","centre","tl","above","tr","right","br","below","bl","$d9c69096b805bafd$var$radiateUpAndDown","member","lookNorth","lookSouth","$d9c69096b805bafd$export$f3448602f079b6d0","source","randomIndex","currentIndex","$87eafdba0a48c3b2$export$1b3c5bcd5a8a9304","WALL","DOOR_IN","DOOR_OUT","GROUND","VOID","$87eafdba0a48c3b2$var$Clarifiers","TOP_LEFT","TOP_LEFT_INTERNAL","TOP","TOP_RIGHT","TOP_RIGHT_INTERNAL","RIGHT","BOTTOM_RIGHT","BOTTOM_RIGHT_INTERNAL","BOTTOM","BOTTOM_LEFT","BOTTOM_LEFT_INTERNAL","LEFT","TOP_TEE","RIGHT_TEE","BOTTOM_TEE","LEFT_TEE","INTERNAL_CROSS","INTERNAL_VERTICAL","INTERNAL_HORIZONTAL","$87eafdba0a48c3b2$var$ShadowClarifier","BELOW_WALL","BELOW_END_WALL","$87eafdba0a48c3b2$export$5bb21ea01a6aaf38","entryPointByDoor","exitPointByDoor","generateTileMapPlan","design","symbolMap","tilePlan","convertToMatrix","clarifyMatrix","createPlan","nColumns","repeat","unambiguousMatrix","rowValue","correctedRow","colValue","colIndex","symbol","surrounds","$87eafdba0a48c3b2$var$isGround","$87eafdba0a48c3b2$var$isPartOfWall","$87eafdba0a48c3b2$var$isEntrance","$87eafdba0a48c3b2$var$isExit","planMatrix","planRow","columnValue","$87eafdba0a48c3b2$var$getDesignInfo","fallbackSymbol","$87eafdba0a48c3b2$var$getFirstOfCohort","unclarifiedSymbol","prop","clarifier","shadowClarifier","$74d763ce9aa88625$export$a82f6454288e7804","onClick","onContextClick","onPointerDown","onPointerUp","setOnClick","handler","setOnContextClick","setOnPointerDown","setOnPointerUp","actionPointerDown","actionPointerUp","$a3020fd1bff41e76$export$3565eb3d00ca5a74","routes","setRouteToCoords","route","coordsToKey","getRouteToCoords","hasRouteToCoords","keyToGridPoint","reference","containsGridPoint","getWaypointsAsGridPoints","destination","points","slice","getWaypointsAsWorldPoints","waypoints","gridPointToWorldPoint","$a3020fd1bff41e76$export$4c535f8fc4520664","startPoint","getDumbRouteNextTo","startingGridPoint","targetGridPoint","maxMove","getAdjacentTarget","canGridPointBeOccupiedByActor","rotateGridPointAbout","dX","dY","waypoint","movingX","consecutiveFails","nextPoint","moved","getAllRoutesFrom","findRoutes","movesLeft","routePoints","isTilePassable","existingRoute","canTileBeOccupied","isGridPointPassableByActor","current","deltaX","deltaY","adjX","adjY","originPoint","$a3020fd1bff41e76$export$e832cee54e4e1a4d","rayStartPoint","reachedPoints","lastStartPoint","lastBounds","findReachedTiles","getMapGridPointRect","getRayEnds","endPoint","traceRayToEnd","isGridPointInRays","rayEnds","col","steps","compassDirection","$95fc563048a48bb6$export$d9ac11c8e8c20b77","absAngle","firstPoint","isSeeThrough","markReachedPoint","compassDir","markReachedIfNotSeeThrough","$44e5a2ab0227b2c3$export$1f4d983d2ef95b6b","DOOR_HIGHLIGHT_FILL","HP_GAUGE","HP_TRANSIENT_TEXT_HERO","HP_TRANSIENT_TEXT_ENEMY","INTERACT_HIGHLIGHT_FILL","INTERACT_HIGHLIGHT_STROKE","MOVE_HIGHLIGHT_FILL","MOVE_HIGHLIGHT_STROKE","$ac2e0e274b6f5d79$export$ea490c48f1c71643","MOVEMENT_TILE","INTERACT_TILE","OCCUPIED_TILE","MOVE_OR_INTERACT_TILE","$ac2e0e274b6f5d79$export$b57fd20cbd2711c3","OBSTACLE","ENTRANCE","EXIT","$ac2e0e274b6f5d79$export$235cb65c20ad2b7","obstacle","occupants","worldPoint","role","tileSprite","addOccupant","occupant","deleteOccupant","getOccupants","pointUnused","isOccupied","isPassableByActor","canBeOccupiedByActor","isHero","canShareLocationWithActor","actorUnused","$ac2e0e274b6f5d79$export$16ec26812de3ce7a","tiles","tilesX","tilesY","gridSize","movementRoutes","movementGridPoints","movementTileHighlighter","reachableDoorTileHighlighter","reachableDoorTileGridPoints","entranceTile","exitTile","entryGridPointByDoor","exitGridPointByDoor","randomGround","heroRayTracer","interactTileGridPoints","interactTileHighlighter","heroActor","plan","tileRow","tileDefn","filterClick","processTileRole","getDimsInTiles","setRayTracer","visibleGridPoints","getVisibleGridPointRect","highlightTiles","heroTile","heroTileRole","visibleBounds","gridPointTL","gridPointBR","minCol","maxCol","minRow","maxRow","getGridSize","getTileAtGridPoint","gridAlignedWorldPoint","halfGrid","getWorldPositionOfTileByEntry","getGridPositionOfEntrance","setMovementRoutes","gridPoints","setInteractActors","actors","calcReachableDoors","heroPosition","getSurroundingTiles","highlightMovementTiles","highlightInteractTiles","highlightReachableDoorTiles","clickHandler","movement","isDeadProp","alive","isProp","heroGridPoint","getWaypointsToWorldPoint","getRandomFreeGroundTile","getRadiatingCross","lookEast","lookWest","getRadiating","radius","radiusSquared","upDownOptions","concat","sqrt","getRadiatingVisibleTiles","rangeInTiles","centrePoint","minX","minY","maxX","maxY","getCoincidentActors","getParticipants","participants","tileOccupants","$47c057e9d418a795$export$229c72e5fdee233b","secs","$805a550ae64cfa4a$export$6f18ed54727f6878","fullscreen","fullscreenElement","requestFullscreen","exitFullscreen","$09b31fa5c65d5acd$var$SETTINGS","labelKey","controlType","doNotInitialise","msg","$09b31fa5c65d5acd$export$7da80b63b5cb0fd0","controls","setting","control","$52c63697474a5ea6$var$PeripateticAnimationDefns","DEAD","keyName","IDLE","WALK_NORTH","WALK_EAST","WALK_SOUTH","WALK_WEST","$52c63697474a5ea6$var$ArtefactHolderAnimationDefns","$52c63697474a5ea6$var$AnimationKeys","definitions","formFrameNameRoot","getKeyName","getDefaultImageName","root","getFallbackKey","addAllToKeyedAnimation","keyedAnimations","anim","$52c63697474a5ea6$var$StdAnimations","peripatetic","$d6ec5a9c4a77bbf5$var$VOWEL_SOUNDS","$d6ec5a9c4a77bbf5$var$START_SOUNDS","$d6ec5a9c4a77bbf5$var$END_SOUNDS","$d6ec5a9c4a77bbf5$export$899caa88e79f0830","$d8cd23d1a2971b65$var$TraitsRenderer","hp","$d8cd23d1a2971b65$var$ActorStateAnimator","aliveStatus","fallbackImage","setActor","setFallbackKey","dir","getCurrentDirection","setAnimationForState","$95fc563048a48bb6$export$cf2deb104c051cb7","setAnimationForStateByFrame","reverse","disengaging","$d8cd23d1a2971b65$var$createActor","traitsRenderer","keyedAnimation","$d8cd23d1a2971b65$var$createStandardKeyFrames","imageRenderer","$ce45fe1849aeb7ad$export$f73d3eb6fd876d80","$ce45fe1849aeb7ad$export$be204faa7b4ee90a","ORGANIC","$d8cd23d1a2971b65$export$260a0189ba712b47","HERO","$018d326b648bc43d$export$a008c8b96400e731","PORTAL","$d8cd23d1a2971b65$var$createPortal","actorType","$018d326b648bc43d$export$7b0f49f9ef95a7b0","TRADER","$d8cd23d1a2971b65$var$createTrader","$018d326b648bc43d$export$366210f9de782ba6","HIDDEN_ARTEFACT","$d8cd23d1a2971b65$var$createArtefactHolder","$d8cd23d1a2971b65$var$createArtefactHolderKeyFrames","PROP","$018d326b648bc43d$export$13d2779752f0bd8f","$d8cd23d1a2971b65$var$createProp","$d8cd23d1a2971b65$var$createEnemy","$018d326b648bc43d$export$bbfcae392104b4c9","$018d326b648bc43d$export$56070c78bbcda189","$d8cd23d1a2971b65$var$equipActor","artefactEntry","storeManager","$209cccf9e7a37d77$export$c420872fac89c2a3","pendingHpChange","hpPerTurn","getChangeInHpThisTurn","deltaHp","reportedChange","addToxicEffect","isActive","$125f5f2e3c48ca5e$export$cc5edb2b1b75cf3d","scene","$eec528ab74dc2bea$export$e439bffd17c92e84","maxLength","sortFn","equalFn","b","existingIndex","indexOfEqual","existingValue","pop","getCurrentData","getMaxLength","$ece912613ca227a3$var$LEADERBOARD_DATA_KEY","$ece912613ca227a3$export$a432f328c781673f","goldSent","adventureStartTime","$ece912613ca227a3$export$384cd953322e3851","hero","completed","leaderboardIndex","$ece912613ca227a3$var$saveToLeaderboard","adventureResult","leaderboard","$ece912613ca227a3$var$createAdventureResult","class","gold","dungeonFloor","$cd2e32752119e7f3$export$2e2bcd8739ae039","getCurrentSceneLevel","gameState","sceneLevel","$ece912613ca227a3$export$e5b7197cc57951e6","$ece912613ca227a3$var$revive","keyUnused","$2815bbe36e5ce5cf$export$194ecf1460f71071","wards","createKeyCode","btoa","uri","encodeURIComponent","protect","retrieve","reinstate","$75e9abed2bf14854$var$parsingWarden","$75e9abed2bf14854$export$8df0edb81ed6c93c","href","parentheses","$75e9abed2bf14854$var$blockReps","re","rep","matched","hashes","txt","$75e9abed2bf14854$var$reAllLinesStartWith","blockPrefix","blockSuffix","trimContents","useWarden","linePrefix","lineSuffix","$75e9abed2bf14854$var$paragraphReps","$75e9abed2bf14854$var$spanReps","floatLeft","altText","iconHtml","address","encoded","$75e9abed2bf14854$export$52ce4ed9be59edb4","$75e9abed2bf14854$var$encodeCharToEntity","codeA","codeB","$75e9abed2bf14854$var$markdownEscReps","$75e9abed2bf14854$var$securityReps","$75e9abed2bf14854$var$htmlEscIgnoringBrReps","$75e9abed2bf14854$var$htmlCleanUpReps","$75e9abed2bf14854$var$processReplacements","replacements","sub","reStart","reBlockSearchRe","lineReplacementRe","lineReplacement","blockContents","trimEnd","$ab02f2464c9ae977$exports","$e930bf3cf7113404$exports","getBundleURL","$de81d41e34f30975$exports","$62c3d80d1fa7bce4$exports","$9747fa697e881e78$exports","$7ad4ee7b5c11248a$exports","$5576e8927572aaec$exports","$278bd977bbb3b534$exports","$25e8874d301378f7$exports","$bc21e390b0fbed77$exports","$d33c974414460e80$exports","$e5d3e25384a15a7d$exports","$3fa8da015b3ced9d$exports","$ac6220174f427a19$exports","$5ace0b636c6742b7$exports","$66b5f503d95640f1$exports","$5516e1e778d22f49$exports","$5cdcac5d848181d6$exports","$338ffdf8742c1f6d$exports","$fddd64966a57c95a$exports","$ec2dd53d90da22db$exports","$a20ffeb5ab13c768$exports","$4dd02297961bb41c$exports","$b3adf99d440c8ee3$exports","$ba00409886f2510e$exports","$7fb36697ad94c646$exports","$9199aa49f8197197$exports","$11193d19f4bf8c94$exports","$eaba73c9dc9a0837$exports","$6f219908ff4df928$exports","$aeeaca21509f249d$exports","$19935fe2d37942a0$exports","$d6694d143d02c676$exports","$d66938ef515a4789$exports","$74d39ee2601cbed2$exports","$f99d789ddad1509e$exports","$b43e391b1487f933$exports","$a4c3b9ba384fa621$export$54b43579d6cb0cf2","ABOUT_MD","URL","ALMANAC_MAP","DUNGEON_COMPLETE","DUNGEON_SCRIPT","DUNGEON_WELCOME","DUNGEON_WELCOME_CASUAL","HELP_MD","MUSIC","PRIVACY_MD","STARTUP_TIPS_MD","QUICK_START_MD","SOUND_EFFECTS_MAP","SPLASH_IMAGE","$fad5984ad571e100$exports","$a4c3b9ba384fa621$export$bd73ddfe5f8475d8","__esModule","default","$821757827816346b$export$8bd46d86307c9a41","markdown","pre","post","$97137e829c6605e7$var$RUNES","$0d952fff85f71606$export$46f5471185d8bc9e","maxCols","maxRows","maxRoomCols","maxRoomRows","dungeon","minCols","minRows","getWallChr","getFloorChr","getLandChr","getDoorInChr","getDoorOutChr","isWallChr","isFloorChr","isLandChr","isDoorInChr","isDoorOutChr","generate","lastLeftLandCols","lastRoomCols","maxLeftLand","leftLandCols","reqdMinRoomWidth","reqdMaxRoomWidth","roomCols","rightLandCols","roomRows","createRoom","removeInternalWalls","locateDoors","getMatrixAsStrings","columns","numberOfRows","internalRow","isVerticalWall","isHorizontalWall","possibleLocations","randomLocations","location","$17f6c6e2292a8d96$var$addAllMagicToHero","equipSpells","allMagic","$94049cc5d4f81fad$export$baa1f113a47bd01a","INSIGNIFICANT","$94049cc5d4f81fad$var$getMaxEnemyCr","challenge","$94049cc5d4f81fad$var$AutoSceneList","sceneDefn","dungeonChallenge","reset","setChallenge","getIndex","getNext","buildScene","hasNext","$cd2e32752119e7f3$export$2a8e6ebcf5b5c91","setHero","addIntro","addEnemies","addTraders","addArtefacts","addMap","addPortal","intro","hostname","searchParams","URLSearchParams","search","heroId","hasAllMagic","$17f6c6e2292a8d96$var$buildActorFromAlmanac","actorId","stashSpells","$17f6c6e2292a8d96$var$addToBackpack","itemId","maxEnemies","maxTotalChallenge","debugEnemy","enemyId","enemies","maxEnemyCr","enemyPoolAlmanac","$94049cc5d4f81fad$var$createEnemyPoolAlmanac","dungeonRating","maxMonsterChallenge","totalChallenge","totalEnemies","enemy","traderIndex","totalArtefacts","portal","creator","mapDesign","$6993a9a5d7595cd1$var$idCheckAllowed","$6e0aaad189039339$var$EventId","MAIN_MENU","CLICKED_FREE_GROUND","CLICKED_ENTRANCE","CLICKED_EXIT","$6e0aaad189039339$var$persistentGame","$6e0aaad189039339$var$ReplayableActorMover","originalPosition","routeFinder","heroDisengaging","getTargetGridPoint","actorGridPos","moveType","HUNT","heroGridPos","orthoSeparation","getRandomGridPosition","moveInstantly","tilesToMove","targetGridPos","setActorsPosition","currentGrid","maxDistance","restorePosition","replay","cloneIfOrganic","clonedActor","freezeMovement","$6e0aaad189039339$var$MovementReplayer","movers","addAndMoveActor","replayableMover","mover","$6e0aaad189039339$var$State","transitionTo","onExit","$6e0aaad189039339$var$currentState","onEntry","onEvent","eventIdUnused","$6e0aaad189039339$var$AtMainMenu","continuation","playAdventure","internalLabel","playCasual","settings","bestAdventure","leaderboardData","adventure","$2f0424278e098787$var$formHallOfFameEntry","startDate","Date","toISOString","chrClass","guides","about","help","privacy","$6e0aaad189039339$var$AtStart","showQuickTips","loadFirstOrContinuationScene","$b5bda9c98c481f6f$export$1fa1f898df932d80","reject","getCurrentSceneIntro","$6e0aaad189039339$var$HeroTurnIdle","rejection","$6e0aaad189039339$var$AtGameOver","savedGame","continueFromSavedScene","switchToFirstScene","notAgainButton","$b5bda9c98c481f6f$export$13f9064afcdbcb51","heroContainer","$b5bda9c98c481f6f$var$createActorElement","hideTraits","messageDefeat","unloadCurrentScene","$6e0aaad189039339$var$AtGameCompleted","$6e0aaad189039339$var$prepareHeroTurn","$6e0aaad189039339$var$doToxicEffectsKillHero","eventId","$6e0aaad189039339$var$disambiguateFilter","$6e0aaad189039339$var$interact","$6e0aaad189039339$var$showOccupantDetails","$6e0aaad189039339$var$moveHeroToPoint","usePathFinder","$6e0aaad189039339$var$ComputerTurnIdle","$6e0aaad189039339$var$tryToUnlockExit","$6e0aaad189039339$var$startNextScene","$6e0aaad189039339$var$HeroTurnInteracting","tryToDisengage","transitionToComputerTurn","$6e0aaad189039339$var$ComputerTurnInteracting","opponents","respectDisengage","opponent","currentGridPoint","$6e0aaad189039339$var$applyOrganicToActors","replayer","isWandering","isEnemy","willInteract","enact","organic","targets","react","currentState","areThereMoreScenes","currentSceneLevel","$97137e829c6605e7$var$createSequenceOptions","sequences","nRunes","minRunes","runesStart","runes","offsets","seq","repetitions","sequenceOffsets","startOffset","nextLength","sequence","sequenceOffset","correct","incorrect","$97137e829c6605e7$var$createIncorrectSequence","letters","changedIndex","substitute","goodIndex","solved","setDungeonChallenge","switchToNextScene","isHiddenArtefact","$b5bda9c98c481f6f$export$634672c91d44b77e","allowConsumption","allowMagicUse","delayedAction","invoke","moveLabel","interactLabel","discovered","isPortal","keyTraits","success","detailUnused","$6e0aaad189039339$var$ignoreEvents","$6e0aaad189039339$export$2e2bcd8739ae039","EventId","getHeroActor","triggerEvent","setExitKeyArtefact","$20be302081331f54$var$createGroundDefn","$20be302081331f54$var$createEntranceDefn","$20be302081331f54$var$createExitDefn","$20be302081331f54$export$7dccdb77f761a8ef","$65611a44f4d7d3b3$export$765fdbac0eda2a0b","globalOpacity","fadeInSecs","fadeOutSecs","fadeOutResolve","getOpacity","load","doLoad","initialise","doInitialise","unload","fadeOut","doUnload","$b618d869f3b8e384$var$GRID_SIZE","$b618d869f3b8e384$var$createFindableArtefact","preBuiltArtefact","$b618d869f3b8e384$var$addArtefactToActor","$b618d869f3b8e384$var$ParsedScene","$b618d869f3b8e384$var$createHero","freeTile","exitKeyAlmanacEntry","exitKeyArtefact","keysToAdd","pooledArtefactAlmanac","water","rations","$b618d869f3b8e384$var$createEnemies","isTrader","qtyOfItems","$b618d869f3b8e384$var$addRandomArtefactsToActor","holdingActor","$b618d869f3b8e384$var$createArtefacts","setCameraToTrack","$a102cd63725cc805$export$17735bdb93cbf279","OFF","VELOCITY","$a102cd63725cc805$export$39ca3bda943df04d","heroTracker","velocityTracker","trackingMethod","proportionSeparated","canvasDims","separation","setVelocity","vX","vY","setTrackingMethod","panBy","method","$188f4f09d5382053$export$763f95e026c05695","TR","BR","BL","TL","$188f4f09d5382053$export$5e8c6d32f039cdeb","cameraDolly","trackingButton","trackingButtonImage","locationNav","locationFullscreen","createButtonSet","createSettingsButton","buttonImage","settingsButton","$fd5e96b24678cb30$export$2e2bcd8739ae039","addButton","getLocationPoint","createFullscreenButton","fullscreenButton","navigationUI","showArrows","createCentreButton","createArrowButtons","setTrackingState","on","scrollSpeed","$188f4f09d5382053$var$SCROLL_TILES_PER_SEC","createMomentaryButton","imageNamePrefix","callbackDown","callbackUp","addMomentaryButton","$cd2e32752119e7f3$var$setScene","$cd2e32752119e7f3$var$unloadScene","setVisible","$cd2e32752119e7f3$var$getNextSceneFromList","savedSceneLevel","savedHero","panCameraBy","setSceneList","listOfScenes","$b5bda9c98c481f6f$export$30b1e0f61711dee7","VIEW","SELL","PILLAGE","FIND","$b5bda9c98c481f6f$var$ArtefactAction","CONTINUE","CONSUME","LEAVE","LEARN_SPELL","DISCARD","EQUIP","PREPARE_SPELL","STASH","TAKE","USE","$b5bda9c98c481f6f$var$InventoryLimitation","STANDARD","STASH_ONLY","MAGIC","READY_MAGIC","$b5bda9c98c481f6f$var$InventoryContainerElement","inventoryOptions","linkedInventory","refresh","noChain","empty","currentOwner","storesToShow","getStoresToShow","storeInfo","contents","storeContentsElement","createStoreContents","emptyMessage","onRefresh","limitation","getStashStoreInfo","contentsElement","bind","spellPower","createUncastableSpellButtonControl","createArtefactButtonControl","$b5bda9c98c481f6f$var$createArtefactButtonLabel","delayedReaction","$b5bda9c98c481f6f$export$19550c7d374fe949","$b5bda9c98c481f6f$var$discardItemsFromStore","$b5bda9c98c481f6f$var$showInventory","actorContainer","hideDescription","inventoryContainer","prospectiveOwner","$b5bda9c98c481f6f$var$createSelfActionArtefactDialogButtons","$b5bda9c98c481f6f$var$createSpellButtons","buttons","allowSpellPrep","$b5bda9c98c481f6f$var$createCantripButtons","$b5bda9c98c481f6f$var$createConsumeButtons","$b5bda9c98c481f6f$var$isArtefactUsable","$b5bda9c98c481f6f$var$getLabelForUse","$b5bda9c98c481f6f$var$createStandardArtefactButtons","$b5bda9c98c481f6f$var$createFailedStorageGuidance","$b5bda9c98c481f6f$var$createIdCard","idCard","hpText","descriptionElement","$b5bda9c98c481f6f$var$createCorpseDescriptionElement","$b5bda9c98c481f6f$var$createTraitsList","excludedKeys","includeGold","traitsList","goldPieces","readableArray","remainingRestsTrait","$b5bda9c98c481f6f$var$createRemainingShortRestTrait","remainingDice","$b5bda9c98c481f6f$var$createReadableKey","transientPropertiesTrait","$b5bda9c98c481f6f$var$getTransientPropertiesTrait","readableProps","traitEntry","startsWith","effectiveValue","baseValue","diff","displayedValue","revised","showDamage","diceLabel","rangeText","showPrice","price","$b5bda9c98c481f6f$export$22192403b4d58a2d","buyer","seller","pillage","sideBySide","buyerSide","sellerSide","actionType","buyerInventory","sellerInventory","buttonRestElement","actorElement","removeChild","$b5bda9c98c481f6f$var$showTraits","allowRest","$b5bda9c98c481f6f$var$showRestActionDialog","meals","drinks","messageContainer","shortIndex","longIndex","restDetails","$930b66d99210d21f$export$105ff773d2a2501a","nMeals","nDrinks","shortRest","possible","failure","longRest","availableDice","$b5bda9c98c481f6f$var$showPrepareSpellsDialog","additionalControls","$b5bda9c98c481f6f$var$showCastSpells","cancelButton","objectTraits","sourceStoreManager","destStoreManager","originalHideTraits","$b5bda9c98c481f6f$var$identifyArtefact","allowed","tester","known","$b5bda9c98c481f6f$var$showEquipDialog","$b5bda9c98c481f6f$var$createArtefactDialogButtons","$b5bda9c98c481f6f$var$createFindArtefactDialogButtons","possibleStore","READY_SPELLS","$b5bda9c98c481f6f$var$createSellArtefactDialogButtons","buyersFundsInGp","artefactCostInGp","requiredGp","availableGp","$b5bda9c98c481f6f$var$createPillageArtefactDialogButtons","allowMainMenu","nextFloor","mainMenuButton","continueButton","$d6f5b166d007f5fc$var$CHARACTERISTICS","SETBACK","dc","bonus","DANGEROUS","DEADLY","$cad59b8eddb1e3f8$var$createTrapElement","trapDescription","messageEl","$018d326b648bc43d$var$applyPoisonDamage","poison","victim","$018d326b648bc43d$var$applyDamage","attacker","defender","defenderName","defenderHP","$018d326b648bc43d$export$b0a99659d931757e","change","textColor","$018d326b648bc43d$export$f7b5529658291013","owner","reactorUnused","enactorUnused","canEnact","escaperUnused","reactor","resolveAttackerDefender","enactor","displayAttack","undertakeAllAttacks","undertakeAllMeleeAttacks","attackMode","$ce45fe1849aeb7ad$export$3b2bf5f0d22f8a72","COMBO","undertakeComboAttacks","POISON","RANGED","COMBAT","undertakeCombatAttack","spell","totalDamage","successfulAttacks","hitSound","hitImage","attemptTheftBy","swapPositions","robber","traderTraits","fight","takenGold","them","myPosition","theirPosition","trapResult","outcome","$018d326b648bc43d$export$5cbf62c05633d8fa","$a7679a1c33accf76$export$a0ac1da054aaefd1","magicTraits","actorLevel","spellLevel","casters","actorClass","createDiscoveryMessage","foundArtefact","isImmune","hover","toxin","toxinTraits","getToxin","retValue","enactBless","enactConjureMeal","enactDetectPoison","enactFindTraps","enactHover","enactVampiricTouch","enactMagic","$a7679a1c33accf76$export$42488dd933dc2ad9","maxTargets","hitTargets","validTargets","radial","indiscriminate","IsValidTarget","$930b66d99210d21f$export$53864c490cc48ef4","$930b66d99210d21f$var$getSpellMeleeDamage","spellCastAbility","spellCastAbilityValue","$930b66d99210d21f$export$334844f8a6a08ed0","attackLabel","spellModifier","fullDifficulty","savingThrow","displaySpell","displayFailedSpell","searchedTiles","foundTrap","caster","$a7679a1c33accf76$export$be6656d966ac0ec8","casterTraitsUnused","maxTargetHp","targetHp","hpGain","$930b66d99210d21f$export$e3e87e6231f5dc4d","applyAndShowHpGain","foodEntry","waterEntry","itemsStashed","food","maxMeals","backpackContents","identifiedItem","appliedGain","includeTrader","possibleTarget","imageRootName","spellType","foodType","addTransientActions","hpMessage","gainDetail","$930b66d99210d21f$export$471963e02ad769b2","consumableTraits","consumerTraits","gain","shortFall","maxHp","detoxify","gainHp","ATTEMPT_DISABLE","DISABLED","TRIGGERED","trapDetails","$d6f5b166d007f5fc$export$24ed1b3598f489eb","trapTraits","detectBy","disableBy","reward","attemptToDisable","dialog","enactorTraitsUnused","trapDetailsUnused","applyAndShowDamage","$cad59b8eddb1e3f8$export$7a0edf0949c382a7","enactorTraits","$cad59b8eddb1e3f8$export$2d8fb94cfec71c61","labels","transfers","transferValue","transferredGold","sentGold","ENEMY","ARTEFACT","WANDER","frozen","updateTraitsFromStore","getTime","otherActor","inventory","$fd5e96b24678cb30$var$actors","$fd5e96b24678cb30$var$visible","$fd5e96b24678cb30$var$isHittingActor","actorCanvasPos","boundingBox","canvasBox","$fd5e96b24678cb30$var$resolvePointerUp","callbackOn","callbackOff","removeButton","uiPos","resolvePointerCancel","resolvePointerDown","resolvePointerUp","visibility","$777fa57823e630b1$export$57244dfe9a4da758","GRINNING","SANTA","SHAKING","$d56a39ce6823f5f2$export$90ded0e426ce21","$d56a39ce6823f5f2$export$3853e404217e8f25","$d56a39ce6823f5f2$export$f1ed6970fd95c8d6","$d56a39ce6823f5f2$export$a5ec1de9afad15ae","$d56a39ce6823f5f2$export$fc5c5be4a666ab48","$d56a39ce6823f5f2$export$d69198a72de4964d","$d56a39ce6823f5f2$var$EventSource","MOUSE","TOUCH","$d56a39ce6823f5f2$var$dispatchEvent","eventName","CustomEvent","dispatchEvent","$d56a39ce6823f5f2$var$getOffsetFromTouch","touches","pageX","pageY","$d56a39ce6823f5f2$var$processStartAction","eventSource","actionStarted","dragging","lastX","lastY","startX","startY","$d56a39ce6823f5f2$var$processEndAction","$d56a39ce6823f5f2$var$processMoveAction","suppressClickEvent","$2651cee9e4814cb3$var$MESSAGE_MAP","$3ddff52f0a89f4e7$var$gameLoop","timeStamp","fps","requestAnimationFrame","$3ddff52f0a89f4e7$export$2e2bcd8739ae039","screenOptions","splashPopup","$3ddff52f0a89f4e7$var$createSplashElement","splash","loading","loadingText","fallbackIndex","centreToBaseLine","getImageData","$3ddff52f0a89f4e7$var$setupListeners","dragData","lastTouchStartPoint","passive","changedTouches","preventDefault","mappedPositions","$3ddff52f0a89f4e7$var$createWelcomeElement","script","urlMap","$ecf189a3ccc267f7$var$parseAlmanacText","lines","$25d927bcec52155b$var$FeatureSupportTest","privateMember","arrowFunction","testSupportedFeatures"],"version":3,"file":"index.9a982cac.js.map"}