!function(){let e,t,r,i,a,n,s,o,l,h,c,u;var d,f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},p={},m={},g=f.parcelRequire3d79;null==g&&((g=function(e){if(e in p)return p[e].exports;if(e in m){var t=m[e];delete m[e];var r={id:e,exports:{}};return p[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){m[e]=t},f.parcelRequire3d79=g),g.register;/**
 * @license See {@link https://opensource.org/license/mit/|MIT}
 *
 * Copyright 2024 Steve Butler
 */let S="1.0.19-beta+sg2djt",w="2024-07-03",E=[],T="ClickAndCrawl:";function y(){return`${T}[]`}function A(e){return e.startsWith(T)}async function x(){console.debug("[Service worker] Installing version  and pre-caching");let e=await caches.open(y());for(let e of E)console.debug(`Manifest ${e}`);await e.addAll(E.filter((e,t)=>E.indexOf(e)===t))}async function I(){console.debug("[Service worker] Activating");let e=await caches.keys(),t=[];for(let r of e)A(r)&&r!==y()&&t.push(caches.delete(r));await Promise.all(t)}async function R(){console.info("Deleting all service worker caches.");let e=[];for(let t of(await caches.keys()))A(t)&&t!==y()&&e.push(caches.delete(t));await Promise.all(e)}async function O(e){let t=y(),r=await caches.match(e,{cacheName:t});return r?(console.log("[Service worker] Found response in cache:",r),r):(r=await caches.match(e,{ignoreSearch:!0,cacheName:t}))?(console.log("[Service worker] Found response in cache ignoring search:",r),r):(console.log("[Service worker] No cache so resorting to network"),fetch(e))}self.addEventListener("install",e=>e.waitUntil(x())),self.addEventListener("activate",e=>e.waitUntil(I())),self.addEventListener("fetch",e=>e.respondWith(O(e.request)));var N={setDeleteAllCachesFunction:t=>e=t,deleteAllCaches:()=>e?.()},C={};C=g("97l7Z").getBundleURL("cTejp")+"service-worker.js",String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){if(!(e instanceof RegExp))return this.replace(RegExp(e,"g"),t);if(0>e.flags.indexOf("g"))throw TypeError("String.prototype.replaceAll called with a non-global RegExp argument");return this.replace(e,t)}),String.prototype.toWellFormed||(String.prototype.toWellFormed=function(){if(!this)return this;let e="";for(let t of this){let r=t.codePointAt(0);r>=55296&&r<=56319||r>=56320&&r<=57343?e+="ï¿½":e+=t}return e});let P={LOG:0,INFO:1,DEBUG:2,ERROR:3},D=new class{#e;#t;#r;#i;constructor(e){this.#r=e,this.#e=0,this.#t=0,this.#i=[]}clear(){this.#i=[],this.#e=0,this.#t=0}add(e){this.#i[this.#e]=e,this.#e=this.#a(this.#e),this.#e===this.#t&&(this.#t=this.#a(this.#t))}getAll(){let e=[],t=this.#t;for(;t!==this.#e;)e.push(this.#i[t]),t=this.#a(t);return e}#a(e){return++e>this.#r&&(e=0),e}}(50);function v(e,t){let r;switch(t){case P.DEBUG:r=":-/ ";break;case P.INFO:r="(i) ";break;case P.ERROR:r="/! ";break;case P.LOG:default:r=""}for(let t of e)D.add(`${r}${t}`)}window.addEventListener("error",e=>{alert(`ERROR: ${e.filename}; line ${e.lineno}
${e.message}
:Stack:
${e.error.stack}`)});var L={info:function(...e){console.info(...e),v(e,P.INFO)},debug:function(...e){console.debug(...e)},error:function(...e){console.error(...e),v(e,P.ERROR)},fatal:function(e){let t;console.error(e),t=e.message?`${e.message}
Stack:
${e.stack}`:e,alert(`Fatal error: ${t}
Previous errors:
${D.join("\n")}`),v(t,P.ERROR)},getMessages:function(){return D.getAll()}};let M=15,_=0,b="'Fondamento', cursive",z={normal:{size:15,fontName:"'Fondamento', cursive"},h1:{size:30,fontName:b},h2:{size:22,fontName:b},h3:{size:18,fontName:b},emojiSprite:{size:18,fontName:"'Fondamento', cursive"}};function k(){z.normal.size=M+_/100*.390625,z.h1.size=2*z.normal.size,z.h2.size=1.5*z.normal.size,z.h3.size=1.2*z.normal.size,z.emojiSprite.size=_/10,document.documentElement.style.fontSize=`${z.normal.size}px`}function G(e){let t=z[e]??z.normal;return`${t.size}px ${t.fontName}`}let U={DEG_22_5:1/8*Math.PI,DEG_45:2/8*Math.PI,DEG_67_5:3/8*Math.PI,DEG_112_5:5/8*Math.PI,DEG_135:6/8*Math.PI,DEG_157_7:7/8*Math.PI};function B(e,t,r){return e<t?t:e>r?r:e}let H={NONE:-1,N:0,NE:1,E:2,SE:3,S:4,SW:5,W:6,NW:7};function F(e,t){let r=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-r)+r)}function $(e){let t=F(0,e.length);return e[t]}function W(e,t){let r=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-r+1)+r)}function Y(e,t=0,r){let i=parseInt(e,r);return Number.isNaN(i)?t:i}function K(e,t=0){let r=parseFloat(e);return Number.isNaN(r)?t:r}class V{x;y;constructor(e,t){this.x=e,this.y=t}static copy(e){return new V(e.x,e.y)}coincident(e){return this.x===e.x&&this.y===e.y}getCartesianAngleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}getScreenAngleTo(e){return Math.atan2(this.y-e.y,e.x-this.x)}toString(){return`(${this.x},${this.y})`}isCoincident(e){return Math.round(this.x)===Math.round(e.x)&&Math.round(this.y)===Math.round(e.y)}isOtherClose(e,t){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)<=Math.pow(t,2)}getSeparation(e){let t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)}getOrthoSeparation(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}}class X{x;y;rotation;constructor(e,t,r){this.x=e,this.y=t,this.rotation=r}getCartesianDirection(){return Math.atan2(this.y,this.x)}getScreenDirection(){return Math.atan2(-this.y,this.x)}isZero(e){return Math.abs(this.x)<e&&Math.abs(this.y)<e}}class q{x;y;rotation;constructor(e,t,r){this.x=e,this.y=t,this.rotation=r}}class j extends V{rotation;constructor(e,t,r){super(e,t),this.y=t,this.rotation=r}static fromPoint(e){return new j(e.x,e.y,0)}static copy(e){return new j(e.x,e.y,e.rotation)}getRelativeTo(e){return new j(this.x-e.x,this.y-e.y,this.rotation-e.rotation)}withinSquare(e,t){return Math.abs(e.x-this.x)<t&&Math.abs(e.y-this.y)<t}}class Z{x;y;width;height;constructor(e,t,r,i){this.x=e,this.y=t,this.width=r,this.height=i}getBottomRight(){return new V(this.x+this.width,this.y+this.height)}getTopLeft(){return new V(this.x,this.y)}overlaps(e){let t=this.getBottomRight(),r=e.getBottomRight();return!(e.x>t.x||e.y>t.y||r.x<this.x||r.y<this.y)}containsPoint(e){return e.x>=this.x&&e.x<=this.x+this.width&&e.y>=this.y&&e.y<=this.y+this.height}containsCoordinate(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}}new V(Number.MIN_VALUE,Number.MIN_VALUE),new V(Number.MAX_VALUE,Number.MAX_VALUE);let Q=null,J=null,ee=null,et=0,er=0,ei=!0,ea=null,en=null,es=0,eo=0,el=1,eh=1,ec=.1,eu="COVER",ed=new j(0,0,0);function ef(){let e,t,r,i;let a=function(){let e=document.getElementById("game-content");return L.info(`screen: ${screen.width} x ${screen.height}`),L.info(`innerWidth/Height: ${window.innerWidth} x ${window.innerHeight}`),L.info(`outerWidth/Height: ${window.outerWidth} x ${window.outerHeight}`),L.info(`game-content: ${e.clientWidth} x ${e.clientHeight}`),{width:e.clientWidth,height:e.clientHeight}}(),n=ee.width/ee.height,s=0,o=0,l=a.width/a.height;("COVER"===eu?n>l:n<l)?o=(s=a.height)*n:s=(o=a.width)/n,(el=o/ee.width)>eh?(o=(el=eh)*ee.width,s=el*ee.height):el<ec&&(o=(el=ec)*ee.width,s=el*ee.height),es=(a.width-o)/2,eo=(a.height-s)/2,J.style.left=`${es}px`,J.style.top=`${eo}px`,J.style.width=`${o}px`,J.style.height=`${s}px`,es<0?(r=-es/el,e=a.width/el):(r=0,e=ee.width),eo<0?(i=-eo/el,t=a.height/el):(i=0,t=ee.height),ea=new Z(r,i,e,t),L.info(`Scale: ${el}`),L.info(`Window: width: ${a.width}, height: ${a.height}`),L.info(`Display: left: ${es}, top: ${eo}, width: ${o}, height: ${s}`),L.info(`Visible canvas: left: ${r}, top: ${i}, width: ${e}, height: ${t}`)}function ep(){ef()}function em(){return J.getContext("2d",{alpha:ei})}window.addEventListener("resize",()=>{null===Q&&(Q=window.setTimeout(()=>{ef(),Q=null},200))}),screen.orientation?.addEventListener("change",()=>void ef());var eg={centreCanvasOn:function(e){ed.x=e.x-et,ed.y=e.y-er},clearCanvas:function(){em().clearRect(0,0,ee.width,ee.height)},displayOnGlass:function(e,t){let r,i;t.replace&&(r=document.getElementsByClassName("glass")[0],r?.replaceChildren()),r||(r=document.createElement("div"),document.body.appendChild(r),r.className="glass");let a=document.createElement("div");r.appendChild(a),a.className="glass-content",a.appendChild(e),t.className&&r.classList.add(t.className),r.style.display="block",r.style.opacity=1;let n=a.getBoundingClientRect().height;a.scrollHeight>n&&a.classList.add("overflow");let s=[];if(t.closers&&t.closers.length>0)t.closers.forEach(e=>{let t=new Promise(t=>{e.element.addEventListener("click",async()=>{t(e.closes)})});s.push(t)});else{let e=new Promise(e=>a.addEventListener("click",()=>e()));s.push(e)}return Promise.race(s).then(e=>{var t;return i=e,(t=r).style.opacity=0,window.setTimeout(()=>{t.remove()},500),Promise.resolve()}).then(()=>i)},getCanvas:()=>J,getContext2D:em,getCanvasDimensions:function(){return{width:ee.width,height:ee.height}},getWorldInCanvasBounds:function(){return new Z(ed.x,ed.y,ee.width,ee.height)},glassPositionToWorld:function(e){var t;let r=e.x<0?ea.x+ea.width:ea.x,i=e.y<0?ea.y+ea.height:ea.y;return t=new j(r+e.x,i+e.y,e.rotation),new j(t.x+ed.x,t.y+ed.y,t.rotation)},isOnCanvas:function(e){return e.overlaps(ee)},isOnScreen:function(e){return e.overlaps(ee)},setOpacity:function(e){em().globalAlpha=e},setOptions:function(e){if(J){L.error("Multiple calls to setScreen ignored.");return}if(L.info(`Max canvas scaling set to ${e.maxScale}.`),!(en=document?.getElementById("game-content"))){L.debug("No game element so assuming running as Jest test. No ui");return}en.replaceChildren(),_=e.width,k(),(J=document.createElement("canvas")).id="game-canvas",J.setAttribute("width",e.width),J.setAttribute("height",e.height),J.innerText="Loading the app.",ee=new Z(0,0,e.width,e.height),et=e.width/2,er=e.height/2,en.appendChild(J),eh=e.maxScale,ec=e.minScale,eu=e.sizingMethod,ei=e.alpha,ef()},worldPositionToCanvas:function(e){return new j(e.x-ed.x,e.y-ed.y,e.rotation)},uiCoordsToMappedPositions:function(e,t){return{canvas:new j(Math.round(e/=el),Math.round(t/=el)),world:new j(Math.round(e+ed.x),Math.round(t+ed.y),-ed.rotation)}}};let eS=new Map,ew=new Map,eE=new Map,eT=new Map;function ey(e){let r=t.worldPointToGrid(e.position);t.deleteOccupancyOfGridPoint(e,r),e.isOrganic()?eT.delete(e):eS.delete(e)}function eA(e){eE.delete(e)}var ex={addActor:function(e){e.isOrganic()?eT.set(e,e):eS.set(e,e),t.moveTileOccupancyGridPoint(e,null,t.worldPointToGrid(e.position))},addArtefact:function(e){ew.set(e,e),t.moveTileOccupancyGridPoint(e,null,t.worldPointToGrid(e.position))},addPassiveSprite:function(e){eE.set(e,e)},clearAll:function(){eT.forEach(e=>ey(e)),eS.forEach(e=>ey(e)),ew.forEach(e=>(function(e){let r=t.worldPointToGrid(e.position);t.deleteOccupancyOfGridPoint(e,r),ew.delete(e)})(e)),eE.forEach(e=>eA(e)),t=null},getActors:function(){return eS},getOrganicActors:function(){return eT},getTileMap:function(){return t},resolveClick:function(e){let r=t?.getTileAtWorldPoint(e.world);return!!r&&(r.actionClick(e.world),!0)},resolveContextMenu:function(e){let r=t.getTileAtWorldPoint(e.world);return!!r&&(r.actionContextClick(e.world),!0)},removePassiveSprite:eA,setTileMap:function(e){t=e},update:function(e){t?.update(e),eT.forEach(r=>{let i=t.worldPointToGrid(r.position);r.visible=t.canHeroSeeGridPoint(i),r.update(e);let a=t.worldPointToGrid(r.position);t.moveTileOccupancyGridPoint(r,i,a)}),ew.forEach(r=>{let i=t.worldPointToGrid(r.position);r.visible=t.canHeroSeeGridPoint(i),r.update(e);let a=t.worldPointToGrid(r.position);t.moveTileOccupancyGridPoint(r,i,a)}),eS.forEach(r=>{let i=t.worldPointToGrid(r.position);r.visible=t.canHeroSeeGridPoint(i),r.update(e);let a=t.worldPointToGrid(r.position);t.moveTileOccupancyGridPoint(r,i,a)}),eE.forEach(t=>t.update(e)),t?.updateHighlights(e)}};function eI(e,t,r,i){if(e.font=G(i?.styleName),e.fillStyle=i?.color??"white",i?.wrapAtX){var a=t.split("\n");for(let t=0;t<a.length;t++)i.y=function(e,t,r,i){let a;let n=t.split(" "),s=r.x??0,o=r.y??0,l=i.xWrapPosition-s,h=i.lineSpacing??1,c="";for(let t=0;t<n.length;t++){let r=c+n[t]+" ",i=function(e,t){let r=e.measureText(void 0);return{width:r.width,height:r.fontBoundingBoxAscent+r.fontBoundingBoxDescent,offsetTop:-r.fontBoundingBoxAscent,offsetCentreY:.5*(r.fontBoundingBoxDescent-r.fontBoundingBoxAscent)}}(e);a||(a=h*i.height),i.width>l&&t>0?(e.fillText(c,s,o),c=n[t]+" ",o+=a):c=r}return e.fillText(c,s,o),o+a}(e,a[t],r,i)}else e.fillText(t,r.x??0,r.y??0)}let eR={spriteBoxes:!1,showFps:!1},eO=new Map;var eN={getSpriteBitmap:function(e,t){let r=eO.get(e);return r||t?.quiet||L.debug(`Failed to find image ${e}.`),!(!r&&t?.fallback)||(r=eO.get(t.fallback))||L.debug(`Failed to find fallback image ${t.fallback}.`),r},getUndefinedBitmap:function(){return eO.get("undefined.png")},loadSpriteMap:function(e,t){var r;let i;return L.debug("Loading sprite map."),(r=t,L.debug(`Loading image ${r}`),i=!1,new Promise(e=>{let t=new Image;t.addEventListener("load",()=>{L.debug(`Image ${r} loaded.`),i||e(t)}),t.src=r,t.complete&&(L.debug(`Image ${r} already loaded; possibly cached.`),i=!0,e(t))})).then(t=>(function(e,t){let r=[];return e.frames.forEach(e=>{r.push(createImageBitmap(t,e.frame.x,e.frame.y,e.frame.w,e.frame.h).then(t=>{let r={filename:e.filename,image:t,width:e.frame.w,height:e.frame.h,centreX:e.sourceSize.w/2-e.spriteSourceSize.x,centreY:e.sourceSize.h/2-e.spriteSourceSize.y};return eO.set(e.filename,r),e.filename}))}),Promise.all(r)})(e,t))}};let eC=0;var eP={updateTimeNow:function(e){eC=e},getFrameCount:function(e,t=0){return Math.floor((eC+t)/e)}};let eD={WRAP:0,REVERSE:1,STOP:2};class ev{#n;#s;#o;#l;#h;constructor(e,t){this.#n=e,this.#s=e-1,this.#o=t,this.#l=1,this.#h=0}get index(){return this.#h}set index(e){this.#h=B(e,0,this.#n-1)}advanceBy(e){if(this.#n<1)return this.#h;switch(this.#o){case eD.WRAP:return this.#c(e);case eD.REVERSE:return this.#u(e);case eD.NONE:default:return this.#d(e)}}#c(e){return e%=this.#n,this.#h+=e%this.#n,this.#h>=this.#n&&(this.#h=this.#h-this.#n),this.#h}#u(e){if(Math.floor(e/this.#n)%2&&(this.#l=-this.#l),e%=this.#n,this.#l>0){this.#h+=e;let t=this.#h-this.#s;t>0&&(this.#h=this.#s-t,this.#l=-1)}else this.#l<0&&(this.#h-=e,this.#h<0&&(this.#h=-this.#h,this.#l=1));return this.#h}#d(e){return this.#l>0?this.#h=Math.min(this.#s,this.#h+e):this.#l<0&&(this.#h=Math.max(0,this.#h-e)),this.#h}}let eL={NONE:0};class eM{playing;#f;#p;#m;#g;#S;constructor(e,t){let r;if(this.#f=[],this.#m=0,this.#g=F(0,1e3),"string"==typeof e){this.#f.push(eN.getSpriteBitmap(e));return}this.#S=Math.max(1,t.framePeriodMs);let i=e.startIndex??0,a=e.padding??0;do{let t;let n=`${e.prefix}${i.toString().padStart(a,"0")}${e.suffix}`;t=!(0===i&&(e.prefix.endsWith("idle")||e.prefix.endsWith("dead"))),(r=eN.getSpriteBitmap(n,{quiet:t}))&&this.#f.push(r),i++}while(r)this.#p=new ev(this.#f.length,t.loopMethod),this.playing=!0}getFirstFrame(){return{bitmap:this.#f[0],rotation:0,flip:eL.NONE}}getCurrentFrame(){let e={bitmap:void 0,rotation:0,flip:eL.NONE};if(this.#f.length>1){if(this.playing){let e=eP.getFrameCount(this.#S,this.#g);e!==this.#m&&(this.#p.advanceBy(e-this.#m),this.#m=e)}e.bitmap=this.#f[this.#p.index]}else e.bitmap=this.#f[0];return e.bitmap?e:void 0}setCurrentIndex(e){this.#f.length>1&&(this.playing=!1,this.#p.index=e)}getCurrentIndex(){return this.#f.length>1?this.#p.index:0}}class e_{#w;#E;constructor(e,t){this.#w={},e&&(this.#w[e]=t,this.#E=t)}get image(){return this.#E}addAnimatedImage(e,t){this.#w[e]=t}setCurrentKey(e){this.#w.hasOwnProperty(e)?this.#E=this.#w[e]:L.error(`Attempt to set current key to nonexistent value of ${e}`)}getCurrentFrame(){return this.#E.getCurrentFrame()}getAnimatedImage(e){return this.#w[e]}}class eb{_context;_boundingBoxCanvas;constructor(e){this._context=e,this._boundingBoxCanvas=new Z(0,0,0,0)}getImageFilename(){return null}getContext(){return this._context}getBoundingBoxCanvas(){return this._boundingBoxCanvas}render(e,t){if(e=eg.worldPositionToCanvas(e),!this.isOnCanvas(e))return;let r=this._context.globalAlpha;this._context.globalAlpha=r*t;let i=e.rotation;i&&(this._context.save(),this._context.translate(e.x,e.y),this._context.rotate(-e.rotation),this._context.translate(-e.x,-e.y)),this._doRender(e),i&&this._context.restore(),eR.spriteBoxes&&(this._context.strokeStyle="green",this._context.strokeRect(this._boundingBoxCanvas.x,this._boundingBoxCanvas.y,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height)),this._context.globalAlpha=r}_doRender(e){L.error("_doRender method should be overridden.")}isOnScreen(e){let t=new Z(e.x-this._boundingBoxCanvas.width/2,e.y-this._boundingBoxCanvas.height/2,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height);return eg.isOnScreen(t)}isOnCanvas(e){let t=new Z(e.x-this._boundingBoxCanvas.width/2,e.y-this._boundingBoxCanvas.height/2,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height);return eg.isOnCanvas(t)}}class ez extends eb{#T;#y;#A;text;color;background;constructor(e,t,r={styleName:"normal",color:"white"}){super(e),this.text=t,this.color=r.color,this.#T=r.styleName,this.background=r.background}calculateRenderGeometry(e){this._context.font=G(this.#T);let t=this._context.measureText(e),r=t.fontBoundingBoxAscent+t.fontBoundingBoxDescent;return this.#A={width:t.width,height:r,origin:{x:-.5*t.width,y:.5*(t.fontBoundingBoxAscent-t.fontBoundingBoxDescent)}},this.#y=e,{width:t.width,height:r}}_doRender(e){var t;this.text!==this.#y&&this.calculateRenderGeometry(this.text);let r={x:e.x+this.#A.origin.x,y:e.y+this.#A.origin.y,rotation:e.rotation};this._boundingBoxCanvas=(t=this.#A,new Z(e.x-t.width/2,e.y-t.height/2,t.width,t.height)),this.background&&(this._context.fillStyle=this.background,this._context.fillRect(this._boundingBoxCanvas.x,this._boundingBoxCanvas.y,this._boundingBoxCanvas.width,this._boundingBoxCanvas.height)),eI(this._context,this.#y,r,{color:this.color,styleName:this.#T})}}class ek extends eb{#x;#I;#R;#O;#N;#C;#P;constructor(e,t){super(e),this.#x=t.width??10,this.#I=t.height??10,this.#R=this.#x/2,this.#O=this.#I/2,this.#N=t.fillStyle,this.#C=t.strokeStyle,this.#P=t.lineWidth??2}_doRender(e){this._context.lineWidth=this.#P;let t=e.x-this.#R,r=e.y-this.#O;this.#N&&(this._context.fillStyle=this.#N,this._context.fillRect(t,r,this.#x,this.#I)),this.#C&&(this._context.strokeStyle=this.#C,this._context.strokeRect(t,r,this.#x,this.#I)),this._boundingBoxCanvas=new Z(t,r,this.#x,this.#I)}}class eG extends eb{#I;#O;#x;#R;#N;#C;#D;#v;#L;#M;constructor(e,t){super(e),this.#I=t.height,this.#O=this.#I/2,this.#x=t.width,this.#R=this.#x/2,this.#N=t.fillStyle,this.#C=t.strokeStyle,this.#D=t.offsetX??0,this.#v=t.offsetY??0,this.setLevel(0)}setLevel(e){this.#L=Math.min(e,1)*this.#I,this.#M=.5*this.#L}_doRender(e){let t=e.y-this.#O+this.#v,r=e.y+this.#O-this.#L+this.#v,i=e.x-this.#R+this.#D;this.#N&&(this._context.fillStyle=this.#N,this._context.fillRect(i,r,this.#x,this.#L)),this.#C&&(this._context.strokeStyle=this.#C,this._context.strokeRect(i,t,this.#x,this.#I)),this._boundingBoxCanvas=new Z(i,t,this.#x,this.#I)}}class eU extends eb{#_;constructor(e,t){super(e);let r=Math.max(t.fillStyles.length??0,t.strokeStyles.length??0);if(0===r){L.error("Attempt to create MultiGaugeTileRenderer with no gauges.");return}this.#_=[];let i=t.tileSize/r,a=-t.tileSize/2+i/2;for(let n=0;n<r;n++)this.#_.push(new eG(e,{width:i,height:t.tileSize,fillStyle:t.fillStyles?.[n],strokeStyle:t.strokeStyles?.[n],offsetX:a+i*n,offsetY:0}))}setLevel(e,t){this.#_[e]?.setLevel(t)}render(e){this.#_?.forEach(t=>t.render(e))}}class eB extends eb{#b;#z;constructor(e,t){super(e),t?.getCurrentFrame?(this.#z=t,this.#b=this.#z.getCurrentFrame()):this.#b={bitmap:t,rotation:0,flip:eL.NONE},this.#b?.bitmap?(this._boundingBoxCanvas.width=this.#b.bitmap.width??0,this._boundingBoxCanvas.height=this.#b.bitmap.height??0):L.error("No image frame available for sprite.",t)}getImageFilename(){return this.#b?.bitmap.filename}_doRender(e){if(!this.#b)return;let t=this.#z?this.#z.getCurrentFrame():this.#b;this._boundingBoxCanvas.x=e.x-this._boundingBoxCanvas.width/2,this._boundingBoxCanvas.y=e.y-this._boundingBoxCanvas.height/2,e.rotation=t.rotation,this._context.drawImage(t.bitmap.image,e.x-t.bitmap.centreX,e.y-t.bitmap.centreY)}}class eH{#k=new j(0,0,0);#G=new X(0,0,0);#U=new q(0,0,0);#B;#H;#F;visible;opacity;constructor(e){this.#B=e?.renderer,this.visible=!0,this.opacity=1}get position(){return this.#k}set position(e){this.#k.x=this.valueOrZero(e.x),this.#k.y=this.valueOrZero(e.y),this.#k.rotation=this.valueOrZero(e.rotation)}get velocity(){return this.#G}get acceleration(){return this.#U}set acceleration(e){this.#U=e}set velocity(e){this.#G.x=this.valueOrZero(e.x),this.#G.y=this.valueOrZero(e.y),this.#G.rotation=this.valueOrZero(e.rotation)}replaceTransientModifier(e){this.#F&&this.#F.kill(),this.#F=e}replaceBaseModifier(e){this.#H&&this.#H.kill(),this.#H=e}valueOrZero(e){return"number"==typeof e?e:0}update(e){this.#H&&(this.#H=this.#H.update(this,e)),this.#F&&(this.#F=this.#F.update(this,e)),this.visible&&this.#$()}#$(){this.#B&&(this.#B.forEach?this.#B.forEach(e=>e.render(this.#k,this.opacity)):this.#B.render(this.#k,this.opacity))}getBoundingBox(){let e=this.#B.getBoundingBoxCanvas();return new Z(this.position.x-e.width/2,this.position.y-e.height/2,e.width,e.height)}getImageFilename(){if(!this.#B.forEach)return this.#B.getImageFilename();for(let e of this.#B){let t=e.getImageFilename();if(t)return t}return null}}class eF{decoratedModifier;#W;#Y;#K;constructor(e){this.#Y=0,this.#K=0,this.decoratedModifier=e}#V(e){this.#W&&(this.#W(e),this.#W=null)}kill(){this.#V()}cleanUpOnTimeout(e){}applyAsTransientToSprite(e,t=10){return this.#K=t,new Promise(t=>{this.#W=t,e.replaceTransientModifier(this)})}applyAsContinuousToSprite(e){e.replaceBaseModifier(this)}update(e,t){this.#W&&(this.#Y+=t),this.decoratedModifier&&(this.decoratedModifier=this.decoratedModifier?.update(e,t));let r=this.doUpdate(e,t);return(this.#Y>this.#K&&(this.cleanUpOnTimeout(e),r=null),r)?r:(this.#V(null),null)}doUpdate(e,t){return L.error("doUpdate should be overridden."),this}}class e$ extends eF{#X;#q;#j;#Z;constructor(e,t,r){super(r),this.#q=e,this.#Z=.3*t;let i=t-this.#Z;this.#X=1/Math.max(i,.5),this.#j=-1}doUpdate(e,t){return this.#j<0?this.#j=0:this.#j+=t,this.#j>this.#q+this.#Z?e.opacity=Math.max(0,1-(this.#j-this.#q-this.#Z)*this.#X):e.opacity=1,e.opacity>0?this:null}}class eW{#Q;#J;constructor(e,t){this.#Q=e,this.#J=t}getSpeedBetweenPoints(e,t){return this.#J?this.#Q:(1+.1*(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)))*this.#Q}}class eY extends eF{#ee;#et;constructor(e){super(e)}doUpdate(e,t){return e.position.x+=e.velocity.x*t,e.position.y+=e.velocity.y*t,e.position.rotation+=e.velocity.rotation*t,e.acceleration&&(e.velocity.x+=e.acceleration.x*t,e.velocity.y+=e.acceleration.y*t,e.velocity.rotation+=e.acceleration.rotation*t),this}}class eK extends eF{#er;constructor(e=-Math.PI/2,t){super(t),this.#er=e}static createUprightAligner(e){return new eK(-Math.PI/2,e)}doUpdate(e,t){return e.position.rotation=e.velocity.isZero(.1)?0:e.velocity.getScreenDirection()-this.#er,this}}class eV extends eF{#ei;#ea;#en;constructor(e,t){super(t),this.#ei=e.prey,this.#ea=e.maxSeparation,this.#en=new eW(e.speed,e.linear)}doUpdate(e,t){let r=this.#ei.position,i=e.position,a=this.#en.getSpeedBetweenPoints(r,i);if(!i.withinSquare(r,this.#ea)){let n=i.getCartesianAngleTo(r);e.velocity.x=a*Math.cos(n),e.velocity.y=a*Math.sin(n);let s=e.velocity.x*t,o=e.velocity.y*t;e.position.x+=this.getMinMove(s,r.x,i.x),e.position.y+=this.getMinMove(o,r.y,i.y)}return this}getMinMove(e,t,r){let i=t-r;return 0>Math.sign(e)?Math.max(e,i):Math.min(e,i)}}class eX extends eF{#es;#h;#eo;#en;constructor(e,t){super(t),this.#es=e.path,this.#h=0,this.#eo=e.path[0],this.#en=new eW(e.speed,e.linear)}cleanUpOnTimeout(e){L.debug("Transient path follower timed out. Moving to end of path.");let t=this.#es[this.#es.length-1];e.position.x=t.x,e.position.y=t.y,e.velocity.x=0,e.velocity.y=0}doUpdate(e,t){let r=e.position,i=this.#en.getSpeedBetweenPoints(this.#eo,r),a=r.getCartesianAngleTo(this.#eo);e.velocity.x=i*Math.cos(a),e.velocity.y=i*Math.sin(a);let n=e.velocity.x*t,s=e.velocity.y*t;if(r.x+=this.getMinMove(n,this.#eo.x,r.x),r.y+=this.getMinMove(s,this.#eo.y,r.y),r.isCoincident(this.#eo)){if(++this.#h>=this.#es.length)return e.velocity.x=0,e.velocity.y=0,this.decoratedModifier;this.#eo=this.#es[this.#h]}return this}getMinMove(e,t,r){let i=t-r;return 0>Math.sign(e)?Math.max(e,i):Math.min(e,i)}}function eq(e,t){return new eX({path:[t],speed:100},e.sprite.modifier).applyAsTransientToSprite(e.sprite)}function ej(e,t){let r=new eH({renderer:e});r.position=t.position,r.velocity=t.velocity??new X(0,0,0),r.acceleration=t.acceleration??new q(0,0,0),ex.addPassiveSprite(r),new e$(t.delaySecs,t.lifetimeSecs,new eY).applyAsTransientToSprite(r,20).then(()=>ex.removePassiveSprite(r))}function eZ(e,t){ej(new eB(eg.getContext2D(),e),t)}function eQ(e,t){let r=new ez(eg.getContext2D(),e,{color:t.color,background:t.background}),i=r.calculateRenderGeometry(e);return ej(r,t),i}function eJ(e,t,r="white"){return eQ(e,{color:r,delaySecs:2,lifetimeSecs:3,position:new V(t.x,t.y),velocity:new X(0,-48,0),acceleration:new q(0,-96,0)})}var e4={TILE_SIZE:48};function e0(e){var t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return Math.abs(t).toString(16).toLowerCase().padStart(8,"0")}let e1=new class{#el="";#eh;#ec;constructor(e){this.#el=e,this.#eh=localStorage,this.#ec=new Map}toAppKey(e){return`${this.#el}_${e}`}set(e,t){e=this.toAppKey(e),this.#ec.set(e,t);try{this.#eh.setItem(e,this.toChecksummed(JSON.stringify(t)))}catch(e){L.error(`Cannot save setting. ${e.message}`)}}get(e,t,r){if(e=this.toAppKey(e),this.#ec.has(e))return this.#ec.get(e);let i=t;try{let t=this.#eh.getItem(e);null!==t&&(i=JSON.parse(this.fromChecksummed(t),r))}catch(e){L.error(`Cannot parse value from local storage. ${e.message}`)}return this.#ec.set(e,i),i}clearAll(){this.#eh.clear(),this.#ec.clear(),L.info("All local storage cleared.")}setStorage(e){this.#eh=e}toChecksummed(e){let t=e0(e);return`${t}*${e}`}fromChecksummed(e){let t=e.match(/^([a-z0-9]{8})\*(.*)$/);if(t){if(t[1]===e0(t[2]))return t[2];throw Error("Invalid checksum")}throw Error("Invalid format")}}("ClickAndCrawl");class e8{#eu;_element;#ed;#ef;closes;constructor(e){if(e.closes&&e.action)throw Error("Attempt made to create control that is set to close forms and perform and action. These are mutually exclusive.");if(e.persistent&&!e.id)throw Error("Persistent controls must have an ID set in the options.");this.#eu=e.id,this.#ef=e.persistent,e.persistent?this.#ed=e1.get(this.#eu,e.defValue):this.#ed=e.defValue,this.closes=e.closes,this.listeners=0}get element(){return this._element}get value(){return this.#ed}set value(e){e!==this.#ed&&(this.#ef&&e1.set(this.#eu,e),this.#ed=e)}}class e3 extends e8{constructor(e){super(e),this._element=this.buildElement(e),e.action&&this._element.addEventListener("click",()=>e.action())}buildElement(e){let t=document.createElement("button");return t.appendChild(document.createTextNode(e.label)),t.className="text-button",t}}class e2 extends e8{constructor(e){super(e),this._element=this.buildElement(e),e.action&&this._element.addEventListener("click",()=>e.action())}buildElement(e){let t=document.createElement("button");return e.leftLabel&&t.appendChild(document.createTextNode(e.leftLabel)),t.appendChild(e5(e.imageName,"button-icon")),e.rightLabel&&t.appendChild(document.createTextNode(e.rightLabel)),t.className="icon-button",t}}function e5(e,t){let r=eN.getSpriteBitmap(e??"undefined.png",{fallback:"undefined.png"}),i=document.createElement("canvas");i.setAttribute("width",e4.TILE_SIZE),i.setAttribute("height",e4.TILE_SIZE);let a=i.getContext("2d");return a.clearRect(0,0,e4.TILE_SIZE,e4.TILE_SIZE),a.drawImage(r.image,.5*(e4.TILE_SIZE-r.width),.5*(e4.TILE_SIZE-r.height)),i.className=t,i}class e9 extends e8{#ep;constructor(e){super(e),this._element=this.buildElement(e.label),this.#ep.checked=this.value,this._element.addEventListener("change",t=>{this.value=this.#ep.checked,e.onChange&&e.onChange(this.value)})}buildElement(e){let t=document.createElement("span");t.className="styled-checkbox",this.#ep=document.createElement("input"),this.#ep.setAttribute("type","checkbox"),t.appendChild(this.#ep),t.appendChild(e5("ui-checkbox00.png","unchecked")),t.appendChild(e5("ui-checkbox01.png","checked"));let r=document.createElement("label");return r.appendChild(document.createTextNode(e)),r.appendChild(t),r}}class e6 extends e8{#em;constructor(e){super(e),this._element=this.buildElement(e.label),this.#em.value=this.value,this._element.addEventListener("change",t=>{this.value=this.#em.value,e.onChange&&e.onChange(this.value)})}buildElement(e){let t=document.createElement("span");t.className="styled-range",this.#em=document.createElement("input"),this.#em.setAttribute("type","range"),t.appendChild(this.#em);let r=document.createElement("label");return r.appendChild(document.createTextNode(e)),r.appendChild(t),r}}let e7={TEXT_BUTTON:"text button",CHECKBOX:"checkbox",RANGE:"range"};function te(e,t={}){let r=document.createElement(e);return t.className&&(r.className=t.className),t.html?r.innerHTML=t.html:t.text&&(r.innerText=t.text),t.child&&r.appendChild(t.child),r}function tt(e){let t=r?.get(e);return null==t?e:Array.isArray(t)?t[F(0,t.length)]:t}function tr(e,...t){let r,i="";for(let t of e){let e=t.trim();if(""!==e){r=e;break}}return r?(i=tt(r),t.forEach((e,t)=>{let r=RegExp(`\\$\\{${t}[a-zA-Z_-]*\\}`);i=i.replace(r,e)}),i):t?t.join(" "):""}let ti={setMap:function(e){r=e},getText:tt},ta=new class{onStartAnimation;#eg;#eS;constructor(){this.#eg=!1,this.#eS=void 0,window.addEventListener("blur",()=>{L.debug(`Blur: current animation state ${this.#eg}`),this.#eS=this.#eg,this.setAnimationState(!1)}),window.addEventListener("focus",()=>{L.debug(`Focus: saved animation state ${this.#eS}`),this.setAnimationState(this.#eS??!0),this.#eS=void 0})}setAnimationState(e){e!==this.#eg&&(this.#eg=e,this.#eg&&this.onStartAnimation&&this.onStartAnimation())}isAnimationOn(){return this.#eg}},tn={OK:0,CANCEL:1};function ts(){ta.setAnimationState(!1)}function to(e,t){return eg.displayOnGlass(e,t).then(e=>(ta.setAnimationState(!0),e))}function tl(e,t){let r=te("div",{className:"dialog-scroll-content"});if(t&&r.appendChild(te("p",{className:"dialog-title",text:t})),Array.isArray(e))for(let t of e)r.appendChild(tl(t));else r.appendChild(te("p",{text:e}));return r.classList.add(["scrollable"]),r}function th(e,t={}){ts();let r=document.createElement("div"),i=te("div",{className:"dialog-scroll-content"});r.appendChild(i),t.title&&i.appendChild(te("p",{className:"dialog-title",text:t.title})),t.preamble&&(t.preamble instanceof Element?i.appendChild(t.preamble):i.appendChild(te("p",{text:t.preamble}))),e instanceof Element?i.appendChild(e):i.appendChild(tl(e));let a=te("div",{className:t.row?"action-buttons-row":"action-buttons-col"});r.appendChild(a);let n=[];if(t?.actionButtons?.forEach(e=>{e.element.parentElement||a.appendChild(e.element),null!==e.closes&&void 0!==e.closes&&n.push({element:e.element,closes:e.closes})}),0===n.length){let e=new e3({id:tn.OK,label:t.okButtonLabel??tr`BUTTON OK`});a.appendChild(e.element),n.push(e)}return to(r,{closers:n,className:t?.className})}var tc={popupElement:function(e){let t=document.createElement("div");t.className="popup";let r=document.createElement("div");return t.appendChild(r),r.appendChild(e),t.style.opacity=1,document.body.appendChild(t),t},showChoiceDialog:function(e,t,r,i){document.createElement("div").appendChild(tl(t,e));let a=[];return r?.forEach((e,t)=>{let r=new e3({label:e,closes:t});a.push(r)}),th(t,{preamble:e,actionButtons:a,row:!0,className:i})},showOkDialog:function(e,t={}){ts();let r=document.createElement("div");r.appendChild(tl(e,t.title));let i=document.createElement("button");return i.appendChild(document.createTextNode(t.okButtonLabel??tr`BUTTON OK`)),r.appendChild(i),to(r,{className:t?.className,closers:[{element:i,closes:tn.OK}]})},showElementOkDialog:function(e,t,r=tr`BUTTON OK`,i){ts();let a=document.createElement("div"),n=te("div",{className:"dialog-scroll-content"});a.appendChild(n),e&&n.appendChild(te("p",{className:"dialog-title",text:e})),n.appendChild(t);let s=document.createElement("button");return s.appendChild(document.createTextNode(r)),a.appendChild(s),to(a,{closers:[{element:s,closes:tn.OK}],className:i})},showControlsDialog:th};let tu=new class{#ew;#eE;#eT;#ey;constructor(){this.#eT=.5,this.#ey=.5,this.#ew=new Map}loadAndPlayMusic(e){if(L.debug(`Loading music ${e}`),this.#eE)throw Error("Only one music track currently supported.");this.#eE=this.#eA(e),this.#eE&&this.#eE.addEventListener("canplay",e=>{this.#eE.volume=this.#eT,this.#eE.loop=!0,this.#ex(),window.addEventListener("blur",()=>{this.#eE.pause()}),window.addEventListener("focus",()=>{this.#ex()})})}loadEffects(e){return L.debug("Loading sound effects."),e.forEach((e,t)=>{let r=this.#eA(e);r&&this.#ew.set(t,r)}),Promise.resolve()}#eA(e){return e?new Audio(e):null}playEffect(e){if(this.#ey<=.001)return;let t=this.#ew.get(e);t&&t.readyState>=3&&(t.volume=this.#ey,t.play())}setMusicVolumePercent(e){let t=this.#eT;this.#eT=e/100,this.#eE&&(this.#eE.volume=this.#eT,t<.001&&this.#eT>=.001?(L.debug("Restarted playing music because of volume change."),this.#eE.play()):this.#eT<.001&&(L.debug("Paused playing music because of low volume."),this.#eE.pause()))}#ex(){this.#eE&&(this.#eT>=.001?(L.debug("Restarted playing music."),this.#eE.play()):L.debug("Volume too low to start playing music."))}setEffectsVolumePercent(e){this.#ey=e/100}},td=/^ *(\d+(?:\.\d*)?) *([a-zA-Z]+) *$/,tf=new Map([["PP",10],["GP",1],["SP",.1],["CP",.01]]);function tp(e){let t=0,r=0,i=e.match(td);if(!i)return L.error(`Unrecognised coin "${e}". Value set to zero.`),{valueFace:0,valueGp:0,type:"GP"};{t=i[1];let e=tf.get(i[2])??0;r=parseFloat(i[1])*e}return{valueFace:t,valueGp:r,type:i[2]}}let tm=/(\d+)[dD](\d+)(?: *([+-]) *(\d+))?/;function tg(e=6){return W(1,e)}function tS(e){return tm.test(e)}function tw(e){if(!e)return 1;if(Number.isInteger(e))return tg(e);let t=tT(e);if(!t)return L.error(`String ${e} not recognised as a dice roll. Defaulting to 1D1.`),1;let r=0;for(let e=0;e<t.qty;e++)r+=tg(parseInt(t.sides));return r+t.offset}function tE(e){let t=tT(e);return t?t.qty*(t.sides+t.offset):1}function tT(e){let t=e?.match(tm);if(!t)return L.error(`Invalid dice format: ${e}`),{qty:0,sides:0,offset:0};let r=parseInt(t[1]),i=parseInt(t[2]),a=t[3],n=t[4]?parseInt(t[4]):0;return"-"===a&&(n=-n),{qty:r,sides:i,offset:n}}let ty=[10,200,450,700,1100,1800,2300,2900,3900,5e3,5900,7200,8400,1e4,11500,13e3,15e3,18e3,2e4,22e3,25e3,33e3,41e3,5e4,62e3,75e3,9e4,105e3,12e4,135e3,155e3],tA=[{exp:0,profBonus:2},{exp:300,profBonus:2},{exp:900,profBonus:2},{exp:2700,profBonus:2},{exp:6500,profBonus:3},{exp:14e3,profBonus:3},{exp:23e3,profBonus:3},{exp:34e3,profBonus:3},{exp:48e3,profBonus:4},{exp:64e3,profBonus:4},{exp:85e3,profBonus:4},{exp:1e5,profBonus:4},{exp:12e4,profBonus:5},{exp:14e4,profBonus:5},{exp:165e3,profBonus:5},{exp:195e3,profBonus:5},{exp:225e3,profBonus:6},{exp:265e3,profBonus:6},{exp:305e3,profBonus:6},{exp:355e3,profBonus:6}],tx=[[13,15],[12,14],[11,13],[8,13],[8,13],[8,13]],tI=[8,15],tR=new Map([["BARBARIAN",["STR","CON","DEX","INT","WIS","CHA"]],["CLERIC",["WIS","CON","STR","CHA","INT","DEX"]],["FIGHTER",["STR","CON","DEX","INT","WIS","CHA"]],["RANGER",["STR","DEX","CON","INT","WIS","CHA"]],["ROGUE",["DEX","INT","CHA","STR","CON","WIS"]],["WIZARD",["INT","WIS","STR","CON","DEX","CHA"]],["DEFAULT",["STR","CON","DEX","INT","WIS","CHA"]]]),tO=new Map([["ROGUE",{pbMultiplier:2}],["DEFAULT",{pbMultiplier:1}]]),tN=new Map([["BARBARIAN",[4,8,12,16,19]],["CLERIC",[4,8,12,16,19]],["FIGHTER",[4,6,8,12,14,16,19]],["RANGER",[4,8,12,16,19]],["ROGUE",[4,8,10,12,16,19]],["WIZARD",[4,8,12,16,19]]]);function tC(e){return Math.round(1+5*(e.getInt("LEVEL",1)-1)/8)}function tP(e){return Math.min(Math.round(1+8*(e-1)/16),9)}function tD(e){let t=e.getInt("CASTING_POWER");return e.has("CASTING_POWER")?t:tv(e)}function tv(e){let t=Math.round(4*(2+20*(e.getCharacterLevel()-1)/19));return e.set("CASTING_POWER",t),t}let tL={VERY_EASY:5,EASY:10,MEDIUM:15,HARD:20,VERY_HARD:25,NEARLY_IMPOSSIBLE:30,IMPOSSIBLE:999};function tM(e,t){let r=e.rollForAttack();if(1===r.roll)return L.info("Attack dice rolled 0: cursed."),0;if(20===r.roll)return L.info("Attack dice rolled 20: critical hit. Damage will be doubled."),2*e.rollForDamage();let i=t.getEffectiveInt("AC");return(L.info(`Melee: attack roll ${r.value} vs target AC ${i}`),r.value>=i)?e.rollForDamage():0}function t_(e,t){let r=tw(e.get("DMG_POISON")??e.get("DMG","1D4")),i=t.getNonMeleeSaveAbilityModifier(e),a=e.getInt("DC");if(!a)return L.error(`Poisoner ${e.get("NAME")} has no DC set.`),r;let n=tg(20);return(L.info(`Poison: save roll ${n} + modifier ${i} vs target DC ${a}`),n+i>=a)?Math.round(e.getFloat("DMG_SAVED",0)*r):r}let tb={NONE:"",NEED_LONG_REST:"need long rest",NEED_MORE_RATIONS:"need more rations"};function tz(e){return tT(e.get("HIT_DICE","0D6")).qty-e.getInt("SPENT_HIT_DICE")}function tk(e,t){let r=e.traits.getInt("HP",0),i=r;switch(t){case"SHORT":{let t=e.traits.get("HIT_DICE"),a=e.traits.getInt("SPENT_HIT_DICE",0),n=e.traits.getInt("HP_MAX",r),s=e.traits.getAsModifier("CON"),o=tT(t);o.qty-a>0&&(i=Math.min(i=r+tg(o.sides)+s,n),e.traits.set("HP",i),e.traits.set("SPENT_HIT_DICE",a+1)),e.toxify?.cure()}break;case"LONG":{let t=Math.max(1,Math.ceil(.5*tT(e.traits.get("HIT_DICE")).qty)),a=e.traits.getInt("SPENT_HIT_DICE",0)-t;a=Math.max(0,a),e.traits.set("SPENT_HIT_DICE",a),i=e.traits.getInt("HP_MAX",r),e.traits.set("HP",i),tv(e.traits),e.toxify?.cure()}break;default:L.error(`Attempt to rest for unknown length of ${t}`)}return{oldHp:r,newHp:i}}function tG(e,t){let r=tF(e.getEffectiveInt(t.ability,1)),i=t.proficiency?e.getCharacterPb(t.proficiency):0,a=tg(20)+r+i;return L.info(`Try ${t.proficiency}:D20 + ability(${r}) + proficiency(${i}): ${a} vs ${t.difficulty}`),a>=t.difficulty}function tU(e){return!!e&&(e.includes("ENCHANTED")?3===tg("3D6"):3===tg("3D4"))}function tB(e,t=1){let r=ex.getTileMap();for(let i of r.getRadiating(r.worldPointToGrid(e),t))for(let e of i.getOccupants().values()){let t=e.sleeping;e.sleeping=!1,t&&e.alive&&tB(e.position,1)}}let tH=["STR","DEX","CON","INT","WIS","CHA","AC"];function tF(e){return Math.floor((e-10)/2)}class t${damageDice;proficiencyBonus;abilityModifier;#eI;unarmed;disadvantage;weaponName;weaponType;constructor(e){this.damageDice=e.damageDice??"1D1",this.weaponType=e.weaponType??"","UNARMED"===this.weaponType?(this.unarmed=!0,this.#eI=!1):this.weaponType.includes("SIMPLE")&&this.weaponType.includes("LIGHT")?(this.unarmed=!1,this.#eI=!0):(this.unarmed=!1,this.#eI=!1),this.proficiencyBonus=e?.proficiencyBonus??0,this.abilityModifier=e?.abilityModifier??0,this.disadvantage=e.disadvantage,this.weaponName=e.weaponName}#eR(){return 1+this.abilityModifier}getMaxDamage(){return this.unarmed?this.#eR():tE(this.damageDice)+this.abilityModifier}canUseTwoWeapons(){return this.#eI}rollForAttack(){let e;return this.disadvantage?(L.info("Disadvantage on attack roll!"),e=Math.min(tg(20),tg(20))):e=tg(20),L.info(`Attack roll ${e} + ability(${this.abilityModifier})+ proficiency(${this.proficiencyBonus})`),{roll:e,value:e+this.abilityModifier+this.proficiencyBonus}}rollForDamage(){if(this.unarmed)return this.#eR();let e=Math.max(tw(this.damageDice)+this.abilityModifier);return L.debug(`Damage: ${this.damageDice} + ability(${this.abilityModifier}) = ${e}`),e}clone(){let e=new t$({});return e.abilityModifier=this.abilityModifier,e.damageDice=this.damageDice,e.proficiencyBonus=this.proficiencyBonus,e.#eI=this.#eI,e.unarmed=this.unarmed,e.disadvantage=this.disadvantage,e.weaponName=this.weaponName,e.weaponType=this.weaponType,e}}class tW{_traits;constructor(e){"string"==typeof e?(this._traits=new Map,this.#eO(e)):this._traits=new Map(e)}#eO(e){return e.split(",").forEach(e=>{let t=e.match(/^\s*(\w+)\s*[=: ]\s*(.+?)\s*$/);if(!t)return;let[r,i]=this.#eN(t[1],t[2]);if(t)this.#eC(r,i.trim());else throw Error(`Invalid property definition'${e}'`)}),this}has(e){return this._traits.has(e)||this._traits.has("_"+e)}set(e,t){this._traits.set(e,t),this._refreshDerivedValues(e)}get(e,t){return this._traits.get(e)??this._traits.get("_"+e)??t}delete(e){return this._traits.delete(e)}_refreshDerivedValues(e){}getInt(e,t){return Y(this.get(e,t),t)}addInt(e,t,r=!1){let i=this.getInt(e),a=Y(t)+i;r&&a<0&&(a=0),this._traits.set(e,a)}getValueInFeetInTiles(e,t){let r=this.getInt(e);return null==r?t:tW.feetToTiles(r)}static feetToTiles(e){return Math.round(e/7.5)}getFloat(e,t){return K(this.get(e,t),t)}getAsModifier(e,t){let r=this.getInt(e);return null==r?t:tF(r)}#eN(e,t){return"NAME"!==(e=e.toUpperCase())&&"REWARD"!==e&&(t=t.toUpperCase()),[e,t]}#eC(e,t){switch(e){case"PROF":case"_PROF":return this.#eP(e,t);case"VALUE":case"_VALUE":return this.#eD(e,t);case"DMG":case"_DMG":case"DMG_MELEE":case"_DMG_MELEE":case"DMG_POISON":case"_DMG_POISON":case"DMG_VERSATILE":case"_DMG_VERSATILE":case"HP_GAIN":case"_HP_GAIN":return this.#ev(e,t);case"HIT_DICE":case"_HIT_DICE":return this.#eL(e,t);case"DC":case"_DC":case"IDENTIFY_DC":case"_IDENTIFY_DC":return this.#eM(e,t);default:return this.#e_(e,t)}}#eD(e,t){let r=t.match(/^(.*)([a-zA-Z]{2})$/);if(r){let e;let i=r[1].trim();e=tS(i)?tw(i):Y(r[1],0),t=`${e} ${r[2]}`}else L.error(`Invalid value for VALUE trait: ${t}`),t="0 GP";this.set(e,t)}#eM(e,t){let r;r=isNaN(t)?tL[t]??1:Y(t),this.set(e,r)}#eL(e,t){tS(t)||(L.error(`Invalid trait value ${t} for ${e}. Dice definition required.`),t="1D6"),this.set(e,t)}#ev(e,t){let r;tS(t)?r=t:isNaN(r=parseInt(t))&&(L.error(`Invalid trait value ${t} for ${e}. Integer or dice definition required.`),r=0),this.set(e,r)}#e_(e,t){"YES"===t||"TRUE"===t?t=!0:"NO"===t||"FALSE"===t?t=!1:tS(t)&&"DMG"!==e&&(t=tw(t)),this.set(e,t)}#eP(e,t){let r=t.split(/\s*&\s*/),i=[];r.forEach(e=>i.push(e.toUpperCase())),this._traits.set(e,i)}clone(){return new tW(this._traits)}getAllTraits(){return new Map([...this._traits.entries()])}getAllTraitsSorted(){return new Map([...this._traits.entries()].sort())}valuesToString(){let e="";return this._traits.forEach((t,r)=>{""!==e&&(e+=","),e+=`${r}:${t}`}),e}toJSON(){return{reviver:"Traits",data:[...this._traits]}}static revive(e){return new tW(new Map(e))}}class tY extends tW{constructor(e){super(e??new Map)}getDamageDiceWhenCastBy(e){let t=this.get("DMG");return this.#eb(t,e)}getHpGainDiceWhenCastBy(e){let t=this.get("HP_GAIN");return this.#eb(t,e)}#eb(e,t){let r=this.getFloat("DICE_PER_LEVEL",0),i=this.getInt("LEVEL",0),a=t.getCharacterLevel(),n=function(e,t){let r=tT(e);return r?(r.qty=Math.max(r.qty+t,0),r?r.offset?`${r.qty}D${r.sides}+${r.offset}`:`${r.qty}D${r.sides}`:""):e}(e,Math.floor(Math.max((0===i?Math.min(17,a):tP(a))-i,0)*r));return L.info(`Spell cast: base dice = ${e} raised to ${n} for level.`),n}toJSON(){let e=super.toJSON();return e.reviver="MagicTraits",e}static revive(e){return new tY(new Map(e))}}class tK extends tW{_proficiencyBonus;_level;_attacks;_availableArtefactTraits;_transientFxTraits;_effectiveTraits;transientProperties;_maxTileMovePerTurn;_allowRefreshDerived=!1;constructor(e){super(e??new Map([["NAME","mystery"]])),this._proficiencyBonus=0,this.#ez(),this._transientFxTraits=[],this.transientProperties={},this._allowRefreshDerived=!0,this._refreshDerivedValues()}getMaxTilesPerMove(){return this._maxTileMovePerTurn}clone(){let e=new tK(this._traits);return e._proficiencyBonus=this._proficiencyBonus,e._level=this._level,e._attacks=this._attacks.map(e=>e.clone()),e._availableArtefactTraits=this._availableArtefactTraits,e._effectiveTraits=this._effectiveTraits.clone(),e._transientFxTraits=[],this._transientFxTraits.forEach(t=>e._transientFxTraits.push(t.clone())),e._maxTileMovePerTurn=this._maxTileMovePerTurn,e}exceedAbilitiesAndExp(e,t=0){["STR","DEX","INT","WIS","CON","CHA","EXP"].forEach(r=>{let i=e.getInt(r)+t;i>this.getInt(r)&&this.set(r,i)})}addTransientFxTraits(e){let t=new tW,r=!1;tH.forEach(i=>{let a=tK.toFxKey(i),n=e.getInt(a);n&&(r=!0,t.set(a,n))}),r&&(this._transientFxTraits.push(t),this._refreshDerivedValues())}clearTransientFxTraitsAndProperties(){this._transientFxTraits=[],this.transientProperties={},this._refreshDerivedValues()}#ez(){(function(e){let t=new Map,r=tR.get(e)??tR.get("DEFAULT");for(let e=0;e<r.length;e++){let i=e<tx.length?tx[e]:tI,a=W(i[0],i[1]);t.set(r[e],a)}return t})(this.get("CLASS")).forEach((e,t)=>{this.get(t)||this.set(t,e??8)}),this.has("EXP")||this.set("EXP",0)}_updateHitPoints(){let e=this.has("HP"),t=this.has("HP_MAX"),r=this.get("HIT_DICE");if(!e||!t||r){if(r){this.has("SPENT_HIT_DICE")||this._traits.set("SPENT_HIT_DICE",0);let t=tF(this.getInt("CON",0)),i=tE(r),a=Math.ceil((i+1)/2),n=i+t+(this._level-1)*(a+t);this._traits.set("HP_MAX",n),e||this._traits.set("HP",tE(r)+t)}else e&&this._traits.set("HP_MAX",this.get("HP"))}}static toFxKey(e){return`FX_${e}`}hasEffective(e){return!!this._effectiveTraits&&this._effectiveTraits.has(e)}getEffective(e,t){return this._effectiveTraits.get(e)??this.get(e,t)}getEffectiveInt(e,t){return Y(this.getEffective(e),t)}getCharacterLevel(){return this._level}getNonMeleeSaveAbilityModifier(e){let t=e.get("SAVE_BY","DEX");return tF(this.getInt(t,0)??0)}getCharacterPb(e){return this.isProficient(e)?this._proficiencyBonus:0}getAttacks(){return this._attacks}utiliseAdditionalTraits(e){this._availableArtefactTraits=e,this._refreshDerivedValues()}_refreshDerivedValues(e){this._allowRefreshDerived&&(!e||tH.includes(e))&&(this._adjustForExperience(),this._updateHitPoints(),this._initialiseEffectiveTraits(),"ENEMY"===this.get("TYPE_ID")?this._deriveValuesFromTraits():(this._utiliseTransientTraits(),this._utiliseMagicTraits(),this._utiliseWeaponsTraits(),this._utiliseArmourAndShieldTraits(),this._adjustMovementForArmour()))}_deriveValuesFromTraits(){this._maxTileMovePerTurn=this.getValueInFeetInTiles("SPEED",1),this._attacks=[];let e=new t$({damageDice:this._traits.get("DMG"),weaponType:"ALMANAC",proficiencyBonus:this.getInt("PB",0),abilityModifier:0,secondAttack:!1});this._attacks.push(e)}_initialiseEffectiveTraits(){this._effectiveTraits=new tW,tH.forEach(e=>{this._effectiveTraits.set(e,this.getInt(e,0))})}_utiliseTransientTraits(){this._transientFxTraits?.forEach(e=>{L.debug(`Transient traits: ${e.valuesToString()}`),this._addFxTraitsToEffectiveTraits(e)})}_addFxTraitsToEffectiveTraits(e){tH.forEach(t=>{let r=e.getInt(tK.toFxKey(t));r&&this._effectiveTraits.addInt(t,r,!0)})}_utiliseMagicTraits(){if(this?._availableArtefactTraits?.magic)for(let e of this._availableArtefactTraits.magic)L.debug(`Magic traits: ${e.valuesToString()}`),this._addFxTraitsToEffectiveTraits(e)}_utiliseArmourAndShieldTraits(){let e=this.getEffectiveInt("AC",0),t=this?._availableArtefactTraits?.armour,r=this?._availableArtefactTraits?.shields,i=0,a=0;t?.forEach(t=>{let r=this._getAcFromTraits(t);r.additional?i+=r.value:r.value>e&&(e=r.value)}),r?.forEach(e=>{a=Math.max(a,e.getInt("AC",0))});let n=e+i+a;this._effectiveTraits.set("AC",n)}_adjustMovementForArmour(){let e=this.getFloat("SPEED",1);if(this._maxTileMovePerTurn=Math.max(1,tW.feetToTiles(e)),this._availableArtefactTraits?.armour){for(let t of this._availableArtefactTraits.armour)if(t.get("TYPE","").toUpperCase().includes("HEAVY")&&t.getInt("STR",0)>this.getEffectiveInt("STR")){this._maxTileMovePerTurn=Math.max(0,tW.feetToTiles(e-10));return}}}_utiliseWeaponsTraits(){var e;let t,r,i,a,n,s,o;this._attacks=[];let l=this?._availableArtefactTraits?.weapons??[],h=this?._availableArtefactTraits?.shields??[],c=2-l.length-h.length,u=tF(this.getEffectiveInt("STR",1)),d=(e=this.get("CLASS"),tO.get(e)??tO.get("DEFAULT")),f=this._proficiencyBonus*d.pbMultiplier;l.length>2&&L.error(`Unexpected number of equipped weapons. Expected 2; received ${l.length}`),0===l.length?(i="",r="UNARMED",a=!0,n=0):(c>0&&l[0].get("TYPE").indexOf("VERSATILE")>=0&&(i=l[0].get("DMG_VERSATILE")),i||(i=l[0].get("DMG","1D1")??"1D1"),r=l[0].get("TYPE")??"",a=this.isProficient(l[0]),n=l[0].getInt("ATTACK_BONUS",0),s=l[0].get("NAME")),t=new t$({damageDice:i,weaponType:r,proficiencyBonus:a?f:0,abilityModifier:u+n,weaponName:s}),l.length>1&&(n=l[1].getInt("ATTACK_BONUS",0),o=new t$({damageDice:l[1].get("DMG","1D1")??"1D1",weaponType:l[1].get("TYPE")??"",proficiencyBonus:this.isProficient(l[1])?f:0,abilityModifier:u+n,weaponName:l[1].get("NAME")})),o?.canUseTwoWeapons()&&t.canUseTwoWeapons()?(this._attacks.push(t),u>0&&(o.abilityModifier-=u),this._attacks.push(o)):o&&o.getMaxDamage()>t.getMaxDamage()?this._attacks.push(o):this._attacks.push(t)}_getAcFromTraits(e){let t=tF(this.getEffectiveInt("DEX",1)),r=e.get("TYPE","").toUpperCase(),i=e.get("AC",1),a=Y(i);return r.includes("MEDIUM")?a+=Math.min(2,t):r.includes("HEAVY")||(a+=t),{additional:/^[+-]/.test(i),value:a}}_adjustForExperience(){let e=this._level??1,t=function(e){let t=Y(e,0),r=0,i=0;do if(t>=tA[i++].exp)r=i;else break;while(i<tA.length)return{level:r,profBonus:tA[r-1].profBonus}}(this._traits.get("EXP"));this._level=t.level,this._proficiencyBonus=t.profBonus,this._adjustTraitsForLevelChange(e,this._level)}_adjustTraitsForLevelChange(e,t){var r;let i=(r=this.get("CLASS"),{levels:tN.get(r)??[],traits:tR.get(r)??tR.get("DEFAULT"),gainPerAdjustment:2,maxAbility:20});if(0===i.levels.length)return;let a=0;for(let r of i.levels){if(r>t)break;r>e&&(a+=i.gainPerAdjustment)}let n=0;for(;a>0&&n<i.traits.length;){let e=i.traits[n],t=this.get(e);t<i.maxAbility?(this.set(e,t+1),a--):n++}}adjustForDefeatOfActor(e){let t;let r=(t=K(e.get("CR")))<.124?10:t<.249?25:t<.499?50:t<.999?100:(t=Math.min(ty.length-1,parseInt(t)),ty[t]),i=this.getInt("EXP",0),a=i+r;L.info(`Experience increased from ${i} to ${a}.`),this.set("EXP",a);let n=this._level;return this._refreshDerivedValues(),{exp:{was:i,now:a},level:{was:n,now:this._level}}}isProficient(e){let t=this.get("PROF"),r="string"==typeof e?e:e.get("TYPE");if(!t||!r)return!1;for(let e of t){let t=e.split(" "),i=!0;for(let e of t)if(!r.includes(e)){i=!1;break}if(i)return!0}return!1}toJSON(){let e=super.toJSON();return e.reviver="CharacterTraits",e}static revive(e){return new tK(new Map(e))}}function tV(e="?"){if(e.len<2)return e;let t=e.replace(/_pv$/i,"").replace(/_/g," "),r=t.charAt(0).toUpperCase()+t.substring(1);return ti.getText(r)}function tX(e){let t=`DESCRIPTION ${e.toUpperCase()}`,r=ti.getText(t);return t===r?(L.error(`No description set for ${t}.`),""):r}function tq(e){return fetch(e).then(e=>e.text()).then(e=>e).catch(t=>(L.error(`Error fetching ${e}: ${t}`),null))}let tj={COMMON:"COMMON",UNCOMMON:"UNCOMMON",RARE:"RARE",VERY_RARE:"VERY_RARE"};class tZ{common;uncommon;rare;veryRare;constructor(){this.common=[],this.uncommon=[],this.rare=[],this.veryRare=[]}mergeAlmanac(e){this.common.push(...e.common),this.uncommon.push(...e.uncommon),this.rare.push(...e.rare),this.veryRare.push(...e.veryRare)}find(e){let t=this.common.find(e);return t||(t=this.uncommon.find(e))||(t=this.rare.find(e))?t:this.veryRare.find(e)}filter(e){let t=new tZ;return t.common=e?this.common.filter(e):[...this.common],t.uncommon=e?this.uncommon.filter(e):[...this.uncommon],t.rare=e?this.rare.filter(e):[...this.rare],t.veryRare=e?this.veryRare.filter(e):[...this.veryRare],t}getRandomEntry(){let e=Math.random();return e<.8?this.getRandomCommonEntry():e<.95?this.getRandomUncommonEntry():e<.99?this.getRandomRareEntry():this.getRandomVeryRareEntry()}getRandomCommonEntry(){return $(this.common)}getRandomUncommonEntry(){return 0===this.uncommon.length?this.getRandomCommonEntry():$(this.uncommon)}getRandomRareEntry(){return 0===this.rare.length?this.getRandomUncommonEntry():$(this.rare)}getRandomVeryRareEntry(){return 0===this.veryRare.length?this.getRandomRareEntry():$(this.veryRare)}}function tQ(e,t){var r;let i=e.match(/^ *(\d+) *, *(\w+ ?\w+) *, *(\w+) *, *([\w+?/]*) *(?:\[ *([\w, ]*?)])? *\*(.*)$/);if(!i)return L.error(`Invalid almanac entry ${e}`),null;let a={},n=i[6]??"";a.minLevel=parseInt(i[1]),a.rarity=i[2].toUpperCase(),a.typeId=i[3],a.type=tJ.getItemType(t,a.typeId),a.id=i[4];let s=function(e="?"){let t,r,i;let a=e.match(/^(\w+)([+?/])?(\w*)?$/);if(!a)return{};let n=a[1];switch(a[2]){case"?":t=n,r=e,i=n;break;case"+":t=n,r=n,i=void 0;break;case"/":t=a[3],r=a[3],i=void 0;break;default:t=e,r=e,i=void 0}return{name:tV(t),imageName:n.toLowerCase(),description:tX(r),unknownDescription:i?tX(i):void 0}}(a.id);return a.name=s.name,a.imageName=s.imageName,a.description=s.description,a.unknownDescription=s.unknownDescription,a.equipmentIds=(r=i[5])?r.trim().split(/\s*,\s*/):r,a.traitsString=`_TYPE_ID:${a.typeId},${n}`,a.challengeRating=function(e){let t=e?.match(/CR *[:=] *([\d.]+)/);return t?K(t[1],0):0}(a.traitsString),a}let tJ=new class{#ek;constructor(){this.#ek=new Map}addAlmanac(e,t){this.#ek.set(e,t)}getAlmanac(e){let t=this.#ek.get(e);return t||L.error(`Attempt to get non-existent almanac ${e}`),t}getRandomEntry(e,t){let r;r=Array.isArray(e)?$(e):e;let i=this.getAlmanac(r).filter(t);if(i)return i.getRandomEntry();L.error(`Failed to find almanac with key ${r}`)}findById(e,t){for(let r of(t||(t=this.#ek.keys()),t)){let t=this.#ek.get(r)?.find(t=>t.id===e);if(t)return t}L.error(`Failed to find almanac entry for '${e}' in ${t.join(", ")}`)}getPooledAlmanac(e,t){let r=new tZ;return e.forEach(e=>{let i=this.getAlmanac(e).filter(t);r.mergeAlmanac(i)}),r}getItemType(e,t){switch(e){case"HEROES":case"ENEMIES":case"PORTALS":case"TRADERS":return function(e){let t=nr[e];return null==t&&L.error(`Unrecognised actor type: ${e}`),t}(t);default:return function(e){let t=t1[e];return null==t&&L.error(`Unrecognised artefact type: ${e}`),t}(t)}}};function t4(e,t){let r,i;t8(e.type,t1.SPELL)?(r=t??new tY(e.traitsString),i="spell"):t8(e.type,t1.CANTRIP)?(r=t??new tY(e.traitsString),i="cantrip"):(r=t??new tW(e.traitsString),i=e.imageName),r.set("NAME",e.name);let a=function(e,t){let r=new t5(e,t.description,`${t.imageName}.png`,t.unknownDescription);return r.traits=t.traits,r}(e,{description:e.description,unknownDescription:e.unknownDescription,imageName:i,traits:r});return a.isTrap()?a.interaction=new ne(a):a.isMagic()?a.interaction=new a9(a):a.isConsumable()&&(a.interaction=new a6(a)),a}let t0={HEAD:{id:"HEAD",space:1,money:!1,spacesExpand:!1},BODY:{id:"BODY",space:1,money:!1,spacesExpand:!1},WAIST:{id:"WAIST",space:1,money:!1,spacesExpand:!1},HANDS:{id:"HANDS",space:2,money:!1,spacesExpand:!1},FEET:{id:"FEET",space:2,money:!1,spacesExpand:!1},BACKPACK:{id:"BACKPACK",space:8,money:!1,spacesExpand:!0},WAGON:{id:"WAGON",space:8,money:!1,spacesExpand:!0},CANTRIPS:{id:"CANTRIPS",space:999,money:!1,spacesExpand:!0},RING_FINGERS:{id:"RING_FINGERS",space:2,money:!1,spacesExpand:!1},SPELLS:{id:"SPELLS",space:9,money:!1,spacesExpand:!0},PREPARED_SPELLS:{id:"PREPARED SPELLS",space:9,money:!1,spacesExpand:!0},PURSE:{id:"PURSE",space:Number.MAX_SAFE_INTEGER,money:!0,spacesExpand:!1}},t1={ARMOUR:{id:"armour",storageSpace:1,storeType:{stash:t0.WAGON,equip:t0.BODY}},BELT:{id:"belt",storageSpace:1,storeType:{stash:t0.BACKPACK,equip:t0.WAIST}},CANTRIP:{id:"cantrip",storageSpace:1,storeType:{stash:null,equip:t0.CANTRIPS}},COINS:{id:"coins",storageSpace:0,storeType:{stash:t0.PURSE}},CONSUMABLE:{id:"consumable",storageSpace:1,storeType:{stash:t0.BACKPACK}},GENERIC:{id:"generic",storageSpace:1,storeType:{stash:t0.BACKPACK}},HEAD_GEAR:{id:"head_gear",storageSpace:1,storeType:{stash:t0.BACKPACK,equip:t0.HEAD}},KEY:{id:"key",storageSpace:1,storeType:{stash:t0.BACKPACK}},RING:{id:"ring",storageSpace:1,storeType:{stash:t0.BACKPACK,equip:t0.RING_FINGERS}},SHIELD:{id:"shield",storageSpace:1,storeType:{stash:t0.BACKPACK,equip:t0.HANDS}},SPELL:{id:"spell",storageSpace:1,storeType:{stash:t0.SPELLS,equip:t0.PREPARED_SPELLS}},TRAP:{id:"trap",storageSpace:1,storeType:{stash:t0.BACKPACK}},TWO_HANDED_WEAPON:{id:"two_handed_weapon",storageSpace:2,storeType:{stash:t0.BACKPACK,equip:t0.HANDS}},WEAPON:{id:"weapon",storageSpace:1,storeType:{stash:t0.BACKPACK,equip:t0.HANDS}}};function t8(e,t){return e?.id===t?.id}class t3{#eG;#eU;#eB;#eH;#eF;constructor(e,t,r){this.#eG=e,this.#eB=0,this.#eU=new Map,this.#eH=t,this.#eF=r}get storeTypeId(){return this.#eF.id}get storeType(){return this.#eF}get freeSpace(){return this.#eG-this.#eB}get maxSpace(){return this.#eG}adjustCapacity(e){return this.#eG=Math.max(e,this.#eB),this.#eG}isEmpty(){return 0===this.#eB}getRequiredSpace(e){return this.#eH?1:e.storageSpace}has(e){return this.#eU.has(e)}add(e){let t=this.#eG-this.#eB,r=this.getRequiredSpace(e);return t>=r&&(this.#eU.set(e,e),this.#eB+=r,!0)}take(e){let t=this.#eU.get(e),r=this.getRequiredSpace(e);return t&&(this.#eB-=r,this.#eU.delete(t)),t}getFirst(){return this.isEmpty()?null:this.#eU.values().next().value}takeFirst(){if(this.isEmpty())return null;let e=this.#eU.values().next().value;return this.take(e)}values(){return this.#eU.values()}canAdd(e){let t=this.getRequiredSpace(e);return this.#eG-this.#eB>=t}}class t2{#e$;#eW;constructor(){this.#eW=!1}get storeType(){return t0.PURSE}get storeTypeId(){return t0.PURSE.id}isEmpty(){return!this.#e$||0===this.#e$.costInGp}has(e){return this.#e$.costInGp>0}add(e){let t=e.costDetails;if(!this.#e$)return this.#e$=e.clone(),!0;let r=this.#e$.costDetails;return this.#eW||(this.#e$=t2.createGoldCoinArtefact(r.valueGp),this.#eW=!0),this.#e$.costInGp=r.valueGp+t.valueGp,!0}take(e){let t=Math.min(this.#e$.costInGp,e.costInGp);return this.#e$.costInGp=this.#e$.costInGp-t,e.costInGp=t,e}canAdd(e){return!0}values(){return this.#e$&&0!==this.#e$.costInGp?[this.#e$.clone()].values():[].values()}static createGoldCoinArtefact(e){let t=t4(tQ(`0,COMMON,COINS,gold_coins * VALUE:${e}GP`));return t.costInGp=e,t}}class t5{id;iconImageName;description;artefactType;traits;interaction;almanacEntry;unknown;constructor(e,t,r,i){this.id=e.id,this.description=t,this.iconImageName=r,this.artefactType=e.type,this.almanacEntry=e,this.unknownDescription=i,this.unknown=!!i}get costDetails(){return tp(this.traits?.get("VALUE"))}get costInGp(){return this.unknown?.08:tp(this.traits?.get("VALUE")).valueGp}get sellBackPriceInGp(){return t8(this.artefactType,t1.COINS)?this.costInGp:Math.round(50*(this.unknown?.08:this.costInGp))/100}set costInGp(e){if(!this.traits)throw Error("Artefact has no traits so cannot set cost.");this.traits.set("VALUE",`${e.toFixed(2)} GP`)}get storageSpace(){return this.artefactType.storageSpace}get stashStoreType(){return this.artefactType.storeType.stash}get equipStoreType(){return this.artefactType.storeType.equip}get stashInWagon(){return this.stashStoreType===t0.WAGON}getDefaultStoreType(){return this.artefactType.storeType.stash??this.artefactType.storeType.equip}getStoreTypes(){let e=[];return this.artefactType.storeType.stash&&e.push(this.artefactType.storeType.stash),this.artefactType.storeType.equip&&e.push(this.artefactType.storeType.equip),e}clone(){let e=new t5(this.almanacEntry,this.description,this.iconImageName,this.unknownDescription);return e.traits=this.traits.clone(),e.value=this.value,e.unknown=this.unknown,e}isMagic(){return t8(this.artefactType,t1.SPELL)||t8(this.artefactType,t1.CANTRIP)}isTrap(){return t8(this.artefactType,t1.TRAP)}isPlant(){return"VEGETATION"===this.traits.get("SUBTYPE","")}isUsable(){return!!this.interaction?.canReact()}isConsumable(){return t8(this.artefactType,t1.CONSUMABLE)}toJSON(){return{reviver:"Artefact",data:{almanacEntry:this.almanacEntry,traits:this.traits,unknown:this.unknown}}}static revive(e,t){e.almanacEntry.type=t1[e.almanacEntry.type.id.toUpperCase()];let r=t(e.almanacEntry,e.traits);return r.unknown=e.unknown,r}}class t9{#eY;#eK;#eV;constructor(e,t){for(let t in this.#eY=new Map,this.#eK=e,t0){let e=t0[t];this.#eX(e)}this.#eV=t}get hasWagon(){return this.#eK}#eq(){this.#eV&&this.#eV()}#eX(e){if(e.money)return this.#eY.set(e,new t2(e.space,e.spacesExpand));let t=!0;this.#eK&&e===t0.BACKPACK?t=!1:this.#eK||e!==t0.WAGON||(t=!1),t&&this.#eY.set(e,new t3(e.space,e.spacesExpand,e))}getStore(e){return this.#eK&&e===t0.BACKPACK&&(e=t0.WAGON),this.#eY.get(e)}getStoreByTypeId(e){for(let t of this.#eY.values())if(t.storeTypeId===e)return t;return null}findSuitableStore(e){let t=e.stashStoreType,r=this.getStore(t);return(r||(t=e.equipStoreType,r=this.getStore(t)),r?.canAdd(e))?r:null}addArtefact(e){let t=this.getStore(e.getDefaultStoreType()),r=t?.add(e);return this.#eq(),r}getFirstStorageDetails(){for(let e of this.#eY.values()){let t=e.values(),r=t.next()?.value;if(r)return{store:e,artefact:r}}return null}hasArtefactWithSameId(e){let t="string"==typeof e?e:e.id;for(let e of this.getAllStorageDetails())if(e.artefact.id===t)return!0;return!1}getArtefactWithSameId(e){let t="string"==typeof e?e:e.id;for(let e of this.getAllStorageDetails())if(e.artefact.id===t)return e.artefact}hasArtefact(e){for(let t of this.getAllStorageDetails())if(t.artefact===e)return!0;return!1}getAllEquippedArtefacts(){let e=[];for(let t of[this.#eY.get(t0.HEAD),this.#eY.get(t0.BODY),this.#eY.get(t0.WAIST),this.#eY.get(t0.HANDS),this.#eY.get(t0.RING_FINGERS),this.#eY.get(t0.FEET),this.#eY.get(t0.CANTRIPS),this.#eY.get(t0.PREPARED_SPELLS)])for(let r of t.values())e.push(r);return e}getAllStorageDetails(){let e=[];return this.#eY.forEach(t=>{for(let r of t.values())e.push({store:t,artefact:r})}),e}getPurseValue(){let e=this.getStore(t0.PURSE).values(),t=e.next()?.value;return t?t.costInGp:0}addToPurse(e){let t=t2.createGoldCoinArtefact(e);this.#eY.get(t0.PURSE).add(t),this.#eq()}takeFromPurse(e){let t=t2.createGoldCoinArtefact(e),r=this.#eY.get(t0.PURSE).take(t);return this.#eq(),r.costInGp}getStoreContents(e){let t=this.getStore(e);return!t||t.isEmpty()?null:t.values()}discard(e){return!!this.discardStashed(e,!0)||this.discardEquipped(e)}discardEquipped(e,t){let r=this.getStore(e.equipStoreType);return r?r.take(e)?(this.#eq(),!0):(t||L.error("Artefact could not be found so not discarded."),!1):(t||L.error("Cannot discard artefact as there isn't an equip store."),!1)}discardStashed(e,t){let r=this.getStore(e.stashStoreType);return r?r.take(e)?(this.#eq(),!0):(t||L.error("Artefact could not be found so not discarded."),!1):(t||L.error("Cannot discard artefact as there isn't a stash store."),!1)}equip(e,t={}){let r=this.getStore(e.stashStoreType),i=this.getStore(e.equipStoreType);if(!r&&!t.direct)return L.error("Cannot equip artefact as there isn`t a stash store to take it from."),!1;if(!i)return L.error("Cannot equip artefact as there isn't an equip store."),!1;if(i.getRequiredSpace(e)>i.maxSpace)return L.error("The equip store cannot hold this item."),!1;if(!r?.has(e)&&!t.direct)return L.error("Could not find artefact in the stash."),!1;if(!i.canAdd(e)&&t.noAutoUnequip)return L.error("No space to equip and no automatic unequipping permitted."),!1;let a=this.#ej(e,i,r);return this.#eq(),a}#ej(e,t,r){let i=t.getRequiredSpace(e);if(i>t.maxSpace)return L.error("The equip store cannot hold this item."),!1;if(!r)return t.add(e);let a=r.freeSpace+r.getRequiredSpace(e),n=[];for(;t.freeSpace<i&&a>0;){let e=t.takeFirst();n.push(e),a-=r.getRequiredSpace(e)}if(t.freeSpace<i){for(let e of n)t.add(e);return!1}for(let i of(r.take(e),t.add(e),n))r.add(i);return!0}stash(e,t={}){let r=this.getStore(e.stashStoreType),i=this.getStore(e.equipStoreType);if(!r)return L.debug("Cannot stash artefact as there isn`t a suitable stash store to put it in."),!1;if(!i&&!t.direct)return L.error("No suitable equip store found. If stashing a new artefact, the direct option should be set."),!1;if(!r.canAdd(e))return L.error("The stash store cannot hold this item."),!1;if(!i?.take(e)&&!t.direct)return L.error("The artefact hasn't been equipped so can't unequip it."),!1;let a=r.add(e);return this.#eq(),a}}function t6(e,t,r){return{centre:e[t]?.[r],tl:e[t-1]?.[r-1],above:e[t-1]?.[r],tr:e[t-1]?.[r+1],right:e[t]?.[r+1],br:e[t+1]?.[r+1],below:e[t+1]?.[r],bl:e[t+1]?.[r-1],left:e[t]?.[r-1]}}function t7(e,t){let r;let i=t.columnIndex,a=t.rowIndex,n=[],s=!0,o=!0,l=1,h=t.distance??1;for(;h-- >0;)s&&(r=e[a-l][i],t.filter&&!t.filter(r)?s=!1:n.push(r)),o&&(r=e[a+l][i],t.filter&&!t.filter(r)?o=!1:n.push(r)),l++;return n}function re(e){let t,r=e.length;for(;r>0;)t=Math.floor(Math.random()*r),r--,[e[r],e[t]]=[e[t],e[r]];return e}let rt={WALL:["#","*","|"],DOOR_IN:["-","~"],DOOR_OUT:["=",">"],GROUND:[".",":",",",";"],VOID:[" "]},rr={TOP_LEFT:"-TL",TOP_LEFT_INTERNAL:"-TLI",TOP:"-T",TOP_RIGHT:"-TR",TOP_RIGHT_INTERNAL:"-TRI",RIGHT:"-R",BOTTOM_RIGHT:"-BR",BOTTOM_RIGHT_INTERNAL:"-BRI",BOTTOM:"-B",BOTTOM_LEFT:"-BL",BOTTOM_LEFT_INTERNAL:"-BLI",LEFT:"-L",TOP_TEE:"-TTEE",RIGHT_TEE:"-RTEE",BOTTOM_TEE:"-BTEE",LEFT_TEE:"-LTEE",INTERNAL_CROSS:"-XI",INTERNAL_VERTICAL:"-VI",INTERNAL_HORIZONTAL:"-HI"},ri={BELOW_WALL:"-SBW",BELOW_END_WALL:"-SBE"};class ra{matrix;entryPointByDoor;exitPointByDoor;constructor(){this.entryPointByDoor=new V(0,0),this.exitPointByDoor=new V(0,0)}static generateTileMapPlan(e,t){let r=new ra,i=r.convertToMatrix(e);return i=r.clarifyMatrix(i),r.createPlan(i,t),r}convertToMatrix(e){let t=[],r=0;return e.forEach(e=>{r=Math.max(r,e.length)}),e.forEach(e=>{e.length<r&&(e+=" ".repeat(r-length)),t.push(e.split(""))}),t}clarifyMatrix(e){let t=[];return e.forEach((r,i)=>{let a=[];t.push(a),r.forEach((t,r)=>{var n,s,o,l;let h;let c=t6(e,i,r);(n=t,rt.VOID.includes(n))?t=" ":ro(t)?(s=t,rl(c.above)&&(rl(c.tl)?s+=ri.BELOW_WALL:s+=ri.BELOW_END_WALL),o=t=s,rn(c.left)||rn(c.above)||rn(c.right)||rn(c.below))?this.entryPointByDoor=new V(r,i):(rs(c.right)||rs(c.below)||rs(c.left)||rs(c.above))&&(this.exitPointByDoor=new V(r,i)):rl(t)&&(h=l=t,rl(c.above)&&rl(c.right)&&rl(c.below)&&rl(c.left)?h+=rr.INTERNAL_CROSS:ro(c.left)&&ro(c.right)?h+=rr.INTERNAL_VERTICAL:ro(c.above)&&ro(c.below)?h+=rr.INTERNAL_HORIZONTAL:rl(c.left)&&rl(c.right)&&rl(c.below)?h+=rr.TOP_TEE:rl(c.above)&&rl(c.below)&&rl(c.left)?h+=rr.RIGHT_TEE:rl(c.left)&&rl(c.right)&&rl(c.above)?h+=rr.BOTTOM_TEE:rl(c.above)&&rl(c.below)&&rl(c.right)?h+=rr.LEFT_TEE:rl(c.right)&&rl(c.below)?h+=ro(c.br)?rr.TOP_LEFT:rr.TOP_LEFT_INTERNAL:rl(c.left)&&rl(c.below)?h+=ro(c.bl)?rr.TOP_RIGHT:rr.TOP_RIGHT_INTERNAL:rl(c.left)&&rl(c.above)?h+=ro(c.tl)?rr.BOTTOM_RIGHT:rr.BOTTOM_RIGHT_INTERNAL:rl(c.right)&&rl(c.above)?h+=ro(c.tr)?rr.BOTTOM_LEFT:rr.BOTTOM_LEFT_INTERNAL:rl(c.above)&&rl(c.below)?h+=ro(c.right)?rr.LEFT:rr.RIGHT:rl(c.right)&&rl(c.left)&&(h+=ro(c.below)?rr.TOP:rr.BOTTOM),t=rl(c.above)?h+ri.BELOW_WALL:h),a.push(t)})}),t}createPlan(e,t){let r=[];e.forEach(e=>{let i=[];r.push(i),e.forEach(e=>{i.push(function e(t,r){if(" "===t)return null;let i=t.match(/(.)(-[^-]*)?(-[^-]*)?/),a=r.get(t);if(!a&&i[2]&&i[3]&&(a=r.get(`${i[1]}${i[2]}`)),!a&&i[2]&&(a=r.get(i[1])),!a){let a=function(e){for(let t in rt)if(rt[t].includes(e))return rt[t][0];return null}(i[1]);if(a&&a!==i[1]){var n,s;let t;return e((n=i[2],s=i[3],t=a,n&&(t+=n),s&&(t+=s),t),r)}L.error(`Failed to find symbol for ${t}`)}return a}(e,t))})}),this.matrix=r}}function rn(e){return rt.DOOR_IN.includes(e)}function rs(e){return rt.DOOR_OUT.includes(e)}function ro(e){return rt.GROUND.includes(e)}function rl(e){var t;return rt.WALL.includes(e)||rn(t=e)||rs(t)}class rh{#eZ;#eQ;#eJ;#e4;setOnClick(e){this.#eZ=e}setOnContextClick(e){this.#eQ=e}setOnPointerDown(e){this.#eJ=e}setOnPointerUp(e){this.#e4=e}actionClick(e){this.#eZ?.(this,e)}actionContextClick(e){this.#eQ?.(this,e)}actionPointerDown(e){this.#eJ?.(this,e)}actionPointerUp(e){this.#e4?.(this,e)}}class rc{#e0;#e1;constructor(e){this.#e1=e,this.#e0=new Map}setRouteToCoords(e,t,r){this.#e0.set(this.coordsToKey(t,r),e)}getRouteToCoords(e,t){return this.#e0.get(this.coordsToKey(e,t))}hasRouteToCoords(e,t){return this.#e0.has(this.coordsToKey(e,t))}coordsToKey(e,t){return`${e}|${t}`}keyToGridPoint(e){let t=e.split("|");return new V(parseInt(t[0]),parseInt(t[1]))}forEach(e){this.#e0.forEach((t,r,i)=>e(t,r,i))}containsGridPoint(e){return this.#e0.has(this.coordsToKey(e.x,e.y))}getWaypointsAsGridPoints(e){let t=this.getRouteToCoords(e.x,e.y);return t&&t.length>1?t.slice(1):null}getWaypointsAsWorldPoints(e){let t=this.getWaypointsAsGridPoints(e);return t?t.map(e=>this.#e1.gridPointToWorldPoint(e)):t}}class ru{actor;#e0;#e1;#e8;constructor(e,t){this.#e1=e,this.actor=t}getDumbRouteNextTo(e,t,r){let i=this.#e3(e,t);if(i.coincident(e))return[];this.#e1.canGridPointBeOccupiedByActor(i,this.actor)||(i=this.#e2(i,t));let a=[],n=Math.sign(i.x-e.x),s=Math.sign(i.y-e.y),o=V.copy(e),l=.5>Math.random(),h=0;for(;r>0;){let t=V.copy(o),c=!1;if(l&&0!==n&&o.x!=i.x?(t.x+=n,c=!0):l||0===s||o.y==i.y||(t.y+=s,c=!0),c=c&&this.#e1.canGridPointBeOccupiedByActor(t,this.actor))h=0,o=t,r--;else{if(++h>=2)break;o.coincident(e)||a.push(this.#e1.gridPointToWorldPoint(o)),e=o,l=!l}}return o.coincident(e)||a.push(this.#e1.gridPointToWorldPoint(o)),a}getAllRoutesFrom(e,t){return this.#e0=new rc(this.#e1),this.#e8=e,this.#e5(e.x,e.y,t,null),this.#e0}#e5(e,t,r,i){if(i){if(e===this.#e8.x&&t===this.#e8.y||!this.#e9(e,t))return;let a=this.#e0.getRouteToCoords(e,t);if(a&&!(i.length<a.length-1))return;i.push(new V(e,t)),this.#e6(e,t)&&this.#e0.setRouteToCoords(i,e,t),r--}else i=[new V(e,t)];r>0&&(this.#e5(e,t-1,r,[...i]),this.#e5(e+1,t,r,[...i]),this.#e5(e,t+1,r,[...i]),this.#e5(e-1,t,r,[...i]))}#e9(e,t){return this.#e1.isGridPointPassableByActor(new V(e,t),this.actor)}#e6(e,t){return this.#e1.canGridPointBeOccupiedByActor(new V(e,t),this.actor)}#e3(e,t){let r=t.x-e.x,i=t.y-e.y,a=t.x,n=t.y;return Math.abs(r)>Math.abs(i)?a-=Math.sign(r):n-=Math.sign(i),new V(a,n)}#e2(e,t){return e.x===t.x&&e.y<t.y?new V(e.x+1,e.y+1):e.x>t.x&&e.y===t.y?new V(e.x-1,e.y+1):e.x===t.x&&e.y>t.y?new V(e.x-1,e.y-1):e.x<t.x&&e.y===t.y?new V(e.x+1,e.y-1):e}}class rd{#e7;#te;#e1;#tt;#tr;#ti;#ta;constructor(e,t){this.#e1=e,this.#e7=t}findReachedTiles(){return this.#te=this.#e1.worldPointToGrid(this.#e7.position),this.#ti=this.#e1.getMapGridPointRect(),this.#tr&&this.#tr.coincident(this.#te)&&this.#ti&&this.#ti.equals(this.#ta)||(this.#tt=new Map,this.#tt.set(this.#te.toString(),this.#te),this.#tn().forEach(e=>{this.#ts(e)}),this.#tr=this.#te,this.#ta=this.#ti),this.#tt}isGridPointInRays(e){return!!this.#tt&&this.#tt.has(e.toString())}#tn(){let e=[];for(let t=this.#ti.x;t<=this.#ti.x+this.#ti.width;t++)e.push(new V(t,this.#ti.y)),e.push(new V(t,this.#ti.y+this.#ti.height));for(let t=this.#ti.y+1;t<=this.#ti.y+this.#ti.height-1;t++)e.push(new V(this.#ti.x,t)),e.push(new V(this.#ti.x+this.#ti.width,t));return e}#ts(e){let t,r,i;let a=function(e){let t=Math.abs(e);return t<=U.DEG_22_5?H.E:t<=U.DEG_67_5?Math.sign(e)>0?H.NE:H.SE:t<=U.DEG_112_5?Math.sign(e)>0?H.N:H.S:t<=U.DEG_157_7?Math.sign(e)>0?H.NW:H.SW:H.W}(this.#te.getScreenAngleTo(e));Math.abs(e.x-this.#te.x)>=Math.abs(e.y-this.#te.y)?(t=Math.sign(e.x-this.#te.x),r=(i=Math.abs(e.x-this.#te.x))<1?0:(e.y-this.#te.y)/i):(r=Math.sign(e.y-this.#te.y),t=(i=Math.abs(e.y-this.#te.y))<1?0:(e.x-this.#te.x)/i);let n=this.#te.x,s=this.#te.y,o=!0;for(;i>=0;){let e=new V(Math.round(n),Math.round(s));if(o||this.#e1.isSeeThrough(e,this.#e7))this.#to(e,a);else break;o=!1,n+=t,s+=r,i--}}#to(e,t){switch(this.#tt.set(e.toString(),e),t){case H.N:this.#tl(new V(e.x-1,e.y-1)),this.#tl(new V(e.x,e.y-1)),this.#tl(new V(e.x+1,e.y-1));break;case H.NE:this.#tl(new V(e.x,e.y-1)),this.#tl(new V(e.x+1,e.y-1)),this.#tl(new V(e.x+1,e.y));break;case H.E:this.#tl(new V(e.x+1,e.y-1)),this.#tl(new V(e.x+1,e.y)),this.#tl(new V(e.x+1,e.y+1));break;case H.SE:this.#tl(new V(e.x+1,e.y)),this.#tl(new V(e.x+1,e.y+1)),this.#tl(new V(e.x,e.y+1));break;case H.S:this.#tl(new V(e.x-1,e.y+1)),this.#tl(new V(e.x,e.y+1)),this.#tl(new V(e.x+1,e.y+1));break;case H.SW:this.#tl(new V(e.x-1,e.y)),this.#tl(new V(e.x-1,e.y+1)),this.#tl(new V(e.x,e.y+1));break;case H.W:this.#tl(new V(e.x-1,e.y-1)),this.#tl(new V(e.x-1,e.y)),this.#tl(new V(e.x-1,e.y+1));break;case H.NW:this.#tl(new V(e.x-1,e.y)),this.#tl(new V(e.x-1,e.y-1)),this.#tl(new V(e.x,e.y-1))}}#tl(e){this.#e1.isSeeThrough(e)||this.#tt.set(e.toString(),e)}}let rf={DOOR_HIGHLIGHT_FILL:"rgba(0, 255, 0, 0.2)",HP_GAUGE:"rgba(255, 108, 108, 0.4)",HP_TRANSIENT_TEXT_HERO:"white",HP_TRANSIENT_TEXT_ENEMY:"black",INTERACT_HIGHLIGHT_FILL:void 0,INTERACT_HIGHLIGHT_STROKE:"rgb(255,108,108)",MOVE_HIGHLIGHT_FILL:void 0,MOVE_HIGHLIGHT_STROKE:"white"},rp={MOVEMENT_TILE:0,INTERACT_TILE:1,OCCUPIED_TILE:2,MOVE_OR_INTERACT_TILE:4},rm={OBSTACLE:-1,GROUND:0,ENTRANCE:1,EXIT:2};class rg extends rh{sprite;obstacle;#th;#tc;#tu;#td;constructor(e,t){super(),this.sprite=e,this.#th=new Map,this.obstacle=t.obstacle,this.#tc=t.gridPoint,this.#tu=t.worldPoint,this.#td=t.role}get role(){return this.#td}get gridPoint(){return this.#tc}get worldPoint(){return this.#tu}addOccupant(e){this.#th.set(e,e)}deleteOccupant(e){this.#th.delete(e)}getOccupants(){return this.#th}actionClick(e){super.actionClick(this.sprite.position)}actionContextClick(e){super.actionClick(this.sprite.position)}isOccupied(){return this.#th.size>0}isPassableByActor(e){if(this.#td===rm.ENTRANCE||this.#td===rm.EXIT||this.obstacle)return!1;for(let t of this.#th.values())if(t!==e&&!t.isPassableByActor(e))return!1;return!0}canBeOccupiedByActor(e){if((this.#td===rm.ENTRANCE||this.#td===rm.EXIT)&&!e.isHero()||this.obstacle)return!1;for(let t of this.#th.values())if(t!==e&&!t.canShareLocationWithActor(e))return!1;return!0}isSeeThrough(e){return!this.obstacle&&this.#td!==rm.ENTRANCE&&this.#td!==rm.EXIT}}class rS{#tf;#tp;#tm;#tg;#tS;#x;#I;highlightsOn;#tw;#tE;#tT;#ty;#tA;#tx;#tI;#tR;#tO;#tN;#tC;#tP;#tD;#tv;constructor(e,t,r,i){this.#tv=i;let a=t.matrix;if(this.#tR=t.entryPointByDoor,this.#tO=t.exitPointByDoor,this.#tf=e,this.#tT=new eH({renderer:new ek(e,{width:r,height:r,fillStyle:rf.MOVE_HIGHLIGHT_FILL,strokeStyle:rf.MOVE_HIGHLIGHT_STROKE})}),this.#ty=new eH({renderer:new ek(e,{width:r,height:r,fillStyle:rf.DOOR_HIGHLIGHT_FILL,strokeStyle:"green"})}),this.#tD=new eH({renderer:new ek(e,{width:r-8,height:r-8,fillStyle:rf.INTERACT_HIGHLIGHT_FILL,strokeStyle:rf.INTERACT_HIGHLIGHT_STROKE})}),this.#tS=r,this.#tp=[],this.#tg=a.length,this.#tm=a[0].length,this.#x=r*this.tilesX,this.#I=r*this.tilesY,this.#tN=[],a.forEach((t,r)=>{let i=[];this.#tp.push(i),t.forEach((t,a)=>{if(t){let n=new eH({renderer:new eB(e,eN.getSpriteBitmap(t.image))}),s=new V(a,r),o=this.gridPointToWorldPoint(s),l=new rg(n,{obstacle:t.role===rm.OBSTACLE,gridPoint:s,worldPoint:o,role:t.role});t.onClick&&l.setOnClick((e,r)=>this.#tL(e,r,t.onClick)),this.processTileRole(l),i.push(l),n.position.x=a*this.#tS+this.#tS/2,n.position.y=r*this.#tS+this.#tS/2}else i.push(null)})}),this.#tx||(L.error("No entrance has been set. Setting to the first ground tile"),this.#tx=this.#tN[0]),!this.#tI)throw Error("No exit tile.");this.highlightsOn=!0}getDimsInTiles(){return{width:this.#tm,height:this.#tg}}processTileRole(e){switch(e.role){case rm.ENTRANCE:if(this.#tx){let t=e.gridPoint;L.error(`Duplicate entrance found at (${t.x}, ${t.y}). Ignored.`)}else this.#tx=e;break;case rm.EXIT:if(this.#tI){let t=e.gridPoint;L.error(`Duplicate exit found at (${t.x}, ${t.y}). Ignored.`)}else this.#tI=e;break;case rm.GROUND:e.gridPoint.coincident(this.#tR)||this.#tN.push(e)}}update(e){this.#tM();let t=this.getVisibleGridPointRect();for(let r=t.y;r<=t.y+t.height;r++)for(let i=t.x;i<=t.x+t.width;i++)if(this.#tC?.isGridPointInRays(new V(i,r))){let t=this.#tp[r][i];t?.sprite.update(e)}}updateHighlights(e){this.highlightsOn&&this.#t_(e)}#tM(){if(this.#tv){this.#tC||(this.#tC=new rd(this,this.#tv));let e=this.getTileAtWorldPoint(this.#tv.position);if(e){let t=e.role;t!=rm.ENTRANCE&&t!=rm.EXIT&&this.#tC.findReachedTiles()}}}getMapGridPointRect(){return new Z(0,0,this.#tm,this.#tg)}getVisibleGridPointRect(){let e=eg.getWorldInCanvasBounds(),t=this.worldPointToGrid(new V(e.x,e.y)),r=this.worldPointToGrid(new V(e.x+e.width,e.y+e.height)),i=Math.max(0,t.x),a=Math.min(this.#tm-1,r.x),n=Math.max(0,t.y);return new Z(i,n,a-i,Math.min(this.#tg-1,r.y)-n)}getGridSize(){return this.#tS}getDimensions(){return{width:this.#x,height:this.#I}}getTileAtWorldPoint(e){let t=this.worldPointToGrid(e);return this.getTileAtGridPoint(t)}getTileAtGridPoint(e){if(!e)return null;let t=e.y,r=e.x;return r>=0&&t>=0&&r<this.#tm&&t<this.#tg?this.#tp[t][r]:null}worldPointToGrid(e){return new V(Math.floor(e.x/this.#tS),Math.floor(e.y/this.#tS))}worldDistanceToTiles(e){return Math.floor(e/this.#tS)}gridAlignedWorldPoint(e){let t=this.worldPointToGrid(e);return this.gridPointToWorldPoint(t)}gridPointToWorldPoint(e){let t=.5*this.#tS;return new V(e.x*this.#tS+t,e.y*this.#tS+t)}getWorldPositionOfTileByEntry(){return this.gridPointToWorldPoint(this.#tR)}getGridPositionOfEntrance(){return this.#tx.gridPoint}setMovementRoutes(e,t){let r;if(this.#tw=e,e){let e=this.worldPointToGrid(t);this.#tE=new Map,this.#tw.forEach(t=>t.forEach(t=>{this.#tE.set(t,t),r||e.coincident(t)||(r=this.gridPointToWorldPoint(t))}))}else this.#tE=null;return r}setInteractActors(e){let t;return this.#tP=[],e?.forEach(e=>{e.interaction.canReact()&&(this.#tP.push(this.worldPointToGrid(e.position)),t||(t=new V(e.position.x,e.position.y)))}),t}calcReachableDoors(e){let t={entry:void 0,exit:void 0};this.#tA=[];let r=this.getSurroundingTiles(this.worldPointToGrid(e));return[r.above,r.right,r.below,r.left].forEach(e=>{e.gridPoint.coincident(this.#tI.gridPoint)?(this.#tA.push(e.gridPoint),t.exit=this.gridPointToWorldPoint(e.gridPoint)):e.gridPoint.coincident(this.#tx.gridPoint)&&(this.#tA.push(e.gridPoint),t.entry=this.gridPointToWorldPoint(e.gridPoint))}),t}#t_(e){this.#tb(e),this.#tz(e),this.#tk(e)}#tb(e){this.#tE?.forEach(t=>{this.#tT.position=this.gridPointToWorldPoint(t),this.#tT.update(e)})}#tz(e){this.#tP?.forEach(t=>{this.#tD.position=this.gridPointToWorldPoint(t),this.#tD.update(e)})}#tk(e){this.#tA?.forEach(t=>{this.#ty.position=this.gridPointToWorldPoint(t),this.#ty.update(e)})}#tL(e,t,r){let i;let a=this.worldPointToGrid(t),n=e.getOccupants();n.size>0&&(i=n.values().next().value);let s=this.#tw?.containsGridPoint(a),o=!1;if(this.#tP){for(let e of this.#tP)if(e.isCoincident(a)){o=!0;break}}let l=!i?.alive&&i?.isProp();if(s&&o||o&&l){r(e,t,{filter:rp.MOVE_OR_INTERACT_TILE,occupant:i});return}if(s){r(e,t,{filter:rp.MOVEMENT_TILE,occupant:i});return}if(o){r(e,t,{filter:rp.INTERACT_TILE,occupant:i});return}if(this.#tA){for(let i of this.#tA)if(i.isCoincident(a)){r(e,t,{filter:rp.INTERACT_TILE});return}}let h=this.worldPointToGrid(this.#tv.position);if(a.coincident(h)){r(e,t,{occupant:this.#tv,filter:rp.OCCUPIED_TILE});return}i&&r(e,t,{occupant:i,filter:rp.OCCUPIED_TILE}),L.debug("Ignore click outside of highlighted area")}getWaypointsToWorldPoint(e){let t=this.worldPointToGrid(e);return this.#tw?.getWaypointsAsWorldPoints(t)}getRandomFreeGroundTile(){for(let e of(re(this.#tN),this.#tN))if(!e.isOccupied())return e;return null}isGridPointPassableByActor(e,t){let r=this.getTileAtGridPoint(e);return!!r&&r.isPassableByActor(t)}canGridPointBeOccupiedByActor(e,t){let r=this.getTileAtGridPoint(e);return!!r&&r.canBeOccupiedByActor(t)}canHeroSeeGridPoint(e){return this.#tC?.isGridPointInRays(e)??!0}isSeeThrough(e,t){let r=this.getTileAtGridPoint(e);return!r||r.isSeeThrough(t)}getSurroundingTiles(e){return t6(this.#tp,e.y,e.x)}getRadiatingCross(e,t=1){return function(e,t){let r;let i=t.columnIndex,a=t.rowIndex,n=[],s=!0,o=!0,l=!0,h=!0,c=1,u=t.distance??1;for(;u-- >0;)h&&(r=e[a][i-c],t.filter&&!t.filter(r)?h=!1:n.push(r)),o&&(r=e[a][i+c],t.filter&&!t.filter(r)?o=!1:n.push(r)),s&&(r=e[a-c][i],t.filter&&!t.filter(r)?s=!1:n.push(r)),l&&(r=e[a+c][i],t.filter&&!t.filter(r)?l=!1:n.push(r)),c++;return n}(this.#tp,{rowIndex:e.y,columnIndex:e.x,distance:t,filter:e=>e.role===rm.GROUND})}getRadiating(e,t=1){return function(e,t){let r;let i=t.columnIndex,a=t.rowIndex,n=t.distance??1,s=[],o=!0,l=!0,h=n*n,c={rowIndex:a,columnIndex:i,distance:n,filter:t.filter};s=s.concat(t7(e,c));for(let c=1;c<=n&&(l||o);c++){if(l){if(r=e[a][i-c],t.filter&&!t.filter(r))l=!1;else{s.push(r);let n={rowIndex:a,columnIndex:i-c,distance:Math.round(Math.sqrt(h-(c-.5)*(c-.5))),filter:t.filter};s=s.concat(t7(e,n))}}if(o){if(r=e[a][i+c],t.filter&&!t.filter(r))o=!1;else{s.push(r);let n={rowIndex:a,columnIndex:i+c,distance:Math.round(Math.sqrt(h-(c-.5)*(c-.5))),filter:t.filter};s=s.concat(t7(e,n))}}}return s}(this.#tp,{rowIndex:e.y,columnIndex:e.x,distance:t,filter:e=>e.role===rm.GROUND})}getRadiatingVisibleTiles(e){let t=[],r=this.worldPointToGrid(this.#tv.position),i=Math.max(0,r.x-e),a=Math.max(0,r.y-e),n=r.x+e,s=r.y+e;for(let e=i;e<=n;e++)for(let i=a;i<=s;i++){let a=new V(e,i);if(!a.coincident(r)){let e=this.getTileAtGridPoint(a);this.canHeroSeeGridPoint(a)&&e.isSeeThrough()&&t.push(e)}}return t}deleteOccupancyOfGridPoint(e,t){this.getTileAtGridPoint(t)?.deleteOccupant(e)}moveTileOccupancyGridPoint(e,t,r){r!==t&&(this.getTileAtGridPoint(t)?.deleteOccupant(e),this.getTileAtGridPoint(r)?.addOccupant(e))}getCoincidentActors(e){return this.getTileAtWorldPoint(e.position).getOccupants()}getParticipants(e){let t=[],r=this.getSurroundingTiles(this.worldPointToGrid(e.position));return[r.above,r.right,r.below,r.left].forEach(e=>{let r=e?.getOccupants();r?.forEach(e=>{t.push(e)})}),t}}function rw(e){return new Promise(t=>{setTimeout(()=>t(),1e3*e)})}function rE(e){e?document.fullscreenElement||document.body.requestFullscreen?.():document.fullscreenElement&&document.exitFullscreen?.()}let rT=[{id:"MUSIC_VOLUME",labelKey:"CONTROL MUSIC VOLUME",defValue:50,controlType:e7.RANGE,persistent:!0,action:null,onChange:e=>tu.setMusicVolumePercent(e)},{id:"EFFECTS_VOLUME",labelKey:"CONTROL EFFECTS VOLUME",defValue:50,controlType:e7.RANGE,persistent:!0,action:null,onChange:e=>{tu.setEffectsVolumePercent(e),tu.playEffect("PUNCH")}},{id:"FONT_SCALE",labelKey:"CONTROL UI FONT SCALE",defValue:33.33333333333333,controlType:e7.RANGE,persistent:!0,action:null,onChange:e=>{M=10+e/100*15,k()}},{id:"SHOW_QUICK_TIPS_AT_START",labelKey:"CONTROL SHOW QUICK TIPS",defValue:!0,controlType:e7.CHECKBOX,persistent:!0,action:null,onChange:null},{id:"START_IN_FULLSCREEN",labelKey:"CONTROL RUN FULLSCREEN",defValue:!1,controlType:e7.CHECKBOX,persistent:!0,action:null,onChange:null},{id:"DO_NOT_SCALE",labelKey:"CONTROL DO NOT SCALE",defValue:!1,controlType:e7.CHECKBOX,persistent:!0,action:null,onChange:()=>tc.showOkDialog(tr`MESSAGE REQUIRES RESTART`),doNotInitialise:!0},{id:"SHOW_DEBUG_LOG",labelKey:"BUTTON SHOW DEBUG LOG",defValue:!0,controlType:e7.TEXT_BUTTON,persistent:!1,action:()=>(function(){L.getMessages();let e="";for(let t of L.getMessages())e+=t+"\n";return tc.showOkDialog(e,{title:tr`DIALOG TITLE DEBUG LOG`,className:"wall"})})(),onChange:null},{id:"CLEAR_MEMORY",labelKey:"BUTTON DELETE MEMORY",defValue:!0,controlType:e7.TEXT_BUTTON,persistent:!1,action:()=>tc.showChoiceDialog(tr`DIALOG TITLE DELETE MEMORY`,tr`MESSAGE CONFIRM DELETE MEMORY`,[tr`BUTTON DELETE`,tr`BUTTON CANCEL`]).then(e=>{if(0===e)return e1.clearAll(),N.deleteAllCaches(),tc.showOkDialog(tr`MESSAGE MEMORY DELETED`)}),onChange:null}];function ry(){let e=[];return rT.forEach(t=>{e.push(function(e){let t;switch(e.controlType){case e7.CHECKBOX:t=new e9(e);break;case e7.RANGE:t=new e6(e);break;case e7.TEXT_BUTTON:t=new e3(e);break;default:throw Error(`Attempt to create unrecognised control type ${e.controlType}`)}return t}(t))}),tc.showControlsDialog(tr`DIALOG TITLE SETTINGS`,{actionButtons:e,className:"door"}).then(()=>rE(e1.get("START_IN_FULLSCREEN")))}let rA={SLEEP:{keyName:"SLEEP",suffix:"sleep",options:{framePeriodMs:300,loopMethod:eD.REVERSE}},DEAD:{keyName:"DEAD",suffix:"dead",options:{framePeriodMs:100,loopMethod:eD.STOP}},IDLE:{keyName:"IDLE",suffix:"idle",options:{framePeriodMs:300,loopMethod:eD.REVERSE}},WALK_NORTH:{keyName:"WALK_N",suffix:"walk-n",options:{framePeriodMs:100,loopMethod:eD.REVERSE}},WALK_EAST:{keyName:"WALK_E",suffix:"walk-e",options:{framePeriodMs:100,loopMethod:eD.REVERSE}},WALK_SOUTH:{keyName:"WALK_S",suffix:"walk-s",options:{framePeriodMs:100,loopMethod:eD.REVERSE}},WALK_WEST:{keyName:"WALK_W",suffix:"walk-w",options:{framePeriodMs:100,loopMethod:eD.REVERSE}}},rx={DEAD:{keyName:"DEAD",suffix:"dead",options:{framePeriodMs:100,loopMethod:eD.STOP}},IDLE:{keyName:"IDLE",suffix:"idle",options:{framePeriodMs:300,loopMethod:eD.REVERSE}}};class rI{#tG;constructor(e){this.#tG=e}#tU(e,t){let r=this.#tG[e]?.suffix;if(!r)throw Error(`Attempt made to use invalid standard animation key of '${e}'`);return`${t}-${r}`}getKeyName(e){return this.#tG[e].keyName}getDefaultImageName(e){return`${this.#tU("IDLE",e)}00.png`}getFallbackKey(){return this.getKeyName("IDLE")}addAllToKeyedAnimation(e,t){for(let r in this.#tG){let i=this.#tG[r];e.addAnimatedImage(this.#tG[r].keyName,new eM({prefix:this.#tU(r,t),suffix:".png",startIndex:0,padding:2},i.options))}e.setCurrentKey(this.#tG.IDLE.keyName)}}let rR={peripatetic:new rI(rA),artefact:new rI(rx)},rO=["a","e","i","o","u","ee","oo"],rN=["b","br","ch","chr","cl","cr","d","dr","fl","fr","g","gl","gr","h","j","k","kr","kl","l","m","n","p","pl","pr","qu","r","s","sch","sh","st","t","th","tr","v","w","y","z"],rC=["b","bbey","bble","bboy","bby","c","ch","ck","cky","ct","d","f","ff","ffle","ffy","ffey","g","ge","gey","gle","k","l","ll","lly","lley","m","n","ngle","nny","p","r","s","sk","ss","ssy","st","sty","t","th","thy","v","w","y","z","zzle","zzy"];function rP(){let e;return(e=.5>Math.random()?$(rN)+$(rO)+$(rC):$(rN)+$(rO)+$(rN)+$(rO)+$(rC)).charAt(0).toUpperCase()+e.substring(1)}class rD extends eU{actor;constructor(e,t){super(e,t)}render(e){if(this.actor&&this.actor.traits){let e=this.actor.traits.getInt("HP",0),t=this.actor.traits.getInt("HP_MAX",1);this.setLevel(0,e/t)}super.render(e)}}class rv extends e_{#e7;#tB;#tH;#tF;#t$;#tW;constructor(e,t){super(e,t),this.#tB=H.NONE,this.#t$=t,this.#tW=0}setActor(e){this.#e7=e,this.#tH=this.#e7.alive,this.#tF=this.#e7.sleeping}setFallbackKey(e){this.#t$=this.getAnimatedImage(e),this.#t$?.getCurrentFrame()||L.error(`Fallback key ${e} has no image.`)}getCurrentFrame(){let e=this.#tY();(e!==this.#tB||this.#tH!=this.#e7?.alive||this.#tF!=this.#e7?.sleeping)&&(this.#tB=e,this.#tH=this.#e7?.alive,this.#tF=this.#e7?.sleeping,this.#tK());let t=super.getCurrentFrame()??this.#t$?.getCurrentFrame()??{bitmap:eN.getUndefinedBitmap(),rotation:0,flip:eL.NONE};return t.rotation=this.#tW,t}#tY(){return!this.#e7||this.#e7.velocity.isZero(.1)?H.NONE:function(e){let t=Math.abs(e);return t<=U.DEG_45?H.E:t<=U.DEG_135?Math.sign(e)>0?H.N:H.S:H.W}(this.#e7.velocity.getScreenDirection())}#tK(){return this.#e7.alive?this.#e7.sleeping?this.setCurrentKey(rR.peripatetic.getKeyName("SLEEP")):this.#tB===H.NONE?this.setCurrentKey(rR.peripatetic.getKeyName("IDLE")):this.#tV():this.setCurrentKey(rR.peripatetic.getKeyName("DEAD"))}#tV(){let e=this.#e7.disengaging;switch(this.#tB){case H.NONE:this.setCurrentKey(rR.peripatetic.getKeyName("IDLE"));break;case H.E:this.setCurrentKey(rR.peripatetic.getKeyName(e?"WALK_WEST":"WALK_EAST"));break;case H.N:case H.NW:case H.NE:this.setCurrentKey(rR.peripatetic.getKeyName(e?"WALK_SOUTH":"WALK_NORTH"));break;case H.W:this.setCurrentKey(rR.peripatetic.getKeyName(e?"WALK_EAST":"WALK_WEST"));break;default:this.setCurrentKey(rR.peripatetic.getKeyName(e?"WALK_NORTH":"WALK_SOUTH"))}}}function rL(e,t,r,i){let a;let n=function(e){let t=new rv;return rR.peripatetic.addAllToKeyedAnimation(t,e),t.setFallbackKey(rR.peripatetic.getFallbackKey()),t}(e),s=new eB(eg.getContext2D(),n),o=new nn(new eH({renderer:"PORTAL"!==i.typeId&&r.get("MOVE")!==na.ORGANIC?[a=new rD(eg.getContext2D(),{tileSize:e4.TILE_SIZE-2,fillStyles:[rf.HP_GAUGE],strokeStyles:[]}),s]:[s]}),i.type);return n.setActor(o),a&&(a.actor=o),o.position=new j(e4.TILE_SIZE,e4.TILE_SIZE,0),o.almanacEntry=i,o.traits=r,o.velocity={x:0,y:0,rotation:0},o.iconImageName=t?`${t}.png`:rR.peripatetic.getDefaultImageName(e),/\w+_pv/.test(e)?o.sprite.replaceBaseModifier(eK.createUprightAligner()):"PORTAL"===i.typeId&&o.sprite.replaceBaseModifier(new eY),o}function rM(e,t){let r;let i=t??new tK(e.traitsString);switch(i.get("NAME")||i.set("NAME",e.name),e.type){case nr.HERO:(r=rL(e.imageName,null,i,e)).type=nr.HERO,t||(i.set("NAME",`${rP()} ${rP()}`),tv(i)),r.toxify=new a5;break;case nr.PORTAL:r=function(e,t,r,i){let a=rL(e,null,r,i);return a.interaction=new nt(a),a}(e.imageName,0,i,e);break;case nr.TRADER:r=function(e,t,r,i){let a=rL(e,null,r,i);return a.interaction=new a8(a),a}(e.imageName,0,i,e);break;case nr.HIDDEN_ARTEFACT:r=function(e,t,r){let i=function(e){let t=new rv;return rR.artefact.addAllToKeyedAnimation(t,e),t.setFallbackKey(rR.artefact.getFallbackKey()),t}(e),a=new nn(new eH({renderer:[new eB(eg.getContext2D(),i)]}),"SPELL"===r.type?nr.PROP:nr.HIDDEN_ARTEFACT);return i.setActor(a),a.position=new j(e4.TILE_SIZE,e4.TILE_SIZE,0),a.velocity={x:0,y:0,rotation:0},a.interaction=new a3(a),a.iconImageName=`${e}.png`,a.traits=new tK,a}(e.imageName,0,i,e);break;case nr.PROP:r=function(e,t,r,i){let a=rL(e,null,r,i);return a.interaction=new a3(a),a}(e.imageName,0,i,e);break;default:r=function(e,t,r,i){let a=rL(e,null,r,i);return a.isOrganic()?(a.interaction=new a2(a),a.obstacle=!1):a.interaction=new a0(a),a}(e.imageName,0,i,e)}return r.description=e.description,!t&&e.equipmentIds&&function(e,t){if(t&&0!==t.length)for(let r of t){let t=tJ.findById(r,["MONEY","WEAPONS","ARMOUR","MAGIC","ARTEFACTS"]);if(t){let r=t4(t);r.equipStoreType?e.storeManager.equip(r,{direct:!0}):e.storeManager.stash(r,{direct:!0})}else L.error(`Cannot find ${r} artefact in almanac to equip actor.`)}}(r,e.equipmentIds),r}class r_{#tX;#tq;constructor(e=0,t=0){this.#tq=e,this.#tX=t}getChangeInHpThisTurn(){let e=this.#tq+this.#tX,t=Math.floor(e);return this.#tX=e-t,t}addToxicEffect(e){this.#tq+=e}cure(){this.#tq=0,this.#tX=0}get isActive(){return 0!==this.#tq||0!==this.#tX}toJSON(){return{reviver:"Toxin",data:{pendingHpChange:this.#tX,hpPerTurn:this.#tq}}}static revive(e){return new r_(e.hpPerTurn,e.pendingHpChange)}}function rb(e){return 0===e?"1":`B${e}`}function rz(e){return e.startsWith("B")?parseInt(e.substring(1)):0}class rk{#tj;#tZ;#tQ;#tJ;constructor(e,t={}){this.#tZ=e??[],this.#tj=t?.maxLength??10,this.#tQ=t.sortFn,this.#tJ=t.equalFn??((e,t)=>e==t)}add(e){let t=this.indexOfEqual(e);if(t>=0){let r=this.#tZ[t];if(!(0>this.#tQ(e,r)))return t;this.#tZ[t]=e}else this.#tZ.push(e);return this.#tZ.sort(this.#tQ),this.#tZ.length>this.#tj&&this.#tZ.pop(),this.#tZ.indexOf(e)}indexOfEqual(e){for(let t=0;t<this.#tZ.length;t++)if(this.#tJ(e,this.#tZ[t]))return t;return -1}getCurrentData(){return[...this.#tZ]}getMaxLength(){return this.#tj}}let rG="LEADERBOARD_DATA";function rU(){return new rk(e1.get(rG),{maxLength:10,sortFn:(e,t)=>e.goldSent>t.goldSent||!(e.goldSent<t.goldSent)&&rz(e.dungeonFloor)>rz(t.dungeonFloor)?-1:1,equalFn:(e,t)=>e.adventureStartTime===t.adventureStartTime&&e.name===t.name})}function rB(e,t=!1){let r=function(e){let t=rU(),r=t.add(e);return r>=0&&e1.set(rG,t.getCurrentData()),r}(function(e,t){let r={adventureStartTime:0,name:"unknown",class:"unknown",gold:0,goldSent:0,exp:0,characterLevel:0,dungeonFloor:0,completed:!1};return e&&(r.adventureStartTime=e.adventureStartTime,r.name=e.traits.get("NAME"),r.class=e.traits.get("CLASS"),r.gold=e.storeManager.getPurseValue(),r.goldSent=e.traits.getInt("GOLD_SENT",0),r.exp=e.traits.getInt("EXP",0),r.characterLevel=e.traits.getCharacterLevel(),r.dungeonFloor=rb(aD.getCurrentSceneLevel()),r.completed=t),r}(e,t)),i={sceneLevel:aD.getCurrentSceneLevel(),hero:e,completed:t};return e1.set("GAME_STATE",i),r}function rH(){let e=e1.get("GAME_STATE",null,rF);if(!e){L.debug("No saved game state to restore.");return}if(!e.hero.alive){L.debug("Last hero state was dead, so not restoring.");return}if(e.completed){L.debug("Last game was completed, so not restoring.");return}return{hero:e.hero,sceneLevel:e.sceneLevel}}function rF(e,t){switch(t?.reviver){case"Actor":return nn.revive(t.data,rM);case"Toxin":return r_.revive(t.data);case"Artefact":return t5.revive(t.data,t4);case"Traits":return tW.revive(t.data);case"CharacterTraits":return tK.revive(t.data);case"MagicTraits":return tY.revive(t.data);default:return t}}class r${#t4=new Map;constructor(){}clear(){this.#t4.clear()}#t0(e){return window.btoa(function(e){try{return encodeURIComponent(e)}catch(t){return console.error(t),encodeURIComponent(e.toWellFormed())}}(e)).replace(/=/g,":")}protect(e){if(!e)return e;let t=`???${this.#t4.size}${this.#t0(e)}???`;return this.#t4.set(t,e),t}retrieve(e){let t=this.#t4.get(e);return(this.#t4.delete(e),t)?t:(console.error(`Could not find ${e} in protected data.`),e)}reinstate(e){return e.replace(/[?]{3}\d+[a-zA-Z0-9+/]+:{0,2}[?]{3}/g,e=>this.retrieve(e))}}let rW=new r$;function rY(e,t){return`<span class="printable-link for-print-only">${t?"(":""}${e}${t?")":""}</span>`}let rK=[{re:/(?:(.+)\n=+\n)/g,rep:"\n\n<h1>$1</h1>\n\n"},{re:/(?:(.+)\n-+\n)/g,rep:"\n\n<h2>$1</h2>\n\n"},{re:/^(#+)(?: *)(.+?)(?:#*)[ \t]*$/gm,rep:(e,t,r)=>{let i=Math.min(t.length,6);return`

<h${i}>${r.trim()}</h${i}>
`}},r4(">[ 	]*",{blockPrefix:"<blockquote>",blockSuffix:"</blockquote>"}),r4("(?: {4}|	)",{blockPrefix:"<pre><code>",blockSuffix:"</code></pre>",trimContents:!0,useWarden:!0}),{re:/^(?:[*_-] *){3,}\s*$/gm,rep:"\n\n<hr>\n\n"},r4(" {0,3}[*+-][ 	]+",{blockPrefix:"<ul>",blockSuffix:"</ul>",linePrefix:"<li>",lineSuffix:"</li>"}),r4(" {0,3}\\d+\\.[ 	]+",{blockPrefix:"<ol>",blockSuffix:"</ol>",linePrefix:"<li>",lineSuffix:"</li>"})],rV=[{re:/(?:(?:^|\n{2,})(?!<\w+>))((?:.(?:\n(?!\n))?)+)/g,rep:"\n\n<p>$1</p>\n\n"},{re:/\n{2,}/g,rep:"\n\n"}],rX=[{re:/!(&lt;)?\[(.*?)\]\((https?:\/\/[-\w@:%.+~#=/]+?)(?: +"(.*?)")?\)/gm,rep:(e,t,r,i,a)=>{let n=`<img alt="${r??""}" class="${t?"floatable":""}" src="${i}" title="${a??""}"/>`;return rW.protect(n)}},{re:/\[(.*?)\]\((https?:\/\/[-\w@:%.+~#=/]+?)(?: +"(.*?)")?\)/gm,rep:(e,t,r,i)=>{var a;let n;a=t,n="",/^https:\/\/vimeo.com\//.test(r)?n='<i class="fa-brands fa-vimeo"></i>':/^https:\/\/(www\.)?youtube.com\//.test(r)&&(n='<i class="fa-brands fa-youtube"></i>'),n&&(n=`<span class='link-icon'>${n}</span>`),t=`${a}${n}`;let s=`<a target="_blank" href="${r}" title="${i??""}">${t??""}</a>${rY(r,!0)}`;return rW.protect(s)}},{re:/(?:&lt;|<)(https?:\/\/[-\w@:%.+~#=/]+?)>/gm,rep:(e,t)=>{let r=`<a target="_blank" href="${t}">${t}</a>${rY(t,!0)}`;return rW.protect(r)}},{re:/(?:&lt;|<)([\w.-]+@(?:[\w-]+\.)+[\w-]+)/gm,rep:(e,t)=>{let r=function(e){let t="";for(let r of e)t+=r0(r);return t}(t),i=`<a href="${r}">${r}</a>`;return rW.protect(i)}},{re:/(?:`{2,}(.*?)`{2,}|`(.*?)`)/gm,rep:(e,t,r)=>{let i=`<code>${t??r}</code>`;return rW.protect(i)}},{re:/\*\*([^\s])\*\*/gm,rep:"<strong>$1</strong>"},{re:/__([^\s])__/gm,rep:"<strong>$1</strong>"},{re:/\*([^\s])\*/gm,rep:"<em>$1</em>"},{re:/_([^\s])_/gm,rep:"<em>$1</em>"},{re:/\*\*([^\s])(.*?)([^\s])\*\*/gm,rep:"<strong>$1$2$3</strong>"},{re:/__([^\s])(.*?)([^\s])__/gm,rep:"<strong>$1$2$3</strong>"},{re:/\*([^\s])(.*?)([^\s])\*/gm,rep:"<em>$1$2$3</em>"},{re:/_([^\s])(.*?)([^\s])_/gm,rep:"<em>$1$2$3</em>"}],rq=[{re:/\\([\\`*_{}[\]()#+.!-])/g,rep:(e,t)=>r0(t)}],rj=[{re:"\0",rep:"ï¿½"}],rZ=[{re:/&(?![\w#]+?;)/gm,rep:"&amp;"},{re:/<(?!\/?(?:br|sub|sup)>)/gim,rep:"&lt;"}],rQ=[{re:/^\s*$/gm,rep:""},{re:/<(?:p|div)>\s*?<\/(?:p|div)>/gim,rep:""}];function rJ(e,t){return e&&t.forEach(t=>{e=e.replaceAll(t.re,t.rep)}),e}function r4(e,t){let r=RegExp(`(?:^|\\n)${e}(?:.|\\n)*?(?:(\\n(?!${e}))|$)`,"g"),i=RegExp(`^${e}([ \\t]*.*)$`,"gm"),a=`${t?.linePrefix??""}$1${t?.lineSuffix??""}`;return{re:r,rep:e=>{let r=e.replaceAll(i,a);return t.trimContents&&(r=r.replace(/^[\n\r]*/,"").trimEnd()),t.useWarden&&(r=rW.protect(r)),`

${t?.blockPrefix??""}${r}${t?.blockSuffix??""}

`}}}function r0(e){return`&#${e.charCodeAt(0).toString()};`}var r1={};r1=JSON.parse('{"frames":[{"filename":"acid00.png","frame":{"x":1,"y":293,"w":49,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"amber.png","frame":{"x":96,"y":244,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"aquamarine.png","frame":{"x":101,"y":1092,"w":42,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":42,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"arcane_orb.png","frame":{"x":100,"y":643,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":2,"w":47,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"axe.png","frame":{"x":52,"y":191,"w":42,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":42,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"barbarian1-dead00.png","frame":{"x":198,"y":678,"w":47,"h":34},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":11,"w":47,"h":34},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-idle00.png","frame":{"x":149,"y":393,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-idle01.png","frame":{"x":52,"y":293,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-e00.png","frame":{"x":101,"y":1141,"w":41,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":41,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-e01.png","frame":{"x":453,"y":1,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-e02.png","frame":{"x":101,"y":1293,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-e03.png","frame":{"x":247,"y":152,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-n00.png","frame":{"x":200,"y":52,"w":48,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-n01.png","frame":{"x":303,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-n02.png","frame":{"x":147,"y":100,"w":48,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-n03.png","frame":{"x":52,"y":343,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-s00.png","frame":{"x":149,"y":442,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-s01.png","frame":{"x":99,"y":293,"w":44,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":44,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-s02.png","frame":{"x":149,"y":491,"w":44,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":44,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-s03.png","frame":{"x":51,"y":393,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-w00.png","frame":{"x":245,"y":202,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-w01.png","frame":{"x":101,"y":1042,"w":42,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":42,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-w02.png","frame":{"x":285,"y":254,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"barbarian1-walk-w03.png","frame":{"x":333,"y":339,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"battleaxe.png","frame":{"x":146,"y":1007,"w":46,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":6,"w":46,"h":42},"sourceSize":{"w":49,"h":48}},{"filename":"belt_of_strength.png","frame":{"x":149,"y":687,"w":47,"h":41},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":8,"w":47,"h":41},"sourceSize":{"w":49,"h":49}},{"filename":"berserker-dead00.png","frame":{"x":97,"y":149,"w":48,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":43},"sourceSize":{"w":48,"h":48}},{"filename":"berserker-idle00.png","frame":{"x":196,"y":534,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"berserker-idle01.png","frame":{"x":51,"y":443,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"black_flask.png","frame":{"x":247,"y":101,"w":28,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":28,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"blank.png","frame":{"x":333,"y":389,"w":3,"h":3},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":3,"h":3},"sourceSize":{"w":48,"h":48}},{"filename":"block.png","frame":{"x":1,"y":495,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"blood-splat-twice.png","frame":{"x":1,"y":1,"w":96,"h":94},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":96,"h":94},"sourceSize":{"w":96,"h":96}},{"filename":"blood-splat.png","frame":{"x":1,"y":97,"w":94,"h":92},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":94,"h":92},"sourceSize":{"w":96,"h":96}},{"filename":"blue_flask.png","frame":{"x":277,"y":101,"w":28,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":28,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"break-weapon.png","frame":{"x":353,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"bugbear-dead00.png","frame":{"x":198,"y":714,"w":48,"h":39},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":39},"sourceSize":{"w":48,"h":48}},{"filename":"bugbear-idle00.png","frame":{"x":51,"y":493,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":46,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"bugbear-idle01.png","frame":{"x":195,"y":294,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"bugbear-sleep00.png","frame":{"x":248,"y":762,"w":45,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":45,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"bull00.png","frame":{"x":197,"y":101,"w":48,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"cantrip.png","frame":{"x":245,"y":922,"w":44,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":44,"h":45},"sourceSize":{"w":48,"h":49}},{"filename":"chain_mail_armour.png","frame":{"x":294,"y":402,"w":42,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":42,"h":43},"sourceSize":{"w":48,"h":49}},{"filename":"cleric1-dead00.png","frame":{"x":197,"y":839,"w":47,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":12,"w":47,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-idle00.png","frame":{"x":195,"y":342,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-idle01.png","frame":{"x":51,"y":543,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-e00.png","frame":{"x":329,"y":908,"w":42,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":42,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-e01.png","frame":{"x":195,"y":390,"w":47,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":2,"w":47,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-e02.png","frame":{"x":364,"y":243,"w":41,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":3,"w":41,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-e03.png","frame":{"x":341,"y":1129,"w":38,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":4,"w":38,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-n00.png","frame":{"x":198,"y":630,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-n01.png","frame":{"x":51,"y":593,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-n02.png","frame":{"x":146,"y":959,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-n03.png","frame":{"x":149,"y":540,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":45,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-s00.png","frame":{"x":246,"y":630,"w":45,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":45,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-s01.png","frame":{"x":145,"y":1051,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-s02.png","frame":{"x":248,"y":714,"w":45,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":45,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-s03.png","frame":{"x":1,"y":545,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-w00.png","frame":{"x":337,"y":1032,"w":40,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":40,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-w01.png","frame":{"x":101,"y":842,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-w02.png","frame":{"x":420,"y":1028,"w":40,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":40,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"cleric1-walk-w03.png","frame":{"x":381,"y":1129,"w":38,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":38,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"click00.png","frame":{"x":467,"y":546,"w":20,"h":20},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":26,"y":26,"w":20,"h":20},"sourceSize":{"w":48,"h":48}},{"filename":"click01.png","frame":{"x":455,"y":1660,"w":30,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":13,"y":13,"w":30,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"club.png","frame":{"x":252,"y":1,"w":49,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":49,"h":48},"sourceSize":{"w":49,"h":49}},{"filename":"coins.png","frame":{"x":99,"y":1,"w":49,"h":49},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":49},"sourceSize":{"w":49,"h":49}},{"filename":"copper_coins.png","frame":{"x":246,"y":839,"w":45,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":45,"h":44},"sourceSize":{"w":49,"h":49}},{"filename":"copper_dragon_wyrmling-dead00.png","frame":{"x":148,"y":730,"w":48,"h":39},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":39},"sourceSize":{"w":48,"h":48}},{"filename":"copper_dragon_wyrmling-idle00.png","frame":{"x":147,"y":149,"w":48,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":48,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"copper_dragon_wyrmling-idle01.png","frame":{"x":197,"y":150,"w":48,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":48,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"copper_dragon_wyrmling-sleep00.png","frame":{"x":144,"y":1142,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"dagger.png","frame":{"x":342,"y":1612,"w":40,"h":35},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":8,"w":40,"h":35},"sourceSize":{"w":49,"h":49}},{"filename":"diamond.png","frame":{"x":101,"y":1493,"w":42,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":42,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"door-B.png","frame":{"x":403,"y":1,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-L.png","frame":{"x":337,"y":494,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-R.png","frame":{"x":341,"y":544,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door-T.png","frame":{"x":1,"y":595,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door2-B.png","frame":{"x":1,"y":645,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"door2-T.png","frame":{"x":1,"y":695,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"dretch-dead00.png","frame":{"x":147,"y":771,"w":48,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"dretch-idle00.png","frame":{"x":1,"y":745,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"dretch-idle01.png","frame":{"x":1,"y":795,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"dretch-sleep00.png","frame":{"x":147,"y":818,"w":48,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"enchanted_battleaxe.png","frame":{"x":1,"y":343,"w":49,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"enchanted_greataxe.png","frame":{"x":1,"y":845,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"enchanted_greatsword.png","frame":{"x":1,"y":393,"w":48,"h":49},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"enchanted_handaxe.png","frame":{"x":1,"y":895,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"enchanted_shortsword.png","frame":{"x":1,"y":191,"w":49,"h":49},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":49},"sourceSize":{"w":49,"h":49}},{"filename":"engraved_pillar-idle00.png","frame":{"x":421,"y":1129,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"failed-spell.png","frame":{"x":329,"y":955,"w":42,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":42,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"fetid_water-idle00.png","frame":{"x":1,"y":945,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-dead00.png","frame":{"x":294,"y":677,"w":47,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":12,"w":47,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-idle00.png","frame":{"x":181,"y":1329,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-idle01.png","frame":{"x":181,"y":1376,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-e00.png","frame":{"x":343,"y":676,"w":30,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":3,"w":30,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-e01.png","frame":{"x":271,"y":1656,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-e02.png","frame":{"x":337,"y":447,"w":29,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":3,"w":29,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-e03.png","frame":{"x":343,"y":817,"w":28,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":28,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-n00.png","frame":{"x":292,"y":985,"w":35,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":35,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-n01.png","frame":{"x":364,"y":290,"w":41,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":41,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-n02.png","frame":{"x":193,"y":1611,"w":35,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":35,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-n03.png","frame":{"x":232,"y":1656,"w":37,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":4,"w":37,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-s00.png","frame":{"x":183,"y":1423,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-s01.png","frame":{"x":417,"y":430,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-s02.png","frame":{"x":223,"y":1422,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-s03.png","frame":{"x":325,"y":292,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-w00.png","frame":{"x":343,"y":723,"w":29,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":3,"w":29,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-w01.png","frame":{"x":308,"y":1656,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-w02.png","frame":{"x":343,"y":770,"w":29,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":3,"w":29,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"fighter1-walk-w03.png","frame":{"x":471,"y":826,"w":28,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":28,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"fire00.png","frame":{"x":1,"y":995,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fire01.png","frame":{"x":1,"y":444,"w":48,"h":49},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"fire_beetle_carapace.png","frame":{"x":455,"y":1626,"w":30,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":8,"w":30,"h":32},"sourceSize":{"w":48,"h":48}},{"filename":"fire_beetle_pv-dead00.png","frame":{"x":196,"y":922,"w":47,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":5,"w":47,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"fire_beetle_pv-idle00.png","frame":{"x":1,"y":1045,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fire_beetle_pv-idle01.png","frame":{"x":1,"y":1095,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fire_beetle_pv-sleep00.png","frame":{"x":455,"y":99,"w":44,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":44,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"flail.png","frame":{"x":99,"y":52,"w":49,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":4,"w":49,"h":45},"sourceSize":{"w":49,"h":49}},{"filename":"floor-SBE.png","frame":{"x":1,"y":1145,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor-SBW.png","frame":{"x":1,"y":1195,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor.png","frame":{"x":1,"y":1245,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2-SBE.png","frame":{"x":1,"y":1295,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2-SBW.png","frame":{"x":1,"y":1345,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"floor2.png","frame":{"x":1,"y":1395,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fungal_film-idle00.png","frame":{"x":1,"y":1445,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fungal_film-idle01.png","frame":{"x":1,"y":1495,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"fungus.png","frame":{"x":329,"y":999,"w":43,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":9,"w":43,"h":31},"sourceSize":{"w":48,"h":49}},{"filename":"gargoyle-dead00.png","frame":{"x":198,"y":755,"w":48,"h":34},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":9,"w":48,"h":34},"sourceSize":{"w":48,"h":48}},{"filename":"gargoyle-idle00.png","frame":{"x":145,"y":1098,"w":48,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"gargoyle-idle01.png","frame":{"x":195,"y":1098,"w":48,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"gargoyle-sleep00.png","frame":{"x":368,"y":432,"w":47,"h":41},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":47,"h":41},"sourceSize":{"w":48,"h":48}},{"filename":"gargoyle_wings.png","frame":{"x":376,"y":617,"w":46,"h":27},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":12,"w":46,"h":27},"sourceSize":{"w":48,"h":48}},{"filename":"gas00.png","frame":{"x":1,"y":1545,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"ghoul-dead00.png","frame":{"x":290,"y":1159,"w":43,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":11,"w":43,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"ghoul-idle00.png","frame":{"x":416,"y":336,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ghoul-idle01.png","frame":{"x":185,"y":1470,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"giant_wasp_pv-dead00.png","frame":{"x":51,"y":643,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"giant_wasp_pv-idle00.png","frame":{"x":51,"y":693,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"giant_wasp_pv-idle01.png","frame":{"x":1,"y":1595,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"giant_wasp_pv-sleep00.png","frame":{"x":51,"y":743,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"goblin-dead00.png","frame":{"x":244,"y":402,"w":48,"h":34},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":12,"w":48,"h":34},"sourceSize":{"w":48,"h":48}},{"filename":"goblin-idle00.png","frame":{"x":455,"y":433,"w":43,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":6,"w":43,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"goblin-idle01.png","frame":{"x":245,"y":1098,"w":46,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":46,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"goblin-sleep00.png","frame":{"x":222,"y":1236,"w":40,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":2,"w":40,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"gold_coins.png","frame":{"x":150,"y":1,"w":49,"h":49},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":49},"sourceSize":{"w":49,"h":49}},{"filename":"gold_portal-dead00.png","frame":{"x":197,"y":791,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"gold_portal-idle00.png","frame":{"x":419,"y":1603,"w":31,"h":36},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":12,"y":8,"w":31,"h":36},"sourceSize":{"w":48,"h":48}},{"filename":"gold_ring.png","frame":{"x":423,"y":1220,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":9,"w":40,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"greataxe.png","frame":{"x":100,"y":692,"w":46,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":46,"h":48},"sourceSize":{"w":49,"h":49}},{"filename":"greatsword.png","frame":{"x":1,"y":1645,"w":47,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"green_flask.png","frame":{"x":285,"y":152,"w":28,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":28,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"half_plate_armour.png","frame":{"x":424,"y":616,"w":48,"h":39},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":39},"sourceSize":{"w":48,"h":49}},{"filename":"handaxe.png","frame":{"x":52,"y":242,"w":42,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":42,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"helmet.png","frame":{"x":416,"y":383,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":1,"w":37,"h":45},"sourceSize":{"w":49,"h":49}},{"filename":"helmet_of_ogre_power.png","frame":{"x":101,"y":1191,"w":40,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":40,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"hidden_artefact-dead00.png","frame":{"x":467,"y":512,"w":32,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":5,"w":32,"h":32},"sourceSize":{"w":48,"h":48}},{"filename":"hidden_artefact-idle00.png","frame":{"x":471,"y":872,"w":28,"h":27},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":5,"w":28,"h":27},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-down00.png","frame":{"x":196,"y":874,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-down01.png","frame":{"x":194,"y":962,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-left00.png","frame":{"x":194,"y":1010,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-left01.png","frame":{"x":192,"y":1142,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-right00.png","frame":{"x":290,"y":51,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-right01.png","frame":{"x":338,"y":51,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-up00.png","frame":{"x":386,"y":51,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-arrow-up01.png","frame":{"x":434,"y":51,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-auto-centre00.png","frame":{"x":245,"y":438,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-auto-centre01.png","frame":{"x":245,"y":486,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hud-fullscreen00.png","frame":{"x":97,"y":99,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"hud-fullscreen01.png","frame":{"x":245,"y":534,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"hunting_trap.png","frame":{"x":245,"y":809,"w":46,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":11,"w":46,"h":28},"sourceSize":{"w":48,"h":49}},{"filename":"ice00.png","frame":{"x":373,"y":934,"w":42,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":42,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"iron_rations.png","frame":{"x":295,"y":808,"w":46,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":10,"w":46,"h":32},"sourceSize":{"w":48,"h":49}},{"filename":"kobold-dead00.png","frame":{"x":247,"y":678,"w":45,"h":34},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":11,"w":45,"h":34},"sourceSize":{"w":48,"h":48}},{"filename":"kobold-idle00.png","frame":{"x":303,"y":1613,"w":34,"h":41},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":7,"w":34,"h":41},"sourceSize":{"w":48,"h":48}},{"filename":"kobold-idle01.png","frame":{"x":380,"y":1521,"w":35,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":5,"w":35,"h":43},"sourceSize":{"w":48,"h":48}},{"filename":"kobold-sleep00.png","frame":{"x":305,"y":1244,"w":41,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":5,"w":41,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"leather_armour.png","frame":{"x":194,"y":1058,"w":48,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":38},"sourceSize":{"w":48,"h":49}},{"filename":"lichen.png","frame":{"x":455,"y":192,"w":44,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":44,"h":44},"sourceSize":{"w":48,"h":49}},{"filename":"lightning00.png","frame":{"x":51,"y":793,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"lizard_pv-dead00.png","frame":{"x":244,"y":1058,"w":47,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":5,"w":47,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"lizard_pv-idle00.png","frame":{"x":285,"y":304,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"lizard_pv-idle01.png","frame":{"x":250,"y":52,"w":38,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":38,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"lizard_pv-sleep00.png","frame":{"x":293,"y":641,"w":46,"h":34},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":46,"h":34},"sourceSize":{"w":48,"h":48}},{"filename":"lizard_skin.png","frame":{"x":462,"y":939,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":2,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"lock_pick.png","frame":{"x":363,"y":146,"w":41,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":41,"h":46},"sourceSize":{"w":48,"h":49}},{"filename":"lute.png","frame":{"x":423,"y":1252,"w":40,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":6,"w":40,"h":38},"sourceSize":{"w":48,"h":49}},{"filename":"magic00.png","frame":{"x":421,"y":1176,"w":42,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":42,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"manhole_cover-dead00.png","frame":{"x":467,"y":477,"w":32,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":6,"w":32,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"manhole_cover-idle00.png","frame":{"x":389,"y":1217,"w":30,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":9,"w":30,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"meat.png","frame":{"x":380,"y":1175,"w":39,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":6,"w":39,"h":40},"sourceSize":{"w":48,"h":49}},{"filename":"miss.png","frame":{"x":455,"y":238,"w":44,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":44,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ogre-dead00.png","frame":{"x":242,"y":1016,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"ogre-idle00.png","frame":{"x":149,"y":343,"w":44,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":44,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"ogre-idle01.png","frame":{"x":101,"y":892,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"ogre-sleep00.png","frame":{"x":424,"y":521,"w":41,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":41,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"orc-dead00.png","frame":{"x":375,"y":684,"w":48,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":8,"w":48,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle00.png","frame":{"x":101,"y":942,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-idle01.png","frame":{"x":101,"y":992,"w":43,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":43,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"orc-sleep00.png","frame":{"x":372,"y":475,"w":43,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":43,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"orc-walk-w00.png","frame":{"x":101,"y":1343,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":40,"h":48},"sourceSize":{"w":49,"h":48}},{"filename":"orc_skull.png","frame":{"x":101,"y":1242,"w":40,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":40,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"padded_armour.png","frame":{"x":240,"y":1145,"w":48,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":48,"h":44},"sourceSize":{"w":48,"h":49}},{"filename":"plate_armour.png","frame":{"x":51,"y":843,"w":48,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":48},"sourceSize":{"w":48,"h":49}},{"filename":"platinum_coins.png","frame":{"x":1,"y":242,"w":49,"h":49},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":49},"sourceSize":{"w":49,"h":49}},{"filename":"poisoners_kit.png","frame":{"x":455,"y":329,"w":44,"h":39},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":5,"w":44,"h":39},"sourceSize":{"w":48,"h":49}},{"filename":"poleaxe.png","frame":{"x":201,"y":1,"w":49,"h":49},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":49,"h":49},"sourceSize":{"w":49,"h":49}},{"filename":"potion_of_healing.png","frame":{"x":285,"y":203,"w":29,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":29,"h":49},"sourceSize":{"w":49,"h":49}},{"filename":"purple_plant.png","frame":{"x":425,"y":700,"w":48,"h":39},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":39},"sourceSize":{"w":48,"h":49}},{"filename":"quarterstaff.png","frame":{"x":100,"y":742,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":1,"w":45,"h":48},"sourceSize":{"w":49,"h":49}},{"filename":"quartz.png","frame":{"x":101,"y":1542,"w":42,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":42,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"ranger1-dead00.png","frame":{"x":373,"y":860,"w":46,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":12,"w":46,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-idle00.png","frame":{"x":342,"y":1286,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-idle01.png","frame":{"x":225,"y":1469,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-e00.png","frame":{"x":185,"y":1517,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-e01.png","frame":{"x":264,"y":1237,"w":39,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":4,"w":39,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-e02.png","frame":{"x":185,"y":1564,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-e03.png","frame":{"x":304,"y":1521,"w":36,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":4,"w":36,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-n00.png","frame":{"x":342,"y":1333,"w":35,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":3,"w":35,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-n01.png","frame":{"x":381,"y":1566,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-n02.png","frame":{"x":377,"y":1286,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-n03.png","frame":{"x":342,"y":1474,"w":36,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":4,"w":36,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-s00.png","frame":{"x":225,"y":1516,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-s01.png","frame":{"x":342,"y":1520,"w":36,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":36,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-s02.png","frame":{"x":225,"y":1563,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-s03.png","frame":{"x":304,"y":1286,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-w00.png","frame":{"x":462,"y":986,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-w01.png","frame":{"x":221,"y":1376,"w":40,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":40,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-w02.png","frame":{"x":462,"y":1033,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"ranger1-walk-w03.png","frame":{"x":303,"y":1567,"w":37,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":37,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rat-dead00.png","frame":{"x":244,"y":885,"w":45,"h":35},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":13,"w":45,"h":35},"sourceSize":{"w":48,"h":48}},{"filename":"rat-idle00.png","frame":{"x":422,"y":784,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"rat-idle01.png","frame":{"x":293,"y":842,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"rat-walk-e00.png","frame":{"x":425,"y":657,"w":48,"h":41},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":41},"sourceSize":{"w":48,"h":48}},{"filename":"rat-walk-n00.png","frame":{"x":348,"y":1244,"w":39,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":6,"w":39,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"rat-walk-s00.png","frame":{"x":445,"y":1080,"w":42,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":42,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rat-walk-w00.png","frame":{"x":422,"y":741,"w":48,"h":41},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":48,"h":41},"sourceSize":{"w":48,"h":48}},{"filename":"rat.png","frame":{"x":421,"y":826,"w":48,"h":40},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":7,"w":48,"h":40},"sourceSize":{"w":48,"h":48}},{"filename":"rat_pv-dead00.png","frame":{"x":373,"y":895,"w":46,"h":37},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":10,"w":46,"h":37},"sourceSize":{"w":48,"h":48}},{"filename":"rat_pv-idle00.png","frame":{"x":364,"y":194,"w":41,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":41,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"rat_pv-idle01.png","frame":{"x":101,"y":1591,"w":42,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":42,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"rat_pv-sleep00.png","frame":{"x":149,"y":589,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"rat_tail.png","frame":{"x":412,"y":1292,"w":38,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":7,"w":38,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"red_flask.png","frame":{"x":338,"y":389,"w":28,"h":49},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":0,"w":28,"h":49},"sourceSize":{"w":48,"h":49}},{"filename":"restorative_ointment.png","frame":{"x":451,"y":1332,"w":39,"h":35},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":7,"w":39,"h":35},"sourceSize":{"w":48,"h":49}},{"filename":"ring_mail_armour.png","frame":{"x":222,"y":1191,"w":42,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":42,"h":43},"sourceSize":{"w":48,"h":49}},{"filename":"ring_of_charisma.png","frame":{"x":452,"y":1300,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":40,"h":30},"sourceSize":{"w":49,"h":49}},{"filename":"ring_of_constitution.png","frame":{"x":452,"y":1406,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":40,"h":30},"sourceSize":{"w":49,"h":49}},{"filename":"ring_of_dexterity.png","frame":{"x":452,"y":1438,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":40,"h":30},"sourceSize":{"w":49,"h":49}},{"filename":"ring_of_intelligence.png","frame":{"x":450,"y":1470,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":40,"h":30},"sourceSize":{"w":49,"h":49}},{"filename":"ring_of_strength.png","frame":{"x":450,"y":1502,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":40,"h":30},"sourceSize":{"w":49,"h":49}},{"filename":"ring_of_wisdom.png","frame":{"x":451,"y":1534,"w":40,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":40,"h":30},"sourceSize":{"w":49,"h":49}},{"filename":"RIP.png","frame":{"x":150,"y":52,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-dead00.png","frame":{"x":421,"y":900,"w":46,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":12,"w":46,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-idle00.png","frame":{"x":379,"y":1333,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-idle01.png","frame":{"x":304,"y":1333,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-e00.png","frame":{"x":379,"y":1380,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-e01.png","frame":{"x":465,"y":1176,"w":34,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":34,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-e02.png","frame":{"x":380,"y":1427,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-e03.png","frame":{"x":230,"y":1610,"w":31,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":4,"w":31,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-n00.png","frame":{"x":342,"y":1380,"w":35,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":3,"w":35,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-n01.png","frame":{"x":414,"y":1332,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-n02.png","frame":{"x":380,"y":1474,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-n03.png","frame":{"x":414,"y":1378,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-s00.png","frame":{"x":304,"y":1380,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-s01.png","frame":{"x":415,"y":1424,"w":35,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":35,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-s02.png","frame":{"x":304,"y":1427,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-s03.png","frame":{"x":304,"y":1474,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-w00.png","frame":{"x":384,"y":1612,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-w01.png","frame":{"x":465,"y":1222,"w":34,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":34,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-w02.png","frame":{"x":415,"y":1470,"w":33,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":33,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"rogue1-walk-w03.png","frame":{"x":417,"y":1517,"w":31,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":31,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"rusty_key.png","frame":{"x":410,"y":1080,"w":33,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":2,"w":33,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"scale_mail_armour.png","frame":{"x":455,"y":284,"w":44,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":44,"h":43},"sourceSize":{"w":48,"h":49}},{"filename":"shadow-dead00.png","frame":{"x":145,"y":295,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"shadow-idle00.png","frame":{"x":51,"y":893,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"shadow-idle01.png","frame":{"x":51,"y":943,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"shield.png","frame":{"x":454,"y":145,"w":45,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":45,"h":45},"sourceSize":{"w":49,"h":49}},{"filename":"shortsword.png","frame":{"x":245,"y":582,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":46,"h":46},"sourceSize":{"w":49,"h":49}},{"filename":"silver_coins.png","frame":{"x":198,"y":581,"w":45,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":2,"w":45,"h":47},"sourceSize":{"w":49,"h":49}},{"filename":"skeleton-dead00.png","frame":{"x":455,"y":403,"w":44,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":13,"w":44,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"skeleton-idle00.png","frame":{"x":342,"y":1566,"w":37,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":37,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"skeleton-idle01.png","frame":{"x":145,"y":1591,"w":38,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":1,"w":38,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"skull.png","frame":{"x":149,"y":638,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":47,"h":47},"sourceSize":{"w":48,"h":48}},{"filename":"slime-idle00.png","frame":{"x":51,"y":993,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"slime-idle01.png","frame":{"x":51,"y":1043,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"spell.png","frame":{"x":293,"y":447,"w":42,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":42,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"spider_pv-dead00.png","frame":{"x":373,"y":820,"w":46,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":5,"w":46,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"spider_pv-idle00.png","frame":{"x":389,"y":1249,"w":32,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":10,"w":32,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"spider_pv-idle01.png","frame":{"x":341,"y":644,"w":32,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":10,"w":32,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"spider_pv-sleep00.png","frame":{"x":423,"y":1641,"w":30,"h":33},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":30,"h":33},"sourceSize":{"w":48,"h":48}},{"filename":"spider_venom.png","frame":{"x":417,"y":477,"w":48,"h":42},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":6,"w":48,"h":42},"sourceSize":{"w":48,"h":48}},{"filename":"stirge-dead00.png","frame":{"x":335,"y":1175,"w":43,"h":27},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":11,"w":43,"h":27},"sourceSize":{"w":48,"h":48}},{"filename":"stirge-idle00.png","frame":{"x":451,"y":1566,"w":38,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":38,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"stirge-idle01.png","frame":{"x":452,"y":1596,"w":38,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":10,"w":38,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"stirge-sleep00.png","frame":{"x":451,"y":1369,"w":35,"h":35},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":2,"w":35,"h":35},"sourceSize":{"w":48,"h":48}},{"filename":"stirge_head.png","frame":{"x":418,"y":1563,"w":31,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":5,"w":31,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"studded_leather_armour.png","frame":{"x":405,"y":99,"w":48,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":48,"h":43},"sourceSize":{"w":48,"h":49}},{"filename":"tiger_eye.png","frame":{"x":196,"y":196,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"trader1-dead00.png","frame":{"x":51,"y":1093,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader1-idle00.png","frame":{"x":242,"y":969,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"trader1-idle01.png","frame":{"x":100,"y":543,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader2-dead00.png","frame":{"x":51,"y":1143,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trader2-idle00.png","frame":{"x":307,"y":99,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"trader2-idle01.png","frame":{"x":100,"y":593,"w":47,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":47,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"trapdoor-dead00.png","frame":{"x":465,"y":1268,"w":34,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":9,"w":34,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"trapdoor-idle00.png","frame":{"x":469,"y":901,"w":30,"h":36},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":9,"y":9,"w":30,"h":36},"sourceSize":{"w":48,"h":48}},{"filename":"ui-checkbox00.png","frame":{"x":315,"y":146,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-checkbox01.png","frame":{"x":406,"y":144,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-guides00.png","frame":{"x":316,"y":194,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-guides01.png","frame":{"x":407,"y":192,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-hall-of-fame00.png","frame":{"x":407,"y":240,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-hall-of-fame01.png","frame":{"x":285,"y":354,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-play00.png","frame":{"x":407,"y":288,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-play01.png","frame":{"x":293,"y":545,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-settings00.png","frame":{"x":293,"y":593,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-settings01.png","frame":{"x":295,"y":712,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-down00.png","frame":{"x":295,"y":760,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-down01.png","frame":{"x":368,"y":336,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-left00.png","frame":{"x":368,"y":384,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-left01.png","frame":{"x":376,"y":521,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-right00.png","frame":{"x":376,"y":569,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-right01.png","frame":{"x":424,"y":568,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-up00.png","frame":{"x":374,"y":724,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"ui-spinner-up01.png","frame":{"x":374,"y":772,"w":46,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":46,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"undead00.png","frame":{"x":51,"y":1193,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"undefined.png","frame":{"x":343,"y":863,"w":28,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":11,"y":3,"w":28,"h":43},"sourceSize":{"w":49,"h":49}},{"filename":"vegetation-dead00.png","frame":{"x":85,"y":1693,"w":29,"h":10},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":18,"w":29,"h":10},"sourceSize":{"w":48,"h":48}},{"filename":"vegetation-idle00.png","frame":{"x":120,"y":1690,"w":29,"h":13},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":10,"y":15,"w":29,"h":13},"sourceSize":{"w":48,"h":48}},{"filename":"violet_fungus-dead00.png","frame":{"x":308,"y":1204,"w":42,"h":38},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":42,"h":38},"sourceSize":{"w":48,"h":48}},{"filename":"violet_fungus-idle00.png","frame":{"x":146,"y":865,"w":48,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"violet_fungus-idle01.png","frame":{"x":146,"y":912,"w":48,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":48,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"wall-B.png","frame":{"x":51,"y":1243,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BL.png","frame":{"x":341,"y":594,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BLI.png","frame":{"x":51,"y":1293,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BR.png","frame":{"x":291,"y":885,"w":34,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":34,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BRI.png","frame":{"x":51,"y":1343,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-BTEE.png","frame":{"x":51,"y":1393,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-HI.png","frame":{"x":51,"y":1443,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-L.png","frame":{"x":375,"y":1079,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-LTEE.png","frame":{"x":50,"y":1645,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-R.png","frame":{"x":85,"y":1643,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-RTEE.png","frame":{"x":120,"y":1640,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-T.png","frame":{"x":51,"y":1493,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TL.png","frame":{"x":143,"y":1191,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":15,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TLI.png","frame":{"x":51,"y":1543,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TR.png","frame":{"x":143,"y":1241,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TRI.png","frame":{"x":51,"y":1593,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-TTEE.png","frame":{"x":96,"y":194,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-VI.png","frame":{"x":146,"y":195,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall-XI.png","frame":{"x":145,"y":245,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-B.png","frame":{"x":99,"y":343,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-HI.png","frame":{"x":99,"y":393,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wall2-T.png","frame":{"x":99,"y":443,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"warhammer.png","frame":{"x":195,"y":245,"w":47,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":47,"h":47},"sourceSize":{"w":49,"h":49}},{"filename":"warlock1-dead00.png","frame":{"x":455,"y":370,"w":44,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":12,"w":44,"h":31},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-idle00.png","frame":{"x":263,"y":1283,"w":39,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":39,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-idle01.png","frame":{"x":374,"y":981,"w":42,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":42,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-e00.png","frame":{"x":263,"y":1330,"w":39,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":39,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-e01.png","frame":{"x":178,"y":1190,"w":42,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":42,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-e02.png","frame":{"x":263,"y":1377,"w":39,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":39,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-e03.png","frame":{"x":345,"y":1649,"w":37,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":4,"w":37,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-n00.png","frame":{"x":418,"y":981,"w":42,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":42,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-n01.png","frame":{"x":417,"y":935,"w":43,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":43,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-n02.png","frame":{"x":293,"y":1032,"w":42,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":3,"w":42,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-n03.png","frame":{"x":178,"y":1236,"w":42,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":42,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-s00.png","frame":{"x":221,"y":1282,"w":40,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":40,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-s01.png","frame":{"x":266,"y":1191,"w":40,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":40,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-s02.png","frame":{"x":221,"y":1329,"w":40,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":40,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-s03.png","frame":{"x":178,"y":1282,"w":41,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":41,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-w00.png","frame":{"x":263,"y":1424,"w":39,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":39,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-w01.png","frame":{"x":263,"y":1471,"w":39,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":4,"w":39,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-w02.png","frame":{"x":263,"y":1517,"w":39,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":39,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"warlock1-walk-w03.png","frame":{"x":384,"y":1659,"w":37,"h":44},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":4,"w":37,"h":44},"sourceSize":{"w":48,"h":48}},{"filename":"warning00.png","frame":{"x":99,"y":493,"w":48,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":48,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wasp_stinger.png","frame":{"x":263,"y":1611,"w":38,"h":43},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":2,"w":38,"h":43},"sourceSize":{"w":48,"h":48}},{"filename":"waterskin.png","frame":{"x":293,"y":496,"w":42,"h":47},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":2,"w":42,"h":47},"sourceSize":{"w":48,"h":49}},{"filename":"wight-dead00.png","frame":{"x":421,"y":868,"w":48,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":16,"w":48,"h":30},"sourceSize":{"w":48,"h":48}},{"filename":"wight-idle00.png","frame":{"x":342,"y":1427,"w":36,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":36,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"wight-idle01.png","frame":{"x":143,"y":1291,"w":33,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":33,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-dead00.png","frame":{"x":375,"y":646,"w":47,"h":36},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":10,"w":47,"h":36},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-idle00.png","frame":{"x":101,"y":1393,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-idle01.png","frame":{"x":244,"y":252,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-e00.png","frame":{"x":244,"y":302,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-e01.png","frame":{"x":100,"y":792,"w":45,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":0,"w":45,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-e02.png","frame":{"x":244,"y":352,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-e03.png","frame":{"x":291,"y":935,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-n00.png","frame":{"x":293,"y":1079,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-n01.png","frame":{"x":101,"y":1443,"w":40,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":40,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-n02.png","frame":{"x":334,"y":1079,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-n03.png","frame":{"x":325,"y":242,"w":37,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":37,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-s00.png","frame":{"x":143,"y":1341,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-s01.png","frame":{"x":461,"y":1126,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-s02.png","frame":{"x":143,"y":1391,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-s03.png","frame":{"x":379,"y":1028,"w":39,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":39,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-w00.png","frame":{"x":143,"y":1441,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-w01.png","frame":{"x":145,"y":1491,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-w02.png","frame":{"x":145,"y":1541,"w":38,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":38,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wizard1-walk-w03.png","frame":{"x":155,"y":1640,"w":36,"h":48},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":0,"w":36,"h":48},"sourceSize":{"w":48,"h":48}},{"filename":"wraith-dead00.png","frame":{"x":356,"y":99,"w":47,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":47,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"wraith-idle00.png","frame":{"x":195,"y":438,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"wraith-idle01.png","frame":{"x":195,"y":486,"w":48,"h":46},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":48,"h":46},"sourceSize":{"w":48,"h":48}},{"filename":"zombie-dead00.png","frame":{"x":293,"y":1129,"w":46,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":13,"w":46,"h":28},"sourceSize":{"w":48,"h":48}},{"filename":"zombie-idle00.png","frame":{"x":193,"y":1658,"w":37,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":3,"w":37,"h":45},"sourceSize":{"w":48,"h":48}},{"filename":"zombie-idle01.png","frame":{"x":263,"y":1564,"w":38,"h":45},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":38,"h":45},"sourceSize":{"w":48,"h":48}}],"meta":{"app":"https://www.codeandweb.com/texturepacker","version":"1.0","image":"dungeon.png","format":"RGBA8888","size":{"w":500,"h":1704},"scale":"1","smartupdate":"$TexturePacker:SmartUpdate:dcb2f5e894c5b8471c2082a6e4f33115:66479137979399990c1aa3767f05d835:9c0fba27a8a0c106083a8713f6c67b32$"}}');var r8={};r8=g("97l7Z").getBundleURL("cTejp")+"about.17717e71.md";var r3={};r3=g("97l7Z").getBundleURL("cTejp")+"armour.bfc2be64.txt";var r2={};r2=g("97l7Z").getBundleURL("cTejp")+"artefacts.45a4b495.txt";var r5={};r5=g("97l7Z").getBundleURL("cTejp")+"magic.4a13b173.txt";var r9={};r9=g("97l7Z").getBundleURL("cTejp")+"monsters.058b3f4d.txt";var r6={};r6=g("97l7Z").getBundleURL("cTejp")+"heroes.591e0f85.txt";var r7={};r7=g("97l7Z").getBundleURL("cTejp")+"money.46aa8910.txt";var ie={};ie=g("97l7Z").getBundleURL("cTejp")+"traders.1d8d82a4.txt";var it={};it=g("97l7Z").getBundleURL("cTejp")+"weapons.b3ea886f.txt";var ir={};ir=g("97l7Z").getBundleURL("cTejp")+"keys.f3b71340.txt";var ii={};ii=g("97l7Z").getBundleURL("cTejp")+"traps.57e309f4.txt";var ia={};ia=g("97l7Z").getBundleURL("cTejp")+"plants.4dd5938e.txt";var is={};is=g("97l7Z").getBundleURL("cTejp")+"portals.7bb576d2.txt";var io={};io=g("97l7Z").getBundleURL("cTejp")+"dungeon-completed.6e49dc4f.md";var il={};il=g("97l7Z").getBundleURL("cTejp")+"dungeon_script.34f994bb.txt";var ih={};ih=g("97l7Z").getBundleURL("cTejp")+"dungeon-welcome.e6dcb2ff.md";var ic={};ic=g("97l7Z").getBundleURL("cTejp")+"dungeon-welcome-casual.65517b23.md";var iu={};iu=g("97l7Z").getBundleURL("cTejp")+"help.006b9517.md";var id={};id=g("97l7Z").getBundleURL("cTejp")+"do-alto-do-trono-da-desolacao-trimmed_mono.215d559f.mp3";var ip={};ip=g("97l7Z").getBundleURL("cTejp")+"startupTips.02a317f6.md";var im={};im=g("97l7Z").getBundleURL("cTejp")+"quickStart.c6af80e6.md";var ig={};ig=g("97l7Z").getBundleURL("cTejp")+"punch-trimmed_mono.64c2f4ab.mp3";var iS={};iS=g("97l7Z").getBundleURL("cTejp")+"punch-trimmed-double_mono.7b9296a8.mp3";var iw={};iw=g("97l7Z").getBundleURL("cTejp")+"long-medium-swish-trimmed_mono.b327a476.mp3";var iE={};iE=g("97l7Z").getBundleURL("cTejp")+"bubbling-trimmed_mono.db7424d8.mp3";var iT={};iT=g("97l7Z").getBundleURL("cTejp")+"male-hurt-sound-trimmed_mono.4ec7c74d.mp3";var iy={};iy=g("97l7Z").getBundleURL("cTejp")+"pig-oink-47167_mono.2ac3313b.mp3";var iA={};iA=g("97l7Z").getBundleURL("cTejp")+"squeal-thing-103111_mono.d714c27c.mp3";var ix={};ix=g("97l7Z").getBundleURL("cTejp")+"zombie-6851_derived_mono.f7fb675b.mp3";var iI={};iI=g("97l7Z").getBundleURL("cTejp")+"metal-blade-slice-32-195321_mono.8d7c86a7.mp3";var iR={};iR=g("97l7Z").getBundleURL("cTejp")+"spell_chant2_mono.43eff101.mp3";var iO={};iO=g("97l7Z").getBundleURL("cTejp")+"door-43633_trimmed_exit_mono.ef3b57d8.mp3";var iN={};iN=g("97l7Z").getBundleURL("cTejp")+"door-43633_trimmed_enter_mono.1a48c8fe.mp3";var iC={};iC=g("97l7Z").getBundleURL("cTejp")+"sci-fi-portal-83746-trimmed_mono.c930e3c9.mp3";var iP={};iP=g("97l7Z").getBundleURL("cTejp")+"weapon_break.68534dec.mp3";var iD={};iD=g("97l7Z").getBundleURL("cTejp")+"click-and-crawl.f128c6c6.png";var iv={};iv=g("97l7Z").getBundleURL("cTejp")+"guide-move.d93b5484.jpg";var iL={};iL=g("97l7Z").getBundleURL("cTejp")+"guide-attack.d8b123a1.jpg";var iM={};iM=g("97l7Z").getBundleURL("cTejp")+"guide-hero.4145cb66.jpg";var i_={};i_=g("97l7Z").getBundleURL("cTejp")+"guide-cast.2d065439.jpg";var ib={};ib=g("97l7Z").getBundleURL("cTejp")+"guide-portal.4f9b8a3b.jpg";var iz={};iz=g("97l7Z").getBundleURL("cTejp")+"guide-door.5c04ee47.jpg";var ik={};ik=g("97l7Z").getBundleURL("cTejp")+"guide-target.e53830d2.png";var iG={};iG=g("97l7Z").getBundleURL("cTejp")+"guide-weapon-break.ee992992.jpg";let iU={ABOUT_MD:new URL(r8),ALMANAC_MAP:new Map([["ARMOUR",new URL(r3)],["ARTEFACTS",new URL(r2)],["MAGIC",new URL(r5)],["ENEMIES",new URL(r9)],["HEROES",new URL(r6)],["MONEY",new URL(r7)],["TRADERS",new URL(ie)],["WEAPONS",new URL(it)],["KEYS",new URL(ir)],["TRAPS",new URL(ii)],["PLANTS",new URL(ia)],["PORTALS",new URL(is)]]),DUNGEON_COMPLETE:new URL(io),DUNGEON_SCRIPT:new URL(il),DUNGEON_WELCOME:new URL(ih),DUNGEON_WELCOME_CASUAL:new URL(ic),HELP_MD:new URL(iu),MUSIC:new URL(id),STARTUP_TIPS_MD:new URL(ip),QUICK_START_MD:new URL(im),SOUND_EFFECTS_MAP:new Map([["PUNCH",new URL(ig)],["DOUBLE PUNCH",new URL(iS)],["MISS",new URL(iw)],["POISONED",new URL(iE)],["DIE",new URL(iT)],["DIE_MONSTER",new URL(iy)],["DIE_MONSTER_SMALL",new URL(iA)],["DIE_MONSTER_UNDEAD",new URL(ix)],["TRIGGER TRAP",new URL(iI)],["SPELL_CHANT",new URL(iR)],["DOOR_EXIT",new URL(iO)],["DOOR_ENTER",new URL(iN)],["PORTAL",new URL(iC)],["BREAK_WEAPON",new URL(iP)]]),SPLASH_IMAGE:new URL(iD),GUIDE_MOVE:new URL(iv),GUIDE_ATTACK:new URL(iL),GUIDE_HERO:new URL(iM),GUIDE_CAST:new URL(i_),GUIDE_PORTAL:new URL(ib),GUIDE_DOOR:new URL(iz),GUIDE_TARGET:new URL(ik),GUIDE_WEAPON_BREAK:new URL(iG)};var iB={};iB=g("97l7Z").getBundleURL("cTejp")+"dungeon.4a74dd17.png";let iH={data:(d=r1)&&d.__esModule?d.default:d,textureUrl:new URL(iB)};function iF(){let e=new e3({label:tr`BUTTON GETTING STARTED`,action:()=>i$(iU.STARTUP_TIPS_MD)}),t=new e3({label:tr`BUTTON ABOUT AND PRIVACY`,action:()=>i$(iU.ABOUT_MD)}),r=new e3({label:tr`BUTTON HELP`,action:()=>i$(iU.HELP_MD)});return i$(iU.QUICK_START_MD,{actionButtons:[e,r,t]})}function i$(e,t={}){return tq(e).then(r=>{var i,a,n;let s,o;r?(i=r,s=(a={post:[{re:/"https?:\/\/ASSET_URL_(\w*?)"/g,rep:iW}]},rW.clear(),n=rJ(n=i.replaceAll(/\r/g,""),rj),a?.pre&&(n=rJ(n,a.pre)),n=rJ(n,rZ),n=rJ(n,rq),n=rJ(n,rK),n=rJ(n,rV),n=rJ(n,rX),n=rJ(n,rQ),a?.post&&(n=rJ(n,a.post)),rW.reinstate(n)).replace(/"https?:\/\/ASSET_URL_(\w*?)"/g,iW)):o=tr`MESSAGE CANNOT LOAD URL ${e.toString()}`;let l=te("div",{className:"parsed-markdown",text:o,html:s=s.replace(/\$\{VERSION\}/g,`${S} ${w}`).replace(/\$\{COPYRIGHT\}/g,`\xa9 2024 Steve Butler`)});return tc.showControlsDialog(l,{actionButtons:t.actionButtons,row:!0,okButtonLabel:t.okButtonLabel})})}function iW(e,...t){let r=t[0];return r?`"${iU[r]}"`:""}let iY="á á¢á¦á¨á±á²á·á¹áºá¾áááááááááááááá";class iK{#t1;#t8;#t3;#t2;#t5;constructor(e){this.#t1=W(e.minCols,e.maxCols),this.#t8=W(e.minRows,e.maxRows),this.#t3=e.maxRoomCols,this.#t2=e.maxRoomRows}#t9(e=1){let t="";for(;e-- >0;)t+=$(rt.WALL);return t}#t6(e=1){let t="";for(;e-- >0;)t+=$(rt.GROUND);return t}#t7(e=1){let t="";for(;e-- >0;)t+=$(rt.VOID);return t}#re(e=1){let t="";for(;e-- >0;)t+=$(rt.DOOR_IN);return t}#rt(e=1){let t="";for(;e-- >0;)t+=$(rt.DOOR_OUT);return t}#rr(e){return rt.WALL.includes(e)}#ri(e){return rt.GROUND.includes(e)}#ra(e){return rt.VOID.includes(e)}#rn(e){return rt.DOOR_IN.includes(e)}#rs(e){return rt.DOOR_OUT.includes(e)}generate(){this.#t5=[];let e=0,t=this.#t1;for(;this.#t5.length<this.#t8-4;){let r=e+t-4-2,i=r>0?F(0,r):0,a=Math.max(e-i+4,4),n=Math.min(this.#t3,this.#t1-i),s=n>a?F(a,n):a,o=this.#t1-i-s,l=F(4,Math.min(this.#t2,this.#t8-this.#t5.length));this.#ro(i,s,o,l),e=i,t=s}return this.#rl(),this.#rh(),this.getMatrixAsStrings()}getMatrixAsStrings(){return this.#t5.map(e=>e.join(""))}#ro(e,t,r,i){let a="";a+=this.#t7(e)+this.#t9(t)+this.#t7(r),this.#t5.push(a.split(""));for(let n=0;n<i-2;n++)a=""+this.#t7(e)+this.#t9(1)+this.#t6(t-2)+this.#t9(1)+this.#t7(r),this.#t5.push(a.split(""));a=""+this.#t7(e)+this.#t9(t)+this.#t7(r),this.#t5.push(a.split(""))}#rl(){for(let e=1;e<this.#t5.length-1;e++)for(let t=1;t<this.#t5[0].length-2;t++)this.#rr(this.#t5[e][t])&&this.#rr(this.#t5[e+1][t])&&this.#ri(this.#t5[e-1][t])&&this.#ri(this.#t5[e+2][t])&&(this.#t5[e][t]=this.#t6(1),this.#t5[e+1][t]=this.#t6(1))}#rc(e){return this.#rr(e.above)&&this.#rr(e.centre)&&this.#rr(e.below)}#ru(e){return this.#rr(e.left)&&this.#rr(e.centre)&&this.#rr(e.right)}#rh(){let e=[];this.#t5.forEach((t,r)=>t.forEach((t,i)=>{let a=t6(this.#t5,r,i);(this.#ru(a)||this.#rc(a))&&e.push({row:r,col:i})}));let t=re(e),r=t[0];this.#t5[r.row][r.col]=this.#re(),r=t[1],this.#t5[r.row][r.col]=this.#rt()}}function iV(e,t,r,i){for(let a of t){let t=new tW(a.traitsString);if(i||t.get("CASTERS","").indexOf(e.traits.get("CLASS",""))>=0){let t=t4(a);"CANTRIP"===a.typeId||r?e.storeManager.equip(t,{direct:!0}):e.storeManager.stash(t,{direct:!0})}}}let iX={INSIGNIFICANT:1/64,EASY:3/16,MEDIUM:1/4};function iq(e){return e*(i?.traits.getCharacterLevel()??1)+.001}class ij{#h;#rd;#rf;constructor(){this.reset()}setChallenge(e){this.#rf=e,L.info(`Dungeon challenge rating set to ${e}`)}getIndex(){return this.#h}getNext(){return this.#h++,0===this.#h&&(i=null),this.#rp(),this.#rd}hasNext(){return!0}reset(){this.#rf=iX.MEDIUM,this.#h=-1}restore(e,t){i=t,this.#h=e}#rp(){this.#rd=new aO,this.#rm(),this.#rg(),this.#rS(this.#rf),this.#rw(),this.#rE(),this.#rT(),tg(20)>13&&(L.info("Adding a portal."),this.#ry())}#rg(){this.#rd.intro=tr`MESSAGE ENTER FLOOR ${rb(this.#h)}`}#rm(){if(i||(i=function(){let e;if("localhost"!==window.location.hostname)return;let t=new URLSearchParams(window.location.search),r=t.get("HERO");if(!r)return;let i=!1;if("GANDALPH"===r.toUpperCase())e=rM(tQ("0,COMMON,HERO,wizard1 [chain_mail_armour,iron_rations, iron_rations, iron_rations, waterskin, waterskin, waterskin,copper_coins] * NAME:Gandalph,CLASS:WIZARD,HIT_DICE:1D8,EXP:0, AC:10,_SPEED:30 FEET","HEROES")),i=!0;else if(!(e=function(e,t){let r=tJ.getAlmanac(e),i=r?.find(e=>e.id===t);if(!i){L.error(`Cannot find actor ${t} in ${e} almanac, so ignoring.`);return}let a=rM(i);if(!a){L.error(`Cannot build actor ${t} in ${e} almanac, so ignoring.`);return}return a}("HEROES",r)))return;let a=null!==t.get("equipSpells"),n=null!==t.get("stashSpells");if(a||n){let t=tJ.getAlmanac("MAGIC");iV(e,t.common,a,i),iV(e,t.uncommon,a,i),iV(e,t.rare,a,i),iV(e,t.veryRare,a,i)}for(let r of["ARMOUR","ARTEFACTS","PLANTS","WEAPONS"])(function(e,t,r){if(!r)return;let i=tJ.getAlmanac(t),a=i?.find(e=>e.id===r);if(!a){L.error(`Could not find ${r} in ${t} almanac. Ignoring.`);return}let n=t4(a);e.storeManager.stash(n,{direct:!0})})(e,r,t.get(r));return e}()),!i){let e=tJ.getRandomEntry("HEROES");e||L.fatal(Error("Could not find hero in almanacs.")),i=rM(e)}this.#rd.hero=i}#rS(e=iX.MEDIUM){let t,r;let i=function(){if("localhost"!==window.location.hostname)return;let e=new URLSearchParams(window.location.search).get("ENEMY");if(e){let t=tJ.getAlmanac("ENEMIES");return t?.find(t=>t.id===e)}}();if(i){this.#rd.enemies.push(i);return}let a=iq(e),n=e*(aD.getCurrentSceneLevel()/15)+.001;switch(e){case iX.EASY:t=6,r=a+n;break;case iX.MEDIUM:default:t=8,r=(a+n)*1.25}let s=function(e,t){let r=iq(e);return tJ.getAlmanac("ENEMIES").filter(e=>e.challengeRating<=r&&e.minLevel<=t)}(e,this.#h),o=0,l=0;for(;o<r&&l<t;){let e=s.getRandomEntry();o+=Math.max(e.challengeRating,iX.INSIGNIFICANT),l++,this.#rd.enemies.push(e)}L.info(`Scene challenge rating ${o.toFixed(3)} from ${l} enemies.`)}#rw(){for(let e=0;e<1;e++){let e=tJ.getRandomEntry("TRADERS",e=>e.minLevel<=this.#h);this.#rd.enemies.push(e)}}#rE(){let e=function(){if("localhost"!==window.location.hostname)return;let e=new URLSearchParams(window.location.search).get("ARTEFACT");if(e){let t=tJ.getPooledAlmanac(["ARTEFACTS","MAGIC","MONEY","WEAPONS","TRAPS","PLANTS"]);return t?.find(t=>t.id===e)}}();e&&this.#rd.artefacts.push(e);let t=tJ.getPooledAlmanac(["ARTEFACTS","MAGIC","MONEY","WEAPONS","TRAPS","PLANTS"],e=>e.minLevel<=this.#h),r=W(4,12);for(;r-- >0;){let e=t.getRandomEntry();e&&this.#rd.artefacts.push(e)}}#ry(){let e=tJ.getRandomEntry("PORTALS",e=>e.minLevel<=this.#h);e&&(this.#rd.portal=e)}#rT(){let e=new iK({minCols:12,maxCols:40,maxRoomCols:10,minRows:12,maxRows:40,maxRoomRows:6});this.#rd.mapDesign=e.generate()}}let iZ=!0,iQ={MAIN_MENU:0,CLICKED_FREE_GROUND:1,CLICKED_ENTRANCE:2,CLICKED_EXIT:3},iJ=!0;class i4{#e7;#rA;#rx;#e1;#rI;#rR;constructor(e,t,r,i){this.#e7=e,this.#e1=t,this.#rI=r,this.#rR=i}#rO(e){if(this.#e7.moveType===na.HUNT){if(this.#rR)return e;{let t=this.#e1.worldPointToGrid(a.position);if(e.getOrthoSeparation(t)-1<=1.5*this.#e7.getMaxTilesPerMove())return this.#e1.worldPointToGrid(a.position)}}return this.#rN(e,this.#e7.getMaxTilesPerMove())}moveInstantly(){this.#rx=j.copy(this.#e7.position);let e=this.#e7.getMaxTilesPerMove();if(0===e)return;let t=this.#e1.worldPointToGrid(this.#e7.position),r=this.#rO(t);if(!r.coincident(t)){this.#rI.actor=this.#e7;let i=this.#rI.getDumbRouteNextTo(t,r,e);i.length>0&&(this.#rA=new eX({path:i,speed:100},this.#e7.sprite.modifier),this.#rC(i[i.length-1]))}}#rN(e,t){let r=W(e.x-t,e.x+t),i=W(e.y-t,e.y+t),a=this.#e1.getDimsInTiles();return new V(B(r,0,a.width-1),B(i,0,a.height-1))}#rC(e){let t=this.#e1.worldPointToGrid(this.#e7.position);this.#e7.position=e;let r=this.#e1.worldPointToGrid(this.#e7.position);this.#e1.moveTileOccupancyGridPoint(this.#e7,t,r)}#rP(){this.#rC(this.#rx)}replay(){return(this.#rP(),this.#rA)?(this.#rD(),this.#rA.applyAsTransientToSprite(this.#e7.sprite)):Promise.resolve()}#rD(){if(this.#e7.isOrganic()){let e=rM(this.#e7.almanacEntry);e.position=this.#rx,e.freezeMovement(),ex.addActor(e)}}}class i0{#e1;#rI;#rv;#rR;constructor(e,t,r){this.#rv=[],this.#e1=e,this.#rI=t,this.#rR=r}addAndMoveActor(e){if(0===e.getMaxTilesPerMove())return;let t=new i4(e,this.#e1,this.#rI,this.#rR);t.moveInstantly(),this.#rv.push(t)}replay(){let e=[];return this.#rv.forEach(t=>e.push(t.replay())),Promise.all(e)}}class i1{constructor(){}async transitionTo(e){await this.onExit().then(()=>(ac=e,e.onEntry()))}onEntry(){return Promise.resolve()}onEvent(e){return Promise.resolve(null)}onExit(){return Promise.resolve(null)}}class i8 extends i1{async onEntry(){let e=!!rH();iJ="PLAY CASUAL"!==await this.#rL(e),await this.transitionTo(new i3)}async #rL(e){let t,r=!1;for(;!r;)(t=await (function(e){let t=new e2({leftLabel:e?tr`BUTTON CONTINUE ADVENTURE`:tr`BUTTON PLAY ADVENTURE`,imageName:"ui-play00.png",internalLabel:!0,closes:"PLAY ADVENTURE"}),r=new e2({leftLabel:tr`BUTTON PLAY CASUAL`,imageName:"ui-play00.png",internalLabel:!0,closes:"PLAY CASUAL"}),i=new e2({leftLabel:tr`BUTTON SETTINGS`,imageName:"ui-settings00.png",internalLabel:!0,action:()=>ry()}),a=new e2({leftLabel:tr`BUTTON HALL OF FAME`,imageName:"ui-hall-of-fame00.png",internalLabel:!0,action:()=>(function(){let e=te("div",{className:"best-adventure"}),t=rU().getCurrentData();if(0===t.length)e.appendChild(te("p",{text:tr`MESSAGE NO SAVED ADVENTURE`}));else{let r=document.createElement("ul");for(let i of(e.appendChild(r),t))r.appendChild(te("li",{text:function(e){let t=new Date(e.adventureStartTime).toISOString().split("T")[0],r=e.class?.toLowerCase()??"";return tr`MESSAGE HALL OF FAME ENTRY ${e.name} ${e.characterLevel} ${r} ${t} ${e.goldSent} ${e.dungeonFloor}`}(i)}))}return tc.showElementOkDialog(tr`DIALOG TITLE HALL OF FAME`,e)})()}),n=new e2({leftLabel:tr`BUTTON GUIDES`,imageName:"ui-guides00.png",internalLabel:!0,action:()=>iF()});return tc.showControlsDialog(tr`MENU TITLE MAIN`,{actionButtons:[n,i,a,t,r],className:"door"})})(e).then(e=>this.#rM(e)))&&(r=!0);return Promise.resolve(t)}#rM(e){return"PLAY CASUAL"!==e?e:tc.showChoiceDialog(tr`DIALOG TITLE CASUAL GAME WARNING`,tr`MESSAGE CASUAL GAME WARNING`,[tr`BUTTON ENTER DUNGEON`,tr`BUTTON CANCEL`]).then(t=>0===t?e:null)}}class i3 extends i1{onEntry(){return L.debug("Enter AtStart"),this.#r_().then(()=>this.#rb()).then(e=>{let t=a.traits.get("NAME");return e?tc.showOkDialog(tr`MESSAGE DUNGEON INTRO CONTINUE ${t}`,{okButtonLabel:tr`BUTTON ENTER DUNGEON`,className:"wall"}).then(()=>aq(a)).then(e=>"MAIN MENU"===e?Promise.reject("MAIN_MENU"):a.alive?void 0:Promise.reject("DEAD")):i$(iJ?iU.DUNGEON_WELCOME:iU.DUNGEON_WELCOME_CASUAL,{okButtonLabel:tr`BUTTON ENTER DUNGEON`})}).then(()=>{a.sprite.position=ex.getTileMap().getWorldPositionOfTileByEntry()}).then(()=>{let e=aD.getCurrentSceneIntro();return e?tc.showOkDialog(e,{className:"mask"}):void 0}).then(()=>tu.playEffect("DOOR_ENTER")).then(()=>ac.transitionTo(new i9)).catch(e=>{"DEAD"===e?(L.info("Hero died during rest."),ac.transitionTo(new i2)):ac.transitionTo(new i8)})}#rb(){let e=iJ?rH():null;return e?aD.continueFromSavedScene(e.sceneLevel,e.hero).then(()=>!0):aD.switchToFirstScene().then(()=>!1)}#r_(){if(!e1.get("SHOW_QUICK_TIPS_AT_START",!0))return Promise.resolve();let e=new e3({label:tr`BUTTON OK`,closes:"OK"}),t=new e3({label:tr`BUTTON DO NOT SHOW AGAIN`,closes:"NOT AGAIN"});return i$(iU.STARTUP_TIPS_MD,{actionButtons:[e,t]}).then(e=>{"NOT AGAIN"===e&&e1.set("SHOW_QUICK_TIPS_AT_START",!1)})}}class i2 extends i1{async onEntry(){L.debug("Enter AtGameOver");let e=-1;iJ&&(e=rB(a)),eQ(tr`YOU DIED!`,{delaySecs:1,lifetimeSecs:3,position:a.position,velocity:new X(0,-100,0)}),await rw(2).then(()=>(function(e,t,r){let i=document.createElement("div"),a=te("div",{className:"actor-container"});i.appendChild(a),a.appendChild(aF(e,{hideTraits:!0,description:r.description}));let n=rb(aD.getCurrentSceneLevel()),s=e.traits.getInt("GOLD_SENT",0);i.appendChild(te("p",{text:tr`MESSAGE ACHIEVEMENTS ${n} ${s}`}));let o=t<0?tr`MESSAGE DEFEAT UNPLACED`:tr`MESSAGE DEFEAT`;return i.appendChild(te("p",{text:o})),tc.showControlsDialog(i,r)})(a,e,{okButtonLabel:tr`BUTTON TRY AGAIN`})).then(()=>aD.unloadCurrentScene()).then(()=>this.transitionTo(new i8))}}class i5 extends i1{async onEntry(){L.debug("Enter AtGameCompleted"),await i$(iU.DUNGEON_COMPLETE,{okButtonLabel:tr`BUTTON TRY AGAIN`}).then(()=>aD.unloadCurrentScene()).then(()=>this.transitionTo(new i8))}}class i9 extends i1{constructor(){super()}async onEntry(){await super.onEntry(),L.debug("Enter HeroTurnIdle"),await at(),await ar()&&await this.transitionTo(new i2)}async onEvent(e,t,r={}){switch(ex.getTileMap().highlightsOn=!1,e){case iQ.CLICKED_FREE_GROUND:{let e=await al(r.filter,r.occupant);e===rp.INTERACT_TILE?await an(t):e===rp.OCCUPIED_TILE?await ao(r.occupant):await ai(t,{usePathFinder:r.filter!==rp.MOVE_OR_INTERACT_TILE}),0===a.traits.get("HP",0)?await this.transitionTo(new i2):await this.transitionTo(new i7)}break;case iQ.CLICKED_ENTRANCE:await tc.showOkDialog(tr`MESSAGE ENTRANCE STUCK`),await this.transitionTo(new i7);break;case iQ.CLICKED_EXIT:L.debug("Escaping"),await ah()?await ai(t,{usePathFinder:!1}).then(()=>as(this)):await this.transitionTo(new i7)}return Promise.resolve(null)}}class i6 extends i1{constructor(){super()}async onEntry(){await super.onEntry(),L.debug("Enter HeroTurnInteracting"),await at(),await ar()&&await this.transitionTo(new i2)}async onEvent(e,t,r={}){switch(ex.getTileMap().highlightsOn=!1,e){case iQ.CLICKED_FREE_GROUND:{let e=await al(r.filter,r.occupant);e===rp.INTERACT_TILE?await an(t):e===rp.OCCUPIED_TILE?await ao(r.occupant):await this.#rz(t,{usePathFinder:r.filter!==rp.MOVE_OR_INTERACT_TILE}),0===a.traits.get("HP",0)?await this.transitionTo(new i2):await this.#rk()}break;case iQ.CLICKED_ENTRANCE:await tc.showOkDialog(tr`MESSAGE ENTRANCE STUCK`),await this.#rk();break;case iQ.CLICKED_EXIT:await ah()?await this.#rz(t,{usePathFinder:!1}).then(()=>as(this)):await this.#rk()}return Promise.resolve(null)}async #rk(){0===ex.getTileMap().getParticipants(a).length?await this.transitionTo(new i7):await this.transitionTo(new ae)}#rz(e,t={usePathFinder:!0}){let r=ex.getTileMap(),i=r.getParticipants(a),n=!1;for(let e of i)if(e.alive&&e.interaction.respectDisengage(a)){n=!0;break}let s=r.worldPointToGrid(a.position),o=r.worldPointToGrid(e),l=s.getOrthoSeparation(o);return n&&l<=2&&(a.disengaging=!0),ai(e,t).then(()=>!0)}}class i7 extends i1{constructor(){super()}async onEntry(){await super.onEntry(),L.debug("Enter ComputerTurnIdle"),await aa();let e=ex.getTileMap(),t=new ru(e),r=new i0(e,t,a.disengaging);for(let e of ex.getActors().values())e!==a&&e.alive&&!e.sleeping&&(!e.isWandering()||tg(6)>3)&&r.addAndMoveActor(e);for(let e of ex.getOrganicActors().values())e.alive&&r.addAndMoveActor(e);for(let t of(await r.replay(),e.getParticipants(a)))if(t.isEnemy())return await this.transitionTo(new i6),Promise.resolve(null);await this.transitionTo(new i9)}}class ae extends i1{constructor(){super()}async onEntry(){await super.onEntry(),await aa();let e=ex.getTileMap(),t=new ru(e),r=new i0(e,t,a.disengaging),i=e.getParticipants(a);for(let e of ex.getActors().values())e!==a&&e.alive&&e.interaction&&!e.sleeping&&(i.includes(e)&&e.willInteract()?await e.interaction.enact(a):r.addAndMoveActor(e));for(let e of ex.getOrganicActors().values())e.alive&&r.addAndMoveActor(e);return await r.replay(),0===a.traits.get("HP",0)?await this.transitionTo(new i2):0===i.length?await this.transitionTo(new i9):await this.transitionTo(new i6),Promise.resolve(null)}}async function at(){iZ=!0,a.disengaging=!1;let e=ex.getTileMap(),t=new ru(e,a).getAllRoutesFrom(e.worldPointToGrid(a.sprite.position),a.getMaxTilesPerMove());return e.setMovementRoutes(t,a.position),e.setInteractActors(e.getParticipants(a)),e.calcReachableDoors(a.position),e.highlightsOn=!0,Promise.resolve(null)}function ar(){return!!a.toxify?.isActive&&(a.toxify.enact(a),0>=a.traits.getInt("HP",0))}function ai(e,t={usePathFinder:!0}){let r;let i=ex.getTileMap();return(r=t.usePathFinder?i.getWaypointsToWorldPoint(e):[a.position,e],i.setMovementRoutes(null),i.setInteractActors(null),r)?(function(e){if(0===e.length)return;let t=a.position.getOrthoSeparation(e[e.length-1]);if(!function(e,t){if(t<=1)return!0;let r=tG(e,{ability:"DEX",proficiency:"STEALTH",difficulty:t<=2?tL.EASY:tL.MEDIUM});return r?L.info("Crept past successfully without disturbing monsters."):L.info("Creeping but unsuccessfully. Monsters could be disturbed."),r}(a.traits,ex.getTileMap().worldDistanceToTiles(t)))for(let t of e)tB(t,1)}(r),new eX({path:r,speed:100},a.sprite.modifier).applyAsTransientToSprite(a.sprite)):Promise.resolve()}function aa(){let e=ex.getTileMap(),t=[];return ex.getOrganicActors().forEach(r=>{e.getCoincidentActors(r).forEach(e=>{e.alive&&!e.isOrganic()&&r.interaction&&t.push(r.interaction.enact(e))})}),Promise.all(t)}function an(e){let t=ex.getTileMap().getTileAtWorldPoint(e).getOccupants(),r=[];for(let e of t.values())e.interaction&&r.push(e.interaction.react(a));return r.length>0&&tB(a.position,2),Promise.all(r)}function as(e){return(a.traits.clearTransientFxTraitsAndProperties(),iJ&&rB(a),aD.areThereMoreScenes())?aD.unloadCurrentScene().then(()=>aq(a,iJ)).then(e=>"MAIN MENU"===e?Promise.reject("MAIN_MENU"):a.alive?void 0:Promise.reject("DEAD")).then(()=>tg(6)>3?Promise.resolve():(function(e){let t=function(e){let t=W(1,Math.min(4,1+e)),r=W(4,Math.min(4+e,15)),i=F(0,iY.length-r),a=iY.substring(i,i+r),n=[];for(let e=0;e<r;e++)n.push(W(1,r));return{runes:a,repetitions:4+e,sequences:t,sequenceOffsets:n,startOffset:W(0,r),nextLength:W(2,5)}}(e),r=function(e={}){let t=e.runes??"ABCD",r=e.sequences??1,i=Math.max(e.repetitions??0,4),a=e.sequenceOffsets??[1],n=e.startOffset??0,s=e.nextLength??1;s=Math.min((i-3)*r,s);let o="";for(let e=0;e<i;e++)for(let i=0;i<r;i++){var l;o+=(l=n+(i<a.length?a[i]:a[a.length-1])*(1+e),t.charAt(l%t.length))}return{sequence:o.substring(0,o.length-s),next:o.substring(o.length-s)}}(t),i=r.next,a=function(e,t){let r=e.split(""),i=F(0,r.length);for(let e=0;e<t.length;e++){let a=t.charAt(e);if(a!==r[i]){r[i]=a;break}}return r.join("")}(i,t.runes);if(a===i)return Promise.resolve(!0);let n=te("div");n.appendChild(te("p",{text:tr`MESSAGE RUNES ON WALL`})),n.appendChild(te("p",{className:"runes",text:`${t.runes} ${r.sequence}`})),n.appendChild(te("p",{text:tr`MESSAGE RUNES OVER DOORS`}));let s=F(0,1),o=["",""];return o[s]=i,o[1-s]=a,tc.showChoiceDialog(tr`DIALOG TITLE RUNE PUZZLE`,n,o,"rune-puzzle").then(e=>e===s)})(aD.getCurrentSceneLevel()).then(e=>{let t;return e?(aD.setDungeonChallenge(iX.EASY),t=tr`MESSAGE ROUTE CHOICE - EASY`):(aD.setDungeonChallenge(iX.MEDIUM),t=tr`MESSAGE ROUTE CHOICE - MEDIUM`),tc.showOkDialog(t)})).then(()=>aD.switchToNextScene()).then(e=>(a.sprite.position=ex.getTileMap().getWorldPositionOfTileByEntry(),e)).then(e=>e.intro?tc.showOkDialog(e.intro,{className:"wall"}):void 0).then(()=>tu.playEffect("DOOR_ENTER")).then(()=>e.transitionTo(new i9)).catch(t=>{"DEAD"===t?(L.info("Hero died during rest."),e.transitionTo(new i2)):e.transitionTo(new i8)}):e.transitionTo(new i5)}function ao(e){return e?e.isHiddenArtefact()?tc.showOkDialog(e.description):aV(e,{allowConsumption:e.isHero(),allowMagicUse:e.isHero()}).then(e=>{if(e?.invoke)return L.info("Invoke action."),e.invoke()}):(L.error("Clicked on tile but no occupant to view."),Promise.resolve())}function al(e,t){if(e===rp.MOVE_OR_INTERACT_TILE){let e,r,i;return t.isPortal()?(e=tr`MESSAGE USE PORTAL OR MOVE`,r=tr`BUTTON MOVE`,i=tr`BUTTON USE`):(e=tr`MESSAGE SEARCH OR MOVE`,r=tr`BUTTON MOVE`,i=tr`BUTTON SEARCH`),tc.showChoiceDialog(tr`DIALOG TITLE CHOICES`,e,[r,i]).then(e=>0===e?rp.MOVEMENT_TILE:rp.INTERACT_TILE)}return e}function ah(){var e,t;return n?a.storeManager.hasArtefact(n)?(a.storeManager.discard(n),tc.showOkDialog(tr`MESSAGE KEY UNLOCKS EXIT`).then(()=>(tu.playEffect("DOOR_EXIT"),!0))):(e=a,t=n,tc.showChoiceDialog(tr`DIALOG TITLE LOCKED`,tr`MESSAGE EXIT LOCKED`,[tr`BUTTON TRY TO PICK`,tr`BUTTON LEAVE IT`]).then(r=>0===r&&function(e,t){let r=e.storeManager.getArtefactWithSameId("lock_pick");return r?tU("STANDARD METAL")?(e.storeManager.discard(r),tc.showOkDialog(tr`MESSAGE LOCK PICK BREAKS`).then(()=>!1)):tG(e.traits,{ability:"DEX",difficulty:t.traits.get("DC",tL.EASY),proficiency:"PICK LOCK"})?tc.showOkDialog(tr`MESSAGE YOU PICK THE LOCK`).then(()=>!0):tc.showOkDialog(tr`MESSAGE YOU FAIL TO PICK THE LOCK`).then(()=>!1):tc.showOkDialog(tr`MESSAGE NEED LOCK PICK`).then(()=>!1)}(e,t))).then(e=>(e&&tu.playEffect("DOOR_EXIT"),e)):(tu.playEffect("DOOR_EXIT"),Promise.resolve(!0))}let ac=new class extends i1{onEntry(){L.debug("WaitingToStart state")}async onEvent(e,t,r){if(e!==iQ.MAIN_MENU)return Promise.resolve();await this.transitionTo(new i8)}},au=!1;var ad={EventId:iQ,setHero:function(e){a=e},triggerEvent:function(e,t,r){if(au){L.debug(`Ignoring event ${e} as still processing earlier event.`);return}au=!0,ac.onEvent(e,t,r).then(()=>{au=!1})},setExitKeyArtefact:function(e){n=e}};function af(e){return{role:rm.GROUND,onClick:(e,t,r)=>ad.triggerEvent(ad.EventId.CLICKED_FREE_GROUND,t,r),image:e}}function ap(e){return{role:rm.ENTRANCE,onClick:(e,t,r)=>ad.triggerEvent(ad.EventId.CLICKED_ENTRANCE,t,r),image:e}}function am(e){return{role:rm.EXIT,onClick:(e,t,r)=>ad.triggerEvent(ad.EventId.CLICKED_EXIT,t,r),image:e}}let ag=new Map([["x",{role:rm.OBSTACLE,image:"block.png"}],["#-TL",{role:rm.OBSTACLE,image:"wall-TL.png"}],["#-TLI",{role:rm.OBSTACLE,image:"wall-TLI.png"}],["#-T",{role:rm.OBSTACLE,image:"wall-T.png"}],["*-T",{role:rm.OBSTACLE,image:"wall2-T.png"}],["#-TR",{role:rm.OBSTACLE,image:"wall-TR.png"}],["#-TRI",{role:rm.OBSTACLE,image:"wall-TRI.png"}],["#-R",{role:rm.OBSTACLE,image:"wall-R.png"}],["#-BR",{role:rm.OBSTACLE,image:"wall-BR.png"}],["#-BRI",{role:rm.OBSTACLE,image:"wall-BRI.png"}],["#-B",{role:rm.OBSTACLE,image:"wall-B.png"}],["*-B",{role:rm.OBSTACLE,image:"wall2-B.png"}],["#-BL",{role:rm.OBSTACLE,image:"wall-BL.png"}],["#-BLI",{role:rm.OBSTACLE,image:"wall-BLI.png"}],["#-L",{role:rm.OBSTACLE,image:"wall-L.png"}],["#-XI",{role:rm.OBSTACLE,image:"wall-XI.png"}],["#-VI",{role:rm.OBSTACLE,image:"wall-VI.png"}],["#-HI",{role:rm.OBSTACLE,image:"wall-HI.png"}],["#-TTEE",{role:rm.OBSTACLE,image:"wall-TTEE.png"}],["#-RTEE",{role:rm.OBSTACLE,image:"wall-RTEE.png"}],["#-BTEE",{role:rm.OBSTACLE,image:"wall-BTEE.png"}],["#-LTEE",{role:rm.OBSTACLE,image:"wall-LTEE.png"}],["#",{role:rm.OBSTACLE,image:"block.png"}],["=-T",am("door-T.png")],[">-T",am("door2-T.png")],["=-R",am("door-R.png")],["=-B",am("door-B.png")],[">-B",am("door2-B.png")],["=-L",am("door-L.png")],["--T",ap("door-T.png")],["~-T",ap("door2-T.png")],["--R",ap("door-R.png")],["--B",ap("door-B.png")],["~-B",ap("door2-B.png")],["--L",ap("door-L.png")],["=",{role:rm.OBSTACLE,image:"block.png"}],["-",{role:rm.OBSTACLE,image:"block.png"}],[".",af("floor.png")],[".-SBW",af("floor-SBW.png")],[".-SBE",af("floor-SBE.png")],[",-SBE",af("floor2-SBE.png")],[",-SBW",af("floor2-SBW.png")],[",",af("floor2.png")]]);class aS{#rG;#X;#rU;#rB;#rH;heroActor;intro;constructor(e=2,t=2){e>0?(this.#rG=0,this.#X=1/e):this.#X=1,this.#rU=e,this.#rB=t}getOpacity(){return this.#rG}load(){return this.doLoad()}initialise(){return this.doInitialise()}update(e){eg.clearCanvas(),eg.setOpacity(this.#rG),ex.update(e),this.doUpdate(e),eg.setOpacity(1),0!==this.#X&&(this.#rG+=e*this.#X,this.#rG>1?(this.#X=0,this.#rG=1):this.#rG<0&&(this.#X=0,this.#rG=0)),this.#rH&&0===this.#rG&&(this.#rH(),this.#rH=null)}unload(){return this.#rF().then(()=>this.doUnload())}#rF(){return this.#rB>0?(this.#X=-1/this.#rB,new Promise(e=>{this.#rH=e})):Promise.resolve()}doLoad(){return Promise.resolve()}doInitialise(){return Promise.resolve()}doUpdate(e){return Promise.resolve()}doUnload(){return Promise.resolve()}}let aw=e4.TILE_SIZE;function aE(e,t){let r,i;if(t8(e.type,t1.CONSUMABLE)&&/SUBTYPE *: *VEGETATION/i.test(e.traitsString))r="vegetation",i=nr.HIDDEN_ARTEFACT;else switch(e.type.id){case t1.SPELL.id:case t1.CANTRIP.id:r="engraved_pillar",i=nr.PROP;break;default:{let e=tg(6);r=e<3?"hidden_artefact":e<5?"trapdoor":"manhole_cover"}i=nr.HIDDEN_ARTEFACT}let a=rM({id:r,name:tV(r),description:tX(r),imageName:r,type:i,traitsString:""}),n=t??t4(e);return a.storeManager.addArtefact(n),a}function aT(e,t,r){if(t){let i=t4(t);r.equip&&i.equipStoreType?e.storeManager?.equip(i,{direct:!0}):e.storeManager?.stash(i,{direct:!0})}}class ay extends aS{#rd;constructor(e){super(),this.#rd=e,this.intro=e.intro}doLoad(){return Promise.resolve()}doInitialise(){var e;let t=ra.generateTileMapPlan(this.#rd.mapDesign,ag);this.heroActor=function(e){if(e.hero instanceof nn)s=e.hero;else if(e.hero)s=rM(e.hero);else if(!s)throw Error("No hero has been defined.");return s}(this.#rd);let r=new rS(eg.getContext2D(),t,aw,this.heroActor);ex.setTileMap(r);let i=(e=this.#rd).portal?rM(e.portal):null;if(i){let e=r.getRandomFreeGroundTile();e?(i.position=e.worldPoint,ex.addArtefact(i)):(L.debug("No free tiles for portal."),i=null)}let a=tJ.getRandomEntry("KEYS"),n=tg(6)>3?t4(a):null,o=n?1:0,l=tJ.getPooledAlmanac(["ARTEFACTS","ARMOUR","WEAPONS"],e=>e.minLevel<=aD.getCurrentSceneLevel()),h=l.find(e=>"waterskin"===e.id),c=l.find(e=>"iron_rations"===e.id);for(let e of function(e){let t=[];return e.enemies.forEach(e=>{let r=rM(e),i=[0,.5,1],a=i[F(0,i.length)];r.traits.get("UNDEAD",!1)||"ORGANIC"===r.traits.get("MOVE","")||(r.sleeping=Math.random()<=a),t.push(r)}),t}(this.#rd)){let t=r.getRandomFreeGroundTile();if(!t){L.debug("No free tiles for enemy.");break}if(e.position=t.worldPoint,ex.addActor(e),e.isTrader()){e.traits.exceedAbilitiesAndExp?.(this.heroActor.traits,1);let t=7;tg(6)>3&&(aT(e,h,{equip:!1}),t--),tg(6)>3&&(aT(e,c,{equip:!1}),t--),function(e,t,r){for(;r.qty-- >0;)aT(e,t.getRandomEntry(),r)}(e,l,{qty:t,equip:!1})}else o&&!e.isOrganic()&&e.traits.get("HAS_KEYS")&&(e.storeManager.stash(n,{direct:!0}),o=0,L.debug("Added key to actor."))}if(o){let e=aE(a,n),t=r.getRandomFreeGroundTile();t&&(e.position=t.worldPoint,ex.addArtefact(e),o=0,L.debug("Added key as hidden object."))}for(let e of function(e){let t=[];return e.artefacts.forEach(e=>{let r=aE(e);t.push(r)}),t}(this.#rd)){let t=r.getRandomFreeGroundTile();if(!t){L.debug("No free tile to add artefact.");break}e.position=t.worldPoint,ex.addArtefact(e)}return aD.setCameraToTrack(this.heroActor.sprite,200,0),ex.addActor(this.heroActor),ad.setHero(this.heroActor),o>0?ad.setExitKeyArtefact(null):ad.setExitKeyArtefact(n),Promise.resolve()}doUpdate(e){}doUnload(){return Promise.resolve(null)}}let aA={OFF:0,HERO:1,VELOCITY:2};class ax{#r$;#rW;#rY;#rK;constructor(e,t,r=0){let i=eg.getCanvasDimensions(),a=r*Math.min(i.width,i.height);this.#r$=new eH,this.#rW=new eV({prey:e,speed:t,maxSeparation:a}),this.#rY=new eY,this.#rW.applyAsContinuousToSprite(this.#r$)}update(e){this.#rK!==aA.OFF&&(this.#r$.update(e),eg.centreCanvasOn(this.#r$.position))}setVelocity(e,t){this.setTrackingMethod(aA.VELOCITY),this.#r$.velocity.x=e,this.#r$.velocity.y=t}panBy(e,t){this.#r$.position.x+=e,this.#r$.position.y+=t,eg.centreCanvasOn(this.#r$.position)}setTrackingMethod(e){if(e!==this.#rK)switch(this.#rK=e,e){case aA.HERO:this.#rW.applyAsContinuousToSprite(this.#r$);break;case aA.VELOCITY:this.#rY.applyAsContinuousToSprite(this.#r$);break;case aA.OFF:break;default:L.error(`Attempt to set invalid tracking method of ${e} ignored.`)}}}let aI={TR:0,BR:1,BL:2,TL:3};class aR{#rV;#rX;#rq;constructor(e,t,r,i){this.#rV=e,this.#rj(t,r,!1);let a=this.#rZ(t,i),n=this.#rQ(t,i);n.position.x=a.position.x+t,n.position.y=a.position.y}#rZ(e,t){let r=new eM({prefix:"ui-settings",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eD.STOP}),i=nc.addButton(r,()=>ry()),a=this.#rJ(e,t,1);return i.position.x=a.x,i.position.y=a.y,i}#rQ(e,t){let r=new eM({prefix:"ui-guides",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eD.STOP}),i=nc.addButton(r,()=>iF()),a=this.#rJ(e,t,1);return i.position.x=a.x,i.position.y=a.y,i}#r4(e,t,r){let i=new eM({prefix:"hud-fullscreen",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eD.STOP}),a=nc.addButton(i,()=>{document.body.requestFullscreen?.({navigationUI:"hide"})},()=>{document.exitFullscreen?.()}),n=this.#rJ(e,t,1);a.position.x=n.x+r.x,a.position.y=n.y+r.y,window.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(L.debug("Switched to fullscreen mode."),i.setCurrentIndex(1)):(L.debug("Exited fullscreen mode."),i.setCurrentIndex(0))})}#rJ(e,t,r){let i=new V(0,0);switch(t){case aI.TL:i.x=r*e,i.y=r*e;break;case aI.TR:i.x=-r*e,i.y=r*e;break;case aI.BR:i.x=-r*e,i.y=-r*e;break;case aI.BL:i.x=r*e,i.y=-r*e}return i}#rj(e,t,r){let i=this.#rJ(e,t,r?2:1);this.#r0(i.x,i.y),r&&this.#r1(i.x,i.y,e)}#r0(e,t){this.#rq=new eM({prefix:"hud-auto-centre",startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eD.STOP}),this.#rX=nc.addButton(this.#rq,()=>{this.setTrackingState(!0)},()=>{this.setTrackingState(!1)}),this.#rX.position.x=e,this.#rX.position.y=t,this.#rX.actionClick(null)}setTrackingState(e){e?(this.#rq.setCurrentIndex(1),this.#rV.setTrackingMethod(aA.HERO)):(this.#rq.setCurrentIndex(0),this.#rV.setTrackingMethod(aA.OFF))}#r1(e,t,r){let i=3*r;this.#r8("hud-arrow-up",e,t-r,()=>{this.setTrackingState(!1),this.#rV.setVelocity(0,-i)},()=>this.#rV.setTrackingMethod(aA.OFF)),this.#r8("hud-arrow-right",e+r,t,()=>{this.setTrackingState(!1),this.#rV.setVelocity(i,0)},()=>this.#rV.setTrackingMethod(aA.OFF)),this.#r8("hud-arrow-down",e,t+r,()=>{this.setTrackingState(!1),this.#rV.setVelocity(0,i)},()=>this.#rV.setTrackingMethod(aA.OFF)),this.#r8("hud-arrow-left",e-r,t,()=>{this.setTrackingState(!1),this.#rV.setVelocity(-i,0)},()=>this.#rV.setTrackingMethod(aA.OFF))}#r8(e,t,r,i,a){let n=new eM({prefix:e,startIndex:0,padding:2,suffix:".png"},{framePeriodMs:1,loopMethod:eD.STOP}),s=nc.addMomentaryButton(n,i,a);s.position.x=t,s.position.y=r,n.setCurrentIndex(0)}}class aO{intro;hero;enemies;artefacts;mapDesign;portal;constructor(){this.hero=null,this.enemies=[],this.artefacts=[],this.mapDesign=[]}}function aN(e){return e?aC(h).then(()=>e.load().then(()=>e.initialise()).then(()=>{c=new aR(o,48,aI.BR,aI.BL),nc.setVisible(!0),h=e})).then(()=>e):(L.error("Attempt made to switch to the next scene when there are no more."),Promise.reject())}function aC(e){return e?e.unload().then(()=>(ex.clearAll(),h=null,c=null,nc.clear(),nc.setVisible(!1),Promise.resolve())):Promise.resolve(null)}function aP(){return new ay(l.getNext())}var aD={areThereMoreScenes:function(){return l.hasNext()},continueFromSavedScene:function(e,t){return l.restore(e,t),aN(aP())},getCurrentSceneLevel:function(){return l.getIndex()},getCurrentSceneIntro:function(){return l.intro},panCameraBy:function(e,t){o&&c&&(o.panBy(e,t),o.setTrackingMethod(aA.OFF),c.setTrackingState(!1))},setCameraToTrack:function(e,t,r){o=new ax(e,t,r)},setDungeonChallenge:function(e){l.setChallenge?l.setChallenge(e):L.error("Attempt to setDungeonChallenge on list that does not support it.")},setSceneList:function(e){(l=e).reset()},switchToFirstScene:function(){return l.reset(),aN(aP())},switchToNextScene:function(){return aN(aP())},unloadCurrentScene:function(){return aC(h)},update:function(e){h?.update(e),o?.update(e)}};let av={VIEW:0,SELL:1,PILLAGE:2,FIND:3},aL={CONTINUE:"continue",CONSUME:"consume",LEAVE:"leave",LEARN_SPELL:"learn",DISCARD:"discard",EQUIP:"equip",PREPARE_SPELL:"prepare",STASH:"stash",TAKE:"take",SELL:"sell",PILLAGE:"pillage",UNEQUIP:"unequip",USE:"use"},aM={STANDARD:"standard",STASH_ONLY:"stash",SPELLS:"spells",MAGIC:"magic",READY_MAGIC:"ready magic",CANTRIPS:"cantrips"};class a_{#r3;#r2;#r5;linkedInventory;#r9;constructor(e,t={}){this.#r3=e,this.#r2=t,this.#r5=te("div",{className:"stores"}),this.refresh()}get element(){return this.#r5}get actionButtons(){return this.#r9}refresh(e){let t=!0;if(this.#r9=[],!e&&this.linkedInventory&&this.linkedInventory.refresh(!0),this.#r5.replaceChildren(),(!this.#r3.currentOwner.isHero()||this.#r3.currentOwner.alive)&&this.#r6().forEach(e=>{let r=this.#r3.currentOwner.storeManager.getStoreContents(e.storeType);if(r){t=!1;let i=this.#r7(e.label,e.storeType,r);this.#r5.appendChild(i)}}),t){let e;e=this.#r3.currentOwner.isHero()&&!this.#r3.currentOwner.alive?tr`MESSAGE DEAD HERO HAS NO INVENTORY`:tr`MESSAGE NOTHING HERE`,this.#r5.appendChild(te("p",{text:e}))}this.#r2.onRefresh&&this.#r2.onRefresh()}#r6(){let e;switch(this.#r2.limitation){case aM.SPELLS:e=[{label:tr`Prepared spells`,storeType:t0.PREPARED_SPELLS},{label:tr`Known spells`,storeType:t0.SPELLS}];break;case aM.MAGIC:e=[{label:tr`Cantrips`,storeType:t0.CANTRIPS},{label:tr`Prepared spells`,storeType:t0.PREPARED_SPELLS},{label:tr`Known spells`,storeType:t0.SPELLS}];break;case aM.READY_MAGIC:e=[{label:tr`Ready spells`,storeType:t0.PREPARED_SPELLS},{label:tr`Cantrips`,storeType:t0.CANTRIPS}];break;case aM.CANTRIPS:t0.CANTRIPS;break;case aM.STASH_ONLY:e=[this.#ie()];break;case aM.STANDARD:default:e=[{label:tr`Purse`,storeType:t0.PURSE},{label:tr`Head`,storeType:t0.HEAD},{label:tr`Body`,storeType:t0.BODY},{label:tr`Waist`,storeType:t0.WAIST},{label:tr`Hands`,storeType:t0.HANDS},{label:tr`Ring fingers`,storeType:t0.RING_FINGERS},{label:tr`Feet`,storeType:t0.FEET},this.#ie()]}return e}#ie(){return this.#r3.currentOwner.isTrader()?{label:tr`Wagon`,storeType:t0.WAGON}:{label:tr`Backpack`,storeType:t0.BACKPACK}}#r7(e,t,r){let i=te("div",{className:"store"});(this.#r3.currentOwner.isHero?.()||this.#r3.actionType!==av.PILLAGE)&&i.appendChild(te("span",{className:"store-label",text:e}));let a=te("div",{className:"store-contents"});return i.appendChild(a),[...r].sort((e,t)=>e.id<t.id?-1:1).forEach(e=>{let r;let i={...this.#r3};i.refresh=this.refresh.bind(this),i.storeType=t,i.artefact=e,null!==(r=t8(e.artefactType,t1.SPELL)&&i.allowMagicUse&&!function(e,t){let r=tC(t);return tD(e)>=r}(i.currentOwner.traits,e.traits)?this.#it(i):this.#ir(i)).closes&&void 0!==r.closes&&this.#r9.push(r),a.appendChild(r.element)}),i}#it(e){let t;let r=aY(e);t=async()=>{await tc.showOkDialog(tr`MESSAGE NO CASTING POWER LEFT`)};let i=new e2({rightLabel:r,imageName:e.artefact.iconImageName,action:t});return i.element.classList.add("uncastable"),i}#ir(e){let t,r;let i=aY(e);return e.delayedReaction?r={invoke:()=>e.artefact.interaction.react(e.currentOwner)}:t=async()=>{await aX(e).then(()=>e.refresh?.())},new e2({rightLabel:i,imageName:e.artefact.iconImageName,action:t,closes:r})}}function ab(e,t,r){r>t.length&&L.error("Attempt being made to discard more items than provided in array.");for(let i=0;i<r&&i<t.length;i++)e.take(t[i])||L.error(`Trying to take artefact ${t[i]}, but none found.`)}function az(e,t={}){let r=te("div",{className:"inventory"}),i=te("div",{className:"actor-container"});r.appendChild(i),i.appendChild(aF(e,{hideDescription:!0,hideTraits:!0}));let a=new a_({currentOwner:e,prospectiveOwner:e,allowMagicUse:t.allowMagicUse,allowConsumption:t.allowConsumption},{limitation:t.limitation,onRefresh:()=>i.replaceChildren(aF(e,{hideDescription:!0,hideTraits:!0}))});return r.appendChild(a.element),tc.showControlsDialog(r)}function ak(e,t){if(t8(t.artefact.artefactType,t1.COINS))return;let r=[];switch(t.artefact.artefactType?.id){case t1.SPELL.id:r=function(e){let t=[],r=e.artefact;return e.allowMagicUse?L.error("Unexpected creation of Spell buttons with magic allowed. Use of Spells is handled by custom actions."):e.storeType===r.stashStoreType&&e.allowSpellPrep&&t.push(new e3({label:tr`BUTTON PREPARE SPELL`,closes:aL.PREPARE_SPELL})),e.allowSpellPrep&&t.push(new e3({label:tr`BUTTON FORGET`,closes:aL.DISCARD})),t}(t);break;case t1.CANTRIP.id:r=function(e){let t=[];return e.allowMagicUse&&L.error("Unexpected creation of Cantrip buttons with magic allowed. Use of Cantrips is handled by custom actions."),t.push(new e3({label:tr`Forget`,closes:aL.DISCARD})),t}(t);break;case t1.CONSUMABLE.id:r=function(e){let t=[];return aG(e)&&t.push(new e3({label:aU(e.artefact),closes:aL.CONSUME})),t.push(new e3({label:tr`BUTTON DISCARD`,closes:aL.DISCARD})),t}(t);break;case t1.KEY.id:r=[];break;default:r=function(e){let t=[];return aG(e)?t.push(new e3({label:aU(e.artefact),closes:aL.USE})):e.storeType===e.artefact.stashStoreType&&e.artefact.equipStoreType?t.push(new e3({label:tr`BUTTON EQUIP`,closes:aL.EQUIP})):e.storeType===e.artefact.equipStoreType&&(!e.artefact.stashInWagon||e.currentOwner.storeManager.hasWagon)&&t.push(new e3({label:tr`BUTTON UNEQUIP`,closes:aL.UNEQUIP})),t.push(new e3({label:e.artefact.isMagic()?tr`Forget`:tr`BUTTON DISCARD`,closes:aL.DISCARD})),t}(t)}return r.push(new e3({label:tr`BUTTON CONTINUE`,closes:aL.CONTINUE})),r}function aG(e){let t=e.artefact;return!!t.isUsable()&&(t.isMagic()?e.allowMagicUse:t.isConsumable()?e.allowConsumption:void 0)}function aU(e){switch(e.artefactType.id){case t1.CONSUMABLE.id:return tr`BUTTON CONSUME`;case t1.SPELL.id:case t1.CANTRIP.id:return tr`BUTTON CAST SPELL`;default:return tr`BUTTON USE`}}function aB(e){return te("p",{className:"guidance",text:e.prospectiveOwner.isTrader()?tr`MESSAGE TRADER CANNOT STASH`:e.artefact.stashInWagon?tr`MESSAGE MAKE SPACE IN EQUIP`:tr`MESSAGE MAKE SPACE IN BACKPACK`})}function aH(e){let t=te("div",{className:"actor-id-card"});t.appendChild(e5(e.iconImageName)),t.appendChild(te("span",{text:e.traits?.get("NAME")??tr`Unknown`}));let r=e.traits.getInt("HP");if(!e.artefactType&&r&&!e.traits.get("_HP")){let i;let a=e.traits.getInt("HP_MAX");i=0===r?tr`(DEAD)`:a?tr`(HP OUT OF VALUE) ${r} ${a}`:tr`(HP VALUE) ${r}`,t.appendChild(te("span",{text:i}))}let i=e.traits.get("CLASS","").toLowerCase();return e.traits.getCharacterLevel&&i&&t.appendChild(te("span",{text:tr`CHARACTER LEVEL: ${e.traits.getCharacterLevel()} ${i}`})),t}function aF(e,t={}){let r;let i=te("div",{className:"actor-detail"}),a=aH(e);return i.appendChild(a),!t.hideDescription&&(e.artefactType||e.alive?t.description?r=t.description instanceof Element?t.description:te("p",{text:t.description}):e.description&&(r=te("p",{text:e.unknown&&e.unknownDescription?e.unknownDescription:e.description})):r=a$(e)),r&&i.appendChild(r),t.hideTraits||i.appendChild(function(e,t,r){if(!e.artefactType&&!e.alive)return a$(e);let i=document.createElement("ul");if(r){let t=e.storeManager?.getPurseValue();t&&i.appendChild(te("li",{text:`${t.toFixed(2)}\u{00A0}GP`}))}let a=[],n=function(e){if(!e.isHero?.())return null;let t=tz(e.traits);return[aW("SHORT_RESTS_REMAINING"),0===t?tr`zero`:t]}(e);n&&a.push(n);let s=function(e){if(!e.traits.transientProperties)return null;let t=[];for(let r in e.traits.transientProperties)t.push(ti.getText(r).toLowerCase());return[aW("TRANSIENT"),t.sort().join(", ")]}(e);for(let r of(s&&a.push(s),e.traits?.getAllTraits().forEach((r,i)=>{if(!t.includes(i)&&!i.startsWith("_")){var n;if(e.traits.hasEffective?.(i)){let t=e.traits.getEffectiveInt(i),a=Y(r);if(t!==a){let e=t-a;r=`${t} [${a}${e<0?"-":"+"}${e}]`}}a.push([aW(i),(n=r,/\d*\.?\d* *[CSGP]P/.test(n)||/\d+D\d+(?: *[+-]? *\d+)?/.test(n)?n:Array.isArray(n)?n.map(e=>ti.getText(e).toLowerCase()):"string"==typeof n?ti.getText(n).toLowerCase():n)])}}),a.sort((e,t)=>e[0]<t[0]?-1:1),a)){let e=r[0],t=r[1];if(t&&"0"!==t){let r=Array.isArray(t)?t.join(", "):t,a=document.createElement("li"),n=te("span",{text:`${e}: `}),s=te("span",{text:r});i.appendChild(a),a.appendChild(n),a.appendChild(s)}}return i}(e,["NAME"],!0)),i}function a$(e){let t;if(e.isHero()){let r=e.traits.get("NAME");t=tr`MESSAGE HERO EPITAPH FOR ${r}`}else t=tr`MESSAGE GENERIC EPITAPH`;return te("p",{text:t})}function aW(e){let t=ti.getText(e);return t===e&&(t=e?.replace(/_/g," ")),t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()}function aY(e){let t=e.artefact.traits,r=t.get("NAME");if(e.showDamage){let i,a,n;t.has("HP_GAIN")?(a="HP: +",i=t.getHpGainDiceWhenCastBy?t.getHpGainDiceWhenCastBy(e.currentOwner.traits):t.get("HP_GAIN")):t.has("DMG")&&(a="DMG: ",i=t.getDamageDiceWhenCastBy?t.getDamageDiceWhenCastBy(e.currentOwner.traits):t.get("DMG")),i&&(r=`${r}; ${a}${i}`);let s=t.get("DIRECTION","NSEW"),o=t.get("RANGE","0");0===Y(o,0)?n=tr`ACTS ON CASTER`:o&&(n=tr`Range: ${o.toLowerCase()}`+" "+ti.getText(s)),r=`${r}; ${n}`}if(e.showPrice||t8(e.artefact.artefactType,t1.COINS)){let t=e.currentOwner.isTrader()||e.actionType===av.PILLAGE?e.artefact.costInGp:e.artefact.sellBackPriceInGp;r=`${r} ${t.toFixed(2)} GP`}return r}function aK(e,t,r){let i=te("div",{className:"trade"}),a=te("div",{className:"side-by-side"});i.appendChild(a);let n=te("div",{}),s=te("div",{});a.appendChild(n),a.appendChild(s),n.appendChild(aH(e)),s.appendChild(aH(t));let o=r?av.PILLAGE:av.SELL,l=new a_({currentOwner:e,prospectiveOwner:t,actionType:o,showPrice:!0}),h=new a_({currentOwner:t,prospectiveOwner:e,actionType:o,showPrice:!0},{limitation:r?aM.STANDARD:aM.STASH_ONLY});l.linkedInventory=h,h.linkedInventory=l,n.appendChild(l.element),s.appendChild(h.element);let c=new e3({label:tr`BUTTON CONTINUE`});c.closes=tn.CANCEL;let u=[];return u.push(c),tc.showControlsDialog(i,{preamble:r?tr`DIALOG TITLE PILLAGE`:tr`DIALOG TITLE TRADE`,actionButtons:u})}function aV(e,t={}){let r,i,a;let n=document.createElement("div");n.appendChild(te("span",{text:tr`Dungeon floor: ${rb(aD.getCurrentSceneLevel())}`}));let s=te("div",{className:"actor-container"});n.appendChild(s);let o=aF(e,{hideTraits:!0,description:t.description});if(s.appendChild(o),!e.isProp()&&(i=new e3({label:tr`BUTTON INVENTORY`,action:()=>az(e,{allowConsumption:t.allowConsumption,allowMagicUse:t.allowMagicUse}).then(()=>{s.replaceChildren(aF(e,{hideTraits:!0,description:t.description})),r&&!e.alive&&(n.removeChild(r),r=void 0)})}),n.appendChild(i.element),i=new e3({label:tr`BUTTON TRAITS`,action:()=>(function(e){let t=document.createElement("div");return t.appendChild(aF(e,{hideDescription:!0})),tc.showControlsDialog(t)})(e)}),n.appendChild(i.element),i=new e3({label:tr`BUTTON MAGIC`,action:()=>az(e,{allowMagicUse:!1,limitation:aM.MAGIC})}),n.appendChild(i.element),t.allowRest&&(r=(i=new e3({label:tr`BUTTON REST`,action:()=>(function(e){let t=e.storeManager.getStore(t0.BACKPACK),r=[],i=[];for(let e of t.values())if(t8(e.artefactType,t1.CONSUMABLE)){let t=e.traits.get("TYPE");"FOOD"===t?r.push(e):"DRINK"===t&&i.push(e)}let a=document.createElement("div");a.appendChild(aH(e)),a.appendChild(te("p",{text:tr`MESSAGE EXPLAIN REST`}));let n=[],s=-1,o=-1,l=function(e,t,r){let i={possible:!0,failure:tb.NONE},a={possible:!0,failure:tb.NONE};return 1>tz(r)?(i.possible=!1,i.failure=tb.NEED_LONG_REST):(e<1||t<1)&&(i.possible=!1,i.failure=tb.NEED_MORE_RATIONS),(e<3||t<3)&&(a.possible=!1,a.failure=tb.NEED_MORE_RATIONS),{shortRest:i,longRest:a}}(r.length,i.length,e.traits),h="";return l.shortRest.possible||(h=l.shortRest.failure===tb.NEED_LONG_REST?tr`MESSAGE CANNOT REST SHORT NEED LONG REST`:tr`MESSAGE CANNOT REST SHORT NEED RATIONS`,a.appendChild(te("p",{text:h}))),l.longRest.possible||(h=tr`MESSAGE CANNOT REST LONG NEED RATIONS`,a.appendChild(te("p",{text:h}))),l.shortRest.possible&&(s=n.length,n.push(tr`BUTTON REST SHORT`)),l.longRest.possible&&(o=n.length,n.push(tr`BUTTON REST LONG`)),n.push(tr`BUTTON CONTINUE`),tc.showChoiceDialog(tr`DIALOG TITLE CHOICES`,a,n).then(a=>{if(a===s){ab(t,r,1),ab(t,i,1);let a=tk(e,"SHORT");return tc.showOkDialog(tr`MESSAGE REST SHORT HP GAIN ${a.newHp-a.oldHp}`)}if(a===o){ab(t,r,3),ab(t,i,3);let a=tk(e,"LONG");return(function(e){let t=te("div",{className:"inventory"});t.appendChild(aF(e,{hideDescription:!0,hideTraits:!0}));let r=new a_({currentOwner:e,prospectiveOwner:e,allowSpellPrep:!0},{limitation:aM.SPELLS});return t.appendChild(r.element),tc.showControlsDialog(t,{title:tr`DIALOG TITLE PREPARE SPELLS`,preamble:tr`MESSAGE EXPLAIN SPELL PREP`})})(e).then(()=>tc.showOkDialog(tr`MESSAGE REST LONG HP GAIN ${a.newHp-a.oldHp}`))}})})(e).then(()=>s.replaceChildren(aF(e,{hideTraits:!0,description:t.description})))})).element,n.appendChild(i.element)),t.allowMagicUse&&(a=a??[],(i=new e3({label:tr`BUTTON CAST SPELL`})).closes="CAST SPELL",a.push(i))),a&&((i=new e3({label:tr`BUTTON CONTINUE`})).closes=tn.CANCEL,a.push(i)),t.additionalControls)for(let e of(a=a||[],t.additionalControls))a.push(e);return tc.showControlsDialog(n,{okButtonLabel:t.okButtonLabel,actionButtons:a}).then(t=>"CAST SPELL"===t?function(e){let t=te("div",{className:"inventory"}),r=new a_({currentOwner:e,prospectiveOwner:e,allowMagicUse:!0,showDamage:!0,delayedReaction:!0},{limitation:aM.READY_MAGIC});t.appendChild(r.element);let i=new e3({label:tr`BUTTON CONTINUE`,closes:tn.CANCEL});return tc.showControlsDialog(t,{title:tr`DIALOG TITLE PICK SPELL TO CAST`,actionButtons:[...r.actionButtons,i]})}(e):Promise.resolve(t))}function aX(e){var t;e.prospectiveOwner||(e.prospectiveOwner=e.currentOwner);let r=e.currentOwner?.storeManager,i=e.prospectiveOwner.storeManager,a=e.artefact,n=e.hideTraits;return(e.artefact?.unknown?!function(){let e=iZ;return iZ=!1,e||L.info("Identification checks not allowed at present."),e}()?Promise.resolve(!1):tG((e.prospectiveOwner??e.currentOwner).traits,{ability:"WIS",difficulty:(t=e.artefact.traits).get("IDENTIFY_DC",tL.EASY),proficiency:t.get("SUBTYPE")})?(e.artefact.unknown=!1,tc.showOkDialog(tr`MESSAGE IDENTIFIED ITEM`).then(()=>!0)):tc.showOkDialog(tr`MESSAGE FAILED TO IDENTIFY`).then(()=>!1):Promise.resolve(!0)).then(t=>(t||(e.hideTraits=!0),function(e){let t=e.artefact,r=te("div",{className:"use-weapon-dialog"});r.appendChild(aF(t,e));let i=function(e,t){if(t.currentOwner===t.prospectiveOwner||!t.prospectiveOwner)return ak(e,t);switch(t.actionType){case av.FIND:return function(e,t){let r;let i=[],a=t.prospectiveOwner.storeManager.findSuitableStore(t.artefact);if(a){let e,t;a.storeType===t0.CANTRIPS||a.storeType===t0.SPELLS||a.storeType===t0.READY_SPELLS?(e=tr`BUTTON LEARN SPELL`,t=aL.LEARN_SPELL):(e=tr`BUTTON TAKE ARTEFACT`,t=aL.TAKE),r=new e3({label:e,closes:t}),i.push(r)}else e.appendChild(aB(t));return r=new e3({label:tr`BUTTON LEAVE ARTEFACT`,closes:aL.LEAVE}),i.push(r),i}(e,t);case av.SELL:return function(e,t){let r;if(t8(t.artefact.artefactType,t1.COINS))return;let i=[],a=t.artefact.costInGp;if((r=t.prospectiveOwner.isTrader()?Number.MAX_SAFE_INTEGER:t.prospectiveOwner.storeManager.getPurseValue())<t.artefact.costInGp){e.appendChild(te("p",{className:"guidance",text:tr`MESSAGE INSUFFICIENT FUNDS ${a.toFixed(2)} ${r.toFixed(2)}`})),t.currentOwner.isTrader()||ak(e,t);return}if(!t.prospectiveOwner.storeManager.findSuitableStore(t.artefact)){e.appendChild(aB(t)),t.currentOwner.isTrader()||ak(e,t);return}let n=new e3({label:t.currentOwner.isTrader()?tr`BUTTON BUY FOR GP ${t.artefact.costInGp.toFixed(2)}`:tr`BUTTON SELL FOR GP ${t.artefact.sellBackPriceInGp.toFixed(2)}`,closes:aL.SELL});return i.push(n),i.push(n=new e3({label:tr`BUTTON CONTINUE`,closes:aL.CONTINUE})),i}(e,t);case av.PILLAGE:return function(e,t){if(t.currentOwner.alive)return ak(e,t);let r=[];if(!t.prospectiveOwner.storeManager.findSuitableStore(t.artefact)){e.appendChild(aB(t)),t.currentOwner.alive&&ak(e,t);return}let i=new e3({label:tr`BUTTON PILLAGE`,closes:aL.PILLAGE});return r.push(i),r.push(i=new e3({label:tr`BUTTON LEAVE ARTEFACT`,closes:aL.CONTINUE})),r}(e,t);case av.VIEW:default:return[]}}(r,e);return tc.showControlsDialog(r,{preamble:e.preamble,actionButtons:i,row:!0})}(e))).then(t=>{switch(e.hideTraits=n,t){case aL.CONSUME:return r.discard(a),a.interaction.react(e.currentOwner);case aL.DISCARD:r.discard(a);break;case aL.PREPARE_SPELL:case aL.EQUIP:if(!i.equip(a))return tc.showOkDialog(tr`MESSAGE UNEQUIP TO MAKE SPACE TO EQUIP`);break;case aL.LEARN_SPELL:if(a.isMagic()&&i.hasArtefactWithSameId(a))return tc.showOkDialog(tr`MESSAGE SPELL ALREADY KNOWN`);if(r.discard(a),i.findSuitableStore(a).add(a),t8(a.artefactType,t1.SPELL))return tc.showOkDialog(tr`MESSAGE EXPLAIN SPELL NEEDS REST`);break;case aL.PILLAGE:{let e=i.findSuitableStore(a);if(!e)return tc.showOkDialog(tr`MESSAGE CANNOT PILLAGE NO SPACE`);r.discard(a),e.add(a)}break;case aL.SELL:{let t=e.currentOwner.isTrader()?a.costInGp:a.sellBackPriceInGp;r.addToPurse(t),e.prospectiveOwner.isTrader()||i.takeFromPurse(t),r.discard(a),a.stashInWagon&&!i.hasWagon?i.equip(a,{direct:!0}):i.stash(a,{direct:!0})}break;case aL.UNEQUIP:case aL.STASH:if(!i.stash(a))return tc.showOkDialog(e.prospectiveOwner.isTrader()?tr`MESSAGE TRADER CANNOT STASH`:tr`MESSAGE CANNOT STASH`);break;case aL.TAKE:if(a.stashInWagon&&!i.hasWagon){if(!i.equip(a,{direct:!0,noAutoUnequip:!0}))return tc.showOkDialog(tr`MESSAGE CANNOT EQUIP ITEM OR STASH`)}else if(!i.stash(a,{direct:!0}))return tc.showOkDialog(tr`MESSAGE CANNOT STASH`);r?.discard(a);break;case aL.USE:return a.interaction.react(e.currentOwner)}return Promise.resolve()})}function aq(e,t=!1,r=!1){let i;let a=te("div"),n=rb(aD.getCurrentSceneLevel()+1);if(t&&a.appendChild(te("p",{text:tr`MESSAGE PROGRESS HAS BEEN SAVED`})),a.appendChild(te("p",{text:tr`MESSAGE REST DIALOG ${n}`})),r){let e=new e3({label:tr`BUTTON MAIN MENU`});e.closes="MAIN MENU";let t=new e3({label:tr`BUTTON CONTINUE`});t.closes="CONTINUE",i=[e,t]}return aV(e,{allowConsumption:!0,allowRest:!0,description:a,okButtonLabel:tr`BUTTON CONTINUE`,additionalControls:i})}let aj={SETBACK:{dc:11,bonus:4,damage:["1D10","2D10","4D10","10D10"]},DANGEROUS:{dc:14,bonus:7,damage:["2D10","4D10","10D10","18D10"]},DEADLY:{dc:18,bonus:11,damage:["4D10","10D10","18D10","24D10"]}};function aZ(e,t){let r=document.createElement("div"),i=document.createElement("p");i.innerText=e,r.appendChild(i);let a=document.createElement("p");return a.innerText=t,r.appendChild(a),r}function aQ(e,t,r){if(tu.playEffect("POISONED"),r>0)return L.info("Poisoned"),eZ(eN.getSpriteBitmap("skull.png"),{delaySecs:0,lifetimeSecs:1,position:t.position,velocity:new X(0,0,0)}),aJ(e,t,r);eZ(eN.getSpriteBitmap("miss.png"),{delaySecs:0,lifetimeSecs:1,position:t.position,velocity:new X(0,0,0)}),L.info("Poison resisted.")}function aJ(e,t,r){if(!r||!t.alive||t.isProp()||t.isHiddenArtefact())return 0;let i=t.traits.get("NAME");L.info(`Damage ${r} on ${i}`);let a=t.traits.get("HP",0);if(a=Math.max(0,a-r),t.traits.set("HP",a),0===a){if(tu.playEffect(t.traits.get("SOUND","DIE")),L.info(`Killed ${i}`),t.interaction=new a1(t),t.alive=!1,e?.isHero?.()){let r;let i=e.traits.adjustForDefeatOfActor(t.traits);i.level.now>i.level.was?r=tr`LEVEL UP ${i.level.now}`:i.exp.now>i.exp.was&&(r=`+${i.exp.now-i.exp.was} EXP`),r&&(L.info(r),eJ(r,e.position,rf.HP_TRANSIENT_TEXT_HERO))}}else{let e=t.isHero()?rf.HP_TRANSIENT_TEXT_HERO:rf.HP_TRANSIENT_TEXT_ENEMY;eJ(`-${r} HP`,t.position,e)}return a}class a4{owner;constructor(e){this.owner=e}enact(e){return Promise.resolve()}react(e){return Promise.resolve()}canReact(){return!1}canEnact(){return!1}respectDisengage(e){return!1}}class a0 extends a4{constructor(e){super(e)}canEnact(){return!0}canReact(){return!0}enact(e){return this.#ii(this.owner,e)}react(e){return this.#ii(e,this.owner)}respectDisengage(e){return!0}#ia(e,t){let r=V.copy(e.position);return new eX({path:[new V(e.position.x+.2*(t.position.x-e.position.x),e.position.y+.2*(t.position.y-e.position.y)),r],speed:100}).applyAsTransientToSprite(e.sprite)}#is(e,t){if(e.isHero())return this.#io(e,t);switch(e.attackMode){case ni.COMBO:return this.#il(e,t);case ni.POISON:return new a2(e).enact(t);case ni.MAGIC:case ni.RANGED:return new a9(e).react(e);case ni.COMBAT:default:return this.#ih(e,t)}}#il(e,t){let r=t.traits.getInt("HP");return this.#io(e,t).then(i=>i<=0?i:e.traits.has("DMG_POISON")?i<r?new a2(e).enact(t):Promise.resolve(i):this.#io(e,t))}#ih(e,t){if(!e.isHero()){let t=e.storeManager,r=t.getStore(t0.PREPARED_SPELLS).getFirst();if(r||(r=t.getStore(t0.CANTRIPS).getFirst()),r)return r.interaction.react(e)}return this.#io(e,t)}#io(e,t){let r=0,i=0;return e.traits.getAttacks().forEach(a=>{let n=tM(a,t.traits);n>0&&(i++,r+=n,this.#ic(e,a))}),new Promise(a=>{if(r<=0){tu.playEffect("MISS"),eZ(eN.getSpriteBitmap("miss.png"),{delaySecs:0,lifetimeSecs:1,position:t.position,velocity:new X(0,0,0)}),a(t.traits.getInt("HP",0));return}let n=i>1?"DOUBLE PUNCH":"PUNCH",s=i>1?"blood-splat-twice.png":"blood-splat.png";tu.playEffect(n),eZ(eN.getSpriteBitmap(s),{delaySecs:0,lifetimeSecs:1,position:t.position,velocity:new X(0,0,0)}),a(aJ(e,t,r))})}#ic(e,t){if(!e.isHero?.())return;let r=e.storeManager;if(r&&tU(t.weaponType))for(let i of(L.info(`Weapon ${t.weaponName} breaks.`),e.storeManager.getAllEquippedArtefacts())){let a=i.traits.get("NAME"),n=i.traits.get("TYPE");a===t.weaponName&&n===t.weaponType&&(r.discard(i),tu.playEffect("BREAK_WEAPON"),eZ(eN.getSpriteBitmap("break-weapon.png"),{delaySecs:0,lifetimeSecs:6,position:e.position,velocity:new X(0,0,0)}),function(e,t,r="white"){eQ(e,{color:r,delaySecs:2,lifetimeSecs:3,position:new V(t.x,t.y),velocity:new X(0,48,0),acceleration:new q(0,0,0)})}(tr`WEAPON BREAKS!`,e.position,rf.HP_TRANSIENT_TEXT_HERO))}}#ii(e,t){return L.info(`${e.traits?.get("NAME")} attacks ${t.traits.get("NAME")}`),this.#ia(e,t).then(()=>this.#is(e,t))}}class a1 extends a4{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){return aK(e,this.owner,!0)}}class a8 extends a4{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}react(e){return this.owner.traits.get("NO_TRADE")?tc.showOkDialog([tr`MESSAGE TRADER WILL NOT TRADE`,tr`MESSAGE TRADERS PROTECTED`]):tc.showChoiceDialog(tr`DIALOG TITLE CHOICES`,tr`MESSAGE TRADE STEAL OR BARGE`,[tr`BUTTON TRADE`,tr`BUTTON STEAL`,tr`BUTTON BARGE`]).then(t=>0===t?aK(e,this.owner,!1):1===t?this.#iu(e):this.#id(e))}#iu(e){if(!tG(e.traits,{ability:"DEX",difficulty:this.owner.traits.getInt("DC",tL.HARD),proficiency:"STEALING"}))return this.owner.traits.set("_NO_TRADE",!0),tc.showOkDialog(tr`MESSAGE TRADER ATTACKS BACK`).then(()=>new a0(this.owner).enact(e));{let t=W(1,this.owner.traits.getInt("MAX_THEFT",1));return e.storeManager.addToPurse(t),tc.showOkDialog(tr`MESSAGE STOLE GOLD ${t}`)}}#id(e){let t=V.copy(this.owner.position),r=V.copy(e.position);return Promise.all([eq(e,t),eq(this.owner,r)])}}class a3 extends a4{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){this.owner.discovered=!0,this.owner.alive=!1;let t=this.owner.storeManager.getFirstStorageDetails();if(!t)return tc.showOkDialog(tr`MESSAGE NOTHING MORE TO DISCOVER`);{let r=t.artefact;if(r.isTrap()){let t=await r.interaction.react(e);if(t.outcome===a7.LEAVE)return this.owner.alive=!0,Promise.resolve();if(this.owner.storeManager.discardStashed(r,!0),!t.artefact)return Promise.resolve();r=t.artefact,this.owner.storeManager.stash(r,{direct:!0})}else if(r.isMagic()&&!function(e,t){let r=e.getCharacterLevel(),i=t.getInt("LEVEL",0);if(i>tP(r))return L.info(`${e.get("NAME")} cannot learn level ${i} ${t.get("NAME")} as too high.`),!1;let a=t.get("CASTERS");if(!a)return L.info(`No casters set for ${t.get("NAME")} so can be learned.`),!0;let n=e.get("CLASS");return!!a.includes(n)||(L.info(`${e.get("NAME")} cannot learn ${t.get("NAME")} as not in casters.`),!1)}(e.traits,r.traits))return tc.showOkDialog(tr`MESSAGE CANNOT UNDERSTAND MAGIC`);return aX({preamble:this.#ip(r),currentOwner:this.owner,prospectiveOwner:e,storeType:t.store.storeType,artefact:r,actionType:av.FIND,hideTraits:r.isMagic()}).then(()=>{this.owner.storeManager.getFirstStorageDetails()&&(this.owner.alive=!0)})}}#ip(e){return this.owner.type===nr.HIDDEN_ARTEFACT?e.isPlant()?tr`MESSAGE FOUND HIDDEN ARTEFACT - VEGETATION`:tr`MESSAGE FOUND HIDDEN ARTEFACT`:e.isMagic()?tr`MESSAGE FOUND ENGRAVING`:tr`MESSAGE FOUND GENERIC`}}class a2 extends a4{constructor(e){super(e)}canEnact(){return!0}canReact(){return!1}enact(e){if(this.#im(e))return Promise.resolve();let t=t_(this.owner.traits,e.traits);return aQ(this.owner,e,t),t&&e.toxify?.addToxicEffect(this.owner.traits),e.traits.addTransientFxTraits(this.owner.traits),Promise.resolve()}#im(e){return!!(this.owner.isOrganic?.()&&e.traits.transientProperties?.hover)&&(L.info(`${e.traits.get("NAME")} hovering so immune from organic attack.`),!0)}}class a5 extends a4{#ig;constructor(e){super(null),this.#ig=e??new r_}canEnact(){return!0}canReact(){return!1}enact(e){if(this.#ig.isActive)return aQ(null,e,-this.#ig.getChangeInHpThisTurn()),Promise.resolve()}addToxicEffect(e){let t=-e.getFloat("DMG_PER_TURN",0);t&&(L.debug(`Add toxic effect of ${t} HP/turn`),this.#ig.addToxicEffect(t))}cure(){this.#ig.cure()}get isActive(){return this.#ig.isActive}getToxin(){return this.#ig}}class a9 extends a4{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){let t;switch(tu.playEffect("SPELL_CHANT"),this.owner.traits.get("MODE")){case"BLESS":t=this.#iS(e);break;case"CONJURE MEAL":t=this.#iw(e);break;case"DETECT POISON":t=this.#iE(e);break;case"FIND TRAPS":t=this.#iT(e);break;case"HOVER":t=this.#iy(e);break;case"VAMPIRIC MELEE":t=this.#iA(e);break;default:t=this.#ix(e)}return t8(this.owner.artefactType,t1.SPELL)&&function(e,t){let r=tC(t),i=Math.max(0,tD(e)-r);e.set("CASTING_POWER",i)}(e.traits,this.owner.traits),t}#ix(e){let t=ex.getTileMap(),r=t.worldPointToGrid(e.position),i=this.owner.traits.getValueInFeetInTiles("RANGE",1),a=this.owner.traits.getInt("MAX_TARGETS",999),n=0,s=0,o=0,l="RADIAL"===this.owner.traits.get("DIRECTION"),h=this.owner.traits.get("INDISCRIMINATE");for(let c of l?t.getRadiatingVisibleTiles(i):t.getRadiatingCross(r,i)){if(s>=a)break;for(let i of[...c.getOccupants().values()].sort((e,t)=>t.traits.getInt("HP")-e.traits.getInt("HP")))if(this.#iI(e,i,h)){o++;let a=r.getSeparation(t.worldPointToGrid(i.position)),l=function(e,t,r,i){if(t.get("UNDEAD")&&r.get("UNDEAD_IMMUNE"))return L.info("Spell does not work on the undead."),0;switch(r.get("MODE")){case"MELEE":case"VAMPIRIC MELEE":return function(e,t,r){let i=e.get("SPELL_CAST","INT"),a=e.getEffectiveInt(i,1);return tM(new t$({damageDice:r.getDamageDiceWhenCastBy?r.getDamageDiceWhenCastBy(e):r.get("DMG","1D4"),weaponType:"MAGIC",proficiencyBonus:e.getCharacterPb(r),abilityModifier:tF(a)}),t)}(e,t,r);case"RANGED":return function(e,t,r,i){let a=e.get("SPELL_CAST","INT"),n=e.getEffectiveInt(a,1);return tM(new t$({damageDice:r.getDamageDiceWhenCastBy?r.getDamageDiceWhenCastBy(e):r.get("DMG","1D4"),weaponType:"MAGIC",proficiencyBonus:e.getCharacterPb(r),abilityModifier:tF(n),disadvantage:1>=Math.round(i)}),t)}(e,t,r,i);default:return function(e,t,r){let i;let a=t.getNonMeleeSaveAbilityModifier(r),n=0;if(e.get("ATTACK")===ni.RANGED)i="Ranged attack";else{i="Magic";let t=e.get("SPELL_CAST","INT"),a=e.getInt(t,1);n=e.getCharacterPb(r)+tF(a)}let s=r.getInt("DC");null==s&&(L.error(`${i} ${e.get("NAME")} has no DC set.`),s=0);let o=s+n,l=tg(20)+a,h=tw(r.getDamageDiceWhenCastBy?r.getDamageDiceWhenCastBy(e):r.get("DMG","1D4"));return(L.info(`${i}: saving throw ${l} vs target DC ${o}`),l>=o)?Math.round(r.getFloat("DMG_SAVED",0)*h):h}(e,t,r)}}(e.traits,i.traits,this.owner.traits,a);i.sleeping=!1,tB(i.position,1),l>0?(n+=l,this.#iR(c.worldPoint),s++,aJ(e,i,l),i.traits.addTransientFxTraits(this.owner.traits)):this.#iO(c.worldPoint)}}return 0===o&&this.#iO(e.position),rw(1.5).then(()=>n)}#iT(e){let t=ex.getTileMap(),r=t.worldPointToGrid(e.position),i=this.owner.traits.getValueInFeetInTiles("RANGE",1),a="RADIAL"===this.owner.traits.get("DIRECTION")?t.getRadiatingVisibleTiles(i):t.getRadiatingCross(r,i),n=!1;for(let e of a){if(n)break;for(let t of e.getOccupants().values())if(t.isHiddenArtefact?.()){let e=t.storeManager.getFirstStorageDetails(),r=e?.artefact;if(r?.isTrap()){n=!0;break}}}for(let e of a)n?this.#iR(e.worldPoint):this.#iO(e.worldPoint)}#iS(e){if(!e.isHero())return;if(!function(e,t,r){let i=r.getInt("MAX_TARGET_HP",999),a=t.getInt("HP");return!(a>i)||(L.info(`Targets's HP (${a}) is above max target hp of ${i}. Spell failed.`),!1)}(e.traits,e.traits,this.owner.traits)){this.#iO(e.position);return}let t=function(e,t,r){if(!r.has("HP_GAIN"))return 0;let i=tw(r.getHpGainDiceWhenCastBy?r.getHpGainDiceWhenCastBy(e):r.get("HP_GAIN",0)),a=t.getInt("HP");return Math.min(i,t.getInt("HP_MAX")-a)}(e.traits,e.traits,this.owner.traits);return this.#iR(e.position),this.#iN(e,t),e.traits.addTransientFxTraits(this.owner.traits),Promise.resolve()}#iN(e,t){t>0&&(e.traits.addInt("HP",t),eJ(`+${t}HP`,e.position,rf.HP_TRANSIENT_TEXT_HERO))}#iw(e){let t=tJ.getAlmanac("ARTEFACTS"),r=t.find(e=>"iron_rations"===e.id),i=t.find(e=>"waterskin"===e.id),a=0;for(let t=0;t<3;t++){let t=t4(r);if(!e.storeManager.stash(t,{direct:!0}))break;a++;let n=t4(i);if(!e.storeManager.stash(n,{direct:!0}))break;a++}return 0===a?tc.showOkDialog(tr`MESSAGE NO SPACE FOR CONJURED FOOD AND WATER`):a<6?tc.showOkDialog(tr`MESSAGE NO SPACE FOR ALL CONJURED FOOD AND WATER`):tc.showOkDialog(tr`MESSAGE CONJURED FOOD AND WATER`)}#iE(e){let t=e.storeManager.getStore(t0.BACKPACK).values(),r=!1;return(t.forEach(e=>{e.unknown&&(r=!0,e.unknown=!1)}),r)?tc.showOkDialog(tr`MESSAGE DETECT POISON SUCCESS`):tc.showOkDialog(tr`MESSAGE DETECT POISON FAILURE`)}#iA(e){this.#ix(e).then(t=>{if(t>0){let r=Math.round(t/2),i=e.traits.getInt("HP"),a=Math.min(e.traits.getInt("HP_MAX")-i,r);L.info(`Vampiric touch convert ${t} damage to ${a} HP.`),this.#iN(e,a)}})}#iy(e){e.traits.transientProperties&&(e.traits.transientProperties.hover=!0,this.#iR(e.position))}#iI(e,t,r){return e.isHero()?(r?t.isEnemy()||t.isTrader():t.isEnemy())&&t.alive:t.isHero()&&t.alive}#iR(e){!function(e,t){let r=new eM({prefix:e,suffix:".png",startIndex:0,padding:2},{framePeriodMs:300,loopMethod:eD.REVERSE});ej(new eB(eg.getContext2D(),r),t)}(this.owner.traits.get("EFFECT").toLowerCase(),{position:e,delaySecs:0,lifetimeSecs:2})}#iO(e){eZ(eN.getSpriteBitmap("failed-spell.png"),{position:e,delaySecs:0,lifetimeSecs:2})}}class a6 extends a4{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){let t=this.owner.traits.get("TYPE");if("POTION"===t)return e.traits.addTransientFxTraits(this.owner.traits),this.#iC(e),tc.showOkDialog(tr`MESSAGE FX TRAITS APPLIED`);if("POISON"===t){let t=t_(this.owner.traits,e.traits);return 0===t?tc.showOkDialog(tr`MESSAGE RESISTED POISON`):0>=aQ(this.owner,e,t)?tc.showOkDialog(tr`MESSAGE KILLED BY POISON`):tc.showOkDialog(tr`MESSAGE IT'S POISON ${t}`)}{let r;let i=function(e,t){let r=e.getInt("HP",0),i=t.getInt("HP",0),a=t.getInt("HP_MAX",i)-i,n=a<0?0:Math.min(a,r);return{shortFall:a,oldHp:i,newHp:i+n,detoxify:e.get("DETOXIFY",!1)}}(this.owner.traits,e.traits),a=i.newHp-i.oldHp;r=i.shortFall<=0?tr`MESSAGE CONSUME BUT ALREADY FULL HP`:0===a?tr`MESSAGE CONSUME BUT NO HP GAIN`:"MEDICINE"===t?tr`MESSAGE IT'S A HEALTHY DRINK ${a}`:tr`MESSAGE IT'S HEALTHY ${a}`;let n=te("div");return n.appendChild(te("p",{text:r})),i.detoxify&&(e.toxify?.cure(),n.appendChild(te("p",{text:tr`MESSAGE CURED OF TOXINS`}))),tc.showControlsDialog(n).then(()=>e.traits.set("HP",i.newHp))}}#iC(e){let t=this.owner.traits.get("ACTION");if(t){if(!e.traits.transientProperties){L.error(`Actor ${e.traits.get("NAME")} has no transientProperties.`);return}"HOVER"===t?e.traits.transientProperties.hover=!0:L.error(`Did not recognise action: ${t}.`)}}}let a7={ATTEMPT_DISABLE:"attempt disable",LEAVE:"leave",DISABLED:"disabled",TRIGGERED:"triggered"};class ne extends a4{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){let t,r=null,i=function(e,t){let r;let i=aj[t.get("SEVERITY","SETBACK")]??aj.SETBACK;return r=e<5?i.damage[0]:e<11?i.damage[1]:e<17?i.damage[2]:i.damage[3],{difficulty:i.dc,attack:new t$({damageDice:r,weaponType:"TRAP",proficiencyBonus:0,abilityModifier:i.bonus}),detectBy:t.get("DETECT_BY","WIS"),disableBy:t.get("DISABLE_BY","INT"),reward:t.get("REWARD")}}(e.traits.getCharacterLevel(),this.owner.traits),a=await this.#iP(e.traits,i);switch(a){case a7.TRIGGERED:return L.info("Trigger the trap."),(0===(t=tM(i.attack,e.traits))?function(e,t,r){return tc.showElementOkDialog(tr`DIALOG TITLE TRAP TRIGGERED SURVIVED`,aZ(r,tr`MESSAGE TRAP TRIGGERED SURVIVED`))}:function(e,t,r){return tc.showElementOkDialog(tr`DIALOG TITLE TRAP TRIGGERED INJURED`,aZ(r,tr`MESSAGE TRAP TRIGGERED INJURED`))})(e,i,this.owner.description).then(()=>this.#iD(e,t)).then(()=>({outcome:a,artefact:r}));case a7.DISABLED:return L.info("Disabled the trap."),r=function(e,t=["MONEY"]){let r=tJ.findById(e,t);return r?t4(r):(L.error(`Could not find artefact ${e} in ${t} almanacs.`),null)}(i.reward),(this.owner.description,tc.showOkDialog(tr`DIALOG TITLE TRAP DISABLED`,aZ(tr`MESSAGE TRAP DISABLED`))).then(()=>({outcome:a,artefact:r}));case a7.LEAVE:return L.info("Left the trap."),Promise.resolve({outcome:a,artefact:r})}}#iD(e,t){return new Promise(r=>{tu.playEffect("TRIGGER TRAP"),t<=0?eZ(eN.getSpriteBitmap("miss.png"),{delaySecs:0,lifetimeSecs:1,position:e.position,velocity:new X(0,0,0)}):(eZ(eN.getSpriteBitmap("blood-splat.png"),{delaySecs:0,lifetimeSecs:1,position:e.position,velocity:new X(0,0,0)}),aJ(this.owner,e,t)),r()})}#iP(e,t){return tG(e,{ability:t.detectBy,difficulty:t.difficulty,proficiency:"TRAPS"})?(this.owner.description,tc.showChoiceDialog(tr`DIALOG TITLE TRAP DETECTED`,tr`MESSAGE TRAP ATTEMPT DISABLE`,[tr`BUTTON TRAP DISABLE`,tr`BUTTON TRAP LEAVE`]).then(e=>0===e?a7.ATTEMPT_DISABLE:a7.LEAVE)).then(r=>r===a7.LEAVE?r:tG(e,{ability:t.disableBy,difficulty:t.difficulty,proficiency:"TRAPS"})?a7.DISABLED:a7.TRIGGERED):Promise.resolve(a7.TRIGGERED)}}class nt extends a4{constructor(e){super(e)}canEnact(){return!1}canReact(){return!0}async react(e){return(function(e){let t=e.storeManager;t||L.error("Actor with no storeManager is trying to use a gold portal.");let r=Math.floor(t.getPurseValue());if(r<1)return tc.showOkDialog(tr`MESSAGE GOLD_PORTAL - INSUFFICIENT GOLD`).then(()=>0);let i=["0%"],a=[0];for(let e of[25,50,75,100]){let t=Math.round(r*e/100);t>0&&(i.push(`${e}%`),a.push(t))}return tc.showChoiceDialog(tr`DIALOG TITLE GOLD_PORTAL`,tr`MESSAGE GOLD_PORTAL - EXPLAIN`,i).then(t=>{let r=a[t];if(r){let t=e.traits.getInt("GOLD_SENT",0);t+=r,e.traits.set("GOLD_SENT",t)}return r}).then(e=>e?(t.takeFromPurse(e),tc.showOkDialog(tr`MESSAGE GOLD_PORTAL - EXPLAIN CLOSURE ${e}`).then(()=>e)):0)})(e).then(e=>{e&&(tu.playEffect("PORTAL"),this.owner.alive&&(this.owner.velocity=new X(0,0,3),this.owner.alive=!1))})}}let nr={HERO:0,ENEMY:1,ARTEFACT:2,HIDDEN_ARTEFACT:3,TRADER:4,PROP:5,PORTAL:6},ni={COMBAT:"COMBAT",COMBO:"COMBO",POISON:"POISON",MAGIC:"MAGIC",RANGED:"RANGED"},na={WANDER:"WANDER",HUNT:"HUNT",ORGANIC:"ORGANIC"};class nn extends rh{almanacEntry;#iv;sprite;traits;interaction;toxify;alive;sleeping;discovered;disengaging;description;iconImageName;storeManager;type;adventureStartTime;constructor(e,t=nr.ENEMY){super(),this.interaction=new a4,this.sprite=e,this.sprite.obstacle=!0,this.#iv=!1,this.alive=!0,this.sleeping=!1,this.discovered=!1,this.disengaging=!1,this.type=t,this.storeManager=new t9(t===nr.TRADER||t===nr.HIDDEN_ARTEFACT,()=>this.#iL()),t===nr.HERO&&(this.adventureStartTime=new Date().getTime())}#iL(){let e=this.storeManager.getAllEquippedArtefacts(),t=e.filter(e=>t8(e.artefactType,t1.WEAPON)||t8(e.artefactType,t1.TWO_HANDED_WEAPON)),r=e.filter(e=>t8(e.artefactType,t1.ARMOUR)||t8(e.artefactType,t1.HEAD_GEAR)),i=e.filter(e=>t8(e.artefactType,t1.SHIELD)),a=e.filter(e=>t8(e.artefactType,t1.RING)||t8(e.artefactType,t1.BELT)||t8(e.artefactType,t1.HEAD_GEAR));this.traits.utiliseAdditionalTraits({weapons:t.map(e=>e.traits),armour:r.map(e=>e.traits),shields:i.map(e=>e.traits),magic:a.map(e=>e.traits)})}freezeMovement(){this.#iv=!0}getMaxTilesPerMove(){return this.#iv?0:this.traits.getMaxTilesPerMove()}isHero(){return this.type===nr.HERO}isEnemy(){return this.type===nr.ENEMY}isTrader(){return this.type===nr.TRADER}isHiddenArtefact(){return this.type===nr.HIDDEN_ARTEFACT}set visible(e){this.sprite.visible=e}get visible(){return this.sprite.visible}get obstacle(){return this.sprite.obstacle}set obstacle(e){this.sprite.obstacle=e}get position(){return this.sprite.position}set position(e){this.sprite.position=e}get velocity(){return this.sprite.velocity}set velocity(e){this.sprite.velocity=e}getImageFilename(){return this.sprite.getImageFilename()}isWandering(){return this.traits?.get("MOVE")===na.WANDER}isOrganic(){return this.traits?.get("MOVE")===na.ORGANIC}isProp(){return this?.type===nr.PROP}isPortal(){return this?.type===nr.PORTAL}get moveType(){return this?.traits.get("MOVE")}get attackMode(){return this?.traits.get("ATTACK",ni.COMBAT)}willInteract(){return!!this.interaction&&(!this.isWandering()||tg(6)>3)}isPassableByActor(e){return!!(e.isHero()&&(this.isHiddenArtefact()||this.isPortal()))||!this.alive&&!this.isProp()||!this.obstacle}canShareLocationWithActor(e){return this.isPortal()?e.isHero():this.isOrganic()?!e.isOrganic()&&!e.isTrader():this.isHiddenArtefact()?e.isHero():!!(!this.alive&&e.isHero())||!this.obstacle}update(e){this.sprite.update(e)}actionClick(e){super.actionClick(this.sprite.position)}actionContextClick(e){super.actionContextClick(this.sprite.position)}actionPointerUp(e){super.actionPointerUp(this.sprite.position)}actionPointerDown(e){super.actionPointerDown(this.sprite.position)}toJSON(){let e=this.storeManager.getAllStorageDetails(),t=[];for(let r of e)t.push({storeTypeId:r.store.storeTypeId,artefact:r.artefact});return{reviver:"Actor",data:{adventureStartTime:this.adventureStartTime,alive:this.alive,sleeping:this.sleeping,discovered:this.discovered,almanacEntry:this.almanacEntry,traits:this.traits,inventory:t,toxin:this?.toxify.getToxin()}}}static revive(e,t){e.almanacEntry.equipmentIds=[];let r=t(e.almanacEntry,e.traits);for(let t of(r.adventureStartTime=e.adventureStartTime,r.alive=e.alive,r.sleeping=e.sleeping,r.discovered=e.discovered,r.toxify=new a5(e.toxin),e.inventory)){let e=r.storeManager.getStoreByTypeId(t.storeTypeId);if(!e){L.error(`Unable to find store matching ${t.storeTypeId}. Game restore abandoned.`);return}e.add(t.artefact)}return r}}let ns=new Map,no=!1;function nl(e,t){let r=eg.glassPositionToWorld(t.position),i=t.sprite.getBoundingBox();return new Z(r.x-i.width/2,r.y-i.height/2,i.width,i.height).containsCoordinate(e.world.x,e.world.y)}function nh(e){if(!no||!no)return!1;for(let[t,r]of ns)if(nl(e,r))return r.actionPointerUp(r,e.canvas),!0;return!1}var nc={addButton:function(e,t,r){let i=new nn(new eH({renderer:new eB(eg.getContext2D(),e)}));return ns.set(i,i),i.setOnClick(()=>{r?0===e.getCurrentIndex()?(e.setCurrentIndex(1),t()):(e.setCurrentIndex(0),r()):t()}),e.setCurrentIndex(0),i},addMomentaryButton:function(e,t,r){let i=new nn(new eH({renderer:new eB(eg.getContext2D(),e)}));return ns.set(i,i),i.setOnPointerDown(()=>{e.setCurrentIndex(1),t?.()}),i.setOnPointerUp(()=>{e.setCurrentIndex(0),r?.()}),i},clear:function(){ns.clear()},update:function(e){no&&ns.forEach(t=>{let r=j.copy(t.position);t.position=eg.glassPositionToWorld(t.position),t.update(e),t.position=r})},resolvePointerCancel:function(e){return nh(e)},resolveClick:function(e){if(!no)return!1;for(let[t,r]of ns)if(nl(e,r))return r.actionClick(r,e.canvas),!0;return!1},resolveContextMenu:function(e){return!1},resolvePointerDown:function(e){if(!no||!no)return!1;for(let[t,r]of ns)if(nl(e,r))return r.actionPointerDown(r,e.canvas),!0;return!1},resolvePointerUp:nh,setVisible:function(e){no=e}};let nu={GRINNING:"\uD83D\uDE00",SANTA:"\uD83C\uDF85",SHAKING:"\uD83E\uDEE8"},nd="custom-pointer-down-event",nf="custom-pointer-up-event",np="custom-pointer-cancel-event",nm="custom-click-event",ng="custom-context-click-event",nS="custom-pointer-drag-event",nw={MOUSE:0,TOUCH:1};function nE(e,t,r){let i=new CustomEvent(t,{detail:r});e.dispatchEvent(i)}function nT(e){let t=e.target.getBoundingClientRect();return{x:e.touches[0].pageX-t.left,y:e.touches[0].pageY-t.top}}function ny(e,t,r,i){i.actionStarted=!0,i.dragging=!1,i.distance=0,i.lastX=t,i.lastY=r,i.startX=t,i.startY=r,nE(i.element,nd,{x:t,y:r})}function nA(e,t,r,i){let a=i.dragging?"custom-pointer-drag-end-event":nf;i.actionStarted=!1,i.dragging=!1,i.distance=0,i.lastX=t,i.lastY=r,i.startX=t,i.startY=r,nE(i.element,a,{x:t,y:r})}function nx(e,t,r,i){let a=t-i.lastX,n=r-i.lastY;if(i.lastX=t,i.lastY=r,i.dragging){let e=new CustomEvent(nS,{detail:{x:t,y:r,dx:a,dy:n}});i.element.dispatchEvent(e)}else(Math.abs(t-i.startX)>10||Math.abs(r-i.startY)>10)&&(i.dragging=!0,i.suppressClickEvent=!0)}let nI=new Map([["BUTTON ABOUT AND PRIVACY","About & privacy"],["BUTTON BUY FOR GP","Buy for ${0}Â GP"],["BUTTON CANCEL","Cancel"],["BUTTON CAST SPELL","Cast spells & cantrips"],["BUTTON DELETE MEMORY","Delete memory"],["BUTTON CONSUME","Consume"],["BUTTON CONTINUE","Continue"],["BUTTON CONTINUE ADVENTURE","Continue adventure"],["BUTTON CLIMB OVER","Climb over"],["BUTTON BARGE","Barge past"],["BUTTON HALL OF FAME","Hall of fame"],["BUTTON DELETE","DELETE!"],["BUTTON DISCARD","Discard"],["BUTTON DO NOT SHOW AGAIN","Do not show again"],["BUTTON ENTER DUNGEON","Enter if you dare"],["BUTTON EQUIP","Equip"],["BUTTON FORGET","Forget"],["BUTTON GETTING STARTED","Getting started"],["BUTTON GUIDES","About and Help"],["BUTTON HELP","Help"],["BUTTON INVENTORY","Inventory"],["BUTTON LEARN SPELL","Learn spell"],["BUTTON LEAVE ARTEFACT","Leave"],["BUTTON LEAVE IT","Leave it"],["BUTTON MAGIC","Magic"],["BUTTON MAIN MENU","Main menu"],["BUTTON MOVE","Move"],["BUTTON OK","OK"],["BUTTON PILLAGE","Pillage"],["BUTTON PLAY ADVENTURE","Start adventure"],["BUTTON PLAY CASUAL","Casual exploration"],["BUTTON PRIVACY","Privacy"],["BUTTON PREPARE SPELL","Prepare"],["BUTTON REST","Rest"],["BUTTON REST LONG","Long rest"],["BUTTON READY MAGIC","Ready Magic"],["BUTTON REST SHORT","Short rest"],["BUTTON SEARCH","Search"],["BUTTON SELL FOR GP","Sell for ${0}Â GP"],["BUTTON SETTINGS","Settings"],["BUTTON SHOW DEBUG LOG","The chronicles of DeBuggle Logitall"],["BUTTON START","Let's get started."],["BUTTON STASH","Stash"],["BUTTON STEAL","Steal"],["BUTTON TRAP DISABLE","Try to disable"],["BUTTON TRAP LEAVE","Leave it alone"],["BUTTON TAKE ARTEFACT","Take"],["BUTTON TRADE","Trade"],["BUTTON TRAITS","Traits"],["BUTTON TRY AGAIN","Try again"],["BUTTON TRY TO PICK","Pick lock"],["BUTTON UNEQUIP","Unequip"],["BUTTON USE","Use"],["CONTROL DO NOT SCALE","Maximum scale 1:1"],["CONTROL EFFECTS VOLUME","Effects volume"],["CONTROL UI FONT SCALE","UI font scale"],["CONTROL MUSIC VOLUME","Music volume"],["CONTROL SHOW QUICK TIPS","Show quick tips"],["CONTROL RUN FULLSCREEN","Run fullscreen"],["DESCRIPTION ACID_SPLASH","You hurl a bubble of acid over up to two creatures within your touch."],["DESCRIPTION ACID_ARROW","You send out a shimmering green arrow that bursts into a spray of acid on impact."],["DESCRIPTION AMBER","Precious fossilized tree resin, which is much sought after in these realms."],["DESCRIPTION ARCANE_ORB","Orb used by some users of magic to focus their spells."],["DESCRIPTION ARCANE_SWORD","You create a sword-shaped plane of energy that hovers over your target and initiates a melee spell attack."],["DESCRIPTION AQUAMARINE","A precious crystal of rare beauty."],["DESCRIPTION BARBARIAN1","You are a barbarian ready to battle to the end of this dungeon in search of wealth and glory."],["DESCRIPTION BATTLEAXE","A mighty battleaxe."],["DESCRIPTION BELT_OF_STRENGTH","A rare belt, originally crafted by dwarves and significantly increasing the strength of the wearer."],["DESCRIPTION BERSERKER","A hate crazed berserker."],["DESCRIPTION BLACK_FLASK","A black flask containing a clear, pungent liquid."],["DESCRIPTION BLACK_FLASK?POTION_OF_FLYING","A black flask containing a clear, pungent potion that allows the user to hover temporarily above the ground."],["DESCRIPTION BLACK_FLASK?SERPENT_VENOM","A black flask containing a clear, pungent poison."],["DESCRIPTION BLADE_BARRIER","You create a whirling ringed-wall of spinning blades."],["DESCRIPTION BLIGHT","You cause necromantic energy to flow over a creature, draining moisture and vitality from it. The spell does not work on the undead."],["DESCRIPTION BUGBEAR","A ferocious humanoid and evil creature bent on mayhem and carnage."],["DESCRIPTION BURNING_HANDS","Casting this spell with your thumbs touching and fingers spread creates a thin sheet of flames enveloping your enemies."],["DESCRIPTION CHAIN_MAIL_ARMOUR","Armour comprising interlocking steel rings over a soft cushioning fabric. The suit includes gauntlets."],["DESCRIPTION CHILL_TOUCH","You create a ghostly skeletal hand above a creature within your range and assail it with the chill of the grave."],["DESCRIPTION CIRCLE_OF_DEATH","You create a sphere of negative energy that ripples out around you."],["DESCRIPTION CLERIC1","You are a powerful cleric who can act as a conduit between divine powers and the mortal world."],["DESCRIPTION CLUB","A simple wooden club that's seen a lot of action."],["DESCRIPTION COINS","Various coins stamped with the image of latter day kings and queens."],["DESCRIPTION CONE_OF_COLD","You create a blast of cold air that erupts from your hands."],["DESCRIPTION COPPER_COINS","Old copper coins of low value."],["DESCRIPTION COPPER_DRAGON_WYRMLING","A very young copper dragon. Young, but capable of inflicting serious damage with its bite and claws."],["DESCRIPTION CREATE_FOOD_AND_WATER","You conjure some food and water to create up to three meals. You need space in your backpack to store the meals."],["DESCRIPTION CURE_MY_WOUNDS","You cast a spell allowing you to cure some of your wounds"],["DESCRIPTION DAGGER","A short and very sharp piercing weapon."],["DESCRIPTION DETECT_POISON","You perform a ritual to identify any poisons or unidentified items in your backpack."],["DESCRIPTION DIAMOND","A valuable and rare crystal."],["DESCRIPTION DRETCH","The lowest and least respected of all demons."],["DESCRIPTION EARTHQUAKE","You create a seismic disturbance causing an intense tremor to rip through the ground."],["DESCRIPTION ENCHANTED_BATTLEAXE","A mighty battleaxe. This magical weapon increases the likelihood and severity of damage."],["DESCRIPTION ENCHANTED_GREATAXE","A heavy two-handed axe capable of inflicting severe wounds when in the right hands. This magical weapon increases the likelihood and severity of damage."],["DESCRIPTION ENCHANTED_GREATSWORD","A two-handed massive sword inflicting serious slashing damage. This magical weapon increases the likelihood and severity of damage."],["DESCRIPTION ENCHANTED_HANDAXE","A small, light axe. This magical weapon increases the likelihood and severity of damage."],["DESCRIPTION ENCHANTED_SHORTSWORD","A short enchanted sword. This magical weapon increases the likelihood and severity of damage."],["DESCRIPTION ENGRAVED_PILLAR","A large stone pillar covered with mystical engravings."],["DESCRIPTION FETID_WATER","A fetid, murky film of liquid covering the dungeon flagstones."],["DESCRIPTION FIGHTER1","You are a fighter whose family have fallen out of favour. This is your chance to restore your family's good name."],["DESCRIPTION FIND_TRAPS","You sense the presence of traps around you. You cannot learn the location of the traps though."],["DESCRIPTION FINGER_OF_DEATH","You send negative energy coursing through a creature you can see within range, causing it searing pain."],["DESCRIPTION FIRE_BEETLE_PV","A giant fire beetle. Glowing gland radiate a fiery light across the dungeon."],["DESCRIPTION FIRE_BEETLE_CARAPACE","Lustrous carapace of the fire beetle, much used in simple jewelry."],["DESCRIPTION FIRE_BOLT","You hurl fire at a creature."],["DESCRIPTION FIRE_STORM","You create sheets of roaring flames."],["DESCRIPTION FLAIL","A fear inducing bludgeoning weapon."],["DESCRIPTION FLAME_STRIKE","You create a column of divine fire almost forty feet high."],["DESCRIPTION FUNGAL_FILM","A sticky fungal film that coats the dungeon floor. Poisonous and strength sapping"],["DESCRIPTION FUNGUS","A brightly coloured red and white fungus."],["DESCRIPTION FUNGUS?BERSERKER_COURAGE","Berserker courage fungus. Consumption creates a feeling of unstoppable power and provides a temporary adrenalin-fueled increase in strength."],["DESCRIPTION FUNGUS?DEATH_FLY","Death fly fungus. A poisonous fungus often confused with Berserker Courage."],["DESCRIPTION GARGOYLE","A chaotic evil gargoyle."],["DESCRIPTION GARGOYLE_WINGS","Gargoyle wings that are used for the manufacture of an incredibly tough and resilient type of leather armour."],["DESCRIPTION GIANT_WASP_PV","A gigantic wasp making a deafening buzzing sound that echoes round the dungeon."],["DESCRIPTION GOBLIN","Small humanoid creature.Treat with caution. They're small but vicious."],["DESCRIPTION GOLD_COINS","Gold coins stamped with the image of latter day kings and queens."],["DESCRIPTION GOLD_RING","A simple gold ring."],["DESCRIPTION GHOUL","An undead creature, living amongst the dead and dying."],["DESCRIPTION GOLD_PORTAL","A magical dwarven portal used for transporting gold and platinum back to the surface."],["DESCRIPTION GREATAXE","A heavy two-handed axe capable of inflicting severe wounds when in the right hands."],["DESCRIPTION GREATSWORD","A two-handed massive sword inflicting serious slashing damage."],["DESCRIPTION HALF_PLATE_ARMOUR","Shaped metal plates covering most of the body. Simple greaves protect the legs."],["DESCRIPTION HANDAXE","A small, light axe. The blade is sharp and has been looked after with care."],["DESCRIPTION HELMET","A simple steel helmet"],["DESCRIPTION HELMET_OF_OGRE_POWER","A magical steel helmet offering the normal protection of a steel helmet along with a massive increase in strength."],["DESCRIPTION HIDDEN_ARTEFACT","The ground appears to have been disturbed."],["DESCRIPTION HUNTING_TRAP","A old battered hunting trap designed for catching monsters and humans."],["DESCRIPTION ICE_STORM","You cause a hail of rock-hard ice to pound to the ground around you."],["DESCRIPTION INCENDIARY_CLOUD","You create a swirling cloud of smoke shot through with white hot embers."],["DESCRIPTION INFLICT_WOUNDS","You make a melee spell attack against a creature you can touch to inflict necrotic damage."],["DESCRIPTION IRON_RATIONS","Simple emergency rations. Crucial for resting between floors."],["DESCRIPTION KOBOLD","A small reptilian humanoid."],["DESCRIPTION LEATHER_ARMOUR","Simple armour comprising stiffened leather boiled in oil along with some more flexible sections."],["DESCRIPTION LICHEN","A type of lichen that grows between the flagstones."],["DESCRIPTION LICHEN?DRAGON_SCALE_LICHEN","Dragon scale lichen. A green lichen, much sought after by explorers because of it's legendary health benefits."],["DESCRIPTION LICHEN?LIZARD_SKIN_LICHEN","Lizard skin lichen. A green lichen, closely related to dragon scale lichen, but mildly poisonous."],["DESCRIPTION LIGHTNING_BOLT","You create a stroke of lightning that shoots out from you hitting all creatures in it's path."],["DESCRIPTION LIZARD_PV","A red and blue lizard, more dangerous than it looks."],["DESCRIPTION LIZARD_SKIN","Lizard skin; sought after for high-society shoes and belts."],["DESCRIPTION LOCK_PICK","Set of lock picks."],["DESCRIPTION LUTE","A beautiful lute in remarkable condition."],["DESCRIPTION MANHOLE_COVER","A small manhole cover set into the dungeon floor."],["DESCRIPTION MEAT","A joint of some type of meat."],["DESCRIPTION MEAT?HAM","A joint of meat which can be used as a meal while you rest between floors."],["DESCRIPTION MEAT?POISON_LIZARD","A hunk of meat from a dungeon lizard. This is toxic to humans."],["DESCRIPTION MEAT?ROTTING","A joint of meat, but it looks and smells like it is well past it's best."],["DESCRIPTION OGRE","A large and incredibly strong ogre."],["DESCRIPTION ORC","A monstrous creature with an intense hatred of humans."],["DESCRIPTION ORC_SKULL","An old and slightly cracked skull from a orc."],["DESCRIPTION PADDED_ARMOUR","Simple quilted layers of cloth and batting."],["DESCRIPTION PLATE_ARMOUR","Full plate armour with interlocking steel plates covering the entire body. A visored helmet, gauntlets, boots, and padding are included."],["DESCRIPTION PLATINUM_COINS","Highly valued large platinum coins."],["DESCRIPTION POISON_SPRAY","You extend your hand toward your enemy and project a puff of noxious gas."],["DESCRIPTION POISONERS_KIT","A kit of vials of poisons and other toxic materials."],["DESCRIPTION POWER_WORD_KILL","You utter a word of power that compels a creature to die instantly."],["DESCRIPTION POTION_OF_HEALING","An aromatic potion, treasured for it's health restoration properties."],["DESCRIPTION PURPLE_PLANT","A small herb with a purple flower."],["DESCRIPTION PURPLE_PLANT?DRAGON_WORT","Purple dragon wort. Renowned for it's health giving properties."],["DESCRIPTION PURPLE_PLANT?FALSUS_DRAGON_WORT","Falsus dragon wort. Mimicking the medicinal dragon wort herb, this plant is highly toxic."],["DESCRIPTION QUARTERSTAFF","A large quarterstaff capable of causing significant damage in the right hands."],["DESCRIPTION QUARTZ","A precious crystal."],["DESCRIPTION RAT_PV","A giant rat, diseased and vicious."],["DESCRIPTION RAT_TAIL","A giant rat's tail used as an ingredient in a number of arcane remedies."],["DESCRIPTION RANGER1","You are a ranger who is more at one with the forest. The dungeon is not your natural realm, but you are ready to take it on."],["DESCRIPTION RESTORATIVE_OINTMENT","An ointment that can be rubbed into the skin or eaten to improve health and neutralise any poisons."],["DESCRIPTION RING_MAIL_ARMOUR","Leather armour reinforced with heavy steel rings sown into the material."],["DESCRIPTION RING_OF_CHARISMA","A magical ring that increases the charisma of the wearer."],["DESCRIPTION RING_OF_CONSTITUTION","A magical ring that increases the constitution of the wearer."],["DESCRIPTION RING_OF_DEXTERITY","A magical ring that increases the dexterity of the wearer."],["DESCRIPTION RING_OF_INTELLIGENCE","A magical ring that increases the intelligence of the wearer."],["DESCRIPTION RING_OF_STRENGTH","A magical ring that increases the strength of the wearer."],["DESCRIPTION RING_OF_WISDOM","A magical ring that increases the wisdom of the wearer."],["DESCRIPTION ROGUE1","You are a rogue whose slippery character may help you creep your way through the depths of this dark and unforgiving dungeon."],["DESCRIPTION RUSTY_KEY","A large iron key, covered in rust. It's been lost a long time."],["DESCRIPTION SCALE_MAIL_ARMOUR","Leather coat and legging covered with overlapping steel scales."],["DESCRIPTION SHADOW","An undead shadow creature, hiding in the darkness."],["DESCRIPTION SHATTER","You create a sudden loud ringing noise, painfully intense, that inflicts thunder damage on a creature."],["DESCRIPTION SHIELD","A wooden shield, carried in one hand and offering some protection."],["DESCRIPTION SHOCKING_GRASP","You create lightning which springs from your hands, delivering a massive shock to a creature within touching distance."],["DESCRIPTION SHORTSWORD","A light and well-crafted sword."],["DESCRIPTION SILVER_COINS","Silver coins, worn and tarnished but still of value."],["DESCRIPTION SKELETON","A skeleton of someone who died here many years ago. It's intent on revenge."],["DESCRIPTION SLIME","A green sticky substance that seems to be growing."],["DESCRIPTION SPARE_ME","You use your knowledge of necromancy to raise your health if you are nearly dying."],["DESCRIPTION SPIDER_PV","A giant spider with fangs dripping green venom."],["DESCRIPTION SPIDER_VENOM","Spider venom that is commonly used as a base ingredient in assassin's poisons."],["DESCRIPTION SPIKES","It's a trap. Sharp iron spikes shoot up from the ground."],["DESCRIPTION STIRGE","A blood-sucking cross between a giant mosquito and a blood curdling bat."],["DESCRIPTION STIRGE_HEAD","A stirge's head. The proboscis is often used as a ready made needle for delivering poisons and medicines."],["DESCRIPTION ENHANCE_ABILITY_AS_BULL","You bestow upon yourself a temporary increase in your strength."],["DESCRIPTION STUDDED_LEATHER_ARMOUR","Tough and flexible leather armour with the addition of steel spikes and rivets."],["DESCRIPTION TIGER_EYE","A precious gemstone"],["DESCRIPTION TOMB_OF_ELDER","A large ancient shrine. It appears to be stone but with a magical gold lustre."],["DESCRIPTION TRADER1","A wandering trader selling all manner of things gathered during many months in the dungeon."],["DESCRIPTION TRADER2","A wandering trader with a wagon stacked high with a variety of artefacts found in the dungeon."],["DESCRIPTION TRAPDOOR","A small door in the floor. You can't tell what it hides."],["DESCRIPTION VAMPIRIC_TOUCH","You touch a shadow-wreathed hand on a creature to inflict necrotic damage. You draw upon the damage inflicted to help heal your own wounds."],["DESCRIPTION VEGETATION","A patch of vegetation managing to grow between the cracks in the flagstones."],["DESCRIPTION VIOLET_FUNGUS","A moving fungus inflicting severe damage."],["DESCRIPTION WATERSKIN","A leather drinking flask with fresh water. Crucial for resting between floors."],["DESCRIPTION WARHAMMER","A bludgeoning, versatile iron hammer favoured by many clerics."],["DESCRIPTION WARLOCK1","You are a warlock, known for you great knowledge of the supernatural forces that drive the multiverse."],["DESCRIPTION WASP_STINGER","A giant wasp's stinger that is used as a poisoned weapon by some mercenaries."],["DESCRIPTION WATER_WALK","You perform a ritual to allow yourself to move across any liquid surface unharmed as your feet hover an inch or two above the ground."],["DESCRIPTION WIGHT","A wight, reanimated from the corpse of a rogue fighter whose rotting body was raised by evil necromancy."],["DESCRIPTION WIZARD1","You are a wizard determined to find your way to the final level of this dungeon using your control of magical chaos."],["DESCRIPTION WRAITH","An undead, neutral evil creature with a touch of death."],["DESCRIPTION ZOMBIE","An undead creature roaming the dungeon floors."],["DIALOG TITLE CASUAL GAME WARNING","WARNING! CASUAL EXPLORATION"],["DIALOG TITLE DEBUG LOG","Chronicles of Debug Loggerman"],["DIALOG TITLE DELETE MEMORY","DELETE MEMORY!"],["DIALOG TITLE HALL OF FAME","Hall of Fame"],["DIALOG TITLE CHOICES","Decisions, decisions"],["DIALOG TITLE LOCKED","Locked"],["DIALOG TITLE GOLD_PORTAL","Use the gold portal"],["DIALOG TITLE PICK SPELL TO CAST","Pick magic to cast"],["DIALOG TITLE PILLAGE","Pillage corpse"],["DIALOG TITLE PREPARE SPELLS","Prepare spells"],["DIALOG TITLE RUNE PUZZLE","Where next?"],["DIALOG TITLE SETTINGS","Adjust settings"],["DIALOG TITLE TRADE","Buy and sell with trader"],["DIALOG TITLE TRAP DETECTED","Trap detected!"],["DIALOG TITLE TRAP DISABLED","Trap disabled!"],["DIALOG TITLE TRAP TRIGGERED SURVIVED","Trap triggered!"],["DIALOG TITLE TRAP TRIGGERED INJURED","Trap triggered!"],["MENU TITLE MAIN","Click and Crawl"],["MENU TITLE GUIDES","Guides and information"],["MESSAGE ACHIEVEMENTS","You managed to reach floor ${0-floor} and sent back ${1}Â GP to the struggling townsfolk beyond these dungeon walls."],["MESSAGE CANNOT EQUIP ITEM OR STASH","This item is too large for your backpack and you are already wearing something else. Get rid of the other item first."],["MESSAGE CANNOT LOAD URL","Cannot load data from ${0}"],["MESSAGE CANNOT PILLAGE NO SPACE","You can't pillage this as you have no space available."],["MESSAGE CANNOT REST SHORT NEED LONG REST","You've had too many short rests. You need to take a long rest first."],["MESSAGE CANNOT REST SHORT NEED RATIONS","You don't have enough food or drink for a short rest. One meal of food and drink is required to enjoy a short rest."],["MESSAGE CANNOT REST LONG NEED RATIONS","You don't have enough food or drink for a long rest. Three meals, comprising food and drink, are required to enjoy a long rest."],["MESSAGE CANNOT STASH","You need to make space in your backpack to stash this."],["MESSAGE CANNOT STORE","You're carrying too much stuff to pick up what you've found."],["MESSAGE CANNOT UNDERSTAND MAGIC","There is strange magic written here, but it's beyond your comprehension."],["MESSAGE CASUAL GAME WARNING","You are about to embark on a casual exploration. The townsfolk know nothing of this. Your progress WILL NOT BE SAVED and you cannot enter the Hall of Fame."],["MESSAGE CONFIRM DELETE MEMORY","Are you sure you want to delete the game's memory? The Hall of Fame will be lost along with all the game settings."],["MESSAGE CONJURED FOOD AND WATER","You conjure some food and water and stash it in your backpack."],["MESSAGE CONSUME BUT ALREADY FULL HP","It tastes good, but you're already in prime health. Perhaps you should've waited."],["MESSAGE CONSUME BUT NO HP GAIN","It tastes nice, but your health doesn`t improve."],["MESSAGE CURED OF TOXINS","Any poisons that may have been affecting you are now neutralised and cease to have any further effect."],["MESSAGE DEAD HERO HAS NO INVENTORY","Dead heroes have no use for material belongings. Your inventory is lost in the dungeon, perhaps to be rediscovered by the next intrepid explorer."],["MESSAGE DEFEAT","To honour your achievements, the grateful townsfolk will add your name to a plaque in the town's Hall of Fame. Tonight the inns will be filled with songs of your heroism."],["MESSAGE DEFEAT UNPLACED","Despite your valiant efforts, your efforts will be forgotten and no bards will sing of your exploits."],["MESSAGE DETECT POISON FAILURE","You waste your spell. There were no unidentified items in your backpack."],["MESSAGE DETECT POISON SUCCESS","You identify everything in your backpack."],["MESSAGE DUNGEON INTRO CONTINUE","Welcome back, ${0}. The adventure continues. You recognise the familiar smell of death."],["MESSAGE ENTER FLOOR","You enter dungeon floor ${0}. The door slams shut behind you. There's no way back. Like it or not, your only path is to continue deeper into the depths of this stone hell."],["MESSAGE ENTRANCE STUCK",["The entrance is locked or jammed. You can't tell which, but either way, you can't escape in that direction. You need to find the exit.","You can't open the entrance. It seems locked or jammed. There's no way back. You need to find the exit."]],["MESSAGE EXPLAIN SPELL PREP","After a long rest, you can prepare spells ready for use."],["MESSAGE EXIT LOCKED","The exit is locked. There must be a key somewhere."],["MESSAGE EXPLAIN REST","Trying to use the safety of the corridor to rest and eat?"],["MESSAGE EXPLAIN SPELL NEEDS REST","To use a spell you need to prepare it. Preparation can only be done between dungeon floors after a long rest."],["MESSAGE FAILED TO IDENTIFY","You try to identify this item, but you're not sure exactly what it is. You might remember later."],["MESSAGE FOUND HIDDEN ARTEFACT",["Good fortune smiles upon you. You find something.","You find something that has been hidden or lost.","Buried beneath the surface, you find something."]],["MESSAGE FOUND HIDDEN ARTEFACT - VEGETATION","You find something managing to grow in a small patch of vegetation."],["MESSAGE FOUND ENGRAVING","You find strange words engraved on the cold stone surface."],["MESSAGE FOUND GENERIC","It 's your lucky day. You find something that appears to have been hidden for many years."],["MESSAGE FX TRAITS APPLIED","You feel a strange effect on your abilities."],["MESSAGE GENERIC EPITAPH","Here lies the corpse of one more defeated enemy."],["MESSAGE HALL OF FAME ENTRY","${3-startDate}: ${0-name}; level ${1-level} ${2-class}; ${4-gold} GP sent; floor ${5-floor}"],["MESSAGE HERO EPITAPH FOR","Here lies the body of ${0}. Rest in peace."],["MESSAGE IDENTIFIED ITEM","You manage to identify an item you've found."],["MESSAGE INSUFFICIENT FUNDS","You don't have enough funds to purchase this item. The item costs ${0}Â GP but you only have ${1}Â GP."],["MESSAGE IT'S A HEALTHY DRINK","That tastes good. +${0}HP"],["MESSAGE IT'S HEALTHY","A bit chewy, but tastes good. +${0}HP"],["MESSAGE KILLED BY POISON","Yuk! Poison! You start to burn up, cough and vomit, before falling to the floor and dying."],["MESSAGE IT'S POISON","Yuk! It's poison. -${0}HP"],["MESSAGE KEY UNLOCKS EXIT","You use the key you found earlier to unlock the door."],["MESSAGE LOCK PICK BREAKS","The iron here is poor and damaged by iron blight. Your lock pick breaks."],["MESSAGE MAKE SPACE IN BACKPACK","You need to make space in your backpack by discarding or using something."],["MESSAGE MAKE SPACE IN EQUIP","This is too big to store. Sell or discard what you're wearing so you can wear this."],["MESSAGE UNEQUIP TO MAKE SPACE TO EQUIP","You need to make space in your backpack for the weapons you are already wielding. Alternatively, you may need to discard them."],["MESSAGE MEMORY DELETED","The memory has been deleted."],["MESSAGE NO SPACE FOR CONJURED FOOD AND WATER","You conjure food and water, but it all goes to waste as you have no room left in your backpack."],["MESSAGE NO SPACE FOR ALL CONJURED FOOD AND WATER","You conjure food and water, but some of it goes to waste as you have no room left in your backpack."],["MESSAGE GOLD_PORTAL - EXPLAIN","This old dwarven gold portal can be used to transfer gold to help the desperate townsfolk who are struggling above ground. Choose how much gold you want to send."],["MESSAGE GOLD_PORTAL - EXPLAIN CLOSURE","You add ${0-gold}Â GP to the portal. Dwarven portals remain open until they can no longer detect the presence of the opener. To prevent gold staying locked in the portal, you will need to exit the room or die to allow the portal to close."],["MESSAGE GOLD_PORTAL - INSUFFICIENT GOLD","You don't have enough gold for the portal. Copper and silver cannot be sent via the portal."],["MESSAGE NEED LOCK PICK","You can't pick a lock without a set of lock picks."],["MESSAGE NO CASTING POWER LEFT","You don't have enough casting power left to cast this spell. You will need to take a long rest to recover your energy."],["MESSAGE NO SAVED ADVENTURE","No adventure has been saved yet."],["MESSAGE NOTHING HERE","There's nothing here."],["MESSAGE NOTHING MORE TO DISCOVER","There's nothing more for you to learn or discover here."],["MESSAGE PROGRESS HAS BEEN SAVED","Your current progress has been saved."],["MESSAGE REQUIRES RESTART","Change will take place when the game is next reloaded."],["MESSAGE RESISTED POISON","Yuk! It's poisonous, but you resist its toxic effects."],["MESSAGE REST DIALOG","You're at the top of a dark staircase leading even deeper down to floor ${0-floor}. You're safe for now. If you have enough food and drink, you can rest to recuperate, but if you don't need to recover, save your rations."],["MESSAGE REST LONG HP GAIN","Your long rest recovered ${0} HP. You are also now cured of the toxic effects of any poisons you may have encountered."],["MESSAGE REST SHORT HP GAIN","Your short rest recovered ${0} HP and gave you time to rid your body of any poisons."],["MESSAGE ROUTE CHOICE - EASY","You choose the easier route."],["MESSAGE ROUTE CHOICE - MEDIUM","You choose the harder route."],["MESSAGE RUNES ON WALL","At the bottom of the stairs there are two doors. There's an ancient inscription on wall."],["MESSAGE RUNES OVER DOORS","Above each door is a shorter inscription carved into the arch. You need to choose your path."],["MESSAGE SEARCH CORPSE OR MOVE",["You have a choice. Do you want to search the body or climb on top?","You find a corpse, but what should you do? Search for weapons and treasure or climb on top of the body?"]],["MESSAGE SEARCH HOLE OR MOVE",["You have a choice. Do you want to search this hole or move into it?","You've been here before. Do you want to search again or climb into the hole you dug?"]],["MESSAGE SEARCH OR MOVE","You have a choice. Do you want to search this tile or move onto it?"],["MESSAGE SPELL ALREADY KNOWN","You find a spell, but you already know this incantation."],["MESSAGE STOLE GOLD","Success. You pick the trader's pocket undetected and steal ${0} gold coins."],["MESSAGE TRADE STEAL OR BARGE","Do you want to trade or barge past this guy?"],["MESSAGE TRADER ATTACKS BACK","The angry trader detects your clumsy attempt at robbery and strikes back at you."],["MESSAGE TRADER CANNOT STASH","The trader has no space for this."],["MESSAGE TRADER WILL NOT TRADE","The trader has had enough of your trickery and will not trade with you."],["MESSAGE TRADERS PROTECTED","Traders are protected from attack under the ancient law for the protection of travelling merchants."],["MESSAGE TRAP ATTEMPT DISABLE","You find a trap. You can't tell what it is though. Do you want to try to disable it?"],["MESSAGE TRAP TRIGGERED SURVIVED","The trap triggers, but luckily you avoid any injury."],["MESSAGE TRAP TRIGGERED INJURED","You're caught by surprise and sustain a number of injuries from the trap."],["MESSAGE TRAP DISABLED","Taking great care you manage to disable the trap."],["MESSAGE USE PORTAL OR MOVE","You have a choice. Do you want to use this portal or move onto it?"],["MESSAGE YOU FAIL TO PICK THE LOCK","This lock is tricky. Your attempt to pick it fails."],["MESSAGE YOU PICK THE LOCK","Using your skills, you manage to pick the lock."],["MESSAGE WELCOME","Welcome to the Click and Crawl old-school dungeon crawler. How far will you get?"],["STR","Strength"],["DEX","Dexterity"],["CON","Constitution"],["INT","Intelligence"],["WIS","Wisdom"],["CHA","Charisma"],["FX_STR","Strength change"],["FX_DEX","Dexterity change"],["FX_CON","Constitution change"],["FX_INT","Intelligence change"],["FX_WIS","Wisdom change"],["FX_CHA","Charisma change"],["AC","Armour class"],["DMG","Damage"],["DMG_VERSATILE","Damage versatile"],["DMG_PER_TURN","Damage per turn"],["DC","Difficulty"],["HP","Hit points"],["TRIGGERS","Content warning: this game is intended for ages 16 and up and contains violence towards fantasy characters, mild horror atmospherics, comic book blood effects, and death of characters."],["AC","armour class"],["AC (including armour)","AC (+armour): ${0}"],["ACTS ON CASTER","Acts on caster"],["Backpack","Backpack"],["Body","Body"],["Cantrips","Cantrips"],["Consumables","Consumables"],["CHARACTER LEVEL:","level: ${0-level} ${1-class}"],["CHA","charisma"],["CON","constitution"],["CR","Challenge rating"],["DC","difficulty challenge"],["(DEAD)","(DEAD!)"],["DEX","dexterity"],["Dungeon floor:","Dungeon floor: ${0}"],["EXP","Experience"],["Experience:","Experience: ${0}"],["Feet","Feet"],["Score:","Score: ${0}"],["Gold:","Gold: ${0}Â GP"],["GOLD PIECES"," gold pieces"],["Hands","Hands"],["Head","Head"],["hover","hover"],["HP_MAX","Hit points maximum"],["(HP OUT OF VALUE)","(HP:Â ${0}/${1})"],["(HP VALUE)","(HP:Â ${0})"],["INT","intelligence"],["Known spells","Known spells"],["level","level"],["LEVEL UP","Level up to ${0}"],["Name:","Name: ${0}"],["NSEW","north-south-east-west"],["PB","proficiency bonus"],["Prepared spells","Prepared spells"],["RADIAL","radial"],["Range:","Range: ${0-range}"],["Ready spells","Ready spells"],["Ring fingers","Ring fingers"],["SHORT_RESTS_REMAINING","Short rests remaining"],["STR","strength"],["TRANSIENT","TRANSIENT"],["Unknown","Unknown"],["Wagon","Wagon"],["Waist","Waist"],["WEAPON BROKE!","WEAPON BROKE!"],["WIS","wisdom"],["YOU DIED!","YOU DIED!"],["zero","zero"]]);function nR(e){if(eP.updateTimeNow(e),u){var t;let r=(e-u)/1e3;aD.update(r),nc.update(r),eR.showFps&&(t=1/r,eI(eg.getContext2D(),`FPS: ${Math.round(t)}`,{x:0,y:eg.getCanvasDimensions().height},{color:"green"}))}u=e,ta.isAnimationOn()&&window.requestAnimationFrame(nR)}var nO={initialise:async function(e){eg.setOptions(e);let t=tc.popupElement(function(){let e=document.createElement("div"),t=document.createElement("img");t.src=iU.SPLASH_IMAGE,e.appendChild(t);let r=document.createElement("div");r.className="progress-indicator",e.appendChild(r);let i=document.createElement("p");return i.innerText="Loading",e.appendChild(i),e}());ti.setMap(nI),function(e){let t=0;for(let r in nu){let i=e.measureText(nu[r]),a=i.fontBoundingBoxAscent+i.fontBoundingBoxDescent,n=.5*a-i.fontBoundingBoxDescent;e.fillText(nu[r],-.5*i.width,n),e.getImageData(0,0,1,1).data[3]<=0&&(L.debug(`Emoji ${r} not supported.`),nu[r]=`[${t++}]`),e.clearRect(0,0,i.width,a)}}(eg.getContext2D()),function(){let e;let t=eg.getCanvas();e={element:t,actionStarted:!1,dragging:!1,x:0,y:0,lastTouchStartPoint:null,suppressClickEvent:!1},t.addEventListener("mousedown",t=>ny(nw.MOUSE,t.offsetX,t.offsetY,e),{passive:!0}),t.addEventListener("mouseup",t=>nA(nw.MOUSE,t.offsetX,t.offsetY,e),{passive:!0}),t.addEventListener("mousemove",t=>{1&t.buttons&&nx(nw.MOUSE,t.offsetX,t.offsetY,e)},{passive:!0}),t.addEventListener("touchstart",t=>{if(1===t.changedTouches.length){let r=nT(t);e.lastTouchStartPoint=new V(r.x,r.y),ny(nw.TOUCH,r.x,r.y,e)}},{passive:!0}),t.addEventListener("touchend",t=>{1===t.changedTouches.length&&nA(nw.TOUCH,e.lastTouchStartPoint?.x,e.lastTouchStartPoint?.y,e),e.lastTouchStartPoint=null,e.suppressClickEvent=!1},{passive:!0}),t.addEventListener("touchmove",t=>{if(1===t.changedTouches.length){let r=nT(t);nx(nw.TOUCH,r.x,r.y,e),e.suppressClickEvent=!0}},{passive:!0}),t.addEventListener("touchcancel",t=>{var r,i;nw.TOUCH,r=e.lastTouchStartPoint?.x,i=e.lastTouchStartPoint?.y,e.actionStarted=!1,e.dragging=!1,e.distance=0,e.lastX=r,e.lastY=i,e.startX=r,e.startY=i,nE(e.element,np,{x:r,y:i}),e.lastTouchStartPoint=null},{passive:!0}),t.addEventListener("click",r=>{L.debug("click"),e.suppressClickEvent||nE(t,nm,{x:r.offsetX,y:r.offsetY}),e.suppressClickEvent=!1}),t.addEventListener("contextmenu",e=>{e.preventDefault(),nE(t,ng,{x:e.offsetX,y:e.offsetY})}),t.addEventListener(nm,e=>{let t=e.detail.x,r=e.detail.y,i=eg.uiCoordsToMappedPositions(t,r);nc.resolveClick(i)||ex.resolveClick(i)}),t.addEventListener(nd,e=>{let t=e.detail.x,r=e.detail.y,i=eg.uiCoordsToMappedPositions(t,r);nc.resolvePointerDown(i)}),t.addEventListener(nf,e=>{let t=e.detail.x,r=e.detail.y,i=eg.uiCoordsToMappedPositions(t,r);nc.resolvePointerUp(i)}),t.addEventListener(np,e=>{let t=e.detail.x,r=e.detail.y,i=eg.uiCoordsToMappedPositions(t,r);nc.resolvePointerCancel(i)}),t.addEventListener(nS,e=>{aD.panCameraBy(-e.detail.dx,-e.detail.dy)}),t.addEventListener(ng,e=>{let t=e.detail.x,r=e.detail.y,i=eg.uiCoordsToMappedPositions(t,r);nc.resolveContextMenu(i)||ex.resolveContextMenu(i),e.preventDefault()})}(),rT.forEach(e=>{if(e.label=ti.getText(e.labelKey),e.persistent&&e.onChange&&!e.doNotInitialise){let t=e1.get(e.id,e.defValue);e.onChange(t)}}),tc.showControlsDialog(function(){let e=document.createElement("div");return e.appendChild(te("p",{text:tr`MESSAGE WELCOME`})),e.appendChild(te("p",{text:tr`TRIGGERS`})),e}(),{okButtonLabel:tr`BUTTON START`,className:"door"}).then(()=>rE(e1.get("START_IN_FULLSCREEN"))).then(()=>tu.loadAndPlayMusic(iU.MUSIC)).then(()=>tu.loadEffects(iU.SOUND_EFFECTS_MAP)).then(()=>eN.loadSpriteMap(iH.data,iH.textureUrl)).then(()=>tq(iU.DUNGEON_SCRIPT)).then(e=>aD.setSceneList((L.debug("Creating automatic scene list."),new ij))).then(()=>(function(e){L.debug("Loading almanacs.");let t=[];return e.forEach((e,r)=>{let i=tq(e).then(e=>{let t=function(e,t){let r=new tZ;return e.split(/[\r\n]+/).forEach(e=>{if(""!==(e=e.trim())&&!e.startsWith("#")){let i=tQ(e,t);if(i)switch(i.rarity){case tj.VERY_RARE:r.veryRare.push(i);break;case tj.RARE:r.rare.push(i);break;case tj.UNCOMMON:r.uncommon.push(i);break;case tj.COMMON:default:r.common.push(i)}}}),r}(e,r);tJ.addAlmanac(r,t)});t.push(i)}),Promise.all(t)})(iU.ALMANAC_MAP)).then(()=>(L.debug("All assets loaded. Trigger main menu."),t.remove(),ad.triggerEvent(ad.EventId.MAIN_MENU))).then(()=>{ta.onStartAnimation=()=>void window.requestAnimationFrame(nR),ta.setAnimationState(!0)}).catch(e=>{L.error(e),alert(`Fatal error in main game. ${e.message}`)})}};class nN{#iM;arrowFunction;constructor(){this.#iM=["one","two","three"],this.arrowFunction=e=>`[${e}]`}get privateMember(){return this.#iM}set privateMember(e){this.#iM=e}#i_(){return[this.#iM,"a","s","s"].map(e=>this.arrowFunction(e)).join("")}static testSupportedFeatures(e){let t=new nN;t.privateMember=e;let r=t.#i_();L.debug(`Supported feature test: ${r}`)}}window.addEventListener("load",()=>{L.info(`Version: ${S} ${w}`),L.info(`Browser: ${navigator.userAgent}`),L.info(`devicePixelRatio: ${window.devicePixelRatio}`),nN.testSupportedFeatures("p"),"serviceWorker"in navigator?(navigator.serviceWorker.register(C).then(e=>{console.info("Service worker registration successful: ",e)}).catch(e=>{console.error("Service worker registration failed: ",e)}),N.setDeleteAllCachesFunction(R)):console.info("Service workers not supported by this browser.");try{nO.initialise({width:800,height:600,maxScale:e1.get("DO_NOT_SCALE",!1)?1:2.4,minScale:1,sizingMethod:"COVER",alpha:!1})}catch(e){L.fatal(e)}})}();